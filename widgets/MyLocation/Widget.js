// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"esri/widgets/Locate":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/accessorSupport/decorators/aliasOf ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Widget ./Locate/LocateViewModel ./support/decorators/accessibleHandler ./support/decorators/messageBundle ../core/Logger ./support/decorators/vmEvent ./support/jsxFactory ./support/widgetUtils".split(" "),
function(l,e,c,h,m,t,q,r,E,C,D,x,A,y,w,B){h=function(u){function d(b,k){b=u.call(this,b,k)||this;b.geolocationOptions=null;b.goToLocationEnabled=null;b.goToOverride=null;b.graphic=null;b.iconClass="esri-icon-north-navigation";b.label=void 0;b.messages=null;b.messagesCommon=null;b.popupEnabled=null;b.scale=null;b.useHeadingEnabled=null;b.view=null;b.viewModel=new C;return b}l._inheritsLoose(d,u);var a=d.prototype;a.cancelLocate=function(){};a.locate=function(){};a.render=function(){const b=this.get("viewModel.state");
var k="locating"===b;k={["esri-icon-loading-indicator"]:k,["esri-rotating"]:k,["esri-icon-locate"]:!k};const g="locating"===b?this.messagesCommon.cancel:this.messages.title;return w.tsx("div",{bind:this,class:this.classes("esri-locate esri-widget--button esri-widget",{["esri-disabled"]:"disabled"===b,["esri-hidden"]:"feature-unsupported"===b}),hidden:"feature-unsupported"===b,onclick:this._locate,onkeydown:this._locate,role:"button",tabIndex:0,"aria-label":g,title:g},w.tsx("span",{"aria-hidden":"true",
class:this.classes("esri-icon",k)}),w.tsx("span",{class:"esri-icon-font-fallback-text"},this.messages.title))};a._locate=function(){const {viewModel:b}=this;"locating"===b.state?b.cancelLocate():b.locate()};return d}(E);e.__decorate([c.aliasOf("viewModel.geolocationOptions")],h.prototype,"geolocationOptions",void 0);e.__decorate([c.aliasOf("viewModel.goToLocationEnabled")],h.prototype,"goToLocationEnabled",void 0);e.__decorate([c.aliasOf("viewModel.goToOverride")],h.prototype,"goToOverride",void 0);
e.__decorate([c.aliasOf("viewModel.graphic")],h.prototype,"graphic",void 0);e.__decorate([q.property()],h.prototype,"iconClass",void 0);e.__decorate([q.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],h.prototype,"label",void 0);e.__decorate([q.property(),x.messageBundle("esri/widgets/Locate/t9n/Locate")],h.prototype,"messages",void 0);e.__decorate([q.property(),x.messageBundle("esri/t9n/common")],h.prototype,"messagesCommon",void 0);e.__decorate([c.aliasOf("viewModel.popupEnabled")],
h.prototype,"popupEnabled",void 0);e.__decorate([c.aliasOf("viewModel.scale")],h.prototype,"scale",void 0);e.__decorate([c.aliasOf("viewModel.useHeadingEnabled")],h.prototype,"useHeadingEnabled",void 0);e.__decorate([c.aliasOf("viewModel.view")],h.prototype,"view",void 0);e.__decorate([q.property({type:C}),y.vmEvent(["locate","locate-error"])],h.prototype,"viewModel",void 0);e.__decorate([c.aliasOf("viewModel.cancelLocate")],h.prototype,"cancelLocate",null);e.__decorate([c.aliasOf("viewModel.locate")],
h.prototype,"locate",null);e.__decorate([D.accessibleHandler()],h.prototype,"_locate",null);return h=e.__decorate([r.subclass("esri.widgets.Locate")],h)})},"esri/widgets/Locate/LocateViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../intl ../../PopupTemplate ../../core/Error ../../core/Handles ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../Popup/actions ../support/GeolocationPositioning ../support/geolocationUtils ../../intl/locale ../../intl/messages".split(" "),
function(l,e,c,h,m,t,q,r,E,C,D,x,A,y,w,B){function u(){return d.apply(this,arguments)}function d(){d=l._asyncToGenerator(function*(){const a=yield B.fetchMessageBundle("esri/widgets/Locate/t9n/Locate");return new h({title:a.currentLocation,fieldInfos:[{fieldName:"timestamp",label:a.timestamp,format:{dateFormat:"short-date-short-time"}},{fieldName:"latitude",label:a.latitude,format:{places:4,digitSeparator:!0}},{fieldName:"longitude",label:a.longitude,format:{places:4,digitSeparator:!0}},{fieldName:"accuracy",
label:a.accuracy,format:{places:0,digitSeparator:!0}},{fieldName:"altitude",label:a.altitude,format:{places:0,digitSeparator:!0}},{fieldName:"altitudeAccuracy",label:a.altitudeAccuracy,format:{places:0,digitSeparator:!0}},{fieldName:"heading",label:a.heading,format:{places:0,digitSeparator:!0}},{fieldName:"speed",label:a.speed,format:{places:0,digitSeparator:!0}}],actions:[x.removeSelectedFeature.clone()],content:[{type:"fields"}]})});return d.apply(this,arguments)}c=function(a){function b(g){g=a.call(this,
g)||this;g._locateController=null;g._handles=new t;g.popupEnabled=!0;g.locate=g.locate.bind(l._assertThisInitialized(g));return g}l._inheritsLoose(b,a);var k=b.prototype;k.initialize=function(){this._handles.add([w.onLocaleChange(()=>{var g;const {graphic:n,view:p}=this;(null==p?0:null==(g=p.graphics)?0:g.includes(n))&&this._updatePopupTemplate(n)})])};k.destroy=function(){this.cancelLocate();this._handles.destroy();this._handles=null};k.locate=function(){var g=l._asyncToGenerator(function*(){this.cancelLocate();
if("disabled"===this.state)throw new m("locate:disabled-state","Cannot locate when disabled.");if("feature-unsupported"===this.state)throw new m("locate:feature-unsupported-state","Cannot locate in unsecure domain.");const n=new AbortController;this._locateController=n;try{let p=yield y.getCurrentPosition(this.geolocationOptions);p=yield this._setPosition(p,{signal:n.signal});if(this._locateController!==n)return null;this.graphic&&(this.graphic=this.graphic.clone(),yield this._updatePopupTemplate(this.graphic),
this.view.graphics.push(this.graphic));this.emit("locate",{position:p});this._locateController=null;return p}catch(p){throw this._locateController=null,this.emit("locate-error",{error:p}),p;}});return function(){return g.apply(this,arguments)}}();k.cancelLocate=function(){this._clear();this._locateController&&this._locateController.abort();this._locateController=null};k._updatePopupTemplate=function(){var g=l._asyncToGenerator(function*(n){if(this.popupEnabled){var p=yield u(),G=n!==this.graphic;
this.destroyed||G||(n.popupTemplate=p)}});return function(n){return g.apply(this,arguments)}}();l._createClass(b,[{key:"state",get:function(){return this._geolocationUsable?this.get("view.ready")?this._locateController?"locating":"ready":"disabled":"feature-unsupported"}}]);return b}(A);e.__decorate([q.property()],c.prototype,"_locateController",void 0);e.__decorate([q.property()],c.prototype,"popupEnabled",void 0);e.__decorate([q.property({readOnly:!0})],c.prototype,"state",null);e.__decorate([q.property()],
c.prototype,"locate",null);e.__decorate([q.property()],c.prototype,"cancelLocate",null);return c=e.__decorate([D.subclass("esri.widgets.Locate.LocateViewModel")],c)})},"esri/widgets/support/GeolocationPositioning":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../assets ../../Graphic ../../core/Accessor ../../core/Error ../../core/Evented ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../symbols/PictureMarkerSymbol ./geolocationUtils ./GoTo".split(" "),
function(l,e,c,h,m,t,q,r,E,C,D,x,A,y,w){m=function(B){function u(){var a=B.apply(this,arguments)||this;a._geolocationUsable=!0;a._iconPath=c.getAssetUrl("esri/images/support/sdk_gps_location.png");a.geolocationOptions=null;a.goToLocationEnabled=!0;a.graphic=new h({symbol:new A({url:a._iconPath,width:21,height:21})});a.scale=null;a.useHeadingEnabled=!0;a.view=null;return a}l._inheritsLoose(u,B);var d=u.prototype;d.initialize=function(){y.supported()||(this._geolocationUsable=!1)};d.destroy=function(){this._clear();
this.view=null};d._clear=function(){this.view&&this.view.graphics.remove(this.graphic)};d._getScaleWithinConstraints=function(a,b){if(!b)return a;if("2d"===b.type){const {effectiveMaxScale:k,effectiveMinScale:g}=b.constraints;return Math.min(g,Math.max(k,a))}return a};d._getScale=function(a){const {scale:b}=this;return this._getScaleWithinConstraints("number"===typeof b?b:2500,a)};d._getHeading=function(a,b){b=b&&b.spatialReference;a=a.coords&&a.coords.heading;if(!(!b||!b.isWebMercator&&!b.isGeographic||
"number"!==typeof a||isNaN(a)||0>a||360<a))return a};d._addHeading=function(a){const {heading:b,target:k,view:g}=a;g&&"number"===typeof b&&!isNaN(b)&&("3d"===g.type?k.heading=b:"2d"===g.type&&(k.rotation=360-b))};d._animatePoint=function(a,b,k,g){const {view:n}=this;if(!this.goToLocationEnabled||!n)return Promise.resolve(b);const p=this.useHeadingEnabled?this._getHeading(b,n):void 0;a={target:a,scale:k};this._addHeading({heading:p,target:a,view:n});return this.callGoTo({target:a,options:g}).then(()=>
b)};d._setPosition=function(){var a=l._asyncToGenerator(function*(b,k){try{const n=yield y.positionToPoint({position:b,view:this.view},k),{graphic:p}=this;var {timestamp:g}=b;const {coords:G}=b,{accuracy:H,altitude:L,altitudeAccuracy:M,heading:N,latitude:O,longitude:I,speed:J}=G;g={timestamp:g,accuracy:H,altitude:L,altitudeAccuracy:M,heading:N,latitude:O,longitude:I,speed:J};p&&(p.geometry=n,p.attributes=g);const K=this._getScale(this.view);return this._animatePoint(n,b,K,k)}catch(n){throw new t("positioning:invalid-point",
"Cannot position invalid point",{error:n});}});return function(b,k){return a.apply(this,arguments)}}();return u}(w.GoToMixin(q.EventedMixin(m)));e.__decorate([r.property()],m.prototype,"_geolocationUsable",void 0);e.__decorate([r.property()],m.prototype,"geolocationOptions",void 0);e.__decorate([r.property()],m.prototype,"goToLocationEnabled",void 0);e.__decorate([r.property()],m.prototype,"graphic",void 0);e.__decorate([r.property()],m.prototype,"scale",void 0);e.__decorate([r.property()],m.prototype,
"useHeadingEnabled",void 0);e.__decorate([r.property()],m.prototype,"view",void 0);return m=e.__decorate([x.subclass("esri.widgets.support.GeolocationPositioning")],m)})},"esri/widgets/support/geolocationUtils":function(){define("exports ../../config ../../core/Error ../../core/has ../../core/Logger ../../geometry/Point ../../geometry/support/webMercatorUtils ../../portal/Portal ../../chunks/_rollupPluginBabelHelpers ../../request ../../core/urlUtils ../../core/unitUtils ../../geometry ../../geometry/Extent ../../geometry/Geometry ../../geometry/Multipoint ../../geometry/Polygon ../../geometry/Polyline ../../rest/geometryService/units ../../rest/operations/generalize ../../rest/support/GeneralizeParameters ../../rest/operations/lengths ../../rest/support/LengthsParameters ../../rest/operations/offset ../../rest/support/OffsetParameters ../../rest/geometryService/project ../../rest/operations/relation ../../rest/support/RelationParameters ../../rest/operations/trimExtend ../../rest/support/TrimExtendParameters ../../rest/support/ProjectParameters".split(" "),
function(l,e,c,h,m,t,q,r,E,C,D,x,A,y,w,B,u,d,a,b,k,g,n,p,G,H,L,M,N,O,I){function J(f,z,v){if(!z)return Promise.resolve(f);const F=z.spatialReference;return F.isWGS84?Promise.resolve(f):F.isWebMercator?Promise.resolve(q.geographicToWebMercator(f)):K(v).then(P=>{if(!P)throw new c("geometry-service:missing-url","Geometry service URL is missing");const R=new I({geometries:[f],outSpatialReference:F});return H.project(P,R,v).then(S=>S[0])})}function K(f){if(e.geometryServiceUrl)return Promise.resolve(e.geometryServiceUrl);
const z=r.getDefault();return z.load(f).catch(()=>{}).then(()=>z.get("helperServices.geometry.url"))}const Q=m.getLogger("esri.widgets.support.geolocationUtils"),T={maximumAge:0,timeout:15E3,enableHighAccuracy:!0};l.getCurrentPosition=function(f){f||(f=T);return new Promise((z,v)=>{setTimeout(()=>v(new c("geolocation:timeout","getting the current geolocation position timed out")),15E3);navigator.geolocation.getCurrentPosition(z,v,f)})};l.positionToPoint=function(f,z){const {position:v,view:F}=f;f=
v&&v.coords||{};f={accuracy:f.accuracy,altitude:f.altitude,altitudeAccuracy:f.altitudeAccuracy,heading:f.heading,latitude:f.latitude,longitude:f.longitude,speed:f.speed};f=v?{coords:f,timestamp:v.timestamp}:v;f=(f=f&&f.coords)?new t({longitude:f.longitude,latitude:f.latitude,z:f.altitude||null,spatialReference:{wkid:4326}}):null;return J(f,F,z)};l.supported=function(){var f;(f=h("esri-geolocation"))||Q.warn("geolocation-unsupported","Geolocation unsupported.");f&&((f=window.isSecureContext)||Q.warn("insecure-context",
"Geolocation requires a secure origin."));return f};Object.defineProperty(l,"__esModule",{value:!0})})},"widgets/MyLocation/_build-generate_module":function(){define(["dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:widgets/MyLocation/css/style.css":'.jimu-widget-mylocation {background-color: #fff; opacity: 0.8; color: rgba(0, 0, 0, 0.8);}.jimu-widget-mylocation:hover {opacity: 1;}.jimu-widget-mylocation.nohttps:hover{opacity: 0.8;}.jimu-widget-mylocation.onCenter {background-color: #000;}.jimu-widget-mylocation .esri-locate-node {display: none;}.jimu-widget-mylocation .place-holder {width: 32px; height: 32px; background-color: #666; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; cursor: pointer; border: 1px solid rgba(0, 0, 0, 0.3); text-align: center; line-height: 30px; font-size: 14px; background-position: center center; background-repeat: no-repeat;}.jimu-widget-mylocation .place-holder:before {font-family: \'Themefont\'; content: "\\a907";}.jimu-widget-mylocation .place-holder.locating:before {content: "";}.jimu-widget-mylocation .place-holder.locating {background-image: url("images/loading_black.gif"); background-repeat: no-repeat; background-position: center;}.jimu-widget-mylocation .place-holder.nohttps{color: #bcbcbc;}.jimu-widget-mylocation .place-holder.tracking:before {content: "\\a913" !important; color: rgba(255, 255, 255, 0.8);}.jimu-widget-mylocation .place-holder {background-color: rgba(0, 0, 0, 0);}.jimu-widget-mylocation.onCenter .place-holder {color: #fff;}.jimu-widget-mylocation.onLocate .place-holder {background-color: rgba(0, 0, 0, 0.4);}',
"*now":function(l){l(['dojo/i18n!*preload*widgets/MyLocation/nls/Widget*["ar","bg","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sk","sl","sr","sv","th","tr","zh-cn","uk","vi","zh-hk","zh-tw","ROOT"]'])}}});
define("dojo/_base/declare jimu/BaseWidget dojo/_base/html dojo/on dojo/when dojo/_base/lang esri/layers/GraphicsLayer esri/widgets/Locate esri/widgets/Locate/LocateViewModel esri/symbols/PictureMarkerSymbol esri/geometry/Point esri/geometry/SpatialReference esri/geometry/support/webMercatorUtils esri/tasks/support/ProjectParameters esri/Graphic esri/config jimu/utils".split(" "),function(l,e,c,h,m,t,q,r,E,C,D,x,A,y,w,B,u){l=l([e],{name:"MyLocation",baseClass:"jimu-widget-mylocation",startup:function(){this.inherited(arguments);
this.placehoder=c.create("div",{"class":"place-holder",title:this.label},this.domNode);this.isNeedHttpsButNot=u.isNeedHttpsButNot();!0===this.isNeedHttpsButNot?(console.log("LocateButton::navigator.geolocation requires a secure origin."),c.addClass(this.domNode,"nohttps"),c.addClass(this.placehoder,"nohttps"),c.setAttr(this.placehoder,"title",this.nls.httpNotSupportError)):window.navigator.geolocation?this.own(h(this.placehoder,"click",t.hitch(this,this.onLocationClick))):c.setAttr(this.placehoder,
"title",this.nls.browserError)},onLocationClick:function(){c.hasClass(this.domNode,"onCenter")||c.hasClass(this.domNode,"locating")?this._destroyGeoLocate():(this._destroyGeoLocate(),this._createGeoLocateAndLocate())},_createGeoLocateAndLocate:function(){this.getGeoLocateInstance();this.geoLocate.viewModel.locate();c.addClass(this.placehoder,"locating")},getGeoLocateInstance:function(){var d=this.config.locateButton,a={maximumAge:0,timeout:15E3,enableHighAccuracy:!0};d.geolocationOptions&&t.mixin(a,
d.geolocationOptions);this.graphicsLayer=new q;this.sceneView.map.add(this.graphicsLayer);var b=c.create("div",{"class":"esri-locate-node"},this.domNode);a={view:this.sceneView,graphicsLayer:this.graphicsLayer,geolocationOptions:a,scale:d.scale,tracking:d.useTracking,clearOnTrackingStopEnabled:!1};d.highlightLocation||(a.graphic=null);this.geoLocate=new r({viewModel:new E(a),container:b,visible:!1});this.geoLocate.own(h(this.geoLocate.viewModel,"locate",t.hitch(this,this.onLocate)));this.geoLocate.own(h(this.geoLocate.viewModel,
"locate-error",t.hitch(this,this.onLocateError)));return this.geoLocate},onLocate:function(d){this.publishData({geoLocationResult:d});c.removeClass(this.placehoder,"locating");this.graphicsLayer.removeAll();this.geoLocate.viewModel.tracking&&c.addClass(this.placehoder,"tracking");if(d.error)this.onLocateError(d.error);else c.addClass(this.domNode,"onCenter"),this.neverLocate=!1},onLocateError:function(d){this.publishData({geoLocationResult:d});console.error(d.error);c.removeClass(this.placehoder,
"locating");c.removeClass(this.domNode,"onCenter");c.removeClass(this.placehoder,"tracking")},_destroyGeoLocate:function(){this.graphicsLayer&&(this.graphicsLayer.removeAll(),this.sceneView.map.remove(this.graphicsLayer));this.geoLocate&&(this.geoLocate.viewModel.cancelLocate(),this.geoLocate.viewModel.graphicsLayer.removeAll(),this.geoLocate.destroy(),this.geoLocate=null);c.removeClass(this.domNode,"onCenter");c.removeClass(this.placehoder,"tracking")},destroy:function(){this._destroyGeoLocate();
this.inherited(arguments)},_pointMarkerManualy:function(d){"undefined"!==typeof this.config.locateButton.highlightLocation&&!1!==this.config.locateButton.highlightLocation&&(this.highlightSymbol=new C({url:this.folderUrl+"css/images/sdk_gps_location.png",size:28,width:28,height:28,xoffset:14,yoffset:14}),d=new D({longitude:d.position.coords.longitude,latitude:d.position.coords.latitude,spatialReference:new x({wkid:4326})}),this._project(d).then(t.hitch(this,function(a){a=new w({geometry:a[0],symbol:this.highlightSymbol});
this.config.locateButton.highlightLocation&&this.graphicsLayer.add(a)}),t.hitch(this,function(a){this.onLocateError(a)})))},_project:function(d){var a=this.sceneView.spatialReference;if(d.spatialReference.equals(a))return m([d]);if(A.canProject(d,a))return m([A.project(d,a)]);var b=new y;b.geometries=[d];b.outSR=a;return B.geometryService.project(b)}});l.inPanel=!1;l.hasUIFile=!1;return l});