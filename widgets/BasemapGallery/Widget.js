// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"esri/widgets/BasemapGallery":function(){define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../assets ../core/Handles ../core/watchUtils ../core/accessorSupport/decorators/aliasOf ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Widget ./BasemapGallery/BasemapGalleryViewModel ./support/Heading ./support/decorators/accessibleHandler ./support/decorators/messageBundle ../core/Logger ./support/jsxFactory ./support/widgetUtils".split(" "),
function(p,d,c,m,A,t,u,h,F,E,v,w,y,z,C,k,b,f,e,B){h=function(q){function r(a,g){a=q.call(this,a,g)||this;a._handles=new A;a.activeBasemap=null;a.disabled=!1;a.headingLevel=2;a.iconClass="esri-icon-basemap";a.label=void 0;a.messages=null;a.source=null;a.view=null;a.viewModel=new z;return a}d._inheritsLoose(r,q);var l=r.prototype;l.initialize=function(){const a=this._handles;this.own([t.on(this,"viewModel.items","change",g=>{const {added:n,moved:x}=g;a.remove("basemap-gallery-item-changes");a.add([...n,
...x].map(D=>D.watch("state",()=>this.scheduleRender())),"basemap-gallery-item-changes");this.scheduleRender()}),a,t.whenOnce(this,"source",()=>this.viewModel.load())])};l.loadDependencies=function(){return new Promise((a,g)=>p(["../chunks/calcite-scrim"],a,g))};l.render=function(){var a="loading"===this.get("source.state"),g=this.disabled||"disabled"===this.get("viewModel.state");const n=this.get("viewModel.items").toArray().map(this._renderBasemapGalleryItem,this);g={["esri-basemap-gallery--source-loading"]:a,
["esri-disabled"]:g};const x=a?e.tsx("div",{class:"esri-basemap-gallery__loader",key:"esri-basemap-gallery__loader"}):null;a=a?null:0<n.length?e.tsx("ul",{class:"esri-basemap-gallery__item-container",key:"esri-basemap-gallery__item-container",role:"menu"},n):e.tsx("div",{class:"esri-widget__content--empty",key:"esri-basemap-gallery__empty-message"},e.tsx(C.Heading,{level:this.headingLevel},this.messages.noBasemaps));return e.tsx("div",{class:this.classes("esri-basemap-gallery esri-widget esri-widget--panel-height-only",
g)},x,a)};l._handleClick=function(a){a=a.currentTarget["data-item"];"ready"===a.state&&(this.viewModel.activeBasemap=a.basemap)};l._renderBasemapGalleryItem=function(a){const g=a.get("basemap.thumbnailUrl")||m.getAssetUrl("esri/themes/base/images/basemap-toggle-64.svg"),n=a.get("basemap.title");var x=a.get("basemap.portalItem.snippet");x=a.get("error.message")||x||n;var {viewModel:D}=this;const H=this.disabled||"disabled"===D.state||"ready"!==a.state?-1:0,G=D.basemapEquals(a.basemap,this.activeBasemap);
D="loading"===D.state;return e.tsx("li",{"aria-selected":G.toString(),bind:this,class:this.classes("esri-basemap-gallery__item",{["esri-basemap-gallery__item--selected"]:G,["esri-basemap-gallery__item--error"]:"error"===a.state}),"data-item":a,onkeydown:this._handleClick,onclick:this._handleClick,role:"menuitem",tabIndex:H,title:x},e.tsx("img",{alt:"",class:"esri-basemap-gallery__item-thumbnail",src:g}),e.tsx("div",{class:"esri-basemap-gallery__item-title"},n),"loading"===a.state||G&&D?e.tsx("calcite-scrim",
null,e.tsx("span",{"aria-hidden":"true",role:"presentation",class:"esri-widget__loader-animation"})):null)};return r}(y);c.__decorate([u.aliasOf("viewModel.activeBasemap")],h.prototype,"activeBasemap",void 0);c.__decorate([v.property()],h.prototype,"disabled",void 0);c.__decorate([v.property()],h.prototype,"headingLevel",void 0);c.__decorate([v.property()],h.prototype,"iconClass",void 0);c.__decorate([v.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],h.prototype,"label",void 0);
c.__decorate([v.property(),b.messageBundle("esri/widgets/BasemapGallery/t9n/BasemapGallery")],h.prototype,"messages",void 0);c.__decorate([u.aliasOf("viewModel.source")],h.prototype,"source",void 0);c.__decorate([u.aliasOf("viewModel.view")],h.prototype,"view",void 0);c.__decorate([v.property()],h.prototype,"viewModel",void 0);c.__decorate([k.accessibleHandler()],h.prototype,"_handleClick",null);return h=c.__decorate([w.subclass("esri.widgets.BasemapGallery")],h)})},"esri/widgets/BasemapGallery/BasemapGalleryViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Collection ../../core/HandleOwner ../../core/Loadable ../../core/maybe ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ../../geometry/projection ../../geometry/support/spatialReferenceUtils ../../support/basemapUtils ./support/basemapCompatibilityUtils ./support/BasemapGalleryItem ./support/LocalBasemapsSource ./support/PortalBasemapsSource".split(" "),
function(p,d,c,m,A,t,u,h,F,E,v,w,y,z,C,k,b,f,e){const B=c.ofType(b);m=function(q){function r(a){a=q.call(this,a)||this;a._loadingProjectionEngine=!1;a.items=new B;a.source=new e;a.view=null;return a}p._inheritsLoose(r,q);var l=r.prototype;l.initialize=function(){const a=()=>this._recreateItems();this.handles.add([u.watch(()=>"ready"===this.state?this.compatibilityFunction:null,()=>this._updateItems()),u.on(()=>{var g;return null==(g=this.source)?void 0:g.basemaps},"change",a,{onListenerAdd:a})])};
l.castSource=function(a){return Array.isArray(a)||c.isCollection(a)?new f({basemaps:a}):a&&"esri.portal.Portal"===a.declaredClass?new e({portal:a}):!a||a instanceof e||!a.portal&&!a.query?a&&"basemaps"in a&&"state"in a&&"refresh"in a?a:null:new e(a)};l.basemapEquals=function(a,g){return C.contentEquals(a,g)};l.refresh=function(){this._recreateItems()};l.load=function(a){this.addResolvingPromise(A.isLoadable(this.source)?this.source.load(a):null);return Promise.resolve(this)};l._recreateItems=function(){var a;
const g=null==(a=this.source)?void 0:a.basemaps,{view:n,compatibilityFunction:x}=this;this.items.removeAll().forEach(D=>D.destroy());g&&this.items.addMany(g.map(D=>new b({basemap:D,compatibilityFunction:x,view:n})))};l._updateItems=function(){for(const a of this.items)a.compatibilityFunction=this.compatibilityFunction,a.view=this.view};p._createClass(r,[{key:"activeBasemap",get:function(){var a,g,n;return null!=(a=null==(g=this.view)?void 0:null==(n=g.map)?void 0:n.basemap)?a:null},set:function(a){var g;
if(this.view.map)if(a&&this.view.ready){var n=a.spatialReference||(null==(g=this.items)?void 0:g.find(x=>x.basemap===a).spatialReference);n&&"spatialReferenceLocked"in this.view&&!this.view.spatialReferenceLocked?(g=this.view.spatialReference,!t.isSome(n)||z.equals(g,n)||y.canProjectWithoutEngine(this.view.spatialReference,n)||y.isLoaded()?(this.view.map.basemap=a,this._clearOverride("activeBasemap"),t.isSome(n)&&!z.equals(this.view.spatialReference,n)&&(this.view.spatialReference=n)):(this._override("activeBasemap",
a),this._loadingProjectionEngine=!0,y.load().then(()=>{this._get("activeBasemap")===a&&(this.view.map.basemap=a,this.view.spatialReference=n,this._clearOverride("activeBasemap"))},()=>{}).then(()=>{this._loadingProjectionEngine=!1}))):(this.view.map.basemap=a,this._clearOverride("activeBasemap"))}else this.view.map.basemap=a,this._clearOverride("activeBasemap")}},{key:"compatibilityFunction",get:function(){var a;return"3d"===(null==(a=this.view)?void 0:a.type)?k.default3DCompatibility:k.default2DCompatibility},
set:function(a){t.isSome(a)?this._override("compatibilityFunction",a):this._clearOverride("compatibilityFunction")}},{key:"state",get:function(){var a;return null!=(a=this.view)&&a.ready&&this.source?this._loadingProjectionEngine?"loading":"ready":"disabled"}}]);return r}(m.HandleOwnerMixin(A));d.__decorate([h.property()],m.prototype,"_loadingProjectionEngine",void 0);d.__decorate([h.property()],m.prototype,"activeBasemap",null);d.__decorate([h.property()],m.prototype,"compatibilityFunction",null);
d.__decorate([h.property({readOnly:!0,type:B})],m.prototype,"items",void 0);d.__decorate([h.property()],m.prototype,"source",void 0);d.__decorate([v.cast("source")],m.prototype,"castSource",null);d.__decorate([h.property({readOnly:!0})],m.prototype,"state",null);d.__decorate([h.property()],m.prototype,"view",void 0);return m=d.__decorate([w.subclass("esri.widgets.BasemapGallery.BasemapGalleryViewModel")],m)})},"esri/widgets/BasemapGallery/support/basemapCompatibilityUtils":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../layers/support/layerUtils ../../../views/ViewingMode ../../../views/3d/terrain/terrainUtils ../../../views/3d/terrain/TilingScheme ../../../views/support/spatialReferenceSupport".split(" "),
function(p,d,c,m,A,t,u,h,F,E){function v(){v=d._asyncToGenerator(function*(b,f={}){yield z(b,f);A.throwIfAborted(f)});return v.apply(this,arguments)}function w(){w=d._asyncToGenerator(function*(b,f={}){const {basemap:e,view:B}=b;A.throwIfAborted(f);if(!("spatialReferenceLocked"in B)||B.spatialReferenceLocked)if(yield e.load(f),A.throwIfAborted(f),0!==e.baseLayers.length&&(b=e.baseLayers.getItemAt(0),t.isTiledLayer(b))){if(e.spatialReference){if(B.spatialReference.equals(e.spatialReference))return;
y()}yield b.load(f);A.throwIfAborted(f);f=(("supportedSpatialReferences"in b?b.supportedSpatialReferences:null)||["tileInfo"in b?b.tileInfo.spatialReference:null]).filter(Boolean);0!==f.length&&f.every(q=>!B.spatialReference.equals(q))&&y()}});return w.apply(this,arguments)}function y(){throw new c("basemap-compatibility:incompatible-spatial-reference","Basemap spatial reference is not compatible with the view");}function z(b,f){return C.apply(this,arguments)}function C(){C=d._asyncToGenerator(function*(b,
f){const {basemap:e,view:B}=b;yield e.load(f);if(0!==e.baseLayers.length){b=e.baseLayers.concat(e.referenceLayers);b=k(b);if(b.length)throw b[0];b=e.baseLayers.getItemAt(0);try{yield b.load(f)}catch(a){const {name:g="basemap-compatibility:unknown-error",message:n="Unknown basemap compatibility error",details:x}=a;throw new c(g,n,x);}var q=B.state.viewingMode;if(q){f=b.tileInfo;var r=b.fullExtent;if(t.isWMTSLayer(b)){r=h.getTileInfoAndExtentFromWMTSLayer(b,B.spatialReference,q);if(m.isNone(r.tileInfo))throw new c("basemapgalleryitem:tiling-scheme-incompatible",
"Basemap tiling scheme is incompatible with the view");f=r.tileInfo;r=r.fullExtent}if(!m.isNone(f)){if(!E.isSpatialReferenceSupported(f.spatialReference,q))throw new c(`basemapgalleryitem:spatial-reference-unsupported-${u.stringFromViewingMode(q)}`,`Basemap spatial reference is unsupported in ${u.stringFromViewingMode(q)} mode`);var l=f.spatialReference.isGeographic;l=h.isVectorTileLayer(b)?f.getOrCreateCompatible(256,l?1:2):null;if(q===u.ViewingMode.Global){let a=h.checkIfTileInfoSupportedForView(f,
r,null,q);a&&h.isVectorTileLayer(b)&&m.isSome(r)&&l&&!h.checkIfTileInfoSupportedForView(l,r,null,q)&&(a=null);if(a)throw new c(`basemapgalleryitem:tiling-scheme-unsupported-${f.spatialReference.isWebMercator?"web-mercator":"wgs84"}-global`,"Basemap tiling scheme is unsupported in global mode",{error:a});}else if(F.default.checkUnsupported(f))throw new c("basemapgalleryitem:tiling-scheme-unsupported-local","Basemap tiling scheme is unsupported in local mode");if((q=B.get("basemapTerrain.tilingScheme"))&&
!q.compatibleWith(f)&&!(h.isVectorTileLayer(b)&&l&&q.compatibleWith(l)))throw new c("basemapgalleryitem:tiling-scheme-incompatible","Basemap tiling scheme is incompatible with the view");}}}});return C.apply(this,arguments)}function k(b){const f=["ArcGISTiledImageServiceLayer","ArcGISTiledMapServiceLayer","OpenStreetMap","VectorTileLayer","WebTiledLayer"];return b.toArray().filter(e=>-1===f.indexOf(e.operationalLayerType)).map(e=>new c("basemap-compatibility:unsupported-basemap-layer-type","Unsupported basemap layer type ${operationalLayerType}",
{layer:e,operationalLayerType:e.operationalLayerType||"unknown"}))}p.default2DCompatibility=function(b){return w.apply(this,arguments)};p.default3DCompatibility=function(b){return v.apply(this,arguments)};Object.defineProperty(p,"__esModule",{value:!0})})},"esri/widgets/BasemapGallery/support/BasemapGalleryItem":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/HandleOwner ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../support/basemapUtils".split(" "),
function(p,d,c,m,A,t,u,h,F,E,v,w){c=function(y){function z(k){k=y.call(this,k)||this;k.compatibilityFunction=null;k.error=null;k.state="loading";k.view=null;return k}p._inheritsLoose(z,y);var C=z.prototype;C.initialize=function(){const k=()=>this.refresh();this.handles.add([t.watch(()=>{var b;return null==(b=this.basemap)?void 0:b.loadStatus},k),t.watch(()=>this.compatibilityFunction,k),t.watch(()=>{var b;return this.view&&"basemapTerrain"in this.view&&(null==(b=this.view.basemapTerrain)?void 0:b.tilingScheme)},
k),t.watch(()=>{var b;return null==(b=this.view)?void 0:b.ready},k),t.watch(()=>{var b;return null==(b=this.view)?void 0:b.spatialReference},k)]);this.refresh()};C.destroy=function(){this._cancelRefresh();this.view=this.compatibilityFunction=this.basemap=null};C.refresh=function(){var k;this._cancelRefresh();this._set("state","loading");const b=null==(k=this.basemap)?void 0:k.loadStatus;if("loaded"===b||"failed"===b)if(this.compatibilityFunction){k=new AbortController;var {signal:f}=k;this.compatibilityFunction(this,
{signal:f}).then(()=>t.whenOnce(()=>!this._spatialReferenceTask.updating,f)).then(()=>{this._set("state","ready");this._set("error",null)}).catch(e=>{A.isAbortError(e)||(this._set("state","error"),this._set("error",e))});this._refreshController=k}else"loaded"===b?(this._set("state","ready"),this._set("error",null)):(this._set("state","error"),this._set("error",this.basemap.loadError))};C._cancelRefresh=function(){this._refreshController&&(this._refreshController.abort(),this._refreshController=null)};
p._createClass(z,[{key:"_spatialReferenceTask",get:function(){return w.findSpatialReference(this.view,this.basemap)}},{key:"basemap",set:function(k){const b=this._get("basemap");b&&b.cancelLoad();k&&k.load().catch(()=>{});this._set("basemap",k)}},{key:"spatialReference",get:function(){return this._spatialReferenceTask.spatialReference}}]);return z}(m.HandleOwnerMixin(c));d.__decorate([u.property({readOnly:!0})],c.prototype,"_spatialReferenceTask",null);d.__decorate([u.property()],c.prototype,"basemap",
null);d.__decorate([u.property()],c.prototype,"compatibilityFunction",void 0);d.__decorate([u.property({readOnly:!0})],c.prototype,"error",void 0);d.__decorate([u.property({readOnly:!0})],c.prototype,"spatialReference",null);d.__decorate([u.property({readOnly:!0})],c.prototype,"state",void 0);d.__decorate([u.property()],c.prototype,"view",void 0);return c=d.__decorate([v.subclass("esri.widgets.BasemapGallery.support.BasemapGalleryItem")],c)})},"esri/widgets/BasemapGallery/support/LocalBasemapsSource":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Basemap ../../../core/Accessor ../../../core/Collection ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass".split(" "),
function(p,d,c,m,A,t,u,h,F,E){const v=A.ofType(c);c=function(w){function y(z){z=w.call(this,z)||this;z.basemaps=new v;return z}p._inheritsLoose(y,w);y.prototype.refresh=function(){};p._createClass(y,[{key:"state",get:function(){return"ready"}}]);return y}(m);d.__decorate([t.property({type:v})],c.prototype,"basemaps",void 0);d.__decorate([t.property({readOnly:!0})],c.prototype,"state",null);return c=d.__decorate([E.subclass("esri.widgets.BasemapGallery.support.LocalBasemapsSource")],c)})},"esri/widgets/BasemapGallery/support/PortalBasemapsSource":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Basemap ../../../core/Collection ../../../core/Error ../../../core/Handles ../../../core/Loadable ../../../core/Logger ../../../core/Promise ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../portal/Portal ./LocalBasemapsSource".split(" "),
function(p,d,c,m,A,t,u,h,F,E,v,w,y,z,C,k,b,f){const e=m.ofType(c),B=h.getLogger("esri.widgets.BasemapGallery.support.PortalBasemapsSource");c=function(q){function r(a){a=q.call(this,a)||this;a._handles=new t;a.basemaps=new e;a.filterFunction=null;a.portal=b.getDefault();a.query=null;a.updateBasemapsCallback=null;return a}p._inheritsLoose(r,q);var l=r.prototype;l.initialize=function(){this._handles.add([v.init(this,"filterFunction loadStatus portal.basemapGalleryGroupQuery portal.user query updateBasemapsCallback".split(" "),
()=>this.refresh())])};l.destroy=function(){this._handles.destroy();this.portal=this.filterFunction=this._handles=null};l.load=function(a){this.addResolvingPromise(this.portal.load(a));this.notifyChange("state");return Promise.resolve(this)};l.refresh=function(){var a=p._asyncToGenerator(function*(){if("ready"===this.state){this._lastPortalBasemapFetchController&&(this._lastPortalBasemapFetchController.abort(),this._lastPortalBasemapFetchController=null);var g=this.portal,n=new AbortController;this._lastPortalBasemapFetchController=
n;this.notifyChange("state");try{const x=yield g.fetchBasemaps(this._toQueryString(this.query),n);this._updateBasemaps(x)}catch(x){if(E.isAbortError(x))throw x;B.warn(new A("basemap-source:fetch-basemaps-error","Could not fetch basemaps from portal.",{error:x}));this._updateBasemaps()}this._lastPortalBasemapFetchController=null;this.notifyChange("state")}});return function(){return a.apply(this,arguments)}}();l._toQueryString=function(a){return a&&"string"!==typeof a?Object.keys(a).map(g=>`${g}:${a[g]}`).join(" AND "):
a};l._updateBasemaps=function(a=[]){a=this.filterFunction?a.filter(this.filterFunction):a;a=this.updateBasemapsCallback?this.updateBasemapsCallback(a):a;this.basemaps.removeAll();this.basemaps.addMany(a)};p._createClass(r,[{key:"state",get:function(){return"not-loaded"===this.loadStatus?"not-loaded":"loading"===this.loadStatus||this._lastPortalBasemapFetchController?"loading":"ready"}}]);return r}(u.LoadableMixin(F.EsriPromiseMixin(f)));d.__decorate([w.property({readOnly:!0,type:e})],c.prototype,
"basemaps",void 0);d.__decorate([w.property()],c.prototype,"filterFunction",void 0);d.__decorate([w.property({type:b})],c.prototype,"portal",void 0);d.__decorate([w.property()],c.prototype,"query",void 0);d.__decorate([w.property({readOnly:!0})],c.prototype,"state",null);d.__decorate([w.property()],c.prototype,"updateBasemapsCallback",void 0);return c=d.__decorate([k.subclass("esri.widgets.BasemapGallery.support.PortalBasemapsSource")],c)})},"widgets/BasemapGallery/_build-generate_module":function(){define(["dojo/text!./Widget.html",
"dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:widgets/BasemapGallery/Widget.html":"\x3cdiv\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d'basemapGalleryNode'\x3e\x3c/div\x3e\r\n\x3c/div\x3e","url:widgets/BasemapGallery/css/style.css":".jimu-widget-basemap-gallery{width: 100%; height: 100%;}.jimu-widget-basemap-gallery .esri-basemap-gallery.esri-widget{width: 100%; height: 100%; max-height: 100%; background-color: transparent;}.jimu-widget-basemap-gallery .esri-basemap-gallery {max-width: none;}",
"*now":function(p){p(['dojo/i18n!*preload*widgets/BasemapGallery/nls/Widget*["ar","bg","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sk","sl","sr","sv","th","tr","zh-cn","uk","vi","zh-hk","zh-tw","ROOT"]'])}}});
define(["dojo/_base/declare","jimu/BaseWidget","esri/widgets/BasemapGallery","esri/widgets/BasemapGallery/BasemapGalleryViewModel"],function(p,d,c,m){return p([d],{name:"BasemapGallery",baseClass:"jimu-widget-basemap-gallery",postCreate:function(){this.inherited(arguments)},startup:function(){this.basemapGallery=new c({container:this.basemapGalleryNode,viewModel:new m({view:this.sceneView})});this.basemapGallery.render()},destroy:function(){this.basemapGallery&&this.basemapGallery.destroy();this.inherited(arguments)}})});