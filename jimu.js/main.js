// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"jimu/ConfigManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dojo/Deferred dojo/on ./utils ./WidgetManager ./shared/AppVersionManager ./ConfigLoader ./tokenUtils ./portalUrlUtils ./portalUtils esri/config esri/tasks/GeometryService".split(" "),function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h){function m(q,z){var v=b.clone(q),B=l.widgetProperties;"undefined"===typeof z&&(z=!1);delete v.mode;l.visitElement(v,function(A,E){A.widgets?(delete A.isOnScreen,
delete A.gid,"jimu.js/images/group_icon.png"===A.icon&&delete A.icon,delete A.openType,E.isOnScreen&&A.panel&&l.isEqual(A.panel,v.widgetOnScreen.panel)&&delete A.panel):(A.icon&&A.icon===A.folderUrl+"images/icon.png?wab_dv\x3d"+window.deployVersion&&delete A.icon,delete A.panel,delete A.folderUrl,delete A.amdFolder,delete A.thumbnail,delete A.configFile,delete A.gid,delete A.isOnScreen,B.forEach(function(C){delete A[C]}),z?("undefined"===typeof A.openAtStart&&(A.openAtStart=!1),A.config||delete A.config):
(A.visible&&delete A.visible,A.manifest&&A.label===A.manifest.label&&delete A.label,A.isDefaultConfig&&(delete A.config,delete A.isDefaultConfig)),delete A.manifest)});delete v.rawAppConfig;delete v._ssl;delete v.getConfigElementById;delete v.getConfigElementsByName;delete v.getConfigElementByLabel;delete v.processNoUriWidgets;delete v.addElementId;delete v.getCleanConfig;delete v.visitElement;delete v.agolConfig;delete v._itemData;delete v.oldWabVersion;return v}var u=null;var t=a(null,{urlParams:null,
appConfig:null,configFile:null,_configLoaded:!1,portalSelf:null,constructor:function(q){this.urlParams=q||{};this.listenBuilderEvents();this.versionManager=new f;this.widgetManager=n.getInstance();this.configLoader=e.getInstance(this.urlParams,{versionManager:this.versionManager});"config"===this.urlParams.mode&&window.parent.setConfigViewerTopic&&b.isFunction(window.parent.setConfigViewerTopic)&&window.parent.setConfigViewerTopic(g);"preview"===this.urlParams.mode&&window.parent.setPreviewViewerTopic&&
b.isFunction(window.parent.setPreviewViewerTopic)&&window.parent.setPreviewViewerTopic(g);w(window,"resize",b.hitch(this,this._onWindowResize))},listenBuilderEvents:function(){g.subscribe("builder/widgetChanged",b.hitch(this,this._onWidgetChanged));g.subscribe("builder/groupChanged",b.hitch(this,this._onGroupChanged));g.subscribe("builder/widgetPoolChanged",b.hitch(this,this._onWidgetPoolChanged));g.subscribe("builder/openAtStartChange",b.hitch(this,this._onOpenAtStartChanged));g.subscribe("builder/onScreenOrderChanged",
b.hitch(this,this._onScreenOrderChanged));g.subscribe("builder/layoutDefinitionChanged",b.hitch(this,this._onLayoutDefinitionChanged));g.subscribe("builder/sceneViewChanged",b.hitch(this,this._onSceneViewChanged));g.subscribe("builder/mapOptionsChanged",b.hitch(this,this._onMapOptionsChanged));g.subscribe("builder/appAttributeChanged",b.hitch(this,this._onAppAttributeChanged));g.subscribe("builder/setAppConfig",b.hitch(this,this._onAppConfigSet));g.subscribe("builder/themeChanged",b.hitch(this,this._onThemeChanged));
g.subscribe("builder/layoutChanged",b.hitch(this,this._onLayoutChanged));g.subscribe("builder/styleChanged",b.hitch(this,this._onStyleChanged));g.subscribe("builder/syncExtent",b.hitch(this,this._onSyncExtent));g.subscribe("builder/loadingPageChanged",b.hitch(this,this._onLoadingPageChanged));g.subscribe("builder/templateConfigChanged",b.hitch(this,this._onTemplateConfigChanged));g.subscribe("builder/sharedThemeChanged",b.hitch(this,this._onSharedThemeChanged))},loadConfig:function(){if("preview"!==
this.urlParams.mode&&"config"!==this.urlParams.mode)return this.configLoader.loadConfig().then(b.hitch(this,function(q){this.portalSelf=this.configLoader.portalSelf;this.appConfig=this._addDefaultValues(q);window.appInfo.isRunInMobile=this._isRunInMobile();console.timeEnd("Load Config");q=this.getAppConfig();g.publish("appConfigLoaded",q);return q}),b.hitch(this,function(q){console.error(q);q&&q.message&&"string"===typeof q.message&&this._showErrorMessage(q)}))},_showErrorMessage:function(q){if(!1===
q.isSelfOrigin){d.create("div",{"class":"app-error",innerHTML:l.sanitizeHTML(q.message||q)},document.body);q=d.create("div",{"class":"app-error",innerHTML:l.sanitizeHTML(window.jimuNls.common.close)},document.body);d.setStyle(q,{"margin-top":"80px","padding-top":0,background:"none",cursor:"pointer"});w(q,"click",b.hitch(this,function(){window.close()}));d.setStyle(q,"display","none");q=d.create("div",{"class":"app-error"},document.body);d.setStyle(q,{"margin-top":"90px","padding-top":0,background:"none"});
q=d.create("div",{"class":"app-error-advanced-button",innerHTML:l.sanitizeHTML(window.jimuNls.advancedOptions)},q);d.setStyle(q,{margin:"0 auto 0 auto",padding:"8px 12px 8px 12px",color:"#666",background:"none",border:"1px solid #ccc",display:"inline-block","border-radius":"4px",cursor:"pointer"});w(q,"click",b.hitch(this,function(){d.setStyle(v,"display","block")}));q=window.location.href;var z=r.getStandardPortalUrl(window.location.origin);z=r.getArcgisOnlineUrl(z);q=q.replace(window.location.origin,
z);q=window.jimuNls.proceedTo.replace("${value}","\x3ca href\x3d"+q+"\x3e"+q+"\x3c/a\x3e");var v=d.create("div",{"class":"app-error",innerHTML:l.sanitizeHTML(q)},document.body);d.setStyle(v,{"margin-top":"140px",display:"none","padding-top":0,background:"none"});d.setStyle(jimuConfig.loadingId,"display","none")}else d.create("div",{"class":"app-error",innerHTML:l.sanitizeHTML("Unable to create map: "+(q.message||q))},document.body)},getAppConfig:function(){if(window.appInfo.isRunInMobile){var q=b.clone(this._getMobileConfig(this.appConfig));
q._originConfig=b.clone(this.appConfig)}else q=b.clone(this.appConfig);q.getConfigElementById=function(z){return l.getConfigElementById(this,z)};q.getConfigElementByLabel=function(z){return l.getConfigElementByLabel(this,z)};q.getConfigElementsByName=function(z){return l.getConfigElementsByName(this,z)};q.getCleanConfig=function(z){return this._originConfig?m(this._originConfig,z):m(this,z)};q.visitElement=function(z){l.visitElement(this,z)};return q},_onWindowResize:function(){var q=this._isRunInMobile();
window.appInfo.isRunInMobile!==q&&(window.appInfo.isRunInMobile=q,this.appConfig&&g.publish("appConfigChanged",this.getAppConfig(),"layoutChange"))},_isRunInMobile:function(){var q=d.getMarginBox(window.jimuConfig.layoutId);if(q.w<=window.jimuConfig.breakPoints[0]||q.h<=window.jimuConfig.breakPoints[0])return d.addClass(window.jimuConfig.layoutId,"jimu-ismobile"),!0;d.removeClass(window.jimuConfig.layoutId,"jimu-ismobile");return!1},_getMobileConfig:function(q){return l.mixinAppConfigPosition(q,q.mobileLayout)},
_onWidgetChanged:function(q){var z=l.reCreateObject(q);q=l.getConfigElementById(this.appConfig,q.id);!1!==z.inPanel||q.uri||(z.closeable=!0);for(var v in z)q[v]=z[v];delete q.isDefaultConfig;this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);g.publish("appConfigChanged",this.getAppConfig(),"widgetChange",z)},_onGroupChanged:function(q){var z=l.reCreateObject(q);q=l.getConfigElementById(this.appConfig,q.id);for(var v in z)q[v]=z[v];this.configLoader.addNeedValues(this.appConfig);
this._addDefaultValues(this.appConfig);g.publish("appConfigChanged",this.getAppConfig(),"groupChange",z)},_onWidgetPoolChanged:function(q){q=l.reCreateObject(q);if(1===this.widgetManager.getControllerWidgets().length)this.appConfig.widgetPool.widgets=q.widgets,this.appConfig.widgetPool.groups=q.groups;else{var z=l.getConfigElementById(this.appConfig,q.controllerId);c.forEach(z.controlledWidgets,function(v){this._removeWidgetOrGroupFromPoolById(this.appConfig,v)},this);c.forEach(z.controlledGroups,
function(v){this._removeWidgetOrGroupFromPoolById(this.appConfig,v)},this);this.appConfig.widgetPool.widgets="undefined"===typeof this.appConfig.widgetPool.widgets?q.widgets:this.appConfig.widgetPool.widgets.concat(q.widgets);this.appConfig.widgetPool.groups="undefined"===typeof this.appConfig.widgetPool.groups?q.groups:this.appConfig.widgetPool.groups.concat(q.groups);this.configLoader.addNeedValues(this.appConfig);z.controlledWidgets=c.map(q.widgets,function(v){return v.id});z.controlledGroups=
c.map(q.groups,function(v){return v.id})}this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);g.publish("appConfigChanged",this.getAppConfig(),"widgetPoolChange",q)},_removeWidgetOrGroupFromPoolById:function(q,z){c.some(q.widgetPool.widgets,function(v,B){if(v.id===z)return q.widgetPool.widgets.splice(B,1),!0});c.some(q.widgetPool.groups,function(v,B){if(v.id===z)return q.widgetPool.groups.splice(B,1),!0})},_onOpenAtStartChanged:function(q){var z=l.reCreateObject(q),
v=this.appConfig;q.isOnScreen?(v=v.widgetOnScreen&&v.widgetOnScreen.widgets)&&0<v.length&&c.forEach(v,b.hitch(this,function(B){B.id===q.id?B.openAtStart=!B.openAtStart:delete B.openAtStart})):((v=v.widgetPool)&&v.groups&&0<v.groups.length&&c.forEach(v.groups,b.hitch(this,function(B){B.id===q.id?B.openAtStart=!B.openAtStart:delete B.openAtStart})),v&&v.widgets&&0<v.widgets.length&&c.forEach(v.widgets,b.hitch(this,function(B){B.id===q.id?B.openAtStart=!B.openAtStart:delete B.openAtStart})));g.publish("appConfigChanged",
this.getAppConfig(),"openAtStartChange",z)},_onScreenOrderChanged:function(q){var z=l.reCreateObject(q);c.forEach(this.appConfig.widgetOnScreen.widgets,function(v){v.isController||(!1!==v.inPanel||!0!==v.closeable)&&!0!==v.inPanel&&v.uri||c.some(z,function(B){if(v.id===B.id)return v.position=B.position,!0})},this);g.publish("appConfigChanged",this.getAppConfig(),"onScreenOrderChange",z)},_onAppAttributeChanged:function(q){q=l.reCreateObject(q);b.mixin(this.appConfig,q);this.configLoader.processProxy(this.appConfig);
this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);g.publish("appConfigChanged",this.getAppConfig(),"attributeChange",q)},_onLoadingPageChanged:function(q){q=l.reCreateObject(q);if("backgroundColor"in q)this.appConfig.loadingPage.backgroundColor=q.backgroundColor;else if("backgroundImage"in q){var z=this.appConfig.loadingPage.backgroundImage||{};this.appConfig.loadingPage.backgroundImage=b.mixin(z,q.backgroundImage)}else"loadingGif"in q&&(z=this.appConfig.loadingPage.loadingGif||
{},this.appConfig.loadingPage.loadingGif=b.mixin(z,q.loadingGif));this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);g.publish("appConfigChanged",this.getAppConfig(),"loadingPageChange",q)},_onTemplateConfigChanged:function(q){q=l.reCreateObject(q);this.appConfig.templateConfig=q;this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);g.publish("appConfigChanged",this.getAppConfig(),"templateConfigChange",q)},_onLayoutDefinitionChanged:function(q){q=
l.reCreateObject(q);l.isEqual(this.appConfig.layoutDefinition,q.layoutDefinition)||(this.appConfig.layoutDefinition=q.layoutDefinition,this.appConfig.widgetOnScreen.groups=l.handleGridLayoutOnScreenGroupChange(this.appConfig.widgetOnScreen.groups,q.groupIds),this.configLoader.addNeedValues(this.appConfig),this._addDefaultValues(this.appConfig),g.publish("appConfigChanged",this.getAppConfig(),"layoutDefinitionChange",q.layoutDefinition))},_onSceneViewChanged:function(q){q=l.reCreateObject(q);q.itemId&&
q.itemId!==this.appConfig.map.itemId&&this.appConfig.map.mapOptions&&l.deleteMapOptions(this.appConfig.map.mapOptions);b.mixin(this.appConfig.map,q);this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);g.publish("appConfigChanged",this.getAppConfig(),"mapChange",q)},_onMapOptionsChanged:function(q){q=l.reCreateObject(q);this.appConfig.map.mapOptions||(this.appConfig.map.mapOptions={});b.mixin(this.appConfig.map.mapOptions,q);g.publish("appConfigChanged",this.getAppConfig(),
"mapOptionsChange",q)},_onThemeChanged:function(q){this._getAppConfigFromTheme(q).then(b.hitch(this,function(z){this.appConfig=z;g.publish("appConfigChanged",this.getAppConfig(),"themeChange",q.getName())}))},_onLayoutChanged:function(q){this.appConfig=l.mixinAppConfigPosition(this.appConfig,q.layoutConfig);this.appConfig.layoutDefinition=q.layoutConfig.layoutDefinition;this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);this._addDefaultPanelAndPosition(this.appConfig);
g.publish("appConfigChanged",this.getAppConfig(),"layoutChange",q.name)},_onStyleChanged:function(q){this.appConfig.theme.styles=this._genStyles(this.appConfig.theme.styles,q.name);q.isCustom?this.appConfig.theme.customStyles={mainBackgroundColor:q.styleColor}:(delete this.appConfig.theme.customStyles,delete this.appConfig.titleColor,this.appConfig.theme.sharedTheme={isPortalSupport:this.appConfig.theme.sharedTheme.isPortalSupport,useHeader:!1,useLogo:!1});g.publish("appConfigChanged",this.getAppConfig(),
"styleChange",q.name)},_onSharedThemeChanged:function(q){var z=this.appConfig.theme.sharedTheme;q=l.reCreateObject(q);q.useHeader&&!z.useHeader&&(this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?(this.appConfig.theme.customStyles={mainBackgroundColor:this.portalSelf.portalProperties.sharedTheme.header.background},this.appConfig.titleColor=this.portalSelf.portalProperties.sharedTheme.header.text,this._onAppAttributeChanged({titleColor:this.appConfig.titleColor})):console.error("Portal does not support sharedTheme."));
!q.useHeader&&z.useHeader&&(delete this.appConfig.titleColor,this._onAppAttributeChanged({titleColor:this.appConfig.titleColor}));q.useLogo&&!z.useLogo&&(this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?(this.appConfig.logo=this.portalSelf.portalProperties.sharedTheme.logo&&this.portalSelf.portalProperties.sharedTheme.logo.small?this.portalSelf.portalProperties.sharedTheme.logo.small:"images/app-logo.png",this.appConfig.logoLink=this.portalSelf.portalProperties.sharedTheme.logo.link,
this._onAppAttributeChanged({logo:this.appConfig.logo,logoLink:this.appConfig.logoLink})):console.error("Portal does not support sharedTheme."));!q.useLogo&&z.useLogo&&this._onAppAttributeChanged({logo:this.appConfig.logo});b.mixin(z,q);g.publish("appConfigChanged",this.getAppConfig(),"sharedThemeChange",q)},_onSyncExtent:function(q){g.publish("syncExtent",q)},_genStyles:function(q,z){var v=[];v.push(z);c.forEach(q,function(B){0>v.indexOf(B)&&v.push(B)});return v},_getAppConfigFromTheme:function(q){var z=
new x,v=[],B=this.getAppConfig().getCleanConfig();B.mode=this.urlParams.mode;c.forEach(B.widgetPool.groups,function(C){delete C.panel},this);if(q.appConfig){var A=b.clone(q.appConfig);A.map=B.map;A.map.position=q.appConfig.map.position;this._copyPoolToThemePool(B,A);A.links=B.links;A.title=B.title;A.subtitle=B.subtitle;A.logo=B.logo}else{var E=q.getCurrentLayout();v=q.getCurrentStyle();A=b.clone(B);E=b.clone(E.layoutConfig);A.widgetOnScreen=E.widgetOnScreen;E.widgetPool&&(c.forEach(E.widgetPool.widgets,
function(C){C.isPreconfiguredInTheme=!0}),c.forEach(E.widgetPool.groups,function(C){C.isPreconfiguredInTheme=!0}));this._copyPoolToThemePool(B,E);A.widgetPool=E.widgetPool;E.map&&E.map.position&&(A.map.position=E.map.position);A.mobileLayout=E.mobileLayout;A.layoutDefinition=E.layoutDefinition;v=this._genStyles(c.map(q.getStyles(),function(C){return C.name}),v.name);A.theme={name:q.getName(),styles:v,version:q.getVersion()};this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?
(A.theme.sharedTheme={useHeader:!0,useLogo:!0,isPortalSupport:!0},A.theme.customStyles={mainBackgroundColor:this.portalSelf.portalProperties.sharedTheme.header.background}):(A.theme.sharedTheme={useHeader:!1,useLogo:!1,isPortalSupport:!1},A.theme.customStyles={mainBackgroundColor:""});A.titleColor=B.titleColor;A.logoLink=B.logoLink}this.configLoader.addNeedValues(A);this.configLoader.loadWidgetsManifest(A).then(b.hitch(this,function(){this._addDefaultValues(A);z.resolve(A)}));return z},_copyPoolToThemePool:function(q,
z){var v=q.widgetPool;z.widgetPool||(z.widgetPool={});q=z.widgetPool;var B=c.filter(q.widgets,function(D){if(D.isPreconfiguredInTheme||!c.some(v.widgets,function(F){return F.name===D.name}))return!0}),A=c.filter(q.groups,function(D){return D.isPreconfiguredInTheme}),E=c.filter(v.widgets,function(D){return!D.isPreconfiguredInTheme}),C=c.filter(v.groups,function(D){return!D.isPreconfiguredInTheme});E=this._getPoolWidgetsWithoutDuplicated(E,z.widgetOnScreen.widgets||[]);q.widgets=E.concat(B);q.groups=
C.concat(A)},_getPoolWidgetsWithoutDuplicated:function(q,z){for(var v=b.clone(q),B=this.getAppConfig(),A=q.length-1;0<=A;A--)for(var E=z.length-1;0<=E;E--)if(z[E].uri){var C=z[E].name;C||(C=l.getWidgetNameFromUri(z[E].uri));var D=B.getConfigElementById(q[A].id);q[A]&&q[A].name===C&&!1===D.supportMultiInstance&&(console.log("Widget",q[A].name,"is not copied to new theme because this widget exists in new theme."),v.splice(A,1))}return v},_onAppConfigSet:function(q){q=l.reCreateObject(q);window.appInfo.isRunInMobile=
this._isRunInMobile();this.configLoader.processProxy(q);this.configLoader.addNeedValues(q);this._addDefaultValues(q);k.setPortalUrl(q.portalUrl);window.portalUrl=q.portalUrl;this.appConfig?(q.map.itemId&&q.map.itemId!==this.appConfig.map.itemId&&l.deleteMapOptions(q.map.mapOptions),this.appConfig=q,g.publish("appConfigChanged",this.getAppConfig(),"resetConfig",q)):(this.appConfig=q,y.getPortal(q.portalUrl).loadSelfInfo().then(b.hitch(this,function(z){this.portalSelf=z;g.publish("appConfigLoaded",
this.getAppConfig())})))},_addDefaultValues:function(q){this._addDefaultPortalUrl(q);this._addDefaultGeometryService(q);this._addDefaultStyle(q);this._addDefaultMap(q);this._addDefaultVisible(q);this._addDefaultSharedTheme(q);"undefined"===typeof q.widgetOnScreen&&(q.widgetOnScreen={});"undefined"===typeof q.widgetPool&&(q.widgetPool={});this._addDefaultPanelAndPosition(q);this._addDefaultOfWidgetGroup(q);(q.widgetPool.widgets&&0<q.widgetPool.widgets.length&&void 0===q.widgetPool.widgets[0].index||
q.widgetPool.groups&&0<q.widgetPool.groups.length&&void 0===q.widgetPool.groups[0].index)&&this._addIndexForWidgetPool(q);return q},_addDefaultPortalUrl:function(q){"undefined"===typeof q.portalUrl&&(q.portalUrl="http://www.arcgis.com/");q.portalUrl&&"/"!==q.portalUrl.substr(q.portalUrl.length-1)&&(q.portalUrl+="/")},_addDefaultGeometryService:function(q){var z=q&&q.geometryService;z=z&&"string"===typeof z&&b.trim(z)?b.trim(z):this.portalSelf.helperServices.geometry.url;q.geometryService=z;p.geometryService=
new h(q.geometryService);l.setGlobalGeometryService(q.geometryService)},_addDefaultStyle:function(q){!q.theme||q.theme.styles&&0!==q.theme.styles.length||(q.theme.styles=["default"])},_addDefaultMap:function(q){q.map.id="map";"undefined"===typeof q.map["3D"]&&"undefined"===typeof q.map["2D"]&&(q.map["2D"]=!0);"undefined"===typeof q.map.position&&(q.map.position={left:0,right:0,top:0,bottom:0});"undefined"===typeof q.map.portalUrl&&(q.map.portalUrl=q.portalUrl)},_addDefaultVisible:function(q){l.visitElement(q,
function(z){void 0===z.visible&&(z.visible=!0)})},_addDefaultSharedTheme:function(q){q.theme.sharedTheme?("undefined"===typeof q.theme.sharedTheme.useHeader&&(q.theme.sharedTheme.useHeader=!1),"undefined"===typeof q.theme.sharedTheme.useLogo&&(q.theme.sharedTheme.useLogo=!1)):q.theme.sharedTheme={useHeader:!1,useLogo:!1}},_addDefaultPanelAndPosition:function(q){this._addOnScreenDefaultPanelAndPosition(q);this._addPoolDefaultPanelAndPosition(q)},_addOnScreenDefaultPanelAndPosition:function(q){var z;
if(q=q.widgetOnScreen){var v=q.panel&&q.panel.positionRelativeTo?q.panel.positionRelativeTo:"map";"undefined"===typeof q.panel||"undefined"===typeof q.panel.uri?q.panel={uri:"jimu/OnScreenWidgetPanel",position:{relativeTo:v}}:"undefined"===typeof q.panel.position?q.panel.position={relativeTo:v}:"undefined"===typeof q.panel.position.relativeTo&&(q.panel.position.relativeTo=v);if(q.widgets)for(v=0;v<q.widgets.length;v++)q.widgets[v].position||(q.widgets[v].position={}),q.widgets[v].position.relativeTo||
(q.widgets[v].position.relativeTo=q.widgets[v]&&q.widgets[v].positionRelativeTo?q.widgets[v].positionRelativeTo:"map"),!0!==q.widgets[v].inPanel||q.widgets[v].panel||(q.widgets[v].panel=b.clone(q.panel),q.widgets[v].panel.position=q.widgets[v].position,q.widgets[v].panel.position.relativeTo=q.widgets[v].position.relativeTo);if(q.groups)for(v=0;v<q.groups.length;v++)for(q.groups[v].panel||(q.groups[v].panel=q.panel),q.groups[v].panel&&!q.groups[v].panel.position&&(q.groups[v].panel.position={}),q.groups[v].panel.position.relativeTo||
(q.groups[v].panel.position.relativeTo=q.groups[v].panel.positionRelativeTo?q.groups[v].panel.positionRelativeTo:"map"),q.groups[v].widgets||(q.groups[v].widgets=[]),z=0;z<q.groups[v].widgets.length;z++)q.groups[v].widgets[z].panel=q.groups[v].panel}},_addPoolDefaultPanelAndPosition:function(q){var z,v=q.widgetPool;if(v){var B=v.panel&&v.panel.positionRelativeTo?v.panel.positionRelativeTo:"map";"undefined"===typeof v.panel||"undefined"===typeof v.panel.uri?v.panel={uri:"jimu/OnScreenWidgetPanel",
position:{relativeTo:B}}:"undefined"===typeof v.panel.position?v.panel.position={relativeTo:B}:"undefined"===typeof v.panel.position.relativeTo&&(v.panel.position.relativeTo=B);if(v.groups)for(B=0;B<v.groups.length;B++)for(v.groups[B].panel?v.groups[B].panel.position.relativeTo||(v.groups[B].panel.position.relativeTo=v.groups[B].panel.positionRelativeTo?v.groups[B].panel.positionRelativeTo:"map"):v.groups[B].panel=v.panel,v.groups[B].widgets||(v.groups[B].widgets=[]),z=0;z<v.groups[B].widgets.length;z++)v.groups[B].widgets[z].panel=
v.groups[B].panel;if(v.widgets)for(B=0;B<v.widgets.length;B++)!1===v.widgets[B].inPanel?(z=v.widgets[B].positionRelativeTo?v.widgets[B].positionRelativeTo:"map",v.widgets[B].position)?v.widgets[B].position.relativeTo||(v.widgets[B].position.relativeTo=z):v.widgets[B].position={relativeTo:z}:v.widgets[B].panel||(v.widgets[B].panel=q.widgetPool.panel)}},_addDefaultOfWidgetGroup:function(q){l.visitElement(q,b.hitch(this,function(z,v){z.isOnScreen=v.isOnScreen;z.widgets?(z.gid=z.id,1===z.widgets.length?
(z.label||(z.label=z.widgets[0].label?z.widgets[0].label:"Group"),z.icon||(z.icon=z.widgets[0].uri?this._getDefaultIconFromUri(z.widgets[0].uri):"jimu.js/images/group_icon.png")):(z.icon=z.icon?z.icon:"jimu.js/images/group_icon.png",z.label=z.label?z.label:"Group_"+v.index)):(z.gid=v.groupId,z.uri&&l.processWidgetSetting(z))}))},_getDefaultIconFromUri:function(q){q=q.split("/");q.pop();return q.join("/")+"/images/icon.png"},_addIndexForWidgetPool:function(q){var z=0,v,B;if(q.widgetPool.widgets)for(v=
0;v<q.widgetPool.widgets.length;v++)q.widgetPool.widgets[v].index=z,z++;if(q.widgetPool.groups)for(v=0;v<q.widgetPool.groups.length;v++)for(q.widgetPool.groups[v].index=z,z++,B=0;B<q.widgetPool.groups[v].widgets.length;B++)q.widgetPool.groups[v].widgets[B].index=B}});t.getInstance=function(q){null===u?u=new t(q):q&&(u.urlParams=q);window.getAppConfig=b.hitch(u,u.getAppConfig);return u};return t})},"dojo/_base/html":function(){define("./kernel ../dom ../dom-style ../dom-attr ../dom-prop ../dom-class ../dom-construct ../dom-geometry".split(" "),
function(a,b,c,d,g,x,w,l){a.byId=b.byId;a.isDescendant=b.isDescendant;a.setSelectable=b.setSelectable;a.getAttr=d.get;a.setAttr=d.set;a.hasAttr=d.has;a.removeAttr=d.remove;a.getNodeProp=d.getNodeProp;a.attr=function(n,f,e){return 2==arguments.length?d["string"==typeof f?"get":"set"](n,f):d.set(n,f,e)};a.hasClass=x.contains;a.addClass=x.add;a.removeClass=x.remove;a.toggleClass=x.toggle;a.replaceClass=x.replace;a._toDom=a.toDom=w.toDom;a.place=w.place;a.create=w.create;a.empty=function(n){w.empty(n)};
a._destroyElement=a.destroy=function(n){w.destroy(n)};a._getPadExtents=a.getPadExtents=l.getPadExtents;a._getBorderExtents=a.getBorderExtents=l.getBorderExtents;a._getPadBorderExtents=a.getPadBorderExtents=l.getPadBorderExtents;a._getMarginExtents=a.getMarginExtents=l.getMarginExtents;a._getMarginSize=a.getMarginSize=l.getMarginSize;a._getMarginBox=a.getMarginBox=l.getMarginBox;a.setMarginBox=l.setMarginBox;a._getContentBox=a.getContentBox=l.getContentBox;a.setContentSize=l.setContentSize;a._isBodyLtr=
a.isBodyLtr=l.isBodyLtr;a._docScroll=a.docScroll=l.docScroll;a._getIeDocumentElementOffset=a.getIeDocumentElementOffset=l.getIeDocumentElementOffset;a._fixIeBiDiScrollLeft=a.fixIeBiDiScrollLeft=l.fixIeBiDiScrollLeft;a.position=l.position;a.marginBox=function(n,f){return f?l.setMarginBox(n,f):l.getMarginBox(n)};a.contentBox=function(n,f){return f?l.setContentSize(n,f):l.getContentBox(n)};a.coords=function(n,f){a.deprecated("dojo.coords()","Use dojo.position() or dojo.marginBox().");n=b.byId(n);var e=
c.getComputedStyle(n);e=l.getMarginBox(n,e);n=l.position(n,f);e.x=n.x;e.y=n.y;return e};a.getProp=g.get;a.setProp=g.set;a.prop=function(n,f,e){return 2==arguments.length?g["string"==typeof f?"get":"set"](n,f):g.set(n,f,e)};a.getStyle=c.get;a.setStyle=c.set;a.getComputedStyle=c.getComputedStyle;a.__toPixelValue=a.toPixelValue=c.toPixelValue;a.style=function(n,f,e){switch(arguments.length){case 1:return c.get(n);case 2:return c["string"==typeof f?"get":"set"](n,f)}return c.set(n,f,e)};return a})},"jimu/utils":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/sniff dojo/_base/config dojo/io-query dojo/query dojo/NodeList-traverse dojo/Deferred dojo/promise/all dojo/on dojo/json dojo/cookie dojo/number dojo/date/locale dojo/i18n!dojo/cldr/nls/number dojox/encoding/base64 esri/kernel esri/config esri/geometry/SpatialReference esri/geometry/Extent esri/geometry/Multipoint esri/geometry/Polyline esri/geometry/Polygon esri/geometry/support/webMercatorUtils esri/tasks/GeometryService esri/tasks/support/ProjectParameters esri/core/urlUtils esri/request ./shared/utils".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E,C,D,F,G,J){function I(H,Q){var W=H.match(/url\([^)]+\)/gi),V;if(null===W||""===Q)return H;for(V=0;V<W.length;V++){var Y=W[V].match(/(url\(["|']?)(.*)((?:['|"]?)\))/i);if(4<=Y.length){var aa=Y[2];/^data:image\/.*;/.test(aa)||(Q.endWith("/")||(Q+="/"),H=H.replace(Y[1]+aa+Y[3],Y[1]+Q+aa+Y[3]))}}return H}function O(H,Q){var W=Array.isArray(Q),V=W&&[]||{};W?(H=H||[],V=V.concat(H),Q.forEach(function(Y,aa){"undefined"===typeof H[aa]?V[aa]=Y:"object"===
typeof Y?V[aa]=O(H[aa],Y):-1===H.indexOf(Y)&&V.push(Y)})):(H&&"object"===typeof H&&Object.keys(H).forEach(function(Y){V[Y]=H[Y]}),Object.keys(Q).forEach(function(Y){V[Y]="object"===typeof Q[Y]&&Q[Y]?H[Y]?O(H[Y],Q[Y]):Q[Y]:Q[Y]}));return V}function P(H){var Q={};var W=H.indexOf("/");H.substring(0,W);W=H.substring(0,H.lastIndexOf("/")+1);Q.folderUrl=require(L.getRequireConfig()).toUrl(W);Q.amdFolder=W;Q.url=Q.folderUrl;if(/^http(s)?:\/\//.test(H)||/^\/\//.test(H))Q.isRemote=!0;return Q}function K(H){H.panels.forEach(function(Q){Q.uri=
"panels/"+Q.name+"/Panel.js"});H.styles.forEach(function(Q){Q.uri="styles/"+Q.name+"/style.css"});H.layouts.forEach(function(Q){Q.uri="layouts/"+Q.name+"/config.json";Q.icon="layouts/"+Q.name+"/icon.png";Q.RTLIcon="layouts/"+Q.name+"/icon_rtl.png"})}function M(H,Q){var W=H.map(function(aa){return aa.id});b.forEach(Q,function(aa){0>W.indexOf(aa)&&H.push({id:aa,widgets:[]})},this);var V=[];H=b.filter(H,function(aa){return 0>Q.indexOf(aa.id)?(V.push(aa),!1):!0},this);if(0===H.length)return[];var Y=H[H.length-
1];b.forEach(V,function(aa){Y.widgets=Y.widgets.concat(aa.widgets)},this);return H=H.sort(function(aa,X){return Q.indexOf(aa.id)-Q.indexOf(X.id)})}function U(H,Q,W){function V(aa,X){return a.isArray(aa[X.key])?aa[X.key][X.index]:aa[X.key]}Q=function(aa){var X=[];aa.split("_").forEach(function(ba){var ha=!1;"--"===ba.slice(ba.length-2)&&(ha=!0,ba=ba.slice(0,ba.length-2));var ka=ba.search(/\[[0-9]+\]/);-1===ka&&(ka=ba.length);X.push({key:ba.slice(0,ka),index:Number(ba.slice(ka+1,-1)),deleteFlag:ha})});
return X}(Q);for(var Y=1;Y<Q.length-1;Y++)if(H=V(H,Q[Y]),!H)return;if(Q[Q.length-1].deleteFlag)!0===W&&(a.isArray(H[Q[Q.length-1].key])?delete H[Q[Q.length-1].key][Q[Q.length-1].index]:delete H[Q[Q.length-1].key]);else if(a.isArray(H[Q[Q.length-1].key])){if(void 0===W)return H[Q[Q.length-1].key][Q[Q.length-1].index];H[Q[Q.length-1].key][Q[Q.length-1].index]=W}else{if(void 0===W)return H[Q[Q.length-1].key];H[Q[Q.length-1].key]=W}}function R(H,Q,W){function V(ba){ba=L.template.getSearchRange(Q,ba,"]");
var ha=Q.slice(ba.firstPos,ba.lastPos);return-1!==ba.firstPos?(ha=Q.slice(ba.firstPos+ha.indexOf("[")+1,ba.lastPos-1),ba=Q.slice(ba.lastPos+1),(ha=L.getConfigElementById(H,ha))?{object:ha,key:"section_"+ba,state:"isSection"}:{state:"deleted"}):{state:"isNotSection"}}var Y=H,aa=Q=Q.replace(/\//g,"_"),X=V("groups\\[.+\\]");if("deleted"!==X.state&&("isSection"===X.state&&(Y=X.object,aa=X.key),X=V("widgets\\[.+\\]"),"delete"!==X.state))return"isSection"===X.state&&(Y=X.object,aa=X.key),U(Y,aa,W)}var L=
{},N={geometryService:"http://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer"};a.mixin(L,J);window.atob||(window.atob=function(H){H=m.decode(H);for(var Q="",W=0,V=H.length;W<V;W++)Q+=String.fromCharCode(H[W]);return Q});window.btob||(window.btob=function(H){for(var Q=[],W=0,V=H.length;W<V;W++)Q.push(String.charCodeAt(H[W]));return m.encode(Q)});var T=[];require.on("error",function(H){b.forEach(T,function(Q){H.info[0]&&-1<H.info[0].indexOf(Q.resKey)&&Q.def.reject(H);for(var W in H.info)-1<
W.indexOf(Q.resKey)&&Q.def.reject(H)})});L.checkError=function(H,Q){T.push({resKey:H,def:Q})};L.replacePlaceHolder=function(H,Q){var W=k.stringify(H),V=W.match(/\$\{(\w)+\}/g);if(null===V)return H;for(H=0;H<V.length;H++){var Y=V[H].match(/(\w)+/g)[0];Q[Y]&&(W=W.replace(V[H],Q[Y]))}return k.parse(W)};L.changeUnit=function(H){var Q=Math.abs(H);H=Math.floor(Q);var W=Math.floor(60*(Q-H));Q=(60*(60*(Q-H)-W)).toFixed(2);return H+"\u00b0"+(10>W?"0"+W:W)+"'"+(10>Q?"0"+Q:Q)+'"'};L.formatTime=function(H){var Q=
H/1E3;H=Math.floor(Q/60);Q=Number(Q-60*H).toFixed(1);return(10>H?"0"+H:H)+":"+(10>Q?"0"+Q:Q)};L.parseTime=function(H){var Q=/(\d{2,}):(\d{2})\.(\d{1})/;if(!Q.test(H))return console.log("wrong time format."),-1;H=H.match(Q);return 1E3*(60*parseInt(H[1],10)+parseInt(H[2],10)+parseInt(H[3],10)/10)};L.preloadImg=function(H,Q){var W=[];W="string"===typeof H?[H]:H;b.forEach(W,function(V){(new Image).src=Q?Q+V:V})};L.setWABLogoDefaultAlt=function(H){if(H){H=w("img",H);for(var Q=["img_1412759111499","img_1545621838463",
"img_1560482577021"],W=0,V=H.length;W<V;W++){var Y=H[W];-1<Q.indexOf(c.getAttr(Y,"id"))&&!c.getAttr(Y,"alt")&&c.setAttr(Y,"alt","ArcGIS Web AppBuilder.png")}}};var S=null;L.getImagesSize=function(H){var Q=new n;if(!H||0!==H.indexOf("http"))return Q.reject(),Q;null===S&&(S=c.create("img",{id:"__test-image-size",style:{position:"absolute",left:"-9999px",top:"-9999px"}},document.body));var W=e(S,"load",function(){clearTimeout(V);V=null;W.remove();var Y=c.getContentBox(S);1===Y.w&&1===Y.h||0===Y.w||0===
Y.h?Q.reject():Q.resolve([Y.w,Y.h])},{}),V=setTimeout(function(){clearTimeout(V);V=null;Q.reject()},5E3);c.setAttr(S,"src",H);return Q};L.getPositionStyle=function(H){var Q={};if(!H)return Q;H=a.clone(H);if(window.isRTL){if("undefined"!==typeof H.left&&"undefined"!==typeof H.right){var W=H.left;H.left=H.right;H.right=W}else"undefined"!==typeof H.left?(H.right=H.left,delete H.left):"undefined"!==typeof H.right&&(H.left=H.right,delete H.right);"undefined"!==typeof H.paddingLeft&&"undefined"!==typeof H.paddingRight?
(W=H.paddingLeft,H.paddingLeft=H.paddingRight,H.paddingRight=W):"undefined"!==typeof H.paddingLeft?(H.paddingRight=H.paddingLeft,delete H.paddingLeft):"undefined"!==typeof H.paddingRight&&(H.paddingLeft=H.paddingRight,delete H.paddingRight);"undefined"!==typeof H.marginLeft&&"undefined"!==typeof H.marginRight?(W=H.marginLeft,H.marginLeft=H.marginRight,H.marginRight=W):"undefined"!==typeof H.marginLeft?(H.marginRight=H.marginLeft,delete H.marginLeft):"undefined"!==typeof H.marginRight&&(H.marginLeft=
H.marginRight,delete H.marginRight)}W="left top right bottom width height padding paddingLeft paddingRight paddingTop paddingBottom margin marginLeft marginRight marginTop marginBottom".split(" ");for(var V=0;V<W.length;V++){var Y=W[V];"number"===typeof H[Y]?Q[Y]=H[Y]+"px":"undefined"!==typeof H[Y]?Q[Y]=H[Y]:"padding"===Y.substr(0,7)||"margin"===Y.substr(0,7)?Q[Y]=0:Q[Y]="auto"}Q.zIndex="undefined"===typeof H.zIndex?"auto":H.zIndex;return Q};L.isEqual=function(H,Q){function W(aa,X){var ba;if(null===
aa&&null===X||"undefined"===typeof aa&&"undefined"===typeof X)return!0;if(null===aa&&null!==X||null===X&&null!==aa||"undefined"===typeof aa&&"undefined"!==typeof X||"undefined"===typeof X&&"undefined"!==typeof aa)return!1;if(isNaN(aa)&&isNaN(X)&&"number"===typeof aa&&"number"===typeof X||aa===X)return!0;if("function"===typeof aa&&"function"===typeof X||aa instanceof Date&&X instanceof Date||aa instanceof RegExp&&X instanceof RegExp||aa instanceof String&&X instanceof String||aa instanceof Number&&
X instanceof Number)return aa.toString()===X.toString();if(-1<V.indexOf(aa)||-1<Y.indexOf(X))return!1;if(null!==X){for(ba in X)if(X.hasOwnProperty(ba)!==aa.hasOwnProperty(ba)||typeof X[ba]!==typeof aa[ba])return!1;for(ba in aa){if(X.hasOwnProperty(ba)!==aa.hasOwnProperty(ba)||typeof X[ba]!==typeof aa[ba])return!1;switch(typeof aa[ba]){case "object":case "function":V.push(aa);Y.push(X);if(!W(aa[ba],X[ba]))return!1;V.pop();Y.pop();break;default:if(aa[ba]!==X[ba])return!1}}}return!0}var V=[];var Y=[];
return W(H,Q)?!0:!1};L.getUriInfo=P;L.file={loadFileAPI:function(){var H=new n;H.resolve();return H},supportHTML5:function(){return window.File&&window.FileReader&&window.FileList&&window.Blob?!0:!1},supportFileAPI:function(){return d("safari")&&6>d("safari")?!1:window.FileAPI&&window.FileAPI.readAsDataURL?!0:!1},isEnabledFlash:function(){var H=null;if(document.all)try{H=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(Q){H=null}else navigator.plugins&&0<navigator.plugins.length&&(H=navigator.plugins["Shockwave Flash"]);
return!!H},containSeparator:function(H){return 0<=H.indexOf("/")?!0:0<=H.indexOf("\\")?!0:!1},getNameFromPath:function(H){var Q="";Q=0<=H.indexOf("/")?"/":"\\";H=H.split(Q);return 0<H.length?H[H.length-1]:null},getFolderFromPath:function(H){return H.substr(0,H.length-L.file.getNameFromPath(H).length)},readFile:function(H,Q,W,V){if(this.supportHTML5()){var Y=H.target.files[0];Y&&(Y.type.match(Q)?Y.size>=W?V({errCode:"exceed"}):(H=new FileReader,H.onload=function(X){V(null,Y.name,X.target.result)},
H.readAsDataURL(Y)):V({errCode:"invalidType"}))}else if(this.supportFileAPI()){var aa=window.FileAPI.getFiles(H);aa[0].type.match(Q)?aa[0].size>=W?V({errCode:"exceed"}):window.FileAPI.readAsDataURL(aa[0],function(X){X&&X.result?V(null,aa[0].name,X.result):V({errCode:"readError"})}):V({errCode:"invalidType"})}}};L.processWidgetSetting=function(H){if(!H.uri)return H;a.mixin(H,P(H.uri));H.icon||(H.icon=H.amdFolder+"images/icon.png");H.thumbnail||(H.thumbnail=H.amdFolder+"images/thumbnail.png");return H};
L.getRequireConfig=function(){if(jimuConfig){var H=[];jimuConfig.widgetsPackage&&(H=H.concat(jimuConfig.widgetsPackage));jimuConfig.themesPackage&&(H=H.concat(jimuConfig.themesPackage));jimuConfig.configsPackage&&(H=H.concat(jimuConfig.configsPackage));return{packages:H}}return{}};L.getTypeByGeometryType=function(H){var Q="",W="esriGeometryLine esriGeometryCircularArc esriGeometryEllipticArc esriGeometryBezier3Curve esriGeometryPath esriGeometryPolyline".split(" "),V=["esriGeometryRing","esriGeometryPolygon",
"esriGeometryEnvelope"];0<=["esriGeometryPoint","esriGeometryMultipoint"].indexOf(H)?Q="point":0<=W.indexOf(H)?Q="polyline":0<=V.indexOf(H)&&(Q="polygon");return Q};L.getSymbolTypeByGeometryType=function(H){var Q=null;H=L.getTypeByGeometryType(H);"point"===H?Q="marker":"polyline"===H?Q="line":"polygon"===H&&(Q="fill");return Q};L.getServices=function(){return N};L.getArcGISDefaultGeometryService=function(){return new C(N.geometryService)};L.restoreToDefaultWebMapExtent=function(H,Q,W){var V=new n;
if(!H||"esri.Map"!==H.declaredClass)return setTimeout(function(){V.reject("Invalid map.")},0),V;Q=Q&&Q.itemInfo;if(!Q)return setTimeout(function(){V.reject("Invalid itemInfo")},0),V;Q=Q.item&&Q.item.extent;if(!Q)return setTimeout(function(){V.reject("Invalid itemInfo.item.extent")}),V;var Y=new q({wkid:4326});Y=new z(Q[0][0],Q[0][1],Q[1][0],Q[1][1],Y);if(4326===parseInt(H.spatialReference.wkid,10))return H.setExtent(Y);if(H.spatialReference.isWebMercator)return Y=E.geographicToWebMercator(Y),H.setExtent(Y);
Q=new D;Q.geometries=[Y];Q.outSR=H.spatialReference;Y=t&&t.defaults&&t.defaults.geometryService;Y&&"esri.tasks.GeometryService"===Y.declaredClass||(W&&"string"===typeof W&&a.trim(W)?(W=a.trim(W),Y=new C(W)):Y=L.getArcGISDefaultGeometryService());Y.project(Q).then(function(aa){if(aa=aa&&aa[0])return H.setExtent(aa);V.reject("Invalid projected geometry.");return V},function(aa){console.error(aa);V.reject(aa);return V});return V};L.getAncestorWindow=function(){for(var H=window;H&&H.parent&&H!==H.parent;)H=
H.parent;return H};L.getAncestorDom=function(H,Q,W){if(H&&1===H.nodeType&&Q&&"function"===typeof Q){var V=100,Y=document.body;W&&("number"===typeof W?(W=parseInt(W,10),0<W&&(V=W)):1===W.nodeType&&(Y=W));for(W=0;H.parentNode&&W<V&&c.isDescendant(H.parentNode,Y);){if(Q(H.parentNode))return H.parentNode;H=H.parentNode;W++}}return null};L.bindClickAndDblclickEvents=function(H,Q,W,V){var Y=null;if(H&&1===H.nodeType&&Q&&"function"===typeof Q&&W&&"function"===typeof W){var aa=200;V&&"number"===typeof V&&
(V=parseInt(V,10),0<V&&(aa=V));var X=0;Y=e(H,"click",function(ba){X++;1===X?setTimeout(function(){1===X&&(X=0,Q(ba))},aa):2===X&&(X=0,W(ba))})}return Y};L.isScrollToBottom=function(H){var Q=c.getContentBox(H);return 1>H.scrollHeight-(H.scrollTop+Q.h)};L.getAllItemTypes=function(){var H=[];H=H.concat(["Web Map","Web Scene","CityEngine Web Scene"]).concat("Feature Service;Map Service;Image Service;KML;WMS;Feature Collection;Feature Collection Template;Geodata Service;Globe Service".split(";")).concat(["Geometry Service",
"Geocoding Service","Network Analysis Service","Geoprocessing Service"]).concat(["Web Mapping Application","Mobile Application","Code Attachment","Operations Dashboard Add In","Operation View"]).concat("Symbol Set;Color Set;Shapefile;CSV;Service Definition;Document Link;Microsoft Word;Microsoft PowerPoint;Microsoft Excel;PDF;Image;Visio Document".split(";"));return H=H.concat("Map Document;Map Package;Tile Package;ArcPad Package;Explorer Map;Globe Document;Scene Document;Published Map;Map Template;Windows Mobile Package".split(";")).concat(["Layer",
"Layer Package","Explorer Layer"]).concat(["Geoprocessing Package","Geoprocessing Sample","Locator Package","Rule Package"]).concat("Workflow Manager Package;Desktop Application;Desktop Application Template;Code Sample;Desktop Add In;Explorer Add In".split(";"))};L.getItemQueryStringByTypes=function(H){var Q="",W=L.getAllItemTypes();if(H&&0<H.length&&0<H.length){var V="";b.forEach(H,function(Y,aa){V+=' type:"'+Y+'" ';aa!==H.length-1&&(V+=" OR ")});Q=" ( "+V+" ) ";W=H.concat(W);W=b.filter(W,function(Y){return b.every(H,
function(aa){return 0>aa.toLowerCase().indexOf(Y.toLowerCase())})});b.forEach(W,function(Y){Q+=' -type:"'+Y+'" '})}return Q};L.getItemQueryStringByTypeKeywords=function(H){var Q="";H&&0<H.length&&(Q=' typekeywords:"'+H.join(",")+'" ');return Q};L.isNotEmptyString=function(H,Q){var W=H&&"string"===typeof H;return W?Q?W&&a.trim(H):!0:!1};L.isValidNumber=function(H){return"number"===typeof H&&!isNaN(H)};L.isObject=function(H){return H&&"object"===typeof H};L.getRandomString=function(){var H=Math.random().toString();
return H=H.slice(2,H.length)};L._getDomainsByServerName=function(H){var Q=H.split("."),W=Q.length;return b.map(Q,a.hitch(this,function(V,Y){V=Q.slice(Y,W);var aa="",X=V.length-1;b.forEach(V,a.hitch(this,function(ba,ha){aa+=ba;ha!==X&&(aa+=".")}));return aa}))};L.removeCookie=function(H,Q){var W=this._getDomainsByServerName(window.location.hostname);b.forEach(W,a.hitch(this,function(V){r(H,null,{expires:-1,path:Q});r(H,null,{expires:-1,path:Q,domain:V});r(H,null,{expires:-1,path:Q,domain:"."+V})}))};
L.isLocaleChanged=function(H,Q){return!H.startWith(Q)};L.hashToObject=function(H){H=H.replace("#","");H=x.queryToObject(H);for(var Q in H)if(H.hasOwnProperty(Q))try{H[Q]=k.parse(H[Q])}catch(W){}return H};L.reCreateObject=function(H){function Q(V){var Y=[];V.forEach(function(aa){Array.isArray(aa)?Y.push(Q(aa)):"object"===typeof aa?Y.push(W(aa)):Y.push(aa)});return Y}function W(V){var Y={},aa;for(aa in V)V.hasOwnProperty(aa)&&(null===V[aa]?Y[aa]=null:Array.isArray(V[aa])?Y[aa]=Q(V[aa]):Y[aa]="object"===
typeof V[aa]?W(V[aa]):V[aa]);return Y}return Array.isArray(H)?Q(H):W(H)};L.setVerticalCenter=function(H){setTimeout(function(){var Q=w(".jimu-vcenter-text",H),W,V;b.forEach(Q,function(Y){W=c.getContentBox(Y).h;c.setStyle(Y,{lineHeight:W+"px"})},this);Q=w(".jimu-vcenter",H);b.forEach(Q,function(Y){W=c.getContentBox(Y).h;V=c.getContentBox(w(Y).parent()[0]).h;c.setStyle(Y,{marginTop:(V-W)/2+"px"})},this)},10)};L.merge=O;L.loadStyleLink=function(H,Q,W){var V=new n,Y=require(L.getRequireConfig()).toUrl(Q);
if(require.cache["url:"+Y]){var aa=require.cache["url:"+Y];var X=Y.split("/").pop();Y=Y.substr(0,Y.length-X.length);aa=I(aa,Y);H=W?c.create("style",{id:H,type:"text/css"},c.byId(W),"before"):c.create("style",{id:H,type:"text/css"},document.getElementsByTagName("head")[0]);H.styleSheet&&!H.sheet?H.styleSheet.cssText=aa:H.appendChild(c.toDom(aa));V.resolve("load");return V}aa=W?c.create("link",{id:H,rel:"stylesheet",type:"text/css",href:Y},c.byId(W),"before"):c.create("link",{id:H,rel:"stylesheet",
type:"text/css",href:Y},document.getElementsByTagName("head")[0]);e(aa,"load",function(){V.resolve("load")});var ba=setInterval(function(){var ha;if(b.some(document.styleSheets,function(ka){if(ka.href&&ka.href.substr(ka.href.indexOf(Q),ka.href.length)===Q)return ha=ka,!0}))try{!V.isFulfilled()&&(ha.cssRules&&ha.cssRules.length||ha.rules&&ha.rules.length)&&V.resolve("load"),clearInterval(ba)}catch(ka){}},50);return V};L.changeLocation=function(H){window.history.pushState&&window.history.pushState({path:H},
"",H)};L.urlToObject=function(H){var Q=null;-1===H.indexOf("#")?(Q=F.urlToObject(H),Q.hash=null):(H=H.split("#"),Q=F.urlToObject(H[0]),Q.hash=H[1]?-1<H[1].indexOf("\x3d")?x.queryToObject(H[1]):H[1]:null);return Q};L.addManifestProperies=function(H){H.icon=H.url+"images/icon.png";"theme"===H.category?K(H):("undefined"!==typeof H["2D"]&&(H.support2D=H["2D"]),"undefined"!==typeof H["3D"]&&(H.support3D=H["3D"]),"undefined"===typeof H["2D"]&&"undefined"===typeof H["3D"]&&(H.support2D=!0),delete H["2D"],
delete H["3D"],"undefined"===typeof H.properties&&(H.properties={}),J.processWidgetProperties(H))};L.getUniqueValues=function(H,Q){var W=new n;H=H.replace(/\/*$/g,"")+"/generateRenderer";Q=k.stringify({type:"uniqueValueDef",uniqueValueFields:[Q]});G(H,{query:{classificationDef:Q,f:"json"},responseType:"json",callbackParamName:"callback"}).then(a.hitch(this,function(V){var Y=V.data;V=[];(Y=Y&&Y.uniqueValueInfos)&&0<Y.length&&(V=b.map(Y,a.hitch(this,function(aa){return aa.value})));W.resolve(V)}),a.hitch(this,
function(V){W.reject(V)}));return W};L.combineRadioCheckBoxWithLabel=function(H,Q){var W=!1;if(H&&1===H.nodeType&&"input"===H.tagName.toLowerCase()){var V=H.getAttribute("type")||"";V=V.toLowerCase();if("radio"===V||"checkbox"===V)W=!0}V=!1;Q&&1===Q.nodeType&&"label"===Q.tagName.toLowerCase()&&(V=!0);W&&V&&(W=H.getAttribute("id"),W||(W="input_"+L.getRandomString(),H.setAttribute("id",W)),Q.setAttribute("for",W),c.setStyle(Q,"cursor","pointer"))};L.convertExtentToPolygon=function(H){var Q=H.xmin,W=
H.xmax,V=H.ymin,Y=H.ymax;return new A({rings:[[[Q,Y],[W,Y],[W,V],[Q,V],[Q,Y]]],spatialReference:H.toJson()})};L.combineGeometries=function(H){function Q(ia){var ea={points:[],spatialReference:ia[0].spatialReference.toJson()};b.forEach(ia,function(ca){ea.points=ea.points.concat(ca.points)});return new v(ea)}function W(ia){var ea={paths:[],spatialReference:ia[0].spatialReference.toJson()};b.forEach(ia,function(ca){ea.paths=ea.paths.concat(ca.paths)});return new B(ea)}function V(ia){var ea={rings:[],
spatialReference:ia[0].spatialReference.toJson()};b.forEach(ia,function(ca){"polygon"===ca.type?ea.rings=ea.rings.concat(ca.rings):"extent"===ca.type&&(ca=L.convertExtentToPolygon(ca),ea.rings=ea.rings.concat(ca.rings))});return new A(ea)}var Y=null;if(H&&0<H.length)if(1===H.length)Y=H[0];else{for(var aa=null,X=null,ba=null,ha=null,ka=0;ka<H.length;ka++){aa=H[ka];switch(aa.type){case "point":case "multipoint":ha="point";break;case "polyline":ha="polyline";break;case "polygon":case "extent":ha="polygon";
break;default:return null}if(0===ka)ba=ha;else if(ba!==ha)return null;if(ka!==H.length-1&&(X=H[ka+1],!aa.spatialReference.equals(X.spatialReference)))return null}"point"===ha?Y=Q(H):"polyline"===ha?Y=W(H):"polygon"===ha&&(Y=V(H))}return Y};L.isFeaturelayerUrlSupportQuery=function(H,Q){var W=!1,V=/\/featureserver\//gi.test(H);H=/\/mapserver\//gi.test(H);Q=(Q||"").toLowerCase();V?W=0<=Q.indexOf("query"):H&&(W=0<=Q.indexOf("data"));return W};L.isImageServiceSupportQuery=function(H){return 0<=(H||"").toLowerCase().indexOf("catalog")};
L.isStringEndWith=function(H,Q){return H.lastIndexOf(Q)+Q.length===H.length};L.processManifestLabel=function(H,Q){var W=Q.split("-")[0];H.label=H.i18nLabels&&(H.i18nLabels[Q]||H.i18nLabels[W]||H.i18nLabels.defaultLabel)||H.label||H.name;H.layouts&&b.forEach(H.layouts,function(V){var Y="i18nLabels_layout_"+V.name;V.label=H[Y]&&(H[Y][Q]||H[Y].defaultLabel)||V.label||V.name});H.styles&&b.forEach(H.styles,function(V){var Y="i18nLabels_style_"+V.name;V.label=H[Y]&&(H[Y][Q]||H[Y].defaultLabel)||V.label||
V.name})};L.addManifest2WidgetJson=function(H,Q){a.mixin(H,Q.properties);H.name=Q.name;H.label||(H.label=Q.label);H.manifest=Q};L.widgetJson=function(){var H={addManifest2WidgetJson:function(Q,W){a.mixin(Q,W.properties);Q.name=W.name;Q.label||(Q.label=W.label);Q.manifest=W;Q.isRemote=W.isRemote;Q.isRemote&&(Q.itemId=W.itemId);W.featureActions&&(Q.featureActions=W.featureActions);Q.icon||(Q.icon=W.icon);Q.thumbnail||(Q.thumbnail=W.thumbnail);Q.folderUrl=W.folderUrl;Q.amdFolder=W.amdFolder},removeManifestFromWidgetJson:function(Q){if(Q.manifest){for(var W in Q.manifest.properties)Q[W]=
void 0;Q.name=void 0;Q.label=void 0;Q.featureActions=void 0;Q.manifest=void 0}},getUriFromItem:function(Q){return Q.url?H.getFolderUrlFromItem(Q)+"Widget":null},getFolderUrlFromItem:function(Q){if(!Q.url)return null;Q=/manifest\.json$/.test(Q.url)?Q.url.substring(0,Q.url.length-13):/\/$/.test(Q.url)?Q.url:Q.url+"/";"https:"===window.location.protocol&&(Q=Q.replace(/^http:\/\//,"https://"));return Q}};return H}();L.addI18NLabel=function(H){var Q=new n;if(H.i18nLabels)return Q.resolve(H),Q;H.i18nLabels=
{};if(H.properties&&!1===H.properties.hasLocale)return Q.resolve(H),Q;var W="widget"===H.category?"_widgetLabel":"_themeLabel";require(L.getRequireConfig(),["dojo/i18n!"+H.amdFolder+"nls/strings"],function(V){H.i18nLabels[dojoConfig.locale]=V[W];"theme"===H.category&&(H.layouts&&H.layouts.forEach(function(Y){H["i18nLabels_layout_"+Y.name]={};H["i18nLabels_layout_"+Y.name][dojoConfig.locale]=V["_layout_"+Y.name]}),H.styles&&H.styles.forEach(function(Y){H["i18nLabels_style_"+Y.name]={};H["i18nLabels_style_"+
Y.name][dojoConfig.locale]=V["_style_"+Y.name]}));Q.resolve(H)});return Q};L.localizeNumber=function(H,Q){var W=(H.toString().split(".")[1]||"").length,V="";V=Q&&isFinite(Q.places)&&Q.places;V=0<V||0<W?"#,###,###,##0.0"+Array.prototype.join.call({length:0<V?V+1:W},"0"):"#,###,###,##0";W={locale:g.locale,pattern:V};a.mixin(W,Q||{});try{return y.format(H,W)}catch(Y){return console.error(Y),H.toLocaleString()}};L.parseNumber=function(H,Q){var W={locale:g.locale};a.mixin(W,Q||{});try{return y.parse(H,
W)}catch(V){return console.error(V),H}};L.localizeDate=function(H,Q){var W={locale:g.locale,fullYear:!0};a.mixin(W,Q||{});try{return p.format(H,W)}catch(V){return console.error(V),"date"===W.selector?H.toLocaleDateString():"time"===W.selector?H.toLocaleTimeString():H.toLocaleString()}};L.localizeNumberByFieldInfo=function(H,Q){var W=null;W=a.exists("format.places",Q)&&Q.format.places;W=L.localizeNumber(H,{places:W});return a.exists("format.digitSeparator",Q)&&!Q.format.digitSeparator?W.toString().replace(new RegExp("\\"+
h.group,"g"),""):W};L.fieldFormatter={getFormattedUrl:function(H){if(H&&"string"===typeof H){var Q=H.indexOf("http:");-1===Q&&(Q=H.indexOf("https:"));if(-1<Q&&-1===H.indexOf("href\x3d")){var W=H.indexOf(" ",Q);-1===W&&(W=H.length);var V=H.substring(Q,W);H=H.substring(0,Q)+'\x3cA href\x3d"'+V+'" target\x3d"_blank"\x3e'+V+"\x3c/A\x3e"+H.substring(W,H.length)}}return H||""},getFormattedNumber:function(H,Q){if("number"===typeof H){var W=(H.toString().split(".")[1]||"").length;H=L.localizeNumberByFieldInfo(H,
{format:{places:Q&&"number"===typeof Q.places?parseInt(Q.places,10):W,digitSeparator:Q&&Q.digitSeparator}});return'\x3cspan class\x3d"jimu-numeric-value"\x3e'+(H||"")+"\x3c/span\x3e"}return H},getFormattedDate:function(H){H&&(H=L.localizeDate(new Date(H),{fullYear:!0}));return H||""},getCodedValue:function(H,Q){if(H&&H.codedValues){for(var W=0,V=H.codedValues.length;W<V;W++){var Y=H.codedValues[W];if(L.isDefined(Q)&&a.exists("code",Y)&&Q.toString()===Y.code.toString())return Y.name}return Q}return Q||
null},getTypeName:function(H,Q){for(var W=Q.length,V=0;V<W;V++)if(H===Q[V].id)return Q[V].name;return H}};L.addRelativePathInCss=I;L.url={isAbsolute:function(H){return H?H.startWith("http")||H.startWith("/"):!1},removeQueryParamFromUrl:function(H,Q){H=F.urlToObject(H);H.query&&delete H.query[Q];Q=H.path;for(var W in H.query)Q=Q===H.path?Q+"?"+W+"\x3d"+H.query[W]:Q+"\x26"+W+"\x3d"+H.query[W];return Q},addQueryParamToUrl:function(H,Q,W){H=F.urlToObject(H);H.query||(H.query={});H.query[Q]=W;Q=H.path;
for(var V in H.query)Q=Q===H.path?Q+"?"+V+"\x3d"+H.query[V]:Q+"\x26"+V+"\x3d"+H.query[V];return Q}};L.processUrlInWidgetConfig=function(H,Q){if(H)return H.startWith("data:")||H.startWith("http")||H.startWith("/")?H:H.startWith("${appPath}")?H.replace("${appPath}",window.appInfo.appPath):Q+H};L.processUrlInAppConfig=function(H){if(H)return H.startWith("data:")||H.startWith("http")||H.startWith("/")?H:window.appInfo.appPath+H};L.getLocationUrlWithoutHashAndQueryParams=function(){var H=window.location,
Q=H.protocol+"//"+H.host+H.pathname;H=F.urlToObject(H.href);H.query&&H.query.apiurl&&(Q=L.url.addQueryParamToUrl(Q,"apiurl",H.query.apiurl));return Q};L.getDefaultWebMapThumbnail=function(){return require.toUrl("jimu/images/webmap.png")};L.invertColor=function(H){H=H.substring(1);3===H.length&&(H=H.slice(0,1)+H.slice(0,1)+H.slice(1,1)+H.slice(1,1)+H.slice(2,1)+H.slice(2,1));H=parseInt(H,16);return 7829367<H?"#000000":"#ffffff"};L.mixinAppConfigPosition=function(H,Q){var W=a.clone(H);if(!Q)return W;
Q=a.clone(Q);var V=W.widgetOnScreen,Y=Q.widgetOnScreen;Y&&Y.widgets&&("[object Object]"===Object.prototype.toString.call(Y.widgets)?b.forEach(V.widgets,function(aa,X){X=aa.uri?aa.uri:"ph_"+X;Y.widgets[X]&&Y.widgets[X].position&&(Y.widgets[X].position.relativeTo||(Y.widgets[X].position.relativeTo="map"),aa.position=Y.widgets[X].position)},this):b.forEach(Y.widgets,function(aa,X){aa.position&&!aa.position.relativeTo&&(aa.position.relativeTo="map");V.widgets[X]&&aa.position&&(V.widgets[X].position=aa.position)}));
Y&&Y.groups&&("[object Object]"===Object.prototype.toString.call(Y.groups)?b.forEach(V.groups,function(aa,X){X=aa.label?aa.label:"g_"+X;Y.groups[X]&&Y.groups[X].panel&&Y.groups[X].panel.position&&(Y.groups[X].panel.position.relativeTo||(Y.groups[X].panel.position.relativeTo="map"),aa.panel.position=Y.groups[X].panel.position)},this):(H=H.layoutDefinition?H.layoutDefinition.manager:"jimu/layoutManagers/AbsolutePositionLayoutManager","jimu/layoutManagers/AbsolutePositionLayoutManager"===H?b.forEach(Y.groups,
function(aa,X){aa.panel&&aa.panel.position&&!aa.panel.position.relativeTo&&(aa.panel.position.relativeTo="map");V.groups[X]&&aa.panel&&aa.panel.position&&(V.groups[X].panel.position=aa.panel.position)}):"jimu/layoutManagers/GridLayoutManager"===H&&(V.groups=M(V.groups,Y.groups.map(function(aa){return aa.id})))));Q.map&&Q.map.position&&(W.map?W.map.position=Q.map.position:W.map={position:Q.map.position});Q.widgetPool&&Q.widgetPool.panel&&(Q.widgetPool.panel.position&&!Q.widgetPool.panel.position.relativeTo&&
(Q.widgetPool.panel.position.relativeTo="map"),W.widgetPool.panel.position=Q.widgetPool.panel.position);Q.mobileLayout&&(W.mobileLayout=Q.mobileLayout);return W};L.handleGridLayoutOnScreenGroupChange=M;L.template={groupIdentification:"groups\\[.+\\]",widgetIdentification:"widgets\\[.+\\]",getSearchRange:function(H,Q,W){var V=-1;Q=H.search(new RegExp(Q));0<=Q&&(H=H.slice(Q,H.length),H=H.indexOf(W),V=Q+H+W.length);return{firstPos:Q,lastPos:V}},setConfigValue:function(H,Q,W){U(H,Q,W)},getConfigValue:function(H,
Q){return U(H,Q)},setConfigValueWithId:function(H,Q,W){R(H,Q,W)},getConfigValueWithId:function(H,Q){return R(H,Q)},getKeyInfo:function(H){var Q=this.getWidgetIdByKey(H);if(null!==Q)return{type:"widget",id:Q};H=this.getGroupIdByKey(H);return null!==H?{type:"group",id:H}:{type:"unknow",id:null}},getWidgetIdByKey:function(H){var Q=L.template.getSearchRange(H,L.template.widgetIdentification,"]");if(-1===Q.firstPos)H=null;else{var W=H.slice(Q.firstPos,Q.lastPos);H=H.slice(Q.firstPos+W.indexOf("[")+1,Q.lastPos-
1)}return H},getGroupIdByKey:function(H){var Q=L.template.getSearchRange(H,L.template.groupIdentification,"]");if(-1===Q.firstPos)H=null;else{var W=H.slice(Q.firstPos,Q.lastPos);H=H.slice(Q.firstPos+W.indexOf("[")+1,Q.lastPos-1)}return H},getConfigedWidgetsByTemplateConfig:function(H){var Q=[],W=L.template.widgetIdentification+"_config",V;b.forEach(H.configurationSettings,function(Y){b.forEach(Y.fields,function(aa){aa.fieldName&&(V=L.template.getSearchRange(aa.fieldName,W,"]"),0<=V.firstPos&&(aa=
L.template.getWidgetIdByKey(aa.fieldName),-1===Q.indexOf(aa)&&Q.push(aa)))},this)},this);return Q},mergeTemplateAppConfigToAppConfig:function(H,Q,W){function V(ba){var ha=[];b.forEach(ba,function(ka){ka&&ha.push(ka)},this);return ha}var Y=H.widgetOnScreen,aa=H.portalUrl;Q.values.webmap&&(H.map.itemId=Q.values.webmap);W&&(H.map.mapOptions&&L.deleteMapOptions(H.map.mapOptions),H.map.portalUrl=aa,Q.values.app_title||(Q.values.app_title=W.title),Q.values.app_subtitle||(Q.values.app_subtitle=W.snippet));
for(var X in Q.values)"webmap"!==X&&L.template.setConfigValueWithId(H,X,Q.values[X]);H.widgetPool.widgets=V(H.widgetPool.widgets);Y.widgets=V(Y.widgets);if(H.widgetPool.groups)for(Q=0;Q<H.widgetPool.groups.length;Q++)H.widgetPool.groups[Q].widgets=V(H.widgetPool.groups[Q].widgets);if(Y.groups)for(Q=0;Q<Y.groups.length;Q++)Y.groups[Q].widgets=V(Y.groups[Q].widgets);return H}};L.deleteMapOptions=function(H){H&&(delete H.extent,delete H.lods,delete H.center,delete H.scale,delete H.zoom,delete H.maxScale,
delete H.maxZoom,delete H.minScale,delete H.minZoom,delete H.initialState)};L.localeIsSame=function(H,Q){return H.split("-")[0]===Q.split("-")[0]};L.graphicsExtent=function(){return null};L.sanitizeHTML=function(H){return html_sanitize(H,function(Q){return Q},function(Q){return Q})};L.stripHTML=function(H){return H?-1<H.indexOf("\x3c")&&-1<H.indexOf("\x3e")?H.replace(/<(?:.|\s)*?>/g,""):H:H};L.removeSuffixSlashes=function(H){return H.replace(/\/*$/g,"")};L.getBestDisplayAttributes=function(H,Q){var W=
{},V=null,Y;for(Y in H)V=L.getBestDisplayValue(Y,H,Q),W[Y]=V;return W};L.getBestDisplayValue=function(H,Q,W){var V="",Y=null;a.isArrayLike(W)?Y=L.getFieldInfoByFieldName(W,H):"object"===typeof W&&W.name===H&&(Y=W);Y&&(V=Q[H],"esriFieldTypeDate"===Y.type?V&&(H=new Date(parseInt(V,10)),V=L._tryLocaleDate(H)):"number"===typeof V&&(Y.domain&&"codedValue"===Y.domain.type?b.some(Y.domain.codedValues,function(aa){if(aa.code===V)return V=aa.name,!0}):V=L._tryLocaleNumber(V)));if(null===V||void 0===V)V="";
return V};L._tryLocaleNumber=function(H){var Q=L.localizeNumber(H);if(null===Q||void 0===Q)Q=H;return Q};L._tryLocaleDate=function(H){var Q=L.localizeDate(H);Q||(Q=H.toLocaleDateString());return Q};L.getFieldInfoByFieldName=function(H,Q){var W=null;H&&0<H.length&&b.some(H,a.hitch(this,function(V){return V.name===Q?(W=V,!0):!1}));return W};L.containsNonLatinCharacter=function(H){for(var Q=0;Q<H.length;Q++)if(255<H.charCodeAt(Q))return!0;return!1};L.isVersion4API=function(){return 0===u.version.indexOf("4")};
L.getEsriConfig=function(){return t};L.getEsriConfigRequestObject=function(){var H=null;return H=L.isVersion4API()?t.request:t.defaults.io};L.setGlobalGeometryService=function(H){H=new C(H);L.isVersion4API()?t.geometryService=H:t.defaults.geometryService=H;return H};L.getQueryableFeatureLayersFromMap=function(H){var Q=[];H.layers&&(Q=H.layers.filter(function(W){return"esri.layers.FeatureLayer"===W.declaredClass&&W.url&&W.supportedQueryFormats&&0<=W.supportedQueryFormats.toUpperCase().indexOf("JSON")}));
return Q};L.has=function(H){var Q=d(H);if(Q)return Q;if("ie"===H.toLowerCase()){H=0;var W=/MSIE (\d+\.\d+);/.test(navigator.userAgent),V=!!navigator.userAgent.match(/Trident\/7.0/),Y=navigator.userAgent.indexOf("rv:11.0");W&&(H=Number(RegExp.$1));-1!==navigator.appVersion.indexOf("MSIE 10")&&(H=10);V&&-1!==Y&&(H=11);return 11===H&&11||Q}if("edge"===H.toLowerCase())return navigator.userAgent.split("Edge/")[1]||Q};L.detectUserAgent=function(){var H={},Q={},W=navigator.userAgent,V=navigator.platform,
Y=W.match(/Web[kK]it[\/]{0,1}([\d.]+)/),aa=W.match(/(Android);?[\s\/]+([\d.]+)?/),X=!!W.match(/\(Macintosh; Intel /),ba=W.match(/(iPad).*OS\s([\d_]+)/),ha=W.match(/(iPod)(.*OS\s([\d_]+))?/),ka=!ba&&W.match(/(iPhone\sOS)\s([\d_]+)/),ia=W.match(/(webOS|hpwOS)[\s\/]([\d.]+)/);V=/Win\d{2}|Windows/.test(V);var ea=W.match(/Windows Phone ([\d.]+)/),ca=ia&&W.match(/TouchPad/),Z=W.match(/Kindle\/([\d.]+)/),fa=W.match(/Silk\/([\d._]+)/),ja=W.match(/(BlackBerry).*Version\/([\d.]+)/),la=W.match(/(BB10).*Version\/([\d.]+)/),
ma=W.match(/(RIM\sTablet\sOS)\s([\d.]+)/),ra=W.match(/PlayBook/),va=W.match(/Chrome\/([\d.]+)/)||W.match(/CriOS\/([\d.]+)/),ya=W.match(/Firefox\/([\d.]+)/),za=W.match(/\((?:Mobile|Tablet); rv:([\d.]+)\).*Firefox\/[\d.]+/),pa=W.match(/MSIE\s([\d.]+)/)||W.match(/Trident\/[\d](?=[^\?]+).*rv:([0-9.].)/),wa=!va&&W.match(/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/),na=wa||W.match(/Version\/([\d.]+)([^S](Safari)|[^M]*(Mobile)[^S]*(Safari))/);Q.webkit=!!Y;Q.webkit&&(Q.version=Y[1]);aa&&(H.android=!0,H.version=
aa[2]);ka&&!ha&&(H.ios=H.iphone=!0,H.version=ka[2].replace(/_/g,"."));ba&&(H.ios=H.ipad=!0,H.version=ba[2].replace(/_/g,"."));ha&&(H.ios=H.ipod=!0,H.version=ha[3]?ha[3].replace(/_/g,"."):null);ea&&(H.wp=!0,H.version=ea[1]);ia&&(H.webos=!0,H.version=ia[2]);ca&&(H.touchpad=!0);ja&&(H.blackberry=!0,H.version=ja[2]);la&&(H.bb10=!0,H.version=la[2]);ma&&(H.rimtabletos=!0,H.version=ma[2]);ra&&(Q.playbook=!0);Z&&(H.kindle=!0,H.version=Z[1]);fa&&(Q.silk=!0,Q.version=fa[1]);!fa&&H.android&&W.match(/Kindle Fire/)&&
(Q.silk=!0);va&&(Q.chrome=!0,Q.version=va[1]);ya&&(Q.firefox=!0,Q.version=ya[1]);za&&(H.firefoxos=!0,H.version=za[1]);pa&&(Q.ie=!0,Q.version=pa[1]);na&&(X||H.ios||V)&&(Q.safari=!0,H.ios||(Q.version=na[1]));wa&&(Q.webview=!0);H.tablet=!!(ba||ra||aa&&!W.match(/Mobile/)||ya&&W.match(/Tablet/)||pa&&!W.match(/Phone/)&&W.match(/Touch/));H.phone=!(H.tablet||H.ipod||!(aa||ka||ia||ja||la||va&&W.match(/Android/)||va&&W.match(/CriOS\/([\d.]+)/)||ya&&W.match(/Mobile/)||pa&&W.match(/Touch/)));return{os:H,browser:Q}};
L.isMobileUa=function(){var H=L.detectUserAgent();return!0===H.os.phone||!0===H.os.tablet?!0:!1};L.isNeedHttpsButNot=function(){var H=navigator.geolocation,Q=window.hasOwnProperty("isSecureContext");return(Q&&window.isSecureContext||!Q&&"https:"===window.location.protocol)&&H?!1:!0};L.isInConfigOrPreviewWindow=function(){var H=!1;try{H=!window.isBuilder&&window.parent&&window.parent!==window&&window.parent.isBuilder}catch(Q){H=!1}return!!H};L.getAppHref=function(){var H="";return H=L.isInConfigOrPreviewWindow()?
window.parent.location.href:window.location.href};L.getAppIdFromUrl=function(){var H=!0,Q=L.getAppHref();if(-1!==Q.indexOf("id\x3d")||-1!==Q.indexOf("appid\x3d")||-1!==Q.indexOf("apps"))H=!1;if(!0===H)return Q;H=this.urlToObject(window.location.href);if(H.query&&(H.query.id||H.query.appid))return H.query.id||H.query.appid;if(window.appInfo){if(window.appInfo.id)return window.appInfo.id;if(window.appInfo.appPath){if(H=window.appInfo.appPath.split("/"),H.length&&2<H.length)return H[H.length-2]}else console.error("CAN NOT getAppIdFromUrl")}};
L.getEditorContentHeight=function(H,Q,W){var V=new n;this._content=H;this._dom=Q;this._domParam=W;var Y=setTimeout(a.hitch(this,function(){clearTimeout(Y);Y=null;var aa=0,X=this._domParam.contentWidth;try{var ba=document.createElement("div");ba.setAttribute("id","fakeContent");c.setStyle(ba,"background-size","contain");ba.innerHTML=this._content;this._dom.appendChild(ba);if(ba){var ha=w("img",ba);if(ha&&ha.length)for(var ka=0,ia=ha.length;ka<ia;ka++)c.setStyle(ha[ka],"maxWidth",X-20+"px");c.setStyle(ba,
"position","absolute");c.setStyle(ba,"width",X+"px");c.setStyle(ba,"left","-99999px");c.setStyle(ba,"top","-99999px");c.setStyle(ba,"visibility","hidden");var ea=c.getContentBox(ba);ea.h&&(aa=ea.h,aa+=this._domParam.contentMarginTop+this._domParam.footerHeight+8)}}catch(ca){console.error("can't getEditorContentHeight"+ca),aa=200}V.resolve(aa)}),1500);return V};L.getEditorTextColor=function(H,Q){return{name:"dijit.editor.plugins.EditorTextColor",custom:{recordUID:L.getColorRecordName(H),forceAttr:Q}}};
L.getEditorBackgroundColor=function(H){return{name:"dijit.editor.plugins.EditorBackgroundColor",custom:{recordUID:L.getColorRecordName(H)}}};L.getColorRecordName=function(H){return"wab_cr_"+(H||"")};L.isEsriDomain=function(H){return/^https?:\/\/(?:[\w\-_]+\.)+(?:esri|arcgis)\.com/.test(H)};L.b64toBlob=function(H,Q,W){Q=Q||"";W=W||512;H=window.atob(H.replace(/^data:image\/(png|jpg|jpeg|gif);base64,/,""));for(var V=[],Y=0;Y<H.length;Y+=W){for(var aa=H.slice(Y,Y+W),X=Array(aa.length),ba=0;ba<aa.length;ba++)X[ba]=
aa.charCodeAt(ba);aa=new Uint8Array(X);V.push(aa)}return new Blob(V,{type:Q})};L.subtractionArray=function(H,Q){for(var W=H.length-1;0<=W;W--)for(var V=H[W],Y=Q.length-1;0<=Y;Y--)if(V===Q[Y]){H.splice(W,1);Q.splice(Y,1);break}return H};L.resourcesUrlToBlob=function(H){return G({url:H,handleAs:"blob"})};L.processItemResourceOfAppConfig=function(H,Q){function W(ha){var ka=ha.obj,ia=ha.key,ea={obj:ka,key:ia};"number"===typeof ha.i?(ea.i=ha.i,ea.value=ka[ia][ha.i]):ea.value=ka[ia];return ea}function V(ha){for(var ka in ha)if("object"===
typeof ha[ka])if(Array.isArray(ha[ka]))for(var ia=ha,ea=ka,ca=0;ca<ia[ea].length;ca++)"string"===typeof ia[ea][ca]?Y(ia,ea,ca):"object"===typeof ia[ea][ca]&&V(ia[ea][ca]);else V(ha[ka]);else"string"===typeof ha[ka]&&Y(ha,ka)}function Y(ha,ka,ia){"number"===typeof ia?Q.test(ha[ka][ia])&&(ba=Q.func(W({obj:ha,key:ka,i:ia})),"function"===typeof ba.then?X.push(ba):aa.push(ba)):Q.test(ha[ka])&&(ba=Q.func(W({obj:ha,key:ka})),"function"===typeof ba.then?X.push(ba):aa.push(ba))}var aa=[],X=[],ba;V(H);return 0<
X.length?f(X).then(function(ha){0<aa.length&&(ha=ha.concat(aa));return{appConfig:H,result:ha}}):{appConfig:H,result:aa}};L.isDefined=function(H){return void 0!==H&&null!==H};L.getDefaultPopupInfo=function(H,Q,W){var V=null;H&&H.fields&&(V={title:Q,fieldInfos:[],description:null,showAttachments:!0,mediaInfos:[]},b.forEach(H.fields,function(Y){var aa=!1;W?b.some(W,a.hitch(this,function(X){return X&&Y.name.toLowerCase()===X.toLowerCase()}))&&(aa=!0):aa=!0;aa&&(aa=this.getDefaultPortalFieldInfo(Y),aa.visible=
!0,aa.isEditable=Y.editable,V.fieldInfos.push(aa))},this));return V};L.getDefaultPortalFieldInfo=function(H){var Q=H.name;Q={fieldName:Q,label:H.alias||Q,tooltip:"",visible:!1,format:null,stringFieldOption:"textbox"};switch(H.type){case "esriFieldTypeSmallInteger":case "esriFieldTypeInteger":Q.format={places:0,digitSeparator:!0};break;case "esriFieldTypeSingle":case "esriFieldTypeDouble":Q.format={places:2,digitSeparator:!0};break;case "esriFieldTypeDate":Q.format={dateFormat:"longMonthDayYear"}}return Q};
L.getStyleColorInTheme=function(H){var Q=new n;if(window&&window.isBuilder){var W="./stemapp3d/themes/";var V=window.appConfig}else W="./themes/",V=window.getAppConfig();if(V&&V.theme.customStyles&&V.theme.customStyles.mainBackgroundColor)return Q.resolve(V.theme.customStyles.mainBackgroundColor),Q.promise;var Y=V.theme.name,aa=V.theme.styles[0];H&&(aa=H);G(W+Y+"/manifest.json",{responseType:"json"}).then(a.hitch(this,function(X){if(X&&X.data){X=X.data.styles;for(var ba=0;ba<X.length;ba++){var ha=
X[ba];ha.name===aa&&Q.resolve(ha.styleColor)}}}),a.hitch(this,function(X){console.error(X);Q.reject(null)}));return Q.promise};return L})},"dojo/NodeList-traverse":function(){define(["./query","./_base/lang","./_base/array"],function(a,b,c){var d=a.NodeList;b.extend(d,{_buildArrayFromCallback:function(g){for(var x=[],w=0;w<this.length;w++){var l=g.call(this[w],this[w],x);l&&(x=x.concat(l))}return x},_getUniqueAsNodeList:function(g){for(var x=[],w=0,l;l=g[w];w++)1==l.nodeType&&-1==c.indexOf(x,l)&&
x.push(l);return this._wrap(x,null,this._NodeListCtor)},_getUniqueNodeListWithParent:function(g,x){g=this._getUniqueAsNodeList(g);g=x?a._filterResult(g,x):g;return g._stash(this)},_getRelatedUniqueNodes:function(g,x){return this._getUniqueNodeListWithParent(this._buildArrayFromCallback(x),g)},children:function(g){return this._getRelatedUniqueNodes(g,function(x,w){return b._toArray(x.childNodes)})},closest:function(g,x){return this._getRelatedUniqueNodes(null,function(w,l){do if(a._filterResult([w],
g,x).length)return w;while(w!=x&&(w=w.parentNode)&&1==w.nodeType);return null})},parent:function(g){return this._getRelatedUniqueNodes(g,function(x,w){return x.parentNode})},parents:function(g){return this._getRelatedUniqueNodes(g,function(x,w){for(w=[];x.parentNode;)x=x.parentNode,w.push(x);return w})},siblings:function(g){return this._getRelatedUniqueNodes(g,function(x,w){w=[];for(var l=x.parentNode&&x.parentNode.childNodes,n=0;n<l.length;n++)l[n]!=x&&w.push(l[n]);return w})},next:function(g){return this._getRelatedUniqueNodes(g,
function(x,w){for(x=x.nextSibling;x&&1!=x.nodeType;)x=x.nextSibling;return x})},nextAll:function(g){return this._getRelatedUniqueNodes(g,function(x,w){for(w=[];x=x.nextSibling;)1==x.nodeType&&w.push(x);return w})},prev:function(g){return this._getRelatedUniqueNodes(g,function(x,w){for(x=x.previousSibling;x&&1!=x.nodeType;)x=x.previousSibling;return x})},prevAll:function(g){return this._getRelatedUniqueNodes(g,function(x,w){for(w=[];x=x.previousSibling;)1==x.nodeType&&w.push(x);return w})},andSelf:function(){return this.concat(this._parent)},
first:function(){return this._wrap(this[0]&&[this[0]]||[],this)},last:function(){return this._wrap(this.length?[this[this.length-1]]:[],this)},even:function(){return this.filter(function(g,x){return 0!=x%2})},odd:function(){return this.filter(function(g,x){return 0==x%2})}});return d})},"dojo/promise/all":function(){define(["../_base/array","../_base/lang","../Deferred","../when"],function(a,b,c,d){var g=a.some;return function(x){var w,l;b.isArray(x)?l=x:x&&"object"===typeof x&&(w=x);var n=[];if(w){l=
[];for(var f in w)Object.hasOwnProperty.call(w,f)&&(n.push(f),l.push(w[f]));var e={}}else l&&(e=[]);if(!l||!l.length)return(new c).resolve(e);var k=new c;k.promise.always(function(){e=n=null});var r=l.length;g(l,function(y,p){w||n.push(p);d(y,function(h){k.isFulfilled()||(e[n[p]]=h,0===--r&&k.resolve(e))},k.reject);return k.isFulfilled()});return k.promise}})},"dojo/cookie":function(){define(["./_base/kernel","./regexp"],function(a,b){a.cookie=function(c,d,g){var x=document.cookie;if(1==arguments.length)var w=
(w=x.match(new RegExp("(?:^|; )"+b.escapeString(c)+"\x3d([^;]*)")))?decodeURIComponent(w[1]):void 0;else{g=g||{};x=g.expires;if("number"==typeof x){var l=new Date;l.setTime(l.getTime()+864E5*x);x=g.expires=l}x&&x.toUTCString&&(g.expires=x.toUTCString());d=encodeURIComponent(d);x=c+"\x3d"+d;for(var n in g)x+="; "+n,l=g[n],!0!==l&&(x+="\x3d"+l);document.cookie=x}return w};a.cookie.isSupported=function(){"cookieEnabled"in navigator||(this("__djCookieTest__","CookiesAllowed"),navigator.cookieEnabled=
"CookiesAllowed"==this("__djCookieTest__"),navigator.cookieEnabled&&this("__djCookieTest__","",{expires:-1}));return navigator.cookieEnabled};return a.cookie})},"dojo/regexp":function(){define(["./_base/kernel","./_base/lang"],function(a,b){var c={};b.setObject("dojo.regexp",c);c.escapeString=function(d,g){return d.replace(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,function(x){return g&&-1!=g.indexOf(x)?x:"\\"+x})};c.buildGroupRE=function(d,g,x){if(!(d instanceof Array))return g(d);for(var w=[],l=0;l<d.length;l++)w.push(g(d[l]));
return c.group(w.join("|"),x)};c.group=function(d,g){return"("+(g?"?:":"")+d+")"};return c})},"dojo/number":function(){define(["./_base/lang","./i18n","./i18n!./cldr/nls/number","./string","./regexp"],function(a,b,c,d,g){var x={};a.setObject("dojo.number",x);x.format=function(l,n){n=a.mixin({},n||{});var f=b.normalizeLocale(n.locale);f=b.getLocalization("dojo.cldr","number",f);n.customs=f;f=n.pattern||f[(n.type||"decimal")+"Format"];return isNaN(l)||Infinity==Math.abs(l)?null:x._applyPattern(l,f,
n)};x._numberPatternRE=/[#0,]*[#0](?:\.0*#*)?/;x._applyPattern=function(l,n,f){f=f||{};var e=f.customs.group,k=f.customs.decimal;n=n.split(";");var r=n[0];n=n[0>l?1:0]||"-"+r;if(-1!=n.indexOf("%"))l*=100;else if(-1!=n.indexOf("\u2030"))l*=1E3;else if(-1!=n.indexOf("\u00a4"))e=f.customs.currencyGroup||e,k=f.customs.currencyDecimal||k,n=n.replace(/([\s\xa0\u202f]*)(\u00a4{1,3})([\s\xa0\u202f]*)/,function(p,h,m,u){return(p=f[["symbol","currency","displayName"][m.length-1]]||f.currency||"")?h+p+u:""});
else if(-1!=n.indexOf("E"))throw Error("exponential notation not supported");var y=x._numberPatternRE;r=r.match(y);if(!r)throw Error("unable to find a number expression in pattern: "+n);!1===f.fractional&&(f.places=0);return n.replace(y,x._formatAbsolute(l,r[0],{decimal:k,group:e,places:f.places,round:f.round}))};x.round=function(l,n,f){f=10/(f||10);return(f*+l).toFixed(n)/f};if(0==(.9).toFixed()){var w=x.round;x.round=function(l,n,f){var e=Math.pow(10,-n||0),k=Math.abs(l);if(!l||k>=e)e=0;else if(k/=
e,.5>k||.95<=k)e=0;return w(l,n,f)+(0<l?e:-e)}}x._formatAbsolute=function(l,n,f){f=f||{};!0===f.places&&(f.places=0);Infinity===f.places&&(f.places=6);n=n.split(".");var e="string"==typeof f.places&&f.places.indexOf(","),k=f.places;e?k=f.places.substring(e+1):0<=k||(k=(n[1]||[]).length);0>f.round||(l=x.round(l,k,f.round));l=String(Math.abs(l)).split(".");var r=l[1]||"";n[1]||f.places?(e&&(f.places=f.places.substring(0,e)),e=void 0!==f.places?f.places:n[1]&&n[1].lastIndexOf("0")+1,e>r.length&&(l[1]=
d.pad(r,e,"0",!0)),k<r.length&&(l[1]=r.substr(0,k))):l[1]&&l.pop();k=n[0].replace(",","");e=k.indexOf("0");-1!=e&&(e=k.length-e,e>l[0].length&&(l[0]=d.pad(l[0],e)),-1==k.indexOf("#")&&(l[0]=l[0].substr(l[0].length-e)));k=n[0].lastIndexOf(",");var y;if(-1!=k){var p=n[0].length-k-1;n=n[0].substr(0,k);k=n.lastIndexOf(",");-1!=k&&(y=n.length-k-1)}n=[];for(k=l[0];k;)e=k.length-p,n.push(0<e?k.substr(e):k),k=0<e?k.slice(0,e):"",y&&(p=y,y=void 0);l[0]=n.reverse().join(f.group||",");return l.join(f.decimal||
".")};x.regexp=function(l){return x._parseInfo(l).regexp};x._parseInfo=function(l){l=l||{};var n=b.normalizeLocale(l.locale);n=b.getLocalization("dojo.cldr","number",n);var f=l.pattern||n[(l.type||"decimal")+"Format"],e=n.group,k=n.decimal,r=1;if(-1!=f.indexOf("%"))r/=100;else if(-1!=f.indexOf("\u2030"))r/=1E3;else{var y=-1!=f.indexOf("\u00a4");y&&(e=n.currencyGroup||e,k=n.currencyDecimal||k)}n=f.split(";");1==n.length&&n.push("-"+n[0]);n=g.buildGroupRE(n,function(p){p="(?:"+g.escapeString(p,".")+
")";return p.replace(x._numberPatternRE,function(h){var m={signed:!1,separator:l.strict?e:[e,""],fractional:l.fractional,decimal:k,exponent:!1};h=h.split(".");var u=l.places;1==h.length&&1!=r&&(h[1]="###");1==h.length||0===u?m.fractional=!1:(void 0===u&&(u=l.pattern?h[1].lastIndexOf("0")+1:Infinity),u&&void 0==l.fractional&&(m.fractional=!0),!l.places&&u<h[1].length&&(u+=","+h[1].length),m.places=u);h=h[0].split(",");1<h.length&&(m.groupSize=h.pop().length,1<h.length&&(m.groupSize2=h.pop().length));
return"("+x._realNumberRegexp(m)+")"})},!0);y&&(n=n.replace(/([\s\xa0\u202f]*)(\u00a4{1,3})([\s\xa0\u202f]*)/g,function(p,h,m,u){p=g.escapeString(l[["symbol","currency","displayName"][m.length-1]]||l.currency||"");if(!p)return"";h=h?"[\\s\\xa0\\u202f]":"";u=u?"[\\s\\xa0\\u202f]":"";return l.strict?h+p+u:(h&&(h+="*"),u&&(u+="*"),"(?:"+h+p+u+")?")}));return{regexp:n.replace(/[\xa0\u202f ]/g,"[\\s\\xa0\\u202f]"),group:e,decimal:k,factor:r}};x.parse=function(l,n){n=x._parseInfo(n);l=(new RegExp("^"+n.regexp+
"$")).exec(l);if(!l)return NaN;var f=l[1];if(!l[1]){if(!l[2])return NaN;f=l[2];n.factor*=-1}f=f.replace(new RegExp("["+n.group+"\\s\\xa0\\u202f]","g"),"").replace(n.decimal,".");return f*n.factor};x._realNumberRegexp=function(l){l=l||{};"places"in l||(l.places=Infinity);"string"!=typeof l.decimal&&(l.decimal=".");"fractional"in l&&!/^0/.test(l.places)||(l.fractional=[!0,!1]);"exponent"in l||(l.exponent=[!0,!1]);"eSigned"in l||(l.eSigned=[!0,!1]);var n=x._integerRegexp(l),f=g.buildGroupRE(l.fractional,
function(k){var r="";k&&0!==l.places&&(r="\\"+l.decimal,r=Infinity==l.places?"(?:"+r+"\\d+)?":r+("\\d{"+l.places+"}"));return r},!0),e=g.buildGroupRE(l.exponent,function(k){return k?"([eE]"+x._integerRegexp({signed:l.eSigned})+")":""});n+=f;f&&(n="(?:(?:"+n+")|(?:"+f+"))");return n+e};x._integerRegexp=function(l){l=l||{};"signed"in l||(l.signed=[!0,!1]);"separator"in l?"groupSize"in l||(l.groupSize=3):l.separator="";var n=g.buildGroupRE(l.signed,function(e){return e?"[-+]":""},!0),f=g.buildGroupRE(l.separator,
function(e){if(!e)return"(?:\\d+)";e=g.escapeString(e);" "==e?e="\\s":"\u00a0"==e?e="\\s\\xa0":"\u202f"==e&&(e="\\s\\u202f");var k=l.groupSize,r=l.groupSize2;return r?(e="(?:0|[1-9]\\d{0,"+(r-1)+"}(?:["+e+"]\\d{"+r+"})*["+e+"]\\d{"+k+"})",0<k-r?"(?:"+e+"|(?:0|[1-9]\\d{0,"+(k-1)+"}))":e):"(?:0|[1-9]\\d{0,"+(k-1)+"}(?:["+e+"]\\d{"+k+"})*)"},!0);return n+f};return x})},"dojo/i18n":function(){define("./_base/kernel require ./has ./_base/array ./_base/config ./_base/lang ./has!host-browser?./_base/xhr ./json module".split(" "),
function(a,b,c,d,g,x,w,l,n){c.add("dojo-preload-i18n-Api",1);w=a.i18n={};var f=/(^.*(^|\/)nls)(\/|$)([^\/]*)\/?([^\/]*)/,e=function(A,E,C,D){var F=[C+D];E=E.split("-");for(var G="",J=0;J<E.length;J++)if(G+=(G?"-":"")+E[J],!A||A[G])F.push(C+G+"/"+D),F.specificity=G;return F},k={},r=function(A,E,C){C=C?C.toLowerCase():a.locale;A=A.replace(/\./g,"/");E=E.replace(/\./g,"/");return/root/i.test(C)?A+"/nls/"+E:A+"/nls/"+C+"/"+E},y=a.getL10nName=function(A,E,C){return A=n.id+"!"+r(A,E,C)},p=function(A,E,
C,D,F,G){A([E],function(J){var I=x.clone(J.root||J.ROOT),O=e(!J._v1x&&J,F,C,D);A(O,function(){for(var P=1;P<O.length;P++)I=x.mixin(x.clone(I),arguments[P]);k[E+"/"+F]=I;I.$locale=O.specificity;G()})})},h=function(A){var E=g.extraLocale||[];E=x.isArray(E)?E:[E];E.push(A);return E},m=function(A,E,C){var D=f.exec(A),F=D[1]+"/",G=D[5]||D[4],J=F+G,I=(D=D[5]&&D[4])||a.locale||"",O=J+"/"+I;D=D?[I]:h(I);var P=D.length,K=function(){--P||C(x.delegate(k[O]))};I=A.split("*");var M="preload"==I[1];if(c("dojo-preload-i18n-Api")){if(M&&
(k[A]||(k[A]=1,z(I[2],l.parse(I[3]),1,E)),C(1)),(I=M)||(t&&q.push([A,E,C]),I=t&&!k[O]),I)return}else if(M){C(1);return}d.forEach(D,function(U){var R=J+"/"+U;c("dojo-preload-i18n-Api")&&v(R);k[R]?K():p(E,J,F,G,U,K)})};c("dojo-preload-i18n-Api");var u=w.normalizeLocale=function(A){A=A?A.toLowerCase():a.locale;return"root"==A?"ROOT":A},t=0,q=[],z=w._preloadLocalizations=function(A,E,C,D){function F(O,P){D([O],P)}function G(O,P){for(O=O.split("-");O.length;){if(P(O.join("-")))return;O.pop()}P("ROOT")}
function J(){for(--t;!t&&q.length;)m.apply(null,q.shift())}function I(O){O=u(O);G(O,function(P){if(0<=d.indexOf(E,P)){var K=A.replace(/\./g,"/")+"_"+P;t++;F(K,function(M){for(var U in M){var R=M[U],L=U.match(/(.+)\/([^\/]+)$/);if(L){var N=L[2];L=L[1]+"/";if(R._localized){var T;if("ROOT"===P){var S=T=R._localized;delete R._localized;S.root=R;k[b.toAbsMid(U)]=S}else T=R._localized,k[b.toAbsMid(L+N+"/"+P)]=R;P!==O&&function(H,Q,W,V){var Y=[],aa=[];G(O,function(X){V[X]&&(Y.push(b.toAbsMid(H+X+"/"+Q)),
aa.push(b.toAbsMid(H+Q+"/"+X)))});Y.length?(t++,D(Y,function(){for(var X=Y.length-1;0<=X;X--)W=x.mixin(x.clone(W),arguments[X]),k[aa[X]]=W;k[b.toAbsMid(H+Q+"/"+O)]=x.clone(W);J()})):k[b.toAbsMid(H+Q+"/"+O)]=W}(L,N,R,T)}}}J()});return!0}return!1})}D=D||b;I();d.forEach(a.config.extraLocale,I)},v=function(){},B={};v=function(A){for(var E,C=A.split("/"),D=a.global[C[0]],F=1;D&&F<C.length-1;D=D[C[F++]]);D&&((E=D[C[F]])||(E=D[C[F].replace(/-/g,"_")]),E&&(k[A]=E));return E};w.getLocalization=function(A,
E,C){var D,F=r(A,E,C);if(B[F])return B[F];m(F,b,function(G){D=B[F]=G});return D};return x.mixin(w,{dynamic:!0,normalize:function(A,E){return/^\./.test(A)?E(A):A},load:m,cache:k,getL10nName:y})})},"dojo/date/locale":function(){define("../_base/lang ../_base/array ../date ../cldr/supplemental ../i18n ../regexp ../string ../i18n!../cldr/nls/gregorian module".split(" "),function(a,b,c,d,g,x,w,l,n){function f(m,u,t,q){return q.replace(/([a-z])\1*/ig,function(z){var v=z.charAt(0);z=z.length;var B=["abbr",
"wide","narrow"];switch(v){case "G":var A=u[4>z?"eraAbbr":"eraNames"][0>m.getFullYear()?0:1];break;case "y":A=m.getFullYear();switch(z){case 1:break;case 2:if(!t.fullYear){A=String(A);A=A.substr(A.length-2);break}default:var E=!0}break;case "Q":case "q":A=Math.ceil((m.getMonth()+1)/3);E=!0;break;case "M":case "L":A=m.getMonth();3>z?(A+=1,E=!0):(v=["months","L"==v?"standAlone":"format",B[z-3]].join("-"),A=u[v][A]);break;case "w":A=r._getWeekOfYear(m,0);E=!0;break;case "d":A=m.getDate();E=!0;break;
case "D":A=r._getDayOfYear(m);E=!0;break;case "e":case "c":if(A=m.getDay(),2>z){A=(A-d.getFirstDayOfWeek(t.locale)+8)%7;break}case "E":A=m.getDay();3>z?(A+=1,E=!0):(v=["days","c"==v?"standAlone":"format",B[z-3]].join("-"),A=u[v][A]);break;case "a":v=12>m.getHours()?"am":"pm";A=t[v]||u["dayPeriods-format-wide-"+v];break;case "h":case "H":case "K":case "k":E=m.getHours();switch(v){case "h":A=E%12||12;break;case "H":A=E;break;case "K":A=E%12;break;case "k":A=E||24}E=!0;break;case "m":A=m.getMinutes();
E=!0;break;case "s":A=m.getSeconds();E=!0;break;case "S":A=Math.round(m.getMilliseconds()*Math.pow(10,z-3));E=!0;break;case "v":case "z":if(A=r._getZone(m,!0,t))break;z=4;case "Z":v=r._getZone(m,!1,t);v=[0>=v?"+":"-",w.pad(Math.floor(Math.abs(v)/60),2),w.pad(Math.abs(v)%60,2)];4==z&&(v.splice(0,0,"GMT"),v.splice(3,0,":"));A=v.join("");break;default:throw Error("dojo.date.locale.format: invalid pattern char: "+q);}E&&(A=w.pad(A,z));return A})}function e(m,u,t,q){var z=function(A){return A};u=u||z;
t=t||z;q=q||z;var v=m.match(/(''|[^'])+/g),B="'"==m.charAt(0);b.forEach(v,function(A,E){A?(v[E]=(B?t:u)(A.replace(/''/g,"'")),B=!B):v[E]=""});return q(v.join(""))}function k(m,u,t,q){q=x.escapeString(q);t.strict||(q=q.replace(" a"," ?a"));return q.replace(/([a-z])\1*/ig,function(z){var v=z.charAt(0);var B=z.length,A="",E="";t.strict?(1<B&&(A="0{"+(B-1)+"}"),2<B&&(E="0{"+(B-2)+"}")):(A="0?",E="0{0,2}");switch(v){case "y":v="\\d{2,4}";break;case "M":case "L":2<B?(v=u["months-"+("L"==v?"standAlone":
"format")+"-"+y[B-3]].slice(0).join("|"),t.strict||(v=v.replace(/\./g,""),v="(?:"+v+")\\.?")):v="1[0-2]|"+A+"[1-9]";break;case "D":v="[12][0-9][0-9]|3[0-5][0-9]|36[0-6]|"+A+"[1-9][0-9]|"+E+"[1-9]";break;case "d":v="3[01]|[12]\\d|"+A+"[1-9]";break;case "w":v="[1-4][0-9]|5[0-3]|"+A+"[1-9]";break;case "E":case "e":case "c":v=".+?";break;case "h":v="1[0-2]|"+A+"[1-9]";break;case "k":v="1[01]|"+A+"\\d";break;case "H":v="1\\d|2[0-3]|"+A+"\\d";break;case "K":v="1\\d|2[0-4]|"+A+"[1-9]";break;case "m":case "s":v=
"[0-5]\\d";break;case "S":v="\\d{"+B+"}";break;case "a":B=t.am||u["dayPeriods-format-wide-am"];A=t.pm||u["dayPeriods-format-wide-pm"];v=B+"|"+A;t.strict||(B!=B.toLowerCase()&&(v+="|"+B.toLowerCase()),A!=A.toLowerCase()&&(v+="|"+A.toLowerCase()),-1!=v.indexOf(".")&&(v+="|"+v.replace(/\./g,"")));v=v.replace(/\./g,"\\.");break;default:v=".*"}m&&m.push(z);return"("+v+")"}).replace(/[\xa0 ]/g,"[\\s\\xa0]")}var r={};a.setObject(n.id.replace(/\//g,"."),r);r._getZone=function(m,u,t){return u?c.getTimezoneName(m):
m.getTimezoneOffset()};r.format=function(m,u){u=u||{};var t=g.normalizeLocale(u.locale),q=u.formatLength||"short";t=r._getGregorianBundle(t);var z=[];m=a.hitch(this,f,m,t,u);if("year"==u.selector)return e(t["dateFormatItem-yyyy"]||"yyyy",m);var v;"date"!=u.selector&&(v=u.timePattern||t["timeFormat-"+q])&&z.push(e(v,m));"time"!=u.selector&&(v=u.datePattern||t["dateFormat-"+q])&&z.push(e(v,m));return 1==z.length?z[0]:t["dateTimeFormat-"+q].replace(/'/g,"").replace(/\{(\d+)\}/g,function(B,A){return z[A]})};
r.regexp=function(m){return r._parseInfo(m).regexp};r._parseInfo=function(m){m=m||{};var u=g.normalizeLocale(m.locale);u=r._getGregorianBundle(u);var t=m.formatLength||"short",q=m.datePattern||u["dateFormat-"+t],z=m.timePattern||u["timeFormat-"+t];t="date"==m.selector?q:"time"==m.selector?z:u["dateTimeFormat-"+t].replace(/\{(\d+)\}/g,function(B,A){return[z,q][A]});var v=[];return{regexp:e(t,a.hitch(this,k,v,u,m)),tokens:v,bundle:u}};r.parse=function(m,u){var t=/[\u200E\u200F\u202A\u202E]/g,q=r._parseInfo(u),
z=q.tokens,v=q.bundle;m=(new RegExp("^"+q.regexp.replace(t,"")+"$",q.strict?"":"i")).exec(m&&m.replace(t,""));if(!m)return null;var B=["abbr","wide","narrow"],A=[1970,0,1,0,0,0,0],E="";m=b.every(m,function(D,F){if(!F)return!0;var G=z[F-1];F=G.length;G=G.charAt(0);switch(G){case "y":if(2!=F&&u.strict)A[0]=D;else if(100>D)D=Number(D),G=""+(new Date).getFullYear(),F=100*G.substring(0,2),G=Math.min(Number(G.substring(2,4))+20,99),A[0]=D<G?F+D:F-100+D;else{if(u.strict)return!1;A[0]=D}break;case "M":case "L":if(2<
F){if(F=v["months-"+("L"==G?"standAlone":"format")+"-"+B[F-3]].concat(),u.strict||(D=D.replace(".","").toLowerCase(),F=b.map(F,function(I){return I.replace(".","").toLowerCase()})),D=b.indexOf(F,D),-1==D)return!1}else D--;A[1]=D;break;case "E":case "e":case "c":F=v["days-"+("c"==G?"standAlone":"format")+"-"+B[F-3]].concat();u.strict||(D=D.toLowerCase(),F=b.map(F,function(I){return I.toLowerCase()}));D=b.indexOf(F,D);if(-1==D)return!1;break;case "D":A[1]=0;case "d":A[2]=D;break;case "a":F=u.am||v["dayPeriods-format-wide-am"];
G=u.pm||v["dayPeriods-format-wide-pm"];if(!u.strict){var J=/\./g;D=D.replace(J,"").toLowerCase();F=F.replace(J,"").toLowerCase();G=G.replace(J,"").toLowerCase()}if(u.strict&&D!=F&&D!=G)return!1;E=D==G?"p":D==F?"a":"";break;case "K":24==D&&(D=0);case "h":case "H":case "k":if(23<D)return!1;A[3]=D;break;case "m":A[4]=D;break;case "s":A[5]=D;break;case "S":A[6]=D}return!0});t=+A[3];"p"===E&&12>t?A[3]=t+12:"a"===E&&12==t&&(A[3]=0);t=new Date(A[0],A[1],A[2],A[3],A[4],A[5],A[6]);u.strict&&t.setFullYear(A[0]);
var C=z.join("");q=-1!=C.indexOf("d");C=-1!=C.indexOf("M");if(!m||C&&t.getMonth()>A[1]||q&&t.getDate()>A[2])return null;if(C&&t.getMonth()<A[1]||q&&t.getDate()<A[2])t=c.add(t,"hour",1);return t};var y=["abbr","wide","narrow"],p=[],h={};r.addCustomFormats=function(m,u){p.push({pkg:m,name:u});h={}};r._getGregorianBundle=function(m){if(h[m])return h[m];var u={};b.forEach(p,function(t){t=g.getLocalization(t.pkg,t.name,m);u=a.mixin(u,t)},this);return h[m]=u};r.addCustomFormats(n.id.replace(/\/date\/locale$/,
".cldr"),"gregorian");r.getNames=function(m,u,t,q){q=r._getGregorianBundle(q);m=[m,t,u];if("standAlone"==t){t=m.join("-");var z=q[t];1==z[0]&&(z=void 0)}m[1]="format";return(z||q[m.join("-")]).concat()};r.isWeekend=function(m,u){u=d.getWeekend(u);m=(m||new Date).getDay();u.end<u.start&&(u.end+=7,m<u.start&&(m+=7));return m>=u.start&&m<=u.end};r._getDayOfYear=function(m){return c.difference(new Date(m.getFullYear(),0,1,m.getHours()),m)+1};r._getWeekOfYear=function(m,u){1==arguments.length&&(u=0);var t=
(new Date(m.getFullYear(),0,1)).getDay(),q=(t-u+7)%7;q=Math.floor((r._getDayOfYear(m)+q-1)/7);t==u&&q++;return q};return r})},"dojo/date":function(){define(["./has","./_base/lang"],function(a,b){var c={getDaysInMonth:function(d){var g=d.getMonth();return 1==g&&c.isLeapYear(d)?29:[31,28,31,30,31,30,31,31,30,31,30,31][g]},isLeapYear:function(d){d=d.getFullYear();return!(d%400)||!(d%4)&&!!(d%100)},getTimezoneName:function(d){var g=d.toString(),x="",w=g.indexOf("(");if(-1<w)x=g.substring(++w,g.indexOf(")"));
else if(w=/([A-Z\/]+) \d{4}$/,g=g.match(w))x=g[1];else if(g=d.toLocaleString(),w=/ ([A-Z\/]+)$/,g=g.match(w))x=g[1];return"AM"==x||"PM"==x?"":x},compare:function(d,g,x){d=new Date(+d);g=new Date(+(g||new Date));"date"==x?(d.setHours(0,0,0,0),g.setHours(0,0,0,0)):"time"==x&&(d.setFullYear(0,0,0),g.setFullYear(0,0,0));return d>g?1:d<g?-1:0},add:function(d,g,x){var w=new Date(+d),l=!1,n="Date";switch(g){case "day":break;case "weekday":if(g=x%5)var f=parseInt(x/5);else g=0<x?5:-5,f=0<x?(x-5)/5:(x+5)/
5;var e=d.getDay(),k=0;6==e&&0<x?k=1:0==e&&0>x&&(k=-1);e+=g;if(0==e||6==e)k=0<x?2:-2;x=7*f+g+k;break;case "year":n="FullYear";l=!0;break;case "week":x*=7;break;case "quarter":x*=3;case "month":l=!0;n="Month";break;default:n="UTC"+g.charAt(0).toUpperCase()+g.substring(1)+"s"}if(n)w["set"+n](w["get"+n]()+x);l&&w.getDate()<d.getDate()&&w.setDate(0);return w},difference:function(d,g,x){g=g||new Date;x=x||"day";var w=g.getFullYear()-d.getFullYear(),l=1;switch(x){case "quarter":d=d.getMonth();g=g.getMonth();
l=Math.floor(g/3)+1+4*w-(Math.floor(d/3)+1);break;case "weekday":w=Math.round(c.difference(d,g,"day"));x=parseInt(c.difference(d,g,"week"));if(0==w%7)w=5*x;else{l=0;var n=d.getDay(),f=g.getDay();x=parseInt(w/7);g=w%7;d=new Date(d);d.setDate(d.getDate()+7*x);d=d.getDay();if(0<w)switch(!0){case 6==n:l=-1;break;case 0==n:l=0;break;case 6==f:l=-1;break;case 0==f:l=-2;break;case 5<d+g:l=-2}else if(0>w)switch(!0){case 6==n:l=0;break;case 0==n:l=1;break;case 6==f:l=2;break;case 0==f:l=1;break;case 0>d+g:l=
2}w=w+l-2*x}l=w;break;case "year":l=w;break;case "month":l=g.getMonth()-d.getMonth()+12*w;break;case "week":l=parseInt(c.difference(d,g,"day")/7);break;case "day":l/=24;case "hour":l/=60;case "minute":l/=60;case "second":l/=1E3;case "millisecond":l*=g.getTime()-d.getTime()}return Math.round(l)}};b.mixin(b.getObject("dojo.date",!0),c);return c})},"dojo/cldr/supplemental":function(){define(["../_base/lang","../i18n"],function(a,b){var c={};a.setObject("dojo.cldr.supplemental",c);c.getFirstDayOfWeek=
function(d){d={bd:5,mv:5,ae:6,af:6,bh:6,dj:6,dz:6,eg:6,iq:6,ir:6,jo:6,kw:6,ly:6,ma:6,om:6,qa:6,sa:6,sd:6,sy:6,ye:6,ag:0,ar:0,as:0,au:0,br:0,bs:0,bt:0,bw:0,by:0,bz:0,ca:0,cn:0,co:0,dm:0,"do":0,et:0,gt:0,gu:0,hk:0,hn:0,id:0,ie:0,il:0,"in":0,jm:0,jp:0,ke:0,kh:0,kr:0,la:0,mh:0,mm:0,mo:0,mt:0,mx:0,mz:0,ni:0,np:0,nz:0,pa:0,pe:0,ph:0,pk:0,pr:0,py:0,sg:0,sv:0,th:0,tn:0,tt:0,tw:0,um:0,us:0,ve:0,vi:0,ws:0,za:0,zw:0}[c._region(d)];return void 0===d?1:d};c._region=function(d){d=b.normalizeLocale(d);d=d.split("-");
var g=d[1];g?4==g.length&&(g=d[2]):g={aa:"et",ab:"ge",af:"za",ak:"gh",am:"et",ar:"eg",as:"in",av:"ru",ay:"bo",az:"az",ba:"ru",be:"by",bg:"bg",bi:"vu",bm:"ml",bn:"bd",bo:"cn",br:"fr",bs:"ba",ca:"es",ce:"ru",ch:"gu",co:"fr",cr:"ca",cs:"cz",cv:"ru",cy:"gb",da:"dk",de:"de",dv:"mv",dz:"bt",ee:"gh",el:"gr",en:"us",es:"es",et:"ee",eu:"es",fa:"ir",ff:"sn",fi:"fi",fj:"fj",fo:"fo",fr:"fr",fy:"nl",ga:"ie",gd:"gb",gl:"es",gn:"py",gu:"in",gv:"gb",ha:"ng",he:"il",hi:"in",ho:"pg",hr:"hr",ht:"ht",hu:"hu",hy:"am",
ia:"fr",id:"id",ig:"ng",ii:"cn",ik:"us","in":"id",is:"is",it:"it",iu:"ca",iw:"il",ja:"jp",ji:"ua",jv:"id",jw:"id",ka:"ge",kg:"cd",ki:"ke",kj:"na",kk:"kz",kl:"gl",km:"kh",kn:"in",ko:"kr",ks:"in",ku:"tr",kv:"ru",kw:"gb",ky:"kg",la:"va",lb:"lu",lg:"ug",li:"nl",ln:"cd",lo:"la",lt:"lt",lu:"cd",lv:"lv",mg:"mg",mh:"mh",mi:"nz",mk:"mk",ml:"in",mn:"mn",mo:"ro",mr:"in",ms:"my",mt:"mt",my:"mm",na:"nr",nb:"no",nd:"zw",ne:"np",ng:"na",nl:"nl",nn:"no",no:"no",nr:"za",nv:"us",ny:"mw",oc:"fr",om:"et",or:"in",os:"ge",
pa:"in",pl:"pl",ps:"af",pt:"br",qu:"pe",rm:"ch",rn:"bi",ro:"ro",ru:"ru",rw:"rw",sa:"in",sd:"in",se:"no",sg:"cf",si:"lk",sk:"sk",sl:"si",sm:"ws",sn:"zw",so:"so",sq:"al",sr:"rs",ss:"za",st:"za",su:"id",sv:"se",sw:"tz",ta:"in",te:"in",tg:"tj",th:"th",ti:"et",tk:"tm",tl:"ph",tn:"za",to:"to",tr:"tr",ts:"za",tt:"ru",ty:"pf",ug:"cn",uk:"ua",ur:"pk",uz:"uz",ve:"za",vi:"vn",wa:"be",wo:"sn",xh:"za",yi:"il",yo:"ng",za:"cn",zh:"cn",zu:"za",ace:"id",ady:"ru",agq:"cm",alt:"ru",amo:"ng",asa:"tz",ast:"es",awa:"in",
bal:"pk",ban:"id",bas:"cm",bax:"cm",bbc:"id",bem:"zm",bez:"tz",bfq:"in",bft:"pk",bfy:"in",bhb:"in",bho:"in",bik:"ph",bin:"ng",bjj:"in",bku:"ph",bqv:"ci",bra:"in",brx:"in",bss:"cm",btv:"pk",bua:"ru",buc:"yt",bug:"id",bya:"id",byn:"er",cch:"ng",ccp:"in",ceb:"ph",cgg:"ug",chk:"fm",chm:"ru",chp:"ca",chr:"us",cja:"kh",cjm:"vn",ckb:"iq",crk:"ca",csb:"pl",dar:"ru",dav:"ke",den:"ca",dgr:"ca",dje:"ne",doi:"in",dsb:"de",dua:"cm",dyo:"sn",dyu:"bf",ebu:"ke",efi:"ng",ewo:"cm",fan:"gq",fil:"ph",fon:"bj",fur:"it",
gaa:"gh",gag:"md",gbm:"in",gcr:"gf",gez:"et",gil:"ki",gon:"in",gor:"id",grt:"in",gsw:"ch",guz:"ke",gwi:"ca",haw:"us",hil:"ph",hne:"in",hnn:"ph",hoc:"in",hoj:"in",ibb:"ng",ilo:"ph",inh:"ru",jgo:"cm",jmc:"tz",kaa:"uz",kab:"dz",kaj:"ng",kam:"ke",kbd:"ru",kcg:"ng",kde:"tz",kdt:"th",kea:"cv",ken:"cm",kfo:"ci",kfr:"in",kha:"in",khb:"cn",khq:"ml",kht:"in",kkj:"cm",kln:"ke",kmb:"ao",koi:"ru",kok:"in",kos:"fm",kpe:"lr",krc:"ru",kri:"sl",krl:"ru",kru:"in",ksb:"tz",ksf:"cm",ksh:"de",kum:"ru",lag:"tz",lah:"pk",
lbe:"ru",lcp:"cn",lep:"in",lez:"ru",lif:"np",lis:"cn",lki:"ir",lmn:"in",lol:"cd",lua:"cd",luo:"ke",luy:"ke",lwl:"th",mad:"id",mag:"in",mai:"in",mak:"id",man:"gn",mas:"ke",mdf:"ru",mdh:"ph",mdr:"id",men:"sl",mer:"ke",mfe:"mu",mgh:"mz",mgo:"cm",min:"id",mni:"in",mnk:"gm",mnw:"mm",mos:"bf",mua:"cm",mwr:"in",myv:"ru",nap:"it",naq:"na",nds:"de","new":"np",niu:"nu",nmg:"cm",nnh:"cm",nod:"th",nso:"za",nus:"sd",nym:"tz",nyn:"ug",pag:"ph",pam:"ph",pap:"bq",pau:"pw",pon:"fm",prd:"ir",raj:"in",rcf:"re",rej:"id",
rjs:"np",rkt:"in",rof:"tz",rwk:"tz",saf:"gh",sah:"ru",saq:"ke",sas:"id",sat:"in",saz:"in",sbp:"tz",scn:"it",sco:"gb",sdh:"ir",seh:"mz",ses:"ml",shi:"ma",shn:"mm",sid:"et",sma:"se",smj:"se",smn:"fi",sms:"fi",snk:"ml",srn:"sr",srr:"sn",ssy:"er",suk:"tz",sus:"gn",swb:"yt",swc:"cd",syl:"bd",syr:"sy",tbw:"ph",tcy:"in",tdd:"cn",tem:"sl",teo:"ug",tet:"tl",tig:"er",tiv:"ng",tkl:"tk",tmh:"ne",tpi:"pg",trv:"tw",tsg:"ph",tts:"th",tum:"mw",tvl:"tv",twq:"ne",tyv:"ru",tzm:"ma",udm:"ru",uli:"fm",umb:"ao",unr:"in",
unx:"in",vai:"lr",vun:"tz",wae:"ch",wal:"et",war:"ph",xog:"ug",xsr:"np",yao:"mz",yap:"fm",yav:"cm",zza:"tr"}[d[0]];return g};c.getWeekend=function(d){var g=c._region(d);d={"in":0,af:4,dz:4,ir:4,om:4,sa:4,ye:4,ae:5,bh:5,eg:5,il:5,iq:5,jo:5,kw:5,ly:5,ma:5,qa:5,sd:5,sy:5,tn:5}[g];g={af:5,dz:5,ir:5,om:5,sa:5,ye:5,ae:6,bh:5,eg:6,il:6,iq:6,jo:6,kw:6,ly:6,ma:6,qa:6,sd:6,sy:6,tn:6}[g];void 0===d&&(d=6);void 0===g&&(g=0);return{start:d,end:g}};return c})},"dojox/encoding/base64":function(){define(["dojo/_base/lang"],
function(a){a=a.getObject("dojox.encoding.base64",!0);a.encode=function(b){var c=[],d=b.length,g=d%3;d-=g;for(var x=0;x<d;){var w=b[x++]<<16|b[x++]<<8|b[x++];c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(w>>>18&63));c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(w>>>12&63));c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(w>>>6&63));c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(w&
63))}switch(g){case 2:w=b[x++]<<16|b[x++]<<8;c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(w>>>18&63));c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(w>>>12&63));c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(w>>>6&63));c.push("\x3d");break;case 1:w=b[x++]<<16,c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(w>>>18&63)),c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(w>>>
12&63)),c.push("\x3d"),c.push("\x3d")}return c.join("")};a.decode=function(b){b=b.split("");for(var c=[],d=b.length;"\x3d"==b[--d];);for(var g=0;g<d;){var x="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(b[g++])<<18;g<=d&&(x|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(b[g++])<<12);g<=d&&(x|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(b[g++])<<6);g<=d&&(x|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(b[g++]));
c.push(x>>>16&255);c.push(x>>>8&255);c.push(x&255)}for(;0==c[c.length-1];)c.pop();return c};return a})},"esri/tasks/GeometryService":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ../rest/geometryService/areasAndLengths ../rest/geometryService/autoComplete ../rest/geometryService/buffer ../rest/geometryService/convexHull ../rest/geometryService/cut ../rest/geometryService/densify ../rest/geometryService/difference ../rest/geometryService/distance ../rest/geometryService/fromGeoCoordinateString ../rest/geometryService/generalize ../rest/geometryService/intersect ../rest/geometryService/labelPoints ../rest/geometryService/lengths ../rest/geometryService/offset ../rest/geometryService/project ../rest/geometryService/relation ../rest/geometryService/reshape ../rest/geometryService/simplify ../rest/geometryService/toGeoCoordinateString ../rest/geometryService/trimExtend ../rest/geometryService/union ../rest/geometryService/units ./Task".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E,C,D,F,G,J){d=function(I){function O(K){K=I.call(this,K)||this;K.url=null;return K}a._inheritsLoose(O,I);var P=O.prototype;P.areasAndLengths=function(K,M){return l.areasAndLengths(this.url,K,M)};P.autoComplete=function(K,M,U){return n.autoComplete(this.url,K,M,U)};P.buffer=function(K,M){return f.buffer(this.url,K,M)};P.convexHull=function(K,M){return e.convexHull(this.url,K,M)};P.cut=function(K,M,U){return k.cut(this.url,K,M,U)};P.densify=
function(K,M){return r.densify(this.url,K,M)};P.difference=function(K,M,U){return y.difference(this.url,K,M,U)};P.distance=function(K,M){return p.distance(this.url,K,M)};P.fromGeoCoordinateString=function(K,M){return h.fromGeoCoordinateString(this.url,K,M)};P.generalize=function(K,M){return m.generalize(this.url,K,M)};P.intersect=function(K,M,U){return u.intersect(this.url,K,M,U)};P.labelPoints=function(K,M){return t.labelPoints(this.url,K,M)};P.lengths=function(K,M){return q.lengths(this.url,K,M)};
P.offset=function(K,M){return z.offset(this.url,K,M)};P.project=function(K,M){return v.project(this.url,K,M)};P.relation=function(K,M){return B.relation(this.url,K,M)};P.reshape=function(K,M,U){return A.reshape(this.url,K,M,U)};P.simplify=function(K,M){return E.simplify(this.url,K,M)};P.toGeoCoordinateString=function(K,M){return C.toGeoCoordinateString(this.url,K,M)};P.trimExtend=function(K,M){return D.trimExtend(this.url,K,M)};P.union=function(K,M){return F.union(this.url,K,M)};return O}(J);d.UNIT_METER=
9001;d.UNIT_GERMAN_METER=9031;d.UNIT_FOOT=9002;d.UNIT_SURVEY_FOOT=9003;d.UNIT_CLARKE_FOOT=9005;d.UNIT_FATHOM=9014;d.UNIT_NAUTICAL_MILE=9030;d.UNIT_SURVEY_CHAIN=9033;d.UNIT_SURVEY_LINK=9034;d.UNIT_SURVEY_MILE=9035;d.UNIT_KILOMETER=9036;d.UNIT_CLARKE_YARD=9037;d.UNIT_CLARKE_CHAIN=9038;d.UNIT_CLARKE_LINK=9039;d.UNIT_SEARS_YARD=9040;d.UNIT_SEARS_FOOT=9041;d.UNIT_SEARS_CHAIN=9042;d.UNIT_SEARS_LINK=9043;d.UNIT_BENOIT_1895A_YARD=9050;d.UNIT_BENOIT_1895A_FOOT=9051;d.UNIT_BENOIT_1895A_CHAIN=9052;d.UNIT_BENOIT_1895A_LINK=
9053;d.UNIT_BENOIT_1895B_YARD=9060;d.UNIT_BENOIT_1895B_FOOT=9061;d.UNIT_BENOIT_1895B_CHAIN=9062;d.UNIT_BENOIT_1895B_LINK=9063;d.UNIT_INDIAN_FOOT=9080;d.UNIT_INDIAN_1937_FOOT=9081;d.UNIT_INDIAN_1962_FOOT=9082;d.UNIT_INDIAN_1975_FOOT=9083;d.UNIT_INDIAN_YARD=9084;d.UNIT_INDIAN_1937_YARD=9085;d.UNIT_INDIAN_1962_YARD=9086;d.UNIT_INDIAN_1975_YARD=9087;d.UNIT_FOOT_1865=9070;d.UNIT_RADIAN=9101;d.UNIT_DEGREE=9102;d.UNIT_ARCMINUTE=9103;d.UNIT_ARCSECOND=9104;d.UNIT_GRAD=9105;d.UNIT_GON=9106;d.UNIT_MICRORADIAN=
9109;d.UNIT_ARCMINUTE_CENTESIMAL=9112;d.UNIT_ARCSECOND_CENTESIMAL=9113;d.UNIT_MIL6400=9114;d.UNIT_BRITISH_1936_FOOT=9095;d.UNIT_GOLDCOAST_FOOT=9094;d.UNIT_INTERNATIONAL_CHAIN=109003;d.UNIT_INTERNATIONAL_LINK=109004;d.UNIT_INTERNATIONAL_YARD=109001;d.UNIT_STATUTE_MILE=9093;d.UNIT_SURVEY_YARD=109002;d.UNIT_50KILOMETER_LENGTH=109030;d.UNIT_150KILOMETER_LENGTH=109031;d.UNIT_DECIMETER=109005;d.UNIT_CENTIMETER=109006;d.UNIT_MILLIMETER=109007;d.UNIT_INTERNATIONAL_INCH=109008;d.UNIT_US_SURVEY_INCH=109009;
d.UNIT_INTERNATIONAL_ROD=109010;d.UNIT_US_SURVEY_ROD=109011;d.UNIT_US_NAUTICAL_MILE=109012;d.UNIT_UK_NAUTICAL_MILE=109013;d.UNIT_SQUARE_INCHES="esriSquareInches";d.UNIT_SQUARE_FEET="esriSquareFeet";d.UNIT_SQUARE_YARDS="esriSquareYards";d.UNIT_ACRES="esriAcres";d.UNIT_SQUARE_MILES="esriSquareMiles";d.UNIT_SQUARE_MILLIMETERS="esriSquareMillimeters";d.UNIT_SQUARE_CENTIMETERS="esriSquareCentimeters";d.UNIT_SQUARE_DECIMETERS="esriSquareDecimeters";d.UNIT_SQUARE_METERS="esriSquareMeters";d.UNIT_ARES="esriAres";
d.UNIT_HECTARES="esriHectares";d.UNIT_SQUARE_KILOMETERS="esriSquareKilometers";b.__decorate([c.property()],d.prototype,"url",void 0);return d=b.__decorate([w.subclass("esri.tasks.GeometryService")],d)})},"esri/rest/geometryService/areasAndLengths":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../request","../utils"],function(a,b,c,d){function g(){g=b._asyncToGenerator(function*(x,w,l){x=d.parseUrl(x);w={...x.query,f:"json",...w.toJSON()};l=d.asValidOptions(w,l);return c(x.path+
"/areasAndLengths",l).then(n=>n.data)});return g.apply(this,arguments)}a.areasAndLengths=function(x,w,l){return g.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/rest/geometryService/autoComplete":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../geometry ../../request ../utils ./utils ../../geometry/Polygon".split(" "),function(a,b,c,d,g,x,w){function l(){l=b._asyncToGenerator(function*(n,f,e,k){const r=f[0].spatialReference;n=g.parseUrl(n);
f={...n.query,f:"json",sr:JSON.stringify(r.toJSON()),polygons:JSON.stringify(x.encodeGeometries(f).geometries),polylines:JSON.stringify(x.encodeGeometries(e).geometries)};k=g.asValidOptions(f,k);return d(n.path+"/autoComplete",k).then(({data:y})=>(y.geometries||[]).map(({rings:p})=>new w({spatialReference:r,rings:p})))});return l.apply(this,arguments)}a.autoComplete=function(n,f,e,k){return l.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/rest/geometryService/utils":function(){define(["exports",
"../../geometry/support/jsonUtils"],function(a,b){a.decodeGeometries=function(c,d,g){const x=b.getGeometryType(d);return c.map(w=>{w=x.fromJSON(w);w.spatialReference=g;return w})};a.encodeGeometries=function(c){return{geometryType:b.getJsonType(c[0]),geometries:c.map(d=>d.toJSON())}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/rest/geometryService/buffer":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../geometry ../../request ../utils ../../geometry/Polygon".split(" "),
function(a,b,c,d,g,x){function w(){w=b._asyncToGenerator(function*(l,n,f){l=g.parseUrl(l);const e={...l.query,f:"json",...n.toJSON()},k=n.outSpatialReference||n.geometries[0].spatialReference;n=g.asValidOptions(e,f);return d(l.path+"/buffer",n).then(r=>(r.data.geometries||[]).map(({rings:y})=>new x({spatialReference:k,rings:y})))});return w.apply(this,arguments)}a.buffer=function(l,n,f){return w.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/rest/geometryService/convexHull":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../request ../../geometry/support/jsonUtils ../utils ./utils".split(" "),
function(a,b,c,d,g,x){function w(){w=b._asyncToGenerator(function*(l,n,f){const e=n[0].spatialReference;l=g.parseUrl(l);n={...l.query,f:"json",sr:JSON.stringify(e.toJSON()),geometries:JSON.stringify(x.encodeGeometries(n))};f=g.asValidOptions(n,f);return c(l.path+"/convexHull",f).then(({data:k})=>d.fromJSON(k.geometry).set({spatialReference:e}))});return w.apply(this,arguments)}a.convexHull=function(l,n,f){return w.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/rest/geometryService/cut":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../geometry ../../request ../../geometry/support/jsonUtils ../utils".split(" "),
function(a,b,c,d,g,x){function w(){w=b._asyncToGenerator(function*(l,n,f,e){l=x.parseUrl(l);const k=n[0].spatialReference;n={...e,query:{...l.query,f:"json",sr:JSON.stringify(k),target:JSON.stringify({geometryType:g.getJsonType(n[0]),geometries:n}),cutter:JSON.stringify(f)}};n=yield d(l.path+"/cut",n);const {cutIndexes:r,geometries:y=[]}=n.data;return{cutIndexes:r,geometries:y.map(p=>{p=g.fromJSON(p);p.spatialReference=k;return p})}});return w.apply(this,arguments)}a.cut=function(l,n,f,e){return w.apply(this,
arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/rest/geometryService/densify":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../request","../../geometry/support/jsonUtils","../utils"],function(a,b,c,d,g){function x(){x=b._asyncToGenerator(function*(w,l,n){const f=l.geometries[0].spatialReference;w=g.parseUrl(w);l={...w.query,f:"json",...l.toJSON()};n=g.asValidOptions(l,n);return c(w.path+"/densify",n).then(({data:e})=>(e.geometries||[]).map(k=>d.fromJSON(k).set({spatialReference:f})))});
return x.apply(this,arguments)}a.densify=function(w,l,n){return x.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/rest/geometryService/difference":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../request ../../geometry/support/jsonUtils ../utils ./utils".split(" "),function(a,b,c,d,g,x){function w(){w=b._asyncToGenerator(function*(l,n,f,e){const k=n[0].spatialReference;l=g.parseUrl(l);n={query:{...l.query,f:"json",sr:JSON.stringify(k.toJSON()),
geometries:JSON.stringify(x.encodeGeometries(n)),geometry:JSON.stringify({geometryType:d.getJsonType(f),geometry:f.toJSON()})}};e&&(n={...e,...n});return c(l.path+"/difference",n).then(({data:r})=>(r.geometries||[]).map(y=>d.fromJSON(y).set({spatialReference:k})))});return w.apply(this,arguments)}a.difference=function(l,n,f,e){return w.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/rest/geometryService/distance":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers",
"../../request","../utils"],function(a,b,c,d){function g(){g=b._asyncToGenerator(function*(x,w,l){x=d.parseUrl(x);w={...x.query,f:"json",...w.toJSON()};l=d.asValidOptions(w,l);return c(x.path+"/distance",l).then(({data:n})=>n&&n.distance)});return g.apply(this,arguments)}a.distance=function(x,w,l){return g.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/rest/geometryService/fromGeoCoordinateString":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers",
"../../request","../utils","./units"],function(a,b,c,d,g){function x(){x=b._asyncToGenerator(function*(w,l,n){const f={};f.sr=null!=l.sr&&"object"===typeof l.sr?l.sr.wkid||JSON.stringify(l.sr):l.sr;f.strings=JSON.stringify(l.strings);f.conversionType=g.conversionTypeKebabDict.toJSON(l.conversionType||"mgrs");f.conversionMode=l.conversionMode;w=d.parseUrl(w);n=d.asValidOptions({...w.query,f:"json",...f},n);return c(w.path+"/fromGeoCoordinateString",n).then(({data:e})=>e.coordinates)});return x.apply(this,
arguments)}a.fromGeoCoordinateString=function(w,l,n){return x.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/rest/geometryService/units":function(){define(["exports","../../core/jsonMap"],function(a,b){b=new b.JSONMap({MGRS:"mgrs",USNG:"usng",UTM:"utm",GeoRef:"geo-ref",GARS:"gars",DMS:"dms",DDM:"ddm",DD:"dd"});a.conversionTypeKebabDict=b;a.units={UNIT_METER:9001,UNIT_GERMAN_METER:9031,UNIT_FOOT:9002,UNIT_SURVEY_FOOT:9003,UNIT_CLARKE_FOOT:9005,UNIT_FATHOM:9014,UNIT_NAUTICAL_MILE:9030,
UNIT_SURVEY_CHAIN:9033,UNIT_SURVEY_LINK:9034,UNIT_SURVEY_MILE:9035,UNIT_KILOMETER:9036,UNIT_CLARKE_YARD:9037,UNIT_CLARKE_CHAIN:9038,UNIT_CLARKE_LINK:9039,UNIT_SEARS_YARD:9040,UNIT_SEARS_FOOT:9041,UNIT_SEARS_CHAIN:9042,UNIT_SEARS_LINK:9043,UNIT_BENOIT_1895A_YARD:9050,UNIT_BENOIT_1895A_FOOT:9051,UNIT_BENOIT_1895A_CHAIN:9052,UNIT_BENOIT_1895A_LINK:9053,UNIT_BENOIT_1895B_YARD:9060,UNIT_BENOIT_1895B_FOOT:9061,UNIT_BENOIT_1895B_CHAIN:9062,UNIT_BENOIT_1895B_LINK:9063,UNIT_INDIAN_FOOT:9080,UNIT_INDIAN_1937_FOOT:9081,
UNIT_INDIAN_1962_FOOT:9082,UNIT_INDIAN_1975_FOOT:9083,UNIT_INDIAN_YARD:9084,UNIT_INDIAN_1937_YARD:9085,UNIT_INDIAN_1962_YARD:9086,UNIT_INDIAN_1975_YARD:9087,UNIT_FOOT_1865:9070,UNIT_RADIAN:9101,UNIT_DEGREE:9102,UNIT_ARCMINUTE:9103,UNIT_ARCSECOND:9104,UNIT_GRAD:9105,UNIT_GON:9106,UNIT_MICRORADIAN:9109,UNIT_ARCMINUTE_CENTESIMAL:9112,UNIT_ARCSECOND_CENTESIMAL:9113,UNIT_MIL6400:9114,UNIT_BRITISH_1936_FOOT:9095,UNIT_GOLDCOAST_FOOT:9094,UNIT_INTERNATIONAL_CHAIN:109003,UNIT_INTERNATIONAL_LINK:109004,UNIT_INTERNATIONAL_YARD:109001,
UNIT_STATUTE_MILE:9093,UNIT_SURVEY_YARD:109002,UNIT_50KILOMETER_LENGTH:109030,UNIT_150KILOMETER_LENGTH:109031,UNIT_DECIMETER:109005,UNIT_CENTIMETER:109006,UNIT_MILLIMETER:109007,UNIT_INTERNATIONAL_INCH:109008,UNIT_US_SURVEY_INCH:109009,UNIT_INTERNATIONAL_ROD:109010,UNIT_US_SURVEY_ROD:109011,UNIT_US_NAUTICAL_MILE:109012,UNIT_UK_NAUTICAL_MILE:109013,UNIT_SQUARE_INCHES:"esriSquareInches",UNIT_SQUARE_FEET:"esriSquareFeet",UNIT_SQUARE_YARDS:"esriSquareYards",UNIT_ACRES:"esriAcres",UNIT_SQUARE_MILES:"esriSquareMiles",
UNIT_SQUARE_MILLIMETERS:"esriSquareMillimeters",UNIT_SQUARE_CENTIMETERS:"esriSquareCentimeters",UNIT_SQUARE_DECIMETERS:"esriSquareDecimeters",UNIT_SQUARE_METERS:"esriSquareMeters",UNIT_ARES:"esriAres",UNIT_HECTARES:"esriHectares",UNIT_SQUARE_KILOMETERS:"esriSquareKilometers"};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/rest/geometryService/generalize":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../request ../../geometry/support/jsonUtils ../utils ../operations/generalize ../support/GeneralizeParameters".split(" "),
function(a,b,c,d,g,x,w){function l(){l=b._asyncToGenerator(function*(n,f,e){f=w.from(f);const k=f.toJSON();f=x.generalizeToRESTParameters(f);n=g.parseUrl(n);const r=k.geometries[0].spatialReference;e=g.asValidOptions({...n.query,f:"json",...f},e);return c(n.path+"/generalize",e).then(({data:y})=>(y.geometries||[]).map(p=>d.fromJSON(p).set({spatialReference:r})))});return l.apply(this,arguments)}a.generalize=function(n,f,e){return l.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/rest/operations/generalize":function(){define(["exports","../../core/jsonMap","../../geometry/support/jsonUtils"],function(a,b,c){const d=new b.JSONMap({109006:"centimeters",9102:"decimal-degrees",109005:"decimeters",9002:"feet",109009:"inches",9036:"kilometers",9001:"meters",9035:"miles",109007:"millimeters",109012:"nautical-miles",9096:"yards"});a.generalizeToRESTParameters=function(g){const {geometries:x,deviationUnit:w,maxDeviation:l}=g.toJSON();g={maxDeviation:l};x&&x.length&&(g.geometries=
JSON.stringify({geometryType:c.getJsonType(x[0]),geometries:x}),g.sr=JSON.stringify(x[0].spatialReference));d.write(w,g,"deviationUnit");return g};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/rest/support/GeneralizeParameters":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../geometry/support/jsonUtils".split(" "),
function(a,b,c,d,g,x,w,l,n){c=function(f){function e(k){k=f.call(this,k)||this;k.deviationUnit=null;k.geometries=null;k.maxDeviation=null;return k}a._inheritsLoose(e,f);return e}(c.JSONSupport);b.__decorate([d.property({type:String,json:{write:!0}})],c.prototype,"deviationUnit",void 0);b.__decorate([d.property({json:{read:{reader:f=>f?f.map(e=>n.fromJSON(e)):null},write:{writer:(f,e)=>{e.geometries=f.map(k=>k.toJSON())}}}})],c.prototype,"geometries",void 0);b.__decorate([d.property({type:Number,json:{write:!0}})],
c.prototype,"maxDeviation",void 0);c=b.__decorate([l.subclass("esri.rest.support.GeneralizeParameters")],c);c.from=w.ensureType(c);return c})},"esri/rest/geometryService/intersect":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../request ../../geometry/support/jsonUtils ../utils ./utils".split(" "),function(a,b,c,d,g,x){function w(){w=b._asyncToGenerator(function*(l,n,f,e){const k=n[0].spatialReference;l=g.parseUrl(l);n={...l.query,f:"json",sr:JSON.stringify(k.toJSON()),geometries:JSON.stringify(x.encodeGeometries(n)),
geometry:JSON.stringify({geometryType:d.getJsonType(f),geometry:f.toJSON()})};e=g.asValidOptions(n,e);return c(l.path+"/intersect",e).then(({data:r})=>(r.geometries||[]).map(y=>d.fromJSON(y).set({spatialReference:k})))});return w.apply(this,arguments)}a.intersect=function(l,n,f,e){return w.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/rest/geometryService/labelPoints":function(){define(["exports","../../request","../../geometry/support/jsonUtils","../utils"],function(a,
b,c,d){a.labelPoints=function(g,x,w){var l=x.map(f=>f.toJSON());const n=x[0].spatialReference;g=d.parseUrl(g);l={...g.query,f:"json",sr:n.wkid?n.wkid:JSON.stringify(n.toJSON()),polygons:JSON.stringify(l)};w=d.asValidOptions(l,w);return b(g.path+"/labelPoints",w).then(({data:f})=>(f.labelPoints||[]).map(e=>c.fromJSON(e).set({spatialReference:n})))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/rest/geometryService/lengths":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../request ../utils ../operations/lengths ../support/LengthsParameters".split(" "),
function(a,b,c,d,g,x){function w(){w=b._asyncToGenerator(function*(l,n,f){n=x.from(n);n=g.lengthsToRESTParameters(n);l=d.parseUrl(l);f=d.asValidOptions({...l.query,f:"json",...n},f);return c(l.path+"/lengths",f).then(({data:e})=>e)});return w.apply(this,arguments)}a.lengths=function(l,n,f){return w.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/rest/operations/lengths":function(){define(["exports","../../core/jsonMap"],function(a,b){const c=new b.JSONMap({preserveShape:"preserve-shape"});
a.lengthsToRESTParameters=function(d){const {polylines:g,lengthUnit:x,geodesic:w,calculationType:l}=d.toJSON(),n={};n.polylines=JSON.stringify(g);d=d.polylines[0].spatialReference;n.sr=d.wkid?d.wkid:JSON.stringify(d.toJSON());x&&(n.lengthUnit=x);w&&(n.geodesic=w);l&&(n.calculationType=c.toJSON(l));return n};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/rest/support/LengthsParameters":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../geometry/support/jsonUtils ../../geometry/Polyline".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e){c=function(k){function r(y){y=k.call(this,y)||this;y.calculationType=null;y.geodesic=null;y.lengthUnit=null;y.polylines=null;return y}a._inheritsLoose(r,k);return r}(d.JSONSupport);b.__decorate([g.property({type:String,json:{write:!0}})],c.prototype,"calculationType",void 0);b.__decorate([g.property({type:Boolean,json:{write:!0}})],c.prototype,"geodesic",void 0);b.__decorate([g.property({json:{write:!0}})],c.prototype,"lengthUnit",void 0);b.__decorate([g.property({type:[e],
json:{read:{reader:k=>k?k.map(r=>f.fromJSON(r)):null},write:{writer:(k,r)=>{r.polylines=k.map(y=>y.toJSON())}}}})],c.prototype,"polylines",void 0);c=b.__decorate([n.subclass("esri.rest.support.LengthsParameters")],c);c.from=l.ensureType(c);return c})},"esri/rest/geometryService/offset":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../request ../../geometry/support/jsonUtils ../utils ../operations/offset ../support/OffsetParameters".split(" "),function(a,b,c,d,g,x,w){function l(){l=
b._asyncToGenerator(function*(n,f,e){f=w.from(f);const k=x.offsetToRESTParameters(f);n=g.parseUrl(n);const r=f.geometries[0].spatialReference;f=g.asValidOptions({...n.query,f:"json",...k},e);return c(n.path+"/offset",f).then(({data:y})=>(y.geometries||[]).map(p=>d.fromJSON(p).set({spatialReference:r})))});return l.apply(this,arguments)}a.offset=function(n,f,e){return l.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/rest/operations/offset":function(){define(["exports",
"../../core/jsonMap","../../geometry/support/jsonUtils"],function(a,b,c){const d=new b.JSONMap({esriGeometryOffsetBevelled:"bevelled",esriGeometryOffsetMitered:"mitered",esriGeometryOffsetRounded:"rounded"}),g=new b.JSONMap({9001:"meters",9002:"feet",9036:"kilometers",9093:"miles",109012:"nautical-miles",109001:"yards"});a.offsetToRESTParameters=function(x){const {geometries:w,bevelRatio:l,offsetDistance:n,offsetHow:f,offsetUnit:e}=x.toJSON();x={bevelRatio:l,offsetDistance:n};w&&w.length&&(x.geometries=
JSON.stringify({geometryType:c.getJsonType(w[0]),geometries:w}),x.sr=JSON.stringify(w[0].spatialReference));f&&(x.offsetHow=d.toJSON(f));e&&(x.offsetUnit=g.toJSON(e));return x};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/rest/support/OffsetParameters":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../geometry/support/jsonUtils".split(" "),
function(a,b,c,d,g,x,w,l,n){c=function(f){function e(k){k=f.call(this,k)||this;k.bevelRatio=null;k.geometries=null;k.offsetDistance=null;k.offsetHow=null;k.offsetUnit=null;return k}a._inheritsLoose(e,f);return e}(c.JSONSupport);b.__decorate([d.property({type:Number,json:{write:!0}})],c.prototype,"bevelRatio",void 0);b.__decorate([d.property({json:{read:{reader:f=>f?f.map(e=>n.fromJSON(e)):null},write:{writer:(f,e)=>{e.geometries=f.map(k=>k.toJSON())}}}})],c.prototype,"geometries",void 0);b.__decorate([d.property({type:Number,
json:{write:!0}})],c.prototype,"offsetDistance",void 0);b.__decorate([d.property({type:String,json:{write:!0}})],c.prototype,"offsetHow",void 0);b.__decorate([d.property({type:String,json:{write:!0}})],c.prototype,"offsetUnit",void 0);c=b.__decorate([l.subclass("esri.rest.support.OffsetParameters")],c);c.from=w.ensureType(c);return c})},"esri/rest/geometryService/project":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../request ../../core/accessorSupport/ensureType ../../geometry/support/jsonUtils ../utils ./utils ../support/ProjectParameters".split(" "),
function(a,b,c,d,g,x,w,l){function n(){n=b._asyncToGenerator(function*(e,k,r){k=f(k);e=x.parseUrl(e);const y={...e.query,f:"json",...k.toJSON()},p=k.outSpatialReference,h=g.getJsonType(k.geometries[0]);k=x.asValidOptions(y,r);return c(e.path+"/project",k).then(({data:{geometries:m}})=>w.decodeGeometries(m,h,p))});return n.apply(this,arguments)}const f=d.ensureType(l);a.project=function(e,k,r){return n.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/rest/support/ProjectParameters":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../geometry/support/jsonUtils".split(" "),
function(a,b,c,d,g,x,w,l,n){c=function(f){function e(k){k=f.call(this,k)||this;k.geometries=null;k.outSpatialReference=null;k.transformation=null;k.transformForward=null;return k}a._inheritsLoose(e,f);e.prototype.toJSON=function(){const k=this.geometries.map(function(p){return p.toJSON()}),r=this.geometries[0],y={};y.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON());y.inSR=r.spatialReference.wkid||JSON.stringify(r.spatialReference.toJSON());y.geometries=JSON.stringify({geometryType:n.getJsonType(r),
geometries:k});this.transformation&&(y.transformation=this.transformation.wkid||JSON.stringify(this.transformation));null!=this.transformForward&&(y.transformForward=this.transformForward);return y};return e}(c.JSONSupport);b.__decorate([d.property()],c.prototype,"geometries",void 0);b.__decorate([d.property({json:{read:{source:"outSR"}}})],c.prototype,"outSpatialReference",void 0);b.__decorate([d.property()],c.prototype,"transformation",void 0);b.__decorate([d.property()],c.prototype,"transformForward",
void 0);return c=b.__decorate([l.subclass("esri.rest.support.ProjectParameters")],c)})},"esri/rest/geometryService/relation":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../request ../utils ../operations/relation ../support/RelationParameters".split(" "),function(a,b,c,d,g,x){function w(){w=b._asyncToGenerator(function*(l,n,f){n=x.from(n);n=g.relationToRESTParameters(n);l=d.parseUrl(l);f=d.asValidOptions({...l.query,f:"json",...n},f);return c(l.path+"/relation",f).then(({data:e})=>
e.relations)});return w.apply(this,arguments)}a.relation=function(l,n,f){return w.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/rest/operations/relation":function(){define(["exports","../../core/jsonMap","../../geometry/support/jsonUtils"],function(a,b,c){const d=new b.JSONMap({esriGeometryRelationCross:"cross",esriGeometryRelationDisjoint:"disjoint",esriGeometryRelationIn:"in",esriGeometryRelationInteriorIntersection:"interior-intersection",esriGeometryRelationIntersection:"intersection",
esriGeometryRelationLineCoincidence:"line-coincidence",esriGeometryRelationLineTouch:"line-touch",esriGeometryRelationOverlap:"overlap",esriGeometryRelationPointTouch:"point-touch",esriGeometryRelationTouch:"touch",esriGeometryRelationWithin:"within",esriGeometryRelationRelation:"relation"});a.relationToRESTParameters=function(g){const {geometries1:x,geometries2:w,relation:l,relationParameter:n}=g.toJSON();g={};if(x&&x.length){g.geometries1=JSON.stringify({geometryType:c.getJsonType(x[0]),geometries:x});
const f=x[0].spatialReference;g.sr=f.wkid?f.wkid:JSON.stringify(f)}w&&0<w.length&&(g.geometries2=JSON.stringify({geometryType:c.getJsonType(w[0]),geometries:w}));l&&(g.relation=d.toJSON(l));n&&(g.relationParam=n);return g};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/rest/support/RelationParameters":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../geometry/support/jsonUtils".split(" "),
function(a,b,c,d,g,x,w,l,n){c=function(f){function e(k){k=f.call(this,k)||this;k.geometries1=null;k.geometries2=null;k.relation=null;k.relationParameter=null;return k}a._inheritsLoose(e,f);return e}(c.JSONSupport);b.__decorate([d.property({json:{read:{reader:f=>f?f.map(e=>n.fromJSON(e)):null},write:{writer:(f,e)=>{e.geometries1=f.map(k=>k.toJSON())}}}})],c.prototype,"geometries1",void 0);b.__decorate([d.property({json:{read:{reader:f=>f?f.map(e=>n.fromJSON(e)):null},write:{writer:(f,e)=>{e.geometries2=
f.map(k=>k.toJSON())}}}})],c.prototype,"geometries2",void 0);b.__decorate([d.property({type:String,json:{write:!0}})],c.prototype,"relation",void 0);b.__decorate([d.property({type:String,json:{write:!0}})],c.prototype,"relationParameter",void 0);c=b.__decorate([l.subclass("esri.rest.support.RelationParameters")],c);c.from=w.ensureType(c);return c})},"esri/rest/geometryService/reshape":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../request","../../geometry/support/jsonUtils",
"../utils"],function(a,b,c,d,g){function x(){x=b._asyncToGenerator(function*(w,l,n,f){const e=l.spatialReference;w=g.parseUrl(w);l={...w.query,f:"json",sr:JSON.stringify(e.toJSON()),target:JSON.stringify({geometryType:d.getJsonType(l),geometry:l.toJSON()}),reshaper:JSON.stringify(n.toJSON())};f=g.asValidOptions(l,f);return c(w.path+"/reshape",f).then(({data:k})=>d.fromJSON(k.geometry).set({spatialReference:e}))});return x.apply(this,arguments)}a.reshape=function(w,l,n,f){return x.apply(this,arguments)};
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/rest/geometryService/simplify":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../request ../../core/urlUtils ../../geometry/support/jsonUtils ./utils".split(" "),function(a,b,c,d,g,x){function w(){w=b._asyncToGenerator(function*(l,n,f){const e="string"===typeof l?d.urlToObject(l):l;l=n[0].spatialReference;const k=g.getJsonType(n[0]);n={...f,query:{...e.query,f:"json",sr:l.wkid?l.wkid:JSON.stringify(l),geometries:JSON.stringify(x.encodeGeometries(n))}};
({data:n}=yield c(e.path+"/simplify",n));return x.decodeGeometries(n.geometries,k,l)});return w.apply(this,arguments)}a.simplify=function(l,n,f){return w.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/rest/geometryService/toGeoCoordinateString":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../request","../utils","./units"],function(a,b,c,d,g){function x(){x=b._asyncToGenerator(function*(w,l,n){const f={};f.sr=null!=l.sr&&"object"===typeof l.sr?
l.sr.wkid||JSON.stringify(l.sr):l.sr;f.coordinates=JSON.stringify(l.coordinates);f.conversionType=g.conversionTypeKebabDict.toJSON(l.conversionType||"mgrs");f.conversionMode=l.conversionMode;f.numOfDigits=l.numOfDigits;f.rounding=l.rounding;f.addSpaces=l.addSpaces;w=d.parseUrl(w);n=d.asValidOptions({...w.query,f:"json",...f},n);return c(w.path+"/toGeoCoordinateString",n).then(({data:e})=>e.strings)});return x.apply(this,arguments)}a.toGeoCoordinateString=function(w,l,n){return x.apply(this,arguments)};
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/rest/geometryService/trimExtend":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../geometry ../../request ../utils ../operations/trimExtend ../support/TrimExtendParameters ../../geometry/Polyline".split(" "),function(a,b,c,d,g,x,w,l){function n(){n=b._asyncToGenerator(function*(f,e,k){e=w.from(e);const r=x.trimExtendToRESTParameters(e);f=g.parseUrl(f);const y=e.sr;e=g.asValidOptions({...f.query,f:"json",...r},k);return d(f.path+
"/trimExtend",e).then(({data:p})=>(p.geometries||[]).map(({paths:h})=>new l({spatialReference:y,paths:h})))});return n.apply(this,arguments)}a.trimExtend=function(f,e,k){return n.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/rest/operations/trimExtend":function(){define(["exports","../../core/jsonMap"],function(a,b){const c=new b.JSONMap({0:"default-curve-extension",1:"relocate-ends",2:"keep-end-attributes",4:"no-end-attributes",8:"no-extend-at-from",16:"no-extend-at-to"});
a.trimExtendToRESTParameters=function(d){const {extendHow:g,polylines:x,trimExtendTo:w}=d.toJSON();d={};d.extendHow=c.toJSON(g);x&&x.length&&(d.polylines=JSON.stringify(x),d.sr=JSON.stringify(x[0].spatialReference));w&&(d.trimExtendTo=JSON.stringify(w));return d};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/rest/support/TrimExtendParameters":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../geometry/support/jsonUtils ../../geometry/Polyline".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e){c=function(k){function r(y){y=k.call(this,y)||this;y.extendHow="default-curve-extension";y.polylines=null;y.trimExtendTo=null;return y}a._inheritsLoose(r,k);return r}(d.JSONSupport);b.__decorate([g.property({type:String,json:{write:!0}})],c.prototype,"extendHow",void 0);b.__decorate([g.property({type:[e],json:{read:{reader:k=>k?k.map(r=>f.fromJSON(r)):null},write:{writer:(k,r)=>{r.polylines=k.map(y=>y.toJSON())}}}})],c.prototype,"polylines",void 0);b.__decorate([g.property({json:{read:{reader:k=>
k?f.fromJSON(k):null},write:{writer:(k,r)=>{r.trimExtendTo=k.toJSON()}}}})],c.prototype,"trimExtendTo",void 0);c=b.__decorate([n.subclass("esri.rest.support.TrimExtendParameters")],c);c.from=l.ensureType(c);return c})},"esri/rest/geometryService/union":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../request ../../geometry/support/jsonUtils ../utils ./utils".split(" "),function(a,b,c,d,g,x){function w(){w=b._asyncToGenerator(function*(l,n,f){const e=n[0].spatialReference;l=
g.parseUrl(l);n={...l.query,f:"json",sr:JSON.stringify(e.toJSON()),geometries:JSON.stringify(x.encodeGeometries(n))};f=g.asValidOptions(n,f);return c(l.path+"/union",f).then(({data:k})=>d.fromJSON(k.geometry).set({spatialReference:e}))});return w.apply(this,arguments)}a.union=function(l,n,f){return w.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/tasks/support/ProjectParameters":function(){define(["../../core/deprecate","../../core/Logger","../../rest/support/ProjectParameters"],
function(a,b,c){b=b.getLogger("esri.tasks.support.ProjectParameters");a.deprecatedModule(b,"esri.tasks.support.ProjectParameters",{replacement:"esri.rest.support.ProjectParameters",version:"4.20",warnOnce:!0});return c})},"jimu/shared/utils":function(){define(["./basePortalUrlUtils"],function(a){function b(g,x){function w(l,n){var f,e,k="widgetOnScreen"===l;if(g[l]){if(g[l].groups)for(f=0;f<g[l].groups.length;f++){var r=g[l].groups[f];n(r,{index:f,isWidget:!1,groupId:r.id,isThemeWidget:!1,isOnScreen:k});
if(g[l].groups[f].widgets)for(e=0;e<g[l].groups[f].widgets.length;e++){var y=g[l].groups[f].widgets[e];n(y,{index:e,isWidget:!0,groupId:r.id,isThemeWidget:y.uri&&-1<y.uri.indexOf("themes/"+g.theme.name),isOnScreen:k})}}if(g[l].widgets)for(f=0;f<g[l].widgets.length;f++)y=g[l].widgets[f],n(g[l].widgets[f],{index:f,isWidget:!0,groupId:l,isThemeWidget:y.uri&&-1<y.uri.indexOf("themes/"+g.theme.name),isOnScreen:k})}}w("widgetOnScreen",x);w("widgetPool",x)}var c={},d="inPanel hasLocale hasStyle hasConfig hasUIFile hasSettingPage hasSettingUIFile hasSettingLocale hasSettingStyle keepConfigAfterMapSwitched isController hasVersionManager isThemeWidget supportMultiInstance mirrorIconForRTL".split(" ");
c.visitElement=b;c.getConfigElementById=function(g,x){var w;if("map"===x)return g.map;b(g,function(l){if(l.id===x)return w=l,!0});return w};c.getConfigElementByLabel=function(g,x){var w;if("map"===x)return g.map;b(g,function(l){if(l.label||l.name===x)return w=l,!0});return w};c.getConfigElementsByName=function(g,x){var w=[];if("map"===x)return[g.map];b(g,function(l){l.name===x&&w.push(l)});return w};c.getWidgetNameFromUri=function(g){g=g.split("/");g.pop();return g.pop()};c.getAmdFolderFromUri=function(g){g=
g.split("/");g.pop();return g.join("/")+"/"};c.widgetProperties=d;c.processWidgetProperties=function(g){"undefined"===typeof g.properties.isController&&(g.properties.isController=!1);"undefined"===typeof g.properties.isThemeWidget&&(g.properties.isThemeWidget=!1);"undefined"===typeof g.properties.hasVersionManager&&(g.properties.hasVersionManager=!1);"undefined"===typeof g.properties.mirrorIconForRTL&&(g.properties.mirrorIconForRTL=!1);d.forEach(function(x){"undefined"===typeof g.properties[x]&&(g.properties[x]=
!0)})};c.getControllerWidgets=function(g){var x=[];g.visitElement(function(w){w.isController&&x.push(w)});return x};c.isHostedService=function(g){var x=a.getServerByUrl(g);return(new RegExp(x+"/[^/]+/[^/]+/rest/services","gi")).test(g)};return c})},"jimu/shared/basePortalUrlUtils":function(){define(function(){var a={declaredClass:"jimu.shared.basePortalUrlUtils"};"function"!==typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s*/gi,"").replace(/\s*$/gi,"")});"function"!==
typeof String.prototype.startWith&&(String.prototype.startWith=function(b){return this.substr(0,b.length)===b});"function"!==typeof String.prototype.endWith&&(String.prototype.endWith=function(b){return this.substr(this.length-b.length,b.length)===b});a.getServerByUrl=function(b){b=(b||"").trim();b=b.replace(/^(http(s?):?)\/\//gi,"");0===b.indexOf("//")&&(b=b.slice(2));return b.split("/")[0]};a.getServerWithProtocol=function(b){var c="";if(b=(b||"").trim()){var d=a.getServerByUrl(b);if(!d)return c;
var g=a.getProtocol(b);g?c=g+"://"+d:0===b.indexOf("//")&&(c="//"+d)}return c};a.isSameServer=function(b,c){b=a.getServerByUrl(b)||"";c=a.getServerByUrl(c)||"";return b.toLowerCase()===c.toLowerCase()};a.isOnline=function(b){return 0<=a.getServerByUrl(b).toLowerCase().indexOf(".arcgis.com")};a.isArcGIScom=function(b){b=a.getServerByUrl(b).toLowerCase();return"www.arcgis.com"===b||"arcgis.com"===b};a.getStandardPortalUrl=function(b){var c=a.getServerByUrl(b);if(""===c)return"";a.isOnline(c)?(a.isArcGIScom(c)&&
(c="www.arcgis.com"),b=a.addProtocol(b),b=a.getProtocol(b)+"://"+c):(b=(b||"").trim().replace(/sharing(.*)/gi,"").replace(/\/*$/g,""),b=a.addProtocol(b),b.replace(new RegExp("http(s?)://"+c,"g"),"")||(b+="/arcgis"));return b};a.isSamePortalUrl=function(b,c){var d=/^http(s?):\/\//gi,g=/^\/\//gi;b=a.getStandardPortalUrl(b).toLowerCase().replace(d,"").replace(g,"");c=a.getStandardPortalUrl(c).toLowerCase().replace(d,"").replace(g,"");return b===c};a.addProtocol=function(b){if(-1>=b.toLowerCase().indexOf("http://")&&
-1>=b.toLowerCase().indexOf("https://")){var c="";"undefined"!==typeof window&&window.location?(c=window.location.protocol,b=b.startWith("//")?c+b:b.startWith("/")?c+"//"+window.location.host+b:c+"//"+b):(c="http:",b.startWith("//")&&(b=c+b))}return b};a.getProtocol=function(b){var c="";b=b.toLowerCase();0===b.indexOf("https://")?c="https":0===b.indexOf("http://")&&(c="http");return c};a.updateUrlProtocolByOtherUrl=function(b,c){c=c.toLowerCase();0===c.indexOf("https://")?b=a.setHttpsProtocol(b):
0===c.indexOf("http://")&&(b=a.setHttpProtocol(b));return b};a.removeProtocol=function(b){return b.replace(/^http(s?):\/\//i,"//")};a.setHttpProtocol=function(b){b=a.addProtocol(b);return b.replace(/^https:\/\//,"http://")};a.setHttpsProtocol=function(b){b=a.addProtocol(b);return b.replace(/^http:\/\//,"https://")};a.setProtocol=function(b,c){return 0<=c.indexOf("https")?a.setHttpsProtocol(b):0<=c.indexOf("http")?a.setHttpProtocol(b):b};a.getSharingUrl=function(b){var c="";(b=a.getStandardPortalUrl(b))&&
(c=b+"/sharing");return c};a.getOAuth2Url=function(b){var c="";(b=a.getStandardPortalUrl(b))&&(c=b+"/sharing/oauth2");return c};a.getAppIdUrl=function(b,c){var d="";(b=a.getStandardPortalUrl(b))&&(d=b+"/sharing/oauth2/apps/"+c);return d};a.getSignInUrl=function(b){var c="";(b=a.getStandardPortalUrl(b))&&(c=b+"/home/signin.html");return c};a.getBaseSearchUrl=function(b){var c="";b=a.getStandardPortalUrl(b);(b=b.replace(/\/*$/g,""))&&(c=b+"/sharing/rest/search");return c};a.getBaseItemUrl=function(b){var c=
"";(b=a.getStandardPortalUrl(b))&&(c=b+"/sharing/rest/content/items");return c};a.getItemUrl=function(b,c){var d="";(b=a.getBaseItemUrl(b))&&c&&(d=b+"/"+c);return d};a.getItemDataUrl=function(b,c){var d="";(b=a.getItemUrl(b,c))&&(d=b+"/data");return d};a.getGenerateTokenUrl=function(b){var c="";b&&(b=a.getStandardPortalUrl(b),c=b+"/sharing/generateToken");return c};a.getItemDetailsPageUrl=function(b,c){var d="";b&&c&&(b=a.getStandardPortalUrl(b),d=b+"/home/item.html?id\x3d"+c);return d};a.getUserProfilePageUrl=
function(b,c){var d="";b&&c&&(b=a.getStandardPortalUrl(b),d=b+"/home/user.html?user\x3d"+c);return d};a.getBaseGroupUrl=function(b){var c="";(b=a.getStandardPortalUrl(b))&&(c=b+"/sharing/rest/community/groups");return c};a.getPortalSelfInfoUrl=function(b){var c="";(b=a.getStandardPortalUrl(b||""))&&(c=b+"/sharing/portals/self");return c};a.getCommunitySelfUrl=function(b){var c="";(b=a.getStandardPortalUrl(b||""))&&(c=b+"/sharing/rest/community/self");return c};a.getBaseUserUrl=function(b){var c="";
(b=a.getStandardPortalUrl(b))&&(c=b+"/sharing/rest/community/users");return c};a.getUserUrl=function(b,c){var d="",g=a.getBaseUserUrl(b);b&&c&&(d=g+"/"+c);return d};a.getUserTagsUrl=function(b,c){var d="",g=a.getUserUrl(b,c);b&&c&&(d=g+"/tags");return d};a.getUserThumbnailUrl=function(b,c,d){var g="";(b=a.getUserUrl(b,c))&&d&&(g=b+"/info/"+d);return g};a.getContentUrl=function(b){var c="";b&&(b=a.getStandardPortalUrl(b),c=b+"/sharing/rest/content");return c};a.getUserContentUrl=function(b,c,d){var g=
"";g="";b&&c&&(g=a.getContentUrl(b),g=d?g+"/users/"+c+"/"+d:g+"/users/"+c);return g};a.getUserContentItemUrl=function(b,c,d){var g="";g="";b&&c&&d&&(g=a.getUserContentUrl(b,c),g=g+"/items/"+d);return g};a.getItemResourceUrl=function(b,c,d){var g="";g="";b&&c&&(g=a.getContentUrl(b),g=d?g+"/items/"+c+"/resources/"+d:g+"/items/"+c+"/resources");return g};a.getAddItemUrl=function(b,c,d){var g="";g="";b&&c&&(g=a.getUserContentUrl(b,c,d),g+="/addItem");return g};a.getDeleteItemUrl=function(b,c,d){var g=
"";(b=a.getUserItemsUrl(b,c))&&(g=b+"/"+d+"/delete");return g};a.getUserItemsUrl=function(b,c,d){var g="";g="";b&&c&&(g=a.getUserContentUrl(b,c,d),g+="/items");return g};a.getUpdateItemUrl=function(b,c,d,g){var x="";x="";b&&c&&(x=a.getUserItemsUrl(b,c,g),x=x+"/"+d+"/update");return x};a.shareItemUrl=function(b,c,d,g){var x="";x="";b&&c&&(x=a.getUserItemsUrl(b,c,g),x=x+"/"+d+"/share");return x};a.getHomeIndexUrl=function(b){var c="";(b=a.getStandardPortalUrl(b))&&(c=b+"/home/index.html");return c};
a.getHomeMapViewerUrl=function(b,c){var d="";if(b=a.getStandardPortalUrl(b))d=b+"/home/webmap/viewer.html",d=c?d+("?webmap\x3d"+c):d+"?useExisting\x3d1";return d};a.getHomeGalleryUrl=function(b){var c="";(b=a.getStandardPortalUrl(b))&&(c=b+"/home/gallery.html");return c};a.getHomeGroupsUrl=function(b){var c="";(b=a.getStandardPortalUrl(b))&&(c=b+"/home/groups.html");return c};a.getHomeMyContentUrl=function(b){var c="";(b=a.getStandardPortalUrl(b))&&(c=b+"/home/content.html");return c};a.getHomeMyOrganizationUrl=
function(b){var c="";(b=a.getStandardPortalUrl(b))&&(c=b+"/home/organization.html");return c};a.getHomeUserUrl=function(b){var c="";(b=a.getStandardPortalUrl(b))&&(c=b+"/home/user.html");return c};a.getPortalHelpUrl=function(b,c){var d="";(b=a.getStandardPortalUrl(b))&&(d=b+"/portalhelp/"+(c||"en")+"/portal/");return d};a.getPortalAdminHelpUrl=function(b,c){var d="";(b=a.getStandardPortalUrl(b))&&(d=b+"/portalhelp/"+(c||"en")+"/admin/help/");return d};a.getPortalProxyUrl=function(b){var c="";(b=a.getStandardPortalUrl(b))&&
(c=b+"/sharing/proxy");return c};a.getOAuth2SignOutUrl=function(b){var c="";(b=a.getStandardPortalUrl(b))&&(c=b+"/sharing/oauth2/signout");return c};a.getNewPrintUrl=function(b){var c="";if(b=a.getStandardPortalUrl(b))b=a.setHttpProtocol(b),c=b+"/sharing/tools/newPrint";return c};a.getArcgisOnlineUrl=function(b){return b.endsWith("mapsdevext.arcgis.com")||b.endsWith("mapsdevext.arcgis.com/")?"https://devext.arcgis.com":b.endsWith("mapsqa.arcgis.com")||b.endsWith("mapsqa.arcgis.com/")?"https://qaext.arcgis.com":
"https://www.arcgis.com"};return a})},"jimu/WidgetManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/Deferred dojo/topic dojo/Evented dojo/on dojo/aspect dojo/json dojo/query dojo/request/xhr dojo/promise/all ./utils jimu/tokenUtils ./dijit/Message ./portalUrlUtils ./portalUtils".split(" "),function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u){var t=null,q=a(w,{constructor:function(){this.loaded=[];this.missedActions=[];this.activeWidget=null;this.widgetsUri=
{};window.isBuilder?(x.subscribe("app/sceneViewLoaded",b.hitch(this,this._onSceneViewLoaded)),x.subscribe("app/sceneViewChanged",b.hitch(this,this._onSceneViewChanged))):(x.subscribe("sceneViewLoaded",b.hitch(this,this._onSceneViewLoaded)),x.subscribe("sceneViewChanged",b.hitch(this,this._onSceneViewChanged)));window.isBuilder?(x.subscribe("app/appConfigLoaded",b.hitch(this,this._onAppConfigLoaded)),x.subscribe("app/appConfigChanged",b.hitch(this,this._onAppConfigChanged))):(x.subscribe("appConfigLoaded",
b.hitch(this,this._onAppConfigLoaded)),x.subscribe("appConfigChanged",b.hitch(this,this._onAppConfigChanged)));x.subscribe("userSignIn",b.hitch(this,this._onUserSignIn));x.subscribe("userSignOut",b.hitch(this,this._onUserSignOut));x.subscribe("builder/actionTriggered",b.hitch(this,this._onActionTriggered));x.subscribe("/dnd/move/start",b.hitch(this,this._onMoveStart))},loadWidget:function(z){var v=new g,B;z=b.clone(z);z.folderUrl||y.processWidgetSetting(z);(B=this.getWidgetById(z.id))?v.resolve(B):
this.getWidgetUri(z).then(b.hitch(this,function(A){z.uri=A;r([this.loadWidgetClass(z),this.loadWidgetManifest(z)]).then(b.hitch(this,function(E){var C=E[0],D=E[1];this.loadWidgetResources(D).then(b.hitch(this,function(F){try{var G=this.createWidget(D,C,F);console.log("widget ["+D.uri+"] created.")}catch(J){console.log("create ["+D.uri+"] error:"+J.stack),new h({message:window.jimuNls.createWidgetError+": "+D.uri}),v.reject(J)}setTimeout(b.hitch(this,function(){v.resolve(G);this.emit("widget-created",
G);x.publish("widgetCreated",G)}),50)}),function(F){v.reject(F)})}),function(E){v.reject(E)})}));return v},loadWidgetClass:function(z){var v=new g;var B=z.isRemote?z.uri+".js":z.uri;require(y.getRequireConfig(),[B],b.hitch(this,function(A){v.resolve(A)}));y.checkError(z.uri,v);return v},loadWidgetResources:function(z){var v=new g,B=[];var A=b.clone(z);z=this.tryLoadWidgetConfig(A);var E=this._tryLoadResource(A,"i18n");var C=this._tryLoadResource(A,"style");A=this._tryLoadResource(A,"template");B.push(z);
B.push(E);B.push(A);B.push(C);r(B).then(b.hitch(this,function(D){var F={};F.config=D[0];F.i18n=D[1];F.template=D[2];F.style=D[3];v.resolve(F)}),function(D){v.reject(D)});return v},getWidgetUri:function(z){if(this.widgetsUri[z.id])return this.widgetsUri[z.id];var v=z.itemId?u.getPortal(window.portalUrl).getItemById(z.itemId).then(function(B){return m.isOnline(window.portalUrl)&&!m.isOnline(B.url)?(new g).reject("Not allow.",z.itemId):y.widgetJson.getUriFromItem(B)}):y.getUriInfo(z.uri).isRemote?(new g).reject("Not allow.",
z.uri):(new g).resolve(z.uri);return this.widgetsUri[z.id]=v},loadWidgetManifest:function(z){var v=new g;return this.getWidgetUri(z).then(b.hitch(this,function(B){z.uri=B;if(z.manifest)return v.resolve(z),v;B=y.getUriInfo(B).folderUrl+"manifest.json";k(B,{handleAs:"json",headers:{"X-Requested-With":null}}).then(b.hitch(this,function(A){if(A.error&&A.error.code)return v.reject(A.error);A.amdFolder=z.amdFolder;A.category="widget";z.label?(this._processManifest(A),y.addManifest2WidgetJson(z,A),v.resolve(z)):
y.addI18NLabel(A).then(b.hitch(this,function(){this._processManifest(A);y.addManifest2WidgetJson(z,A);v.resolve(z)}))}),function(A){v.reject(A)});return v}))},getWidgetMarginBox:function(z){if("string"===typeof z&&(z=this.getWidgetById(z),!z))return{};if(z._marginBox)return z._marginBox;z.setPosition({left:-9999,top:-9999,relativeTo:z.position.relativeTo});this.openWidget(z);z._marginBox=z.getMarginBox();this.closeWidget(z);return z._marginBox},_processManifest:function(z){y.addManifestProperies(z);
y.processManifestLabel(z,window.dojoConfig.locale)},createWidget:function(z,v,B){if(this.getWidgetById(z.id))return this.getWidgetById(z.id);B.config&&B.i18n&&(B.config=y.replacePlaceHolder(B.config,B.i18n));z.rawConfig=z.config;z.config=B.config||{};this.appConfig._appData&&this._mergeAgolConfig(z);z.nls=B.i18n||{};B.template&&(z.templateString=B.template);z["class"]="jimu-widget";z.label||(z.label=z.name);z.sceneView=this.sceneView;z.appConfig=this.appConfig;B={};for(var A in z)z.hasOwnProperty(A)&&
(B[A]=z[A]);B.widgetManager=this;z=new v(B);z.clazz=v;n.after(z,"startup",b.hitch(this,this._postWidgetStartup,z));n.before(z,"destroy",b.hitch(this,this._onDestroyWidget,z));l(z.domNode,"click",b.hitch(this,this._onClickWidget,z));this.loaded.push(z);return z},getAllWidgets:function(){return this.loaded},destroyAllWidgets:function(){var z=c.map(this.loaded,function(v){return v.id});c.forEach(z,function(v){this.destroyWidget(v)},this);this.loaded=[]},loadWidgetSettingPage:function(z){var v=new g;
z=b.clone(z);z.id+="_setting";r([this.loadWidgetSettingClass(z)]).then(b.hitch(this,function(B){var A=B[0];this.loadWidgetSettingPageResources(z).then(b.hitch(this,function(E){var C={nls:E.i18n,appConfig:this.appConfig,sceneView:this.sceneView,"class":"jimu-widget-setting"};null!==E.template&&(C.templateString=E.template);for(var D in z)z.hasOwnProperty(D)&&(C[D]=z[D]);try{var F=new A(C);n.before(F,"destroy",b.hitch(this,this._onDestroyWidgetSetting,F));v.resolve(F)}catch(G){new h({message:window.jimuNls.createWidgetSettingError+
":"+z.uri}),v.reject(G)}}),function(E){console.log(E)})}),function(B){v.reject(B)});return v},loadWidgetSettingClass:function(z){var v=new g;var B=z.isRemote?z.folderUrl+"setting/Setting.js":z.amdFolder+"setting/Setting";require(y.getRequireConfig(),[B],b.hitch(this,function(A){v.resolve(A)}));y.checkError(z.folderUrl+"setting/Setting.js",v);return v},loadWidgetSettingPageResources:function(z){var v=new g,B=[];z=b.clone(z);var A=this._tryLoadResource(z,"settingI18n");var E=this._tryLoadResource(z,
"settingTemplate");z=this._tryLoadResource(z,"settingStyle");B.push(A);B.push(E);B.push(z);r(B).then(b.hitch(this,function(C){var D={};D.i18n=C[0]||{};D.template=C[1];D.style=C[2];v.resolve(D)}),function(C){console.log(C)});return v},getWidgetById:function(z){var v;c.some(this.loaded,function(B){if(B.id===z)return v=B,!0},this);return v},getWidgetByLabel:function(z){var v;c.some(this.loaded,function(B){if(B.label===z)return v=B,!0},this);return v},getWidgetsByName:function(z){var v=[];c.some(this.loaded,
function(B){B.name===z&&v.push(B)},this);return v},changeWindowStateTo:function(z,v){"normal"===v?this.normalizeWidget(z):"minimized"===v?this.minimizeWidget(z):"maximized"===v?this.maximizeWidget(z):console.log("error state: "+v)},closeWidget:function(z){if("string"===typeof z&&(z=this.getWidgetById(z),!z))return;if("closed"!==z.state){this.activeWidget&&this.activeWidget.id===z.id&&(this.activeWidget.onDeActive(),this.activeWidget=null);d.setStyle(z.domNode,"display","none");z.setState("closed");
try{z.onClose()}catch(v){console.log(console.error("fail to close widget "+z.name+". "+v.stack))}}},openWidget:function(z){if("string"===typeof z&&(z=this.getWidgetById(z),!z))return;if(!z.started)try{z.started=!0,z.startup()}catch(v){console.error("fail to startup widget "+z.name+". "+v.stack)}if("closed"===z.state){d.setStyle(z.domNode,"display","");z.setState("opened");try{z.onOpen()}catch(v){console.error("fail to open widget "+z.name+". "+v.stack)}}},activateWidget:function(z){if("string"===
typeof z&&(z=this.getWidgetById(z),!z))return;"opened"===z.state&&this._activeWidget(z)},maximizeWidget:function(z){if("string"===typeof z&&(z=this.getWidgetById(z),!z))return;"closed"===z.state&&this.openWidget(z);z.setWindowState("maximized");try{z.onMaximize()}catch(v){console.log(console.error("fail to maximize widget "+z.name+". "+v.stack))}},minimizeWidget:function(z){if("string"===typeof z&&(z=this.getWidgetById(z),!z))return;"closed"===z.state&&this.openWidget(z);z.setWindowState("minimized");
try{z.onMinimize()}catch(v){console.log(console.error("fail to minimize widget "+z.name+". "+v.stack))}},normalizeWidget:function(z){if("string"===typeof z&&(z=this.getWidgetById(z),!z))return;"closed"===z.state&&this.openWidget(z);z.setWindowState("normal");try{z.onNormalize()}catch(v){console.log(console.error("fail to normalize widget "+z.name+". "+v.stack))}},destroyWidget:function(z){if("string"===typeof z&&(z=this.getWidgetById(z),!z))return;this._removeWidget(z);try{z.destroy()}catch(v){console.log(console.error("fail to destroy widget "+
z.name+". "+v.stack))}},tryLoadWidgetConfig:function(z){return this._tryLoadWidgetConfig(z).then(b.hitch(this,function(v){return this._upgradeWidgetConfig(z,v).then(function(B){return z.config=B})}))},triggerWidgetOpen:function(z){function v(C){var D=n.after(C,"onOpen",function(){D.remove();B.resolve(C)})}var B=new g,A=this.getWidgetById(z);if(A){if("closed"!==A.state)return B.resolve(A),B;v(A)}else var E=x.subscribe("widgetCreated",b.hitch(this,function(C){C.id===z&&(E.remove(),B.resolve(C))}));
x.publish("openWidget",z);return B},_tryLoadWidgetConfig:function(z){var v=new g;if(z.config&&b.isObject(z.config))return v.resolve(z.config),v;if(z.config){if(require.cache["url:"+z.config])return v.resolve(f.parse(require.cache["url:"+z.config])),v;v=y.processUrlInAppConfig(z.config);v=v.split("/");v[v.length-1]=encodeURIComponent(v[v.length-1]);v=v.join("/");return k(v,{handleAs:"json"})}return this._tryLoadResource(z,"config").then(function(B){z.isDefaultConfig=!0;return B})},_upgradeWidgetConfig:function(z,
v){var B=new g,A=z.manifest.version,E=z.version,C;if(A===E)return B.resolve(v),B;if(!1===z.hasVersionManager)return z.version=A,B.resolve(v),B;require(y.getRequireConfig(),[z.amdFolder+"VersionManager"],b.hitch(this,function(D){D=new D;var F=D.getVersionIndex(E),G=D.getVersionIndex(A);if(F>G)B.reject("Bad widget version number, "+z.name+","+E);else try{C=D.upgrade(v,E,A),z.version=A,B.resolve(C)}catch(J){console.log("Read widget ["+z.name+"] old config error,"+J.stack),B.resolve(v)}}));return B},
loadWidgetStyle:function(z){var v="widget/style/"+z.uri,B=new g;v=this._replaceId(v);return d.byId(v)?(B.resolve("load"),B):y.loadStyleLink(v,z.styleFile,"theme_"+this.appConfig.theme.name+"_style_common")},loadWidgetSettingStyle:function(z){var v="widget/style/"+z.uri+"/setting",B=new g;v=this._replaceId(v);return d.byId(v)?(B.resolve("load"),B):y.loadStyleLink(v,z.settingStyleFile)},loadWidgetConfig:function(z){z=require(y.getRequireConfig()).toUrl(z.configFile);if(require.cache["url:"+z]){var v=
new g;v.resolve(f.parse(require.cache["url:"+z]));return v}return k(z,{handleAs:"json"})},loadWidgetI18n:function(z){var v=new g;require(y.getRequireConfig(),["dojo/i18n!"+z.i18nFile],function(B){v.resolve(B)});return v},loadWidgetSettingI18n:function(z){var v=new g;require(y.getRequireConfig(),["dojo/i18n!"+z.settingI18nFile],function(B){v.resolve(B)});return v},loadWidgetTemplate:function(z){var v=new g;require(y.getRequireConfig(),["dojo/text!"+z.templateFile],function(B){v.resolve(B)});y.checkError(z.templateFile,
v);return v},loadWidgetSettingTemplate:function(z){var v=new g;require(y.getRequireConfig(),["dojo/text!"+z.settingTemplateFile],function(B){v.resolve(B)});y.checkError(z.settingTemplateFile,v);return v},removeWidgetStyle:function(z){d.destroy(this._replaceId("widget/style/"+z.uri))},removeWidgetSettingStyle:function(z){d.destroy(this._replaceId("widget/style/"+z.uri+"/setting"))},getControllerWidgets:function(){return c.filter(this.loaded,function(z){return z.isController})},getOffPanelWidgets:function(){return c.filter(this.loaded,
function(z){return!z.inPanel})},getOnScreenOffPanelWidgets:function(){return c.filter(this.loaded,function(z){return z.isOnScreen&&!z.inPanel})},closeOtherWidgetsInTheSameGroup:function(z){if("string"===typeof z&&(z=this.getWidgetById(z),!z))return;for(var v=0;v<this.loaded.length;v++)this.loaded[v].gid===z.gid&&this.loaded[v].id!==z.id&&this.closeWidget(this.loaded[v])},closeAllWidgetsInGroup:function(z){for(var v=0;v<this.loaded.length;v++)this.loaded[v].gid===z&&this.closeWidget(this.loaded[v])},
_mergeAgolConfig:function(z){var v=this.appConfig._appData.values,B="widgets["+z.id+"]",A;for(A in v){var E=A.replace(/\//g,"_").indexOf(B+"_config");0<=E&&y.template.setConfigValue(z,A.replace(/\//g,"_").substr(E,A.length).replace(B,"widget"),v[A])}},_onUserSignIn:function(z){c.forEach(this.loaded,function(v){v.onSignIn(z)},this)},_onUserSignOut:function(){c.forEach(this.loaded,function(z){z.onSignOut()},this)},_activeWidget:function(z){if(this.activeWidget){if(this.activeWidget.id===z.id){!1===
this.activeWidget.inPanel&&this.activeWidget.moveTopOnActive&&d.setStyle(this.activeWidget.domNode,"zIndex",101);return}"active"===this.activeWidget.state&&(this.activeWidget.setState("opened"),!1===this.activeWidget.inPanel&&d.setStyle(z.domNode,"zIndex","zIndex"in z.position?z.position.zIndex:"auto"),this.activeWidget.onDeActive())}this.activeWidget=z;"opened"===this.activeWidget.state&&(this.activeWidget.setState("active"),!1===this.activeWidget.inPanel&&this.activeWidget.moveTopOnActive&&d.setStyle(this.activeWidget.domNode,
"zIndex",101),this.activeWidget.onActive(),x.publish("widgetActived",z))},_onClickWidget:function(z,v){var B=e(".jimu-widget",z.domNode);if(0<B.length)for(var A=0;A<B.length;A++)if(v.target===B[A]||d.isDescendant(v.target,B[A]))return;this._activeWidget(z)},_onMoveStart:function(z){c.forEach(this.loaded,function(v){v.domNode===z.node&&this._activeWidget(v)},this)},_onAppConfigLoaded:function(z){this.appConfig=z=b.clone(z);p.setPortalUrl(z.portalUrl)},_onSceneViewLoaded:function(z){this.sceneView=
z},_onSceneViewChanged:function(z){this.sceneView=z},_onAppConfigChanged:function(z,v,B,A){var E=b.clone(z);this.appConfig=E;c.forEach(this.loaded,function(C){C&&(C.onAppConfigChanged(E,v,B,A),"widgetChange"===v&&this._onConfigChanged(B.id,B.config,A))},this)},_onConfigChanged:function(z,v){if(z=this.getWidgetById(z))z.onConfigChanged(v),b.mixin(z.config,v)},_onActionTriggered:function(z){if("map"!==z.elementId&&"app"!==z.elementId){var v=this.getWidgetById(z.elementId);if(v)v.onAction(z.action,z.data);
else this.missedActions.push({id:z.elementId,action:{name:z.action,data:z.data}});c.forEach(this.getControllerWidgets(),function(B){if(B.widgetIsControlled(z.elementId))B.onAction(z.action,{widgetId:z.elementId,data:z.data})},this)}},_postWidgetStartup:function(z){z.started=!0;y.setVerticalCenter(z.domNode);n.after(z,"resize",b.hitch(this,y.setVerticalCenter,z.domNode));this.openWidget(z);var v=p.getPortalCredential(this.appConfig.portalUrl);if(v)z.onSignIn(v);else z.onSignOut();this._triggerMissedAction(z)},
_triggerMissedAction:function(z){this.missedActions.forEach(function(v){if(v.id===z.id)z.onAction(v.action.name,v.action.data)})},_remove:function(z){delete this.widgetsUri[z];return c.some(this.loaded,function(v,B){if(v.id===z)return this.loaded.splice(B,1),!0},this)},_tryLoadResource:function(z,v){var B=new g,A=function(){if("config"===v)var C=this.loadWidgetConfig(z);else if("style"===v)C=this.loadWidgetStyle(z);else if("i18n"===v)C=this.loadWidgetI18n(z);else if("template"===v)C=this.loadWidgetTemplate(z);
else if("settingTemplate"===v)C=this.loadWidgetSettingTemplate(z);else if("settingStyle"===v)C=this.loadWidgetSettingStyle(z);else if("settingI18n"===v)C=this.loadWidgetSettingI18n(z);else return B;C.then(function(D){B.resolve(D)},function(D){console.error("Load widget resource error. resource:",v);console.error(D);new h({message:window.jimuNls.loadWidgetResourceError+": "+z.uri});B.reject(D)})};if("config"===v){var E=z.amdFolder+"config.json";z.configFile=E;E="hasConfig"}else if("style"===v)E=z.amdFolder+
"css/style.css",z.styleFile=E,E="hasStyle";else if("i18n"===v)E=z.amdFolder+"nls/strings.js",z.i18nFile=z.isRemote?E:z.amdFolder+"nls/strings",E="hasLocale";else if("template"===v)E=z.amdFolder+"Widget.html",z.templateFile=E,E="hasUIFile";else if("settingTemplate"===v)E=z.amdFolder+"setting/Setting.html",z.settingTemplateFile=E,E="hasSettingUIFile";else if("settingI18n"===v)E=z.amdFolder+"setting/nls/strings.js",z.settingI18nFile=z.isRemote?E:z.amdFolder+"setting/nls/strings",E="hasSettingLocale";
else if("settingStyle"===v)E=z.amdFolder+"setting/css/style.css",z.settingStyleFile=E,E="hasSettingStyle";else return B;z[E]?A.apply(this):B.resolve(null);return B},_replaceId:function(z){return z.replace(/\//g,"_").replace(/\./g,"_")},_onDestroyWidget:function(z){"closed"!==z.state&&this.closeWidget(z);this._removeWidget(z);console.log("destroy widget ["+z.uri+"].")},_onDestroyWidgetSetting:function(z){this.removeWidgetSettingStyle(z)},_removeWidget:function(z){if("string"===typeof z&&(z=this.getWidgetById(z),
!z))return;this.activeWidget&&this.activeWidget.id===z.id&&(this.activeWidget=null);this._remove(z.id);0===this.getWidgetsByName(z.name).length&&this.removeWidgetStyle(z)}});q.getInstance=function(z){null===t&&(t=new q(z),window._widgetManager=t);return t};return q})},"jimu/tokenUtils":function(){define("require dojo/_base/lang dojo/_base/array dojo/aspect dojo/Deferred dojo/cookie dojo/json dojo/topic dojo/request/script esri/kernel esri/request esri/core/urlUtils esri/identity/IdentityManager esri/identity/OAuthInfo jimu/portalUrlUtils jimu/utils".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h){"function"!==typeof x.getAll&&(x.getAll=function(u){var t=[];(u=x(u))&&t.push(u);return t});var m={portalUrl:null,cookiePath:"/",_started:!1,webTierPortalUrls:[],isInBuilderWindow:function(){return!!window.isBuilder},isInConfigOrPreviewWindow:function(){return h.isInConfigOrPreviewWindow()},isStringStartWith:function(u,t){return u.substr(0,t.length)===t},getCookiePath:function(){return this.cookiePath},setPortalUrl:function(u){(u=p.getStandardPortalUrl(u))&&
(u+="/");this.portalUrl=u},getPortalUrl:function(){return this.portalUrl},isWebTierPortal:function(u){var t=new g,q=p.getStandardPortalUrl(u);u=q+"/sharing";var z=p.setHttpsProtocol(q+"/sharing/generateToken?f\x3djson"),v=p.setHttpsProtocol(u);n.get(z,{jsonp:"callback"}).then(b.hitch(this,function(B){B.token?(this.webTierPortalUrls.push(q),this.removeWabAuthInfo(),f.id.getCredential(v).then(b.hitch(this,function(A){function E(F){var G=F.creationTime||(new Date).getTime(),J=F.expires;0<G&&0<J&&J>G&&
setTimeout(function(){n.get(z,{jsonp:"callback"}).then(function(I){I.token&&(F.token=I.token,F.expires=I.expires,F.creationTime=(new Date).getTime(),F.refreshServerTokens(),E(F))},function(I){console.error(I)})},.8*(J-G))}A.token||(A.token=B.token);A.expires||(A.expires=B.expires);var C=h.getEsriConfigRequestObject(),D=k.isTrustedServer(A.server,!0);-1<D&&C.corsEnabledServers.splice(D,1);this._pushCorsEnabledServerInfo({host:p.getServerByUrl(q),withCredentials:!0});t.resolve(!0);E(A)}),b.hitch(this,
function(){t.resolve(!0)}))):t.resolve(!1)}),b.hitch(this,function(B){console.error(B);t.reject(B)}));return t},addAuthorizedCrossOriginDomains:function(u){if(u&&0<u.length)for(var t=0;t<u.length;t++)this.addWithCredentialDomain(u[t])},addWithCredentialDomain:function(u){if(u&&"string"===typeof u){var t=h.getEsriConfigRequestObject().corsEnabledServers,q=p.getServerByUrl(u);(u=p.getServerWithProtocol(u))||(u="http://"+q);u=k.isTrustedServer(u,!0);-1<u&&t.splice(u,1);this._pushCorsEnabledServerInfo({host:q,
withCredentials:!0})}},_pushCorsEnabledServerInfo:function(u){if(u){var t=h.getEsriConfigRequestObject(),q=t.corsEnabledServers,z="charAt charCodeAt concat endsWith indexOf lastIndexOf localeCompare match replace search slice split startsWith substr substring toLocaleLowerCase toLocaleUpperCase toLowerCase toString toUpperCase trim trimLeft trimRight valueOf".split(" ");if("object"===typeof u&&"string"===typeof u.host){for(var v in u.host)u[v]="function"===typeof u.host[v]?function(){return u.host[v].apply(u.host,
arguments)}:u.host[v];u.length=u.host.length;c.forEach(z,function(B){"function"===typeof u.host[B]&&(u[B]=function(){return u.host[B].apply(u.host,arguments)})});u.withCredentials&&t.webTierAuthServers&&0>t.webTierAuthServers.indexOf(u.host)&&t.webTierAuthServers.push(u.host)}q.push(u)}},tryRegisterCredential:function(u){return this.isValidCredential(u)?c.some(f.id.credentials,b.hitch(this,function(t){return u.token===t.token}))?!1:(f.id.credentials.push(u),!0):!1},registerToken:function(u){var t=
p.getSharingUrl(this.portalUrl);f.id.findCredential(t)&&c.some(f.id.credentials,b.hitch(this,function(q,z){if(this.isValidPortalCredentialOfPortalUrl(this.portalUrl,q))return f.id.credentials.splice(z,1),!0}));return this._getTokenInfo(u).then(function(q){f.id.registerToken(q)})},_getTokenInfo:function(u){var t=p.getPortalSelfInfoUrl(this.portalUrl);return n.get(t+("?f\x3djson\x26token\x3d"+u),{jsonp:"callback"}).then(b.hitch(this,function(q){if(q.user)return{server:p.getSharingUrl(this.portalUrl),
ssl:q.allSSL,token:u,userId:q.user.username};throw Error(window.jimuNls.urlParams.invalidToken);}),function(q){console.error(q);throw Error(window.jimuNls.urlParams.validateTokenError);})},_isInvalidPortalUrl:function(u){return u&&"string"===typeof u&&b.trim(u)},signInPortal:function(u){var t=new g;if(this._isInvalidPortalUrl(u)){u=p.getStandardPortalUrl(u);var q=p.getSharingUrl(u),z=this.getPortalCredential(u);z?setTimeout(b.hitch(this,function(){t.resolve(z)}),0):t=f.id.getCredential(q)}else setTimeout(b.hitch(this,
function(){t.reject("Invalid portalurl.")}),0);return t},_loadPortalSelfInfo:function(u){u=p.getPortalSelfInfoUrl(u);var t=new g;e(u,{responseType:"json",query:{f:"json"},callbackParamName:"callback"}).then(b.hitch(this,function(q){t.resolve(q.data)}),b.hitch(this,function(q){t.reject(q)}));return t},registerOAuthInfo:function(u,t){if(!u||"string"!==typeof u||!t||"string"!==typeof t)return null;var q=f.id.findOAuthInfo(u);q||(q=window.location.protocol+"//"+window.location.host+a.toUrl("jimu")+"/oauth-callback.html",
q=new y({appId:t,expiration:20160,portalUrl:u,authNamespace:"/",popup:!0,popupCallbackUrl:q}),f.id.registerOAuthInfos([q]));q.appId=t;return q},signOutAll:function(u){var t=p.getStandardPortalUrl(this.portalUrl)+"/sharing/rest",q=p.getPortalSignInUrlFromLocation();q=q+"?returnUrl\x3d"+encodeURIComponent(window.location.href);var z=h.getLocationUrlWithoutHashAndQueryParams();z=h.url.addQueryParamToUrl(z,"action","setportalurl");window.appInfo.isRunInPortal?(this.removeEsriAuthCookieStorage(),window.location.href=
t+"/oauth2/signout?client_id\x3darcgisonline\x26redirect_uri\x3d"+q):(this.removeWabAuthInfo(),u&&u.supportsOAuth?(u=t+"/oauth2/signout?client_id\x3d"+u.appId+"\x26redirect_uri\x3d"+z,window.location.href=u):window.location.href=z)},userHaveSignInPortal:function(u){return!!this.getPortalCredential(b.trim(u||""))},isValidCredential:function(u){var t=!1;if(u){t=u.token;var q=u.server,z=u.scope;t=t&&"string"===typeof t&&b.trim(t);q=q&&"string"===typeof q&&b.trim(q);z="portal"===z||"server"===z;var v=
!0;u.expires&&(u=parseInt(u.expires,10),v=(new Date).getTime(),v=u>v);t=t&&q&&z&&v}return t},isValidPortalCredentialOfPortalUrl:function(u,t){var q=!1;this.isValidCredential(t)&&(q="portal"===t.scope,u=p.isSameServer(u,t.server),q=q&&u);return q},getPortalCredential:function(u){var t=null;u=b.trim(u||"");if(!u)return null;u=p.getStandardPortalUrl(u);return t=this._filterPortalCredential(u,f.id.credentials)},saveAndRegisterCookieToCredential:function(u){u=b.clone(u);u.referer=window.location.host;
u.scope="portal";u.isAdmin=!!u.isAdmin;this.saveWabAuthInfo(u);var t=u.server+"/sharing/rest";u.server=t;f.id.registerToken(u);return f.id.findCredential(t,u.userId)},registerAuth2Hash:function(u){u=b.clone(u);var t=1E3*parseInt(u.expires_in,10);t=(new Date).getTime()+t;var q=p.getStandardPortalUrl(u.state.portalUrl);return this.saveAndRegisterCookieToCredential({referer:window.location.host,server:q,token:u.access_token,expires:t,userId:u.username,scope:"portal",isAdmin:!!u.isAdmin})},readWabAuthInfo:function(){var u=
null,t=localStorage.getItem("wab_token");try{var q=x("wab_auth");q&&(u=w.parse(q),u.token=t)}catch(z){console.error(z)}return u},saveWabAuthInfo:function(u){u=b.clone(u);this.removeWabAuthInfo();localStorage.setItem("wab_token",u.token);delete u.token;x("wab_auth",w.stringify(u),{expires:new Date(u.expires),path:"/"})},removeWabAuthInfo:function(){this.removeCookie("wab_auth");localStorage.removeItem("wab_token")},removeEsriAuthCookieStorage:function(){window.localStorage&&window.localStorage.removeItem("esriJSAPIOAuth");
window.sessionStorage&&window.sessionStorage.removeItem("esriJSAPIOAuth")},_filterPortalCredential:function(u,t){var q=null;t&&0<t.length&&(t=c.filter(t,b.hitch(this,function(z){return this.isValidPortalCredentialOfPortalUrl(u,z)})),0<t.length&&(q=t[t.length-1]));return q},_removePortalCredential:function(u){var t=b.trim(u||"");if(t){t=p.getStandardPortalUrl(t);for(u=c.filter(f.id.credentials,b.hitch(this,function(q){return this.isValidPortalCredentialOfPortalUrl(t,q)}));0<u.length;)u[0].destroy(),
u.splice(0,1);f.id.credentials=c.filter(f.id.credentials,b.hitch(this,function(q){return!this.isValidPortalCredentialOfPortalUrl(t,q)}))}},getUserIdByToken:function(u,t){var q=new g;if(u&&"string"===typeof u&&t&&"string"===typeof t){var z=p.getStandardPortalUrl(t);t=c.filter(f.id.credentials,b.hitch(this,function(B){var A=B.token===u&&B.userId;B=p.isSameServer(z,B.server);return A&&B}));if(0<t.length){var v=t[0];setTimeout(b.hitch(this,function(){q.resolve(v.userId)}),0);return q}t=p.getCommunitySelfUrl(z);
e(t,{responseType:"json",query:{f:"json"},callbackParamName:"callback"}).then(b.hitch(this,function(B){B=B&&B.data;q.resolve(B&&B.username||"")}),b.hitch(this,function(B){console.error(B);q.reject("fail to get userId by token")}))}else setTimeout(b.hitch(this,function(){q.reject("invalid parameters")}),0);return q},xtGetCredentialFromCookie:function(u){var t=this.readWabAuthInfo();if(!t||"object"!==typeof t||!p.isSameServer(u,t.server)||window.location.host!==t.referer)return null;t.expires=parseInt(t.expires,
10);var q=(new Date).getTime();if(!(t.expires>q))return this.removeCookie("wab_auth"),null;u+="/sharing/rest";t.server=u;(q=f.id.findCredential(u))||f.id.registerToken(t);return q=f.id.findCredential(u)},removeCookie:function(u){var t=this.getCookiePath();h.removeCookie(u,t)},_getDomainsByServerName:function(u){var t=u.split("."),q=t.length;return c.map(t,b.hitch(this,function(z,v){z=t.slice(v,q);var B="",A=z.length-1;c.forEach(z,b.hitch(this,function(E,C){B+=E;C!==A&&(B+=".")}));return B}))},_publishCurrentPortalUserSignIn:function(u){if(this.isValidCredential(u))try{l.publish("userSignIn",
u)}catch(t){console.error(t)}},_publishAnyUserSignIn:function(u){if(this.isValidCredential(u))try{l.publish("anyUserSignIn",u)}catch(t){console.error(t)}},_publishCurrentPortalUserSignOut:function(u){try{l.publish("userSignOut",u)}catch(t){console.error(t)}},_signInSuccess:function(u){try{this.isValidPortalCredentialOfPortalUrl(this.portalUrl,u)&&this._publishCurrentPortalUserSignIn(u),this._publishAnyUserSignIn(u)}catch(t){console.error(t)}},_bindEvents:function(){d.after(f.id,"signIn",b.hitch(this,
function(u,t){console.log(t[1]);d.after(u,"callback",b.hitch(this,function(q,z){this._signInSuccess(z[0],!1)}));return u}))},isStart:function(){return this._started},startup:function(){if(!this._started){if(this.isInConfigOrPreviewWindow()){var u=window.parent;if(u){var t=u.esri&&u.esri.id;if(t){r.initialize(t.toJson());var q=h.getEsriConfigRequestObject();u=u.esriConfig.defaults.io;q.trustedServers||(q.trustedServers=[]);c.forEach(u.corsEnabledServers,b.hitch(this,function(z){z&&z.host&&z.withCredentials&&
q.trustedServers.push(z.host)}))}}}this._bindEvents();this._started=!0}}};m.startup();return m})},"jimu/portalUrlUtils":function(){define(["dojo/_base/lang","jimu/shared/basePortalUrlUtils"],function(a,b){var c=a.clone(b);c.declaredClass="jimu.portalUrlUtils";c.getPortalUrlFromLocation=function(){return c.getPortalServerFromLocation()+c.getDeployContextFromLocation()};c.getPortalSignInUrlFromLocation=function(){return c.getPortalUrlFromLocation()+"home/signin.html"};c.getPortalServerFromLocation=
function(){return window.location.protocol+"//"+window.location.host};c.getDeployContextFromLocation=function(){var d=window.location.href.split("?")[0],g=d.indexOf("/home/");0>g&&(g=d.indexOf("/apps/"));d=d.substring(d.indexOf(window.location.host)+window.location.host.length+1,g);"/"!==d&&(d="/"+d+"/");return d};c.getRestBaseUrlFromLocation=function(){return window.location.protocol+"//"+window.location.host+c.getDeployContextFromLocation()+"sharing/rest/"};return c})},"jimu/dijit/Message":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/keys dojo/on jimu/dijit/Popup jimu/utils".split(" "),
function(a,b,c,d,g,x,w){return a(x,{baseClass:"jimu-popup jimu-message",declaredClass:"jimu.dijit.Message",type:"message",message:"",autoHeight:!0,maxWidth:350,maxHeight:180,postMixInProperties:function(){this.content=this.message},_createTitleNode:function(){this.titleLabel&&(this.titleNode=c.create("div",{"class":"title"},this.domNode),this.titleLabeNode=c.create("span",{"class":"title-label jimu-float-leading",innerHTML:w.sanitizeHTML(this.titleLabel)||"\x26nbsp"},this.titleNode),this.closeBtnNode=
c.create("div",{"class":"close-btn jimu-float-trailing"},this.titleNode),this.own(g(this.closeBtnNode,"click",b.hitch(this,this.close))))},_preProcessing:function(){0===this.buttons.length&&this.buttons.push({label:window.jimuNls.common.ok,key:d.ENTER,onClick:b.hitch(this,this.close)})},_increaseZIndex:function(){c.setStyle(this.domNode,"zIndex",501);c.setStyle(this.overlayNode,"zIndex",500)}})})},"jimu/dijit/Popup":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/fx dojo/on dojo/sniff dojo/touch dojo/query dojo/dnd/move dijit/_WidgetBase jimu/utils".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k){var r=0;return a(e,{declaredClass:"jimu.dijit.Popup",baseClass:"jimu-popup",titleLabel:"",content:null,container:null,buttons:[],enabledButtons:[],disabledButtons:[],onClose:null,_fixedHeight:!1,autoHeight:!1,maxHeight:800,maxWidth:1024,constructor:function(){this.buttons=[];this.enabledButtons=[];this.disabledButtons=[];this.pauseKeyHandles=[];this.container=jimuConfig.layoutId},postCreate:function(){this._preProcessing();this.inherited(arguments);this._initDomNode();
this._positioning();d.place(this.domNode,this.container);setTimeout(b.hitch(this,function(){this._moveToMiddle()}),50);this.own(x(window,"resize",b.hitch(this,function(){this._fixedHeight||this.autoHeight?(this._calculatePosition(),this._moveToMiddle()):this._positioning()})));this.overlayNode=d.create("div",{"class":"jimu-overlay"},this.container);this._increaseZIndex();g.animateProperty({node:this.domNode,properties:{opacity:1},duration:200}).play();this.domNode.focus()},_preProcessing:function(){"number"===
typeof this.height&&(this._fixedHeight=!0,this.autoHeight=!1);this.autoHeight&&(this.maxHeight=598)},_createTitleNode:function(){this.titleNode=d.create("div",{"class":"title"},this.domNode);this.titleLabeNode=d.create("span",{"class":"title-label jimu-float-leading",innerHTML:k.sanitizeHTML(this.titleLabel)||"\x26nbsp"},this.titleNode);this.closeBtnNode=d.create("div",{"class":"close-btn jimu-icon jimu-icon-close jimu-float-trailing"},this.titleNode);var y=null;y="ontouchstart"in document?l.press:
"click";this.own(x(this.closeBtnNode,y,b.hitch(this,this.close)))},_initDomNode:function(){this._createTitleNode();this.contentContainerNode=d.create("div",{"class":"content"},this.domNode);this.content&&("string"===typeof this.content?this.contentContainerNode.innerHTML=this.content:this.content.domNode?(this.content.placeAt(this.contentContainerNode),this.content.popup=this):1===this.content.nodeType&&d.place(this.content,this.contentContainerNode));this.buttonContainer=d.create("div",{"class":"button-container"},
this.domNode);0===this.buttons.length&&d.setStyle(this.buttonContainer,"display","none");for(var y=this.buttons.length-1;-1<y;y--)this._createButton(this.buttons[y]),this.buttons[y].disable&&this.disableButton(y)},_limitButtonsMaxWidth:function(){var y=this.enabledButtons.length;if(0!==y){var p=d.getContentBox(this.buttonContainer),h=d.getMarginExtents(this.enabledButtons[0]),m=d.getPadBorderExtents(this.enabledButtons[0]),u=0;m=8===w("ie")?m.l+m.r:0;u=(p.w-(h.l+h.r+m)*y)/y;0<u&&(c.forEach(this.enabledButtons,
b.hitch(this,function(t){d.setStyle(t,"maxWidth",u+"px")})),c.forEach(this.disabledButtons,b.hitch(this,function(t){d.setStyle(t,"maxWidth",u+"px")})))}},_moveableNode:function(y,p){this.moveable&&(this.moveable.destroy(),this.moveable=null);var h=d.getMarginBox(this.container);h.l=h.l-y+p;h.w+=2*(y-p);this.moveable=new f.boxConstrainedMoveable(this.domNode,{box:h,handle:this.titleNode||this.contentContainerNode,within:!0});this.own(x(this.moveable,"Moving",b.hitch(this,this.onMoving)));this.own(x(this.moveable,
"MoveStop",b.hitch(this,this.onMoveStop)))},_getHeaderBox:function(){return 0===n("#header").length?{t:0,l:0,w:0,h:0}:d.getMarginBox("header")},_getFooterBox:function(){return 0===n(".footer",this.container).length?{t:0,l:0,w:0,h:0}:d.getMarginBox(n(".footer",this.container)[0])},_calculatePosition:function(){var y=d.getContentBox(this.container),p=this._getHeaderBox(),h=this._getFooterBox();h=y.h-p.h-h.h-40;var m=0;m=this._fixedHeight?this.height:this.autoHeight?h-200:this.height=h>this.maxHeight?
this.maxHeight:h;h=(h-m)/2+p.h+20;h=h<p.h?p.h:h;this.width=this.width||this.maxWidth;d.setStyle(this.domNode,{left:(y.w-this.width)/2+"px",top:h+"px",width:this.width+"px"})},_calculateHeight:function(){this.autoHeight?(d.setStyle(this.domNode,"height","auto"),d.addClass(this.contentContainerNode,"content-static"),0===this.buttons.length&&d.setStyle(this.contentContainerNode,{marginBottom:"15px"})):(d.setStyle(this.domNode,"height",this.height+"px"),d.addClass(this.contentContainerNode,"content-absolute"),
d.addClass(this.buttonContainer,"button-container-absolute"),0===this.buttons.length&&d.setStyle(this.contentContainerNode,{bottom:"15px"}));this._moveableNode(this.width,100)},_moveToMiddle:function(){if(this.autoHeight){var y=d.getMarginBox(this.domNode),p=d.getContentBox(this.container),h=this._getHeaderBox(),m=this._getFooterBox();m=p.h-h.h-m.h-40;var u=0;u=y.h||m-200;y=(m-u)/2+h.h+20;y=y<h.h?h.h:y;d.setStyle(this.domNode,{left:(p.w-this.width)/2+"px",top:y+"px",width:this.width+"px"})}},_positioning:function(){this._calculatePosition();
this._calculateHeight()},_increaseZIndex:function(){d.setStyle(this.domNode,"zIndex",r+200+1);d.setStyle(this.overlayNode,"zIndex",r+200);r++},setTitleLabel:function(y){this.titleNode.innerHTML=k.stripHTML(y)},onMoving:function(y){d.setStyle(y.node,"opacity",.9)},onMoveStop:function(y){d.setStyle(y.node,"opacity",1)},close:function(){if(!this.onClose||!1!==this.onClose()){var y=this.domNode.parentNode,p=b.clone(this.domNode);d.setStyle(this.domNode,"display","none");d.destroy(this.overlayNode);this.destroy();
this.moveable.destroy();d.place(p,y);g.animateProperty({node:p,properties:{opacity:0},duration:200,onEnd:function(){d.destroy(p)}}).play()}},addButton:function(y){this._createButton(y)},_createButton:function(y){var p=" ";y.classNames&&0<y.classNames.length&&"function"===typeof y.classNames.join&&(p+=y.classNames.join(" "));var h=d.create("div",{"class":"jimu-btn jimu-float-trailing jimu-trailing-margin1 "+p,innerHTML:y.label,title:y.title},this.buttonContainer);this.enabledButtons.unshift(h);p=d.create("div",
{"class":"jimu-btn jimu-state-disabled jimu-float-trailing jimu-trailing-margin1 "+p,title:y.title,innerHTML:y.label,style:{display:"none"}},this.buttonContainer);this.disabledButtons.unshift(p);this.own(x(h,"click",b.hitch(this,function(m){if(y.onClick)y.onClick(m);else this.close()})))},setButtonProps:function(y,p){"number"===typeof y&&isFinite(y)||(p=y,y=0);if(p&&0!==this.enabledButtons.length)for(var h in p)"title"===h?(d.setAttr(this.enabledButtons[y],"title",p[h]),d.setAttr(this.disabledButtons[y],
"title",p[h])):"label"===h&&(d.setProp(this.enabledButtons[y],"innerHTML",p[h]),d.setProp(this.disabledButtons[y],"innerHTML",p[h]))},enableButton:function(y){"number"===typeof y&&isFinite(y)&&y<this.enabledButtons.length?(d.setStyle(this.enabledButtons[y],"display","inline-block"),d.setStyle(this.disabledButtons[y],"display","none")):(c.forEach(this.enabledButtons[y],b.hitch(this,function(p){d.setStyle(p,"display","inline-block")})),c.forEach(this.disabledButtons[y],b.hitch(this,function(p){d.setStyle(p,
"display","none")})))},disableButton:function(y){"number"===typeof y&&isFinite(y)&&y<this.disabledButtons.length?(d.setStyle(this.disabledButtons[y],"display","inline-block"),d.setStyle(this.enabledButtons[y],"display","none")):(c.forEach(this.disabledButtons,b.hitch(this,function(p){d.setStyle(p,"display","inline-block")})),c.forEach(this.enabledButtons,b.hitch(this,function(p){d.setStyle(p,"display","none")})))},showButton:function(y){this.enableButton(y)},hideButton:function(y){"number"===typeof y&&
isFinite(y)&&y<this.disabledButtons.length?(d.setStyle(this.disabledButtons[y],"display","none"),d.setStyle(this.enabledButtons[y],"display","none")):(c.forEach(this.disabledButtons,b.hitch(this,function(p){d.setStyle(p,"display","none")})),c.forEach(this.enabledButtons,b.hitch(this,function(p){d.setStyle(p,"display","none")})))}})})},"dojo/_base/fx":function(){define("./kernel ./config ./lang ../Evented ./Color ../aspect ../sniff ../dom ../dom-style".split(" "),function(a,b,c,d,g,x,w,l,n){var f=
c.mixin,e={},k=e._Line=function(t,q){this.start=t;this.end=q};k.prototype.getValue=function(t){return(this.end-this.start)*t+this.start};var r=e.Animation=function(t){f(this,t);c.isArray(this.curve)&&(this.curve=new k(this.curve[0],this.curve[1]))};r.prototype=new d;c.extend(r,{duration:350,repeat:0,rate:20,_percent:0,_startRepeatCount:0,_getStep:function(){var t=this._percent,q=this.easing;return q?q(t):t},_fire:function(t,q){q=q||[];if(this[t])if(b.debugAtAllCosts)this[t].apply(this,q);else try{this[t].apply(this,
q)}catch(z){console.error("exception in animation handler for:",t),console.error(z)}return this},play:function(t,q){this._delayTimer&&this._clearTimer();if(q)this._stopTimer(),this._active=this._paused=!1,this._percent=0;else if(this._active&&!this._paused)return this;this._fire("beforeBegin",[this.node]);t=t||this.delay;q=c.hitch(this,"_play",q);if(0<t)return this._delayTimer=setTimeout(q,t),this;q();return this},_play:function(t){this._delayTimer&&this._clearTimer();this._startTime=(new Date).valueOf();
this._paused&&(this._startTime-=this.duration*this._percent);this._active=!0;this._paused=!1;t=this.curve.getValue(this._getStep());this._percent||(this._startRepeatCount||(this._startRepeatCount=this.repeat),this._fire("onBegin",[t]));this._fire("onPlay",[t]);this._cycle();return this},pause:function(){this._delayTimer&&this._clearTimer();this._stopTimer();if(!this._active)return this;this._paused=!0;this._fire("onPause",[this.curve.getValue(this._getStep())]);return this},gotoPercent:function(t,
q){this._stopTimer();this._active=this._paused=!0;this._percent=t;q&&this.play();return this},stop:function(t){this._delayTimer&&this._clearTimer();if(!this._timer)return this;this._stopTimer();t&&(this._percent=1);this._fire("onStop",[this.curve.getValue(this._getStep())]);this._active=this._paused=!1;return this},destroy:function(){this.stop()},status:function(){return this._active?this._paused?"paused":"playing":"stopped"},_cycle:function(){if(this._active){var t=(new Date).valueOf();t=0===this.duration?
1:(t-this._startTime)/this.duration;1<=t&&(t=1);this._percent=t;this.easing&&(t=this.easing(t));this._fire("onAnimate",[this.curve.getValue(t)]);1>this._percent?this._startTimer():(this._active=!1,0<this.repeat?(this.repeat--,this.play(null,!0)):-1==this.repeat?this.play(null,!0):this._startRepeatCount&&(this.repeat=this._startRepeatCount,this._startRepeatCount=0),this._percent=0,this._fire("onEnd",[this.node]),!this.repeat&&this._stopTimer())}return this},_clearTimer:function(){clearTimeout(this._delayTimer);
delete this._delayTimer}});var y=0,p=null,h={run:function(){}};c.extend(r,{_startTimer:function(){this._timer||(this._timer=x.after(h,"run",c.hitch(this,"_cycle"),!0),y++);p||(p=setInterval(c.hitch(h,"run"),this.rate))},_stopTimer:function(){this._timer&&(this._timer.remove(),this._timer=null,y--);0>=y&&(clearInterval(p),p=null,y=0)}});var m=w("ie")?function(t){var q=t.style;q.width.length||"auto"!=n.get(t,"width")||(q.width="auto")}:function(){};e._fade=function(t){t.node=l.byId(t.node);var q=f({properties:{}},
t);t=q.properties.opacity={};t.start="start"in q?q.start:function(){return+n.get(q.node,"opacity")||0};t.end=q.end;t=e.animateProperty(q);x.after(t,"beforeBegin",c.partial(m,q.node),!0);return t};e.fadeIn=function(t){return e._fade(f({end:1},t))};e.fadeOut=function(t){return e._fade(f({end:0},t))};e._defaultEasing=function(t){return.5+Math.sin((t+1.5)*Math.PI)/2};var u=function(t){this._properties=t;for(var q in t){var z=t[q];z.start instanceof g&&(z.tempColor=new g)}};u.prototype.getValue=function(t){var q=
{},z;for(z in this._properties){var v=this._properties[z],B=v.start;B instanceof g?q[z]=g.blendColors(B,v.end,t,v.tempColor).toCss():c.isArray(B)||(q[z]=(v.end-B)*t+B+("opacity"!=z?v.units||"px":0))}return q};e.animateProperty=function(t){var q=t.node=l.byId(t.node);t.easing||(t.easing=a._defaultEasing);t=new r(t);x.after(t,"beforeBegin",c.hitch(t,function(){var z={},v;for(v in this.properties){if("width"==v||"height"==v)this.node.display="block";var B=this.properties[v];c.isFunction(B)&&(B=B(q));
B=z[v]=f({},c.isObject(B)?B:{end:B});c.isFunction(B.start)&&(B.start=B.start(q));c.isFunction(B.end)&&(B.end=B.end(q));var A=0<=v.toLowerCase().indexOf("color"),E=function(C,D){var F={height:C.offsetHeight,width:C.offsetWidth}[D];if(void 0!==F)return F;F=n.get(C,D);return"opacity"==D?+F:A?F:parseFloat(F)};"end"in B?"start"in B||(B.start=E(q,v)):B.end=E(q,v);A?(B.start=new g(B.start),B.end=new g(B.end)):B.start="opacity"==v?+B.start:parseFloat(B.start)}this.curve=new u(z)}),!0);x.after(t,"onAnimate",
c.hitch(n,"set",t.node),!0);return t};e.anim=function(t,q,z,v,B,A){return e.animateProperty({node:t,duration:z||r.prototype.duration,properties:q,easing:v,onEnd:B}).play(A||0)};f(a,e);a._Animation=r;return e})},"dojo/touch":function(){define("./_base/kernel ./aspect ./dom ./dom-class ./_base/lang ./on ./has ./mouse ./domReady ./_base/window".split(" "),function(a,b,c,d,g,x,w,l,n,f){function e(C,D,F){return F?function(G,J){return x(G,F,J)}:p?function(G,J){var I=x(G,D,function(P){J.call(this,P);E=(new Date).getTime()}),
O=x(G,C,function(P){(!E||(new Date).getTime()>E+1E3)&&J.call(this,P)});return{remove:function(){I.remove();O.remove()}}}:function(G,J){return x(G,C,J)}}function k(C){do if(void 0!==C.dojoClick)return C;while(C=C.parentNode)}function r(C,D,F){if(!l.isRight(C)){var G=k(C.target);if(m=!C.target.disabled&&G&&G.dojoClick)if(t=(u="useTarget"==m)?G:C.target,u&&C.preventDefault(),q=C.changedTouches?C.changedTouches[0].pageX-f.global.pageXOffset:C.clientX,z=C.changedTouches?C.changedTouches[0].pageY-f.global.pageYOffset:
C.clientY,v=("object"==typeof m?m.x:"number"==typeof m?m:0)||4,B=("object"==typeof m?m.y:"number"==typeof m?m:0)||4,!h){h=!0;var J=function(I){m=u?c.isDescendant(f.doc.elementFromPoint(I.changedTouches?I.changedTouches[0].pageX-f.global.pageXOffset:I.clientX,I.changedTouches?I.changedTouches[0].pageY-f.global.pageYOffset:I.clientY),t):m&&(I.changedTouches?I.changedTouches[0].target:I.target)==t&&Math.abs((I.changedTouches?I.changedTouches[0].pageX-f.global.pageXOffset:I.clientX)-q)<=v&&Math.abs((I.changedTouches?
I.changedTouches[0].pageY-f.global.pageYOffset:I.clientY)-z)<=B};f.doc.addEventListener(D,function(I){l.isRight(I)||(J(I),u&&I.preventDefault())},!0);f.doc.addEventListener(F,function(I){if(!l.isRight(I)&&(J(I),m)){A=(new Date).getTime();var O=u?t:I.target;"LABEL"===O.tagName&&(O=c.byId(O.getAttribute("for"))||O);var P=I.changedTouches?I.changedTouches[0]:I,K=function(L){var N=document.createEvent("MouseEvents");N._dojo_click=!0;N.initMouseEvent(L,!0,!0,I.view,I.detail,P.screenX,P.screenY,P.clientX,
P.clientY,I.ctrlKey,I.altKey,I.shiftKey,I.metaKey,0,null);return N},M=K("mousedown"),U=K("mouseup"),R=K("click");setTimeout(function(){x.emit(O,"mousedown",M);x.emit(O,"mouseup",U);x.emit(O,"click",R);A=(new Date).getTime()},0)}},!0);C=function(I){f.doc.addEventListener(I,function(O){var P=O.target;m&&!O._dojo_click&&(new Date).getTime()<=A+1E3&&("INPUT"!=P.tagName||!d.contains(P,"dijitOffScreen"))&&(O.stopPropagation(),O.stopImmediatePropagation&&O.stopImmediatePropagation(),"click"==I&&("INPUT"!=
P.tagName||"radio"==P.type&&(d.contains(P,"dijitCheckBoxInput")||d.contains(P,"mblRadioButton"))||"checkbox"==P.type&&(d.contains(P,"dijitCheckBoxInput")||d.contains(P,"mblCheckBox")))&&"TEXTAREA"!=P.tagName&&"AUDIO"!=P.tagName&&"VIDEO"!=P.tagName&&O.preventDefault())},!0)};C("click");C("mousedown");C("mouseup")}}}w("ios");var y=function(){var C={},D;for(D in{down:1,move:1,up:1,cancel:1,over:1,out:1})C[D]="pointer"+D;return C}(),p=w("touch-events"),h,m,u=!1,t,q,z,v,B,A,E;w("touch")&&n(function(){f.doc.addEventListener(y.down,
function(C){r(C,y.move,y.up)},!0)});b={press:e("mousedown","touchstart",y.down),move:e("mousemove","dojotouchmove",y.move),release:e("mouseup","dojotouchend",y.up),cancel:e(l.leave,"touchcancel",y.cancel),over:e("mouseover","dojotouchover",y.over),out:e("mouseout","dojotouchout",y.out),enter:l._eventHandler(e("mouseover","dojotouchover",y.over)),leave:l._eventHandler(e("mouseout","dojotouchout",y.out))};return a.touch=b})},"dojo/dnd/move":function(){define("../_base/declare ../dom-geometry ../dom-style ./common ./Mover ./Moveable".split(" "),
function(a,b,c,d,g,x){d=a("dojo.dnd.move.constrainedMoveable",x,{constraints:function(){},within:!1,constructor:function(w,l){l||(l={});this.constraints=l.constraints;this.within=l.within},onFirstMove:function(w){var l=this.constraintBox=this.constraints.call(this,w);l.r=l.l+l.w;l.b=l.t+l.h;this.within&&(w=b.getMarginSize(w.node),l.r-=w.w,l.b-=w.h)},onMove:function(w,l){var n=this.constraintBox,f=w.node.style;this.onMoving(w,l);l.l=l.l<n.l?n.l:n.r<l.l?n.r:l.l;l.t=l.t<n.t?n.t:n.b<l.t?n.b:l.t;f.left=
l.l+"px";f.top=l.t+"px";this.onMoved(w,l)}});g=a("dojo.dnd.move.boxConstrainedMoveable",d,{box:{},constructor:function(w,l){var n=l&&l.box;this.constraints=function(){return n}}});a=a("dojo.dnd.move.parentConstrainedMoveable",d,{area:"content",constructor:function(w,l){var n=l&&l.area;this.constraints=function(){var f=this.node.parentNode,e=c.getComputedStyle(f),k=b.getMarginBox(f,e);if("margin"==n)return k;var r=b.getMarginExtents(f,e);k.l+=r.l;k.t+=r.t;k.w-=r.w;k.h-=r.h;if("border"==n)return k;
r=b.getBorderExtents(f,e);k.l+=r.l;k.t+=r.t;k.w-=r.w;k.h-=r.h;if("padding"==n)return k;r=b.getPadExtents(f,e);k.l+=r.l;k.t+=r.t;k.w-=r.w;k.h-=r.h;return k}}});return{constrainedMoveable:d,boxConstrainedMoveable:g,parentConstrainedMoveable:a}})},"dojo/dnd/common":function(){define(["../sniff","../_base/kernel","../_base/lang","../dom"],function(a,b,c,d){var g=c.getObject("dojo.dnd",!0);g.getCopyKeyState=function(x){return x.metaKey};g._uniqueId=0;g.getUniqueId=function(){do var x=b._scopeName+"Unique"+
++g._uniqueId;while(d.byId(x));return x};g._empty={};g.isFormElement=function(x){x=x.target;3==x.nodeType&&(x=x.parentNode);return 0<=" a button textarea input select option ".indexOf(" "+x.tagName.toLowerCase()+" ")};return g})},"dojo/dnd/Mover":function(){define("../_base/array ../_base/declare ../_base/lang ../sniff ../_base/window ../dom ../dom-geometry ../dom-style ../Evented ../on ../touch ./common ./autoscroll".split(" "),function(a,b,c,d,g,x,w,l,n,f,e,k,r){return b("dojo.dnd.Mover",[n],{constructor:function(y,
p,h){function m(u){u.preventDefault();u.stopPropagation()}this.node=x.byId(y);this.marginBox={l:p.pageX,t:p.pageY};this.mouseButton=p.button;p=this.host=h;y=y.ownerDocument;this.events=[f(y,e.move,c.hitch(this,"onFirstMove")),f(y,e.move,c.hitch(this,"onMouseMove")),f(y,e.release,c.hitch(this,"onMouseUp")),f(y,"dragstart",m),f(y.body,"selectstart",m)];r.autoScrollStart(y);if(p&&p.onMoveStart)p.onMoveStart(this)},onMouseMove:function(y){r.autoScroll(y);var p=this.marginBox;this.host.onMove(this,{l:p.l+
y.pageX,t:p.t+y.pageY},y);y.preventDefault();y.stopPropagation()},onMouseUp:function(y){(d("webkit")&&2==this.mouseButton?0==y.button:this.mouseButton==y.button)&&this.destroy();y.preventDefault();y.stopPropagation()},onFirstMove:function(y){var p=this.node.style,h=this.host;switch(p.position){case "relative":case "absolute":var m=Math.round(parseFloat(p.left))||0;p=Math.round(parseFloat(p.top))||0;break;default:p.position="absolute";p=w.getMarginBox(this.node);m=g.doc.body;var u=l.getComputedStyle(m),
t=w.getMarginBox(m,u);u=w.getContentBox(m,u);m=p.l-(u.l-t.l);p=p.t-(u.t-t.t)}this.marginBox.l=m-this.marginBox.l;this.marginBox.t=p-this.marginBox.t;if(h&&h.onFirstMove)h.onFirstMove(this,y);this.events.shift().remove()},destroy:function(){a.forEach(this.events,function(p){p.remove()});var y=this.host;if(y&&y.onMoveStop)y.onMoveStop(this);this.events=this.node=this.host=null}})})},"dojo/dnd/autoscroll":function(){define("../_base/lang ../sniff ../_base/window ../dom-geometry ../dom-style ../window".split(" "),
function(a,b,c,d,g,x){var w={};a.setObject("dojo.dnd.autoscroll",w);w.getViewport=x.getBox;w.V_TRIGGER_AUTOSCROLL=32;w.H_TRIGGER_AUTOSCROLL=32;w.V_AUTOSCROLL_VALUE=16;w.H_AUTOSCROLL_VALUE=16;var l,n=c.doc,f=Infinity,e=Infinity;w.autoScrollStart=function(k){n=k;l=x.getBox(n);k=c.body(n).parentNode;f=Math.max(k.scrollHeight-l.h,0);e=Math.max(k.scrollWidth-l.w,0)};w.autoScroll=function(k){var r=l||x.getBox(n),y=c.body(n).parentNode,p=0,h=0;k.clientX<w.H_TRIGGER_AUTOSCROLL?p=-w.H_AUTOSCROLL_VALUE:k.clientX>
r.w-w.H_TRIGGER_AUTOSCROLL&&(p=Math.min(w.H_AUTOSCROLL_VALUE,e-y.scrollLeft));k.clientY<w.V_TRIGGER_AUTOSCROLL?h=-w.V_AUTOSCROLL_VALUE:k.clientY>r.h-w.V_TRIGGER_AUTOSCROLL&&(h=Math.min(w.V_AUTOSCROLL_VALUE,f-y.scrollTop));window.scrollBy(p,h)};w._validNodes={div:1,p:1,td:1};w._validOverflow={auto:1,scroll:1};w.autoScrollNodes=function(k){for(var r,y,p,h,m,u=0,t=0,q=k.target;q;){if(1==q.nodeType&&q.tagName.toLowerCase()in w._validNodes){p=g.getComputedStyle(q);m=p.overflowX.toLowerCase()in w._validOverflow;
h=p.overflowY.toLowerCase()in w._validOverflow;if(m||h)r=d.getContentBox(q,p),y=d.position(q,!0);if(m){p=Math.min(w.H_TRIGGER_AUTOSCROLL,r.w/2);m=k.pageX-y.x;if(b("webkit")||b("opera"))m+=c.body().scrollLeft;u=0;0<m&&m<r.w&&(m<p?u=-p:m>r.w-p&&(u=p),q.scrollLeft+=u)}if(h){h=Math.min(w.V_TRIGGER_AUTOSCROLL,r.h/2);p=k.pageY-y.y;if(b("webkit")||b("opera"))p+=c.body().scrollTop;t=0;0<p&&p<r.h&&(p<h?t=-h:p>r.h-h&&(t=h),q.scrollTop+=t)}if(u||t)return}try{q=q.parentNode}catch(z){q=null}}w.autoScroll(k)};
return w})},"dojo/window":function(){define("./_base/lang ./sniff ./_base/window ./dom ./dom-geometry ./dom-style ./dom-construct".split(" "),function(a,b,c,d,g,x,w){b.add("rtl-adjust-position-for-verticalScrollBar",function(n,f){n=c.body(f);f=w.create("div",{style:{overflow:"scroll",overflowX:"visible",direction:"rtl",visibility:"hidden",position:"absolute",left:"0",top:"0",width:"64px",height:"64px"}},n,"last");var e=w.create("div",{style:{overflow:"hidden",direction:"ltr"}},f,"last"),k=0!=g.position(e).x;
f.removeChild(e);n.removeChild(f);return k});b.add("position-fixed-support",function(n,f){n=c.body(f);f=w.create("span",{style:{visibility:"hidden",position:"fixed",left:"1px",top:"1px"}},n,"last");var e=w.create("span",{style:{position:"fixed",left:"0",top:"0"}},f,"last"),k=g.position(e).x!=g.position(f).x;f.removeChild(e);n.removeChild(f);return k});var l={getBox:function(n){n=n||c.doc;var f="BackCompat"==n.compatMode?c.body(n):n.documentElement,e=g.docScroll(n);if(b("touch")){var k=l.get(n);n=
k.innerWidth||f.clientWidth;f=k.innerHeight||f.clientHeight}else n=f.clientWidth,f=f.clientHeight;return{l:e.x,t:e.y,w:n,h:f}},get:function(n){if(b("ie")&&l!==document.parentWindow){n.parentWindow.execScript("document._parentWindow \x3d window;","Javascript");var f=n._parentWindow;n._parentWindow=null;return f}return n.parentWindow||n.defaultView},scrollIntoView:function(n,f){try{n=d.byId(n);var e=n.ownerDocument||c.doc,k=c.body(e),r=e.documentElement||k.parentNode,y=b("ie")||0,p=b("webkit");if(n!=
k&&n!=r){var h="BackCompat"==e.compatMode,m=Math.min(k.clientWidth||r.clientWidth,r.clientWidth||k.clientWidth),u=Math.min(k.clientHeight||r.clientHeight,r.clientHeight||k.clientHeight);e=p||h?k:r;var t=f||g.position(n),q=n.parentNode;f=function(K){return 6>=y||7==y&&h?!1:b("position-fixed-support")&&"fixed"==x.get(K,"position").toLowerCase()};var z=this;p=function(K,M,U){"BODY"==K.tagName||"HTML"==K.tagName?z.get(K.ownerDocument).scrollBy(M,U):(M&&(K.scrollLeft+=M),U&&(K.scrollTop+=U))};if(!f(n))for(;q;){q==
k&&(q=e);var v=g.position(q),B=f(q),A="rtl"==x.getComputedStyle(q).direction.toLowerCase();if(q==e)v.w=m,v.h=u,e==r&&y&&A&&(v.x+=e.offsetWidth-v.w),v.x=0,v.y=0;else{var E=g.getPadBorderExtents(q);v.w-=E.w;v.h-=E.h;v.x+=E.l;v.y+=E.t;var C=q.clientWidth,D=v.w-C;0<C&&0<D&&(A&&b("rtl-adjust-position-for-verticalScrollBar")&&(v.x+=D),v.w=C);C=q.clientHeight;D=v.h-C;0<C&&0<D&&(v.h=C)}B&&(0>v.y&&(v.h+=v.y,v.y=0),0>v.x&&(v.w+=v.x,v.x=0),v.y+v.h>u&&(v.h=u-v.y),v.x+v.w>m&&(v.w=m-v.x));var F=t.x-v.x,G=t.y-v.y,
J=F+t.w-v.w,I=G+t.h-v.h;if(0<J*F&&(q.scrollLeft||q==e||q.scrollWidth>q.offsetHeight)){var O=Math[0>F?"max":"min"](F,J);A&&8==y&&!h&&(O=-O);var P=q.scrollLeft;p(q,O,0);O=q.scrollLeft-P;t.x-=O}0<I*G&&(q.scrollTop||q==e||q.scrollHeight>q.offsetHeight)&&(O=Math.ceil(Math[0>G?"max":"min"](G,I)),P=q.scrollTop,p(q,0,O),O=q.scrollTop-P,t.y-=O);q=q!=e&&!B&&q.parentNode}}}catch(K){console.error("scrollIntoView: "+K),n.scrollIntoView(!1)}}};a.setObject("dojo.window",l);return l})},"dojo/dnd/Moveable":function(){define("../_base/array ../_base/declare ../_base/lang ../dom ../dom-class ../Evented ../has ../on ../topic ../touch ./common ./Mover ../_base/window".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r){var y,p=function(){};p=function(h,m){"touchAction"in document.body.style?y="touchAction":"msTouchAction"in document.body.style&&(y="msTouchAction");p=function(u,t){u.style[y]=t};p(h,m)};return b("dojo.dnd.Moveable",[x],{handle:"",delay:0,skip:!1,constructor:function(h,m){this.node=d.byId(h);p(this.node,"none");m||(m={});this.handle=m.handle?d.byId(m.handle):null;this.handle||(this.handle=this.node);this.delay=0<m.delay?m.delay:0;this.skip=m.skip;this.mover=m.mover?
m.mover:k;this.events=[l(this.handle,f.press,c.hitch(this,"onMouseDown")),l(this.handle,"dragstart",c.hitch(this,"onSelectStart")),l(this.handle,"selectstart",c.hitch(this,"onSelectStart"))]},markupFactory:function(h,m,u){return new u(m,h)},destroy:function(){a.forEach(this.events,function(h){h.remove()});p(this.node,"");this.events=this.node=this.handle=null},onMouseDown:function(h){if(!this.skip||!e.isFormElement(h)){if(this.delay)this.events.push(l(this.handle,f.move,c.hitch(this,"onMouseMove")),
l(this.handle.ownerDocument,f.release,c.hitch(this,"onMouseUp"))),this._lastX=h.pageX,this._lastY=h.pageY;else this.onDragDetected(h);h.stopPropagation();h.preventDefault()}},onMouseMove:function(h){if(Math.abs(h.pageX-this._lastX)>this.delay||Math.abs(h.pageY-this._lastY)>this.delay)this.onMouseUp(h),this.onDragDetected(h);h.stopPropagation();h.preventDefault()},onMouseUp:function(h){for(var m=0;2>m;++m)this.events.pop().remove();h.stopPropagation();h.preventDefault()},onSelectStart:function(h){this.skip&&
e.isFormElement(h)||(h.stopPropagation(),h.preventDefault())},onDragDetected:function(h){new this.mover(this.node,h,this)},onMoveStart:function(h){n.publish("/dnd/move/start",h);g.add(r.body(),"dojoMove");g.add(this.node,"dojoMoveItem")},onMoveStop:function(h){n.publish("/dnd/move/stop",h);g.remove(r.body(),"dojoMove");g.remove(this.node,"dojoMoveItem")},onFirstMove:function(){},onMove:function(h,m){this.onMoving(h,m);var u=h.node.style;u.left=m.l+"px";u.top=m.t+"px";this.onMoved(h,m)},onMoving:function(){},
onMoved:function(){}})})},"dijit/_WidgetBase":function(){define("require dojo/_base/array dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/_base/kernel dojo/_base/lang dojo/on dojo/ready dojo/Stateful dojo/topic dojo/_base/window ./Destroyable dojo/has!dojo-bidi?./_BidiMixin ./registry".split(" "),function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B){function A(C){return function(D){l[D?
"set":"remove"](this.domNode,C,D);this._set(C,D)}}r.add("dijit-legacy-requires",!y.isAsync);r.add("dojo-bidi",!1);r("dijit-legacy-requires")&&m(0,function(){a(["dijit/_base/manager"])});var E={};d=x("dijit._WidgetBase",[u,z],{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:A("lang"),dir:"",_setDirAttr:A("dir"),"class":"",_setClassAttr:{node:"domNode",type:"class"},_setTypeAttr:null,style:"",title:"",tooltip:"",baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,ownerDocument:null,_setOwnerDocumentAttr:function(C){this._set("ownerDocument",
C)},attributeMap:{},_blankGif:d.blankGif||a.toUrl("dojo/resources/blank.gif"),textDir:"",_introspect:function(){var C=this.constructor;if(!C._setterAttrs){var D=C.prototype,F=C._setterAttrs=[];C=C._onMap={};for(var G in D.attributeMap)F.push(G);for(G in D)/^on/.test(G)&&(C[G.substring(2).toLowerCase()]=G),/^_set[A-Z](.*)Attr$/.test(G)&&(G=G.charAt(4).toLowerCase()+G.substr(5,G.length-9),D.attributeMap&&G in D.attributeMap||F.push(G))}},postscript:function(C,D){this.create(C,D)},create:function(C,
D){this._introspect();this.srcNodeRef=w.byId(D);this._connects=[];this._supportingWidgets=[];this.srcNodeRef&&this.srcNodeRef.id&&"string"==typeof this.srcNodeRef.id&&(this.id=this.srcNodeRef.id);C&&(this.params=C,p.mixin(this,C));this.postMixInProperties();this.id||(this.id=B.getUniqueId(this.declaredClass.replace(/\./g,"_")),this.params&&delete this.params.id);this.ownerDocument=this.ownerDocument||(this.srcNodeRef?this.srcNodeRef.ownerDocument:document);this.ownerDocumentBody=q.body(this.ownerDocument);
B.add(this);this.buildRendering();if(this.domNode){this._applyAttributes();if((C=this.srcNodeRef)&&C.parentNode&&this.domNode!==C){C.parentNode.replaceChild(this.domNode,C);var F=!0}this.domNode.setAttribute("widgetId",this.id)}this.postCreate();F&&delete this.srcNodeRef;this._created=!0},_applyAttributes:function(){var C={},D;for(D in this.params||{})C[D]=this._get(D);b.forEach(this.constructor._setterAttrs,function(F){if(!(F in C)){var G=this._get(F);G&&this.set(F,G)}},this);for(D in C)this.set(D,
C[D])},postMixInProperties:function(){},buildRendering:function(){this.domNode||(this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div"));if(this.baseClass){var C=this.baseClass.split(" ");this.isLeftToRight()||(C=C.concat(b.map(C,function(D){return D+"Rtl"})));n.add(this.domNode,C)}},postCreate:function(){},startup:function(){this._started||(this._started=!0,b.forEach(this.getChildren(),function(C){C._started||C._destroyed||!p.isFunction(C.startup)||(C.startup(),C._started=!0)}))},
destroyRecursive:function(C){this._beingDestroyed=!0;this.destroyDescendants(C);this.destroy(C)},destroy:function(C){function D(F){F.destroyRecursive?F.destroyRecursive(C):F.destroy&&F.destroy(C)}this._beingDestroyed=!0;this.uninitialize();b.forEach(this._connects,p.hitch(this,"disconnect"));b.forEach(this._supportingWidgets,D);this.domNode&&b.forEach(B.findWidgets(this.domNode,this.containerNode),D);this.destroyRendering(C);B.remove(this.id);this._destroyed=!0},destroyRendering:function(C){this.bgIframe&&
(this.bgIframe.destroy(C),delete this.bgIframe);this.domNode&&(C?l.remove(this.domNode,"widgetId"):f.destroy(this.domNode),delete this.domNode);this.srcNodeRef&&(C||f.destroy(this.srcNodeRef),delete this.srcNodeRef)},destroyDescendants:function(C){b.forEach(this.getChildren(),function(D){D.destroyRecursive&&D.destroyRecursive(C)})},uninitialize:function(){return!1},_setStyleAttr:function(C){var D=this.domNode;p.isObject(C)?k.set(D,C):D.style.cssText=D.style.cssText?D.style.cssText+("; "+C):C;this._set("style",
C)},_attrToDom:function(C,D,F){F=3<=arguments.length?F:this.attributeMap[C];b.forEach(p.isArray(F)?F:[F],function(G){var J=this[G.node||G||"domNode"];switch(G.type||"attribute"){case "attribute":p.isFunction(D)&&(D=p.hitch(this,D));G=G.attribute?G.attribute:/^on[A-Z][a-zA-Z]*$/.test(C)?C.toLowerCase():C;J.tagName?l.set(J,G,D):J.set(G,D);break;case "innerText":J.innerHTML="";J.appendChild(this.ownerDocument.createTextNode(D));break;case "textContent":J.textContent=D;break;case "innerHTML":J.innerHTML=
D;break;case "class":n.replace(J,D,this[C]);break;case "toggleClass":n.toggle(J,G.className||C,D)}},this)},get:function(C){var D=this._getAttrNames(C);return this[D.g]?this[D.g]():this._get(C)},set:function(C,D){if("object"===typeof C){for(var F in C)this.set(F,C[F]);return this}F=this._getAttrNames(C);var G=this[F.s];if(p.isFunction(G))var J=G.apply(this,Array.prototype.slice.call(arguments,1));else{G=this.focusNode&&!p.isFunction(this.focusNode)?"focusNode":"domNode";var I=this[G]&&this[G].tagName,
O;if((O=I)&&!(O=E[I])){O=this[G];var P={};for(K in O)P[K.toLowerCase()]=!0;O=E[I]=P}var K=O;F=C in this.attributeMap?this.attributeMap[C]:F.s in this?this[F.s]:K&&F.l in K&&"function"!=typeof D||/^aria-|^data-|^role$/.test(C)?G:null;null!=F&&this._attrToDom(C,D,F);this._set(C,D)}return J||this},_attrPairNames:{},_getAttrNames:function(C){var D=this._attrPairNames;if(D[C])return D[C];var F=C.replace(/^[a-z]|-[a-zA-Z]/g,function(G){return G.charAt(G.length-1).toUpperCase()});return D[C]={n:C+"Node",
s:"_set"+F+"Attr",g:"_get"+F+"Attr",l:F.toLowerCase()}},_set:function(C,D){var F=this[C];this[C]=D;!this._created||F===D||F!==F&&D!==D||(this._watchCallbacks&&this._watchCallbacks(C,F,D),this.emit("attrmodified-"+C,{detail:{prevValue:F,newValue:D}}))},_get:function(C){return this[C]},emit:function(C,D,F){D=D||{};void 0===D.bubbles&&(D.bubbles=!0);void 0===D.cancelable&&(D.cancelable=!0);D.detail||(D.detail={});D.detail.widget=this;var G,J=this["on"+C];J&&(G=J.apply(this,F?F:[D]));this._started&&!this._beingDestroyed&&
h.emit(this.domNode,C.toLowerCase(),D);return G},on:function(C,D){var F=this._onMap(C);return F?c.after(this,F,D,!0):this.own(h(this.domNode,C,D))[0]},_onMap:function(C){var D=this.constructor,F=D._onMap;if(!F){F=D._onMap={};for(var G in D.prototype)/^on/.test(G)&&(F[G.replace(/^on/,"").toLowerCase()]=G)}return F["string"==typeof C&&C.toLowerCase()]},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},getChildren:function(){return this.containerNode?B.findWidgets(this.containerNode):
[]},getParent:function(){return B.getEnclosingWidget(this.domNode.parentNode)},connect:function(C,D,F){return this.own(g.connect(C,D,this,F))[0]},disconnect:function(C){C.remove()},subscribe:function(C,D){return this.own(t.subscribe(C,p.hitch(this,D)))[0]},unsubscribe:function(C){C.remove()},isLeftToRight:function(){return this.dir?"ltr"==this.dir.toLowerCase():e.isBodyLtr(this.ownerDocument)},isFocusable:function(){return this.focus&&"none"!=k.get(this.domNode,"display")},placeAt:function(C,D){var F=
!C.tagName&&B.byId(C);!F||!F.addChild||D&&"number"!==typeof D?(C=F&&"domNode"in F?F.containerNode&&!/after|before|replace/.test(D||"")?F.containerNode:F.domNode:w.byId(C,this.ownerDocument),f.place(this.domNode,C,D),!this._started&&(this.getParent()||{})._started&&this.startup()):F.addChild(this,D);return this},defer:function(C,D){var F=setTimeout(p.hitch(this,function(){F&&(F=null,this._destroyed||p.hitch(this,C)())}),D||0);return{remove:function(){F&&(clearTimeout(F),F=null);return null}}}});r("dojo-bidi")&&
d.extend(v);return d})},"dojo/Stateful":function(){define(["./_base/declare","./_base/lang","./_base/array","./when"],function(a,b,c,d){return a("dojo.Stateful",null,{_attrPairNames:{},_getAttrNames:function(g){var x=this._attrPairNames;return x[g]?x[g]:x[g]={s:"_"+g+"Setter",g:"_"+g+"Getter"}},postscript:function(g){g&&this.set(g)},_get:function(g,x){return"function"===typeof this[x.g]?this[x.g]():this[g]},get:function(g){return this._get(g,this._getAttrNames(g))},set:function(g,x){if("object"===
typeof g){for(var w in g)g.hasOwnProperty(w)&&"_watchCallbacks"!=w&&this.set(w,g[w]);return this}w=this._getAttrNames(g);var l=this._get(g,w);w=this[w.s];var n;"function"===typeof w?n=w.apply(this,Array.prototype.slice.call(arguments,1)):this[g]=x;if(this._watchCallbacks){var f=this;d(n,function(){f._watchCallbacks(g,l,x)})}return this},_changeAttrValue:function(g,x){var w=this.get(g);this[g]=x;this._watchCallbacks&&this._watchCallbacks(g,w,x);return this},watch:function(g,x){var w=this._watchCallbacks;
if(!w){var l=this;w=this._watchCallbacks=function(f,e,k,r){var y=function(p){if(p){p=p.slice();for(var h=0,m=p.length;h<m;h++)p[h].call(l,f,e,k)}};y(w["_"+f]);r||y(w["*"])}}x||"function"!==typeof g?g="_"+g:(x=g,g="*");var n=w[g];"object"!==typeof n&&(n=w[g]=[]);n.push(x);g={};g.unwatch=g.remove=function(){var f=c.indexOf(n,x);-1<f&&n.splice(f,1)};return g}})})},"dijit/Destroyable":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare"],function(a,b,c){return c("dijit.Destroyable",
null,{destroy:function(d){this._destroyed=!0},own:function(){var d=["destroyRecursive","destroy","remove"];a.forEach(arguments,function(g){function x(){w.remove();a.forEach(l,function(f){f.remove()})}var w=b.before(this,"destroy",function(f){g[n](f)}),l=[];if(g.then){var n="cancel";g.then(x,x)}else a.forEach(d,function(f){"function"===typeof g[f]&&(n||(n=f),l.push(b.after(g,f,x,!0)))})},this);return arguments}})})},"dijit/registry":function(){define(["dojo/_base/array","dojo/_base/window","./main"],
function(a,b,c){var d={},g={},x={length:0,add:function(w){if(g[w.id])throw Error("Tried to register widget with id\x3d\x3d"+w.id+" but that id is already registered");g[w.id]=w;this.length++},remove:function(w){g[w]&&(delete g[w],this.length--)},byId:function(w){return"string"==typeof w?g[w]:w},byNode:function(w){return g[w.getAttribute("widgetId")]},toArray:function(){var w=[],l;for(l in g)w.push(g[l]);return w},getUniqueId:function(w){do var l=w+"_"+(w in d?++d[w]:d[w]=0);while(g[l]);return"dijit"==
c._scopeName?l:c._scopeName+"_"+l},findWidgets:function(w,l){function n(e){for(e=e.firstChild;e;e=e.nextSibling)if(1==e.nodeType){var k=e.getAttribute("widgetId");k?(k=g[k])&&f.push(k):e!==l&&n(e)}}var f=[];n(w);return f},_destroyAll:function(){c._curFocus=null;c._prevFocus=null;c._activeStack=[];a.forEach(x.findWidgets(b.body()),function(w){w._destroyed||(w.destroyRecursive?w.destroyRecursive():w.destroy&&w.destroy())})},getEnclosingWidget:function(w){for(;w;){var l=1==w.nodeType&&w.getAttribute("widgetId");
if(l)return g[l];w=w.parentNode}return null},_hash:g};return c.registry=x})},"jimu/portalUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/config dojo/Deferred dojo/topic dojo/json esri/request ./utils ./portalUrlUtils ./tokenUtils".split(" "),function(a,b,c,d,g,x,w,l,n,f,e){var k=a([],{declaredClass:"jimu.Portal",selfUrl:null,user:null,selfInfo:null,portalUrl:null,credential:null,constructor:function(m){this.portalUrl=f.getStandardPortalUrl(m);this.selfUrl=
f.getPortalSelfInfoUrl(m)},loadSelfInfo:function(){var m=new g,u={query:{f:"json"},responseType:"json",callbackParamName:"callback",cacheBust:!0};this.isValidCredential()&&(u.query.token=this.credential.token);l(this.selfUrl,u).then(b.hitch(this,function(t){t=t.data;var q=t.user;delete t.user;b.mixin(this,t);t.user=q;m.resolve(t)}),b.hitch(this,function(t){console.error(t);m.reject(t)}));return m},_checkCredential:function(){var m=e.isValidCredential(this.credential);m||this.clearCredentialAndUser();
return m},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.credential=e.getPortalCredential(this.portalUrl))},signIn:function(){var m=new g;this.updateCredential();this.isValidCredential()?setTimeout(b.hitch(this,function(){m.resolve(this.credential)}),0):m=e.signInPortal(this.portalUrl);return m},haveSignIn:function(){return e.userHaveSignInPortal(this.portalUrl)},clearCredentialAndUser:function(){this.user=
this.credential=null},getSigninSettingsOfSelfInfo:function(){this.updateCredential();var m=new g,u=this.selfUrl+"/signinSettings";this.isValidCredential()?l(u,{handleAs:"json",query:{f:"json",token:this.credential.token},callbackParamName:"callback"}).then(b.hitch(this,function(t){m.resolve(t.data)}),b.hitch(this,function(t){m.reject(t)})):m.resolve({});return m},getUser:function(){this.updateCredential();var m=new g;this.user&&"jimu.PortalUser"===this.user.declaredClass?setTimeout(b.hitch(this,function(){this.user.updateCredential();
m.resolve(this.user)}),0):this.isValidCredential()?this.credential.userId?this._getUser(this.credential.userId).then(b.hitch(this,function(u){this.user=u;m.resolve(this.user)}),b.hitch(this,function(u){console.error(u);m.reject(u)})):e.getUserIdByToken(this.credential.token,this.portalUrl).then(b.hitch(this,function(u){this.credential.userId=u;this._getUser(this.credential.userId).then(b.hitch(this,function(t){this.user=t;m.resolve(this.user)}),b.hitch(this,function(t){console.error(t);m.reject(t)}))}),
b.hitch(this,function(u){console.error(u);m.reject(u)})):setTimeout(b.hitch(this,function(){m.reject("credential is null.")}),0);return m},queryItems:function(m){this.updateCredential();var u=new g,t=f.getBaseSearchUrl(this.portalUrl),q={f:"json"};m&&(q=b.mixin(q,m));this.isValidCredential()&&(q.token=this.credential.token);q.sortField||q.sortOrder||(q.sortField="title",q.sortOrder="asc");l(t,{responseType:"json",query:q,callbackParamName:"callback"}).then(b.hitch(this,function(z){z=z.data;z.results=
c.map(z.results,b.hitch(this,function(v){v.portalUrl=this.portalUrl;v.credential=this.credential;v.portal=this;return new p(v)}));u.resolve(z)}),b.hitch(this,function(z){console.error(z);u.reject(z)}));return u},getItemData:function(m){this.updateCredential();m=f.getItemDataUrl(this.portalUrl,m);var u={responseType:"json",query:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(u.query.token=this.credential.token);var t=new g;l(m,u).then(b.hitch(this,function(q){t.resolve(q.data)}),
b.hitch(this,function(q){t.reject(q)}));return t},getItemById:function(m){var u=new g;this.updateCredential();m=f.getItemUrl(this.portalUrl,m);var t={responseType:"json",query:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(t.query.token=this.credential.token);l(m,t).then(b.hitch(this,function(q){q=q.data;q.portalUrl=this.portalUrl;q.credential=this.credential;q.portal=this;q=new p(q);u.resolve(q)}),b.hitch(this,function(q){console.error(q);u.reject(q)}));return u},getAppById:function(m){var u=
new g;this.updateCredential();this.isValidCredential()?(m=f.getAppIdUrl(this.portalUrl,m),l(m,{responseType:"json",query:{f:"json",token:this.credential.token}}).then(b.hitch(this,function(t){u.resolve(t.data)}),b.hitch(this,function(t){u.reject(t)}))):setTimeout(b.hitch(this,function(){u.reject("token is null.")}),0);return u},queryGroups:function(m){this.updateCredential();var u=new g,t=f.getBaseGroupUrl(this.portalUrl),q={f:"json"};m&&(q=b.mixin(q,m));this.isValidCredential()&&(q.token=this.credential.token);
l(t,{responseType:"json",query:q,callbackParamName:"callback"}).then(b.hitch(this,function(z){z=z.data;z.results=c.map(z.results,b.hitch(this,function(v){v.portalUrl=this.portalUrl;v.credential=this.credential;v.portal=this;return new y(v)}));u.resolve(z)}),b.hitch(this,function(z){console.error(z);u.reject(z)}));return u},registerApp:function(m,u,t){var q=new g;this.updateCredential();if(this.isValidCredential()){var z=this.credential&&this.credential.token,v=f.getOAuth2Url(this.portalUrl);l(v+"/registerApp",
{query:{itemId:m,appType:u,redirect_uris:w.stringify(t),token:z,f:"json"},responseType:"json",method:"post"}).then(b.hitch(this,function(B){q.resolve(B.data)}),b.hitch(this,function(B){q.reject(B)}))}else setTimeout(b.hitch(this,function(){q.reject("token is null.")}),0);return q},createAndRegisterApp:function(m){var u=new g;this.updateCredential();this.isValidCredential()?this.getUser().then(b.hitch(this,function(t){t.addItem({title:"ArcGIS Web AppBuilder",type:"Web Mapping Application",text:"",
snippet:"",tags:"Registered App for OAuth"},"").then(b.hitch(this,function(q){q.success?this.registerApp(q.id,"browser",m).then(b.hitch(this,function(z){u.resolve(z)}),b.hitch(this,function(z){console.error(z);u.reject(z)})):u.reject("create app failed")}),b.hitch(this,function(q){console.error(q);u.reject(q)}))}),b.hitch(this,function(t){console.error(t);u.reject(t)})):setTimeout(b.hitch(this,function(){u.reject("token is null.")}),0);return u},_getUser:function(m){this.updateCredential();var u=
new g;m=f.getUserUrl(this.portalUrl,m);var t={query:{f:"json"},responseType:"json",callbackParamName:"callback"};this.isValidCredential()&&(t.query.token=this.credential&&this.credential.token);l(m,t).then(b.hitch(this,function(q){q=q.data;q.portalUrl=this.portalUrl;q.credential=this.credential;q.portal=this;this.user=new r(q);u.resolve(this.user)}),b.hitch(this,function(q){console.error(q);u.reject(q)}));return u},getItemResources:function(m,u,t){t||(t=100);m=f.getStandardPortalUrl(m);m=f.getItemResourceUrl(m,
u);return l({url:m,content:{f:"json",num:t}}).then(function(q){if(q&&q.resources)return q.resources})},addResource:function(m,u,t,q,z){m=f.getStandardPortalUrl(m);var v=this.getPortal(m),B=new FormData;B.append("file",t,q);B.append("fileName",q);B.append("f","json");var A="";z?(B.append("resourcesPrefix",z),A=z+"/"+q):A=q;return v.getItemById(u,!0).then(function(E){E=f.getUserContentItemUrl(m,E.owner,u);return l({url:E+"/addResources",form:B}).then(function(C){var D="";C&&C.success&&(D=f.getItemResourceUrl(m,
"${itemId}",A));return D},function(C){console.error(C.message||C);return C})})},removeResources:function(m,u,t,q){var z={resource:q?q+"/"+t:t,f:"json"};m=f.getStandardPortalUrl(m);return this.getPortal(m).getItemById(u,!0).then(function(v){v=f.getUserContentItemUrl(m,v.owner,u);return l({url:v+"/removeResources",content:z},{usePost:!0}).then(function(B){return B},function(B){console.error(B.message||B);return B})})}}),r=a([],{declaredClass:"jimu.PortalUser",portalUrl:null,credential:null,portal:null,
constructor:function(m){m&&b.mixin(this,m)},_checkCredential:function(){var m=e.isValidCredential(this.credential);m||(this.credential=null);return m},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},getGroups:function(){var m=[];this.groups&&(m=c.map(this.groups,b.hitch(this,function(u){u.portalUrl=this.portalUrl;u.credential=this.credential;
u.portal=this.portal;return new y(u)})));return m},getItemsByKeywords:function(m,u){return this.portal.queryItems({start:u||1,num:100,q:"owner:"+this.username+' AND typekeywords:"'+m+'"'})},getContent:function(){this.updateCredential();var m=f.getUserContentUrl(this.portalUrl,this.username),u={responseType:"json",query:{f:"json"},callbackParamName:"callback"};this.isValidCredential&&(u.query.token=this.credential.token);var t=new g;l(m,u).then(b.hitch(this,function(q){t.resolve(q.data)}),b.hitch(this,
function(q){t.reject(q)}));return t},getTags:function(){this.updateCredential();var m=f.getUserTagsUrl(this.portalUrl,this.username),u={responseType:"json",query:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(u.query.token=this.credential.token);var t=new g;l(m,u).then(b.hitch(this,function(q){t.resolve(q.data)}),b.hitch(this,function(q){t.reject(q)}));return t},addItem:function(m,u){this.updateCredential();var t=new g;if(this.isValidCredential()){var q={f:"json",token:this.credential.token};
m&&(q=b.mixin(q,m));m=f.getAddItemUrl(this.portalUrl,this.username,u);l(m,{responseType:"json",callbackParamName:"callback",query:q,method:"post"}).then(b.hitch(this,function(z){t.resolve(z.data)}),b.hitch(this,function(z){console.error(z);t.reject(z)}))}else setTimeout(b.hitch(this,function(){t.reject("token is null.")}),0);return t},deleteItem:function(m){this.updateCredential();var u=new g;this.isValidCredential()?(m=f.getDeleteItemUrl(this.portalUrl,this.username,m),l(m,{query:{token:this.credential.token,
f:"json"},responseType:"json",method:"post"}).then(b.hitch(this,function(t){u.resolve(t.data)}),b.hitch(this,function(t){u.reject(t)}))):setTimeout(b.hitch(this,function(){u.reject("token is null.")}),0);return u},getItemById:function(m,u){this.updateCredential();var t=new g;u=f.getUserItemsUrl(this.portalUrl,this.username,u);var q={responseType:"json",query:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(q.query.token=this.credential.token);l(u+"/"+m,q).then(b.hitch(this,function(z){z=
z.data;z.portalUrl=this.portalUrl;z.credential=this.credential;z.portal=this;z=new p(z);t.resolve(z)}),b.hitch(this,function(z){console.error(z);t.reject(z)}));return t},shareItem:function(m,u,t){this.updateCredential();var q=new g;this.isValidCredential()?(u=f.shareItemUrl(this.portalUrl,this.username,u,t),t={responseType:"json",callbackParamName:"callback",query:{f:"json",token:this.credential.token},method:"post"},m&&(m.content&&!m.query&&(m.query=m.content),t.query=b.mixin(t.query,m)),l(u,t).then(b.hitch(this,
function(z){q.resolve(z.data)}),b.hitch(this,function(z){console.error(z);q.reject(z)}))):setTimeout(b.hitch(this,function(){q.reject("token is null.")}),0);return q},updateItem:function(m,u){this.updateCredential();var t=new g;this.isValidCredential()?this.portal.getItemById(m).then(b.hitch(this,function(q){var z={f:"json",token:this.credential.token};u&&(z=b.mixin(z,u));q=f.getUpdateItemUrl(this.portalUrl,this.username,m,q.ownerFolder);l(q,{responseType:"json",callbackParamName:"callback",timeout:1E5,
query:z,method:"post"}).then(b.hitch(this,function(v){t.resolve(v.data)}),b.hitch(this,function(v){console.error(v);t.reject(v)}))}),b.hitch(this,function(q){console.error(q);t.reject(q)})):setTimeout(b.hitch(this,function(){t.reject("token is null.")}),0);return t},isAdminRole:function(){return"org_admin"===this.role||"account_admin"===this.role},isPublisherRole:function(){return"org_publisher"===this.role||"account_publisher"===this.role},isUserRole:function(){return"org_user"===this.role||"account_user"===
this.role}}),y=a([],{declaredClass:"jimu.PortalGroup",portalUrl:null,credential:null,portal:null,constructor:function(m){m&&b.mixin(this,m)},_checkCredential:function(){var m=e.isValidCredential(this.credential);m||(this.credential=null);return m},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},queryItems:function(m){m.q="group:"+this.id+
" AND "+m.q;return this.portal.queryItems(m)}}),p=a([],{declaredClass:"jimu.PortalItem",itemUrl:null,detailsPageUrl:null,ownerPageUrl:null,portalUrl:null,credential:null,portal:null,token:null,constructor:function(m){m&&b.mixin(this,m);this.itemUrl=f.getItemUrl(this.portalUrl,this.id);!this.thumbnailUrl&&this.thumbnail&&this.itemUrl&&(this.thumbnailUrl=this.itemUrl+"/info/"+this.thumbnail);this.token=this.credential&&this.credential.token;this.thumbnailUrl&&this.token&&(this.thumbnailUrl+="?token\x3d"+
this.token);this.portalUrl&&this.id&&(this.detailsPageUrl=f.getItemDetailsPageUrl(this.portalUrl,this.id));this.portalUrl&&this.owner&&(this.ownerPageUrl=f.getUserProfilePageUrl(this.portalUrl,this.owner))},_checkCredential:function(){var m=e.isValidCredential(this.credential);m||(this.credential=null);return m},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},
getItemData:function(){return this.portal.getItemData(this.id)}}),h={portals:[],webMapQueryStr:" "+n.getItemQueryStringByTypes(["Web Map"])+" ",webSceneQueryStr:" "+n.getItemQueryStringByTypes(["Web Scene"])+" ",_findPortal:function(m){for(var u=0;u<this.portals.length;u++){var t=this.portals[u];if(f.isSamePortalUrl(m,t.portalUrl))return t.updateCredential(),t}return null},getPortal:function(m){if(!m||"string"!==typeof m||!b.trim(m))return null;m=f.getStandardPortalUrl(m);var u=this._findPortal(m);
u||(u=new k(m),u.credential=e.getPortalCredential(u.portalUrl),u.updateCredential(),this.portals.push(u));return u},getPortalSelfInfo:function(m){return this.getPortal(m).loadSelfInfo()},getBasemapGalleryGroup:function(m){return this._getPortalSelfGroup(m,"basemapGalleryGroupQuery")},getTemplatesGroup:function(m){return this._getPortalSelfGroup(m,"templatesGroupQuery")},getUnits:function(m){var u="english",t="",q=new g;this.getPortal(m).getUser().then(b.hitch(this,function(z){z&&z.units?u=z.units:
(t=d.locale,u=t.startWith("en")?"english":"metric");q.resolve(u)}),b.hitch(this,function(z){console.warn(z);this.getPortalSelfInfo(m).then(b.hitch(this,function(v){var B=null;v&&v.units?B=v.units:(t=v&&v.culture||d.locale,B=t.startWith("en")?"english":"metric");q.resolve(B)}),b.hitch(this,function(v){console.warn(v);t=d.locale;u=t.startWith("en")?"english":"metric";q.resolve(u)}))}));return q.promise},_getPortalSelfGroup:function(m,u){var t=new g,q=this.getPortal(m);q||setTimeout(b.hitch(this,function(){t.reject()}),
0);this.getPortalSelfInfo(m).then(b.hitch(this,function(z){q.queryGroups({f:"json",q:z[u]}).then(b.hitch(this,function(v){0<v.results.length?(v=v.results[0],v.portalUrl=q.portalUrl,v.credential=q.credential,v.portal=q,v=new y(v),t.resolve(v)):t.reject("Can't find portal self group.")}),b.hitch(this,function(v){console.error(v);t.reject(v)}))}),b.hitch(this,function(z){console.error(z);t.reject(z)}));return t},getWebMapsFromBasemapGalleryGroup:function(m){var u=new g;this.getBasemapGalleryGroup(m).then(b.hitch(this,
function(t){t?t.queryItems({start:1,num:100,f:"json",q:this.webMapQueryStr}).then(b.hitch(this,function(q){u.resolve(q)}),b.hitch(this,function(q){console.error(q);u.reject(q)})):u.reject()}),b.hitch(this,function(t){console.error(t);u.reject(t)}));return u},getDefaultWebScene:function(m){var u=new g,t=this.getPortal(m);t.getUser().then(b.hitch(this,function(q){t.queryItems({start:1,num:1,f:"json",q:this.webSceneQueryStr+' AND owner:"'+q.username+'" ',sortField:"numViews",sortOrder:"desc"}).then(b.hitch(this,
function(z){z=z.results;z=c.filter(z,b.hitch(this,function(v){return v.type&&"web scene"===v.type.toLowerCase()}));0<z.length?u.resolve(z[0].id):u.resolve(null)}),b.hitch(this,function(z){u.reject(z)}))}),b.hitch(this,function(){u.reject("not sign in")}));return u},getDefaultWebMap:function(m){var u=new g;this.getPortalSelfInfo(m).then(b.hitch(this,function(t){var q=t.defaultBasemap&&t.defaultBasemap.id;q?u.resolve(q):this._getDefaultWebMapByBasemapGallery(m,t).then(b.hitch(this,function(z){z?u.resolve(z):
this._getMostNumViewsWebMap(m).then(b.hitch(this,function(v){v?u.resolve(v):u.reject()}),b.hitch(this,function(v){console.error(v);u.reject(v)}))}),b.hitch(this,function(z){console.error(z);u.reject(z)}))}),b.hitch(this,function(t){console.error(t);u.reject(t)}));return u},_getDefaultWebMapByBasemapGallery:function(m,u){var t=new g,q=this.getPortal(m),z=u.defaultBasemap&&u.defaultBasemap.title;q.queryGroups({f:"json",q:u.basemapGalleryGroupQuery}).then(b.hitch(this,function(v){v=v.results;0<v.length?
q.queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND group:"+v[0].id+" AND title:"+z}).then(b.hitch(this,function(B){B=B.results;B=c.filter(B,b.hitch(this,function(A){return A.type&&"web map"===A.type.toLowerCase()}));0<B.length?t.resolve(B[0].id):(console.log("Can't find web map under basemapGalleryGroupQuery."),q.queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND title:"+z}).then(b.hitch(this,function(A){A=A.results;A=c.filter(A,b.hitch(this,function(C){return C.type&&"web map"===
C.type.toLowerCase()}));if(0<A.length){var E=A[0];q.getItemData(E.id).then(b.hitch(this,function(C){C&&(C.operationalLayers||C.baseMap||C.version)?t.resolve(E.id):t.resolve(null)}),b.hitch(this,function(){t.resolve(null)}))}else console.log("Can't find web map by defaultBasemap.title."),t.resolve(null)}),b.hitch(this,function(A){console.error(A);t.reject(A)})))}),b.hitch(this,function(B){console.error(B);t.reject(B)})):(console.log("Can't find group by basemapGalleryGroupQuery."),t.resolve(null))}),
b.hitch(this,function(v){console.error(v);t.reject(v)}));return t},_getMostNumViewsWebMap:function(m){var u=new g;this.getPortal(m).queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND access:public AND owner:esri_en",sortField:"numViews",sortOrder:"desc"}).then(b.hitch(this,function(t){t=t.results;t=c.filter(t,b.hitch(this,function(q){return q.type&&"web map"===q.type.toLowerCase()}));0<t.length?u.resolve(t[0].id):u.reject("Can't find most-num-views web map.")}),b.hitch(this,function(t){console.error(t);
u.reject(t)}));return u}};x.subscribe("userSignOut",function(m){(m=h._findPortal(m))&&m.clearCredentialAndUser()});return h})},"jimu/shared/AppVersionManager":function(){define(["./BaseVersionManager"],function(a){function b(){this.versions=[{version:"2.0beta",description:"The version for Developer Edition beta 2.0.",upgrader:function(c){return c},compatible:!0},{version:"2.0",description:"The version for Online 4.1.",upgrader:function(c){return c},compatible:!0},{version:"2.0.1",description:"The version for Developer Edition 2.0.",
upgrader:function(c){var d=null,g=0,x=c.widgetOnScreen.widgets;if(x&&0<x.length)for(g=0;g<x.length;g++)d=x[g],"widgets/Viz/Widget"===d.uri&&(d.uri="widgets/3DFx/Widget",d.name="3DFx");if((x=c.widgetPool.widgets)&&0<x.length)for(g=0;g<x.length;g++)d=x[g],"widgets/Viz/Widget"===d.uri&&(d.uri="widgets/3DFx/Widget",d.name="3DFx");return c},compatible:!0},{version:"2.1",description:"The version for Online 4.2.",upgrader:function(c){return c},compatible:!0},{version:"2.2",description:"The version for Online 4.3.",
upgrader:function(c){return c},compatible:!0},{version:"2.3",description:"The version for Online 4.4.",upgrader:function(c){return c},compatible:!0},{version:"2.4",description:"The version for Online 5.1.",upgrader:function(c){return c},compatible:!0},{version:"2.5",description:"The version for Online 5.2.",upgrader:function(c){return c},compatible:!0},{version:"2.6",description:"The version for Online 5.3.",upgrader:function(c){return c},compatible:!0},{version:"2.7",description:"The version for Online 5.4.",
upgrader:function(c){(function(){function d(g){var x=0,w=0;if(c[g].widgets)for(x=0;x<c[g].widgets.length;x++)if("widgets/Environment/Widget"===c[g].widgets[x].uri){c[g].widgets[x].uri="widgets/Daylight/Widget";break}if(c[g].groups)for(x=0;x<c[g].groups.length;x++){var l=c[g].groups[x];for(w=0;w<l.widgets.length;w++)if("widgets/Environment/Widget"===l.widgets[w].uri){l.widgets[w].uri="widgets/Daylight/Widget";break}}}d("widgetOnScreen");d("widgetPool")})();return c},compatible:!0},{version:"2.8",description:"The version for Online 6.1.",
upgrader:function(c){return c},compatible:!0},{version:"2.9",description:"The version for Online 6.2.",upgrader:function(c){return c},compatible:!0},{version:"2.10",description:"The version for Online 6.3.",upgrader:function(c){return c},compatible:!0},{version:"2.11",description:"The version for Online 6.4.",upgrader:function(c){return c},compatible:!0},{version:"2.12",description:"The version for Online 7.1",upgrader:function(c){return c},compatible:!0},{version:"2.13",description:"The version for Online 7.2",
upgrader:function(c){return c},compatible:!0},{version:"2.14",description:"The version for Online 7.3",upgrader:function(c){return c},compatible:!0},{version:"2.15",description:"The version for Online 7.4",upgrader:function(c){return c},compatible:!0},{version:"2.16",description:"The version for Online 8.1",upgrader:function(c){return c},compatible:!0},{version:"2.17",description:"The version for Online 8.2",upgrader:function(c){return c},compatible:!0},{version:"2.18",description:"The version for Online 8.3",
upgrader:function(c){return c},compatible:!0},{version:"2.19",description:"The version for Online 8.4",upgrader:function(c){return c},compatible:!0},{version:"2.20",description:"The version for Online 9.1",upgrader:function(c){return c},compatible:!0},{version:"2.21",description:"The version for Online 9.2",upgrader:function(c){return c},compatible:!0},{version:"2.22",description:"The version for Online 9.3",upgrader:function(c){return c},compatible:!0},{version:"2.23",description:"The version for Online 9.4",
upgrader:function(c){return c},compatible:!0},{version:"2.24",description:"The version for Online 10.1",upgrader:function(c){return c},compatible:!0}];this.isCompatible=function(c,d){c=this.getVersionIndex(c);d=this.getVersionIndex(d);for(c+=1;c<=d;c++)if(!1===this.versions[c].compatible)return!1;return!0}}b.prototype=new a;return b.prototype.constructor=b})},"jimu/shared/BaseVersionManager":function(){define(function(){return function(){this.versions=[];this.upgrade=function(a,b,c){b=this.getVersionIndex(b);
c=this.getVersionIndex(c);if(b>=c)throw Error("New version should be higher than the old version.");for(b+=1;b<=c;b++)this.versions[b].upgrader&&(a=this.versions[b].upgrader(a));return a};this.getVersionIndex=function(a){a=this.fixVersion(a);var b,c;for(c=0;c<this.versions.length;c++)this.versions[c].version===a&&(b=c);null===a&&(b=-1);void 0===b&&(b=this.versions.length-1);return b};this.fixVersion=function(a){return a?a:null}}})},"jimu/ConfigLoader":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/config dojo/cookie dojo/Deferred dojo/promise/all dojo/request/xhr ./utils ./privilegeUtils ./WidgetManager ./shared/utils ./tokenUtils ./portalUtils ./appConfigResourceUtils ./portalUrlUtils ./AppStateManager esri/identity/IdentityManager esri/core/urlUtils".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q){var z=null;var v=a(null,{urlParams:null,appConfig:null,rawAppConfig:null,configFile:null,_configLoaded:!1,portalSelf:null,constructor:function(B,A){this._removeHash(B);this.urlParams=B||{};this.widgetManager=k.getInstance();b.mixin(this,A)},loadConfig:function(){console.time("Load Config");return this._tryLoadConfig().then(b.hitch(this,function(B){var A=this.checkConfig(B);if(A)throw A;this.rawAppConfig=b.clone(B);u.getInstance().setRawAppConfig(this.rawAppConfig);
B=this._upgradeAppConfig(B);this._processAfterTryLoad(B);this.appConfig=B;if(this.urlParams.id)return this.loadWidgetsManifest(B).then(b.hitch(this,function(){return this._upgradeAllWidgetsConfig(B)})).then(b.hitch(this,function(E){return this.insertAppIdtoResourceUrlofAppConfig(E,this.urlParams.id)})).then(b.hitch(this,function(){this._configLoaded=!0;B.title&&(document.title=window.isBuilder?f.stripHTML(B.title)+" - ArcGIS Web AppBuilder":f.stripHTML(B.title));this._readAndSetSharedTheme(B);return this.getAppConfig()}));
y.setPortalUrl(B.portalUrl);return this._proesssWebTierAndSignin(B).then(b.hitch(this,function(){if(this.urlParams.appid){if(window.appInfo.isRunInPortal){var E=m.getStandardPortalUrl(B.portalUrl),C=p.getPortal(E);return e.checkIsSelfOrigin(this.urlParams.appid,C,y.isInBuilderWindow()).then(b.hitch(this,function(D){if(!D)throw D=Error(window.jimuNls.orgUrlMessage),D.isSelfOrigin=!1,D;})).then(b.hitch(this,function(){return e.checkEssentialAppsLicense(this.urlParams.appid,C,y.isInBuilderWindow()).then(b.hitch(this,
function(){return this._getAppConfigFromTemplateAppId(B.portalUrl,this.urlParams.appid).then(b.hitch(this,function(D){this._tryUpdateAppConfigByLocationUrl(D);return this._processInPortalAppProtocol(D)}))}),b.hitch(this,function(D){console.error(D);if(D&&D.isBlockedByOrg)throw Error(window.jimuNls.blockedByAdminErrorForApp);throw Error(window.jimuNls.essentialAppsLicenseErrorForApp);}))}))}return this._processNotInPortalAppProtocol(B).then(b.hitch(this,function(D){return this._getAppDataAddTemplateDataFromTemplateAppId(D.portalUrl,
this.urlParams.appid).then(b.hitch(this,function(F){F.appData.appConfig&&(D=F.appData.appConfig);D._appData=F.appData;D.templateConfig=F.templateData;D.isTemplateApp=!0;return D}))}))}return this._processNotInPortalAppProtocol(B)})).then(b.hitch(this,function(E){this._processAfterTryLoad(E);this.appConfig=E;return E.map.itemId?E:p.getDefaultWebScene(E.portalUrl).then(function(C){E.map.itemId=C;return E})})).then(b.hitch(this,function(E){return this.loadWidgetsManifest(E)})).then(b.hitch(this,function(E){return E._appData?
E._appData.values&&E._appData.values.webmap?p.getPortal(E.portalUrl).getItemById(E._appData.values.webmap).then(b.hitch(this,function(C){return f.template.mergeTemplateAppConfigToAppConfig(E,E._appData,C)})):f.template.mergeTemplateAppConfigToAppConfig(E,E._appData):E})).then(b.hitch(this,function(E){return this._upgradeAllWidgetsConfig(E)})).then(b.hitch(this,function(E){return E._wabAppId?this.processResourceInAppConfigForConfigLoader(E,this.urlParams):E.appItemId&&-1<window.JSON.stringify(E).indexOf("${itemId}")?
this.insertAppIdtoResourceUrlofAppConfig(E,E.appItemId):E})).then(b.hitch(this,function(E){this.appConfig=E;this._configLoaded=!0;E.title&&(document.title=f.stripHTML(E.title));this._readAndSetSharedTheme(E);return this.getAppConfig()}))}),b.hitch(this,function(B){var A=new w;A.reject(B);return A}))},processResourceInAppConfigForConfigLoader:function(B,A){var E=B.portalUrl,C=B.appItemId,D=A.appid,F=new w,G=b.clone(B);this.insertAppIdtoResourceUrlofAppConfig(G,D).then(function(){if("config"===A.mode){var J=
this.getResourceUrlsOfAppConfig(B).result;0!==J.length?p.getItemResources(E,D).then(function(I){if(0===I.length)return J=J.map(function(O){return{resUrl:O}}),h.AddResourcesToItemForAppSave(E,J,C,D).then(function(){F.resolve(G)},function(O){console.warn("Add resource to template based app error:"+O.message||O);F.resolve(G)});F.resolve(G)},function(I){console.warn("Get resource of template based item error:"+I.message||I);F.resolve(G)}):F.resolve(G)}else F.resolve(G)}.bind(this),function(J){console.warn("Insert appId to resource url of appConfig error:"+
J.message||J);F.resolve(G)});return F},getResourceUrlsOfAppConfig:function(B){var A={test:function(E){return/^https?:\/\/(.)+\/sharing\/rest\/content\/items/.test(E)},func:b.hitch(this,function(E){return E.value})};return f.processItemResourceOfAppConfig(B,A)},insertAppIdtoResourceUrlofAppConfig:function(B,A){function E(G){return/^https?:\/\/(.)+\/sharing\/rest\/content\/items/.test(G)}function C(G,J){var I=J.obj,O=J.key,P={obj:I,key:O};"number"===typeof J.i?(P.i=J.i,P.value=I[O][J.i]):P.value=I[O];
J=P;G=F.processItemIdAndTokenOfResources(J.value,G);I=J.obj;O=J.key;"number"===typeof J.i?I[O][J.i]=G:I[O]=G;return!0}var D=B.portalUrl,F=this;return p.getPortal(D).getItemById(A).then(b.hitch(this,function(G){G={test:E,func:b.hitch(this,C,{appId:A,isPublic:"public"===G.access,portalUrl:D})};return f.processItemResourceOfAppConfig(B,G).appConfig}))},processItemIdAndTokenOfResources:function(B,A){0<B.indexOf("${itemId}")&&(B=B.replace("${itemId}",A.appId));/(\?|&)token=.+/.test(B)&&(B=B.replace(/(\?|&)token=.+/,
""));A.isPublic||(A=y.getPortalCredential(A.portalUrl))&&(B+="?token\x3d"+A.token);return B},getAppConfig:function(){var B=b.clone(this.appConfig);B.getConfigElementById=function(A){return f.getConfigElementById(this,A)};B.getConfigElementsByName=function(A){return f.getConfigElementsByName(this,A)};B.visitElement=function(A){f.visitElement(this,A)};this._addAuthorizedCrossOriginDomains(this.portalSelf,B);return B},_addAuthorizedCrossOriginDomains:function(B,A){B&&B.authorizedCrossOriginDomains&&
y.addAuthorizedCrossOriginDomains(B.authorizedCrossOriginDomains);A&&A.authorizedCrossOriginDomains&&y.addAuthorizedCrossOriginDomains(A.authorizedCrossOriginDomains)},checkConfig:function(B){return(B=this._getRepeatedId(B))?"repeated id:"+B:null},processProxy:function(B){var A=f.getEsriConfigRequestObject();A.alwaysUseProxy=B.httpProxy&&B.httpProxy.useProxy&&B.httpProxy.alwaysUseProxy;A.proxyUrl="";A.proxyRules=[];B.httpProxy&&B.httpProxy.useProxy&&B.httpProxy.url&&(A.proxyUrl=B.httpProxy.url);B.httpProxy&&
B.httpProxy.useProxy&&B.httpProxy.rules&&c.forEach(B.httpProxy.rules,function(E){q.addProxyRule(E)})},addNeedValues:function(B){this._processNoUriWidgets(B);this._processEmptyGroups(B);this._addElementId(B);this._processWidgetJsons(B)},showError:function(B){d.create("div",{"class":"app-error",innerHTML:f.sanitizeHTML(B.message)},document.body)},_tryLoadConfig:function(){if(this.urlParams.config)return this.configFile=this.urlParams.config,n(this.configFile,{handleAs:"json",headers:{"X-Requested-With":null}}).then(b.hitch(this,
function(C){y.setPortalUrl(C.portalUrl);C.portalUrl&&(window.portalUrl=C.portalUrl);return this.urlParams.token?y.registerToken(this.urlParams.token).then(function(){return C}):C}));if(this.urlParams.id){window.appInfo.isRunInPortal=!0;var B=m.getPortalUrlFromLocation(),A=new w;y.setPortalUrl(B);window.portalUrl=B;if(this.urlParams.token)var E=y.registerToken(this.urlParams.token);else E=new w,E.resolve();E.then(b.hitch(this,function(){var C=p.getPortal(B);C.loadSelfInfo().then(b.hitch(this,function(D){this.portalSelf=
D;D.allSSL&&"http:"===window.location.protocol?(window.location.href=m.setHttpsProtocol(window.location.href),A.reject()):this._processSignIn(B).then(b.hitch(this,function(){this._getAppConfigFromAppId(B,this.urlParams.id).then(b.hitch(this,function(F){return e.checkIsSelfOrigin(this.urlParams.id,C,y.isInBuilderWindow()).then(b.hitch(this,function(G){if(G)return F;G=Error(window.jimuNls.orgUrlMessage);G.isSelfOrigin=!1;throw G;}))})).then(b.hitch(this,function(F){return e.checkEssentialAppsLicense(this.urlParams.id,
C,y.isInBuilderWindow()).then(b.hitch(this,function(){this._tryUpdateAppConfigByLocationUrl(F);return this._processInPortalAppProtocol(F)}),b.hitch(this,function(G){console.error(G);if(G&&G.isBlockedByOrg)throw Error(window.jimuNls.blockedByAdminErrorForApp);throw Error(window.jimuNls.essentialAppsLicenseErrorForApp);}))})).then(function(F){A.resolve(F)},function(F){A.reject(F)})}))}))}),b.hitch(this,function(C){this.showError(C)}));return A}this.configFile="config.json";return n(this.configFile,
{handleAs:"json"}).then(b.hitch(this,function(C){y.setPortalUrl(C.portalUrl);C.portalUrl&&(window.portalUrl=C.portalUrl);return this.urlParams.token?y.registerToken(this.urlParams.token).then(function(){return C}):C}))},_upgradeAppConfig:function(B){var A=window.wabVersion,E=B.wabVersion;if(A===E)return B;var C=this.versionManager.getVersionIndex(E),D=this.versionManager.getVersionIndex(A);if(C>D)throw Error("Bad version number, "+E);B=this.versionManager.upgrade(B,E,A);B.wabVersion=A;B.isUpgraded=
!0;return B},_upgradeAllWidgetsConfig:function(B){var A=new w,E=[];if(!B.isUpgraded)return A.resolve(B),A;delete B.isUpgraded;r.visitElement(B,b.hitch(this,function(C){C.uri&&(C.config?(C=this.widgetManager.tryLoadWidgetConfig(C),E.push(C)):C.version=C.manifest.version)}));l(E).then(b.hitch(this,function(){A.resolve(B)}),function(C){A.reject(C)});return A},_processAfterTryLoad:function(B){this._setPortalUrl(B);this._tryUpdateAppConfigByLocationUrl(B);this._processUrlParams(B);this.addNeedValues(B);
this.processProxy(B);t.tokenValidity=10080;return B},_readAndSetSharedTheme:function(B){B.theme.sharedTheme||(B.theme.sharedTheme={useHeader:!1,useLogo:!1},B.theme.sharedTheme.isPortalSupport=this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?!0:!1);B.theme.sharedTheme.useHeader&&(B.theme.sharedTheme.isPortalSupport&&this.portalSelf.portalProperties?(B.theme.customStyles={mainBackgroundColor:this.portalSelf.portalProperties.sharedTheme.header.background},B.titleColor=this.portalSelf.portalProperties.sharedTheme.header.text):
console.error("Portal does not support sharedTheme."));B.theme.sharedTheme.useLogo&&(B.theme.sharedTheme.isPortalSupport&&this.portalSelf.portalProperties?(B.logo=this.portalSelf.portalProperties.sharedTheme.logo.small?this.portalSelf.portalProperties.sharedTheme.logo.small:"images/app-logo.png",!B.logoLink&&this.portalSelf.portalProperties.sharedTheme.logo.link&&(B.logoLink=this.portalSelf.portalProperties.sharedTheme.logo.link)):(console.error("Portal does not support sharedTheme, use default logo."),
B.logo="images/app-logo.png"))},_tryUpdateAppConfigByLocationUrl:function(B){if(!(this.urlParams.config&&-1<this.urlParams.config.indexOf("arcgis.com/sharing/rest/content/items/"))){var A=m.getPortalUrlFromLocation();A=m.getStandardPortalUrl(A);m.isOnline(A)&&(A=m.updateUrlProtocolByOtherUrl(A,B.portalUrl),B.map.portalUrl&&m.isSamePortalUrl(B.portalUrl,B.map.portalUrl)&&(B.map.portalUrl=A),B.portalUrl=A,B.httpProxy&&B.httpProxy.url&&(B.httpProxy.url=m.getPortalProxyUrl(A)))}},_processWidgetJsons:function(B){r.visitElement(B,
function(A,E){E.isWidget&&A.uri&&f.processWidgetSetting(A)})},_processNoUriWidgets:function(B){var A=0;r.visitElement(B,function(E,C){C.isWidget&&!E.uri&&(A++,E.placeholderIndex=A)})},_processEmptyGroups:function(B){var A=0;B.widgetOnScreen.groups&&c.forEach(B.widgetOnScreen.groups,function(E){if(!E.widgets||E.widgets&&0===E.widgets.length)A++,E.placeholderIndex=A})},_addElementId:function(B){var A=0,E;r.visitElement(B,function(C){if(C.id){C.id=C.id.replace(/\//g,"_");var D=C.id.lastIndexOf("_");
-1<D&&(E=C.id.substr(D+1),A=Math.max(A,E))}});r.visitElement(B,function(C){C.id||(A++,C.id=C.uri?C.uri.replace(/\//g,"_")+"_"+A:"_"+A)})},_setPortalUrl:function(B){if(B.portalUrl){var A=m.getPortalUrlFromLocation(),E=m.isOnline(A);m.isSamePortalUrl(B.portalUrl,A)||E||(window.appInfo.isRunInPortal=!1)}else window.isXT&&x("wab_portalurl")?B.portalUrl=x("wab_portalurl"):(window.appInfo.isRunInPortal=!0,B.portalUrl=m.getPortalUrlFromLocation())},_changePortalUrlProtocol:function(B,A){B.portalUrl=m.setProtocol(B.portalUrl,
A);B.map.portalUrl&&(B.map.portalUrl=m.setProtocol(B.map.portalUrl,A));B.httpProxy&&(B.httpProxy.url=m.setProtocol(B.httpProxy.url,A),B.httpProxy&&B.httpProxy.rules&&c.forEach(B.httpProxy.rules,b.hitch(this,function(E){E.proxyUrl=m.setProtocol(E.proxyUrl,A)})))},_processInPortalAppProtocol:function(B){var A=new w,E=p.getPortal(B.portalUrl),C=b.hitch(this,function(D){if("https:"===window.location.protocol)this._changePortalUrlProtocol(B,"https");else{if(D){window.location.href=m.setHttpsProtocol(window.location.href);
A.reject();return}this._changePortalUrlProtocol(B,"http")}this._checkLocale();A.resolve(B)});E.loadSelfInfo().then(b.hitch(this,function(D){this.portalSelf=D;"private"===D.access?(D=0===B.portalUrl.toLowerCase().indexOf("https://"),C(D)):C(D.allSSL)}),b.hitch(this,function(D){A.reject(D)}));return A},_processNotInPortalAppProtocol:function(B){var A=new w;B.portalUrl?p.getPortal(B.portalUrl).loadSelfInfo().then(b.hitch(this,function(E){this.portalSelf=E;var C="https:"===window.location.protocol;(E.allSSL||
C)&&this._changePortalUrlProtocol(B,"https");0!==B.portalUrl.toLowerCase().indexOf("https://")||C||y.isInConfigOrPreviewWindow()?A.resolve(B):(window.location.href=m.setHttpsProtocol(window.location.href),A.reject())}),b.hitch(this,function(E){A.reject(E)})):A.resolve(B);return A},_proesssWebTierAndSignin:function(B){var A=new w,E=!1,C=B.portalUrl;this._processWebTier(B).then(b.hitch(this,function(D){E=D;return p.getPortal(C).loadSelfInfo()})).then(b.hitch(this,function(D){this.portalSelf=D;return this._processSignIn(C,
E)})).then(b.hitch(this,function(){A.resolve()}),function(D){A.reject(D)});return A},_processWebTier:function(B){var A=new w,E=B.portalUrl;B.isWebTier?(y.addAuthorizedCrossOriginDomains([E]),y.isWebTierPortal(E).then(b.hitch(this,function(){var C=y.getPortalCredential(E);C&&C.ssl&&"http:"===window.location.protocol&&!y.isInConfigOrPreviewWindow()?window.location.href=m.setHttpsProtocol(window.location.href):A.resolve(B.isWebTier)}),b.hitch(this,function(C){A.reject(C)}))):A.resolve(!1);return A},
_processSignIn:function(B,A){var E=new w,C=p.getPortal(B),D=m.getSharingUrl(B);window.appInfo.isRunInPortal?(A=t.checkSignInStatus(D),A.catch(function(){}).then(b.hitch(this,function(){E.resolve()}))):(y.isInBuilderWindow()||y.isInConfigOrPreviewWindow()||!this.portalSelf.supportsOAuth||!this.rawAppConfig.appId||A||y.registerOAuthInfo(B,this.rawAppConfig.appId),A=t.checkSignInStatus(D),A.catch(function(){}).then(b.hitch(this,function(){y.xtGetCredentialFromCookie(B);C.loadSelfInfo().then(b.hitch(this,
function(F){this.portalSelf=F;this._checkLocale();E.resolve()}))})));return E},_checkLocale:function(){if(!y.isInConfigOrPreviewWindow()){var B=this.portalSelf.user&&this.portalSelf.user.culture||g.locale;B="hi"===B?"en":B.toLowerCase();!this.urlParams.locale&&f.isLocaleChanged(g.locale,B)&&(x("wab_app_locale",B),window.location.reload())}},_getAppConfigFromTemplateAppId:function(B,A){var E=p.getPortal(B);return this._getWabAppIdAndDataFromTemplateAppId(B,A).then(b.hitch(this,function(C){var D=C.appId,
F=C.appData;return l([this._getAppConfigFromAppId(B,D),E.getItemData(F.source)]).then(b.hitch(this,function(G){if(F.appConfig){var J=F.appConfig;delete F.appConfig}else J=G[0];J=this._upgradeAppConfig(J);G=G[1];J._appData=F;J._wabAppId=D;J.templateConfig=G;J.isTemplateApp=!0;return J}))}))},_getAppDataAddTemplateDataFromTemplateAppId:function(B,A){var E=p.getPortal(B);return E.getItemData(A).then(function(C){return E.getItemData(C.source).then(function(D){return{appData:C,templateData:D}})})},_getWabAppIdAndDataFromTemplateAppId:function(B,
A){var E=new w,C=p.getPortal(B);C.getItemData(A).then(b.hitch(this,function(D){C.getItemById(D.source).then(b.hitch(this,function(F){F=q.urlToObject(F.url);E.resolve({appId:F.query.id,appData:D})}))}),function(D){E.reject(D)});return E},_getAppConfigFromAppId:function(B,A){return p.getPortal(B).getItemData(A)},_removeHash:function(B){for(var A in B)B[A]&&(B[A]=B[A].replace("#",""))},loadWidgetsManifest:function(B){function A(F,G,J){function I(O){return F.loadWidgetManifest(O).then(function(P){return P},
function(P){console.log("Widget failed to load, it is removed.",O.name);P.stack?console.error(P.stack):console.log(P);E(B,O)})}return G.itemId?p.getPortal(J).getItemById(G.itemId).then(function(O){var P=f.isEsriDomain(O.url)?!0:y.getPortalCredential(B.portalUrl)?!0:!1;if(P)return G.uri=f.widgetJson.getUriFromItem(O),I(G);console.log("Widget is not useable, it is removed.",G.name);E(B,G)}):I(G)}function E(F,G){function J(I){F[I]&&F[I].widgets&&(F[I].widgets=F[I].widgets.filter(function(O){if(G)return O.id!==
G.id;O.uri&&!O.manifest&&console.error("Widget is removed because it is not loaded successfully.",O.uri);return O.manifest}));F[I]&&F[I].groups&&F[I].groups.forEach(function(O){O.widgets&&(O.widgets=O.widgets.filter(function(P){if(G)return P.id!==G.id;P.uri&&!P.manifest&&console.error("Widget is removed because it is not loaded successfully.",P.uri);return P.manifest}))})}J("widgetOnScreen");J("widgetPool")}var C=[],D=new w;B._buildInfo&&B._buildInfo.widgetManifestsMerged?this._loadMergedWidgetManifests().then(b.hitch(this,
function(F){r.visitElement(B,b.hitch(this,function(G){G.widgets||!G.uri&&!G.itemId||(G.uri&&F[G.uri]?(this._addNeedValuesForManifest(F[G.uri],G.uri),f.widgetJson.addManifest2WidgetJson(G,F[G.uri])):C.push(A(this.widgetManager,G,B.portalUrl)))}));l(C).then(function(){D.resolve(B)})})):(r.visitElement(B,b.hitch(this,function(F){F.widgets||!F.uri&&!F.itemId||C.push(A(this.widgetManager,F,B.portalUrl))})),l(C).then(function(){D.resolve(B)}));setTimeout(function(){D.isResolved()||(E(B),D.resolve(B))},
6E4);return D},_addNeedValuesForManifest:function(B,A){b.mixin(B,f.getUriInfo(A));f.addManifestProperies(B);f.processManifestLabel(B,g.locale)},_loadMergedWidgetManifests:function(){return n(window.appInfo.appPath+"widgets/widgets-manifest.json",{handleAs:"json"})},_getRepeatedId:function(B){var A=[],E;r.visitElement(B,function(C){if(0<A.indexOf(C.id))return E=C.id,!0;A.push(C.id)});return E},_processUrlParams:function(B){var A=this.urlParams.itemid||this.urlParams.webmap;A&&B.map.itemId!==A&&(B.map.mapOptions&&
f.deleteMapOptions(B.map.mapOptions),B.map.itemId=A);this.urlParams.mode&&(B.mode=this.urlParams.mode);B.map.mapOptions||(B.map.mapOptions={});this.urlParams.scale&&(B.map.mapOptions.scale=this.urlParams.scale);if(this.urlParams.level||this.urlParams.zoom)B.map.mapOptions.zoom=this.urlParams.level||this.urlParams.zoom}});v.getInstance=function(B,A){null===z?z=new v(B,A):(z.urlParams=B,z.options=A);return z};return v})},"jimu/privilegeUtils":function(){define(["dojo/Deferred","esri/identity/IdentityManager",
"esri/request","jimu/tokenUtils","jimu/portalUrlUtils"],function(a,b,c,d,g){return{checkEssentialAppsLicense:function(x,w,l){var n=g.getStandardPortalUrl(w.portalUrl),f=g.getSharingUrl(n),e=new a;(l?b.checkAppAccess(f,"arcgisWebApps"):w.getItemById(x).then(function(k){return"public"===k.access?{isPublicApp:!0}:b.checkAppAccess(f,"arcgisWebApps",{force:!0})})).then(function(k){w.getSigninSettingsOfSelfInfo().then(function(r){r&&r.blockedApps&&r.blockedApps.indexOf&&-1<r.blockedApps.indexOf("webappbuilder")?
e.reject({message:"wab is blocked by org admin",isBlockedByOrg:!0}):e.resolve(k)},function(r){e.reject({message:r&&r.message,isBlockedByOrg:!1})})},function(k){e.reject({message:k&&k.message,isBlockedByOrg:!1})});return e},checkIsSelfOrigin:function(x,w,l){var n=!0,f=g.getPortalUrlFromLocation();f=g.getStandardPortalUrl(f);x=g.getItemUrl(f,x);var e=window.location.host;f=d.userHaveSignInPortal(f);e=0<=["www.arcgis.com","devext.arcgis.com","qaext.arcgis.com"].indexOf(e);var k=window.location!==window.parent.location;
if(w.isPortal||l||e||f||k)w=new a,w.resolve(n);else return c(x,{handleAs:"json",query:{f:"json"},callbackParamName:"callback"}).then(function(r){r=r.data;r.contentOrigin&&"self"!==r.contentOrigin&&(n=!1);return n});return w}}})},"jimu/appConfigResourceUtils":function(){define(["dojo/Deferred","dojo/promise/all","jimu/portalUtils","jimu/utils"],function(a,b,c,d){return{AddResourcesToItemForAppSave:function(g,x,w,l){x=x||[];if(0===x.length){var n=new a;n.resolve(x);return n}x=x.map(function(f){var e=
f.resUrl.split("resources/")[1],k=new a;f.b64?(f=d.b64toBlob(f.b64),k.resolve({blob:f,fileName:e.split("/")[1],prefixName:e.split("/")[0]})):(f=f.resUrl,0<f.indexOf("${itemId}")&&(f=f.replace("${itemId}",w)),d.resourcesUrlToBlob(f).then(function(r){k.resolve({blob:r,fileName:e.split("/")[1],prefixName:e.split("/")[0]},function(y){console.error(y.message||y);k.reject(y)})}));return k});return b(x).then(function(f){if(f instanceof Array&&0<f.length)return f=f.map(function(e){var k=w;l&&(k=l);return c.addResource(g,
k,e.blob,e.fileName,e.prefixName)}.bind(this)),b(f).then(function(e){return e})}.bind(this))}}})},"jimu/AppStateManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/json esri/geometry/Extent esri/geometry/SpatialReference libs/storejs/store libs/md5/md5 jimu/tokenUtils".split(" "),function(a,b,c,d,g,x,w,l,n){var f=null,e=a(null,{rawAppConfig:null,mapMd5:null,appStateKey:null,setRawAppConfig:function(k){this.rawAppConfig=k},_getAppStateMd5:function(){if("string"!==typeof this.mapMd5){var k=
d.stringify(this.rawAppConfig.map);this.mapMd5=l(k)}return this.mapMd5},_getAppStateKey:function(){return this.appStateKey?this.appStateKey:this.appStateKey="wab_appstate_"+this.urlParams.id||this.urlParams.appid||window.path},getWabAppState:function(){var k=new c,r={};if(n.isInConfigOrPreviewWindow()||!this.rawAppConfig||!this.rawAppConfig.map)return k.resolve(r),k;var y=this._getAppStateKey(),p=w.get(y);p&&p.appStateMd5===this._getAppStateMd5()?(y=p.map&&p.map.extent,p=p.map&&p.map.layers,y&&(r.extent=
new g(y.xmin,y.ymin,y.xmax,y.ymax,new x(y.spatialReference))),p&&(r.layers=p)):w.remove(y);k.resolve(r);return k},saveWabAppState:function(k,r){if(k&&!n.isInConfigOrPreviewWindow()){var y=this._getAppStateKey(),p={extent:{xmin:k.extent.xmin,xmax:k.extent.xmax,ymin:k.extent.ymin,ymax:k.extent.ymax,spatialReference:{wkid:k.extent.spatialReference.wkid,wkt:k.extent.spatialReference.wkt}},layers:{}};r&&r.traversalLayerInfosOfWebmap&&r.traversalLayerInfosOfWebmap(b.hitch(this,function(h){p.layers[h.id]=
{visible:h.isShowInMap()}}));w.set(y,{map:p,appStateMd5:this._getAppStateMd5()})}}});e.getInstance=function(k){null===f&&(f=new e);f.urlParams=k;return f};return e})},"jimu/LayoutManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dijit/_WidgetBase dojo/topic dojo/on dojo/query dojo/Deferred dojo/promise/all dojo/debounce require ./MapManager ./utils".split(" "),function(a,b,c,d,g,x,w,l,n,f,e,k,r){var y=null;var p=a([d],{constructor:function(h,m){this.own(g.subscribe("appConfigLoaded",
b.hitch(this,this._onAppConfigLoaded)));this.own(g.subscribe("appConfigChanged",b.hitch(this,this._onAppConfigChanged)));this.own(g.subscribe("sceneViewLoaded",b.hitch(this,this._onSceneViewLoaded)));this.own(g.subscribe("sceneViewChanged",b.hitch(this,this._onSceneViewChanged)));this.own(g.subscribe("beforeSceneViewDestory",b.hitch(this,this._onBeforeSceneViewDestroy)));this.own(g.subscribe("builder/actionTriggered",b.hitch(this,this._onActionTriggered)));this.own(g.subscribe("openWidget",b.hitch(this,
this._onOpenWidgetRequest)));this.own(x(window,"resize",f(b.hitch(this,this.resize),200)));this.id=m},postCreate:function(){this.containerNode=this.domNode},sceneView:null,mapId:"map",mapDiv:null,layoutManager:null,animTime:500,resize:function(){this.layoutManager&&this.layoutManager.resize()},_onAppConfigLoaded:function(h){this.appConfig=b.clone(h);this._loadLayoutManager(this.appConfig).then(b.hitch(this,function(m){this.layoutManager=m;this.layoutManager.onEnter(this.appConfig,this.mapId).then(b.hitch(this,
function(){this.mapDiv=this.layoutManager.getMapDiv();this._loadMap(this.mapId);this.appConfig.theme&&this._loadTheme(this.appConfig.theme)}))}))},_loadLayoutManager:function(h){h=h.layoutDefinition?h.layoutDefinition.manager:"jimu/layoutManagers/AbsolutePositionLayoutManager";var m=new l;e([h],b.hitch(this,function(u){u=u.getInstance();this.sceneView&&u.setSceneView(this.sceneView);m.resolve(u)}));return m},_loadMap:function(){this.mapManager=k.getInstance({appConfig:this.appConfig,urlParams:this.urlParams},
this.mapId);this.mapManager.showMap()},_onSceneViewLoaded:function(h){this.sceneView=h;this.layoutManager.setSceneView(h);this.layoutManager.loadAndLayout(this.appConfig)},_loadTheme:function(h){var m=new l;e(["themes/"+h.name+"/main"],b.hitch(this,function(){n([this._loadThemeCommonStyle(h),this._loadThemeCurrentStyle(h)]).then(b.hitch(this,function(){this._addCustomStyle(h);this.layoutManager.onThemeLoad();m.resolve()}))}));return m},_loadThemeCommonStyle:function(h){c.addClass(this.domNode,h.name);
return r.loadStyleLink(this._getThemeCommonStyleId(h),"themes/"+h.name+"/common.css")},_loadThemeCurrentStyle:function(h){c.addClass(this.domNode,h.styles[0]);return r.loadStyleLink(this._getThemeCurrentStyleId(h),"themes/"+h.name+"/styles/"+h.styles[0]+"/style.css")},_addCustomStyle:function(h){var m=b.getObject("customStyles",!1,h);if(m){var u=".jimu-main-background{background-color: ${mainBackgroundColor} !important;}";(h=this._getFixedThemeStyles(h))&&(u+=h);u=b.replace(u,m,/\$\{([^\}]+)\}/g);
m=c.create("style",{type:"text/css"});try{m.appendChild(document.createTextNode(u))}catch(t){m.styleSheet.cssText=u}m.setAttribute("source","custom");document.head.appendChild(m)}},_getFixedThemeStyles:function(h){var m=".esriPopup .titlePane {background-color: ${mainBackgroundColor} !important;}";"PlateauTheme"===h.name?m+=".jimu-widget-header-controller .jimu-title, .jimu-widget-header-controller .jimu-subtitle{color: ${mainBackgroundColor} !important;}.jimu-widget-header-controller .links .jimu-link{color: ${mainBackgroundColor} !important;}.jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-extent-navigate.vertical .operation{background-color: ${mainBackgroundColor} !important;}.jimu-preload-widget-icon-panel \x3e .jimu-panel-title, .jimu-foldable-panel \x3e .jimu-panel-title, .jimu-title-panel \x3e .title{color: ${mainBackgroundColor} !important;}.jimu-panel{border-color: ${mainBackgroundColor} !important;}.jimu-widget-header-controller{border-bottom-color: ${mainBackgroundColor} !important;}.jimu-tab\x3e.control\x3e.tab{color: ${mainBackgroundColor} !important; border-color: ${mainBackgroundColor} !important}":
"BillboardTheme"===h.name?m+=".jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-extent-navigate .operation, .jimu-widget-navigate, .jimu-widget-home, .jimu-widget-compass, .jimu-widget-fullScreen, .jimu-widget-zoom .esri-zoom .esri-widget, .jimu-widget-placeholder{background-color: ${mainBackgroundColor} !important;}.jimu-widget-onscreen-icon{background-color: ${mainBackgroundColor} !important;}":
"BoxTheme"===h.name?m+=".jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-extent-navigate, .jimu-widget-navigate, .jimu-widget-home, .jimu-widget-compass, .jimu-widget-fullScreen, .jimu-widget-zoom .esri-zoom .esri-widget, .jimu-widget-placeholder{background-color: ${mainBackgroundColor} !important;}":"TabTheme"===h.name?m+=".tab-widget-frame .title-label{color: ${mainBackgroundColor} !important;}":
"DartTheme"===h.name&&(m+=".jimu-widget-fullScreen .fullScreen{background-color: ${mainBackgroundColor} !important;}");return m},_onAppConfigChanged:function(h,m,u){h=b.clone(h);switch(m){case "themeChange":this._onThemeChange(h);break;case "styleChange":this._onStyleChange(h);break;case "layoutChange":this._onLayoutChange(h);break;case "widgetChange":this._onWidgetChange(h,u);break;case "groupChange":this._onGroupChange(h,u);break;case "widgetPoolChange":this._onWidgetPoolChange(h,u);break;case "resetConfig":this._onResetConfig(h);
break;case "loadingPageChange":this._onLoadingPageChange(h,u);break;case "layoutDefinitionChange":this._onLayoutDefinitionChange(h,u);break;case "onScreenGroupsChange":this._onOnScreenGroupsChange(h,u);break;case "onScreenOrderChange":this._onOnScreenOrderChange(h,u)}this.appConfig=h},_onSceneViewChanged:function(h){this.sceneView=h;this.layoutManager.setSceneView(h);this.layoutManager.loadAndLayout(this.appConfig)},_onBeforeSceneViewDestroy:function(){this.layoutManager.destroyOnScreenWidgetsAndGroups()},
_onActionTriggered:function(h){this.layoutManager.onActionTriggered(h)},_onWidgetChange:function(h,m){this.layoutManager.onWidgetChange(h,m)},_onGroupChange:function(h,m){this.layoutManager.onGroupChange(h,m)},_onWidgetPoolChange:function(h,m){this.layoutManager.onWidgetPoolChange(h,m)},_onLayoutDefinitionChange:function(h,m){this.layoutManager.onLayoutDefinitionChange(h,m)},_onOnScreenGroupsChange:function(h,m){this.layoutManager.onOnScreenGroupsChange(h,m)},_onOnScreenOrderChange:function(h,m){this.layoutManager.onOnScreenOrderChange(h,
m)},_onThemeChange:function(h){this.layoutManager.destroyOnScreenWidgetsAndGroups();this._removeThemeCommonStyle(this.appConfig.theme);this._removeThemeCurrentStyle(this.appConfig.theme);this._removeCustomStyle();n([this._loadLayoutManager(h),this._loadTheme(h.theme)]).then(b.hitch(this,function(m){var u=m[0];this.layoutManager.name!==u.name?(this.layoutManager.onLeave(),u.onEnter(h,this.mapId).then(b.hitch(this,function(){this.layoutManager=u;this.layoutManager.loadAndLayout(h)}))):this.layoutManager.loadAndLayout(h)}))},
_onResetConfig:function(h){var m=this.appConfig;g.publish("appConfigChanged",h,"mapChange",h);this.appConfig=m;this._loadLayoutManager(h).then(b.hitch(this,function(u){this.layoutManager=u;this._removeThemeCommonStyle(this.appConfig.theme);this._removeThemeCurrentStyle(this.appConfig.theme);this._removeCustomStyle();this._loadTheme(this.appConfig.theme)}))},_onLoadingPageChange:function(h,m){"backgroundColor"in m?c.setStyle(jimuConfig.loadingId,"background-color",h.loadingPage.backgroundColor):"backgroundImage"in
m?(h=h.loadingPage.backgroundImage,h.visible&&h.uri?(c.setStyle(jimuConfig.loadingImageId,"background-image","url('"+h.uri+"')"),c.setStyle(jimuConfig.loadingImageId,"width",h.width+"px"),c.setStyle(jimuConfig.loadingImageId,"height",h.height+"px")):(c.setStyle(jimuConfig.loadingImageId,"background-image","url('')"),c.setStyle(jimuConfig.loadingImageId,"width","0px"),c.setStyle(jimuConfig.loadingImageId,"height","0px"))):"loadingGif"in m&&(h=h.loadingPage.loadingGif,h.visible&&h.uri?(c.setStyle(jimuConfig.loadingGifId,
"background-image","url('"+h.uri+"')"),c.setStyle(jimuConfig.loadingGifId,"width",h.width+"px"),c.setStyle(jimuConfig.loadingGifId,"height",h.height+"px")):(c.setStyle(jimuConfig.loadingGifId,"background-image","url('')"),c.setStyle(jimuConfig.loadingGifId,"width","0px"),c.setStyle(jimuConfig.loadingGifId,"height","0px")))},_onStyleChange:function(h){this._removeThemeCurrentStyle(this.appConfig.theme);this._loadThemeCurrentStyle(h.theme);this._removeCustomStyle();this._addCustomStyle(h.theme)},_onLayoutChange:function(h){this.layoutManager.onLayoutChange(h)},
_removeThemeCommonStyle:function(h){c.removeClass(this.domNode,h.name);c.destroy(this._getThemeCommonStyleId(h))},_removeThemeCurrentStyle:function(h){c.removeClass(this.domNode,h.styles[0]);c.destroy(this._getThemeCurrentStyleId(h))},_removeCustomStyle:function(){w('style[source\x3d"custom"]',document.head).forEach(function(h){c.destroy(h)})},_getThemeCommonStyleId:function(h){return"theme_"+h.name+"_style_common"},_getThemeCurrentStyleId:function(h){return"theme_"+h.name+"_style_"+h.styles[0]},
_doPostLoad:function(){e(["dynamic-modules/postload"])},_onOpenWidgetRequest:function(h){this.layoutManager.openWidget(h)}});p.getInstance=function(h,m){null===y&&(y=new p(h,m),window._layoutManager=y);return y};return p})},"dojo/debounce":function(){define([],function(){return function(a,b){var c;return function(){c&&clearTimeout(c);var d=this,g=arguments;c=setTimeout(function(){a.apply(d,g)},b)}}})},"jimu/MapManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dojo/on dojo/keys esri/geometry/Extent esri/geometry/Point ./utils ./dijit/LoadingShelter ./AppStateManager ./WebSceneLoader esri/Viewpoint".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y){var p=null,h=a(null,{appConfig:null,mapDivId:"",map:null,previousInfoWindow:null,mobileInfoWindow:null,isMobileInfoWindow:!1,layerInfosObj:null,constructor:function(m,u){this.appConfig=m.appConfig;this.urlParams=m.urlParams;this.id=this.mapDivId=u;this.appStateManager=k.getInstance(this.urlParams);g.subscribe("appConfigChanged",b.hitch(this,this.onAppConfigChanged));g.subscribe("changeMapPosition",b.hitch(this,this.onChangeMapPosition));g.subscribe("syncViewpoint",
b.hitch(this,this.onSyncViewpoint));x(window,"resize",b.hitch(this,this.onWindowResize));x(window,"beforeunload",b.hitch(this,this.onBeforeUnload))},showMap:function(){this._showMap(this.appConfig)},_showMap:function(m){console.time("Load Map");this.loading=new e;this.loading.placeAt(this.mapDivId);this.loading.startup();m.map["3D"]?m.map.itemId?this._show3DWebScene(m):console.log("No webscene found. Please set map.itemId in config.json."):m.map.itemId?this._show2DWebMap(m):console.log("No webmap found. Please set map.itemId in config.json.")},
onBeforeUnload:function(){this.appStateManager.saveWabAppState(this.map,this.layerInfosObj)},onWindowResize:function(){this.map&&this.map.resize&&(this.map.resize(),this.resetInfoWindow(!1))},getMapInfoWindow:function(){return{mobile:this._mapMobileInfoWindow,bigScreen:this._mapInfoWindow}},resetInfoWindow:function(m){m&&(this._mapInfoWindow=this.map.infoWindow,this._mapMobileInfoWindow&&this._mapMobileInfoWindow.destroy(),this.isMobileInfoWindow=!1);window.appInfo.isRunInMobile&&!this.isMobileInfoWindow?
this.isMobileInfoWindow=!0:!window.appInfo.isRunInMobile&&this.isMobileInfoWindow&&(this.isMobileInfoWindow=!1)},onChangeMapPosition:function(m){var u=b.clone(this.mapPosition);b.mixin(u,m);this.setMapPosition(u)},setMapPosition:function(m){this.mapPosition=m;m=f.getPositionStyle(m);d.setStyle(this.mapDivId,m);this.map&&this.map.resize&&this.map.resize()},getMapPosition:function(){return this.mapPosition},onSyncViewpoint:function(m){this.sceneView&&(this.sceneView.viewpoint=m.clone())},_visitConfigMapLayers:function(m,
u){c.forEach(m.map.basemaps,function(t,q){t.isOperationalLayer=!1;u(t,q)},this);c.forEach(m.map.operationallayers,function(t,q){t.isOperationalLayer=!0;u(t,q)},this)},_destroySceneView:function(){if(this.sceneView)try{this.sceneView.destroy()}catch(m){console.error(m)}this.sceneView=null;window._sceneView=null},_show3DWebScene:function(m){var u=m.map.portalUrl,t=m.map.itemId;this._destroySceneView();r.createMap(this.mapDivId,u,t).then(b.hitch(this,function(q){this._publishSceneViewEvent(q);if(m.map.mapOptions)if((q=
m.map.mapOptions.initialState)&&q.viewpoint)try{var z=y.fromJSON(q.viewpoint);z&&(this.sceneView.map.initialViewProperties.viewpoint=z,this.sceneView.viewpoint=z.clone())}catch(v){console.error(v)}else this.sceneView.map.initialViewProperties.viewpoint=this.sceneView.viewpoint}),b.hitch(this,function(){this.loading&&this.loading.destroy();g.publish("mapCreatedFailed")}))},_publishSceneViewEvent:function(m){window._sceneView=m;console.timeEnd("Load Map");this.loading&&this.loading.destroy();this.sceneView?
(this.sceneView=m,console.log("sceneView changed"),g.publish("sceneViewChanged",this.sceneView)):(this.sceneView=m,console.log("sceneView loaded"),g.publish("sceneViewLoaded",this.sceneView))},_show2DWebMap:function(m){m.map.mapOptions||(m.map.mapOptions={});var u=this._processMapOptions(m.map.mapOptions)||{};u.isZoomSlider=!1;f.createWebMap(m.map.portalUrl,m.map.itemId,this.mapDivId,{mapOptions:u,bingMapsKey:m.bingMapsKey,usePopupManager:!0}).then(b.hitch(this,function(t){var q=t.map;q.hideZoomSlider();
q.infoWindow.resize(270,316);q.itemId=m.map.itemId;q.itemInfo=t.itemInfo;q.webMapResponse=t;q.enableSnapping({snapKey:w.copyKey});d.setStyle(q.root,"zIndex",0);q._initialExtent=q.extent;c.forEach("extent center marker find query scale level".split(" "),function(z){},this);this._publishMapEvent(q)}),b.hitch(this,function(){this.loading&&this.loading.destroy();g.publish("mapCreatedFailed")}))},_processMapOptions:function(m){if(m)return m.lods||delete m.lods,m.lods&&0===m.lods.length&&delete m.lods,
m=b.clone(m),m.extent&&(m.extent=new l(m.extent)),m.center&&!b.isArrayLike(m.center)&&(m.center=new n(m.center)),m},onAppConfigChanged:function(m,u,t){this.appConfig=m;"mapChange"===u?this._recreateMap(m):"mapOptionsChange"===u&&t.initialState&&(m=t.initialState.viewpoint)&&(this.sceneView.map.initialViewProperties.viewpoint=y.fromJSON(m),this.sceneView.animateTo(y.fromJSON(m)))},_recreateMap:function(m){this.sceneView&&(g.publish("beforeSceneViewDestory",this.sceneView),this._destroySceneView());
this._showMap(m)},disableWebMapPopup:function(){},enableWebMapPopup:function(){}});h.getInstance=function(m,u){null===p&&(p=new h(m,u));return p};return h})},"jimu/dijit/LoadingShelter":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/LoadingShelter.html","dojo/_base/html"],function(a,b,c,d,g){return a([b,c],{baseClass:"jimu-loading-shelter",declaredClass:"jimu.dijit.LoadingShelter",templateString:d,loadingText:null,hidden:!1,showLoading:!0,
postMixInProperties:function(){this.nls=window.jimuNls.loadingShelter},postCreate:function(){this.inherited(arguments);this.hidden&&g.setStyle(this.domNode,"display","none");g.setStyle(this.domNode,{width:"100%",height:"100%"});this.showLoading||g.setStyle(this.imgDiv,"display","none");"string"===typeof this.loadingText&&(this.textNode.innerHTML=this.loadingText)},show:function(x){this.domNode&&this.hidden&&("string"===typeof x&&(this.textNode.innerHTML=x),g.setStyle(this.domNode,"display","block"),
this.hidden=!1)},hide:function(){this.domNode&&!this.hidden&&(g.setStyle(this.domNode,"display","none"),this.hidden=!0)}})})},"dijit/_TemplatedMixin":function(){define("dojo/cache dojo/_base/declare dojo/dom-construct dojo/_base/lang dojo/on dojo/sniff dojo/string ./_AttachMixin".split(" "),function(a,b,c,d,g,x,w,l){var n=b("dijit._TemplatedMixin",l,{templateString:null,templatePath:null,_skipNodeCache:!1,searchContainerNode:!0,_stringRepl:function(f){var e=this.declaredClass,k=this;return w.substitute(f,
this,function(r,y){"!"==y.charAt(0)&&(r=d.getObject(y.substr(1),!1,k));if("undefined"==typeof r)throw Error(e+" template:"+y);return null==r?"":"!"==y.charAt(0)?r:this._escapeValue(""+r)},this)},_escapeValue:function(f){return f.replace(/["'<>&]/g,function(e){return{"\x26":"\x26amp;","\x3c":"\x26lt;","\x3e":"\x26gt;",'"':"\x26quot;","'":"\x26#x27;"}[e]})},buildRendering:function(){if(!this._rendered){this.templateString||(this.templateString=a(this.templatePath,{sanitize:!0}));var f=n.getCachedTemplate(this.templateString,
this._skipNodeCache,this.ownerDocument);if(d.isString(f)){var e=c.toDom(this._stringRepl(f),this.ownerDocument);if(1!=e.nodeType)throw Error("Invalid template: "+f);}else e=f.cloneNode(!0);this.domNode=e}this.inherited(arguments);this._rendered||this._fillContent(this.srcNodeRef);this._rendered=!0},_fillContent:function(f){var e=this.containerNode;if(f&&e)for(;f.hasChildNodes();)e.appendChild(f.firstChild)}});n._templateCache={};n.getCachedTemplate=function(f,e,k){var r=n._templateCache,y=f,p=r[y];
if(p){try{if(!p.ownerDocument||p.ownerDocument==(k||document))return p}catch(h){}c.destroy(p)}f=w.trim(f);if(e||f.match(/\$\{([^\}]+)\}/g))return r[y]=f;e=c.toDom(f,k);if(1!=e.nodeType)throw Error("Invalid template: "+f);return r[y]=e};x("ie")&&g(window,"unload",function(){var f=n._templateCache,e;for(e in f){var k=f[e];"object"==typeof k&&c.destroy(k);delete f[e]}});return n})},"dojo/cache":function(){define(["./_base/kernel","./text"],function(a){return a.cache})},"dojo/text":function(){define(["./_base/kernel",
"require","./has","./has!host-browser?./request"],function(a,b,c,d){var g;c("host-browser")?g=function(f,e,k){d(f,{sync:!!e,headers:{"X-Requested-With":null}}).then(k)}:b.getText?g=b.getText:console.error("dojo/text plugin failed to load because loader does not support getText");var x={},w=function(f){if(f){f=f.replace(/^\s*<\?xml(\s)+version=['"](\d)*.(\d)*['"](\s)*\?>/im,"");var e=f.match(/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im);e&&(f=e[1])}else f="";return f},l={},n={};a.cache=function(f,e,k){if("string"==
typeof f)if(/\//.test(f)){var r=f;k=e}else r=b.toUrl(f.replace(/\./g,"/")+(e?"/"+e:""));else r=f+"",k=e;f=void 0!=k&&"string"!=typeof k?k.value:k;k=k&&k.sanitize;if("string"==typeof f)return x[r]=f,k?w(f):f;if(null===f)return delete x[r],null;r in x||g(r,!0,function(y){x[r]=y});return k?w(x[r]):x[r]};return{dynamic:!0,normalize:function(f,e){f=f.split("!");var k=f[0];return(/^\./.test(k)?e(k):k)+(f[1]?"!"+f[1]:"")},load:function(f,e,k){f=f.split("!");var r=1<f.length,y=f[0],p=e.toUrl(f[0]);f="url:"+
p;var h=l,m=function(t){k(r?w(t):t)};y in x?h=x[y]:e.cache&&f in e.cache?h=e.cache[f]:p in x&&(h=x[p]);if(h===l)if(n[p])n[p].push(m);else{var u=n[p]=[m];g(p,!e.async,function(t){x[y]=x[p]=t;for(var q=0;q<u.length;)u[q++](t);delete n[p]})}else m(h)}}})},"dijit/_AttachMixin":function(){define("require dojo/_base/array dojo/_base/connect dojo/_base/declare dojo/_base/lang dojo/mouse dojo/on dojo/touch ./_WidgetBase".split(" "),function(a,b,c,d,g,x,w,l,n){var f=g.delegate(l,{mouseenter:x.enter,mouseleave:x.leave,
keypress:c._keypress}),e;c=d("dijit._AttachMixin",null,{constructor:function(){this._attachPoints=[];this._attachEvents=[]},buildRendering:function(){this.inherited(arguments);this._attachTemplateNodes(this.domNode);this._beforeFillContent()},_beforeFillContent:function(){},_attachTemplateNodes:function(k){for(var r=k;;)if(1==r.nodeType&&(this._processTemplateNode(r,function(y,p){return y.getAttribute(p)},this._attach)||this.searchContainerNode)&&r.firstChild)r=r.firstChild;else{if(r==k)break;for(;!r.nextSibling;)if(r=
r.parentNode,r==k)return;r=r.nextSibling}},_processTemplateNode:function(k,r,y){var p=!0,h=this.attachScope||this,m=r(k,"dojoAttachPoint")||r(k,"data-dojo-attach-point");if(m)for(var u=m.split(/\s*,\s*/);m=u.shift();)g.isArray(h[m])?h[m].push(k):h[m]=k,p="containerNode"!=m,this._attachPoints.push(m);if(r=r(k,"dojoAttachEvent")||r(k,"data-dojo-attach-event"))for(m=r.split(/\s*,\s*/),u=g.trim;r=m.shift();)if(r){var t=null;-1!=r.indexOf(":")?(t=r.split(":"),r=u(t[0]),t=u(t[1])):r=u(r);t||(t=r);this._attachEvents.push(y(k,
r,g.hitch(h,t)))}return p},_attach:function(k,r,y){r=r.replace(/^on/,"").toLowerCase();r="dijitclick"==r?e||(e=a("./a11yclick")):f[r]||r;return w(k,r,y)},_detachTemplateNodes:function(){var k=this.attachScope||this;b.forEach(this._attachPoints,function(r){delete k[r]});this._attachPoints=[];b.forEach(this._attachEvents,function(r){r.remove()});this._attachEvents=[]},destroyRendering:function(){this._detachTemplateNodes();this.inherited(arguments)}});g.extend(n,{dojoAttachEvent:"",dojoAttachPoint:""});
return c})},"jimu/WebSceneLoader":function(){define("dojo/Deferred dojo/_base/lang dojo/_base/array dojo/_base/html dojo/promise/all esri/kernel esri/WebScene esri/views/SceneView esri/portal/Portal esri/portal/PortalItem esri/core/has ./utils ./portalUtils ./portalUrlUtils".split(" "),function(a,b,c,d,g,x,w,l,n,f,e,k,r,y){return{createMap:function(p,h,m){var u=new a;this._isWebGLAvailable()?u=this._createMap(p,h,m):(u.reject("The browser doesn't support webgl."),(p=b.getObject("webSceneLoader.webglSupportTip",
!1,window.jimuNls))||(p="3D web apps aren't supported in your browser."),d.create("div",{"class":"app-error",innerHTML:p},document.body));return u},_createMap:function(p,h,m){k.getEsriConfig().portalUrl=y.getStandardPortalUrl(h);var u=new a,t=[];n._default=null;var q=new w({portalItem:new f({id:m})}),z=new l({map:q,container:p,constraints:{collision:{enabled:!1},tilt:{max:179.99}}});t.push(z.when());h=r.getPortal(h);t.push(h.getItemById(m));t.push(h.getItemData(m));g(t).then(b.hitch(this,function(v){z.popup&&
(z.popup.closeOnViewChangeEnabled=!0);q.id=p;q.itemId=m;q.itemInfo={item:v[1],itemData:v[2]};this._handleLocalScene(z);u.resolve(z)}),b.hitch(this,function(v){console.error(v);u.reject(v)}));return u},_handleLocalScene:function(p){try{p.viewingMode&&"local"===p.viewingMode.toLowerCase()&&(b.setObject("constraints.collision.enabled",!1,p),b.setObject("constraints.tilt.max",179.99,p))}catch(h){console.error(h)}},_handleAttribution:function(p){try{if("4.0"!==x.version){var h=p.ui&&p.ui._components;h&&
0<h.length&&c.some(h,function(m){return(m=m&&m._widget)&&"esri.widgets.Attribution"===m.declaredClass?(m.domNode.parentNode.style.width="100%",d.create("span",{innerHTML:"Powered by Esri","class":"esri-attribution-powered-by"},m.domNode),!0):!1})}}catch(m){console.error(m)}},_isWebGLAvailable:function(){try{var p=document.createElement("canvas");return!(!window.WebGLRenderingContext||!p.getContext("webgl")&&!p.getContext("experimental-webgl"))}catch(h){return!1}},_isWebGL2Available:function(){try{var p=
document.createElement("canvas");return!(!window.WebGL2RenderingContext||!p.getContext("webgl2"))}catch(h){return!1}}}})},"esri/WebScene":function(){define("require ./chunks/_rollupPluginBabelHelpers ./chunks/tslib.es6 ./kernel ./Map ./Viewpoint ./core/Collection ./core/Error ./core/Handles ./core/has ./core/lang ./core/Loadable ./core/loadAll ./core/Logger ./core/maybe ./core/MultiOriginJSONSupport ./core/Promise ./core/promiseUtils ./core/urlUtils ./core/accessorSupport/decorators/property ./core/accessorSupport/ensureType ./core/accessorSupport/decorators/reader ./core/accessorSupport/decorators/subclass ./core/accessorSupport/decorators/writer ./core/accessorSupport/originUtils ./core/accessorSupport/read ./geometry/Extent ./geometry/HeightModelInfo ./geometry/projection ./geometry/SpatialReference ./geometry/support/heightModelInfoUtils ./geometry/support/jsonUtils ./geometry/support/spatialReferenceUtils ./portal/Portal ./portal/PortalItem ./support/MapFloorInfo ./support/webSceneUtils ./views/ViewingMode ./views/support/spatialReferenceSupport ./webdoc/support/saveUtils ./webdoc/support/thumbnailUtils ./webscene/ApplicationProperties ./webscene/Environment ./webscene/InitialViewProperties ./webscene/Presentation ./webscene/TransportationNetwork ./webscene/Version".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E,C,D,F,G,J,I,O,P,K,M,U,R,L,N,T,S,H,Q,W,V,Y,aa){const X=y.getLogger("esri.WebScene"),ba=new aa.Version(1,27);g=function(ka){function ia(ca){var Z=ka.call(this,ca)||this;Z._handles=new n;Z.applicationProperties=null;Z.clippingArea=null;Z.clippingEnabled=!1;Z.floorInfo=null;Z.heightModelInfo=null;Z.sourceVersion=null;Z.transportationNetworks=null;Z.presentation=new V;Z.initialViewProperties=new W;Z.portalItem=null;Z.resourceInfo=null;Z._debouncedSaveOperations=
u.debounce(function(){var fa=b._asyncToGenerator(function*(ja,la,ma){switch(ja){case ha.SAVE:return Z._saveImpl(la);case ha.SAVE_AS:return Z._saveAsImpl(ma,la)}});return function(ja,la,ma){return fa.apply(this,arguments)}}());Z.resourceReferences={portalItem:null,paths:[]};Z.authoringApp=null;Z.authoringAppVersion=null;Z._isAuthoringAppSetByUser=!1;Z._isAuthoringAppVersionSetByUser=!1;return Z}b._inheritsLoose(ia,ka);var ea=ia.prototype;ea.initialize=function(){this.when().catch(ca=>{X.error("#load()",
"Failed to load web scene",ca)});if(this.resourceInfo){let ca;try{ca=this._validateJSON(this.resourceInfo)}catch(Z){this.addResolvingPromise(Promise.reject(Z));return}this.read(ca);this.addResolvingPromise(this._validateSpatialReference());this.addResolvingPromise(this._validateHeightModelInfo())}this._handles.add(this.allLayers.on("change",()=>this._scheduleLayersIdGC()))};ea.destroy=function(){this._unscheduleLayersIdGC();this._handles.destroy();this.presentation&&this.presentation.destroy();const ca=
this.portalItem;this.portalItem=null;null==ca?void 0:ca.destroy()};ea.writeClippingArea=function(ca,Z){Z.clippingArea||(Z.clippingArea={});Z.clippingArea.geometry=ca.toJSON()};ea.readClippingEnabled=function(ca,Z){return Z.clippingArea?!!Z.clippingArea.clip:!1};ea.writeClippingEnabled=function(ca,Z){this.clippingArea&&(Z.clippingArea||(Z.clippingArea={}),Z.clippingArea.clip=ca)};ea.writeLayers=function(ca,Z,fa,ja){const la={...ja,layerContainerType:"operational-layers"};ca=ca.map(ma=>this.verifyWriteLayer(ma,
ja)?ma.write({},la):null).filter(ma=>!!ma);Z[fa]=ca.toArray()};ea.verifyWriteLayer=function(ca,Z){return"write"in ca?!0:(Z&&Z.messages&&Z.messages.push(new l("layer:unsupported",`Layers (${ca.title}, ${ca.id}) of type '${ca.declaredClass}' cannot be persisted in web scenes`,{layer:ca})),!1)};ea.readSourceVersion=function(ca,Z){const [fa,ja]=Z.version.split(".");return new aa.Version(parseInt(fa,10),parseInt(ja,10))};ea.writeSourceVersion=function(ca,Z,fa){Z[fa]=`${ba.major}.${ba.minor}`};ea.writeAuthoringApp=
function(ca,Z){Z.authoringApp=ca&&this._isAuthoringAppSetByUser?ca:"ArcGIS API for JavaScript"};ea.writeAuthoringAppVersion=function(ca,Z){Z.authoringAppVersion=ca&&this._isAuthoringAppVersionSetByUser?ca:d.version};ea.writeGround=function(ca,Z,fa,ja){Z[fa]=ca?ca.write({},ja):{transparency:0,layers:[]}};ea.readInitialViewProperties=function(ca,Z){ca={};Z.initialState&&Z.initialState.environment&&(ca.environment=Q.fromJSON(Z.initialState.environment));ca.spatialReference=Z.spatialReference?J.fromJSON(Z.spatialReference):
J.WebMercator;ca.viewingMode=Z.viewingMode||"global";Z.initialState&&Z.initialState.viewpoint&&(ca.viewpoint=x.fromJSON(Z.initialState.viewpoint));return new W(ca)};ea.load=function(ca){this.addResolvingPromise(this._loadFromSource());return Promise.resolve(this)};ea.loadAll=function(){return r.loadAll(this,ca=>{const Z=this.presentation&&this.presentation.slides;ca(this.ground,this.basemap,this.layers,Z&&Z.map(fa=>fa.basemap))})};ea.read=function(ca,Z){Z={...Z,origin:"web-scene"};const fa=this._isAuthoringAppVersionSetByUser,
ja=this._isAuthoringAppSetByUser;C.readLoadable(this,ca,la=>ka.prototype.read.call(this,ca,la),Z);ja||(this._isAuthoringAppSetByUser=!1);fa||(this._isAuthoringAppVersionSetByUser=!1);if(ca.baseMap&&Array.isArray(ca.baseMap.elevationLayers)&&this.sourceVersion.supportsVisibleElevationLayersInSlides){Z=ca.baseMap.elevationLayers.map(va=>({id:va.id}));const la=this.presentation.slides,ma=(va,ya)=>va.visibleLayers.some(za=>za.id===ya),ra=Z.filter(va=>!la.some(ya=>ma(ya,va.id)));la.forEach(va=>{va.visibleLayers.addMany(ra)})}};
ea._writeBasemapElevationLayers=function(ca){const Z=ca.ground&&ca.ground.layers;!ca.baseMap&&Z&&Z.length&&(ca.baseMap={title:"Basemap",baseMapLayers:[]});ca.baseMap&&(ca.baseMap.elevationLayers=e.clone(Z))};ea.write=function(ca,Z){var fa;if("loaded"!==this.loadStatus)throw Z=new l("webscene:not-loaded","Web scene must be loaded before it can be serialized"),X.error("#toJSON()","Web scene must be loaded before it can be serialized",this.loadError||this.loadStatus),Z;this._runLayersIdGC();var ja=!(null!=
(fa=Z)&&fa.messages);Z={messages:[],...Z,origin:"web-scene"};ca=ka.prototype.write.call(this,ca,Z);if(ja&&(Z=Z.messages.filter(la=>"web-document-write:property-required"===la.name),Z.length))throw ja=new l("web-document:property-required","One or more properties that are required in the webscene JSON are missing, see details for the specific errors",{errors:Z}),X.error("#toJSON()","One or more properties that are required in the webscene JSON are missing",Z),ja;this._writeBasemapElevationLayers(ca);
return ca};ea.save=function(){var ca=b._asyncToGenerator(function*(Z){return this._debouncedSaveOperations(ha.SAVE,Z)});return function(Z){return ca.apply(this,arguments)}}();ea._saveImpl=function(){var ca=b._asyncToGenerator(function*(Z){this.portalItem||(X.error("save(): requires the .portalItem property to be set"),yield Promise.reject(new l("webscene:portal-item-not-set","Portal item to save to has not been set on the WebScene")));"Web Scene"!==this.portalItem.type&&(yield Promise.reject(new l("webscene:portal-item-wrong-type",
'Portal item needs to have type "Web Scene"')));const fa=this._updateFromPromise;yield this._ensureLoadBeforeSave();const ja=this._enableVerifyItemRelativeUrls({origin:"web-scene",url:this.portalItem.itemUrl&&t.urlToObject(this.portalItem.itemUrl),messages:[],portal:this.portalItem.portal||K.getDefault(),portalItem:this.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}}),la=this.write({},ja);yield Promise.all(ja.resources.pendingOperations);
yield this._verifySave(la,ja,Z);this._updateTypeKeywords(this.portalItem);yield this.portalItem.update({data:la});yield T.saveResources(this.resourceReferences,ja,null);E.updateOrigins(ja);fa&&(yield fa);yield this._saveThumbnail();return this.portalItem});return function(Z){return ca.apply(this,arguments)}}();ea.saveAs=function(){var ca=b._asyncToGenerator(function*(Z,fa){return this._debouncedSaveOperations(ha.SAVE_AS,fa,Z)});return function(Z,fa){return ca.apply(this,arguments)}}();ea._saveAsImpl=
function(){var ca=b._asyncToGenerator(function*(Z,fa){Z=M.from(Z);Z||(X.error("saveAs(portalItem): requires a portal item parameter"),yield Promise.reject(new l("webscene:portal-item-required","saveAs requires a portal item to save to")));Z.id&&(Z=Z.clone(),Z.id=null);const ja=Z.portal||K.getDefault();yield this._ensureLoadBeforeSave();Z.type="Web Scene";Z.portal=ja;const la=this._enableVerifyItemRelativeUrls({origin:"web-scene",url:null,messages:[],portal:ja,portalItem:Z,writtenProperties:[],blockedRelativeUrls:[],
resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}}),ma=this.write({},la);yield Promise.all(la.resources.pendingOperations);yield this._verifySaveAs(ma,la,fa);const ra=this.thumbnailUrl,va=!this._isOverridden("thumbnailUrl");this._updateTypeKeywords(Z);yield ja._signIn();yield ja.user.addItem({item:Z,folder:fa&&fa.folder,data:ma});yield T.saveResources(this.resourceReferences,la,null);this.portalItem=Z;h.MultiOriginJSONSupport.prototype.read.call(this,{version:ma.version,authoringApp:ma.authoringApp,
authoringAppVersion:ma.authoringAppVersion},{name:"web-scene",ignoreDefaults:!0,url:Z.itemUrl&&t.urlToObject(Z.itemUrl)});E.updateOrigins(la);ra&&(this.thumbnailUrl=va?t.addQueryParameter(ra,"w","8192"):ra);la.portalItem=Z;yield this._saveThumbnail();return Z});return function(Z,fa){return ca.apply(this,arguments)}}();ea._saveThumbnail=function(){var ca=b._asyncToGenerator(function*(){this._isOverridden("thumbnailUrl")&&(yield this.portalItem.updateThumbnail({thumbnail:this.thumbnailUrl}),this._clearOverride("thumbnailUrl"),
this.clear("thumbnailUrl","user"))});return function(){return ca.apply(this,arguments)}}();ea._verifySave=function(ca,Z,fa,ja=!1){if(!P.isEarth(this.spatialReference))return Promise.reject(new l("webscene:unsupported-spatial-reference","Webscenes using spatial reference systems from Mars or Moon can not be saved currently."));let la=Z.messages.filter(ra=>"error"===ra.type).map(ra=>new l(ra.name,ra.message,ra.details));Z.blockedRelativeUrls&&(la=la.concat(Z.blockedRelativeUrls.map(ra=>new l("url:unsupported",
`Relative url '${ra}' is not supported in Web Scene`))));fa&&fa.ignoreUnsupported&&(la=la.filter(ra=>"layer:unsupported"!==ra.name&&"symbol:unsupported"!==ra.name&&"symbol-layer:unsupported"!==ra.name&&"property:unsupported"!==ra.name&&"url:unsupported"!==ra.name&&"scenemodification:unsupported"!==ra.name));null!=fa&&fa.requiredPropertyChecksDisabled&&(la=la.filter(ra=>"web-document-write:property-required"!==ra.name));const ma=fa&&fa.strictSchemaValidationEnabled;return(ma?(new Promise((ra,va)=>
a(["./webscene/support/schemaValidator"],ra,va))).then(ra=>{ra=ra.validate(ca);if(0<ra.length){const va=`webscene did not validate:\n${ra.join("\n")}`;X.error(`${ja?"saveAs":"save"}(): ${va}`)}return ra.map(va=>new l("webscene:schema-validation",va))}).then(ra=>{if(ma&&0<ra.length)throw R.createSchemaValidationError(ra.concat(la));return la}):Promise.resolve(la)).then(ra=>{if(0<ra.length)return Promise.reject(new l("webscene:save","Failed to save webscene due to unsupported or invalid content. See 'details.errors' for more detailed information",
{errors:ra}))})};ea._verifySaveAs=function(ca,Z,fa){return this.canNotSaveAs(Z)?Promise.reject(R.createCopyError()):this._verifySave(ca,Z,fa,!0)};ea.verifySaveAs=function(ca){const Z=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),fa=this.write({},Z);return this._verifySaveAs(fa,Z,ca)};ea.canNotSaveAs=function(ca){ca||(ca=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),this.write({},ca));return ca.verifyItemRelativeUrls&&0<ca.verifyItemRelativeUrls.writtenUrls.length};
ea.updateFrom=function(){var ca=b._asyncToGenerator(function*(Z,fa={}){this._updateFromPromise=Z=this._updateFrom(Z,fa);yield Z;this._updateFromPromise===Z&&(this._updateFromPromise=null)});return function(Z){return ca.apply(this,arguments)}}();ea._updateFrom=function(){var ca=b._asyncToGenerator(function*(Z,fa={}){yield Z.whenReady();if(!fa.environmentExcluded&&Z.environment){if(Z.environment.lighting.type&&"sun"!==Z.environment.lighting.type)throw new l("lighting:unsupported",`${Z.environment.lighting.type} lighting cannot be stored in WebScene`);
this.initialViewProperties.environment=Q.prototype.clone.apply(Z.environment)}!fa.viewpointExcluded&&Z.viewpoint&&(this.initialViewProperties.viewpoint=Z.viewpoint.clone());this.initialViewProperties.spatialReference=Z.spatialReference.clone();this.initialViewProperties.viewingMode=Z.viewingMode;p.isSome(Z.clippingArea)?Z.clippingArea!==this.clippingArea&&(this.clippingArea=Z.clippingArea.clone(),this.clippingEnabled=!0):this.clippingEnabled=!1;Z.heightModelInfo&&(this.heightModelInfo=Z.heightModelInfo.clone());
if(Z.map===this)for(const ja of Z.allLayerViews)"visible"in ja&&"visible"in ja.layer&&ja._isOverridden("visible")&&(ja.layer.visible=ja.visible);if(!1===fa.thumbnailExcluded||null==fa.thumbnailExcluded&&!fa.viewpointExcluded)yield this._updateFromThumbnail(Z,fa.thumbnailSize||void 0)});return function(Z){return ca.apply(this,arguments)}}();ea._updateFromThumbnail=function(){var ca=b._asyncToGenerator(function*(Z,fa){fa=S.getOptimalThumbnailSize(Z,fa);this.thumbnailUrl=(yield Z.takeScreenshot({format:"jpg",
width:fa.width,height:fa.height,disableDecorations:!0})).dataUrl});return function(Z,fa){return ca.apply(this,arguments)}}();ea._loadFromSource=function(){return this.resourceInfo?this._loadFromJSON(this.resourceInfo,{origin:"web-scene"}):this.portalItem&&this.portalItem.id?this._loadFromItem(this.portalItem):this._loadObjectsWithLayers()};ea._readAndLoadFromJSON=function(ca,Z){ca=this._validateJSON(ca);this.read(ca,Z);return this._loadFromJSON(ca,Z)};ea._extractOperationalLayers=function(ca){const Z=
[];if(!this.sourceVersion.supportsGround&&ca.baseMap&&Array.isArray(ca.baseMap.elevationLayers))for(const la of ca.baseMap.elevationLayers)Z.push(la);const fa=[],ja=la=>{la.layers&&(la.layers=la.layers.filter(ja));return"ArcGISTiledElevationServiceLayer"===la.layerType?(this.sourceVersion.supportsGround||fa.push(la),!1):!0};return{operationalLayers:ca.operationalLayers?ca.operationalLayers.filter(ja):[],operationalElevationLayers:fa,basemapElevationLayers:Z}};ea._loadFromJSON=function(ca,Z){const fa=
new w;return this._validateSpatialReference().then(()=>this._validateHeightModelInfo()).then(()=>new Promise((ja,la)=>a(["./layers/support/layersCreator"],ja,la))).then(({populateOperationalLayers:ja})=>{const {operationalLayers:la,operationalElevationLayers:ma,basemapElevationLayers:ra}=this._extractOperationalLayers(ca),va=[],ya={context:{...Z,layerContainerType:"operational-layers"}};this.portalItem&&(ya.context.portal=this.portalItem.portal||K.getDefault());0<ra.length&&va.push(ja(this.ground.layers,
ra,{...ya,context:{...ya.context,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"}));0<ma.length&&va.push(ja(fa,ma,{...ya,context:{...ya.context,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"}));la&&0<la.length&&va.push(ja(this.layers,la,ya));return u.eachAlways(va).then(()=>{})}).then(()=>this._loadObjectsWithLayers()).then(()=>{this.ground.layers.addMany(fa)})};ea._ensureLoadBeforeSave=function(){var ca=b._asyncToGenerator(function*(){yield this.load();
yield this._loadObjectsWithLayers();const Z=[];for(const fa of this.allLayers.items)if("beforeSave"in fa&&"function"===typeof fa.beforeSave){const ja=fa.beforeSave();ja&&Z.push(ja)}yield u.eachAlways(Z)});return function(){return ca.apply(this,arguments)}}();ea._loadObjectsWithLayers=function(){var ca=b._asyncToGenerator(function*(){const Z=[];this.ground&&Z.push(this.ground.load());this.basemap&&Z.push(this.basemap.load());this.presentation.slides.forEach(fa=>{fa.basemap&&Z.push(fa.basemap.load())});
yield u.eachAlways(Z)});return function(){return ca.apply(this,arguments)}}();ea._loadFromItem=function(){var ca=b._asyncToGenerator(function*(Z){yield Z.load().catch(la=>{throw new l("webscene:load-portal-item","Failed to load portal item",{error:la});});if("Web Scene"!==Z.type)throw new l("webscene:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Scene'",{type:Z.type});const fa=yield Z.fetchData();this.resourceInfo=fa;const ja={origin:"web-scene",url:t.urlToObject(Z.itemUrl),
portal:Z.portal||K.getDefault(),portalItem:Z,readResourcePaths:[]};yield this._readAndLoadFromJSON(fa,ja);this.resourceReferences={portalItem:Z,paths:ja.readResourcePaths}});return function(Z){return ca.apply(this,arguments)}}();ea._validateSpatialReference=function(){const ca=this.initialViewProperties,Z=this._sceneSpatialReference;let fa;if("local"!==ca.viewingMode){if(!N.isSpatialReferenceSupported(Z,L.ViewingMode.Global))return Promise.reject(new l("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in global mode, only Web Mercator, WGS84 GCS or CGCS2000 are supported",
{spatialReference:Z,viewingMode:ca.viewingMode}));fa=ma=>!ma||G.canProjectWithoutEngine(ma,Z)}else{if(!N.isSpatialReferenceSupported(Z,L.ViewingMode.Local))return Promise.reject(new l("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in local mode, only projected coordinate systems are supported",{spatialReference:Z,viewingMode:ca.viewingMode}));fa=ma=>!ma||ma.equals(Z)}const ja=ma=>ma&&(p.isSome(ma.camera)&&ma.camera.position&&ma.camera.position.spatialReference||
p.isSome(ma.targetGeometry)&&ma.targetGeometry.spatialReference);var la=ja(ca.viewpoint);return la&&!fa(la)?Promise.reject(new l("webscene:incompatible-camera-spatial-reference","Camera spatial reference (${cameraSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{cameraSpatialReference:la,sceneSpatialReference:Z,viewingMode:ca.viewingMode})):(la=this.presentation.slides.find(ma=>!fa(ja(ma.viewpoint))))?(la=ja(la.viewpoint),Promise.reject(new l("webscene:incompatible-slide-spatial-reference",
"Slide spatial reference (${slideSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{slideSpatialReference:la,sceneSpatialReference:Z,viewingMode:ca.viewingMode}))):Promise.resolve()};ea._validateHeightModelInfo=function(){const ca=I.validateWebSceneError(this.heightModelInfo,this._sceneSpatialReference);return ca?Promise.reject(ca):Promise.resolve()};ea._validateJSON=function(ca){const Z=aa.Version.parse(ca.version||"","webscene");ba.validate(Z);
ca.version=`${Z.major}.${Z.minor}`;1===Z.major&&2>=Z.minor&&(ca.spatialReference=J.WebMercator.toJSON());return ca};ea._updateTypeKeywords=function(ca){"local"===this.initialViewProperties.viewingMode?ca.typeKeywords?-1===ca.typeKeywords.indexOf("ViewingMode-Local")&&ca.typeKeywords.push("ViewingMode-Local"):ca.typeKeywords=["ViewingMode-Local"]:"global"===this.initialViewProperties.viewingMode&&ca.typeKeywords&&(ca.typeKeywords=ca.typeKeywords.filter(Z=>"ViewingMode-Local"!==Z));ca.typeKeywords&&
(ca.typeKeywords=ca.typeKeywords.filter((Z,fa,ja)=>ja.indexOf(Z)===fa))};ea._enableVerifyItemRelativeUrls=function(ca){const Z=this._verifyItemRelativeRootPath;Z&&(ca.verifyItemRelativeUrls={rootPath:Z,writtenUrls:[]});return ca};ea._unscheduleLayersIdGC=function(){this._layersIdGCTimeoutId&&(clearTimeout(this._layersIdGCTimeoutId),this._layersIdGCTimeoutId=0)};ea._scheduleLayersIdGC=function(){this._unscheduleLayersIdGC();this._layersIdGCTimeoutId=setTimeout(()=>{this._layersIdGCTimeoutId=0;this._runLayersIdGC()},
3E3)};ea._runLayersIdGC=function(){this._unscheduleLayersIdGC();var ca=this.applicationProperties&&this.applicationProperties.viewing&&this.applicationProperties.viewing.search;const Z=fa=>!!this.allLayers.find(ja=>ja.id===fa);ca&&ca.layers&&(ca.layers=ca.layers.filter(fa=>Z(fa.id)));(ca=this.presentation&&this.presentation.slides)&&ca.forEach(fa=>{fa.visibleLayers&&(fa.visibleLayers=fa.visibleLayers.filter(ja=>Z(ja.id)))})};ia.fromJSON=function(ca){if(!ca)throw new l("webscene:empty-resource","Expected a JSON resource but got nothing");
return new this({resourceInfo:ca})};b._createClass(ia,[{key:"thumbnailUrl",get:function(){return this.portalItem&&this.portalItem.thumbnailUrl||null},set:function(ca){ca?this._override("thumbnailUrl",ca):(this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}},{key:"authoringApp",set:function(ca){this._isAuthoringAppSetByUser=!0;this._set("authoringApp",ca)}},{key:"authoringAppVersion",set:function(ca){this._isAuthoringAppVersionSetByUser=!0;this._set("authoringAppVersion",ca)}},
{key:"spatialReference",get:function(){var ca,Z;return null!=(ca=null==(Z=this.initialViewProperties)?void 0:Z.spatialReference)?ca:J.WebMercator}},{key:"viewingMode",get:function(){var ca,Z;return null!=(ca=null==(Z=this.initialViewProperties)?void 0:Z.viewingMode)?ca:"global"}},{key:"_sceneSpatialReference",get:function(){return this.initialViewProperties.spatialReference||J.WebMercator}},{key:"_verifyItemRelativeRootPath",get:function(){return this.portalItem&&this.portalItem.itemUrl?t.urlToObject(this.portalItem.itemUrl).path:
null}}]);return ia}(k.LoadableMixin(m.EsriPromiseMixin(h.MultiOriginJSONMixin(g))));g.VERSION=ba;c.__decorate([q.property({type:H,json:{write:!0}})],g.prototype,"applicationProperties",void 0);c.__decorate([q.property({json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],g.prototype,"basemap",void 0);c.__decorate([q.property({type:D,json:{read:{source:"clippingArea.geometry",reader:O.fromJSON},write:{target:"clippingArea.geometry"}}})],g.prototype,"clippingArea",void 0);c.__decorate([A.writer("clippingArea")],
g.prototype,"writeClippingArea",null);c.__decorate([q.property({type:Boolean,json:{write:{target:"clippingArea.clip"}}})],g.prototype,"clippingEnabled",void 0);c.__decorate([v.reader("clippingEnabled",["clippingArea"])],g.prototype,"readClippingEnabled",null);c.__decorate([A.writer("clippingEnabled")],g.prototype,"writeClippingEnabled",null);c.__decorate([q.property({type:U,json:{read:{source:"mapFloorInfo"},write:{target:"mapFloorInfo"}}})],g.prototype,"floorInfo",void 0);c.__decorate([q.property({type:F,
json:{write:!0}})],g.prototype,"heightModelInfo",void 0);c.__decorate([q.property({json:{write:{target:"operationalLayers",ignoreOrigin:!0}}})],g.prototype,"layers",void 0);c.__decorate([A.writer("layers")],g.prototype,"writeLayers",null);c.__decorate([q.property({readOnly:!0,type:aa.Version,json:{type:(()=>{const ka=[],ia=ba.major;for(let ea=8;ea<=ba.minor;ea++)ka.push(`${ia}.${ea}`);return ka})(),write:{ignoreOrigin:!0,target:"version",isRequired:!0,overridePolicy:()=>({enabled:!0,allowNull:!0,
ignoreOrigin:!0})}}})],g.prototype,"sourceVersion",void 0);c.__decorate([v.reader("sourceVersion",["version"])],g.prototype,"readSourceVersion",null);c.__decorate([A.writer("sourceVersion")],g.prototype,"writeSourceVersion",null);c.__decorate([q.property({json:{read:!1,write:!1}})],g.prototype,"tables",void 0);c.__decorate([q.property()],g.prototype,"thumbnailUrl",null);c.__decorate([q.property({type:String,json:{write:{writerEnsuresNonNull:!0,ignoreOrigin:!0}}})],g.prototype,"authoringApp",null);
c.__decorate([A.writer("authoringApp")],g.prototype,"writeAuthoringApp",null);c.__decorate([q.property({type:String,json:{write:{writerEnsuresNonNull:!0,ignoreOrigin:!0}}})],g.prototype,"authoringAppVersion",null);c.__decorate([A.writer("authoringAppVersion")],g.prototype,"writeAuthoringAppVersion",null);c.__decorate([q.property({json:{write:{isRequired:!0,allowNull:!0,ignoreOrigin:!0,enabled:!0}}})],g.prototype,"ground",void 0);c.__decorate([A.writer("ground")],g.prototype,"writeGround",null);c.__decorate([q.property({type:w.ofType(Y),
json:{write:!0}})],g.prototype,"transportationNetworks",void 0);c.__decorate([q.property({type:V,nonNullable:!0,json:{write:{ignoreOrigin:!0,writer:(ka,ia,ea,ca)=>{ka.slides&&0<ka.slides.length&&(ia.presentation=ka.write({},{...ca,isPresentation:!0}))}}}})],g.prototype,"presentation",void 0);c.__decorate([q.property({type:W,nonNullable:!0,json:{write:{target:"initialState",isRequired:!0,ignoreOrigin:!0},default:()=>new W({viewingMode:"global",spatialReference:J.WebMercator})}})],g.prototype,"initialViewProperties",
void 0);c.__decorate([v.reader("initialViewProperties",["initialState.environment","spatialReference","viewingMode","initialState.viewpoint"])],g.prototype,"readInitialViewProperties",null);c.__decorate([q.property({type:J,json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],g.prototype,"spatialReference",null);c.__decorate([q.property({type:["local","global"],json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],g.prototype,"viewingMode",null);c.__decorate([q.property({type:M})],g.prototype,
"portalItem",void 0);c.__decorate([q.property()],g.prototype,"resourceInfo",void 0);g=c.__decorate([B.subclass("esri.WebScene")],g);var ha;(function(ka){ka[ka.SAVE=0]="SAVE";ka[ka.SAVE_AS=1]="SAVE_AS"})(ha||(ha={}));return g})},"esri/core/accessorSupport/originUtils":function(){define(["exports","../multiOriginJSONSupportUtils"],function(a,b){a.updateOrigins=function(c){c&&c.writtenProperties&&c.writtenProperties.forEach(d=>{const g=d.target;d.newOrigin&&d.oldOrigin!==d.newOrigin&&b.isMultiOriginJSONMixin(g)&&
g.updateOrigin(d.propName,d.newOrigin)})};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/multiOriginJSONSupportUtils":function(){define(["exports"],function(a){a.isMultiOriginJSONMixin=function(b){return b&&"getAtOrigin"in b&&"originOf"in b};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/support/MapFloorInfo":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ../layers/support/FacilityLayerInfo ../layers/support/LevelLayerInfo ../layers/support/SiteLayerInfo".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e){c=function(k){function r(y){y=k.call(this,y)||this;y.levelLayer=null;y.facilityLayer=null;y.siteLayer=null;return y}a._inheritsLoose(r,k);return r}(c.JSONSupport);b.__decorate([d.property({type:f,json:{write:!0}})],c.prototype,"levelLayer",void 0);b.__decorate([d.property({type:n,json:{write:!0}})],c.prototype,"facilityLayer",void 0);b.__decorate([d.property({type:e,json:{write:!0}})],c.prototype,"siteLayer",void 0);return c=b.__decorate([l.subclass("esri.support.MapFloorInfo")],
c)})},"esri/layers/support/FacilityLayerInfo":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,d,g,x,w,l){c=function(n){function f(e){e=n.call(this,e)||this;e.facilityIdField=null;e.layerId=null;e.nameField=null;e.siteIdField=null;e.sublayerId=null;return e}
a._inheritsLoose(f,n);return f}(c.JSONSupport);b.__decorate([d.property({type:String,json:{write:!0}})],c.prototype,"facilityIdField",void 0);b.__decorate([d.property({type:String,json:{write:!0}})],c.prototype,"layerId",void 0);b.__decorate([d.property({type:String,json:{write:!0}})],c.prototype,"nameField",void 0);b.__decorate([d.property({type:String,json:{write:!0}})],c.prototype,"siteIdField",void 0);b.__decorate([d.property({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},
origins:{"web-scene":{read:!1,write:!1}}}})],c.prototype,"sublayerId",void 0);return c=b.__decorate([l.subclass("esri.layers.support.FacilityLayerInfo")],c)})},"esri/layers/support/LevelLayerInfo":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,d,g,
x,w,l){c=function(n){function f(e){e=n.call(this,e)||this;e.facilityIdField=null;e.layerId=null;e.levelIdField=null;e.levelNumberField=null;e.longNameField=null;e.shortNameField=null;e.sublayerId=null;e.verticalOrderField=null;return e}a._inheritsLoose(f,n);return f}(c.JSONSupport);b.__decorate([d.property({type:String,json:{write:!0}})],c.prototype,"facilityIdField",void 0);b.__decorate([d.property({type:String,json:{write:!0}})],c.prototype,"layerId",void 0);b.__decorate([d.property({type:String,
json:{write:!0}})],c.prototype,"levelIdField",void 0);b.__decorate([d.property({type:String,json:{write:!0}})],c.prototype,"levelNumberField",void 0);b.__decorate([d.property({type:String,json:{write:!0}})],c.prototype,"longNameField",void 0);b.__decorate([d.property({type:String,json:{write:!0}})],c.prototype,"shortNameField",void 0);b.__decorate([d.property({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],c.prototype,"sublayerId",
void 0);b.__decorate([d.property({type:String,json:{write:!0}})],c.prototype,"verticalOrderField",void 0);return c=b.__decorate([l.subclass("esri.layers.support.LevelLayerInfo")],c)})},"esri/layers/support/SiteLayerInfo":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,d,g,x,w,l){c=function(n){function f(e){e=n.call(this,e)||this;e.layerId=null;e.nameField=null;e.siteIdField=null;e.sublayerId=null;return e}a._inheritsLoose(f,n);return f}(c.JSONSupport);b.__decorate([d.property({type:String,json:{write:!0}})],c.prototype,"layerId",void 0);b.__decorate([d.property({type:String,json:{write:!0}})],c.prototype,"nameField",void 0);b.__decorate([d.property({type:String,json:{write:!0}})],c.prototype,"siteIdField",void 0);b.__decorate([d.property({type:Number,
json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],c.prototype,"sublayerId",void 0);return c=b.__decorate([l.subclass("esri.layers.support.SiteLayerInfo")],c)})},"esri/support/webSceneUtils":function(){define(["exports","../core/Error"],function(a,b){a.createCopyError=function(){return new b("webscene:failed-to-copy-embedded-resources","Copying of embedded resources is currently not supported")};a.createSchemaValidationError=function(c){return new b("webscene:schema-validation",
"Failed to save webscene due to schema validation errors. See 'details.errors' for more detailed information",{errors:c})};a.isCopyError=function(c){return c&&"webscene:failed-to-copy-embedded-resources"===c.name};a.isSchemaValidationError=function(c){return c&&"webscene:schema-validation"===c.name};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/support/spatialReferenceSupport":function(){define(["exports","../../geometry/support/SupportedGCSWkids","../ViewingMode"],function(a,b,
c){a.isSpatialReferenceSupported=function(d,g){return null==d?!1:null==g?!0:g===c.ViewingMode.Local?d.isGeographic?d.isWGS84||d.wkid===b.SupportedGCSWkids.CGCS2000:!0:d.isWebMercator||d.isWGS84||d.wkid===b.SupportedGCSWkids.CGCS2000||d.wkid===b.SupportedGCSWkids.GCSMARS2000||d.wkid===b.SupportedGCSWkids.GCSMARS2000_SPHERE||d.wkid===b.SupportedGCSWkids.GCSMOON2000};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/webdoc/support/saveUtils":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/asyncUtils ../../core/Error ../../core/promiseUtils ../../core/uuid ../../portal/support/resourceUtils".split(" "),
function(a,b,c,d,g,x,w){function l(){l=b._asyncToGenerator(function*(r,y,p){if(y&&y.resources){var h=y.portalItem===r.portalItem?new Set(r.paths):new Set;r.paths.length=0;r.portalItem=y.portalItem;var m=new Set(y.resources.toKeep.map(q=>q.resource.path)),u=new Set,t=[];m.forEach(q=>{h.delete(q);r.paths.push(q)});for(const q of y.resources.toUpdate)if(h.delete(q.resource.path),m.has(q.resource.path)||u.has(q.resource.path)){const {resource:z,content:v,finish:B,error:A}=q,E=w.getSiblingOfSameTypeI(z,
x.generateUUID());r.paths.push(E.path);t.push(n({resource:E,content:v,finish:B,error:A},p))}else r.paths.push(q.resource.path),t.push(e(q,p)),u.add(q.resource.path);for(const q of y.resources.toAdd)t.push(n(q,p)),r.paths.push(q.resource.path);h.forEach(q=>{q=y.portalItem.resourceFromPath(q);t.push(q.portalItem.removeResource(q).catch(()=>{}))});if(0!==t.length&&(m=yield g.eachAlways(t),g.throwIfAborted(p),p=m.filter(q=>"error"in q).map(q=>q.error),0<p.length))throw new d("save:resources","Failed to save one or more resources",
{errors:p});}});return l.apply(this,arguments)}function n(r,y){return f.apply(this,arguments)}function f(){f=b._asyncToGenerator(function*(r,y){y=yield c.result(r.resource.portalItem.addResource(r.resource,r.content,y));if(!0===y.ok)r.finish&&r.finish(r.resource);else throw r.error&&r.error(y.error),y.error;});return f.apply(this,arguments)}function e(r,y){return k.apply(this,arguments)}function k(){k=b._asyncToGenerator(function*(r,y){y=yield c.result(r.resource.update(r.content,y));if(!0===y.ok)r.finish(r.resource);
else throw r.error(y.error),y.error;});return k.apply(this,arguments)}a.saveResources=function(r,y,p){return l.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/portal/support/resourceUtils":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../request ../../core/Error ../../core/maybe ../../core/urlUtils".split(" "),function(a,b,c,d,g,x){function w(){w=b._asyncToGenerator(function*(p,h={},m){yield p.load(m);var u=x.join(p.itemUrl,"resources");const {start:t=
1,num:q=10,sortOrder:z="asc",sortField:v="created"}=h;h={query:{start:t,num:q,sortOrder:z,sortField:v,token:p.apiKey},signal:g.get(m,"signal")};u=yield p.portal._request(u,h);return{total:u.total,nextStart:u.nextStart,resources:u.resources.map(({created:B,size:A,resource:E})=>({created:new Date(B),size:A,resource:p.resourceFromPath(E)}))}});return w.apply(this,arguments)}function l(){l=b._asyncToGenerator(function*(p,h,m,u){if(!p.hasPath())throw new d(`portal-item-resource-${h}:invalid-path`,"Resource does not have a valid path");
const t=p.portalItem;yield t.load(u);h=x.join(t.userItemUrl,"add"===h?"addResources":"updateResources");const [q,z]=e(p.path);m=yield r(m);const v=new FormData;q&&"."!==q&&v.append("resourcesPrefix",q);v.append("fileName",z);v.append("file",m,z);v.append("f","json");g.isSome(u)&&u.access&&v.append("access",u.access);yield t.portal._request(h,{method:"post",body:v,signal:g.get(u,"signal")});return p});return l.apply(this,arguments)}function n(){n=b._asyncToGenerator(function*(p,h,m){if(!h.hasPath())throw new d("portal-item-resources-remove:invalid-path",
"Resource does not have a valid path");yield p.load(m);const u=x.join(p.userItemUrl,"removeResources");yield p.portal._request(u,{method:"post",query:{resource:h.path},signal:g.get(m,"signal")});h.portalItem=null});return n.apply(this,arguments)}function f(){f=b._asyncToGenerator(function*(p,h){yield p.load(h);const m=x.join(p.userItemUrl,"removeResources");return p.portal._request(m,{method:"post",query:{deleteAll:!0},signal:g.get(h,"signal")})});return f.apply(this,arguments)}function e(p){const h=
p.lastIndexOf("/");return-1===h?[".",p]:[p.slice(0,h),p.slice(h+1)]}function k(p){{const q=x.getPathExtension(p);p=g.isNone(q)?[p,""]:[p.slice(0,p.length-q.length-1),`.${q}`]}const [h,m]=p,[u,t]=e(h);return[u,t,m]}function r(p){return y.apply(this,arguments)}function y(){y=b._asyncToGenerator(function*(p){return p instanceof Blob?p:(yield c(p.url,{responseType:"blob"})).data});return y.apply(this,arguments)}a.addOrUpdateResource=function(p,h,m,u){return l.apply(this,arguments)};a.contentToBlob=r;
a.fetchResources=function(p){return w.apply(this,arguments)};a.getSiblingOfSameType=function(p,h){if(!p.hasPath())return null;const [m,,u]=k(p.path);return p.portalItem.resourceFromPath(x.join(m,h+u))};a.getSiblingOfSameTypeI=function(p,h){if(!p.hasPath())return null;const [m,,u]=k(p.path);return p.portalItem.resourceFromPath(x.join(m,h+u))};a.removeAllResources=function(p,h){return f.apply(this,arguments)};a.removeResource=function(p,h,m){return n.apply(this,arguments)};a.splitPrefixFileNameAndExtension=
k;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/webdoc/support/thumbnailUtils":function(){define(["exports"],function(a){const b={width:600,height:400};a.getOptimalThumbnailSize=function(c,d){d=d||b;let {width:g,height:x}=d;d=g/x;1.5>d?x=g/1.5:1.5<d&&(g=1.5*x);g>c.width&&(x*=c.width/g,g=c.width);x>c.height&&(g*=c.height/x,x=c.height);return{width:Math.round(g),height:Math.round(x)}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/webscene/ApplicationProperties":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ../webdoc/applicationProperties/Viewing".split(" "),
function(a,b,c,d,g,x,w,l,n){var f;c=f=function(e){function k(r){r=e.call(this,r)||this;r.viewing=null;return r}a._inheritsLoose(k,e);k.prototype.clone=function(){return new f({viewing:this.viewing?this.viewing.clone():null})};return k}(c.JSONSupport);b.__decorate([d.property({type:n,json:{write:!0}})],c.prototype,"viewing",void 0);return c=f=b.__decorate([l.subclass("esri.webscene.ApplicationProperties")],c)})},"esri/webdoc/applicationProperties/Viewing":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ./Search".split(" "),
function(a,b,c,d,g,x,w,l){var n;c=n=function(f){function e(k){k=f.call(this,k)||this;k.search=null;return k}a._inheritsLoose(e,f);e.prototype.clone=function(){return new n(d.clone({search:this.search}))};return e}(c.JSONSupport);b.__decorate([g.property({type:l,json:{write:!0}})],c.prototype,"search",void 0);return c=n=b.__decorate([w.subclass("esri.webdoc.applicationProperties.Viewing")],c)})},"esri/webdoc/applicationProperties/Search":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Collection ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/extensions/serializableProperty/writePolicyUtils ./SearchLayer ./SearchTable".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r){var y;const p=c.ofType(k),h=c.ofType(r);c=y=function(m){function u(q){q=m.call(this,q)||this;q.addressSearchEnabled=!0;q.enabled=!0;q.hintText=null;q.layers=new p;q.tables=new h;return q}a._inheritsLoose(u,m);var t=u.prototype;t.readAddressSearchEnabled=function(q){return!q};t.writeAddressSearchEnabled=function(q,z,v){z[v]=!q};t.clone=function(){return new y(g.clone({addressSearchEnabled:this.addressSearchEnabled,enabled:this.enabled,hintText:this.hintText,layers:this.layers,
tables:this.tables}))};return u}(d.JSONSupport);b.__decorate([x.property({type:Boolean,nonNullable:!0,json:{read:{source:"disablePlaceFinder"},write:{target:"disablePlaceFinder",isRequired:!0},origins:{"web-scene":{read:!1,write:!1}}}})],c.prototype,"addressSearchEnabled",void 0);b.__decorate([l.reader("addressSearchEnabled")],c.prototype,"readAddressSearchEnabled",null);b.__decorate([f.writer("addressSearchEnabled")],c.prototype,"writeAddressSearchEnabled",null);b.__decorate([x.property({type:Boolean,
nonNullable:!0,json:{write:!0,origins:{"web-map":{write:{isRequired:!0}},"web-scene":{default:!0,write:!0}}}})],c.prototype,"enabled",void 0);b.__decorate([x.property({type:String,json:{write:!0}})],c.prototype,"hintText",void 0);b.__decorate([x.property({type:p,json:{write:{overridePolicy:e.writeNonEmptyCollectionPolicy},origins:{"web-scene":{write:{isRequired:!0}}}}})],c.prototype,"layers",void 0);b.__decorate([x.property({type:h,json:{read:!0,write:{overridePolicy:e.writeNonEmptyCollectionPolicy}}})],
c.prototype,"tables",void 0);return c=y=b.__decorate([n.subclass("esri.webdoc.applicationProperties.Search")],c)})},"esri/core/accessorSupport/extensions/serializableProperty/writePolicyUtils":function(){define(["exports"],function(a){a.writeNonEmptyCollectionPolicy=function(b){return{enabled:!(null==b||!b.length)}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/webdoc/applicationProperties/SearchLayer":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ./SearchLayerField".split(" "),
function(a,b,c,d,g,x,w,l){var n;c=n=function(f){function e(k){k=f.call(this,k)||this;k.field=null;k.id=null;k.subLayer=null;return k}a._inheritsLoose(e,f);e.prototype.clone=function(){return new n(d.clone({field:this.field,id:this.id,subLayer:this.subLayer}))};return e}(c.JSONSupport);b.__decorate([g.property({type:l,json:{write:{isRequired:!0}}})],c.prototype,"field",void 0);b.__decorate([g.property({type:String,json:{write:{isRequired:!0}}})],c.prototype,"id",void 0);b.__decorate([g.property({type:x.Integer,
json:{write:!0}})],c.prototype,"subLayer",void 0);return c=n=b.__decorate([w.subclass("esri.webdoc.applicationProperties.SearchLayer")],c)})},"esri/webdoc/applicationProperties/SearchLayerField":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ../../layers/support/fieldType".split(" "),
function(a,b,c,d,g,x,w,l,n,f){var e;c=e=function(k){function r(y){y=k.call(this,y)||this;y.exactMatch=!1;y.name=null;y.type=null;return y}a._inheritsLoose(r,k);r.prototype.clone=function(){return new e({exactMatch:this.exactMatch,type:this.type,name:this.name})};return r}(c.JSONSupport);b.__decorate([d.property({type:Boolean,json:{write:!0}})],c.prototype,"exactMatch",void 0);b.__decorate([d.property({type:String,json:{write:!0}})],c.prototype,"name",void 0);b.__decorate([l.enumeration(f.kebabDict)],
c.prototype,"type",void 0);return c=e=b.__decorate([n.subclass("esri.webdoc.applicationProperties.SearchLayerField")],c)})},"esri/webdoc/applicationProperties/SearchTable":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ./SearchTableField".split(" "),function(a,b,c,d,g,x,w,l){var n;c=n=function(f){function e(k){k=
f.call(this,k)||this;k.field=null;k.id=null;return k}a._inheritsLoose(e,f);e.prototype.clone=function(){return new n(d.clone({field:this.field,id:this.id}))};return e}(c.JSONSupport);b.__decorate([g.property({type:l,json:{write:{isRequired:!0}}})],c.prototype,"field",void 0);b.__decorate([g.property({type:String,json:{write:{isRequired:!0}}})],c.prototype,"id",void 0);return c=n=b.__decorate([w.subclass("esri.webdoc.applicationProperties.SearchTable")],c)})},"esri/webdoc/applicationProperties/SearchTableField":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ../../layers/support/fieldType".split(" "),
function(a,b,c,d,g,x,w,l,n,f){var e;c=e=function(k){function r(y){y=k.call(this,y)||this;y.exactMatch=!1;y.name=null;y.type=null;return y}a._inheritsLoose(r,k);r.prototype.clone=function(){return new e({exactMatch:this.exactMatch,type:this.type,name:this.name})};return r}(c.JSONSupport);b.__decorate([d.property({type:Boolean,json:{write:!0}})],c.prototype,"exactMatch",void 0);b.__decorate([d.property({type:String,json:{write:!0}})],c.prototype,"name",void 0);b.__decorate([l.enumeration(f.kebabDict)],
c.prototype,"type",void 0);return c=e=b.__decorate([n.subclass("esri.webdoc.applicationProperties.SearchTableField")],c)})},"esri/webscene/Environment":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ./Lighting ./background/utils".split(" "),function(a,b,c,d,g,x,w,l,n){var f;x=(e,k,r)=>({enabled:!r||!r.isPresentation});
c=f=function(e){function k(y){y=e.call(this,y)||this;y.lighting=new l;y.background=null;y.atmosphereEnabled=!0;y.starsEnabled=!0;return y}a._inheritsLoose(k,e);var r=k.prototype;r.clone=function(){return new f(this.cloneConstructProperties())};r.cloneConstructProperties=function(){return{lighting:l.prototype.clone.call(this.lighting),background:d.clone(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled}};return k}(c.JSONSupport);b.__decorate([g.property({type:l,
json:{write:!0}})],c.prototype,"lighting",void 0);b.__decorate([g.property(n.backgroundProperty)],c.prototype,"background",void 0);b.__decorate([g.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:x}}})],c.prototype,"atmosphereEnabled",void 0);b.__decorate([g.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:x}}})],c.prototype,"starsEnabled",void 0);return c=f=b.__decorate([w.subclass("esri.webscene.Environment")],c)})},"esri/webscene/Lighting":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer".split(" "),
function(a,b,c,d,g,x,w,l,n,f){var e;c=e=function(k){function r(p){p=k.call(this,p)||this;p.date=null;p.directShadowsEnabled=!1;p.displayUTCOffset=null;return p}a._inheritsLoose(r,k);var y=r.prototype;y.readDate=function(p,h){return null!=h.datetime&&new Date(h.datetime)||null};y.writeDate=function(p,h,m){h[m]=p.getTime()};y.readDirectShadowsEnabled=function(p,h){return!!h.directShadows};y.writedirectShadowsEnabled=function(p,h,m){p&&(h[m]=p)};y.writeDisplayUTCOffset=function(p,h){null!=p&&(h.displayUTCOffset=
p)};y.clone=function(){return new e(this.cloneConstructProperties())};y.cloneConstructProperties=function(){const p={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null};null!=this.date&&(p.date=new Date(this.date.getTime()));return p};return r}(c.JSONSupport);b.__decorate([d.property({type:Date,json:{type:Number,write:{target:"datetime"}}})],c.prototype,"date",void 0);b.__decorate([l.reader("date",["datetime"])],c.prototype,"readDate",
null);b.__decorate([f.writer("date")],c.prototype,"writeDate",null);b.__decorate([d.property({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],c.prototype,"directShadowsEnabled",void 0);b.__decorate([l.reader("directShadowsEnabled",["directShadows"])],c.prototype,"readDirectShadowsEnabled",null);b.__decorate([f.writer("directShadowsEnabled")],c.prototype,"writedirectShadowsEnabled",null);b.__decorate([d.property({type:Number,json:{write:!0}})],c.prototype,"displayUTCOffset",void 0);
b.__decorate([f.writer("displayUTCOffset")],c.prototype,"writeDisplayUTCOffset",null);return c=e=b.__decorate([n.subclass("esri.webscene.Lighting")],c)})},"esri/webscene/background/utils":function(){define(["exports","./Background","./ColorBackground"],function(a,b,c){b={base:b,key:"type",typeMap:{color:c}};b={types:b,json:{read:function(d){return(g,x,w)=>{if(!g)return g;for(const l in d.typeMap)if(g.type===l)return x=new d.typeMap[l],x.read(g,w),x}}(b),write:{overridePolicy:(d,g,x)=>({enabled:!x||
!x.isPresentation})}}};a.backgroundProperty=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/webscene/background/Background":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,d,g,x,w,l){c=function(n){function f(e){return n.call(this,e)||this}
a._inheritsLoose(f,n);f.prototype.clone=function(){};return f}(c.JSONSupport);b.__decorate([d.property({readOnly:!0,json:{read:!1}})],c.prototype,"type",void 0);return c=b.__decorate([l.subclass("esri.webscene.background.Background")],c)})},"esri/webscene/background/ColorBackground":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Color ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ../../symbols/support/materialUtils ./Background".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e){var k;g={...f.colorAndTransparencyProperty,nonNullable:!0};e=k=function(r){function y(h){h=r.call(this,h)||this;h.type="color";h.color=new c([0,0,0,1]);return h}a._inheritsLoose(y,r);var p=y.prototype;p.clone=function(){return new k(this.cloneProperties())};p.cloneProperties=function(){return{color:this.color.clone()}};return y}(e);b.__decorate([l.enumeration({color:"color"},{readOnly:!0})],e.prototype,"type",void 0);b.__decorate([d.property(g)],e.prototype,"color",
void 0);return e=k=b.__decorate([n.subclass("esri.webscene.background.ColorBackground")],e)})},"esri/webscene/InitialViewProperties":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../Viewpoint ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ../geometry/SpatialReference ./Environment".split(" "),function(a,b,c,d,g,x,w,l,n,f,e){var k;d=k=function(r){function y(p){p=
r.call(this,p)||this;p.environment=new e;p.spatialReference=null;p.viewpoint=null;return p}a._inheritsLoose(y,r);y.prototype.clone=function(){return new k({environment:this.environment.clone(),spatialReference:this.spatialReference?this.spatialReference.clone():null,viewingMode:this.viewingMode,viewpoint:this.viewpoint?this.viewpoint.clone():null})};a._createClass(y,[{key:"viewingMode",set:function(p){this._set("viewingMode",p)}}]);return y}(d.JSONSupport);b.__decorate([g.property({type:e,json:{write:{isRequired:!0}}})],
d.prototype,"environment",void 0);b.__decorate([g.property({type:f})],d.prototype,"spatialReference",void 0);b.__decorate([g.property({type:["local","global"]})],d.prototype,"viewingMode",null);b.__decorate([g.property({type:c,json:{write:{isRequired:!0}}})],d.prototype,"viewpoint",void 0);return d=k=b.__decorate([n.subclass("esri.webscene.InitialViewProperties")],d)})},"esri/webscene/Presentation":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/Collection ../core/collectionUtils ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/cast ../core/accessorSupport/decorators/subclass ./Slide".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e){const k=c.ofType(e);c=function(r){function y(h){h=r.call(this,h)||this;h.slides=new k;return h}a._inheritsLoose(y,r);var p=y.prototype;p.destroy=function(){this.slides.forEach(h=>h.destroy());this.slides.removeAll()};p.clone=function(){return new this.constructor({slides:this.slides.clone()})};a._createClass(y,[{key:"slides",set:function(h){h&&(h=h.filter(m=>!!m.viewpoint));this._set("slides",d.referenceSetter(h,this._get("slides"),k))}}]);return y}(g.JSONSupport);
b.__decorate([x.property({type:k,nonNullable:!0,json:{write:!0}}),n.cast(d.castForReferenceSetter)],c.prototype,"slides",null);return c=b.__decorate([f.subclass("esri.webscene.Presentation")],c)})},"esri/webscene/Slide":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../Basemap ../Viewpoint ../core/asyncUtils ../core/Collection ../core/collectionUtils ../core/JSONSupport ../core/Logger ../core/maybe ../core/promiseUtils ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/cast ../core/accessorSupport/decorators/subclass ../core/accessorSupport/ensureType ../chunks/vec3 ../chunks/vec3f64 ../layers/Layer ../layers/mixins/OperationalLayer ../support/basemapUtils ../views/3d/support/mathUtils ../views/3d/support/viewpointUtils ../views/support/Scheduler ../webdoc/support/SlideThumbnail ./Lighting ./support/Description ./support/SlideEnvironment ./support/SlideGround ./support/SlideVisibleLayer ./support/Title".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E,C,D,F,G,J,I,O){function P(N){if("building-scene"===N.type||"map-image"===N.type)return N.allSublayers.toArray()}function K(N){if(N=P(N))return N.filter(T=>T.visible).map(T=>T.id)}function M(N,T){N=T-N;43200<N&&(N-=86400);-43200>N&&(N+=86400);return N}let U=0;const R=x.ofType(I.SlideVisibleLayer),L=n.getLogger("esri.webscene.Slide");l=function(N){function T(H){H=N.call(this,H)||this;H.id=Date.now().toString(16)+"-slide-"+U++;H.title=new O;
H.description=new F;H.thumbnail=new C.SlideThumbnail;H.viewpoint=null;H.basemap=null;H.ground=null;H.environment=new G.SlideEnvironment;H.visibleLayers=new R;return H}a._inheritsLoose(T,N);var S=T.prototype;S.destroy=function(){this.visibleLayers.removeAll();this.basemap=null;this.thumbnail&&this.thumbnail.destroy();this.thumbnail=this.title=this.description=null};S.castTitle=function(H){return"string"===typeof H?new O({text:H}):m.ensureType(O,H)};S.castDescription=function(H){return"string"===typeof H?
new F({text:H}):m.ensureType(F,H)};S.castThumbnail=function(H){return"string"===typeof H?new C.SlideThumbnail({url:H}):m.ensureType(C.SlideThumbnail,H)};S.castBasemap=function(H){return v.ensureType(H)};S.castVisibleLayers=function(H){return H&&"function"===typeof H.map?H.map(Q=>{if("string"===typeof Q)return{id:Q};if(Q instanceof q){const W=K(Q);return{id:Q.id,sublayerIds:W}}if(Q.id)return{id:Q.id,sublayerIds:Q.sublayerIds};L.warn('Invalid visible layer, expected { id }, Layer or "id"');return Q}):
null};S.clone=function(){return new this.constructor({id:this.id,title:this.title.clone(),thumbnail:this.thumbnail.clone(),description:this.description&&this.description.clone()||null,viewpoint:this.viewpoint&&this.viewpoint.clone()||null,basemap:this.basemap&&this.basemap.clone()||null,ground:this.ground&&this.ground.clone()||null,visibleLayers:this.visibleLayers.clone(),environment:this.environment&&this.environment.clone()||null})};S._updateVisibleLayersFrom=function(H){const Q=[];return e.eachAlways(this._getLayers(H.map).map(W=>
H.whenLayerView(W).then(V=>{if(V.visible){const Y=K(W);Q.push(new I.SlideVisibleLayer({id:V.layer.id,sublayerIds:Y}))}})).toArray()).then(()=>{this.visibleLayers.removeAll();this.visibleLayers.addMany(Q)})};S.updateFrom=function(H,Q){Q={screenshot:{format:"png",quality:80,width:120,height:75,disableDecorations:!0,...Q&&Q.screenshot}};return H.when(()=>{this.viewpoint=H.viewpoint.clone();this.environment.lighting=D.prototype.clone.apply(H.environment.lighting);this.basemap=H.map.basemap&&H.map.basemap.clone()||
null;this.ground=H.map.ground?J.fromGround(H.map.ground):null;return this._updateVisibleLayersFrom(H)}).then(()=>H.takeScreenshot(Q.screenshot)).then(W=>{this.thumbnail=new C.SlideThumbnail({url:W.dataUrl});return this})};S.applyTo=function(){var H=a._asyncToGenerator(function*(Q,W){var V=this;f.isSome(this._applyToController)&&this._applyToController.abort();let Y=new AbortController;this._applyToController=Y;const aa=e.onAbortOrThrow(W,()=>Y.abort()),X=Q.resourceController.scheduler.registerTask(E.TaskPriority.SLIDE);
let ba=!1;W={animate:!0,...W,signal:this._applyToController.signal};var ha=function(){var ka=a._asyncToGenerator(function*(){yield e.all([X.schedule(()=>ba=V._setViewpointOfInterest(Q,W)),X.schedule(()=>V._applyBasemap(Q,W),W.signal)]);yield e.all([X.schedule(()=>V._applyLayerVisibility(Q),W.signal),X.schedule(()=>V._applyGround(Q),W.signal),X.schedule(()=>V._applyViewpoint(Q,W),W.signal)])});return function(){return ka.apply(this,arguments)}}();ha=yield g.result(Q.addUpdatingPromise(ha()));ba&&(Q.contentCamera=
null);X.remove();this._applyToController===Y&&(this._applyToController=null);Y=null;null==aa?void 0:aa.remove();if(!1===ha.ok)throw ha.error;return this});return function(Q,W){return H.apply(this,arguments)}}();S._applyBasemap=function(){var H=a._asyncToGenerator(function*(Q,W){if(this.basemap){try{yield this.basemap.load(W)}catch(V){if(e.isAbortError(V))throw V;}Q.map.basemap=v.clonePreservingTiledLayers(this.basemap,Q.map.basemap)}});return function(Q,W){return H.apply(this,arguments)}}();S._applyGround=
function(H){this.ground&&(H.map.ground=this.ground.cloneAndApplyTo(H.map.ground))};S._getLayers=function(H){const Q=new x;this._collectLayers(H,Q);this._collectLayers(H.ground,Q);return Q};S._collectLayers=function(H,Q){H.layers.forEach(W=>{z.isOperationalLayer(W)&&(Q.add(W),"layers"in W&&this._collectLayers(W,Q))})};S._applyLayerVisibility=function(H){this.visibleLayers&&this._getLayers(H.map).forEach(Q=>{var W=this.visibleLayers.find(Y=>Y.id===Q.id);Q.visible=null!=W;const V=W&&W.sublayerIds;W=
P(Q);V&&W&&W.forEach(Y=>Y.visible=0<=V.indexOf(Y.id))})};S._setViewpointOfInterest=function(H,Q){if(H.state.fixedContentCamera||!this.viewpoint||Q.ignoreViewpoint||!Q.useDestinationCamera)return!1;Q=A.toCamera(H,this.viewpoint);H.contentCamera=Q;return f.isSome(Q)};S._applyViewpoint=function(){var H=a._asyncToGenerator(function*(Q,W){if(this.viewpoint&&!W.ignoreViewpoint){f.isSome(this.viewpoint.camera)&&(this.viewpoint.camera.fov=Q.camera.fov);if(W.animate&&this.get("environment.lighting.date")){yield this._animateToLighting(Q,
W);return}W.animate&&(Q.environment.applyLighting(this.environment.lighting.clone()),yield Q.goTo(this.viewpoint,W));Q.viewpoint=this.viewpoint}Q.environment.applyLighting(this.environment.lighting.clone())});return function(Q,W){return H.apply(this,arguments)}}();S._animateToLighting=function(){var H=a._asyncToGenerator(function*(Q,W){let V=null;"sun"===Q.environment.lighting.type&&("global"===Q.viewingMode&&(V=this._animateLightingWithCamera(Q)),Q.environment.lighting.cameraTrackingEnabled=!1);
Q.environment.lighting.directShadowsEnabled=this.environment.lighting.directShadowsEnabled;null!=this.environment.lighting.displayUTCOffset&&"sun"===Q.environment.lighting.type&&(Q.environment.lighting.displayUTCOffset=this.environment.lighting.displayUTCOffset);const Y=()=>{V&&V.remove();"sun"===Q.environment.lighting.type&&(Q.environment.lighting.cameraTrackingEnabled=!0)};return Q.goTo(this.viewpoint,W).then(()=>{Q.environment.applyLighting(this.environment.lighting.clone());Y()},aa=>{Y();throw aa;
})});return function(Q,W){return H.apply(this,arguments)}}();S._getTime=function(H){const Q=H.getTime();H=3600*H.getUTCHours()+60*H.getUTCMinutes()+H.getUTCSeconds();return[Q,H]};S._setTime=function(H,Q,W){H.setTime(Q);H.setUTCHours(W/3600);H.setUTCMinutes(W%3600/60);H.setUTCSeconds(W%3600%60);return H};S._animateLightingWithCamera=function(H){const [Q,W]=this._getTime(new Date(H.environment.lighting.date.toString())),[V,Y]=this._getTime(this.environment.lighting.date),aa=M(W,Y),X=H.renderCoordsHelper,
ba=t.create();X.toRenderCoords(H.camera.position,ba);const ha=t.create(),ka=t.create();f.isSome(this.viewpoint.camera)&&X.toRenderCoords(this.viewpoint.camera.position,ha);const ia=new Date;return H.watch("camera",ea=>{X.toRenderCoords(ea.position,ka);var ca=u.squaredDistance(ba,ka);const Z=u.squaredDistance(ha,ka);ea=0;0!==ca+Z&&(ea=ca/(ca+Z));ca=Q+(V-Q)*ea;ea=B.moduloPositive(W+aa*ea,86400);H.environment.lighting.date=this._setTime(ia,ca,ea)})};T.createFrom=function(H,Q){return(new this).updateFrom(H,
Q)};a._createClass(T,[{key:"visibleLayers",set:function(H){this._set("visibleLayers",w.referenceSetter(H,this._get("visibleLayers"),R))}}]);return T}(l.JSONSupport);b.__decorate([k.property({type:String,json:{write:{isRequired:!0}}})],l.prototype,"id",void 0);b.__decorate([k.property({type:O,json:{default:()=>new O({text:""}),write:{isRequired:!0}}})],l.prototype,"title",void 0);b.__decorate([p.cast("title")],l.prototype,"castTitle",null);b.__decorate([k.property({type:F,json:{write:{overridePolicy(N){return{enabled:!(!N||
!N.text)}}}}})],l.prototype,"description",void 0);b.__decorate([p.cast("description")],l.prototype,"castDescription",null);b.__decorate([k.property({type:C.SlideThumbnail,json:{default:()=>new C.SlideThumbnail({url:""}),write:{isRequired:!0}}})],l.prototype,"thumbnail",void 0);b.__decorate([p.cast("thumbnail")],l.prototype,"castThumbnail",null);b.__decorate([k.property({type:d,nonNullable:!0,json:{write:{isRequired:!0}}})],l.prototype,"viewpoint",void 0);b.__decorate([k.property({type:c,json:{read:{source:"baseMap"},
write:{target:"baseMap"}}})],l.prototype,"basemap",void 0);b.__decorate([p.cast("basemap")],l.prototype,"castBasemap",null);b.__decorate([k.property({type:J,json:{write:!0}})],l.prototype,"ground",void 0);b.__decorate([k.property({type:R,json:{write:{isRequired:!0}}})],l.prototype,"visibleLayers",null);b.__decorate([p.cast("visibleLayers")],l.prototype,"castVisibleLayers",null);b.__decorate([k.property({type:G.SlideEnvironment,json:{write:!0}})],l.prototype,"environment",void 0);return l=b.__decorate([h.subclass("esri.webscene.Slide")],
l)})},"esri/views/3d/support/viewpointUtils":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../Camera ../../../geometry ../../../Graphic ../../../Viewpoint ../../../core/asyncUtils ../../../core/has ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../chunks/mat3 ../../../chunks/mat3f64 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/frustum ../../../geometry/support/webMercatorUtils ../camera/intersectionUtils ./cameraUtils ./ElevationProvider ./mathUtils ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/Extent ../../../geometry/Geometry".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E,C,D,F,G){function J(na){return 360-E.cyclicalDeg.normalize(na)}function I(na){return E.cyclicalDeg.normalize(360-na)}function O(na){f.isSome(na)&&na.resolver&&na.resolver.reject();return null}function P(na,qa,ta,Fa=null){if(!qa)return O(Fa);var Ha=na.spatialReference||D.WGS84;if(f.isSome(qa.camera)){na=z.project(qa.camera.position,Ha);if(f.isNone(na))return O(Fa);qa=qa.camera.clone();qa.position=na;na=qa;f.isSome(Fa)&&Fa.resolver&&Fa.resolver.resolve(na);
return na}if(f.isNone(qa.targetGeometry))return O(Fa);var Ka=qa.get("targetGeometry.spatialReference");if(Ka&&!z.canProject(Ka,Ha))return O(Fa);Ha=B.internalToExternal(na,na.state.camera);Ka=B.OrientationMode.ADJUST;null!=qa.rotation&&(Ha.heading=J(qa.rotation),Ka=B.OrientationMode.LOCKED);null!=ta&&(Ha.tilt=ta);if("point"===qa.targetGeometry.type){const La=qa.targetGeometry;ta=qa.targetGeometry.clone();qa=null!=qa.scale?B.scaleToDistance(na,qa.scale,La.latitude):na.state.camera.distance;return B.fromCenterDistance(na,
ta,qa,Ha,Ka,Fa)}return B.fromExtent(na,qa.targetGeometry.extent,Ha.heading,Ha.tilt,Ka,Fa)}function K(){K=b._asyncToGenerator(function*(na,qa,ta){if(qa&&na.spatialReference){var Fa={target:null};if("declaredClass"in qa||Array.isArray(qa))Fa.target=qa;else{for(var Ha in qa)Fa[Ha]=qa[Ha];qa.center&&!Fa.target&&(Fa.target=qa.center)}qa=Fa}else qa=null;if(!qa)throw new n("viewpointutils-create:no-target","Missing target for creating viewpoint");Fa=new c({fov:na.camera.fov});Ha=new x({camera:Fa});if(qa.target instanceof
x)return na=yield Q(na,qa.target,qa,ta,Ha),ca(na);if(qa.target instanceof c)return ca(V(na,qa.target,Ha));var Ka=null!=qa.scale||null!=qa.zoom;if(qa.target instanceof F){var La=qa.target.xmin===qa.target.xmax||qa.target.ymin===qa.target.ymax;return Ka||La?ca(yield Y(na,qa,qa.target.center,Fa,ta,Ha)):ca(yield ha(na,qa,qa.target,Fa,ta,Ha))}La={boundingBox:u.empty(),hasZ:!1,screenSpaceObjects:[]};var Ra=Ka?B.scaleToResolution(na,M(na,qa)):void 0;yield S(na,qa.target,Ra,La);if(isFinite(La.boundingBox[0])){u.center(La.boundingBox,
Z);pa.x=Z[0];pa.y=Z[1];pa.z=Z[2];pa.spatialReference=na.spatialReference;isFinite(pa.z)&&La.hasZ?Ra=u.isPoint(La.boundingBox):(pa.z=void 0,Ra=t.isPoint(u.toRect(La.boundingBox,ma)));if(Ka||Ra)return ca(yield Y(na,qa,pa,Fa,ta,Ha));Ka=La.screenSpaceObjects;if(Ka.length){Ra=Number.NEGATIVE_INFINITY;for(let ab=0;ab<Ka.length;ab++){const Za=Ka[ab].screenSpaceBoundingRect;Ra=Math.max(Ra,Math.abs(Za[0]),Math.abs(Za[1]),Math.abs(Za[2]),Math.abs(Za[3]))}Ka=.66-Ra/Math.min(na.width,na.height)*2}else Ka=.66;
return ca(yield ia(na,qa,pa,La.boundingBox,Ka,Fa,ta,Ha))}return qa.position?(ta=v.cameraOnContentAlongViewDirection(na),p.copy(ra,ta.viewForward),B.directionToHeadingTilt(na,ta.eye,ra,ta.up,za),Fa.position=new C(qa.position),Fa.heading=null!=qa.heading?qa.heading:za.heading,Fa.tilt=null!=qa.tilt?qa.tilt:za.tilt,na=R(na,null,Fa,Ha),ca(na)):ca(yield X(na,qa,Fa,ta,Ha))});return K.apply(this,arguments)}function M(na,qa){return null==qa.scale&&null!=qa.zoom?B.zoomToScale(na,qa.zoom):qa.scale}function U(na,
qa){let ta=!1;null!=qa.heading?(na.heading=qa.heading,ta=!0):null!=qa.rotation&&(na.heading=J(qa.rotation),ta=!0);null!=qa.tilt&&(na.tilt=qa.tilt,ta=!0);null!=qa.fov&&(na.fov=qa.fov);return ta}function R(na,qa,ta,Fa){const Ha=na.spatialReference||D.WGS84;qa=f.isSome(qa)?qa:B.externalToInternal(na,ta);if(f.isNone(qa))return Fa;Fa.targetGeometry=m.projectVectorToPoint(qa.center,na.renderSpatialReference,Ha);Fa.scale=B.computeScale(na,qa);Fa.rotation=I(ta.heading);Fa.camera=ta;return Fa}function L(na,
qa,ta){if(qa){if(!z.canProject(qa.spatialReference,na.spatialReference))throw new n("viewpointutils:incompatible-spatialreference",`Spatial reference (${qa.spatialReference?qa.spatialReference.wkid:"unknown"}) is incompatible with the view (${na.spatialReference.wkid})`,{geometry:qa});var Fa=[];if(!qa.hasZ&&na.basemapTerrain){switch(qa.type){case "point":var Ha=qa;break;case "multipoint":case "polyline":Ha=qa.extent.center;break;case "mesh":Ha=qa.origin;break;case "extent":Ha=qa.center;break;case "polygon":Ha=
qa.centroid}Ha&&z.canProject(Ha,na.basemapTerrain.spatialReference)?Z[2]=f.unwrapOr(A.getElevationAtPoint(na.elevationProvider,Ha),0):Z[2]=0}(0,wa[qa.type])(qa,La=>{Fa.push(La[0],La[1],La[2])},Z);var Ka=Fa.length/3;if(0!==Ka&&(Ha=Array(Fa.length),m.projectBuffer(Fa,qa.spatialReference,0,Ha,na.spatialReference,0,Ka)))for(qa.hasZ&&(ta.hasZ=!0),na=0;na<Ha.length;na+=3)qa.hasZ?(Z[0]=Ha[na+0],Z[1]=Ha[na+1],Z[2]=Ha[na+2]):(Z[0]=Ha[na+0],Z[1]=Ha[na+1]),u.expandWithVec3(ta.boundingBox,Z)}}function N(na,qa,
ta,Fa){return T.apply(this,arguments)}function T(){T=b._asyncToGenerator(function*(na,qa,ta,Fa){const Ha=yield w.result(na.whenViewForGraphic(qa));if(!1!==Ha.ok&&!f.isNone(Ha.value)&&"whenGraphicBounds"in Ha.value)if(ta=yield w.result(Ha.value.whenGraphicBounds(qa,{minDemResolution:ta})),!1===ta.ok)L(na,qa.geometry,Fa);else{var {screenSpaceObjects:Ka,boundingBox:La}=ta.value;u.expandWithAABB(Fa.boundingBox,La);Ka&&Ka.forEach(Ra=>{Fa.screenSpaceObjects.push(Ra)});isFinite(La[2])&&(Fa.hasZ=!0)}else L(na,
qa.geometry,Fa)});return T.apply(this,arguments)}function S(na,qa,ta,Fa){return H.apply(this,arguments)}function H(){H=b._asyncToGenerator(function*(na,qa,ta,Fa){if(Array.isArray(qa)&&2===qa.length){const Ha=qa[0],Ka=qa[1];if("number"===typeof Ha&&"number"===typeof Ka){pa.x=Ha;pa.y=Ka;pa.z=void 0;pa.spatialReference=na.spatialReference.isGeographic?na.spatialReference:D.WGS84;L(na,pa,Fa);return}}qa&&"function"===typeof qa.map?yield e.eachAlways(qa.map(Ha=>S(na,Ha,ta,Fa))):qa instanceof G?L(na,qa,
Fa):qa instanceof g&&(yield N(na,qa,ta,Fa))});return H.apply(this,arguments)}function Q(na,qa,ta,Fa,Ha){return W.apply(this,arguments)}function W(){W=b._asyncToGenerator(function*(na,qa,ta,Fa,Ha){if(f.isSome(qa.camera))return V(na,qa.camera,Ha);Ha.scale=qa.scale;Ha.rotation=qa.rotation;Ha.targetGeometry=f.isSome(qa.targetGeometry)?qa.targetGeometry.clone():null;Ha.camera=null;null!=ta.heading?Ha.rotation=I(ta.heading):null!=ta.rotation&&(Ha.rotation=ta.rotation);qa=M(na,ta);null!=qa&&(Ha.scale=qa);
Fa=new B.AsyncContext(Fa);P(na,Ha,ta.tilt,Fa);Ha.camera=yield Fa.resolver.promise;return Ha});return W.apply(this,arguments)}function V(na,qa,ta){const Fa=z.project(qa.position,na.spatialReference);if(f.isNone(Fa))return null;qa=qa.clone();qa.fov=na.camera.fov;qa.position=Fa;return R(na,null,qa,ta)}function Y(na,qa,ta,Fa,Ha,Ka){return aa.apply(this,arguments)}function aa(){aa=b._asyncToGenerator(function*(na,qa,ta,Fa,Ha,Ka){if(f.isNone(ta))throw new n("createfromcenter","invalid point");Ka.targetGeometry=
ta.clone();const La=v.cameraOnContentAlongViewDirection(na);if(qa.position)return ta=Ka.targetGeometry,Ha=na.renderSpatialReference,m.projectPointToVector(qa.position,va,Ha),m.projectPointToVector(ta,ya,Ha),Ka.targetGeometry=new C(ta),Fa.position=new C(qa.position),p.subtract(ra,ya,va),B.directionToHeadingTilt(na,va,ra,La.up,Fa),Ka.scale=B.distanceToScale(na,p.distance(va,ya),Ka.targetGeometry.latitude),Ka.rotation=I(Fa.heading),Ka.camera=Fa,Ka;if(qa.zoomFactor){var Ra=La.distance/qa.zoomFactor;const ab=
p.scale(Z,La.viewForward,-Ra);La.eye=p.add(Z,La.center,ab);Ka.scale=B.distanceToScale(na,Ra,ta.latitude)}B.internalToExternal(na,La,Fa);Ra=U(Fa,qa)?B.OrientationMode.LOCKED:B.OrientationMode.ADJUST;qa.zoomFactor||(Ka.scale=M(na,qa),null==Ka.scale&&(m.projectPointToVector(ta,Z,na.renderSpatialReference),q.intersectsPoint(La.frustum,Z)?Ka.scale=B.distanceToScale(na,p.distance(La.eye,Z),ta.latitude):Ka.scale=B.computeScale(na,La)),qa=new B.AsyncContext(Ha),B.fromCenterScale(na,Ka.targetGeometry,Ka.scale,
Fa,Ra,qa),Ka.camera=yield qa.resolver.promise);return Ka});return aa.apply(this,arguments)}function X(na,qa,ta,Fa,Ha){return ba.apply(this,arguments)}function ba(){ba=b._asyncToGenerator(function*(na,qa,ta,Fa,Ha){var Ka=v.cameraOnContentAlongViewDirection(na);Ka=m.projectVectorToPoint(Ka.center,na.renderSpatialReference,na.spatialReference);return Y(na,qa,Ka,ta,Fa,Ha)});return ba.apply(this,arguments)}function ha(na,qa,ta,Fa,Ha,Ka){return ka.apply(this,arguments)}function ka(){ka=b._asyncToGenerator(function*(na,
qa,ta,Fa,Ha,Ka){Ka.targetGeometry=ta.clone();const La=v.cameraOnContentAlongViewDirection(na);B.internalToExternal(na,La,Fa);qa=U(Fa,qa)?B.OrientationMode.LOCKED:B.OrientationMode.ADJUST;Ha=new B.AsyncContext(Ha);B.fromExtent(na,ta,Fa.heading,Fa.tilt,qa,Ha);Ka.camera=yield Ha.resolver.promise;return Ka});return ka.apply(this,arguments)}function ia(na,qa,ta,Fa,Ha,Ka,La,Ra){return ea.apply(this,arguments)}function ea(){ea=b._asyncToGenerator(function*(na,qa,ta,Fa,Ha,Ka,La,Ra){Ra.targetGeometry=ta.clone();
const ab=v.cameraOnContentAlongViewDirection(na);var Za=0;ta.hasZ?Za=ta.z:na.basemapTerrain&&(Za=f.unwrap(A.getElevationAtPoint(na.elevationProvider,ta)));p.set(Z,ta.x,ta.y,Za);m.computeTranslationToOriginAndRotation(na.spatialReference,Z,fa,na.renderSpatialReference);k.fromMat4(ja,fa);k.transpose(ja,ja);u.empty(la);ta=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(var Pa=0;Pa<ta.length;Pa++){const ua=ta[Pa];let Aa=Fa[ua[2]];isFinite(Aa)||(Aa=Za);p.set(Z,Fa[ua[0]],Fa[ua[1]],
Aa);m.projectVectorToVector(Z,na.spatialReference,Z,na.renderSpatialReference);u.expandWithVec3(la,p.transformMat3(Z,Z,ja))}Fa=u.width(la);Za=u.height(la);ta=u.depth(la);Pa=1/Math.tan(ab.fovY/2);Ha=Math.max(.5*Math.sqrt(Fa*Fa+ta*ta)*Math.max(Pa,1/Math.tan(ab.fovX/2))+.5*Za,.5*Za*Pa+.5*Math.max(Fa,ta))/Ha;B.internalToExternal(na,ab,Ka);qa=U(Ka,qa)?B.OrientationMode.LOCKED:B.OrientationMode.ADJUST;Ra.scale=B.distanceToScale(na,Ha,Ra.targetGeometry.latitude);La=new B.AsyncContext(La);B.fromCenterScale(na,
Ra.targetGeometry,Ra.scale,Ka,qa,La);Ra.camera=yield La.resolver.promise;return Ra});return ea.apply(this,arguments)}function ca(na){na&&f.isSome(na.camera)&&(na.rotation=I(na.camera.heading));return na}const Z=h.create(),fa=y.create(),ja=r.create(),la=u.create(),ma=t.create(),ra=h.create(),va=h.create(),ya=h.create(),za={heading:0,tilt:0},pa=new C,wa={point(na,qa,ta){ta[0]=na.x;ta[1]=na.y;na.hasZ&&(ta[2]=na.z);qa(ta)},polygon(na,qa,ta){const Fa=na.hasZ;for(let Ha=0;Ha<na.rings.length;Ha++){const Ka=
na.rings[Ha];for(let La=0;La<Ka.length;La++)ta[0]=Ka[La][0],ta[1]=Ka[La][1],Fa&&(ta[2]=Ka[La][2]),qa(ta)}},polyline(na,qa,ta){const Fa=na.hasZ;for(let Ha=0;Ha<na.paths.length;Ha++){const Ka=na.paths[Ha];for(let La=0;La<Ka.length;La++)ta[0]=Ka[La][0],ta[1]=Ka[La][1],Fa&&(ta[2]=Ka[La][2]),qa(ta)}},multipoint(na,qa,ta){const Fa=na.points;na=na.hasZ;for(let Ha=0;Ha<Fa.length;Ha++)ta[0]=Fa[Ha][0],ta[1]=Fa[Ha][1],na&&(ta[2]=Fa[Ha][2]),qa(ta)},extent(na,qa,ta){na.hasZ?(qa(p.set(ta,na.xmin,na.ymin,na.zmin)),
qa(p.set(ta,na.xmax,na.ymin,na.zmin)),qa(p.set(ta,na.xmin,na.ymax,na.zmin)),qa(p.set(ta,na.xmax,na.ymax,na.zmin)),qa(p.set(ta,na.xmin,na.ymin,na.zmax)),qa(p.set(ta,na.xmax,na.ymin,na.zmax)),qa(p.set(ta,na.xmin,na.ymax,na.zmax)),qa(p.set(ta,na.xmax,na.ymax,na.zmax))):(qa(p.set(ta,na.xmin,na.ymin,ta[2])),qa(p.set(ta,na.xmax,na.ymin,ta[2])),qa(p.set(ta,na.xmin,na.ymax,ta[2])),qa(p.set(ta,na.xmax,na.ymax,ta[2])))},mesh(na,qa,ta){if(na=na.vertexAttributes&&na.vertexAttributes.position)for(let Fa=0;Fa<
na.length;Fa+=3)qa(p.set(ta,na[Fa+0],na[Fa+1],na[Fa+2]))}};a.create=function(na,qa,ta){return K.apply(this,arguments)};a.fromCamera=function(na,qa,ta=null){f.isNone(ta)&&(ta=new x);return R(na,null,qa.clone(),ta)};a.headingToRotation=I;a.rotationToHeading=J;a.toCamera=P;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/mat3":function(){define(["exports","./common"],function(a,b){function c(K,M){K[0]=M[0];K[1]=M[1];K[2]=M[2];K[3]=M[4];K[4]=M[5];K[5]=M[6];K[6]=M[8];K[7]=M[9];K[8]=M[10];
return K}function d(K,M){K[0]=M[0];K[1]=M[1];K[2]=M[2];K[3]=M[3];K[4]=M[4];K[5]=M[5];K[6]=M[6];K[7]=M[7];K[8]=M[8];return K}function g(K,M,U,R,L,N,T,S,H,Q){K[0]=M;K[1]=U;K[2]=R;K[3]=L;K[4]=N;K[5]=T;K[6]=S;K[7]=H;K[8]=Q;return K}function x(K){K[0]=1;K[1]=0;K[2]=0;K[3]=0;K[4]=1;K[5]=0;K[6]=0;K[7]=0;K[8]=1;return K}function w(K,M){if(K===M){const U=M[1],R=M[2],L=M[5];K[1]=M[3];K[2]=M[6];K[3]=U;K[5]=M[7];K[6]=R;K[7]=L}else K[0]=M[0],K[1]=M[3],K[2]=M[6],K[3]=M[1],K[4]=M[4],K[5]=M[7],K[6]=M[2],K[7]=M[5],
K[8]=M[8];return K}function l(K,M){const U=M[0],R=M[1],L=M[2],N=M[3],T=M[4],S=M[5],H=M[6],Q=M[7];M=M[8];const W=M*T-S*Q,V=-M*N+S*H,Y=Q*N-T*H;let aa=U*W+R*V+L*Y;if(!aa)return null;aa=1/aa;K[0]=W*aa;K[1]=(-M*R+L*Q)*aa;K[2]=(S*R-L*T)*aa;K[3]=V*aa;K[4]=(M*U-L*H)*aa;K[5]=(-S*U+L*N)*aa;K[6]=Y*aa;K[7]=(-Q*U+R*H)*aa;K[8]=(T*U-R*N)*aa;return K}function n(K,M){const U=M[0],R=M[1],L=M[2],N=M[3],T=M[4],S=M[5],H=M[6],Q=M[7];M=M[8];K[0]=T*M-S*Q;K[1]=L*Q-R*M;K[2]=R*S-L*T;K[3]=S*H-N*M;K[4]=U*M-L*H;K[5]=L*N-U*S;K[6]=
N*Q-T*H;K[7]=R*H-U*Q;K[8]=U*T-R*N;return K}function f(K){const M=K[3],U=K[4],R=K[5],L=K[6],N=K[7],T=K[8];return K[0]*(T*U-R*N)+K[1]*(-T*M+R*L)+K[2]*(N*M-U*L)}function e(K,M,U){const R=M[0],L=M[1],N=M[2],T=M[3],S=M[4],H=M[5],Q=M[6],W=M[7];M=M[8];const V=U[0],Y=U[1],aa=U[2],X=U[3],ba=U[4],ha=U[5],ka=U[6],ia=U[7];U=U[8];K[0]=V*R+Y*T+aa*Q;K[1]=V*L+Y*S+aa*W;K[2]=V*N+Y*H+aa*M;K[3]=X*R+ba*T+ha*Q;K[4]=X*L+ba*S+ha*W;K[5]=X*N+ba*H+ha*M;K[6]=ka*R+ia*T+U*Q;K[7]=ka*L+ia*S+U*W;K[8]=ka*N+ia*H+U*M;return K}function k(K,
M,U){const R=M[0],L=M[1],N=M[2],T=M[3],S=M[4],H=M[5],Q=M[6],W=M[7];M=M[8];const V=U[0];U=U[1];K[0]=R;K[1]=L;K[2]=N;K[3]=T;K[4]=S;K[5]=H;K[6]=V*R+U*T+Q;K[7]=V*L+U*S+W;K[8]=V*N+U*H+M;return K}function r(K,M,U){const R=M[0],L=M[1],N=M[2],T=M[3],S=M[4],H=M[5],Q=M[6],W=M[7];M=M[8];const V=Math.sin(U);U=Math.cos(U);K[0]=U*R+V*T;K[1]=U*L+V*S;K[2]=U*N+V*H;K[3]=U*T-V*R;K[4]=U*S-V*L;K[5]=U*H-V*N;K[6]=Q;K[7]=W;K[8]=M;return K}function y(K,M,U){const R=U[0],L=U[1];U=U[2];K[0]=R*M[0];K[1]=R*M[1];K[2]=R*M[2];K[3]=
L*M[3];K[4]=L*M[4];K[5]=L*M[5];K[6]=U*M[6];K[7]=U*M[7];K[8]=U*M[8];return K}function p(K,M,U){const R=U[0];U=U[1];K[0]=R*M[0];K[1]=R*M[1];K[2]=R*M[2];K[3]=U*M[3];K[4]=U*M[4];K[5]=U*M[5];return K}function h(K,M){K[0]=1;K[1]=0;K[2]=0;K[3]=0;K[4]=1;K[5]=0;K[6]=M[0];K[7]=M[1];K[8]=1;return K}function m(K,M){const U=Math.sin(M);M=Math.cos(M);K[0]=M;K[1]=U;K[2]=0;K[3]=-U;K[4]=M;K[5]=0;K[6]=0;K[7]=0;K[8]=1;return K}function u(K,M){K[0]=M[0];K[1]=0;K[2]=0;K[3]=0;K[4]=M[1];K[5]=0;K[6]=0;K[7]=0;K[8]=1;return K}
function t(K,M){K[0]=M[0];K[1]=M[1];K[2]=0;K[3]=M[2];K[4]=M[3];K[5]=0;K[6]=M[4];K[7]=M[5];K[8]=1;return K}function q(K,M){var U=M[0],R=M[1],L=M[2];M=M[3];var N=U+U,T=R+R;const S=L+L;U*=N;const H=R*N;R*=T;const Q=L*N,W=L*T;L*=S;N*=M;T*=M;M*=S;K[0]=1-R-L;K[3]=H-M;K[6]=Q+T;K[1]=H+M;K[4]=1-U-L;K[7]=W-N;K[2]=Q-T;K[5]=W+N;K[8]=1-U-R;return K}function z(K,M){const U=M[0],R=M[1],L=M[2],N=M[4],T=M[5],S=M[6],H=M[8],Q=M[9];M=M[10];const W=M*T-S*Q,V=-M*N+S*H,Y=Q*N-T*H;var aa=U*W+R*V+L*Y;if(!aa)return null;aa=
1/aa;K[0]=W*aa;K[1]=(-M*R+L*Q)*aa;K[2]=(S*R-L*T)*aa;K[3]=V*aa;K[4]=(M*U-L*H)*aa;K[5]=(-S*U+L*N)*aa;K[6]=Y*aa;K[7]=(-Q*U+R*H)*aa;K[8]=(T*U-R*N)*aa;return K}function v(K,M){const U=M[0],R=M[1],L=M[2],N=M[3],T=M[4],S=M[5],H=M[6],Q=M[7];var W=M[8],V=M[9],Y=M[10],aa=M[11];const X=M[12],ba=M[13],ha=M[14];M=M[15];const ka=U*S-R*T,ia=U*H-L*T,ea=U*Q-N*T,ca=R*H-L*S,Z=R*Q-N*S,fa=L*Q-N*H,ja=W*ba-V*X,la=W*ha-Y*X;W=W*M-aa*X;const ma=V*ha-Y*ba;V=V*M-aa*ba;Y=Y*M-aa*ha;aa=ka*Y-ia*V+ea*ma+ca*W-Z*la+fa*ja;if(!aa)return null;
aa=1/aa;K[0]=(S*Y-H*V+Q*ma)*aa;K[1]=(H*W-T*Y-Q*la)*aa;K[2]=(T*V-S*W+Q*ja)*aa;K[3]=(L*V-R*Y-N*ma)*aa;K[4]=(U*Y-L*W+N*la)*aa;K[5]=(R*W-U*V-N*ja)*aa;K[6]=(ba*fa-ha*Z+M*ca)*aa;K[7]=(ha*ea-X*fa-M*ia)*aa;K[8]=(X*Z-ba*ea+M*ka)*aa;return K}function B(K,M,U){K[0]=2/M;K[1]=0;K[2]=0;K[3]=0;K[4]=-2/U;K[5]=0;K[6]=-1;K[7]=1;K[8]=1;return K}function A(K){return"mat3("+K[0]+", "+K[1]+", "+K[2]+", "+K[3]+", "+K[4]+", "+K[5]+", "+K[6]+", "+K[7]+", "+K[8]+")"}function E(K){return Math.sqrt(K[0]**2+K[1]**2+K[2]**2+K[3]**
2+K[4]**2+K[5]**2+K[6]**2+K[7]**2+K[8]**2)}function C(K,M,U){K[0]=M[0]+U[0];K[1]=M[1]+U[1];K[2]=M[2]+U[2];K[3]=M[3]+U[3];K[4]=M[4]+U[4];K[5]=M[5]+U[5];K[6]=M[6]+U[6];K[7]=M[7]+U[7];K[8]=M[8]+U[8];return K}function D(K,M,U){K[0]=M[0]-U[0];K[1]=M[1]-U[1];K[2]=M[2]-U[2];K[3]=M[3]-U[3];K[4]=M[4]-U[4];K[5]=M[5]-U[5];K[6]=M[6]-U[6];K[7]=M[7]-U[7];K[8]=M[8]-U[8];return K}function F(K,M,U){K[0]=M[0]*U;K[1]=M[1]*U;K[2]=M[2]*U;K[3]=M[3]*U;K[4]=M[4]*U;K[5]=M[5]*U;K[6]=M[6]*U;K[7]=M[7]*U;K[8]=M[8]*U;return K}
function G(K,M,U,R){K[0]=M[0]+U[0]*R;K[1]=M[1]+U[1]*R;K[2]=M[2]+U[2]*R;K[3]=M[3]+U[3]*R;K[4]=M[4]+U[4]*R;K[5]=M[5]+U[5]*R;K[6]=M[6]+U[6]*R;K[7]=M[7]+U[7]*R;K[8]=M[8]+U[8]*R;return K}function J(K,M){return K[0]===M[0]&&K[1]===M[1]&&K[2]===M[2]&&K[3]===M[3]&&K[4]===M[4]&&K[5]===M[5]&&K[6]===M[6]&&K[7]===M[7]&&K[8]===M[8]}function I(K,M){const U=K[0],R=K[1],L=K[2],N=K[3],T=K[4],S=K[5],H=K[6],Q=K[7];K=K[8];const W=M[0],V=M[1],Y=M[2],aa=M[3],X=M[4],ba=M[5],ha=M[6],ka=M[7];M=M[8];return Math.abs(U-W)<=
b.EPSILON*Math.max(1,Math.abs(U),Math.abs(W))&&Math.abs(R-V)<=b.EPSILON*Math.max(1,Math.abs(R),Math.abs(V))&&Math.abs(L-Y)<=b.EPSILON*Math.max(1,Math.abs(L),Math.abs(Y))&&Math.abs(N-aa)<=b.EPSILON*Math.max(1,Math.abs(N),Math.abs(aa))&&Math.abs(T-X)<=b.EPSILON*Math.max(1,Math.abs(T),Math.abs(X))&&Math.abs(S-ba)<=b.EPSILON*Math.max(1,Math.abs(S),Math.abs(ba))&&Math.abs(H-ha)<=b.EPSILON*Math.max(1,Math.abs(H),Math.abs(ha))&&Math.abs(Q-ka)<=b.EPSILON*Math.max(1,Math.abs(Q),Math.abs(ka))&&Math.abs(K-M)<=
b.EPSILON*Math.max(1,Math.abs(K),Math.abs(M))}function O(K){const M=b.EPSILON,U=K[0],R=K[1],L=K[2],N=K[3],T=K[4],S=K[5],H=K[6],Q=K[7];K=K[8];return Math.abs(1-(U*U+N*N+H*H))<=M&&Math.abs(1-(R*R+T*T+Q*Q))<=M&&Math.abs(1-(L*L+S*S+K*K))<=M}const P=Object.freeze({__proto__:null,fromMat4:c,copy:d,set:g,identity:x,transpose:w,invert:l,adjoint:n,determinant:f,multiply:e,translate:k,rotate:r,scale:y,scaleByVec2:p,fromTranslation:h,fromRotation:m,fromScaling:u,fromMat2d:t,fromQuat:q,normalFromMat4Legacy:z,
normalFromMat4:v,projection:B,str:A,frob:E,add:C,subtract:D,multiplyScalar:F,multiplyScalarAndAdd:G,exactEquals:J,equals:I,isOrthoNormal:O,mul:e,sub:D});a.add=C;a.adjoint=n;a.copy=d;a.determinant=f;a.equals=I;a.exactEquals=J;a.frob=E;a.fromMat2d=t;a.fromMat4=c;a.fromQuat=q;a.fromRotation=m;a.fromScaling=u;a.fromTranslation=h;a.identity=x;a.invert=l;a.isOrthoNormal=O;a.mat3=P;a.mul=e;a.multiply=e;a.multiplyScalar=F;a.multiplyScalarAndAdd=G;a.normalFromMat4=v;a.normalFromMat4Legacy=z;a.projection=B;
a.rotate=r;a.scale=y;a.scaleByVec2=p;a.set=g;a.str=A;a.sub=D;a.subtract=D;a.translate=k;a.transpose=w})},"esri/chunks/mat3f64":function(){define(["exports"],function(a){function b(){return[1,0,0,0,1,0,0,0,1]}function c(w){return[w[0],w[1],w[2],w[3],w[4],w[5],w[6],w[7],w[8]]}function d(w,l,n,f,e,k,r,y,p){return[w,l,n,f,e,k,r,y,p]}function g(w,l){return new Float64Array(w,l,9)}const x=Object.freeze({__proto__:null,create:b,clone:c,fromValues:d,createView:g});a.clone=c;a.create=b;a.createView=g;a.fromValues=
d;a.mat3f64=x})},"esri/chunks/mat4f64":function(){define(["exports"],function(a){function b(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function c(l){return[l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7],l[8],l[9],l[10],l[11],l[12],l[13],l[14],l[15]]}function d(l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B){return[l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B]}function g(l,n){return new Float64Array(l,n,16)}const x=b(),w=Object.freeze({__proto__:null,create:b,clone:c,fromValues:d,createView:g,IDENTITY:x});a.IDENTITY=x;a.clone=c;a.create=
b;a.createView=g;a.fromValues=d;a.mat4f64=w})},"esri/geometry/support/frustum":function(){define("exports ../../core/ObjectStack ../../chunks/mat4 ../../chunks/vec3 ../../chunks/vec3f64 ../../chunks/vec4 ../../chunks/vec4f64 ./clipRay ./plane ./vectorStacks".split(" "),function(a,b,c,d,g,x,w,l,n,f){function e(){return[g.create(),g.create(),g.create(),g.create(),g.create(),g.create(),g.create(),g.create()]}function k(u,t){n.fromPoints(t[a.PointIndex.FAR_BOTTOM_LEFT],t[a.PointIndex.NEAR_BOTTOM_LEFT],
t[a.PointIndex.NEAR_TOP_LEFT],u[a.PlaneIndex.LEFT]);n.fromPoints(t[a.PointIndex.NEAR_BOTTOM_RIGHT],t[a.PointIndex.FAR_BOTTOM_RIGHT],t[a.PointIndex.FAR_TOP_RIGHT],u[a.PlaneIndex.RIGHT]);n.fromPoints(t[a.PointIndex.FAR_BOTTOM_LEFT],t[a.PointIndex.FAR_BOTTOM_RIGHT],t[a.PointIndex.NEAR_BOTTOM_RIGHT],u[a.PlaneIndex.BOTTOM]);n.fromPoints(t[a.PointIndex.NEAR_TOP_LEFT],t[a.PointIndex.NEAR_TOP_RIGHT],t[a.PointIndex.FAR_TOP_RIGHT],u[a.PlaneIndex.TOP]);n.fromPoints(t[a.PointIndex.NEAR_BOTTOM_LEFT],t[a.PointIndex.NEAR_BOTTOM_RIGHT],
t[a.PointIndex.NEAR_TOP_RIGHT],u[a.PlaneIndex.NEAR]);n.fromPoints(t[a.PointIndex.FAR_BOTTOM_RIGHT],t[a.PointIndex.FAR_BOTTOM_LEFT],t[a.PointIndex.FAR_TOP_LEFT],u[a.PlaneIndex.FAR])}function r(u,t){for(let q=0;q<a.NumPlanes.NUM;q++)if(!n.clip(u[q],t))return!1;return!0}a.PlaneIndex=void 0;(function(u){u[u.LEFT=0]="LEFT";u[u.RIGHT=1]="RIGHT";u[u.BOTTOM=2]="BOTTOM";u[u.TOP=3]="TOP";u[u.NEAR=4]="NEAR";u[u.FAR=5]="FAR"})(a.PlaneIndex||(a.PlaneIndex={}));a.PointIndex=void 0;(function(u){u[u.NEAR_BOTTOM_LEFT=
0]="NEAR_BOTTOM_LEFT";u[u.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT";u[u.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT";u[u.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT";u[u.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT";u[u.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT";u[u.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT";u[u.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"})(a.PointIndex||(a.PointIndex={}));const y={bottom:[a.PointIndex.FAR_BOTTOM_RIGHT,a.PointIndex.NEAR_BOTTOM_RIGHT,a.PointIndex.NEAR_BOTTOM_LEFT,a.PointIndex.FAR_BOTTOM_LEFT],near:[a.PointIndex.NEAR_BOTTOM_LEFT,
a.PointIndex.NEAR_BOTTOM_RIGHT,a.PointIndex.NEAR_TOP_RIGHT,a.PointIndex.NEAR_TOP_LEFT],far:[a.PointIndex.FAR_BOTTOM_RIGHT,a.PointIndex.FAR_BOTTOM_LEFT,a.PointIndex.FAR_TOP_LEFT,a.PointIndex.FAR_TOP_RIGHT],right:[a.PointIndex.NEAR_BOTTOM_RIGHT,a.PointIndex.FAR_BOTTOM_RIGHT,a.PointIndex.FAR_TOP_RIGHT,a.PointIndex.NEAR_TOP_RIGHT],left:[a.PointIndex.FAR_BOTTOM_LEFT,a.PointIndex.NEAR_BOTTOM_LEFT,a.PointIndex.NEAR_TOP_LEFT,a.PointIndex.FAR_TOP_LEFT],top:[a.PointIndex.FAR_TOP_LEFT,a.PointIndex.NEAR_TOP_LEFT,
a.PointIndex.NEAR_TOP_RIGHT,a.PointIndex.FAR_TOP_RIGHT]};a.NumPlanes=void 0;(function(u){u[u.NUM=6]="NUM"})(a.NumPlanes||(a.NumPlanes={}));a.NumPoints=void 0;(function(u){u[u.NUM=8]="NUM"})(a.NumPoints||(a.NumPoints={}));const p=[w.fromValues(-1,-1,-1,1),w.fromValues(1,-1,-1,1),w.fromValues(1,1,-1,1),w.fromValues(-1,1,-1,1),w.fromValues(-1,-1,1,1),w.fromValues(1,-1,1,1),w.fromValues(1,1,1,1),w.fromValues(-1,1,1,1)],h=new b.ObjectStack(l.create),m=e();a.computePlanes=k;a.copy=function(u,t){for(let q=
0;q<a.NumPlanes.NUM;q++)n.copy(u[q],t[q])};a.create=function(u){return u?[n.create(u[0]),n.create(u[1]),n.create(u[2]),n.create(u[3]),n.create(u[4]),n.create(u[5])]:[n.create(),n.create(),n.create(),n.create(),n.create(),n.create()]};a.createPoints=e;a.fromMatrix=function(u,t,q,z=m){u=c.multiply(f.sm4d.get(),t,u);c.invert(u,u);for(t=0;t<a.NumPoints.NUM;++t){const v=x.transformMat4(f.sv4d.get(),p[t],u);d.set(z[t],v[0]/v[3],v[1]/v[3],v[2]/v[3])}k(q,z)};a.intersectClipRay=function(u,t){for(let q=0;q<
a.NumPlanes.NUM;q++)if(!n.clipInfinite(u[q],t))return!1;return!0};a.intersectsAABB=function(u,t){for(let q=0;q<a.NumPlanes.NUM;q++)if(n.isAABBFullyInside(u[q],t))return!1;return!0};a.intersectsLineSegment=function(u,t,q){return r(u,l.fromLineSegmentAndDirection(t,q,h.get()))};a.intersectsPoint=function(u,t){for(let q=0;q<a.NumPlanes.NUM;q++)if(0<n.signedDistance(u[q],t))return!1;return!0};a.intersectsRay=function(u,t){return r(u,l.fromRay(t,h.get()))};a.intersectsSphere=function(u,t){for(let q=0;q<
a.NumPlanes.NUM;q++){const z=u[q];if(z[0]*t[0]+z[1]*t[1]+z[2]*t[2]+z[3]>=t[3])return!1}return!0};a.planePointIndices=y;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/ObjectStack":function(){define(["exports","./nextTick"],function(a,b){let c=function(){function d(x){this.allocator=x;this._items=[];this._itemsPtr=0;this._grow()}var g=d.prototype;g.get=function(){0===this._itemsPtr&&b.nextTick(()=>this._reset());this._itemsPtr===this._items.length&&this._grow();return this._items[this._itemsPtr++]};
g._reset=function(){this._items.length=Math.min(Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3072),this._items.length);this._itemsPtr=0};g._grow=function(){for(let x=0;x<Math.max(8,Math.min(this._items.length,1024));x++)this._items.push(this.allocator())};return d}();a.ObjectStack=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/vec4f64":function(){define(["exports"],function(a){function b(){return[0,0,0,0]}function c(q){return[q[0],q[1],q[2],q[3]]}function d(q,z,v,B){return[q,
z,v,B]}function g(q){const z=b(),v=Math.min(4,q.length);for(let B=0;B<v;++B)z[B]=q[B];return z}function x(q,z){return new Float64Array(q,z,4)}function w(){return b()}function l(){return[1,1,1,1]}function n(){return[1,0,0,0]}function f(){return[0,1,0,0]}function e(){return[0,0,1,0]}function k(){return[0,0,0,1]}const r=b(),y=l(),p=n(),h=f(),m=e(),u=k(),t=Object.freeze({__proto__:null,create:b,clone:c,fromValues:d,fromArray:g,createView:x,zeros:w,ones:l,unitX:n,unitY:f,unitZ:e,unitW:k,ZEROS:r,ONES:y,
UNIT_X:p,UNIT_Y:h,UNIT_Z:m,UNIT_W:u});a.ONES=y;a.UNIT_W=u;a.UNIT_X=p;a.UNIT_Y=h;a.UNIT_Z=m;a.ZEROS=r;a.clone=c;a.create=b;a.createView=x;a.fromArray=g;a.fromValues=d;a.ones=l;a.unitW=k;a.unitX=n;a.unitY=f;a.unitZ=e;a.vec4f64=t;a.zeros=w})},"esri/geometry/support/clipRay":function(){define(["exports","../../core/ObjectStack","../../chunks/vec3","./ray","./vectorStacks"],function(a,b,c,d,g){function x(e){return e?{ray:d.create(e.ray),c0:e.c0,c1:e.c1}:{ray:d.create(),c0:0,c1:Number.MAX_VALUE}}function w(e,
k,r,y=x()){d.copy(e,y.ray);y.c0=k;y.c1=r;return y}function l(e,k,r=x()){const y=c.length(e.vector);d.fromValues(e.origin,k,r.ray);r.c0=0;r.c1=y;return r}function n(e,k,r){return c.add(r,e.ray.origin,c.scale(r,e.ray.direction,k))}const f=new b.ObjectStack(()=>({c0:0,c1:0,ray:null}));a.copy=function(e,k=x()){return w(e.ray,e.c0,e.c1,k)};a.create=x;a.fromLineSegment=function(e,k=x()){const r=c.normalize(g.sv3d.get(),e.vector);return l(e,r,k)};a.fromLineSegmentAndDirection=l;a.fromRay=function(e,k=x()){d.copy(e,
k.ray);k.c0=0;k.c1=Number.MAX_VALUE;return k};a.fromValues=w;a.getAt=n;a.getEnd=function(e,k){return n(e,e.c1,k)};a.getStart=function(e,k){return n(e,e.c0,k)};a.wrap=function(e,k,r){const y=f.get();y.ray=e;y.c0=k;y.c1=r;return y};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/ray":function(){define("exports ../../core/arrayUtils ../../core/ObjectStack ../../chunks/vec3 ../../chunks/vec3f64 ./vectorStacks".split(" "),function(a,b,c,d,g,x){function w(e){return e?{origin:g.clone(e.origin),
direction:g.clone(e.direction)}:{origin:g.create(),direction:g.create()}}function l(e,k,r=w()){d.copy(r.origin,e);d.copy(r.direction,k);return r}function n(e,k){e=d.cross(x.sv3d.get(),d.normalize(x.sv3d.get(),e.direction),d.subtract(x.sv3d.get(),k,e.origin));return d.dot(e,e)}const f=new c.ObjectStack(function(){return{origin:null,direction:null}});a.closestPoint=function(e,k,r){k=d.dot(e.direction,d.subtract(r,k,e.origin));d.add(r,e.origin,d.scale(r,e.direction,k));return r};a.copy=function(e,k=
w()){return l(e.origin,e.direction,k)};a.create=w;a.distance=function(e,k){return Math.sqrt(n(e,k))};a.distance2=n;a.equals=function(e,k){return b.equals(e.origin,k.origin)&&b.equals(e.direction,k.direction)};a.fromPoints=function(e,k,r=w()){d.copy(r.origin,e);d.subtract(r.direction,k,e);return r};a.fromValues=l;a.wrap=function(e,k){const r=f.get();r.origin=e;r.direction=k;return r};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/vectorStacks":function(){define(["exports",
"../../core/VectorStack"],function(a,b){const c=b.VectorStack.createVec2f64(),d=b.VectorStack.createVec3f64(),g=b.VectorStack.createVec4f64(),x=b.VectorStack.createMat3f64(),w=b.VectorStack.createMat4f64();b=b.VectorStack.createQuatf64();a.sm3d=x;a.sm4d=w;a.sq4d=b;a.sv2d=c;a.sv3d=d;a.sv4d=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/VectorStack":function(){define("exports ../chunks/_rollupPluginBabelHelpers ./byteSizeEstimations ./nextTick ../chunks/mat3f64 ../chunks/mat4f64 ../chunks/quatf64 ../chunks/vec2f64 ../chunks/vec3f64 ../chunks/vec4f64".split(" "),
function(a,b,c,d,g,x,w,l,n,f){let e=function(){function r(p,h,m){this.itemByteSize=p;this.itemCreate=h;this._buffers=[];this._items=[];this._itemsPtr=0;this._itemsPerBuffer=Math.ceil(m/this.itemByteSize)}var y=r.prototype;y.get=function(){0===this._itemsPtr&&d.nextTick(()=>this._reset());const p=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=p;){const h=new ArrayBuffer(this._itemsPerBuffer*this.itemByteSize);for(let m=0;m<this._itemsPerBuffer;++m)this._items.push(this.itemCreate(h,
m*this.itemByteSize));this._buffers.push(h)}return this._items[this._itemsPtr++]};y._reset=function(){const p=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>p;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0};r.createVec2f64=function(p=k){return new r(16,l.createView,p)};r.createVec3f64=function(p=k){return new r(24,n.createView,p)};r.createVec4f64=function(p=k){return new r(32,f.createView,p)};r.createMat3f64=function(p=
k){return new r(72,g.createView,p)};r.createMat4f64=function(p=k){return new r(128,x.createView,p)};r.createQuatf64=function(p=k){return new r(32,w.createView,p)};b._createClass(r,[{key:"test",get:function(){return{size:this._buffers.length*this._itemsPerBuffer*this.itemByteSize}}}]);return r}();const k=4*c.ByteSizeUnit.KILOBYTES;a.VectorStack=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/quatf64":function(){define(["exports"],function(a){function b(){return[0,0,0,1]}function c(l){return[l[0],
l[1],l[2],l[3]]}function d(l,n,f,e){return[l,n,f,e]}function g(l,n){return new Float64Array(l,n,4)}const x=b(),w=Object.freeze({__proto__:null,create:b,clone:c,fromValues:d,createView:g,IDENTITY:x});a.IDENTITY=x;a.clone=c;a.create=b;a.createView=g;a.fromValues=d;a.quatf64=w})},"esri/chunks/vec2f64":function(){define(["exports"],function(a){function b(){return[0,0]}function c(h){return[h[0],h[1]]}function d(h,m){return[h,m]}function g(h){const m=[0,0],u=Math.min(2,h.length);for(let t=0;t<u;++t)m[t]=
h[t];return m}function x(h,m){return new Float64Array(h,m,2)}function w(){return[0,0]}function l(){return[1,1]}function n(){return[1,0]}function f(){return[0,1]}const e=[0,0],k=[1,1],r=[1,0],y=[0,1],p=Object.freeze({__proto__:null,create:b,clone:c,fromValues:d,fromArray:g,createView:x,zeros:w,ones:l,unitX:n,unitY:f,ZEROS:e,ONES:k,UNIT_X:r,UNIT_Y:y});a.ONES=k;a.UNIT_X=r;a.UNIT_Y=y;a.ZEROS=e;a.clone=c;a.create=b;a.createView=x;a.fromArray=g;a.fromValues=d;a.ones=l;a.unitX=n;a.unitY=f;a.vec2f64=p;a.zeros=
w})},"esri/geometry/support/plane":function(){define("exports ../../core/mathUtils ../../core/maybe ../../chunks/vec3 ../../chunks/vec3f64 ../../chunks/sphere ./vectorStacks".split(" "),function(a,b,c,d,g,x,w){function l(C=v){return[C[0],C[1],C[2],C[3]]}function n(C,D){return f(D[0],D[1],D[2],D[3],C)}function f(C,D,F,G,J=l()){J[0]=C;J[1]=D;J[2]=F;J[3]=G;return J}function e(C,D,F){var G=D[0]*D[0]+D[1]*D[1]+D[2]*D[2];G=1E-5<Math.abs(G-1)&&1E-12<G?1/Math.sqrt(G):1;F[0]=D[0]*G;F[1]=D[1]*G;F[2]=D[2]*G;
F[3]=-(F[0]*C[0]+F[1]*C[1]+F[2]*C[2]);return F}function k(C,D,F,G=l()){var J=F[0]-D[0],I=F[1]-D[1],O=F[2]-D[2];F=C[0]-D[0];const P=C[1]-D[1],K=C[2]-D[2];D=I*K-O*P;O=O*F-J*K;J=J*P-I*F;I=D*D+O*O+J*J;I=1E-5<Math.abs(I-1)&&1E-12<I?1/Math.sqrt(I):1;G[0]=D*I;G[1]=O*I;G[2]=J*I;G[3]=-(G[0]*C[0]+G[1]*C[1]+G[2]*C[2])}function r(C,D,F,G,J){if(3>C.count)return!1;C.getVec(F,m);let I=G,O=!1;for(;I<C.count-1&&!O;)C.getVec(I,u),I++,O=!d.exactEquals(m,u);if(!O)return!1;I=Math.max(I,J);for(O=!1;I<C.count&&!O;)C.getVec(I,
t),I++,d.subtract(q,m,u),d.normalize(q,q),d.subtract(z,u,t),d.normalize(z,z),O=!d.exactEquals(m,t)&&!d.exactEquals(u,t)&&.99619469809>Math.abs(d.dot(q,z));if(!O)return 0===F&&1===G&&2===J?!1:r(C,D,0,1,2);k(m,u,t,D);return!0}function y(C,D,F){C=d.scale(w.sv3d.get(),C,d.dot(C,D));d.subtract(F,D,C);return F}function p(C,D){return d.dot(C,D)+C[3]}function h(C,D,F,G,J){const I=d.dot(C,F);if(0===I)return!1;C=-(d.dot(C,D)+C[3])/I;G&B.CLAMP&&(C=b.clamp(C,0,1));if(!(G&B.INFINITE_MIN)&&0>C||!(G&B.INFINITE_MAX)&&
1<C)return!1;d.add(J,D,d.scale(J,F,C));return!0}const m=g.create(),u=g.create(),t=g.create(),q=g.create(),z=g.create(),v=[0,0,1,0];var B;(function(C){C[C.NONE=0]="NONE";C[C.CLAMP=1]="CLAMP";C[C.INFINITE_MIN=4]="INFINITE_MIN";C[C.INFINITE_MAX=8]="INFINITE_MAX"})(B||(B={}));const A=B.INFINITE_MIN|B.INFINITE_MAX,E=B.INFINITE_MAX;a.UP=v;a.clip=function(C,D){const F=d.dot(C,D.ray.direction);C=-p(C,D.ray.origin);if(0>C&&0<=F)return!1;if(-1E-6<F&&1E-6>F)return 0<C;if((0>C||0>F)&&!(0>C&&0>F))return!0;C/=
F;0<F?C<D.c1&&(D.c1=C):C>D.c0&&(D.c0=C);return D.c0<=D.c1};a.clipInfinite=function(C,D){const F=d.dot(C,D.ray.direction);C=-p(C,D.ray.origin);if(-1E-6<F&&1E-6>F)return 0<C;C/=F;0<F?C<D.c1&&(D.c1=C):C>D.c0&&(D.c0=C);return D.c0<=D.c1};a.copy=n;a.create=l;a.distance=function(C,D){return Math.abs(p(C,D))};a.fromManyPoints=function(C,D){return r(C,D,0,1,2)};a.fromManyPointsSampleAt=r;a.fromNormalAndOffset=function(C,D,F){d.copy(F,C);F[3]=D;return F};a.fromPoints=k;a.fromPositionAndNormal=e;a.fromValues=
f;a.fromVectorsAndPoint=function(C,D,F,G){d.cross(t,D,C);return e(F,t,G)};a.intersectLine=function(C,D,F,G){F=d.subtract(w.sv3d.get(),F,D);return h(C,D,F,A,G)};a.intersectLineSegment=function(C,D,F){return h(C,D.origin,D.vector,B.NONE,F)};a.intersectLineSegmentClamp=function(C,D,F){return h(C,D.origin,D.vector,B.CLAMP,F)};a.intersectRay=function(C,D,F){return c.isSome(D)?h(C,D.origin,D.direction,E,F):!1};a.isAABBFullyInside=function(C,D){const F=D[0],G=D[1],J=D[2],I=D[3],O=D[4];D=D[5];return 0<=C[0]*
(0<C[0]?F:I)+C[1]*(0<C[1]?G:O)+C[2]*(0<C[2]?J:D)+C[3]};a.isPointInside=function(C,D){return 0<=p(C,D)};a.isPointOutside=function(C,D){return 0>p(C,D)};a.isSphereFullyInside=function(C,D){return 0<=p(C,x.getCenter(D))-D[3]};a.isSphereFullyOutside=function(C,D){return 0>p(C,x.getCenter(D))+D[3]};a.negate=function(C,D){D[0]=-C[0];D[1]=-C[1];D[2]=-C[2];D[3]=-C[3];return D};a.normal=function(C){return C};a.projectPoint=function(C,D,F){const G=d.scale(w.sv3d.get(),C,-C[3]);D=d.subtract(w.sv3d.get(),D,G);
C=y(C,D,w.sv3d.get());d.add(F,C,G);return F};a.projectVector=y;a.setOffsetFromPoint=function(C,D,F){D!==C&&n(C,D);C[3]=-d.dot(C,F);return C};a.signedDistance=p;a.wrap=function(C,D,F,G){return f(C,D,F,G,w.sv4d.get())};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/sphere":function(){define("exports ../core/has ../core/Logger ../core/mathUtils ../core/maybe ./mat4 ./vec3 ./vec3f64 ./vec4 ./vec4f64 ../geometry/support/Axis ../geometry/support/ray ../geometry/support/vector ../geometry/support/vectorStacks".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y){function p(){return f.create()}function h(H,Q=p()){return n.copy(Q,H)}function m(H,Q){return f.fromValues(H[0],H[1],H[2],Q)}function u(H){return H}function t(H){H[0]=H[1]=H[2]=H[3]=0}function q(H){return H}function z(H){return Array.isArray(H)?H[3]:H}function v(H){return Array.isArray(H)?H:T}function B(H,Q,W,V){return f.fromValues(H,Q,W,V)}function A(H,Q,W){H!==W&&w.copy(W,H);W[3]=H[3]+Q;return W}function E(H,Q,W){R.error("sphere.setExtent is not yet supported");
return H===W?W:h(H,W)}function C(H,Q,W){if(g.isNone(Q))return!1;const {origin:V,direction:Y}=Q;var aa=L;aa[0]=V[0]-H[0];aa[1]=V[1]-H[1];aa[2]=V[2]-H[2];Q=Y[0]*Y[0]+Y[1]*Y[1]+Y[2]*Y[2];const X=2*(Y[0]*aa[0]+Y[1]*aa[1]+Y[2]*aa[2]);H=X*X-4*Q*(aa[0]*aa[0]+aa[1]*aa[1]+aa[2]*aa[2]-H[3]*H[3]);if(0>H)return!1;aa=Math.sqrt(H);H=(-X-aa)/(2*Q);Q=(-X+aa)/(2*Q);if(0>H||Q<H&&0<Q)H=Q;if(0>H)return!1;W&&(W[0]=V[0]+Y[0]*H,W[1]=V[1]+Y[1]*H,W[2]=V[2]+Y[2]*H);return!0}function D(H,Q){return C(H,Q,null)}function F(H,
Q,W){if(C(H,Q,W))return W;H=G(H,Q,y.sv3d.get());w.add(W,Q.origin,w.scale(y.sv3d.get(),Q.direction,w.distance(Q.origin,H)/w.length(Q.direction)));return W}function G(H,Q,W){const V=y.sv3d.get(),Y=y.sm4d.get();w.cross(V,Q.origin,Q.direction);const aa=z(H);w.cross(W,V,Q.origin);w.scale(W,W,1/w.length(W)*aa);H=P(H,Q.origin);Q=r.angle(Q.origin,W);x.fromRotation(Y,Q+H,V);w.transformMat4(W,W,Y);return W}function J(H,Q,W){if(C(H,Q,W))return W;k.closestPoint(Q,v(H),W);return I(H,W,W)}function I(H,Q,W){Q=w.subtract(y.sv3d.get(),
Q,v(H));Q=w.scale(y.sv3d.get(),Q,H[3]/w.length(Q));return w.add(W,Q,v(H))}function O(H,Q){Q=w.subtract(y.sv3d.get(),Q,v(H));Q=w.squaredLength(Q);return Math.sqrt(Math.abs(Q-H[3]*H[3]))}function P(H,Q){Q=w.subtract(y.sv3d.get(),Q,v(H));Q=w.length(Q);H=z(H);return d.acosClamped(H/(H+Math.abs(H-Q)))}function K(H,Q,W,V){H=w.subtract(N,Q,v(H));switch(W){case e.Axis.X:return W=d.cartesianToSpherical(H,N)[2],w.set(V,-Math.sin(W),Math.cos(W),0);case e.Axis.Y:return H=d.cartesianToSpherical(H,N),W=H[1],H=
H[2],Q=Math.sin(W),w.set(V,-Q*Math.cos(H),-Q*Math.sin(H),Math.cos(W));case e.Axis.Z:return w.normalize(V,H)}}function M(H,Q){Q=w.subtract(S,Q,v(H));return w.length(Q)-H[3]}function U(H,Q,W,V){const Y=M(H,Q);H=K(H,Q,e.Axis.Z,S);W=w.scale(S,H,W-Y);return w.add(V,Q,W)}const R=c.getLogger("esri.geometry.support.sphere"),L=l.create(),N=l.create(),T=l.create(),S=l.create();b=Object.freeze({__proto__:null,create:p,copy:h,fromCenterAndRadius:m,wrap:u,clear:t,fromRadius:q,getRadius:z,getCenter:v,fromValues:B,
elevate:A,setExtent:E,intersectRay:C,intersectsRay:D,intersectRayClosestSilhouette:F,closestPointOnSilhouette:G,closestPoint:J,projectPoint:I,distanceToSilhouette:O,angleToSilhouette:P,axisAt:K,altitudeAt:M,setAltitudeAt:U});a.altitudeAt=M;a.angleToSilhouette=P;a.axisAt=K;a.clear=t;a.closestPoint=J;a.closestPointOnSilhouette=G;a.copy=h;a.create=p;a.distanceToSilhouette=O;a.elevate=A;a.fromCenterAndRadius=m;a.fromRadius=q;a.fromValues=B;a.getCenter=v;a.getRadius=z;a.intersectRay=C;a.intersectRayClosestSilhouette=
F;a.intersectsRay=D;a.projectPoint=I;a.setAltitudeAt=U;a.setExtent=E;a.sphere=b;a.wrap=u})},"esri/geometry/support/Axis":function(){define(["exports"],function(a){a.Axis=void 0;var b=a.Axis||(a.Axis={});b[b.X=0]="X";b[b.Y=1]="Y";b[b.Z=2]="Z";Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/vector":function(){define(["exports","../../core/mathUtils","../../chunks/vec3","../../chunks/vec3f64"],function(a,b,c,d){const g=d.create(),x=d.create();a.angle=function(w,l){w=c.dot(w,
l)/(c.length(w)*c.length(l));return-b.acosClamped(w)};a.angleAroundAxis=function(w,l,n){c.normalize(g,w);c.normalize(x,l);w=c.dot(g,x);w=b.acosClamped(w);l=c.cross(g,g,x);return 0>c.dot(l,n)?2*Math.PI-w:w};a.projectPoint=function(w,l,n){l=c.dot(w,l)/c.dot(w,w);return c.scale(n,w,l)};a.projectPointSignedLength=function(w,l){return c.dot(w,l)/c.length(w)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/camera/intersectionUtils":function(){define("exports ../../../core/maybe ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projectionEllipsoid ../../../geometry/support/aaBoundingRect ../webgl-engine/lib/Intersector".split(" "),
function(a,b,c,d,g,x,w){function l(p,h){return p.elevationProvider?b.unwrapOr(p.elevationProvider.getElevation(h[0],h[1],h[2],p.renderCoordsHelper.spatialReference,"ground"),0):0}function n(p,h,m){if(!p.state.isGlobal)return!1;const u=l(p,h);({far:p}=p.stateManager.constraintsManager.nearFarHeuristic.compute(h,m,p.renderDataExtent,u,y));p*=p;return c.squaredDistance(h,m)>p}const f={},e=d.create(),k=d.create(),r=d.create(),y={near:0,far:0};a.cameraOnContentAlongViewDirection=function(p,h,m,u){const t=
p.state.camera.clone();h&&(t.eye=h,t.center=m,t.up=u);h=t.ray;m=f[p.viewingMode];m||(m=w.newIntersector(p.state.viewingMode),m.options.backfacesTerrain=!p.state.isGlobal,m.options.invisibleTerrain=!0,f[p.viewingMode]=m);({isGlobal:u}=p.state);p.sceneIntersectionHelper.intersectRay(h,m,k)&&!n(p,h.origin,k)?h=!0:!p.renderCoordsHelper.intersectManifold(h,0,k)||n(p,h.origin,k)?u?(m=g.getReferenceEllipsoid(p.spatialReference).radius,m=c.dot(h.origin,h.origin)-m*m,c.scale(k,h.direction,(0<m?Math.sqrt(m)/
3:1)/c.length(h.direction)),c.add(k,k,h.origin),h=!0):h=!1:h=!0;h||c.copy(k,t.center);m=p.state.constraints;u=m.minimumPoiDistance;c.squaredDistance(t.eye,k)<u&&(h=m.collision.enabled,c.copy(r,t.viewForward),c.scale(r,r,u),h?t.eye=c.subtract(e,k,r):c.add(k,t.eye,r),p=p.renderCoordsHelper,u=p.getAltitude(t.eye),m=m.collision.elevationMargin,h&&u<m&&(c.subtract(r,k,t.eye),t.eye=p.setAltitude(e,m,t.eye),c.add(k,t.eye,r)));t.center=k;return t};a.eyeWithinExtent=function(p,h,m,u){return b.isSome(p.renderCoordsHelper.fromRenderCoords(h.eye,
e,u))&&x.containsPoint(m,e)};a.surfaceElevationBelowRenderLocation=l;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Intersector":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/support/ray ../../../ViewingMode ./IntersectorInterfaces ./intersectorUtils ./verticalOffsetUtils ../materials/renderers/utils".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p){function h(v){return new t(v)}let m=function(){function v(A){this.options=new k.IntersectorOptions;this._results=new u;this.transform=new y.IntersectorTransform;this.tolerance=1E-5;this.verticalOffset=null;this._ray=f.create();this._rayEnd=w.create();this._rayBeginTransformed=w.create();this._rayEndTransformed=w.create();this.viewingMode=null==A?e.ViewingMode.Global:A}var B=v.prototype;B.reset=function(A,E,C){this.resetWithRay(f.fromPoints(A,E,this._ray),C)};
B.resetWithRay=function(A,E){this.camera=E;A!==this._ray&&f.copy(A,this._ray);0!==this.options.verticalOffset?this.viewingMode===e.ViewingMode.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null;x.add(this._rayEnd,this._ray.origin,this._ray.direction);this._results.init(this._ray)};B.intersect=function(A=null,E,C,D,F){this.point=E;this.filterPredicate=D;this.tolerance=null==C?1E-5:C;E=y.getVerticalOffsetObject3D(this.verticalOffset);
if(c.isSome(A)&&0<A.length){const G=F?J=>{F(J)&&this.intersectObject(J)}:J=>{this.intersectObject(J)};for(const J of A)A=J.getSpatialQueryAccelerator&&J.getSpatialQueryAccelerator(),c.isSome(A)?(c.isSome(E)?A.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,G,E):A.forEachAlongRay(this._ray.origin,this._ray.direction,G),this.options.selectionMode&&this.options.hud&&A.forEachDegenerateObject(G)):J.objects.forAll(I=>G(I))}this.sortResults()};B.intersectObject=function(A){const E=
A.geometryRecords;if(E){var C=A.transformation,D=y.getVerticalOffsetObject3D(this.verticalOffset);for(const F of E){const {geometry:G,material:J,instanceParameters:I}=F;if(p.isInstanceHidden(I))continue;const O=G.id;this.transform.setAndInvalidateLazyTransforms(C,F.getShaderTransformation());x.transformMat4(this._rayBeginTransformed,this.rayBegin,this.transform.inverse);x.transformMat4(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const P=this.transform.transform;c.isSome(D)&&(D.objectTransform=
this.transform);J.intersect(G,I,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(K,M,U,R,L,N)=>{0<=K&&(!c.isSome(this.filterPredicate)||this.filterPredicate(this._ray.origin,this._rayEnd,K))&&(R?(null==this._results.hud.dist||K<this._results.hud.dist)&&this._results.hud.set(k.IntersectorType.HUD,{object:A,geometryId:O,triangleNr:U,center:N},K,M,g.IDENTITY,L):((null==this._results.min.drapedLayerOrder||L>=this._results.min.drapedLayerOrder)&&(null==this._results.min.dist||
K<this._results.min.dist)&&this._results.min.set(k.IntersectorType.OBJECT,{object:A,geometryId:O,triangleNr:U},K,M,P,L),this.options.store!==k.StoreResults.MIN&&(null==this._results.max.drapedLayerOrder||L<this._results.max.drapedLayerOrder)&&(null==this._results.max.dist||K>this._results.max.dist)&&this._results.max.set(k.IntersectorType.OBJECT,{object:A,geometryId:O,triangleNr:U},K,M,P,L),this.options.store===k.StoreResults.ALL&&(R=h(this._ray),R.set(k.IntersectorType.OBJECT,{object:A,geometryId:O,
triangleNr:U},K,M,P),this._results.all.push(R))))},F.shaderTransformation)}}};B.sortResults=function(){this._results.all.sort((A,E)=>A.dist!==E.dist?c.unwrapOr(A.dist,0)-c.unwrapOr(E.dist,0):A.drapedLayerOrder!==E.drapedLayerOrder?c.unwrapOr(A.drapedLayerOrder,Number.MAX_VALUE)-c.unwrapOr(E.drapedLayerOrder,Number.MAX_VALUE):c.unwrapOr(E.drapedLayerGraphicOrder,Number.MIN_VALUE)-c.unwrapOr(A.drapedLayerGraphicOrder,Number.MIN_VALUE))};b._createClass(v,[{key:"results",get:function(){return this._results}},
{key:"ray",get:function(){return this._ray}},{key:"rayBegin",get:function(){return this._ray.origin}},{key:"rayEnd",get:function(){return this._rayEnd}}]);return v}(),u=function(){function v(){this._min=new t(f.create());this._max=new t(f.create());this._hud=new t(f.create());this._ground=new t(f.create())}v.prototype.init=function(B){this._min.init(B);this._max.init(B);this._hud.init(B);this._ground.init(B);this.all=[]};b._createClass(v,[{key:"min",get:function(){return this._min}},{key:"max",get:function(){return this._max}},
{key:"hud",get:function(){return this._hud}},{key:"ground",get:function(){return this._ground}}]);return v}(),t=function(){function v(A){this.intersector=k.IntersectorType.OBJECT;this.normal=w.create();this.transformation=g.create();this._ray=f.create();this.init(A)}var B=v.prototype;B.getIntersectionPoint=function(A){if(!r.isValidIntersectorResult(this))return!1;x.scale(q,this.ray.direction,this.dist);x.add(A,this.ray.origin,q);return!0};B.getTransformedNormal=function(A){x.copy(z,this.normal);z[3]=
0;l.transformMat4(z,z,this.transformation);x.copy(A,z);return x.normalize(A,A)};B.init=function(A){this.drapedLayerGraphicOrder=this.drapedLayerOrder=this.target=this.dist=null;this.intersector=k.IntersectorType.OBJECT;f.copy(A,this._ray)};B.set=function(A,E,C,D,F,G,J){this.intersector=A;this.dist=C;x.copy(this.normal,c.unwrapOr(D,w.UNIT_Z));d.copy(this.transformation,c.unwrapOr(F,g.IDENTITY));this.target=E;this.drapedLayerOrder=G;this.drapedLayerGraphicOrder=J};B.copy=function(A){f.copy(A.ray,this._ray);
this.intersector=A.intersector;this.dist=A.dist;this.target=A.target;this.drapedLayerOrder=A.drapedLayerOrder;this.drapedLayerGraphicOrder=A.drapedLayerGraphicOrder;x.copy(this.normal,A.normal);d.copy(this.transformation,A.transformation)};b._createClass(v,[{key:"ray",get:function(){return this._ray}},{key:"distanceInRenderSpace",get:function(){return c.isSome(this.dist)?(x.scale(q,this.ray.direction,this.dist),x.length(q)):null}}]);return v}();const q=w.create(),z=n.create();a.DEFAULT_TOLERANCE=
1E-5;a.newIntersector=function(v){return new m(v)};a.newIntersectorResult=h;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/IntersectorInterfaces":function(){define(["exports"],function(a){a.IntersectorType=void 0;(function(b){b[b.OBJECT=0]="OBJECT";b[b.HUD=1]="HUD";b[b.TERRAIN=2]="TERRAIN";b[b.OVERLAY=3]="OVERLAY";b[b.I3S=4]="I3S";b[b.PCL=5]="PCL";b[b.LOD=6]="LOD";b[b.VOXEL=7]="VOXEL"})(a.IntersectorType||(a.IntersectorType={}));a.StoreResults=void 0;(function(b){b[b.MIN=
0]="MIN";b[b.MINMAX=1]="MINMAX";b[b.ALL=2]="ALL"})(a.StoreResults||(a.StoreResults={}));a.IntersectorOptions=function(){this.verticalOffset=0;this.selectionMode=!1;this.selectOpaqueTerrainOnly=this.hud=!0;this.invisibleTerrain=!1;this.backfacesTerrain=!0;this.isFiltered=!1;this.store=a.StoreResults.ALL};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/intersectorUtils":function(){define("exports ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/boundedPlane ./IntersectorInterfaces".split(" "),
function(a,b,c,d,g,x){function w(n){return b.isSome(n)&&b.isSome(n.dist)}const l=d.create();a.isHudIntersectorResult=function(n){return w(n)&&n.intersector===x.IntersectorType.HUD&&!!n.target&&b.isSome(n.target.center)};a.isObjectIntersectorResult=function(n){return w(n)&&n.intersector===x.IntersectorType.OBJECT&&!!n.target};a.isValidIntersectorResult=w;a.sliceFilterPredicate=function(n){return(f,e,k)=>{c.lerp(l,f,e,k);return!g.extrusionContainsPoint(n,l)}};Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/chunks/boundedPlane":function(){define("exports ../core/has ../core/Logger ../core/mathUtils ../core/ObjectStack ./mat4 ./mat4f64 ./vec3 ./vec3f64 ../geometry/support/Axis ../geometry/support/lineSegment ../geometry/support/plane ../geometry/support/ray ../geometry/support/vector ../geometry/support/vectorStacks".split(" "),function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p){function h(Z=aa){return{plane:k.create(Z.plane),origin:n.clone(Z.origin),basis1:n.clone(Z.basis1),basis2:n.clone(Z.basis2)}}function m(Z,
fa,ja){const la=ka.get();la.origin=Z;la.basis1=fa;la.basis2=ja;la.plane=k.wrap(0,0,0,0);z(la);return la}function u(Z,fa=h()){return q(Z.origin,Z.basis1,Z.basis2,fa)}function t(Z,fa){l.copy(fa.origin,Z.origin);l.copy(fa.basis1,Z.basis1);l.copy(fa.basis2,Z.basis2);k.copy(fa.plane,Z.plane)}function q(Z,fa,ja,la=h()){l.copy(la.origin,Z);l.copy(la.basis1,fa);l.copy(la.basis2,ja);z(la);1E-6<Math.abs(l.dot(la.basis1,la.basis2)/(l.length(la.basis1)*l.length(la.basis2)))&&Y.warn("fromValues()","Provided basis vectors are not perpendicular");
1E-6<Math.abs(l.dot(la.basis1,S(la)))&&Y.warn("fromValues()","Basis vectors and plane normal are not perpendicular");1E-6<Math.abs(-l.dot(S(la),la.origin)-la.plane[3])&&Y.warn("fromValues()","Plane offset is not consistent with plane origin");return la}function z(Z){k.fromVectorsAndPoint(Z.basis2,Z.basis1,Z.origin,Z.plane)}function v(Z,fa,ja){Z!==ja&&u(Z,ja);Z=l.scale(p.sv3d.get(),S(Z),fa);l.add(ja.origin,ja.origin,Z);ja.plane[3]-=fa;return ja}function B(Z,fa,ja){A(fa,ja);v(ja,U(Z,Z.origin),ja);return ja}
function A(Z,fa=h()){const ja=(Z[2]-Z[0])/2,la=(Z[3]-Z[1])/2;l.set(fa.origin,Z[0]+ja,Z[1]+la,0);l.set(fa.basis1,ja,0,0);l.set(fa.basis2,0,la,0);k.fromValues(0,0,1,0,fa.plane);return fa}function E(Z,fa,ja){return k.intersectRay(Z.plane,fa,ja)?H(Z,ja):!1}function C(Z,fa,ja){if(E(Z,fa,ja))return ja;Z=D(Z,fa,p.sv3d.get());l.add(ja,fa.origin,l.scale(p.sv3d.get(),fa.direction,l.distance(fa.origin,Z)/l.length(fa.direction)));return ja}function D(Z,fa,ja){const la=X.get();var ma=X.get();V(Z,fa,la,ma);ma=
Number.POSITIVE_INFINITY;for(const va of ia){var ra=W(Z,va,ba.get());const ya=p.sv3d.get();k.intersectLineSegment(la,ra,ya)&&(ra=l.direction(p.sv3d.get(),fa.origin,ya),ra=Math.abs(d.acosClamped(l.dot(fa.direction,ra))),ra<ma&&(ma=ra,l.copy(ja,ya)))}return ma===Number.POSITIVE_INFINITY?F(Z,fa,ja):ja}function F(Z,fa,ja){if(E(Z,fa,ja))return ja;const la=X.get(),ma=X.get();V(Z,fa,la,ma);let ra=Number.POSITIVE_INFINITY;for(const ya of ia){var va=W(Z,ya,ba.get());const za=p.sv3d.get();k.intersectLineSegmentClamp(la,
va,za)&&(va=r.distance2(fa,za),k.isPointInside(ma,za)&&va<ra&&(ra=va,l.copy(ja,za)))}I(Z,fa.origin)<ra&&G(Z,fa.origin,ja);return ja}function G(Z,fa,ja){var la=k.projectPoint(Z.plane,fa,p.sv3d.get());fa=e.projectPointClamp(Q(Z,Z.basis1),la,-1,1,p.sv3d.get());la=e.projectPointClamp(Q(Z,Z.basis2),la,-1,1,p.sv3d.get());l.subtract(ja,l.add(p.sv3d.get(),fa,la),Z.origin);return ja}function J(Z,fa,ja){const {origin:la,basis1:ma,basis2:ra}=Z,va=l.subtract(p.sv3d.get(),fa,la);fa=y.projectPointSignedLength(ma,
va);const ya=y.projectPointSignedLength(ra,va);Z=y.projectPointSignedLength(S(Z),va);return l.set(ja,fa,ya,Z)}function I(Z,fa){fa=J(Z,fa,p.sv3d.get());const {basis1:ja,basis2:la}=Z;Z=l.length(ja);var ma=l.length(la);Z=Math.max(Math.abs(fa[0])-Z,0);ma=Math.max(Math.abs(fa[1])-ma,0);fa=fa[2];return Z*Z+ma*ma+fa*fa}function O(Z,fa){return Math.sqrt(I(Z,fa))}function P(Z,fa){let ja=Number.NEGATIVE_INFINITY;for(const ma of ia){var la=W(Z,ma,ba.get());la=e.distance2(la,fa);la>ja&&(ja=la)}return Math.sqrt(ja)}
function K(Z,fa){return k.isPointInside(Z.plane,fa)&&H(Z,fa)}function M(Z,fa,ja,la){switch(ja){case f.Axis.X:l.copy(la,Z.basis1);l.normalize(la,la);break;case f.Axis.Y:l.copy(la,Z.basis2);l.normalize(la,la);break;case f.Axis.Z:l.copy(la,S(Z))}return la}function U(Z,fa){const ja=-Z.plane[3];return y.projectPointSignedLength(S(Z),fa)-ja}function R(Z,fa,ja,la){const ma=U(Z,fa);Z=l.scale(ha,S(Z),ja-ma);l.add(la,fa,Z);return la}function L(Z,fa){return l.exactEquals(Z.basis1,fa.basis1)&&l.exactEquals(Z.basis2,
fa.basis2)&&l.exactEquals(Z.origin,fa.origin)}function N(Z,fa,ja){Z!==ja&&u(Z,ja);x.invert(ea,fa);x.transpose(ea,ea);l.transformMat4(ja.basis1,Z.basis1,ea);l.transformMat4(ja.basis2,Z.basis2,ea);l.transformMat4(k.normal(ja.plane),k.normal(Z.plane),ea);l.transformMat4(ja.origin,Z.origin,fa);k.setOffsetFromPoint(ja.plane,ja.plane,ja.origin);return ja}function T(Z,fa,ja,la){Z!==la&&u(Z,la);x.fromRotation(ca,fa,ja);l.transformMat4(la.basis1,Z.basis1,ca);l.transformMat4(la.basis2,Z.basis2,ca);z(la);return la}
function S(Z){return k.normal(Z.plane)}function H(Z,fa){const ja=l.subtract(p.sv3d.get(),fa,Z.origin);fa=l.squaredLength(Z.basis1);const la=l.squaredLength(Z.basis2),ma=l.dot(Z.basis1,ja);Z=l.dot(Z.basis2,ja);return 0>-ma-fa&&0>ma-fa&&0>-Z-la&&0>Z-la}function Q(Z,fa){const ja=ba.get();l.copy(ja.origin,Z.origin);l.copy(ja.vector,fa);return ja}function W(Z,fa,ja){const {basis1:la,basis2:ma,origin:ra}=Z;Z=l.scale(p.sv3d.get(),la,fa.origin[0]);const va=l.scale(p.sv3d.get(),ma,fa.origin[1]);l.add(ja.origin,
Z,va);l.add(ja.origin,ja.origin,ra);Z=l.scale(p.sv3d.get(),la,fa.direction[0]);fa=l.scale(p.sv3d.get(),ma,fa.direction[1]);l.scale(ja.vector,l.add(Z,Z,fa),2);return ja}function V(Z,fa,ja,la){Z=S(Z);k.fromVectorsAndPoint(Z,fa.direction,fa.origin,ja);k.fromVectorsAndPoint(k.normal(ja),Z,fa.origin,la)}const Y=c.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");b=function(){this.plane=k.create();this.origin=n.create();this.basis1=n.create();this.basis2=n.create()};const aa={plane:k.create(),
origin:n.fromValues(0,0,0),basis1:n.fromValues(1,0,0),basis2:n.fromValues(0,1,0)},X=new g.ObjectStack(k.create),ba=new g.ObjectStack(e.create),ha=n.create(),ka=new g.ObjectStack(()=>({origin:null,basis1:null,basis2:null,plane:null})),ia=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],ea=w.create(),ca=w.create();g=Object.freeze({__proto__:null,BoundedPlaneClass:b,create:h,wrap:m,copy:u,copyWithoutVerify:t,fromValues:q,
updateUnboundedPlane:z,elevate:v,setExtent:B,fromAABoundingRect:A,intersectRay:E,intersectRayClosestSilhouette:C,closestPointOnSilhouette:D,closestPoint:F,projectPoint:G,projectPointLocal:J,distance2:I,distance:O,distanceToSilhouette:P,extrusionContainsPoint:K,axisAt:M,altitudeAt:U,setAltitudeAt:R,equals:L,transform:N,rotate:T,normal:S,UP:aa});a.BoundedPlaneClass=b;a.UP=aa;a.altitudeAt=U;a.axisAt=M;a.boundedPlane=g;a.closestPoint=F;a.closestPointOnSilhouette=D;a.copy=u;a.copyWithoutVerify=t;a.create=
h;a.distance=O;a.distance2=I;a.distanceToSilhouette=P;a.elevate=v;a.equals=L;a.extrusionContainsPoint=K;a.fromAABoundingRect=A;a.fromValues=q;a.intersectRay=E;a.intersectRayClosestSilhouette=C;a.normal=S;a.projectPoint=G;a.projectPointLocal=J;a.rotate=T;a.setAltitudeAt=R;a.setExtent=B;a.transform=N;a.updateUnboundedPlane=z;a.wrap=m})},"esri/geometry/support/lineSegment":function(){define("exports ../../core/mathUtils ../../core/ObjectStack ../../chunks/vec3 ../../chunks/vec3f64 ./vectorStacks".split(" "),
function(a,b,c,d,g,x){function w(p){return p?{origin:g.clone(p.origin),vector:g.clone(p.vector)}:{origin:g.create(),vector:g.create()}}function l(p,h){const m=y.get();m.origin=p;m.vector=h;return m}function n(p,h,m=w()){d.copy(m.origin,p);d.copy(m.vector,h);return m}function f(p,h){h=d.subtract(x.sv3d.get(),h,p.origin);var m=d.dot(p.vector,h);const u=d.dot(p.vector,p.vector);m=b.clamp(m/u,0,1);p=d.subtract(x.sv3d.get(),d.scale(x.sv3d.get(),p.vector,m),h);return d.dot(p,p)}function e(p,h,m,u,t){const {vector:q,
origin:z}=p;h=d.subtract(x.sv3d.get(),h,z);h=d.dot(q,h)/d.squaredLength(q);d.scale(t,q,b.clamp(h,m,u));return d.add(t,t,p.origin)}function k(p,h,m,u){const t=p.origin;var q=d.add(x.sv3d.get(),t,p.vector);p=h.origin;var z=d.add(x.sv3d.get(),p,h.vector),v=x.sv3d.get();h=x.sv3d.get();v[0]=t[0]-p[0];v[1]=t[1]-p[1];v[2]=t[2]-p[2];h[0]=z[0]-p[0];h[1]=z[1]-p[1];h[2]=z[2]-p[2];if(1E-6>Math.abs(h[0])&&1E-6>Math.abs(h[1])&&1E-6>Math.abs(h[2]))return!1;z=x.sv3d.get();z[0]=q[0]-t[0];z[1]=q[1]-t[1];z[2]=q[2]-
t[2];if(1E-6>Math.abs(z[0])&&1E-6>Math.abs(z[1])&&1E-6>Math.abs(z[2]))return!1;q=v[0]*h[0]+v[1]*h[1]+v[2]*h[2];var B=h[0]*z[0]+h[1]*z[1]+h[2]*z[2];const A=h[0]*h[0]+h[1]*h[1]+h[2]*h[2],E=(z[0]*z[0]+z[1]*z[1]+z[2]*z[2])*A-B*B;if(1E-6>Math.abs(E))return!1;v=(q*B-(v[0]*z[0]+v[1]*z[1]+v[2]*z[2])*A)/E;q=(q+B*v)/A;m&&(v=b.clamp(v,0,1),q=b.clamp(q,0,1));m=x.sv3d.get();B=x.sv3d.get();m[0]=t[0]+v*z[0];m[1]=t[1]+v*z[1];m[2]=t[2]+v*z[2];B[0]=p[0]+q*h[0];B[1]=p[1]+q*h[1];B[2]=p[2]+q*h[2];u.tA=v;u.tB=q;u.pA=m;
u.pB=B;u.distance2=d.squaredDistance(m,B);return!0}const r={tA:0,tB:0,pA:g.create(),pB:g.create(),distance2:0},y=new c.ObjectStack(()=>({origin:null,vector:null}));a.closestLineSegmentDistance2=function(p,h){return k(p,h,!0,r)?r.distance2:null};a.closestLineSegmentPoint=function(p,h,m){return k(p,h,!0,r)?(d.copy(m,r.pA),!0):!1};a.closestRayDistance2=function(p,h){if(k(p,l(h.origin,h.direction),!1,r)){const {tA:m,pB:u,distance2:t}=r;if(0<=m&&1>=m)return t;if(0>m)return d.squaredDistance(p.origin,u);
if(1<m)return d.squaredDistance(d.add(x.sv3d.get(),p.origin,p.vector),u)}return null};a.copy=function(p,h=w()){return n(p.origin,p.vector,h)};a.create=w;a.distance=function(p,h){return Math.sqrt(f(p,h))};a.distance2=f;a.fromPoints=function(p,h,m=w()){d.copy(m.origin,p);d.subtract(m.vector,h,p);return m};a.fromValues=n;a.pointAt=function(p,h,m){return d.add(m,p.origin,d.scale(m,p.vector,h))};a.projectPoint=function(p,h,m){return e(p,h,0,1,m)};a.projectPointClamp=e;a.wrap=l;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/verticalOffsetUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/quat ../../../../chunks/quatf64 ../../../../chunks/vec3 ../../../../chunks/vec3f32 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../chunks/sphere".split(" "),function(a,b,c,d,g,x,w,l,n,f,
e,k,r,y){let p=function(){function A(){this._transform=w.create();this._transformInverse=new h({value:this._transform},x.invert,w.create);this._transformInverseTranspose=new h(this._transformInverse,x.transpose,w.create);this._transformTranspose=new h({value:this._transform},x.transpose,w.create);this._transformInverseRotation=new h({value:this._transform},d.normalFromMat4Legacy,g.create)}var E=A.prototype;E._invalidateLazyTransforms=function(){this._transformInverse.invalidate();this._transformInverseTranspose.invalidate();
this._transformTranspose.invalidate();this._transformInverseRotation.invalidate()};E.setTransformMatrix=function(C){x.copy(this._transform,C)};E.multiplyTransform=function(C){x.multiply(this._transform,this._transform,C)};E.set=function(C){x.copy(this._transform,C);this._invalidateLazyTransforms()};E.setAndInvalidateLazyTransforms=function(C,D){this.setTransformMatrix(C);this.multiplyTransform(D);this._invalidateLazyTransforms()};b._createClass(A,[{key:"transform",get:function(){return this._transform}},
{key:"inverse",get:function(){return this._transformInverse.value}},{key:"inverseTranspose",get:function(){return this._transformInverseTranspose.value}},{key:"inverseRotation",get:function(){return this._transformInverseRotation.value}},{key:"transpose",get:function(){return this._transformTranspose.value}}]);return A}(),h=function(){function A(E,C,D){this.original=E;this.update=C;this.dirty=!0;this.transform=D()}A.prototype.invalidate=function(){this.dirty=!0};b._createClass(A,[{key:"value",get:function(){this.dirty&&
(this.update(this.transform,this.original.value),this.dirty=!1);return this.transform}}]);return A}(),m=function(){function A(C=0){this.offset=C;this.tmpVertex=k.create()}var E=A.prototype;E.applyToVertex=function(C,D,F){const G=C+this.localOrigin[0],J=D+this.localOrigin[1],I=F+this.localOrigin[2],O=this.offset/Math.sqrt(G*G+J*J+I*I);this.tmpVertex[0]=C+G*O;this.tmpVertex[1]=D+J*O;this.tmpVertex[2]=F+I*O;return this.tmpVertex};E.applyToAabb=function(C){var D=C[0]+this.localOrigin[0];const F=C[1]+
this.localOrigin[1],G=C[2]+this.localOrigin[2],J=C[3]+this.localOrigin[0],I=C[4]+this.localOrigin[1],O=C[5]+this.localOrigin[2],P=this.offset/Math.sqrt(D*D+F*F+G*G);C[0]+=D*P;C[1]+=F*P;C[2]+=G*P;D=this.offset/Math.sqrt(J*J+I*I+O*O);C[3]+=J*D;C[4]+=I*D;C[5]+=O*D;return C};return A}(),u=function(){function A(C=0){this.offset=C;this.componentLocalOriginLength=0;this.tmpVertex=k.create();this.mbs=r.create();this.obb={center:k.create(),halfSize:e.create(),quaternion:null}}var E=A.prototype;E.applyToVertex=
function(C,D,F){const G=F+this.componentLocalOriginLength,J=this.offset/Math.sqrt(C*C+D*D+G*G);this.tmpVertex[0]=C+C*J;this.tmpVertex[1]=D+D*J;this.tmpVertex[2]=F+G*J;return this.tmpVertex};E.applyToAabb=function(C){var D=C[0];const F=C[1],G=C[2]+this.componentLocalOriginLength,J=C[3],I=C[4],O=C[5]+this.componentLocalOriginLength,P=this.offset/Math.sqrt(D*D+F*F+G*G);C[0]+=D*P;C[1]+=F*P;C[2]+=G*P;D=this.offset/Math.sqrt(J*J+I*I+O*O);C[3]+=J*D;C[4]+=I*D;C[5]+=O*D;return C};E.applyToMbs=function(C){const D=
Math.sqrt(C[0]*C[0]+C[1]*C[1]+C[2]*C[2]),F=this.offset/D;this.mbs[0]=C[0]+C[0]*F;this.mbs[1]=C[1]+C[1]*F;this.mbs[2]=C[2]+C[2]*F;this.mbs[3]=C[3]+C[3]*this.offset/D;return this.mbs};E.applyToObb=function(C){var D=C.center;const F=this.offset/Math.sqrt(D[0]*D[0]+D[1]*D[1]+D[2]*D[2]);this.obb.center[0]=D[0]+D[0]*F;this.obb.center[1]=D[1]+D[1]*F;this.obb.center[2]=D[2]+D[2]*F;f.transformQuat(this.obb.halfSize,C.halfSize,C.quaternion);f.add(this.obb.halfSize,this.obb.halfSize,C.center);D=this.offset/
Math.sqrt(this.obb.halfSize[0]*this.obb.halfSize[0]+this.obb.halfSize[1]*this.obb.halfSize[1]+this.obb.halfSize[2]*this.obb.halfSize[2]);this.obb.halfSize[0]+=this.obb.halfSize[0]*D;this.obb.halfSize[1]+=this.obb.halfSize[1]*D;this.obb.halfSize[2]+=this.obb.halfSize[2]*D;f.subtract(this.obb.halfSize,this.obb.halfSize,C.center);l.conjugate(B,C.quaternion);f.transformQuat(this.obb.halfSize,this.obb.halfSize,B);this.obb.halfSize[0]*=0>this.obb.halfSize[0]?-1:1;this.obb.halfSize[1]*=0>this.obb.halfSize[1]?
-1:1;this.obb.halfSize[2]*=0>this.obb.halfSize[2]?-1:1;this.obb.quaternion=C.quaternion;return this.obb};b._createClass(A,[{key:"localOrigin",set:function(C){this.componentLocalOriginLength=Math.sqrt(C[0]*C[0]+C[1]*C[1]+C[2]*C[2])}}]);return A}(),t=function(){function A(C=0){this.offset=C;this.sphere=y.create();this.tmpVertex=k.create()}var E=A.prototype;E.applyToVertex=function(C,D,F){const G=this.objectTransform.transform;let J=G[0]*C+G[4]*D+G[8]*F+G[12],I=G[1]*C+G[5]*D+G[9]*F+G[13];C=G[2]*C+G[6]*
D+G[10]*F+G[14];D=this.offset/Math.sqrt(J*J+I*I+C*C);J+=J*D;I+=I*D;C+=C*D;D=this.objectTransform.inverse;this.tmpVertex[0]=D[0]*J+D[4]*I+D[8]*C+D[12];this.tmpVertex[1]=D[1]*J+D[5]*I+D[9]*C+D[13];this.tmpVertex[2]=D[2]*J+D[6]*I+D[10]*C+D[14];return this.tmpVertex};E.applyToMinMax=function(C,D){const F=this.offset/Math.sqrt(C[0]*C[0]+C[1]*C[1]+C[2]*C[2]);C[0]+=C[0]*F;C[1]+=C[1]*F;C[2]+=C[2]*F;C=this.offset/Math.sqrt(D[0]*D[0]+D[1]*D[1]+D[2]*D[2]);D[0]+=D[0]*C;D[1]+=D[1]*C;D[2]+=D[2]*C};E.applyToAabb=
function(C){var D=this.offset/Math.sqrt(C[0]*C[0]+C[1]*C[1]+C[2]*C[2]);C[0]+=C[0]*D;C[1]+=C[1]*D;C[2]+=C[2]*D;D=this.offset/Math.sqrt(C[3]*C[3]+C[4]*C[4]+C[5]*C[5]);C[3]+=C[3]*D;C[4]+=C[4]*D;C[5]+=C[5]*D;return C};E.applyToBoundingSphere=function(C){const D=Math.sqrt(C[0]*C[0]+C[1]*C[1]+C[2]*C[2]),F=this.offset/D;this.sphere[0]=C[0]+C[0]*F;this.sphere[1]=C[1]+C[1]*F;this.sphere[2]=C[2]+C[2]*F;this.sphere[3]=C[3]+C[3]*this.offset/D;return this.sphere};return A}();const q=new t,z=new u,v=new m,B=n.create();
a.I3SVerticalOffsetGlobalViewingMode=u;a.IntersectorTransform=p;a.Object3DVerticalOffsetGlobalViewingMode=t;a.TERRAIN_ID="terrain";a.TerrainVerticalOffsetGlobalViewingMode=m;a.getVerticalOffsetI3S=function(A){return c.isSome(A)?(z.offset=A,z):null};a.getVerticalOffsetObject3D=function(A){return c.isSome(A)?(q.offset=A,q):null};a.getVerticalOffsetTerrain=function(A){return c.isSome(A)?(v.offset=A,v):null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/quat":function(){define("exports ./mat3f64 ./quatf64 ./vec3f64 ./common ./vec3 ./vec4".split(" "),
function(a,b,c,d,g,x,w){function l(H){H[0]=0;H[1]=0;H[2]=0;H[3]=1;return H}function n(H,Q,W){W*=.5;const V=Math.sin(W);H[0]=V*Q[0];H[1]=V*Q[1];H[2]=V*Q[2];H[3]=Math.cos(W);return H}function f(H,Q){const W=2*Math.acos(Q[3]),V=Math.sin(W/2);V>g.EPSILON?(H[0]=Q[0]/V,H[1]=Q[1]/V,H[2]=Q[2]/V):(H[0]=1,H[1]=0,H[2]=0);return W}function e(H,Q,W){const V=Q[0],Y=Q[1],aa=Q[2];Q=Q[3];const X=W[0],ba=W[1],ha=W[2];W=W[3];H[0]=V*W+Q*X+Y*ha-aa*ba;H[1]=Y*W+Q*ba+aa*X-V*ha;H[2]=aa*W+Q*ha+V*ba-Y*X;H[3]=Q*W-V*X-Y*ba-aa*
ha;return H}function k(H,Q,W){W*=.5;const V=Q[0],Y=Q[1],aa=Q[2];Q=Q[3];const X=Math.sin(W);W=Math.cos(W);H[0]=V*W+Q*X;H[1]=Y*W+aa*X;H[2]=aa*W-Y*X;H[3]=Q*W-V*X;return H}function r(H,Q,W){W*=.5;const V=Q[0],Y=Q[1],aa=Q[2];Q=Q[3];const X=Math.sin(W);W=Math.cos(W);H[0]=V*W-aa*X;H[1]=Y*W+Q*X;H[2]=aa*W+V*X;H[3]=Q*W-Y*X;return H}function y(H,Q,W){W*=.5;const V=Q[0],Y=Q[1],aa=Q[2];Q=Q[3];const X=Math.sin(W);W=Math.cos(W);H[0]=V*W+Y*X;H[1]=Y*W-V*X;H[2]=aa*W+Q*X;H[3]=Q*W-aa*X;return H}function p(H,Q){const W=
Q[0],V=Q[1];Q=Q[2];H[0]=W;H[1]=V;H[2]=Q;H[3]=Math.sqrt(Math.abs(1-W*W-V*V-Q*Q));return H}function h(H,Q,W,V){const Y=Q[0],aa=Q[1],X=Q[2];Q=Q[3];let ba=W[0],ha=W[1],ka=W[2];W=W[3];let ia;let ea;var ca=Y*ba+aa*ha+X*ka+Q*W;0>ca&&(ca=-ca,ba=-ba,ha=-ha,ka=-ka,W=-W);1-ca>g.EPSILON?(ia=Math.acos(ca),ea=Math.sin(ia),ca=Math.sin((1-V)*ia)/ea,V=Math.sin(V*ia)/ea):ca=1-V;H[0]=ca*Y+V*ba;H[1]=ca*aa+V*ha;H[2]=ca*X+V*ka;H[3]=ca*Q+V*W;return H}function m(H){var Q=g.RANDOM();const W=g.RANDOM(),V=g.RANDOM(),Y=Math.sqrt(1-
Q);Q=Math.sqrt(Q);H[0]=Y*Math.sin(2*Math.PI*W);H[1]=Y*Math.cos(2*Math.PI*W);H[2]=Q*Math.sin(2*Math.PI*V);H[3]=Q*Math.cos(2*Math.PI*V);return H}function u(H,Q){const W=Q[0],V=Q[1],Y=Q[2];Q=Q[3];var aa=W*W+V*V+Y*Y+Q*Q;aa=aa?1/aa:0;H[0]=-W*aa;H[1]=-V*aa;H[2]=-Y*aa;H[3]=Q*aa;return H}function t(H,Q){H[0]=-Q[0];H[1]=-Q[1];H[2]=-Q[2];H[3]=Q[3];return H}function q(H,Q){var W=Q[0]+Q[4]+Q[8];if(0<W)W=Math.sqrt(W+1),H[3]=.5*W,W=.5/W,H[0]=(Q[5]-Q[7])*W,H[1]=(Q[6]-Q[2])*W,H[2]=(Q[1]-Q[3])*W;else{let V=0;Q[4]>
Q[0]&&(V=1);Q[8]>Q[3*V+V]&&(V=2);const Y=(V+1)%3,aa=(V+2)%3;W=Math.sqrt(Q[3*V+V]-Q[3*Y+Y]-Q[3*aa+aa]+1);H[V]=.5*W;W=.5/W;H[3]=(Q[3*Y+aa]-Q[3*aa+Y])*W;H[Y]=(Q[3*Y+V]+Q[3*V+Y])*W;H[aa]=(Q[3*aa+V]+Q[3*V+aa])*W}return H}function z(H,Q,W,V){var Y=.5*Math.PI/180;Q*=Y;W*=Y;V*=Y;Y=Math.sin(Q);Q=Math.cos(Q);const aa=Math.sin(W);W=Math.cos(W);const X=Math.sin(V);V=Math.cos(V);H[0]=Y*W*V-Q*aa*X;H[1]=Q*aa*V+Y*W*X;H[2]=Q*W*X-Y*aa*V;H[3]=Q*W*V+Y*aa*X;return H}function v(H){return"quat("+H[0]+", "+H[1]+", "+H[2]+
", "+H[3]+")"}function B(H,Q,W){const V=x.dot(Q,W);if(-.999999>V)return x.cross(U,R,Q),1E-6>x.len(U)&&x.cross(U,L,Q),x.normalize(U,U),n(H,U,Math.PI),H;if(.999999<V)return H[0]=0,H[1]=0,H[2]=0,H[3]=1,H;x.cross(U,Q,W);H[0]=U[0];H[1]=U[1];H[2]=U[2];H[3]=1+V;return K(H,H)}function A(H,Q,W,V,Y,aa){h(N,Q,Y,aa);h(T,W,V,aa);h(H,N,T,2*aa*(1-aa));return H}function E(H,Q,W,V){const Y=S;Y[0]=W[0];Y[3]=W[1];Y[6]=W[2];Y[1]=V[0];Y[4]=V[1];Y[7]=V[2];Y[2]=-Q[0];Y[5]=-Q[1];Y[8]=-Q[2];return K(H,q(H,Y))}const C=w.copy,
D=w.set,F=w.add,G=w.scale,J=w.dot,I=w.lerp,O=w.length,P=w.squaredLength,K=w.normalize,M=w.exactEquals;w=w.equals;const U=d.create(),R=d.fromValues(1,0,0),L=d.fromValues(0,1,0),N=c.create(),T=c.create(),S=b.create();b=Object.freeze({__proto__:null,identity:l,setAxisAngle:n,getAxisAngle:f,multiply:e,rotateX:k,rotateY:r,rotateZ:y,calculateW:p,slerp:h,random:m,invert:u,conjugate:t,fromMat3:q,fromEuler:z,str:v,copy:C,set:D,add:F,mul:e,scale:G,dot:J,lerp:I,length:O,len:O,squaredLength:P,sqrLen:P,normalize:K,
exactEquals:M,equals:w,rotationTo:B,sqlerp:A,setAxes:E});a.add=F;a.calculateW=p;a.conjugate=t;a.copy=C;a.dot=J;a.equals=w;a.exactEquals=M;a.fromEuler=z;a.fromMat3=q;a.getAxisAngle=f;a.identity=l;a.invert=u;a.len=O;a.length=O;a.lerp=I;a.mul=e;a.multiply=e;a.normalize=K;a.quat=b;a.random=m;a.rotateX=k;a.rotateY=r;a.rotateZ=y;a.rotationTo=B;a.scale=G;a.set=D;a.setAxes=E;a.setAxisAngle=n;a.slerp=h;a.sqlerp=A;a.sqrLen=P;a.squaredLength=P;a.str=v})},"esri/chunks/vec3f32":function(){define(["exports"],function(a){function b(){return new Float32Array(3)}
function c(m){const u=new Float32Array(3);u[0]=m[0];u[1]=m[1];u[2]=m[2];return u}function d(m,u,t){const q=new Float32Array(3);q[0]=m;q[1]=u;q[2]=t;return q}function g(m,u){return new Float32Array(m,u,3)}function x(){return b()}function w(){return d(1,1,1)}function l(){return d(1,0,0)}function n(){return d(0,1,0)}function f(){return d(0,0,1)}const e=b(),k=w(),r=l(),y=n(),p=f(),h=Object.freeze({__proto__:null,create:b,clone:c,fromValues:d,createView:g,zeros:x,ones:w,unitX:l,unitY:n,unitZ:f,ZEROS:e,
ONES:k,UNIT_X:r,UNIT_Y:y,UNIT_Z:p});a.ONES=k;a.UNIT_X=r;a.UNIT_Y=y;a.UNIT_Z=p;a.ZEROS=e;a.clone=c;a.create=b;a.createView=g;a.fromValues=d;a.ones=w;a.unitX=l;a.unitY=n;a.unitZ=f;a.vec3f32=h;a.zeros=x})},"esri/views/3d/webgl-engine/materials/renderers/utils":function(){define("exports ../../../../../core/maybe ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../lib/Util ../../../../webgl/doublePrecisionUtils".split(" "),function(a,b,c,d,g,x){const w=new Float64Array(3),l=new Float32Array(6),
n=d.create();a.addObject3DStateID=function(f,e){b.isNone(f)&&(f=[]);f.push(e);return f};a.calculateTransformRelativeToOrigin=function(f,e,k){const r=f.origin.vec3;g.setMatrixTranslation3(n,-r[0],-r[1],-r[2]);b.isSome(f.transformation)?c.multiply(e,n,f.transformation):c.copy(e,n);k&&(c.invert(k,e),c.transpose(k,k))};a.encodeDoubleVec3=function(f,e,k,r,y){w[0]=f.get(e,0);w[1]=f.get(e,1);w[2]=f.get(e,2);x.encodeDoubleArray(w,l,3);k.set(y,0,l[0]);r.set(y,0,l[1]);k.set(y,1,l[2]);r.set(y,1,l[3]);k.set(y,
2,l[4]);r.set(y,2,l[5])};a.isInstanceHidden=function(f){return b.isSome(f)?!f.visible:!1};a.removeObject3DStateID=function(f,e){if(b.isNone(f))return null;f=f.filter(k=>k!==e);return 0===f.length?null:f};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Util":function(){define(["exports","../../../../chunks/vec2","../../../../chunks/vec2f64","../../../../chunks/vec4","../../../../chunks/vec4f64"],function(a,b,c,d,g){function x(n,f){if(!n)throw f=f||"assert",console.log(Error(f).stack),
new l(f);}const w=g.create();let l=function(){function n(f){this.message=f}n.prototype.toString=function(){return`AssertException: ${this.message}`};return n}();a.assert=x;a.fovd2fovx=function(n,f,e){return 2*Math.atan(f*Math.tan(.5*n)/Math.sqrt(f*f+e*e))};a.fovd2fovy=function(n,f,e){return 2*Math.atan(e*Math.tan(.5*n)/Math.sqrt(f*f+e*e))};a.fovx2fovd=function(n,f,e){return 2*Math.atan(Math.sqrt(f*f+e*e)*Math.tan(.5*n)/f)};a.fovy2fovd=function(n,f,e){return 2*Math.atan(Math.sqrt(f*f+e*e)*Math.tan(.5*
n)/e)};a.inverseProjectionInfo=function(n,f,e,k,r){0===n[11]?(k[0]=2/(f*n[0]),k[1]=2/(e*n[5]),k[2]=(1+n[12])/n[0],k[3]=(1+n[13])/n[5],b.set(r,0,1)):(k[0]=-2/(f*n[0]),k[1]=-2/(e*n[5]),k[2]=(1-n[8])/n[0],k[3]=(1-n[9])/n[5],b.set(r,1,0))};a.isTranslationMatrix=function(n){return 1===n[0]&&0===n[1]&&0===n[2]&&0===n[3]&&0===n[4]&&1===n[5]&&0===n[6]&&0===n[7]&&0===n[8]&&0===n[9]&&1===n[10]&&0===n[11]&&1===n[15]};a.logWithBase=function(n,f){return Math.log(n)/Math.log(f)};a.project=function(n,f,e,k,r){r||
(r=n);w[0]=n[0];w[1]=n[1];w[2]=n[2];w[3]=1;d.transformMat4(w,w,f);2<r.length&&(r[2]=-w[2]);d.transformMat4(w,w,e);x(0!==w[3]);r[0]=w[0]/w[3];r[1]=w[1]/w[3];r[2]=w[2]/w[3];r[0]=(.5*r[0]+.5)*k[2]+k[0];r[1]=(.5*r[1]+.5)*k[3]+k[1]};a.rayBoxTest=function(n,f,e,k){let r,y=(e[0]-n[0])/f[0],p=(k[0]-n[0])/f[0];y>p&&(r=y,y=p,p=r);let h=(e[1]-n[1])/f[1],m=(k[1]-n[1])/f[1];h>m&&(r=h,h=m,m=r);if(y>m||h>p)return!1;h>y&&(y=h);m<p&&(p=m);e=(e[2]-n[2])/f[2];n=(k[2]-n[2])/f[2];e>n&&(r=e,e=n,n=r);if(y>n||e>p)return!1;
n<p&&(p=n);return 0>p?!1:!0};a.rayRay2D=function(n,f,e,k,r,y=c.create()){const p=(k[r]-e[r])*(f[0]-n[0])-(k[0]-e[0])*(f[r]-n[r]);if(0===p)return!1;e=((k[0]-e[0])*(n[r]-e[r])-(k[r]-e[r])*(n[0]-e[0]))/p;y[0]=n[0]+e*(f[0]-n[0]);y[1]=n[r]+e*(f[r]-n[r]);return!0};a.setMatrixTranslation3=function(n,f,e,k){n[12]=f;n[13]=e;n[14]=k};a.verify=function(n,f){n||console.warn("Verify failed: "+(f||"")+"\n"+Error("verify").stack)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/vec2":function(){define(["exports",
"./common"],function(a,b){function c(L,N){L[0]=N[0];L[1]=N[1];return L}function d(L,N,T){L[0]=N;L[1]=T;return L}function g(L,N,T){L[0]=N[0]+T[0];L[1]=N[1]+T[1];return L}function x(L,N,T){L[0]=N[0]-T[0];L[1]=N[1]-T[1];return L}function w(L,N,T){L[0]=N[0]*T[0];L[1]=N[1]*T[1];return L}function l(L,N,T){L[0]=N[0]/T[0];L[1]=N[1]/T[1];return L}function n(L,N){L[0]=Math.ceil(N[0]);L[1]=Math.ceil(N[1]);return L}function f(L,N){L[0]=Math.floor(N[0]);L[1]=Math.floor(N[1]);return L}function e(L,N,T){L[0]=Math.min(N[0],
T[0]);L[1]=Math.min(N[1],T[1]);return L}function k(L,N,T){L[0]=Math.max(N[0],T[0]);L[1]=Math.max(N[1],T[1]);return L}function r(L,N){L[0]=Math.round(N[0]);L[1]=Math.round(N[1]);return L}function y(L,N,T){L[0]=N[0]*T;L[1]=N[1]*T;return L}function p(L,N,T,S){L[0]=N[0]+T[0]*S;L[1]=N[1]+T[1]*S;return L}function h(L,N){const T=N[0]-L[0];L=N[1]-L[1];return Math.sqrt(T*T+L*L)}function m(L,N){const T=N[0]-L[0];L=N[1]-L[1];return T*T+L*L}function u(L){const N=L[0];L=L[1];return Math.sqrt(N*N+L*L)}function t(L){const N=
L[0];L=L[1];return N*N+L*L}function q(L,N){L[0]=-N[0];L[1]=-N[1];return L}function z(L,N){L[0]=1/N[0];L[1]=1/N[1];return L}function v(L,N){var T=N[0];const S=N[1];T=T*T+S*S;0<T&&(T=1/Math.sqrt(T),L[0]=N[0]*T,L[1]=N[1]*T);return L}function B(L,N){return L[0]*N[0]+L[1]*N[1]}function A(L,N,T){N=N[0]*T[1]-N[1]*T[0];L[0]=L[1]=0;L[2]=N;return L}function E(L,N,T,S){const H=N[0];N=N[1];L[0]=H+S*(T[0]-H);L[1]=N+S*(T[1]-N);return L}function C(L,N){N=N||1;const T=2*b.RANDOM()*Math.PI;L[0]=Math.cos(T)*N;L[1]=
Math.sin(T)*N;return L}function D(L,N,T){const S=N[0];N=N[1];L[0]=T[0]*S+T[2]*N;L[1]=T[1]*S+T[3]*N;return L}function F(L,N,T){const S=N[0];N=N[1];L[0]=T[0]*S+T[2]*N+T[4];L[1]=T[1]*S+T[3]*N+T[5];return L}function G(L,N,T){const S=N[0];N=N[1];L[0]=T[0]*S+T[3]*N+T[6];L[1]=T[1]*S+T[4]*N+T[7];return L}function J(L,N,T){const S=N[0];N=N[1];L[0]=T[0]*S+T[4]*N+T[12];L[1]=T[1]*S+T[5]*N+T[13];return L}function I(L,N,T,S){const H=N[0]-T[0];N=N[1]-T[1];const Q=Math.sin(S);S=Math.cos(S);L[0]=H*S-N*Q+T[0];L[1]=
H*Q+N*S+T[1];return L}function O(L,N){var T=L[0];L=L[1];const S=N[0];N=N[1];let H=T*T+L*L;0<H&&(H=1/Math.sqrt(H));let Q=S*S+N*N;0<Q&&(Q=1/Math.sqrt(Q));T=(T*S+L*N)*H*Q;return 1<T?0:-1>T?Math.PI:Math.acos(T)}function P(L){return"vec2("+L[0]+", "+L[1]+")"}function K(L,N){return L[0]===N[0]&&L[1]===N[1]}function M(L,N){const T=L[0];L=L[1];const S=N[0];N=N[1];return Math.abs(T-S)<=b.EPSILON*Math.max(1,Math.abs(T),Math.abs(S))&&Math.abs(L-N)<=b.EPSILON*Math.max(1,Math.abs(L),Math.abs(N))}function U(L,
N,T,S,H){let Q=N[0]-T[0];T=N[1]-T[1];H=(S[0]*Q+S[1]*T)*(H-1);Q=S[0]*H;T=S[1]*H;L[0]=N[0]+Q;L[1]=N[1]+T;return L}const R=Object.freeze({__proto__:null,copy:c,set:d,add:g,subtract:x,multiply:w,divide:l,ceil:n,floor:f,min:e,max:k,round:r,scale:y,scaleAndAdd:p,distance:h,squaredDistance:m,length:u,squaredLength:t,negate:q,inverse:z,normalize:v,dot:B,cross:A,lerp:E,random:C,transformMat2:D,transformMat2d:F,transformMat3:G,transformMat4:J,rotate:I,angle:O,str:P,exactEquals:K,equals:M,projectAndScale:U,
len:u,sub:x,mul:w,div:l,dist:h,sqrDist:m,sqrLen:t});a.add=g;a.angle=O;a.ceil=n;a.copy=c;a.cross=A;a.dist=h;a.distance=h;a.div=l;a.divide=l;a.dot=B;a.equals=M;a.exactEquals=K;a.floor=f;a.inverse=z;a.len=u;a.length=u;a.lerp=E;a.max=k;a.min=e;a.mul=w;a.multiply=w;a.negate=q;a.normalize=v;a.projectAndScale=U;a.random=C;a.rotate=I;a.round=r;a.scale=y;a.scaleAndAdd=p;a.set=d;a.sqrDist=m;a.sqrLen=t;a.squaredDistance=m;a.squaredLength=t;a.str=P;a.sub=x;a.subtract=x;a.transformMat2=D;a.transformMat2d=F;a.transformMat3=
G;a.transformMat4=J;a.vec2=R})},"esri/views/webgl/doublePrecisionUtils":function(){define(["exports"],function(a){function b(g,x,w){for(let l=0;l<w;++l)x[2*l]=g[l],x[2*l+1]=g[l]-x[2*l]}const c=new Float64Array(1),d=new Float32Array(2);a.decodeDoubleArray=function(g,x,w){for(let l=0;l<w;++l)x[l]=g[2*l]+g[2*l+1]};a.encodeDouble=function(g,x){d[0]=g;d[1]=g-d[0];x[0]=d[0];x[1]=d[1]};a.encodeDoubleArray=b;a.encodeDoubleArraySplit=function(g,x,w,l){for(let n=0;n<l;++n)c[0]=g[n],b(c,d,1),x[n]=d[0],w[n]=
d[1]};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/cameraUtils":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../Camera ../../../core/Logger ../../../core/mathUtils ../../../core/maybe ../../../core/promiseUtils ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/Point ../../../geometry/projection ../../../geometry/projectionEllipsoid ../../../geometry/SpatialReference ../../../geometry/support/scaleUtils ../../ViewingMode ../camera/intersectionUtils ../../../chunks/cameraUtilsPlanar ../../../chunks/cameraUtilsSpherical ./earthUtils ./ElevationProvider ./mathUtils ../../support/spatialReferenceSupport".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v){function B(X){return"global"===X.viewingMode?u.cameraUtilsSpherical:m.cameraUtilsPlanar}function A(X,ba,ha){const ka=X.state.camera,ia=ka.width/2/ka.pixelRatio;X.renderCoordsHelper.viewingMode===p.ViewingMode.Global&&null!=ha&&(ba*=Math.cos(g.deg2rad(ha)));ba/=X.renderCoordsHelper.unitInMeters;return ia/(96*39.37/ba)/Math.tan(ka.fovX/2)}function E(X,ba,ha){const ka=X.state.camera;ba=96*39.37/(ka.width/2/ka.pixelRatio/(ba*Math.tan(ka.fovX/2)));
X.renderCoordsHelper.viewingMode===p.ViewingMode.Global&&(ba/=Math.cos(g.deg2rad(ha)));return ba*=X.renderCoordsHelper.unitInMeters}function C(X,ba,ha,ka,ia,ea){if(L(ea)){const ca=new aa(ea.signal);K(X,ka.heading,ka.tilt,ba,ha,ia,ca);ca.resolver.promise.then(Z=>{Z=R(X,Z,ka.fov);if(x.isNone(Z))ea.resolver.reject();else return ea.resolver.resolve(Z)},Z=>ea.resolver.reject(Z))}else return ba=K(X,ka.heading,ka.tilt,ba,ha,ia),R(X,ba,ka.fov,ea)}function D(X,ba,ha,ka,ia){return B(X).directionToHeadingTilt(ba,
ha,ka,ia)}function F(X,ba){return!!(X.basemapTerrain&&X.renderCoordsHelper.fromRenderCoords(ba,Q,X.spatialReference)&&x.unwrapOr(q.getElevationAtPoint(X.elevationProvider,Q),0)>Q.z-1)}function G(X,ba,ha){return J.apply(this,arguments)}function J(){J=b._asyncToGenerator(function*(X,ba,ha){if(!X.renderCoordsHelper.fromRenderCoords(ba,Q,X.spatialReference))return!1;X=yield X.elevationProvider.queryElevation(Q.x,Q.y,Q.z,Q.spatialReference,"ground",ha);return x.unwrapOr(X,0)>Q.z-1});return J.apply(this,
arguments)}function I(X,ba,ha){return O.apply(this,arguments)}function O(){O=b._asyncToGenerator(function*(X,ba,ha){const ka=n.create();ba?ba instanceof f?(e.projectPointToVector(ba,ka,X.renderSpatialReference),null==ba.z&&null!=X.basemapTerrain&&(ba=yield X.elevationProvider.queryElevation(ba.x,ba.y,ba.z,ba.spatialReference,"ground",ha),x.isSome(ba)&&X.renderCoordsHelper.setAltitude(ka,ba))):l.copy(ka,ba):l.copy(ka,X.state.camera.center);return ka});return O.apply(this,arguments)}function P(X,ba){const ha=
n.create();ba&&ba instanceof f?(e.projectPointToVector(ba,ha,X.renderSpatialReference),null==ba.z&&null!=X.basemapTerrain&&(ba=q.getElevationAtPoint(X.elevationProvider,ba),x.isSome(ba)&&X.renderCoordsHelper.setAltitude(ha,ba))):ba?l.copy(ha,ba):l.copy(ha,X.state.camera.center);return ha}function K(X,ba,ha,ka,ia,ea,ca){const Z=ka&&ka instanceof f?ka:null;if(L(ca))return I(X,ka,ca.signal).then(fa=>{M(X,ba,ha,Z,fa,ia,ea,ca)},fa=>ca.resolver.reject(fa)),null;ka=P(X,ka);return M(X,ba,ha,Z,ka,ia,ea,ca)}
function M(X,ba,ha,ka,ia,ea,ca,Z){if(x.isNone(ka)&&(ka=e.projectVectorToPoint(ia,X.renderSpatialReference,X.spatialReference||r.WGS84),x.isNone(ka)))return null;ea=Math.max(ea,X.state.constraints.minimumPoiDistance);var fa=U(X,ba,ha,ia,ea,ca);const ja=B(X).eyeForCenterWithHeadingTilt,la=ja(ia,ea,fa.heading,fa.tilt);if(ca===a.OrientationMode.ADJUST&&"global"===X.viewingMode&&0<ha){const ma=()=>{var ra=ea,va=ea;var ya=X.state.constraints.tilt(va);va=B(X).eyeTiltToLookAtTilt(ha,ia,va);va=Math.min(va,
.5*Math.PI);ya=ya.min*(1-.7)+.7*va;ra=B(X).lookAtTiltToEyeTilt(ya,ia,ra);ca=1>ha-ra?a.OrientationMode.LOCKED:a.OrientationMode.ADJUST;return M(X,ba,ra,ka,ia,ea,ca,Z)};fa=X.map.ground.navigationConstraint;if(!fa||"stay-above"===fa.type){if(F(X,la.eye))return ma();if(L(Z))return G(X,la.eye,Z.signal).then(ra=>{if(ra)return ma();Z.resolver.resolve({eye:la.eye,up:la.up,center:n.clone(ia),heading:la.heading,tilt:la.tilt});return null}),null}}fa=!Z||L(Z)?{center:n.create(),eye:n.create(),up:n.create(),tilt:0,
heading:0}:Z;fa.eye=la.eye;fa.up=la.up;fa.center=n.clone(ia);fa.heading=la.heading;fa.tilt=la.tilt;L(Z)&&Z.resolver.resolve(fa);return fa}function U(X,ba,ha,ka,ia,ea){var ca=0;if(ea=ea===a.OrientationMode.ADJUST)if(ca=X.pointsOfInterest.centerOnSurfaceFrequent.distance,8<Math.log(ia/ca)/Math.LN2)ea=!0;else{var Z=X.renderSpatialReference,fa=X.spatialReference||r.WGS84;ea=e.projectVectorToPoint(ka,Z,fa);Z=e.projectVectorToPoint(X.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,Z,fa);x.isNone(ea)||
x.isNone(Z)?ea=!1:(ca*=Math.tan(.5*X.state.camera.fov),ea=5<Z.distance(ea)/ca)}ea?(ba=0,ea=X.state.constraints.tilt(ia),ea.max=Math.min(ea.max,.5*Math.PI),ea=ea.min*(1-.7)+.7*ea.max,ha=B(X).eyeTiltToLookAtTilt(ha,ka,ia),ca=Math.min(ha,ea)):ca=B(X).eyeTiltToLookAtTilt(ha,ka,ia);ha=ca=X.state.constraints.clampTilt(ia,ca);ha=B(X).lookAtTiltToEyeTilt(ha,ka,ia);return{heading:ba,tilt:ha}}function R(X,ba,ha,ka){if(x.isNone(ba))return null;X=e.projectVectorToPoint(ba.eye,X.renderSpatialReference,X.spatialReference||
r.WGS84);return x.isNone(X)?null:x.isSome(ka)?(ka.position=X,ka.heading=ba.heading,ka.tilt=ba.tilt,ka.fov=ha,ka):new c(X,ba.heading,ba.tilt,ha)}function L(X){return X&&"resolver"in X}const N=d.getLogger("esri.views.3d.support.cameraUtils"),T=n.create(),S=n.create(),H={heading:0,tilt:0},Q=new f,W=new z.Cyclical(-2.0037508342788905E7,2.0037508342788905E7),V=new z.Cyclical(-180,180);a.OrientationMode=void 0;(function(X){X[X.LOCKED=0]="LOCKED";X[X.ADJUST=1]="ADJUST"})(a.OrientationMode||(a.OrientationMode=
{}));const Y=n.create();let aa=function(X){this.signal=X;this.resolver=w.createResolver()};a.AsyncContext=aa;a.computeScale=function(X,ba,ha){const ka=X.renderSpatialReference;ba||(ba=X.state.camera);var ia=r.WGS84;ba instanceof c?(ia=ba.position.latitude,e.projectPointToVector(ba.position,T,ka),e.projectPointToVector(ha,S,ka),ba=l.distance(T,S)):(e.projectVectorToVector(ba.center,ka,S,ia),ia=S[1],ba=ba.distance);return E(X,ba,ia)};a.directionToHeadingTilt=D;a.distanceToScale=E;a.externalToInternal=
function(X,ba){if(x.isNone(ba))return null;var ha=X.renderSpatialReference;const ka=B(X).headingTiltToDirectionUp,ia=n.create();if(!e.projectPointToVector(ba.position,ia,ha))return null;ha=ka(ia,ba.heading,ba.tilt);l.scale(ha.direction,ha.direction,X.state.camera.distance);l.add(ha.direction,ha.direction,ia);X=h.cameraOnContentAlongViewDirection(X,ia,ha.direction,ha.up);X.fov=g.deg2rad(ba.fov);return X};a.fromCenterDistance=C;a.fromCenterScale=function(X,ba,ha,ka,ia,ea){ha=A(X,ha,ba.latitude);return C(X,
ba,ha,ka,ia,ea)};a.fromExtent=function(X,ba,ha,ka,ia,ea=null){var ca=null!=ba.zmax&&null!=ba.zmin;let Z;if(X.state.isGlobal){if(!v.isSpatialReferenceSupported(ba.spatialReference,p.ViewingMode.Global))return L(ea)&&ea.resolver.reject(),null;var fa=new f(ba.xmin,ba.ymin,ba.spatialReference);const ma=new f(ba.xmax,ba.ymax,ba.spatialReference),ra=ba.spatialReference.isGeographic?V:W;var ja=new f({x:ra.center(fa.x,ma.x),y:(ma.y+fa.y)/2,z:ca?(ba.zmax+ba.zmin)/2:null,spatialReference:ba.spatialReference});
const va=k.getReferenceEllipsoid(ba.spatialReference);var la=t.getGreatCircleSpanAt(ja,fa,ma);Z=la.lon;la=la.lat;ra.diff(fa.x,ma.x)>ra.range/2&&(Z+=va.halfCircumference);Z=Math.min(Z,va.halfCircumference);la=Math.min(la,va.halfCircumference)}else ja=x.unwrapOr(X.renderSpatialReference,ba.spatialReference),ja.equals(ba.spatialReference)||(ba=e.project(ba,ja)),Z=ba.xmax-ba.xmin,la=ba.ymax-ba.ymin,ja=new f({x:ba.xmin+.5*Z,y:ba.ymin+.5*la,z:ca?(ba.zmax+ba.zmin)/2:null,spatialReference:ja});fa=X.state.camera;
ba=Math.max(1/Math.tan(fa.fovX/2)*Z*.5,1/Math.tan(fa.fovY/2)*la*.5,1/Math.tan(fa.fov/2)*(ca?ba.zmax-ba.zmin:0)*.5)/1;if(L(ea))ca=new aa(ea.signal),K(X,ha,ka,ja,ba,ia,ca),ca.resolver.promise.then(ma=>{ma=R(X,ma,X.camera.fov);if(x.isNone(ma))ea.resolver.reject();else return ea.resolver.resolve(ma)},ma=>ea.resolver.reject(ma));else return ha=K(X,ha,ka,ja,ba,ia),R(X,ha,X.camera.fov,ea)};a.getObserverForPointAtDistance=K;a.headingTiltToDirectionUp=function(X,ba,ha,ka,ia){return B(X).headingTiltToDirectionUp(ba,
ha,ka,ia)};a.internalToExternal=function(X,ba,ha){const ka=X.renderSpatialReference,ia=D(X,ba.eye,ba.viewForward,ba.up,H);X=X.spatialReference||r.WGS84;e.projectVectorToVector(ba.eye,ka,Y,X)||(X=r.WGS84,e.projectVectorToVector(ba.eye,ka,Y,X));if(x.isNone(ha))return new c(new f(Y,X),ia.heading,ia.tilt,g.rad2deg(ba.fov));ha.position.x=Y[0];ha.position.y=Y[1];ha.position.z=Y[2];ha.position.spatialReference=X;ha.heading=ia.heading;ha.tilt=ia.tilt;ha.fov=g.rad2deg(ba.fov);return ha};a.observerToCamera=
R;a.scaleToDistance=A;a.scaleToResolution=function(X,ba){return X.spatialReference?y.getResolutionForScale(ba,X.spatialReference):void 0};a.scaleToZoom=function(X,ba){var ha;if(X=null==(ha=X.basemapTerrain)?void 0:ha.tilingScheme)return X.levelAtScale(ba);N.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")};a.toExtent=function(X,ba,ha){const ka=e.projectVectorToPoint(ha,X.renderSpatialReference,X.spatialReference||r.WGS84);if(x.isNone(ka))return null;var ia=Math.tan(ba.fovX/
2),ea=Math.tan(ba.fovY/2);ba=l.dist(ba.eye,ha);ia*=2*ba;ea*=2*ba;return"global"===X.viewingMode?u.toExtent(X,ka,ia,ea):m.toExtent(X,ka,ia,ea)};a.zoomToScale=function(X,ba){var ha;if(X=null==(ha=X.basemapTerrain)?void 0:ha.tilingScheme)return X.scaleAtLevel(ba);N.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/cameraUtilsPlanar":function(){define("exports ../core/mathUtils ./mat4 ./mat4f64 ./vec3 ./vec3f64 ../geometry/Extent ../geometry/projection ../views/3d/support/cameraUtilsInternal".split(" "),
function(a,b,c,d,g,x,w,l,n){function f(z,v,B,A=n.createDirectionUp()){const {direction:E,up:C}=A;c.fromZRotation(u,-b.deg2rad(v));c.rotateX(u,u,b.deg2rad(B));g.transformMat4(E,m,u);g.scale(E,E,-1);g.transformMat4(C,h,u);return A}function e(z,v,B,A){return n.directionToHeadingTilt(v,B,A,m,h)}function k(z,v,B,A){const E=f(z,B,A),C=x.create();g.scale(C,E.direction,-v);g.add(C,C,z);return{up:E.up,eye:C,heading:B,tilt:A}}function r(z){return b.rad2deg(z)}function y(z){return b.deg2rad(z)}function p(z,
v,B,A,E){const C=z.renderSpatialReference;z=z.map&&z.spatialReference||v.spatialReference;l.projectPointToVector(v,t,C);l.projectPointToVector(v,q,C);t[0]-=B/2;q[0]+=B/2;t[1]-=A/2;q[1]+=A/2;l.projectVectorToVector(t,C,t,z);l.projectVectorToVector(q,C,q,z);E?(E.xmin=t[0],E.ymin=t[1],E.xmax=q[0],E.ymax=q[1],E.spatialReference=z):E=new w(t[0],t[1],q[0],q[1],z);return E}const h=x.fromValues(0,1,0),m=x.fromValues(0,0,1),u=d.create(),t=x.create(),q=x.create();d=Object.freeze({__proto__:null,headingTiltToDirectionUp:f,
directionToHeadingTilt:e,eyeForCenterWithHeadingTilt:k,lookAtTiltToEyeTilt:r,eyeTiltToLookAtTilt:y,toExtent:p});a.cameraUtilsPlanar=d;a.directionToHeadingTilt=e;a.eyeForCenterWithHeadingTilt=k;a.eyeTiltToLookAtTilt=y;a.headingTiltToDirectionUp=f;a.lookAtTiltToEyeTilt=r;a.toExtent=p})},"esri/views/3d/support/cameraUtilsInternal":function(){define(["exports","../../../core/mathUtils","../../../chunks/vec3","../../../chunks/vec3f64"],function(a,b,c,d){const g=d.create(),x=d.create();a.createDirectionUp=
function(){return{direction:d.create(),up:d.create()}};a.directionToHeadingTilt=function(w,l,n,f,e){let k=c.normalize(g,w),r=c.dot(k,f);const y=0<r;r=Math.abs(r);.99<r&&(r=Math.abs(c.dot(l,f)),.99>r?(c.copy(k,l),y&&c.scale(k,k,-1)):k=null);l=0;k&&(c.scale(x,f,c.dot(f,k)),c.subtract(k,k,x),l=c.dot(k,e)/(c.length(k)*c.length(e)),c.cross(x,k,e),l=(0<c.dot(x,f)?1:-1)*b.rad2deg(b.acosClamped(l)));w=b.rad2deg(b.acosClamped(-c.dot(f,w)/c.length(w)));if(!n)return{heading:l,tilt:w};n.heading=l;n.tilt=w;return n};
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/cameraUtilsSpherical":function(){define("exports ../core/mathUtils ./mat4 ./mat4f64 ./vec3 ./vec3f64 ../geometry/Extent ../geometry/projectionEllipsoid ../geometry/SpatialReference ../geometry/support/webMercatorUtils ../views/3d/support/cameraUtilsInternal ../views/3d/support/earthUtils ../views/3d/support/mathUtils".split(" "),function(a,b,c,d,g,x,w,l,n,f,e,k,r){function y(F,G,J,I=e.createDirectionUp()){g.cross(C,F,v);0===g.dot(C,
C)&&g.cross(C,F,B);c.fromRotation(E,-b.deg2rad(G),F);c.rotate(E,E,-b.deg2rad(J),C);const {up:O,direction:P}=I;g.cross(O,C,F);g.normalize(O,O);g.transformMat4(O,O,E);g.normalize(P,F);g.negate(P,P);g.transformMat4(P,P,E);return I}function p(F,G,J,I){const O=C,P=D;g.normalize(O,F);g.cross(D,O,v);0===g.dot(D,D)&&g.cross(D,O,B);g.cross(P,D,O);return e.directionToHeadingTilt(G,J,I,O,P)}function h(F,G,J,I){const O={eye:x.create(),up:null,tilt:I,heading:J},P=C;P[0]=F[0];P[1]=F[2];P[2]=-F[1];J=b.deg2rad(J);
var K=b.deg2rad(I);I=Math.sin(J);J=Math.cos(J);var M=Math.sin(K),U=Math.cos(K);const R=g.length(P);if(1E-8>Math.abs(K))K=G+R;else{var L=R/M,N=b.asinClamped(G/L);K=L*Math.sin(Math.PI-K-N)}U*=G;L=G*G*M*M;N=J*J*L;const T=K-U,S=T*T;var H=N*(N+S-P[1]*P[1]);if(0>H)return g.scale(O.eye,P,K/R),O.tilt=0,O;var Q=Math.sqrt(H);const W=P[1]*T;H=N+S;Q=0<J?-Q+W:Q+W;if(1E-8>Math.abs(H))return 1E-8>R?(O.eye[0]=0,O.eye[1]=0,O.eye[2]=G):g.scale(O.eye,P,K/R),O.tilt=0,m(O.eye),u(O,F);O.eye[1]=Q/H;G*=M;Q=O.eye[1]*O.eye[1];
M=1-Q;H=Math.sqrt(M);L=N*Q+I*I*L-2*J*G*O.eye[1]*H*T+M*S;if(1E-8>Math.abs(L))return g.scale(O.eye,P,K/R),O.tilt=0,m(O.eye),u(O,F);O.eye[0]=(M*(K*P[0]-U*P[0])-G*H*(P[0]*O.eye[1]*J+P[2]*I))/L;O.eye[2]=(M*(K*P[2]-U*P[2])-G*H*(P[2]*O.eye[1]*J-P[0]*I))/L;g.scale(O.eye,O.eye,K);m(O.eye);return u(O,F)}function m(F){const G=F[1];F[1]=-F[2];F[2]=G}function u(F,G){G=y(G,F.heading,F.tilt);F.up=G.up;return F}function t(F,G,J){G=g.length(G);J=b.asinClamped(J/(Math.sqrt(J*J+G*G-2*J*G*Math.cos(Math.PI-F))/Math.sin(F)));
return b.rad2deg(F-J)}function q(F,G,J){F=b.deg2rad(F);G=g.length(G);return b.asinClamped(J/(G/Math.sin(F)))+F}function z(F,G,J,I,O){function P(R){const L=Math.PI/2;R=r.cyclical2PI.normalize(R,-L);R>L&&(R=Math.PI-R);return R}var K=G.latitude;var M=l.getReferenceEllipsoid(F.spatialReference).radius;G=G.longitude;var U=k.getLonDeltaForDistance(K,J,M)/2;J=G-U;G+=U;K=b.deg2rad(K);K=(1+Math.sin(K))/(1-Math.sin(K));U=(K+1)*Math.tan(I/M/2);K=1.5*Math.PI-2*Math.atan(.5*(U+Math.sqrt(4*K+U*U)));I=K+I/M;K=P(K);
I=P(I);I<K&&(M=I,I=K,K=M);K=Math.max(b.rad2deg(K),-90);I=Math.min(b.rad2deg(I),90);G=A.monotonic(J,G);180<G-J&&(M=(G-J-180)/2,J+=M,G-=M);M=F.spatialReference&&F.spatialReference.isGeographic?F.spatialReference:n.WGS84;O?(O.xmin=J,O.ymin=K,O.xmax=G,O.ymax=I,O.spatialReference=M):O=new w(J,K,G,I,M);F.spatialReference&&F.spatialReference.isWebMercator&&f.geographicToWebMercator(O,!1,O);return O}const v=x.fromValues(0,0,1),B=g.normalize(x.create(),x.fromValues(1,1,1)),A=new r.Cyclical(-180,180),E=d.create(),
C=x.create(),D=x.create();d=Object.freeze({__proto__:null,headingTiltToDirectionUp:y,directionToHeadingTilt:p,eyeForCenterWithHeadingTilt:h,lookAtTiltToEyeTilt:t,eyeTiltToLookAtTilt:q,toExtent:z});a.cameraUtilsSpherical=d;a.directionToHeadingTilt=p;a.eyeForCenterWithHeadingTilt=h;a.eyeTiltToLookAtTilt=q;a.headingTiltToDirectionUp=y;a.lookAtTiltToEyeTilt=t;a.toExtent=z})},"esri/views/3d/support/earthUtils":function(){define(["exports","../../../core/mathUtils","../../../geometry/Point","../../../geometry/projectionEllipsoid"],
function(a,b,c,d){function g(l,n,f){return x(l,n.longitude,n.latitude,f.longitude,f.latitude)}function x(l,n,f,e,k){f=b.deg2rad(f);k=b.deg2rad(k);n=b.deg2rad(n);const r=b.deg2rad(e);e=Math.sin((f-k)/2);n=Math.sin((n-r)/2);f=2*b.asinClamped(Math.sqrt(e*e+Math.cos(f)*Math.cos(k)*n*n));return Math.round(f*l*1E4)/1E4}function w(l,n){l/=15;n||(l=Math.round(l));return l}a.getGreatCircleDistance=x;a.getGreatCircleDistanceFromPoints=g;a.getGreatCircleSpanAt=function(l,n,f){const e=n.spatialReference,k=d.getReferenceEllipsoid(e),
r=new c(n.x,l.y,e),y=new c(f.x,l.y,e);n=new c(l.x,n.y,e);l=new c(l.x,f.y,e);return{lon:g(k.radius,r,y),lat:g(k.radius,n,l)}};a.getLatDeltaForDistance=function(l,n){return b.rad2deg(l/n)};a.getLonDeltaForDistance=function(l,n,f){n/=f;l=b.deg2rad(l);n=Math.sin(n/2);l=Math.cos(l);l=2*b.asinClamped(Math.sqrt(n*n/(l*l)));return b.rad2deg(l)};a.getMaxCameraAltitude=function(l,n){l=b.deg2rad(l/2);return(1-Math.sin(l))*n/Math.sin(l)};a.longitudeToTimezone=w;a.pointToTimezone=function(l,n){return w(l.longitude,
n)};a.positionToTimezoneInfo=function(l,n){n||(n={hours:0,minutes:0,seconds:0});n.hours=w(l[0],!0);l=n.hours%1;n.hours-=l;n.minutes=60*l;l=n.minutes%1;n.minutes-=l;n.seconds=Math.round(60*l);return n};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/ElevationProvider":function(){define(["exports","../../../core/maybe","../../../layers/graphics/dehydratedFeatureUtils"],function(a,b,c){function d(g){return"array"in g}a.SamplePosition=function(g,x=null,w=0){this.array=g;this.spatialReference=
x;this.offset=w};a.getElevationAtPoint=function(g,x,w="ground"){if(c.isDehydratedPoint(x))return g.getElevation(x.x,x.y,x.z||0,x.spatialReference,w);if(d(x)){let l=x.offset;return g.getElevation(x.array[l++],x.array[l++],x.array[l]||0,b.unwrapOr(x.spatialReference,g.spatialReference),w)}return g.getElevation(x[0],x[1],x[2]||0,g.spatialReference,w)};a.isSamplePosition=d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/graphics/dehydratedFeatureUtils":function(){define(["exports"],function(a){a.isDehydratedPoint=
function(b){return"point"===b.type};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/webdoc/support/SlideThumbnail":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,d,g,x,w,l,n){var f;a.SlideThumbnail=f=function(e){function k(){var y=
e.apply(this,arguments)||this;y.url="";return y}b._inheritsLoose(k,e);var r=k.prototype;r.destroy=function(){this.url=""};r.clone=function(){return new f({url:this.url})};return k}(d.JSONSupport);c.__decorate([g.property({type:String,json:{write:{isRequired:!0}}})],a.SlideThumbnail.prototype,"url",void 0);a.SlideThumbnail=f=c.__decorate([n.subclass("esri.webdoc.support.SlideThumbnail")],a.SlideThumbnail);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/webscene/support/Description":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,d,g,x,w,l){var n;c=n=function(f){function e(){var k=f.apply(this,arguments)||this;k.text="";return k}a._inheritsLoose(e,f);e.prototype.clone=function(){return new n({text:this.text})};return e}(c.JSONSupport);b.__decorate([d.property({type:String,json:{write:!0}})],c.prototype,"text",void 0);return c=n=b.__decorate([l.subclass("esri.webscene.support.Description")],c)})},"esri/webscene/support/SlideEnvironment":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../Lighting".split(" "),
function(a,b,c,d,g,x,w,l,n,f){var e;a.SlideEnvironment=e=function(k){function r(){var y=k.apply(this,arguments)||this;y.lighting=new f;return y}b._inheritsLoose(r,k);r.prototype.clone=function(){return new e({lighting:f.prototype.clone.call(this.lighting)})};return r}(d.JSONSupport);c.__decorate([g.property({type:f,json:{write:!0}})],a.SlideEnvironment.prototype,"lighting",void 0);a.SlideEnvironment=e=c.__decorate([n.subclass("esri.webscene.Environment")],a.SlideEnvironment);Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/webscene/support/SlideGround":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Ground ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../webdoc/support/opacityUtils".split(" "),function(a,b,c,d,g,x,w,l,n,f){var e;d=e=function(k){function r(){var p=k.apply(this,arguments)||this;p.opacity=
null;return p}a._inheritsLoose(r,k);var y=r.prototype;y.clone=function(){return new e({opacity:this.opacity})};y.cloneAndApplyTo=function(p){if(null==this.opacity)return p;p=null!=p?p.clone():new c;p.opacity=this.opacity;return p};r.fromGround=function(p){return new e({opacity:p.opacity})};return r}(d.JSONSupport);b.__decorate([g.property({type:Number,json:{type:l.Integer,read:{reader:f.transparencyToOpacity,source:"transparency"},write:{writer:(k,r)=>{r.transparency=f.opacityToTransparency(k)},target:"transparency"}}})],
d.prototype,"opacity",void 0);return d=e=b.__decorate([n.subclass("esri.webscene.support.SlideGround")],d)})},"esri/webscene/support/SlideVisibleLayer":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,d,g,x,w,l){var n;a.SlideVisibleLayer=n=function(f){function e(k){k=
f.call(this,k)||this;k.id="";k.sublayerIds=null;return k}b._inheritsLoose(e,f);e.prototype.clone=function(){return new n({id:this.id,sublayerIds:g.clone(this.sublayerIds)})};return e}(d.JSONSupport);c.__decorate([x.property({type:String,json:{write:!0}})],a.SlideVisibleLayer.prototype,"id",void 0);c.__decorate([x.property({type:[w.Integer],json:{read:{source:"subLayerIds"},write:{target:"subLayerIds"}}})],a.SlideVisibleLayer.prototype,"sublayerIds",void 0);a.SlideVisibleLayer=n=c.__decorate([l.subclass("esri.webscene.support.SlideVisibleLayer")],
a.SlideVisibleLayer);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/webscene/support/Title":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,d,g,x,w,l){var n;c=n=function(f){function e(){var k=f.apply(this,arguments)||this;k.text="";return k}
a._inheritsLoose(e,f);e.prototype.clone=function(){return new n({text:this.text})};return e}(c.JSONSupport);b.__decorate([d.property({type:String,json:{write:{isRequired:!0}}})],c.prototype,"text",void 0);return c=n=b.__decorate([l.subclass("esri.webscene.support.Title")],c)})},"esri/webscene/TransportationNetwork":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,d,g,x,w,l){var n;c=n=function(f){function e(k){return f.call(this,k)||this}a._inheritsLoose(e,f);e.prototype.clone=function(){return new n({name:this.name,path:this.path,title:this.title})};return e}(c.JSONSupport);b.__decorate([d.property({type:String,json:{write:!0}})],c.prototype,"name",void 0);b.__decorate([d.property({type:String,json:{write:!0}})],c.prototype,"path",void 0);b.__decorate([d.property({type:String,json:{write:!0}})],c.prototype,"title",void 0);return c=n=b.__decorate([l.subclass("esri.webscene.TransportationNetwork")],
c)})},"esri/webscene/Version":function(){define(["exports","../chunks/_rollupPluginBabelHelpers","../core/Version"],function(a,b,c){c=function(d){function g(x,w){return d.call(this,x,w,"webscene")||this}b._inheritsLoose(g,d);b._createClass(g,[{key:"supportsGround",get:function(){return this.since(1,8)}},{key:"supportsVisibleElevationLayersInSlides",get:function(){return this.lessThan(1,8)}}]);return g}(c.Version);a.Version=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/SceneView":function(){define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../Camera ../geometry ../Graphic ../Ground ../Viewpoint ../core/Collection ../core/domUtils ../core/Error ../core/events ../core/handleUtils ../core/has ../core/iteratorUtils ../core/Logger ../core/maybe ../core/ObservableChangesType ../core/promiseUtils ../core/reactiveUtils ../core/scheduling ../core/workers/workers ../core/screenUtils ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/accessorSupport/decorators/cast ../core/accessorSupport/decorators/subclass ../core/accessorSupport/ensureType ../chunks/vec3f64 ../core/support/OwningCollection ../geometry/HeightModelInfo ../geometry/projection ../geometry/support/aaBoundingRect ../chunks/boundedPlane ../geometry/support/coordinateSystem ../geometry/support/scaleUtils ../layers/VoxelWasmManager ../layers/support/layerUtils ../support/AnalysesCollection ./BreakpointsOwner ./DOMContainer ./GroundView ./PopupView ./View ./ViewAnimation ./ViewingMode ./3d/layerViewModuleImportUtils ./3d/analysis/AnalysisViewManager3D ./3d/constraints/Constraints ./3d/environment/SceneViewEnvironment ./3d/environment/SceneViewEnvironmentManager ./3d/input/SceneInputManager ./3d/layers/graphics/GraphicsDeconflictor ./3d/layers/graphics/Labeler ./3d/layers/graphics/ObjectResourceCache ./3d/layers/support/FeatureTileTree3D ./3d/state/ViewState ./3d/state/ViewStateManager ./3d/state/helpers/SceneIntersectionHelper ./3d/support/CombinedElevationProvider ./3d/support/debugFlags ./3d/support/DisplayQualityProfile ./3d/support/ElevationProvider ./3d/support/HighlightOptions ./3d/support/MapCoordsHelper ./3d/support/PropertiesPool ./3d/support/QualitySettings ./3d/support/RenderCoordsHelper ./3d/support/ResourceController ./3d/support/SceneViewPerformanceInfo ./3d/support/SharedSymbolResources ./3d/support/pointsOfInterest/PointsOfInterest ./3d/terrain/TerrainSurface ./3d/terrain/terrainUtils ./3d/webgl-engine/Stage ./3d/webgl-engine/lib/Intersector ./3d/webgl-engine/lib/IntersectorInterfaces ./3d/webgl-engine/lib/intersectorUtils ./3d/webgl-engine/lib/intersectorUtilsConversions ./3d/webgl-engine/lib/verticalOffsetUtils ./support/hitTestSelectUtils ./support/layerViewUtils ./support/screenshotUtils ./support/screenUtils ./support/spatialReferenceSupport ./support/WebGLRequirements ./ui/3d/DefaultUI3D ../webscene/Environment ../geometry/SpatialReference ../geometry/Point ../geometry/Extent".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E,C,D,F,G,J,I,O,P,K,M,U,R,L,N,T,S,H,Q,W,V,Y,aa,X,ba,ha,ka,ia,ea,ca,Z,fa,ja,la,ma,ra,va,ya,za,pa,wa,na,qa,ta,Fa,Ha,Ka,La,Ra,ab,Za,Pa,ua,Aa,Ia,Na,Sa,Ua,Ya,$a,sa,Ca,Ma,Xa,Va,eb,fb){function qb(rb,Bb){rb.layerUids||(rb.layerUids=new Set);rb.layerUids.add(Bb)}function hb(rb,Bb){return m.isSome(rb)&&O.canProjectWithoutEngine(rb.spatialReference,Bb)?O.project(rb,Bb):null}const kb=h.getLogger("esri.views.SceneView");g=function(rb){function Bb(Ea){var Da=
rb.call(this,Ea)||this;Da._userClippingArea=null;Da._clippingArea=null;Da._initialDefaultSpatialReference=null;Da._defaults={};Da._externallySet={environment:!1};Da._createGraphicsViewController=null;Da._resolveWhenReady=[];Da.propertiesPool=new na.PropertiesPool({slicePlane:K.BoundedPlaneClass},b._assertThisInitialized(Da));Da._resourceController=Fa.newResourceController(b._assertThisInitialized(Da));Da._defaultToMapOptions={include:new Set};Da._defaultHitTestOptions={exclude:new Set};Da.deconflictor=
new ea.GraphicsDeconflictor({view:b._assertThisInitialized(Da)});Da.labeler=new ca.Labeler({view:b._assertThisInitialized(Da),deconflictor:Da.deconflictor.labels});Da.sharedSymbolResources=null;Da.analyses=new N.AnalysesCollection;Da.basemapTerrain=null;Da.elevationProvider=null;Da.camera=null;Da.canvas=null;Da.center=null;Da.constraints=new ba.default;Da.environmentManager=new ka.SceneViewEnvironmentManager;Da.extent=null;Da.floors=new n;Da.windowDevicePixelRatio=1;Da.fullOpacity=1;Da.graphicsView=
null;Da.analysisViewManager=new X({view:b._assertThisInitialized(Da)});Da.groundView=null;Da.navigating=!1;Da.map=null;Da.screenSizePerspectiveEnabled=!0;Da.state=new ja;Da.scale=null;Da.spatialReference=null;Da.alphaCompositingEnabled=!1;Da.supersampleScreenshotsEnabled=!0;Da.type="3d";Da.ui=new Ma;Da._numUpdating=0;Da._lastUpdateTime=0;Da.updatingProgress=.5;Da.viewpoint=null;Da.zoom=null;Da.highlightOptions=new pa;v.initialize();Ea&&Ea.environment||(Da._defaults.environment=new ha,Da.environment=
Da._defaults.environment);const Oa=(Ta=null)=>{m.isSome(Ta)&&Ta.type===u.ObservableChangesType.MOVE||(Da._updatingChanged(),Da.map&&Da.map.allLayers.forEach(function(){var bb=b._asyncToGenerator(function*(ib){try{yield ib.when()}catch{}Da._updatingChanged()});return function(ib){return bb.apply(this,arguments)}}()))};Da.handles.add([q.on(()=>{var Ta;return null==(Ta=Da.map)?void 0:Ta.allLayers},"after-changes",Ta=>Oa(Ta),{onListenerAdd:()=>Oa(),onListenerRemove:()=>Oa(),sync:!0}),Da.allLayerViews.on("after-changes",
Ta=>Da._updateUpdatingMonitors(Ta)),Da.watch("map",Ta=>{Ta&&Ta.load&&Ta.load().catch(()=>{})})]);Da.inputManager=new ia({view:b._assertThisInitialized(Da)});Da.stateManager=new la({view:b._assertThisInitialized(Da),updateDevicePixelRatio:()=>{const Ta=window.devicePixelRatio;Ta!==Da.windowDevicePixelRatio&&(Da.windowDevicePixelRatio=Ta,Da.notifyChange("pixelRatio"))}});return Da}b._inheritsLoose(Bb,rb);var cb=Bb.prototype;cb.initialize=function(){this.groundView=new H({view:this});this._updateUpdatingMonitors();
const Ea=()=>this._updateDefaultToMapOptions();this.handles.add(q.on(()=>{var Da;return null==(Da=this.map)?void 0:Da.allLayers},"after-changes",Ea,{onListenerAdd:Ea,onListenerRemove:Ea}));this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,Da=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=Da)},q.initial);this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,Da=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=
Da)},q.initial);this.updatingHandles.add(()=>this.qualitySettings.frameRate,Da=>z.setFrameDuration(0<Da?1E3/Math.ceil(Da):0),q.initial);this.updatingHandles.add(()=>va.SCENEVIEW_LOCKING_LOG,Da=>this.defaultsFromMap.logDebugInformation=Da,q.initial);this.updatingHandles.add(()=>{var Da;return null==(Da=this.map)?void 0:Da.ground},Ea,q.syncAndInitial);this.updatingHandles.add(()=>{var Da,Oa;return null==(Da=this.map)?void 0:null==(Oa=Da.ground)?void 0:Oa.opacity},()=>this._updateDefaultHitTestOptions(),
q.syncAndInitial);this.handles.add(this.watch("spatialReference",()=>this.notifyChange("clippingArea"),!0))};cb.destroy=function(){this.destroyed||(this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=m.destroyMaybe(this.sharedSymbolResources),this.labeler.destroy(),this._set("labeler",null),this.deconflictor.destroy(),this._set("deconflictor",null),this._resourceController=m.destroyMaybe(this._resourceController),
this.stateManager.destroy(),this._set("stateManager",null),this.inputManager.destroy(),this._set("inputManager",null),this.propertiesPool.destroy(),this.handles.remove("updatingMonitors"),this.environmentManager.destroy(),this._set("environmentManager",null),this.groundView=m.destroyMaybe(this.groundView))};cb.installContentCameraReset=function(Ea={sticky:!1}){return this.stateManager.installContentCameraReset(Ea)};cb.castEnvironment=function(Ea){return Ea?Ea instanceof ha?Ea:Ea instanceof Xa?null!=
this.environment?this.environment.cloneWithWebsceneEnvironment(Ea):ha.fromWebsceneEnvironment(Ea):F.ensureType(ha,Ea):new ha};cb.forceAnimationTime=function(Ea){this._stage.renderView.forcedAnimationTime=this.basemapTerrain.overlayManager.forcedAnimationTime=Ea};cb.on=function(Ea,Da,Oa,Ta){return(Oa=this.viewEvents.on(Ea,Da,Oa,Ta))?Oa:rb.prototype.on.call(this,Ea,Da)};cb.hasEventListener=function(Ea){return rb.prototype.hasEventListener.call(this,Ea)||this.viewEvents.hasHandler(Ea)};cb.toMap=function(Ea,
Da){if(!this.ready)return kb.error("#toMap()","Scene view cannot be used before it is ready"),null;Da=Da?this.externalToInternalIntersectOptions(Da):this._defaultToMapOptions;var Oa=m.isSome(Da.graphics)&&(m.isSome(Da.graphics.include)||m.isSome(Da.graphics.exclude));Ea=$a.isSupportedScreenPointEvent(Ea)?$a.createScreenPointFromSupportedEvent(this,Ea):Ea;Ea=B.screenPointObjectToArray(Ea);Da.enableDraped=Da.include&&!Da.include.has(Na.TERRAIN_ID)||Da.exclude&&Da.exclude.has(Na.TERRAIN_ID);const Ta=
this.sceneIntersectionHelper,bb=Pa.newIntersector(this.state.viewingMode);bb.options.selectionMode=!0;bb.options.store=Oa?ua.StoreResults.ALL:ua.StoreResults.MIN;Ta.intersectIntersectorScreen(Ea,bb,Da);if(Oa){for(const ib of bb.results.all)if(Oa=Ia.toGraphic(ib,this),m.isNone(Oa)||this._testGraphicUidFilter(Da.graphics,Oa))return this._intersectResultToMapPoint(ib);return null}return this._intersectResultToMapPoint(bb.results.min)};cb.toScreen=function(Ea){if(!this.ready)return kb.error("#toScreen()",
"Scene view cannot be used before it is ready"),null;const Da=m.unwrapOr(null==Ea.z&&za.getElevationAtPoint(this.elevationProvider,Ea),0);O.projectPointToVector(Ea,yb,this.renderSpatialReference,Da);this.state.camera.projectToScreen(yb,zb);return B.createScreenPoint(zb[0],zb[1])};cb.pixelSizeAt=function(Ea){if(!this.ready)return kb.error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null;if(!Ea)return 0;O.projectPointToVector(Ea,yb,this.renderSpatialReference);return this.state.camera.computeScreenPixelSizeAt(yb)};
cb.overlayPixelSizeInMapUnits=function(Ea){const Da=this.basemapTerrain.overlayManager;return Da?Da.overlayPixelSizeInMapUnits(Ea):1};cb.hitTest=function(Ea,Da){if(!this.ready)return kb.error("#hitTest()","Scene view cannot be used before it is ready"),null;Ea=$a.isSupportedScreenPointEvent(Ea)?$a.createScreenPointFromSupportedEvent(this,Ea):Ea;var Oa=B.createScreenPointArray(Ea.x,Ea.y),Ta=Da?this.externalToInternalIntersectOptions(Da):this._defaultHitTestOptions;Ta.requiresGroundFeedback=!0;Ta.enableDraped=
!0;Da=Pa.newIntersector(this.state.viewingMode);Da.options.selectionMode=!0;Da.options.store=ua.StoreResults.ALL;this.sceneIntersectionHelper.intersectIntersectorScreen(Oa,Da,Ta);Oa=this._intersectResultsToHits(Da.results.all,Ta.graphics);Ta=Da.results.ground;var bb=Ia.toOwner(Ta,this);bb=m.isSome(bb)&&"type"in bb&&"integrated-mesh"===bb.type?bb:null;Ea={screenPoint:Ea,results:Oa,ground:{mapPoint:this._intersectResultToMapPoint(Ta),distance:Aa.isValidIntersectorResult(Ta)?Ta.distanceInRenderSpace:
0,layer:bb}};va.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(Ea.intersector=Da);return Promise.resolve(Ea)};cb.popupHitTest=function(Ea){return Sa.hitTestSelectSameDistance(this,Ea).then(({results:Da,ground:Oa})=>{let Ta=null;!(0===Da.length||1E-5>Math.abs(m.unwrapOr(Da[0].distance,0)-Oa.distance))||Oa.layer&&"integrated-mesh"===Oa.layer.type||(Ta=Oa.mapPoint);return{results:Da,screenPoint:Ea,mapPoint:Ta}})};cb.goTo=function(Ea,Da){return this.updatingHandles.addPromise(this.stateManager.goTo(Ea,Da))};
cb.whenAnalysisView=function(){var Ea=b._asyncToGenerator(function*(Da){yield this.whenReady();if(m.isNone(Da.parent))throw new e("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:Da});switch(Da.parent.type){case "analysis":return(yield this.whenLayerView(Da.parent)).whenAnalysisView(Da);default:return this.analysisViewManager.whenAnalysisView(Da)}});return function(Da){return Ea.apply(this,arguments)}}();cb.whenLayerView=function(Ea){return rb.prototype.whenLayerView.call(this,
Ea)};cb.takeScreenshot=function(Ea){return this.whenReady().then(()=>{const Da=Ya.toRenderSettings(Ea,this);Da.pixelRatio/=this.pixelRatio;return this._stage.renderView.takeScreenshot(Ya.screenshotSuperSampleSettings(Da,this.supersampleScreenshotsEnabled,this.padding))})};cb.addUpdatingPromise=function(Ea){return this.updatingHandles.addPromise(Ea)};cb.importLayerView=function(Ea){return aa.layerView3DImporter.importLayerView(Ea)};cb.hasLayerViewModule=function(Ea){return aa.layerView3DImporter.hasLayerViewModule(Ea)};
cb.forceDOMReadyCycle=function(){this.forceReadyCycle()};cb.getDefaultSpatialReference=function(){var Ea,Da,Oa,Ta;return this.map&&"initialViewProperties"in this.map&&(null==(Ea=this.map)?void 0:null==(Da=Ea.initialViewProperties)?void 0:Da.spatialReference)||(null==(Oa=this.defaultsFromMap)?void 0:Oa.spatialReference)||(null==(Ta=this.defaultsFromMap)?void 0:Ta.ready)&&this._initialDefaultSpatialReference||null};cb.validate=function(){var Ea=b._asyncToGenerator(function*(){let Da=Ca.check(this.type);
y("safari")&&9>y("safari")&&(Da=new e("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari \x3c 9)",{type:"safari",requiredVersion:9,detectedVersion:y("safari")}));if(m.isSome(Da))throw kb.warn("#validate()",Da.message),Da;});return function(){return Ea.apply(this,arguments)}}();cb.getSpatialReferenceSupport=function({spatialReference:Ea,layer:Da}){var Oa=this._predeterminedViewingMode;if(m.isSome(Oa))return this._validateSpatialReferenceForViewingMode(Ea,Da,Oa)?{constraints:this._makeSpatialReferenceConstraints(Ea,
Da,Oa)}:null;Oa=this._validateSpatialReferenceForViewingMode(Ea,Da,Y.ViewingMode.Local);const Ta=this._validateSpatialReferenceForViewingMode(Ea,Da,Y.ViewingMode.Global);return Oa||Ta?Oa&&Ta?{constraints:this._makeSpatialReferenceConstraints(Ea,Da,null)}:Oa?{constraints:this._makeSpatialReferenceConstraints(Ea,Da,Y.ViewingMode.Local)}:{constraints:this._makeSpatialReferenceConstraints(Ea,Da,Y.ViewingMode.Global)}:null};cb._validateSpatialReferenceForViewingMode=function(Ea,Da,Oa){return sa.isSpatialReferenceSupported(Ea,
Oa)?m.isNone(Da)||L.isReprojectableTiledLayer(Da)?!0:L.isTiledLayer(Da)&&m.isNone(ab.getTiledLayerInfo(Da,Ea,Oa))||L.isVoxelLayer(Da)&&Oa===Y.ViewingMode.Global?!1:!0:!1};cb._makeSpatialReferenceConstraints=function(Ea,Da,Oa){if(m.isNone(Da))return[{spatialReference:Ea,viewingMode:Oa}];const Ta=Ea.isWebMercator,bb=Ea.isWGS84;return L.isReprojectableTiledLayer(Da)&&(Ta||bb)?(bb&&Oa!==Y.ViewingMode.Local?null===ab.checkIfTileInfoSupportedForView(Da.tileInfo,Da.fullExtent,Ea,Y.ViewingMode.Global):1)?
[{spatialReference:Ea,viewingMode:Oa},{spatialReference:Va.WebMercator,viewingMode:Oa}]:[{spatialReference:Ta?Va.WGS84:Va.WebMercator,viewingMode:Oa}]:L.isTiledLayer(Da)||L.isVoxelLayer(Da)||!Ta&&!bb?L.isTiledLayer(Da)&&Ta&&Oa!==Y.ViewingMode.Global?[{spatialReference:Ea,viewingMode:Oa},{spatialReference:Va.WGS84,viewingMode:Y.ViewingMode.Local}]:[{spatialReference:Ea,viewingMode:Oa}]:[{spatialReference:Ea,viewingMode:Oa},{spatialReference:Ta?Va.WGS84:Va.WebMercator,viewingMode:Oa}]};cb._validateSpatialReference=
function(Ea){const Da=m.isSome(this.getSpatialReferenceSupport({spatialReference:Ea})),Oa=this._predeterminedViewingMode;Da||(m.isSome(Oa)?kb.warnOnce(`Spatial reference defined on view not supported in ${Y.stringFromViewingMode(Oa)} viewing mode.`):Ea.isGeographic&&kb.warnOnce("Spatial reference is geographic but not supported."));return Da};cb.whenReady=function(){return new Promise(Ea=>{this.ready?Ea(this):this._resolveWhenReady.push(Ea)})};cb.computeMapPointFromVec3d=function(Ea,Da){let Oa=this.spatialReference||
Va.WGS84;O.projectVectorToVector(Ea,this.renderSpatialReference,Ea,Oa)||(Oa=Va.WGS84,O.projectVectorToVector(Ea,this.renderSpatialReference,Ea,Oa));Da?(Da.x=Ea[0],Da.y=Ea[1],Da.z=Ea[2],Da.spatialReference=Oa):Da=new eb(Ea,Oa);return Da};cb.trackGraphicState=function(Ea){if(!Ea.graphic)return kb.error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const Da=this.getViewForGraphic(Ea.graphic);let Oa=null,Ta=!1;const bb=ib=>{var mb;!Ta&&m.isSome(ib)&&
"processor"in ib&&"graphics-3d"===(null==(mb=ib.processor)?void 0:mb.type)&&ib.processor.graphicsCore&&(Oa=ib.processor.graphicsCore.trackGraphicState(Ea))};m.isSome(Da)?bb(Da):this.whenViewForGraphic(Ea.graphic,{waitForLayer:!0}).then(ib=>bb(ib),()=>{}).catch(()=>{});return{remove:()=>{Ta=!0;m.isSome(Oa)&&(Oa.remove(),Oa=null)}}};cb.highlight=function(Ea){if(Array.isArray(Ea))return r.handlesGroup(Ea.map(Oa=>this.highlight(Oa)));if(n.isCollection(Ea))return r.handlesGroup(Ea.toArray().map(Oa=>this.highlight(Oa)));
const Da=this.getViewForGraphic(Ea);return Da&&"highlight"in Da?Da.highlight(Ea):r.makeHandle()};cb.maskOccludee=function(Ea){if(!Ea)return kb.error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const Da=this.getViewForGraphic(Ea);let Oa=null,Ta=!1;const bb=ib=>{!Ta&&m.isSome(ib)&&Ua.occludeesSupported(ib)&&(Oa=ib.maskOccludee(Ea))};m.isSome(Da)?bb(Da):this.whenViewForGraphic(Ea,{waitForLayer:!0}).then(ib=>bb(ib),()=>{}).catch(()=>{});return{remove:()=>
{Ta=!0;m.isSome(Oa)&&(Oa.remove(),Oa=null)}}};cb.getViewForGraphic=function(Ea){return Ea.layer===this.graphics?this.graphicsView:Ea.layer?this.allLayerViews.find(Da=>Da.layer===Ea.layer):null};cb.graphicChanged=function(Ea){m.isSome(this.graphicsView)&&this.graphicsView.graphicChanged(Ea)};cb.whenViewForGraphic=function(){var Ea=b._asyncToGenerator(function*(Da,Oa){if(Da.layer===this)return yield q.whenOnce(()=>this.graphicsView),this.graphicsView;if(!Da.layer||!this.map)throw new e("no-view-for-graphic");
return Oa&&Oa.waitForLayer&&!this.map.allLayers.includes(Da.layer)?new Promise((Ta,bb)=>{const ib=this.map.allLayers.on("change",mb=>{-1!==mb.added.indexOf(Da.layer)&&(ib.remove(),this.whenLayerView(Da.layer).then(Ta,bb))})}):this.whenLayerView(Da.layer)});return function(Da,Oa){return Ea.apply(this,arguments)}}();cb.externalToInternalIntersectOptions=function(Ea){const Da=this._externalToInternalRenderItems(Ea.include,Ab.INCLUDE);Ea=this._externalToInternalRenderItems(Ea.exclude,Ab.EXCLUDE);return{include:Da.layerUids,
exclude:Ea.layerUids,graphics:{include:Da.graphicUids,exclude:Ea.graphicUids}}};cb._intersectResultToMapPoint=function(Ea,Da){return Ea.getIntersectionPoint(yb)?(Da=this.computeMapPointFromVec3d(yb,Da),Ea.intersector===ua.IntersectorType.TERRAIN&&this.basemapTerrain&&(Da.z=m.unwrapOr(za.getElevationAtPoint(this.basemapTerrain,Da),0)),Da):null};cb._intersectResultsToHits=function(Ea,Da){const Oa=[];let Ta=null;for(let mb=0;mb<Ea.length;mb++){const Eb=Ea[mb];var bb=Ia.toOwner(Eb,this);if(m.isSome(bb)&&
(bb===this.map.ground||"type"in bb&&"integrated-mesh"===bb.type))break;bb=Ia.toGraphic(Eb,this);if(m.isSome(bb)){m.isNone(Ta)&&mb!==Ea.length-1&&(Ta=new Set);if(m.isSome(Ta)){var ib=this._getGraphicFilterUid(bb);if(Ta.has(ib))continue;Ta.add(ib)}this._testGraphicUidFilter(Da,bb)&&(ib=this._intersectResultToMapPoint(Eb),Oa.push({graphic:bb,mapPoint:ib,distance:Eb.distanceInRenderSpace}))}}return Oa};cb._getGraphicFilterUid=function(Ea){if(Ea.layer&&"objectIdField"in Ea.layer){const Da=Ea.attributes[Ea.layer.objectIdField];
if(Da)return`o-${Ea.layer.id}-${Da}`}return`u-${Ea.uid}`};cb._testGraphicUidFilter=function(Ea,Da){Da=this._getGraphicFilterUid(Da);return m.isNone(Ea)||(m.isNone(Ea.include)||Ea.include.has(Da))&&(m.isNone(Ea.exclude)||!Ea.exclude.has(Da))};cb._externalToInternalRenderItems=function(Ea,Da,Oa={layerUids:null,graphicUids:null}){if(!Ea)return Oa;if(Ea instanceof x){var Ta=this._getGraphicFilterUid(Ea);Oa.graphicUids||(Oa.graphicUids=new Set);Oa.graphicUids.add(Ta);Da===Ab.INCLUDE&&(m.isSome(this.graphicsView)&&
Ea.layer===this?qb(Oa,this.graphicsView.processor.layer.id):Ea.layer&&qb(Oa,Ea.layer.uid))}else if(p.isIterable(Ea))for(Ta of Ea)Ta===this.graphics&&m.isSome(this.graphicsView)?qb(Oa,this.graphicsView.processor.layer.id):Ta instanceof w?Ta===this.map.ground&&qb(Oa,Na.TERRAIN_ID):this._externalToInternalRenderItems(Ta,Da,Oa);else qb(Oa,Ea.uid);return Oa};cb._initBasemapTerrain=function(){this._set("basemapTerrain",new Ra({view:this}));this._set("elevationProvider",new ra.CombinedElevationProvider({view:this}));
this.elevationProvider.register("ground",this.basemapTerrain)};cb._exitBasemapTerrain=function(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))};cb._initGlobe=function(){this._initCoordinateSystem();this.state.createInitialCamera();this._initBasemapTerrain();this._set("pointsOfInterest",new La.default({view:this}));this._set("featureTiles",
new fa.default({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.contentCameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const Ea=()=>{var Da=this.basemapTerrain&&this.basemapTerrain.extent;this.clippingArea||Da?Da&&this.basemapTerrain.spatialReference?(Da=m.isSome(this.basemapTerrain.extent)?O.project(P.toExtent(this.basemapTerrain.extent,
this.basemapTerrain.spatialReference),this.spatialReference):null,m.isSome(this.clippingArea)?this.featureTiles.filterExtent=this.clippingArea.intersection(Da):this.featureTiles.filterExtent=Da):this.featureTiles.filterExtent=this.clippingArea:this.featureTiles.filterExtent=null};this.handles.add([this.updatingHandles.add(()=>va.FEATURE_TILE_TREE_SHOW_TILES,Da=>{Da&&this.featureTiles&&!this.featureTreeDebugger?this.updatingHandles.addPromise(new Promise((Oa,Ta)=>a(["./3d/layers/support/FeatureTileTree3DDebugger"],
Oa,Ta))).then(({FeatureTileTree3DDebugger:Oa})=>{!this.featureTreeDebugger&&va.FEATURE_TILE_TREE_SHOW_TILES&&(this.featureTreeDebugger=new Oa({view:this}))}):Da||!this.featureTreeDebugger||va.FEATURE_TILE_TREE_SHOW_TILES||(this.featureTreeDebugger.destroy(),this.featureTreeDebugger=null)},q.syncAndInitial),this.updatingHandles.add(()=>this.clippingArea,Ea,q.syncAndInitial),this.updatingHandles.add(()=>this.basemapTerrain.extent,Ea,q.syncAndInitial)],"feature-tiles");this.stateManager.init()};cb._exitGlobe=
function(){this.state&&(this.stateManager.deinit(),this.handles.remove("render-coords-helper"),this.handles.remove("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())};cb._initCoordinateSystem=function(){if(this.spatialReference){var Ea=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(Ea)||this._set("mapCoordsHelper",
new wa.MapCoordsHelper(this.map,Ea));const Da=this.state.isGlobal;Ea=M.renderSRFromViewSR(Da,Ea);Ea!==this.renderSpatialReference&&(this._set("renderCoordsHelper",ta.RenderCoordsHelper.create(this.state.viewingMode,Ea)),Da||this.handles.add(this.watch("basemapTerrain.extent",Oa=>{const Ta=this.renderCoordsHelper.spatialReference;0===Oa[0]&&0===Oa[1]&&0===Oa[2]&&0===Oa[3]||!O.projectBoundingRect(Oa,this.basemapTerrain.spatialReference,wb,Ta)||(this.renderCoordsHelper.extent=wb)},!0),"render-coords-helper"),
this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(Pa.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)};cb._exitCoordinateSystem=function(){this.mapCoordsHelper&&(this.handles.remove("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))};cb._updatingChanged=function(){this.notifyChange("updating")};cb._updateUpdatingMonitors=function(Ea=null){m.isSome(Ea)&&
Ea.type===u.ObservableChangesType.MOVE||(this.handles.remove("updatingMonitors"),this.allLayerViews.forEach(Da=>{Da.destroyed||(this.handles.add([Da.watch(["updating","updatingProgress"],()=>this._updatingChanged(),!0)],"updatingMonitors"),Da.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())};cb._renderScreenshotOverlay=function(Ea,Da){if(!this.overlay||!this.overlay.hasVisibleItems)return Da;const Oa=Ea.getContext("2d");Oa.putImageData(Da,0,0);this.overlay.renderCanvas(Ea);
return Oa.getImageData(0,0,Da.width,Da.height)};cb._initStage=function(){var Ea={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,canvas:this.renderCanvas,screenshot:{renderOverlay:(mb,Eb)=>this._renderScreenshotOverlay(mb,Eb)}};const Da=new ma.SceneIntersectionHelper(this.state.viewingMode,mb=>this._stage.layers.forAll(mb),this);this._set("sceneIntersectionHelper",Da);const Oa=f.byId(this.surface),{resourceController:Ta,
state:bb,renderSpatialReference:ib}=this;this._stage=new Za.Stage({options:Ea,container:Oa,resourceController:Ta,state:bb,sceneIntersectionHelper:Da,renderSR:ib});this._stage.renderView.setRenderParameters({slicePlane:this.slicePlane});this._lostWebGLContextHandle=k.on(this._stage.renderView.canvas,"webglcontextlost",()=>this.fatalError=new e("webgl-context-lost"));this.handles.add([this.updatingHandles.add(()=>this.qualitySettings.antialiasingEnabled,()=>this._stage.renderView.setRenderParameters({antialiasingEnabled:this.qualitySettings.antialiasingEnabled}),
q.initial),this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,()=>this._stage.renderView.setRenderParameters({highQualityTransparency:this.qualitySettings.highQualityTransparency}),q.initial),q.watch(()=>this.magnifier,mb=>this._stage.renderView.magnifier=mb,q.syncAndInitial)],"stage");Ea=()=>{this._stage.renderView.setRenderParameters({defaultHighlightOptions:pa.toEngineOptions(this.highlightOptions)})};this.handles.add(this.updatingHandles.add(()=>[this.highlightOptions.color,
this.highlightOptions.haloColor,this.highlightOptions.haloOpacity,this.highlightOptions.fillOpacity,this.highlightOptions.shadowOpacity,this.highlightOptions.shadowColor,this.highlightOptions.shadowDifference],Ea),"stage");Ea();this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(Pa.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters);this._set("canvas",this._stage.renderView.canvas)};cb._exitStage=function(){this._set("sceneIntersectionHelper",null);this._stage.destroy();this._stage=
null;this._lostWebGLContextHandle.remove();this._lostWebGLContextHandle=null;this.handles.remove("stage");this._set("canvas",null)};cb._initSurface=function(Ea){this._exitSurface();this.state.init(Ea,this.spatialReference);this._initStage();this._initGlobe();this.sharedSymbolResources=new Ka.SharedSymbolResources({view:this,viewingMode:Ea,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state,objectResourceCache:new Z.ObjectResourceCache})};cb._exitSurface=
function(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())};cb._createGraphicsViewIfNeeded=function(){if(!this.graphicsView&&!this._createGraphicsViewController&&0!==this.graphics.length){this.handles.remove("graphics-view");this._createGraphicsViewController=new AbortController;var Ea=()=>{this._createGraphicsViewController=null;this._updatingChanged()};
this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(Ea,Ea);this._updatingChanged()}};cb._createGraphicsViewAsync=function(){var Ea=b._asyncToGenerator(function*(Da){const Oa=(yield new Promise((Ta,bb)=>a(["./3d/layers/GraphicsView3D"],ib=>Ta(Object.freeze({__proto__:null,default:ib})),bb))).default;t.throwIfAborted(Da);yield q.whenOnce(()=>{var Ta;return!0===(null==(Ta=this.basemapTerrain)?void 0:Ta.ready)},Da);this._set("graphicsView",new Oa({view:this}))});return function(Da){return Ea.apply(this,
arguments)}}();cb._disposeGraphicsView=function(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null);this.handles.remove("graphics-view");m.isSome(this.graphicsView)&&(this.handles.remove(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))};cb._startup=function(){var Ea=Y.viewingModeFromString(this.viewingMode);Ea===Y.ViewingMode.Global&&(this._clippingArea=null);this._initSurface(Ea);
this._set("ready",!0);this.handles.add(q.on(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view");this._createGraphicsViewIfNeeded();!this._externallySet.environment&&(Ea=this.get("map.initialViewProperties.environment"))&&(this.environment=Ea);this.labeler.setup();this.environmentManager.connectView(this);this.inputManager.connect();Ea=this._resolveWhenReady;this._resolveWhenReady=[];Ea.forEach(Da=>Da(this))};cb._teardown=function(){this._initialDefaultSpatialReference=
null;this.inputManager.disconnect();this.environmentManager.disconnectView();this.labeler.dispose();this._disposeGraphicsView();this.handles.remove("graphics-view");this._exitSurface();this._set("ready",!1)};cb._updateDefaultToMapOptions=function(){this._defaultToMapOptions.include.clear();if(this.map){this.map.ground&&this._defaultToMapOptions.include.add(Na.TERRAIN_ID);for(const Ea of this.map.allLayers.items)"integrated-mesh"===Ea.type&&this._defaultToMapOptions.include.add(Ea.uid)}};cb._updateDefaultHitTestOptions=
function(){this._defaultHitTestOptions.exclude.clear();if(this.map){this.map.ground&&1>this.map.ground.opacity&&this._defaultHitTestOptions.exclude.add(Na.TERRAIN_ID);for(const Ea of this.map.allLayers.items)"integrated-mesh"===Ea.type&&1>Ea.opacity&&this._defaultToMapOptions.exclude.add(Ea.uid)}};cb.getVoxelWasmPerSceneView=function(){return R.getInstance().getVoxelWasmPerSceneView(this)};b._createClass(Bb,[{key:"renderSpatialReference",get:function(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}},
{key:"basemapSpatialReference",get:function(){return this.basemapTerrain&&this.basemapTerrain.spatialReference}},{key:"clippingArea",get:function(){if("global"===this.viewingMode)return null;let Ea=this._userClippingArea||this.get("map.clippingArea");if(!this._userClippingArea&&!this.get("map.clippingEnabled")||m.isNone(Ea))return this._clippingArea=null;if(!(Ea instanceof fb))return kb.error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea;if(this.spatialReference&&
(Ea=hb(Ea,this.spatialReference),m.isNone(Ea)))return kb.error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea;Ea=Ea.clone();m.isNone(Ea.intersection(this.groundAndLayersExtent))&&(Ea.xmin=Ea.xmax,Ea.ymin=Ea.ymax);Ea.zmin=void 0;Ea.zmax=void 0;Ea.equals(this._clippingArea)||(this._clippingArea=Ea);return this._clippingArea},set:function(Ea){this.ready&&"global"===this.viewingMode&&m.isSome(Ea)?kb.error("#clippingArea\x3d","Clipping area is only supported in local viewingMode"):
this._userClippingArea=Ea}},{key:"renderDataExtent",get:function(){if(this.state.viewingMode===Y.ViewingMode.Global)return null;const Ea=this.renderSpatialReference,Da=this.dataExtent;return m.isNone(Da)||m.isNone(Ea)||Da.spatialReference.equals(Ea)?Da:hb(Da,Ea)}},{key:"dataExtent",get:function(){let Ea=this.groundAndLayersExtent;var Da=hb(this.clippingArea,this.spatialReference||Va.WGS84);m.isSome(Da)&&(Ea=m.isSome(Ea)?Ea.intersection(Da):Da);Da=this._get("dataExtent");return m.isSome(Ea)&&Ea.equals(Da)?
Da:Ea}},{key:"groundAndLayersExtent",get:function(){const Ea=this.spatialReference||Va.WGS84;let Da;const Oa=bb=>{bb=hb(bb,Ea);m.isNone(bb)||(m.isSome(Da)?Da.union(bb):Da=bb.clone())};var Ta=this.basemapTerrain;if(null!=Ta&&Ta.spatialReference){const bb=Ta.groundExtent;Oa(new fb({xmin:bb[0],ymin:bb[1],zmin:0,xmax:bb[2],ymax:bb[3],zmax:0,spatialReference:Ta.spatialReference}))}this.map&&this.map.allLayers.forEach(bb=>{!m.isSome(bb.fullExtent)||"graphics"===bb.type&&bb.internal||Oa(bb.fullExtent)});
if(m.isNone(Da))return null;Da.hasZ?(Da.zmin=Math.min(0,Da.zmin),Da.zmax=Math.max(0,Da.zmax)):(Da.zmin=0,Da.zmax=0);Ta=this._get("groundAndLayersExtent");return Da.equals(Ta)?Ta:Da}},{key:"environment",set:function(Ea){Ea!==this._defaults.environment&&(this._externallySet.environment=!0);this._set("environment",Ea)}},{key:"pixelRatio",get:function(){return Math.min(this.windowDevicePixelRatio,this.maximumPixelRatio)},set:function(Ea){m.isSome(Ea)?this._override("pixelRatio",Ea):this._clearOverride("pixelRatio")}},
{key:"maximumPixelRatio",get:function(){let Ea=Infinity;const {maximumPixelRatio:Da,maximumRenderResolution:Oa}=this.qualitySettings;null!=Da&&(Ea=Math.min(Ea,Da));null!=Oa&&(Ea=Math.min(Ea,Oa/Math.max(this.width,this.height)));return Ea},set:function(Ea){m.isSome(Ea)?this._override("maximumPixelRatio",Ea):this._clearOverride("maximumPixelRatio")}},{key:"initialExtentRequired",get:function(){return this.stateManager&&!this.stateManager.hasInitialView}},{key:"_defaultsFromMapSettings",get:function(){return{required:{tileInfo:!1,
heightModelInfo:!0,extent:!1}}}},{key:"interacting",get:function(){return this.navigating||m.isSome(this.activeTool)}},{key:"stationary",get:function(){return!this.animation&&!this.resizing&&(m.isNone(this.state)||this.state.stationary)}},{key:"qualityProfile",get:function(){return this._get("qualityProfile")||ya.getDefaultProfile()},set:function(Ea){ya.isValidProfile(Ea)&&(ya.apply(Ea,this.qualitySettings),this._set("qualityProfile",Ea))}},{key:"slicePlane",set:function(Ea){m.isSome(this._stage)&&
this._stage.renderView.setRenderParameters({slicePlane:Ea});if(m.isNone(Ea))this._set("slicePlane",null);else{var Da=this.propertiesPool.get("slicePlane");K.copy(Ea,Da);this._set("slicePlane",Da)}}},{key:"typeSpecificPreconditionsReady",get:function(){return!!this.viewingMode}},{key:"resolution",get:function(){return null!=this.spatialReference?U.getResolutionForScale(this.scale,this.spatialReference):0}},{key:"heightModelInfo",get:function(){const Ea=this.getDefaultHeightModelInfo();return null!=
Ea?I.deriveUnitFromSR(Ea,this.spatialReference):null}},{key:"updating",get:function(){var Ea,Da,Oa;if(this.destroyed)return!1;let Ta=0,bb=this.layerViewManager.updating,ib=bb?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(mb=>{mb.isFulfilled()?mb.updating&&(bb=!0,mb.suspended||ab.isSurfaceLayerView(mb)||(++ib,Ta+=mb.updatingProgress)):++ib});for(const mb of[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,
this.overlay,this.featureTreeDebugger,this.toolViewManager,this.analysisViewManager])m.isSome(mb)&&mb.updating&&(ib+=.1,Ta+=.05);for(const mb of[this.deconflictor,this.labeler,this.basemapTerrain])m.isSome(mb)&&mb.updating&&(++ib,Ta+=mb.updatingProgress);(bb=!!(bb||0<ib||this.updatingHandles.updating||!this.ready||!this.stationary||this._createGraphicsViewController||null!=(Ea=this.inputManager)&&Ea.hasPendingInputs||null!=(Da=this.map)&&null!=(Oa=Da.allLayers)&&Oa.some(mb=>!mb.isFulfilled())))?(this._numUpdating=
Math.max(ib,this._numUpdating),Ta+=this._numUpdating-ib):this._numUpdating=0;Ta=0<this._numUpdating?Ta/this._numUpdating:bb?0:1;this._get("updatingProgress")!==Ta&&(Ea=this._resourceController.scheduler.now,1>Ta&&(Da=Math.min((Ea-this._lastUpdateTime)/2E3,1),Ta=this.updatingProgress*(1-Da)+Ta*Da),this._set("updatingProgress",Ta),this._lastUpdateTime=bb&&1>Ta?Ea:0);return bb}},{key:"viewingMode",get:function(){var Ea,Da=this._predeterminedViewingMode;return m.isSome(Da)?Y.stringFromViewingMode(Da):
(Da=this.spatialReference)?m.isSome(null==(Ea=this.defaultsFromMap)?void 0:Ea.viewingMode)&&Da.equals(this.defaultsFromMap.spatialReference)?Y.stringFromViewingMode(this.defaultsFromMap.viewingMode):sa.isSpatialReferenceSupported(Da,Y.ViewingMode.Global)?"global":"local":"global"},set:function(Ea){this.ready?kb.error("#viewingMode","viewingMode cannot be set once view is ready"):Ea?this._override("viewingMode",Ea):void 0===Ea&&this._clearOverride("viewingMode")}},{key:"resourceController",get:function(){return this._resourceController}},
{key:"performanceInfo",get:function(){return new Ha(this)}},{key:"_predeterminedViewingMode",get:function(){var Ea,Da;const Oa=this._isOverridden("viewingMode")?this._get("viewingMode"):null!=(Ea=this.map&&"initialViewProperties"in this.map?null==(Da=this.map.initialViewProperties)?void 0:Da.viewingMode:null)?Ea:null;return m.isSome(Oa)?Y.viewingModeFromString(Oa):null}}]);return Bb}(T.BreakpointsOwner(S.DOMContainer(Q.PopupView(W))));c.__decorate([A.property()],g.prototype,"_userClippingArea",void 0);
c.__decorate([A.property()],g.prototype,"_resourceController",void 0);c.__decorate([A.property()],g.prototype,"_stage",void 0);c.__decorate([A.property({readOnly:!0})],g.prototype,"deconflictor",void 0);c.__decorate([A.property({readOnly:!0})],g.prototype,"labeler",void 0);c.__decorate([A.property(J.owningCollectionProperty(N.AnalysesCollection,"analyses"))],g.prototype,"analyses",void 0);c.__decorate([A.property({type:V,readOnly:!0,aliasOf:"state.animation"})],g.prototype,"animation",void 0);c.__decorate([A.property({readOnly:!0})],
g.prototype,"basemapTerrain",void 0);c.__decorate([A.property({readOnly:!0})],g.prototype,"elevationProvider",void 0);c.__decorate([A.property({type:d,aliasOf:"stateManager.camera"})],g.prototype,"camera",void 0);c.__decorate([A.property({type:d,aliasOf:"stateManager.contentCamera"})],g.prototype,"contentCamera",void 0);c.__decorate([A.property({readOnly:!0})],g.prototype,"canvas",void 0);c.__decorate([A.property({type:eb,aliasOf:"stateManager.center"})],g.prototype,"center",void 0);c.__decorate([A.property({type:fb})],
g.prototype,"clippingArea",null);c.__decorate([A.property({type:ba.default})],g.prototype,"constraints",void 0);c.__decorate([A.property({type:fb,readOnly:!0})],g.prototype,"renderDataExtent",null);c.__decorate([A.property({type:fb,readOnly:!0})],g.prototype,"dataExtent",null);c.__decorate([A.property({type:fb,readOnly:!0})],g.prototype,"groundAndLayersExtent",null);c.__decorate([A.property({value:null,type:ha})],g.prototype,"environment",null);c.__decorate([C.cast("environment")],g.prototype,"castEnvironment",
null);c.__decorate([A.property({readOnly:!0})],g.prototype,"environmentManager",void 0);c.__decorate([A.property({type:fb,aliasOf:"stateManager.extent"})],g.prototype,"extent",void 0);c.__decorate([A.property()],g.prototype,"floors",void 0);c.__decorate([A.property({readOnly:!0,aliasOf:"stateManager.screenCenter"})],g.prototype,"screenCenter",void 0);c.__decorate([A.property({type:Number})],g.prototype,"pixelRatio",null);c.__decorate([A.property({type:Number,dependsOn:["qualitySettings.maximumPixelRatio",
"qualitySettings.maximumRenderResolution","size"]})],g.prototype,"maximumPixelRatio",null);c.__decorate([A.property({aliasOf:"stateManager.frustum"})],g.prototype,"frustum",void 0);c.__decorate([A.property({type:Number,readOnly:!0})],g.prototype,"fullOpacity",void 0);c.__decorate([A.property({readOnly:!0})],g.prototype,"graphicsView",void 0);c.__decorate([A.property({readOnly:!0})],g.prototype,"analysisViewManager",void 0);c.__decorate([A.property()],g.prototype,"groundView",void 0);c.__decorate([A.property({type:Boolean})],
g.prototype,"initialExtentRequired",null);c.__decorate([A.property()],g.prototype,"_defaultsFromMapSettings",null);c.__decorate([A.property({type:Boolean,readOnly:!0})],g.prototype,"interacting",null);c.__decorate([A.property()],g.prototype,"stationary",null);c.__decorate([A.property({aliasOf:"state.navigating"})],g.prototype,"navigating",void 0);c.__decorate([A.property()],g.prototype,"map",void 0);c.__decorate([A.property({readOnly:!0})],g.prototype,"mapCoordsHelper",void 0);c.__decorate([A.property({aliasOf:"stateManager.padding"})],
g.prototype,"padding",void 0);c.__decorate([A.property({type:La.default,readOnly:!0})],g.prototype,"pointsOfInterest",void 0);c.__decorate([A.property({type:fa.default,readOnly:!0})],g.prototype,"featureTiles",void 0);c.__decorate([A.property()],g.prototype,"featureTreeDebugger",void 0);c.__decorate([A.property({type:Boolean})],g.prototype,"screenSizePerspectiveEnabled",void 0);c.__decorate([A.property({constructOnly:!0})],g.prototype,"deactivatedWebGLExtensions",void 0);c.__decorate([A.property({constructOnly:!0})],
g.prototype,"debugWebGLExtensions",void 0);c.__decorate([A.property({constructOnly:!0})],g.prototype,"renderCanvas",void 0);c.__decorate([A.property({constructOnly:!0})],g.prototype,"state",void 0);c.__decorate([A.property({readOnly:!0})],g.prototype,"inputManager",void 0);c.__decorate([A.property({readOnly:!0})],g.prototype,"stateManager",void 0);c.__decorate([A.property({type:["low","medium","high"]})],g.prototype,"qualityProfile",null);c.__decorate([A.property({type:qa,get(){let rb=this._get("qualitySettings");
rb||(rb=new qa,ya.apply(this.qualityProfile,rb));return rb}})],g.prototype,"qualitySettings",void 0);c.__decorate([A.property()],g.prototype,"slicePlane",null);c.__decorate([A.property({readOnly:!0})],g.prototype,"typeSpecificPreconditionsReady",null);c.__decorate([A.property({readOnly:!0})],g.prototype,"renderCoordsHelper",void 0);c.__decorate([A.property({readOnly:!0})],g.prototype,"sceneIntersectionHelper",void 0);c.__decorate([A.property({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],
g.prototype,"resolution",null);c.__decorate([A.property({type:Number,aliasOf:"stateManager.scale"})],g.prototype,"scale",void 0);c.__decorate([A.property()],g.prototype,"heightModelInfo",null);c.__decorate([A.property()],g.prototype,"spatialReference",void 0);c.__decorate([A.property({type:Boolean,constructOnly:!0})],g.prototype,"alphaCompositingEnabled",void 0);c.__decorate([A.property({type:Boolean})],g.prototype,"supersampleScreenshotsEnabled",void 0);c.__decorate([A.property({readOnly:!0})],g.prototype,
"type",void 0);c.__decorate([A.property({type:Ma})],g.prototype,"ui",void 0);c.__decorate([A.property({type:Boolean,readOnly:!0,dependsOn:"graphicsView.updating basemapView.updating basemapTerrain.updating layerViewManager.updating layerViewManager.updatingRemaining _resourceController.updating _stage.updating featureTiles.updating pointsOfInterest.updating environmentManager.updating overlay.updating updatingHandles.updating featureTreeDebugger.updating labeler.updating deconflictor.updating ready stationary inputManager.hasPendingInputs toolViewManager.updating analysisViewManager.updating".split(" ")})],
g.prototype,"updating",null);c.__decorate([A.property({type:Number,readOnly:!0,dependsOn:["updating"]})],g.prototype,"updatingProgress",void 0);c.__decorate([A.property({type:["global","local"]})],g.prototype,"viewingMode",null);c.__decorate([A.property({type:l,aliasOf:"stateManager.viewpoint"})],g.prototype,"viewpoint",void 0);c.__decorate([A.property({type:Number,aliasOf:"stateManager.zoom"})],g.prototype,"zoom",void 0);c.__decorate([A.property({type:pa})],g.prototype,"highlightOptions",void 0);
g=c.__decorate([D.subclass("esri.views.SceneView")],g);var Ab;(function(rb){rb[rb.INCLUDE=0]="INCLUDE";rb[rb.EXCLUDE=1]="EXCLUDE"})(Ab||(Ab={}));const yb=G.create(),zb=B.createScreenPointArray(),wb=P.create();return g})},"esri/core/iteratorUtils":function(){define(["exports"],function(a){a.cache=function(b){const c=[];return function*(){yield*c;for(const d of b)c.push(d),yield d}};a.find=function(b,c){for(const d of b)if(null!=d&&c(d))return d};a.isIterable=function(b){return null!=b&&"function"===
typeof b[Symbol.iterator]};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/coordinateSystem":function(){define("exports ../../chunks/mat4 ../../chunks/vec3 ../../chunks/vec3f64 ../projectionEllipsoid ../SpatialReference ./Axis ../../chunks/boundedPlane ../../chunks/sphere".split(" "),function(a,b,c,d,g,x,w,l,n){function f(m){return{operations:m,value:m.create()}}function e(m,u,t=f(m)){t.operations=m;m.copy(u,t.value);return t}function k(m,u,t,q){return m.operations.setAltitudeAt(m.value,
u,t,q)}const r=2**50,y=d.create(),p={operations:null,value:null},h=d.create();a.altitudeAt=function(m,u){return m.operations.altitudeAt(m.value,u)};a.axisAt=function(m,u,t,q){return m.operations.axisAt(m.value,u,t,q)};a.closestPoint=function(m,u,t){return m.operations.closestPoint(m.value,u,t)};a.closestPointOnSilhouette=function(m,u,t){return m.operations.closestPointOnSilhouette(m.value,u,t)};a.coordinateSystemFromOneAxisAndNormalVector=function(m,u,t,q,z){c.copy(t,m);c.copy(h,u);c.normalize(h,
h);c.cross(q,h,t);c.cross(z,q,t)};a.create=function(m){const {value:u,operations:t}=m;return{operations:t,value:t.create(u)}};a.createFromOperations=f;a.createGlobal=function(m){return e(n.sphere,n.fromValues(0,0,0,g.getReferenceEllipsoid(m).radius))};a.createLocal=function(){return e(l.boundedPlane,l.fromValues([0,0,0],[r,0,0],[0,r,0]))};a.distanceToSilhouette=function(m,u){return m.operations.distanceToSilhouette(m.value,u)};a.elevate=function(m,u,t){return m.operations.elevate(m.value,u,t.value)};
a.fromValues=e;a.intersectRay=function(m,u,t){return m.operations.intersectRay(m.value,u,t)};a.intersectRayClosestSilhouette=function(m,u,t){return m.operations.intersectRayClosestSilhouette(m.value,u,t)};a.intersectsRay=function(m,u){return m.operations.intersectRay(m.value,u,null)};a.normalAt=function(m,u,t){return m.operations.axisAt(m.value,u,w.Axis.Z,t)};a.renderSRFromViewSR=function(m,u){return m?g.getSphericalPCPF(u):u.isGeographic?x.PlateCarree:u};a.setAltitudeAt=k;a.setAltitudeOfTransformation=
function(m,u,t,q){u!==q&&b.copy(q,u);c.set(y,q[12],q[13],q[14]);k(m,y,t,y);q[12]=y[0];q[13]=y[1];q[14]=y[2];return q};a.setExtent=function(m,u,t){m.operations.setExtent(m.value,u,t.value);return t};a.vectorCoordinates=function(m,u,t,q,z){z[0]=c.dot(m,u);z[1]=c.dot(m,t);z[2]=c.dot(m,q);return z};a.wrap=function(m,u){p.operations=m;p.value=u;return p};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/VoxelWasmManager":function(){define(["./VoxelWasmPerScene"],function(a){return function(){function b(){this.view2WASM=
new Map}b.getInstance=function(){b.instance||(b.instance=new b);return b.instance};var c=b.prototype;c.getVoxelWasmPerSceneView=function(d){return this.view2WASM.has(d)?this.view2WASM.get(d):null};c.isUpdating=function(d,g){return this.view2WASM.has(d)?this.view2WASM.get(d).isUpdating(g):!1};c.addLayer=function(d,g){this.view2WASM.has(d)||this.view2WASM.set(d,new a(d));return this.view2WASM.get(d).addVoxelLayer(g)};c.removeLayer=function(d,g){this.view2WASM.has(d)&&1>this.view2WASM.get(d).removeVoxelLayer(g)&&
this.view2WASM.delete(d)};c.setLayerEnabled=function(d,g,x){this.view2WASM.has(d)&&this.view2WASM.get(d).setEnabled(g,x)};c.setLayerSlices=function(d,g){let x=!1;this.view2WASM.forEach((w,l)=>{l.allLayerViews.filter(n=>"voxel-3d"===n.type).forEach(n=>{n.layer===d&&(x=w.setSlices(n,g))})});return x};c.setLayerDynamicSections=function(d,g){let x=!1;this.view2WASM.forEach((w,l)=>{l.allLayerViews.filter(n=>"voxel-3d"===n.type).forEach(n=>{n.layer===d&&(x=w.setDynamicSections(n,g))})});return x};c.setLayerCurrentVariable=
function(d,g){let x=!1;this.view2WASM.forEach((w,l)=>{l.allLayerViews.filter(n=>"voxel-3d"===n.type).forEach(n=>{n.layer===d&&(x=w.setCurrentVariable(n,g))})});return x};c.setLayerRenderMode=function(d,g){let x=!1;this.view2WASM.forEach((w,l)=>{l.allLayerViews.filter(n=>"voxel-3d"===n.type).forEach(n=>{n.layer===d&&(x=w.setRenderMode(n,g))})});return x};c.setLayerStaticSections=function(d,g){let x=!1;this.view2WASM.forEach((w,l)=>{l.allLayerViews.filter(n=>"voxel-3d"===n.type).forEach(n=>{n.layer===
d&&(x=w.setStaticSections(n,g))})});return x};return b}()})},"esri/layers/VoxelWasmPerScene":function(){define("../chunks/_rollupPluginBabelHelpers ../request ../core/has ../core/Logger ../core/maybe ../core/promiseUtils ../core/reactiveUtils ../libs/vxl/enums ../libs/vxl/VxlModule ../views/3d/webgl-engine/lib/RenderPass ../views/3d/webgl-engine/lib/RenderSlot ../views/webgl/context-util ../views/webgl/enums".split(" "),function(a,b,c,d,g,x,w,l,n,f,e,k,r){const y=d.getLogger("esri.layers.VoxelWasmPerScene");
var p;(function(h){h[h.Lifetime=1]="Lifetime";h[h.RequestResponse=2]="RequestResponse";h[h.Rendering=3]="Rendering";h[h.Error=4]="Error"})(p||(p={}));return function(){function h(u){this._havePreparedWithAllLayers=this._halfIntTexturesAvailable=!1;this._vxl=this._renderPluginContext=null;this._moreToLoad=this._pluginIsActive=!1;this._viewportHeight=this._viewportWidth=-1;this._newLayers=[];this._layers=new Map;this._renderPass=f.RenderPass.MATERIAL;this._renderSlot=e.RenderSlot.VOXEL;this._renderTargetToRestore=
this._rctx=null;this._lastFrameWasStationary=!1;this._wasmMemBlockSizes=[512,1024,2048,4096,8192,16384,32768,65536];this._wasmMemBlocks=new Map;this._dbgFlags=new Set;this._view=u;this._initialize()}var m=h.prototype;m._dbg=function(u,t){this._dbgFlags.has(u)&&(u===p.Error?y.error(t):y.warn(t))};m._removeRenderPlugin=function(){this._pluginIsActive&&this._view._stage&&(this._dbg(p.Lifetime,"--removeRenderPlugin--"),this._view._stage.removeRenderPlugin(this));this._pluginIsActive=!1};m._initialize=
function(){this._dbg(p.Lifetime,"--initialize--");for(const u of this._wasmMemBlockSizes)this._wasmMemBlocks.set(u,0);this._readyWatchHandle=w.watch(()=>this._view.ready,u=>{u&&"local"===this._view.viewingMode?(this._dbg(p.Lifetime,"view ready status changed to ready on a local view, calling addRenderPlugin"),this._view._stage.addRenderPlugin([this._renderSlot],this),this._pluginIsActive=!0):(this._dbg(p.Lifetime,"view ready status changed, not ready or not a local view!"),this._removeRenderPlugin())},
{initial:!0});this._qualityWatchHandle=w.watch(()=>{var u;return null==(u=this._view)?void 0:u.qualityProfile},u=>{this._dbg(p.Rendering,"qualityProfile changed to "+u);this._vxl&&this._vxl.set_quality(this._toWasmQuality(u))},{initial:!0});this._timeExtentWatchHandle=w.watch(()=>{var u;return null==(u=this._view)?void 0:u.timeExtent},()=>{if(this._vxl){var u;const t=this._getTimeArgs(null==(u=this._view)?void 0:u.timeExtent);this._dbg(p.Rendering,"sceneView timeExtent changed to useTime\x3d"+t.useTime+
" st\x3d"+t.startTime+" et\x3d"+t.endTime);this._vxl.set_scene_time_extent(t.startTime,t.endTime,t.useTime);this._renderPluginContext.requestRender()}},{initial:!0});this._stationaryWatchHandle=w.watch(()=>{var u;return null==(u=this._view)?void 0:u.stationary},u=>{this._vxl&&u&&!this._lastFrameWasStationary&&this._renderPluginContext.requestRender()})};m.initializeRenderContext=function(u){this._dbg(p.Lifetime,"--initializeRenderContext--");const t=u.renderContext.rctx;t.type===k.ContextType.WEBGL2?
(this._renderPluginContext=u,this._rctx=u.renderContext.rctx,this._halfIntTexturesAvailable=!!this._rctx.capabilities.textureNorm16,this._initializeWasm(t.gl)):this._dbg(p.Error,"WebGL 1 context only!")};m.uninitializeRenderContext=function(){this._rctx=this._renderPluginContext=null;this._dbg(p.Lifetime,"--uninitializeRenderContext--")};m._restoreFramebuffer=function(){if(this._renderTargetToRestore){var u=this._renderTargetToRestore.fbo;this._rctx?(this._rctx.bindFramebuffer(u,!0),u=this._renderTargetToRestore.viewport,
this._rctx.setViewport(u.x,u.y,u.width,u.height)):this._dbg(p.Error,"no context in restoreFramebuffer!")}};m._bindPreviousDepthToSlot=function(u,t){var q=!!this._renderTargetToRestore;if(!this._rctx||!q)return 0;q=this._renderTargetToRestore.fbo.depthStencilTexture;if(!q)return this._dbg(p.Error,"no depth/stencil texture exists!"),0;0===t?this._rctx.bindTexture(null,u,!0):this._rctx.bindTexture(q,u,!0);return 1};m._modifyResourceCount=function(u,t,q){this._rctx?1===q?this._rctx.instanceCounter.increment(u,
t):this._rctx.instanceCounter.decrement(u,t):this._dbg(p.Error,"modifyAllocation callback has no rendering context!")};m._setBlendState=function(u,t,q,z){this._rctx?(this._rctx.setBlendingEnabled(1===u),this._rctx.setBlendFunction(t,q),this._rctx.setBlendEquation(z)):this._dbg(p.Error,"setBlendState callback has no rendering context!")};m._setFrontFace=function(u){this._rctx?this._rctx.setFrontFace(u):this._dbg(p.Error,"setFrontFace callback has no rendering context!")};m._setDepthStencilStateFunction=
function(u,t,q){this._rctx?(this._rctx.setDepthFunction(q),this._rctx.setDepthTestEnabled(1===u),this._rctx.setDepthWriteEnabled(1===t),this._rctx.setStencilTestEnabled(!1),this._rctx.setStencilFunction(r.CompareFunction.ALWAYS,0,255),this._rctx.setStencilOpSeparate(r.Face.FRONT,r.StencilOperation.KEEP,r.StencilOperation.INCR,r.StencilOperation.KEEP),this._rctx.setStencilOpSeparate(r.Face.BACK,r.StencilOperation.KEEP,r.StencilOperation.DECR,r.StencilOperation.KEEP)):this._dbg(p.Error,"setDepthStencilStateFunction callback has no rendering context!")};
m._setRasterizerState=function(u){if(this._rctx)switch(u){case l.WasmCullMode.None:this._rctx.setFaceCullingEnabled(!1);break;case l.WasmCullMode.Back:this._rctx.setCullFace(r.Face.BACK);this._rctx.setFaceCullingEnabled(!0);break;case l.WasmCullMode.Front:this._rctx.setCullFace(r.Face.FRONT),this._rctx.setFaceCullingEnabled(!0)}else this._dbg(p.Error,"setRasterizerState callback has no rendering context!")};m._setViewport=function(u,t,q,z){this._rctx?this._rctx.setViewport(u,t,q,z):this._dbg(p.Error,
"setViewport callback has no rendering context!")};m._updateMemoryUsage=function(){this._layers.forEach((u,t)=>{u.needMemoryUsageUpdate&&(t=this._vxl.estimate_memory_usage(t),0<=t&&(u.needMemoryUsageUpdate=!1,u.layerView.setUsedMemory(t)))})};m._syncRequestsResponses=function(){this._layers.forEach((u,t)=>{const q=[];u.responses.forEach((A,E)=>{q.push(E);this._dbg(p.RequestResponse,"responding for requestID:"+E+" size:"+A.size);this._vxl.respond(t,E,A);if(A.requestType===l.VoxelRequestType.TreeIndex||
A.requestType===l.VoxelRequestType.Section)u.needMemoryUsageUpdate=!0});const z=u.responses;for(var v of q)z.delete(v);v=this._vxl.get_new_requests(t);const B=u.abortController.signal;for(const A in v){u.outstandingRequestCount+=1;1===u.outstandingRequestCount&&u.layerView.updatingFlagChanged();const E=v[A],C={responseType:"array-buffer",signal:B};this._dbg(p.RequestResponse,"making requestID:"+A+" url:"+E.url);b(E.url,C).then(D=>{--u.outstandingRequestCount;0===u.outstandingRequestCount&&u.layerView.updatingFlagChanged();
this._dbg(p.RequestResponse,"have response for requestID:"+A);let F=0;if(0<D.data.byteLength){F=this._vxl._malloc(D.data.byteLength);const G=new Uint8Array(this._vxl.HEAPU8.buffer,F,D.data.byteLength),J=new Uint8Array(D.data);for(let I=0;I<D.data.byteLength;++I)G[I]=J[I]}z.set(+A,{responseType:E.responseType,ptr:F,size:D.data.byteLength,success:!0,requestType:E.requestType})}).catch(D=>{--u.outstandingRequestCount;0===u.outstandingRequestCount&&u.layerView.updatingFlagChanged();x.isAbortError(D)||
(this._dbg(p.Error,`requestID:${A} failed, error=${D.toString()}`),z.set(+A,{responseType:E.responseType,ptr:0,size:0,success:!1,requestType:E.requestType}))})}})};m.updateWasmCamera=function(u){this._vxl.set_projection_matrix.apply(this._vxl,u.projectionMatrix);this._vxl.set_view_matrix.apply(this._vxl,u.viewMatrix);this._vxl.set_near_far(u.near,u.far)};m.isUpdating=function(u){return!this._vxl&&this._vxlPromise?!0:this._layers.has(u)?0<this._layers.get(u).outstandingRequestCount:!1};m.setEnabled=
function(u,t){this._layers.forEach((q,z)=>{q.layerView===u&&(this._vxl.set_enabled(z,t),this._renderPluginContext.requestRender())})};m.setSlices=function(u,t){return this._doMaskedUIUpdate(u,{mask:l.UpdateFlags.Slices,slices:{planes:t,currentEditPlane:-1}},!0)};m.setDynamicSections=function(u,t){return this._doMaskedUIUpdate(u,{mask:l.UpdateFlags.DynamicSections,dynamicSections:{planes:t,currentEditPlane:-1}},!0)};m.setStaticSections=function(u,t){return this._doMaskedUIUpdate(u,{mask:l.UpdateFlags.StaticSections,
staticSections:t},!0)};m.setCurrentVariable=function(u,t){return this._doMaskedUIUpdate(u,{mask:l.UpdateFlags.CurrentVariable,currentVariable:t},!0)};m.setRenderMode=function(u,t){return this._doMaskedUIUpdate(u,{mask:l.UpdateFlags.RenderMode,renderMode:t},!0)};m._doMaskedUIUpdate=function(u,t,q){if(!this._vxl)return!1;let z=!1;this._layers.forEach((v,B)=>{v.layerView===u&&(v={str:JSON.stringify(t),byteCount:0,ptr:0,isReusable:!1},this._allocateBlock(v)&&(z=1===this._vxl.handle_masked_ui_update(B,
v.ptr,v.byteCount)?!0:!1,v.isReusable||this._vxl._free(v.ptr)))});z&&q&&this._renderPluginContext.requestRender();return z};m.addVoxelLayer=function(u){if(!this._vxl){const t={layerView:u,resolveCallback:null,rejectCallback:null};u=new Promise((q,z)=>{t.resolveCallback=q;t.rejectCallback=z});this._newLayers.push(t);return u}u=this._addVoxelLayer(u);return 0>u?Promise.reject(-1):Promise.resolve(u)};m.removeVoxelLayer=function(u){if(!this._vxl){var t=this._newLayers.findIndex(z=>u===z.layerView);0<=
t&&(this._newLayers[t].resolveCallback(-1),this._newLayers.splice(t,1));t=this._newLayers.length;0===t&&(this._dbg(p.Lifetime," no voxel layers left after removing a layer, removing RenderPlugin and destroying"),this.destroy());return t}let q=-1;this._layers.forEach((z,v)=>{z.layerView===u&&(q=v,z.abortController.abort(),this._vxl.remove_layer(q))});0<=q&&this._layers.delete(q);t=this._layers.size;0===t&&(this._dbg(p.Lifetime," no voxel layers left after removing a layer, removing RenderPlugin and destroying"),
this.destroy());return t};m._getBlockSize=function(u){for(const t of this._wasmMemBlockSizes)if(u<t)return t;return-1};m._allocateBlock=function(u){u.byteCount=this._vxl.lengthBytesUTF8(u.str)+1;const t=this._getBlockSize(u.byteCount);0>t?(u.isReusable=!1,u.ptr=this._vxl._malloc(u.byteCount)):(u.isReusable=!0,u.ptr=this._wasmMemBlocks.get(t),0===u.ptr&&(u.ptr=this._vxl._malloc(t),this._wasmMemBlocks.set(t,u.ptr)));return 0!==u.ptr?(this._vxl.stringToUTF8(u.str,u.ptr,u.byteCount),!0):!1};m._getTimeArgs=
function(u){let t=-Number.MAX_VALUE,q=Number.MAX_VALUE,z=!1;g.isSome(u)&&(u.isAllTime?z=!0:(g.isSome(u.start)&&(z=!0,t=u.start.getTime()/1E3),g.isSome(u.end)&&(z=!0,q=u.end.getTime()/1E3)));return{startTime:t,endTime:q,useTime:z}};m._addVoxelLayer=function(u){var t,q=u.layer,z=-1;z=q.getConfiguration();if(1>z.length)return-1;const v={str:z,byteCount:0,ptr:0,isReusable:!1};if(!this._allocateBlock(v))return-1;z=this._getTimeArgs(null==(t=this._view)?void 0:t.timeExtent);t=this._view.spatialReference.isWGS84&&
q.spatialReference.isWGS84?111319.49079327357:1;z=this._vxl.add_layer(q.serviceRoot,v.ptr,v.byteCount,t,t,z.startTime,z.endTime,z.useTime,this._toWasmQuality(this._view.qualityProfile));v.isReusable||this._vxl._free(v.ptr);if(0<=z){q=new AbortController;this._layers.set(z,{layerView:u,responses:new Map,outstandingRequestCount:0,abortController:q,needMemoryUsageUpdate:!1});if(!this._halfIntTexturesAvailable||c("mac")){q=[];t="";for(const B of u.layer.variables)if("Int16"===B.renderingFormat.type||
"UInt16"===B.renderingFormat.type)q.push(B.name),B.id===u.layer.style.currentVariableId&&(t=B.name);""!==t&&y.error("#addVoxelLayer_error()",u.layer,`The voxel layer '${u.layer.title}' cannot render the current variable '${t}' in this browser`);0<q.length&&y.warn("#addVoxelLayer_warning()",u.layer,`The voxel layer '${u.layer.title}' cannot render the variables '${q.toString()}' in this browser`)}c("esri-mobile")&&y.warnOnce("Mobile support differs across devices. Voxel layer might not display as expected.");
return z}return-1};m.prepareRender=function(u){if(this._vxl){var t=u.viewForward;u=u.eye;this._vxl.update_camera_pos_and_direction(u[0],u[1],u[2],t[0],t[1],t[2]);t=this._vxl.cull();this._dbg(p.RequestResponse,"missingResourceCount\x3d"+t);this._moreToLoad=0<t;this._havePreparedWithAllLayers=0===this._newLayers.length;this._updateMemoryUsage()}};m.render=function(u){if(this._vxl&&u.pass===this._renderPass&&u.slot===this._renderSlot){for(var t of this._newLayers){const q=this._addVoxelLayer(t.layerView);
-1===q?t.rejectCallback(-1):t.resolveCallback(q)}this._newLayers=[];if(0===this._layers.size)this._dbg(p.Error,"No voxel layers but RenderPlugin instance is being asked to render!");else{this._renderTargetToRestore={fbo:this._rctx.getBoundFramebufferObject(),viewport:this._rctx.getViewport()};this._syncRequestsResponses();this._lastFrameWasStationary=this._view.stationary;this._rctx.setPolygonOffsetFillEnabled(!1);this._rctx.setScissorTestEnabled(!1);this._rctx.setColorMask(!0,!0,!0,!0);this._vxl.begin_color_frame(!this._view.stationary||
this._moreToLoad,u.scenelightingData.lightingMainDirection[0],u.scenelightingData.lightingMainDirection[1],u.scenelightingData.lightingMainDirection[2]);t=this._renderTargetToRestore.viewport;if(t.width!==this._viewportWidth||t.height!==this._viewportHeight)this._viewportWidth=t.width,this._viewportHeight=t.height,this._vxl.set_viewport(t.width,t.height),this._layers.forEach(q=>{q.needMemoryUsageUpdate=!0});0===t.x&&0===t.y||this._dbg(p.Error,"Unsupported viewport parameters detected!");this.updateWasmCamera(u.camera);
this._vxl.draw();this._renderTargetToRestore.fbo=null;u.rctx.externalTextureUnitUpdate(this._vxl.get_texture_units_bound_in_frame(),this._vxl.get_active_texture_unit());u.rctx.externalVertexArrayObjectUpdate();u.rctx.externalVertexBufferUpdate();this._rctx.externalProgramUpdate();(this._moreToLoad||!this._havePreparedWithAllLayers&&0<this._layers.size)&&this._renderPluginContext.requestRender()}}};m.destroy=function(){this._dbg(p.Lifetime,"--destroy--");this._removeRenderPlugin();this._readyWatchHandle=
g.removeMaybe(this._readyWatchHandle);this._qualityWatchHandle=g.removeMaybe(this._qualityWatchHandle);this._timeExtentWatchHandle=g.removeMaybe(this._timeExtentWatchHandle);this._stationaryWatchHandle=g.removeMaybe(this._stationaryWatchHandle);this._vxl&&(this._layers.forEach(u=>{u.abortController.abort()}),this._wasmMemBlocks.forEach(u=>{0!==u&&this._vxl._free(u)}),this._vxl.uninitialize_voxel_wasm(),this._vxl=null)};m._initializeWasm=function(u){if(this._vxl)return Promise.resolve();this._vxlPromise||
(this._vxlPromise=n.loadVoxelWASM(u).then(t=>{var q;this._vxl=t;this._vxlPromise=null;if(0>=this._newLayers.length)this._dbg(p.Lifetime," no voxel layers left after WASM downloaded, removing RenderPlugin and destroying"),this.destroy();else{t=this._getTimeArgs(null==(q=this._view)?void 0:q.timeExtent);q=this._vxl.addFunction(this._restoreFramebuffer.bind(this),"v");var z=this._vxl.addFunction(this._setBlendState.bind(this),"viiii"),v=this._vxl.addFunction(this._setFrontFace.bind(this),"vi"),B=this._vxl.addFunction(this._setRasterizerState.bind(this),
"vi"),A=this._vxl.addFunction(this._setDepthStencilStateFunction.bind(this),"viii"),E=this._vxl.addFunction(this._setViewport.bind(this),"viiii"),C=this._vxl.addFunction(this._bindPreviousDepthToSlot.bind(this),"iii"),D=this._vxl.addFunction(this._modifyResourceCount.bind(this),"viii"),F=this._halfIntTexturesAvailable&&!c("mac");this._vxl.initialize_voxel_wasm(q,z,v,B,A,E,C,D,t.startTime,t.endTime,t.useTime,F);this._renderPluginContext&&this._renderPluginContext.requestRender()}}).catch(()=>{for(const t of this._newLayers)t.rejectCallback(-2);
this._dbg(p.Error," WASM failed to download, removing RenderPlugin and destroying");this.destroy()}));return this._vxlPromise};m.pickDepth=function(u,t,q){if(!this._vxl||!this._rctx||0===this._layers.size)return null;const z=q.viewport[3]-t;if(0>u||u>q.viewport[2]||0>t||t>q.viewport[3])return this._dbg(p.Error,`pickDepth: outOfRange, screenXY=[${u}, ${z}], vp=[${q.viewport.toString()}]`),null;this._renderTargetToRestore={fbo:this._rctx.getBoundFramebufferObject(),viewport:this._rctx.getViewport()};
t=q.viewForward;const v=q.eye;this._vxl.update_camera_pos_and_direction(v[0],v[1],v[2],t[0],t[1],t[2]);this.updateWasmCamera(q);this._vxl.begin_frame();u=this._vxl.pick_depth(u,z);this._renderTargetToRestore.fbo=null;this._rctx.externalTextureUnitUpdate(this._vxl.get_texture_units_bound_in_frame(),this._vxl.get_active_texture_unit());this._rctx.externalVertexArrayObjectUpdate();this._rctx.externalVertexBufferUpdate();this._rctx.externalProgramUpdate();return u.success?u.distanceToCamera:null};m._toWasmQuality=
function(u){switch(u){case "low":return 0;case "medium":return 1;case "high":return 2}};a._createClass(h,[{key:"canRender",get:function(){return!!this._vxl&&"local"===this._view.viewingMode}}]);return h}()})},"esri/libs/vxl/enums":function(){define(["exports"],function(a){a.WasmResponseType=void 0;(function(b){b[b.Binary=0]="Binary";b[b.JSON=1]="JSON"})(a.WasmResponseType||(a.WasmResponseType={}));a.VoxelRequestType=void 0;(function(b){b[b.TreeIndex=0]="TreeIndex";b[b.TreeStats=1]="TreeStats";b[b.TreeData=
2]="TreeData";b[b.BrickBundles=3]="BrickBundles";b[b.Section=4]="Section";b[b.VariableStats=5]="VariableStats"})(a.VoxelRequestType||(a.VoxelRequestType={}));a.WasmCullMode=void 0;(function(b){b[b.None=1]="None";b[b.Front=2]="Front";b[b.Back=3]="Back"})(a.WasmCullMode||(a.WasmCullMode={}));a.WasmRenderingQuality=void 0;(function(b){b[b.Low=0]="Low";b[b.Medium=1]="Medium";b[b.High=2]="High"})(a.WasmRenderingQuality||(a.WasmRenderingQuality={}));a.UpdateFlags=void 0;(function(b){b[b.None=0]="None";
b[b.StaticSections=1]="StaticSections";b[b.Slices=2]="Slices";b[b.DynamicSections=4]="DynamicSections";b[b.GhostShell=8]="GhostShell";b[b.Isosurface=16]="Isosurface";b[b.Quality=32]="Quality";b[b.SunLocation=64]="SunLocation";b[b.StaticSectionSelection=128]="StaticSectionSelection";b[b.ExaggerationAndOffset=256]="ExaggerationAndOffset";b[b.CurrentTime=512]="CurrentTime";b[b.CurrentVariable=1024]="CurrentVariable";b[b.DeleteIsosurface=2048]="DeleteIsosurface";b[b.ContainerVisibility=4096]="ContainerVisibility";
b[b.RenderMode=8192]="RenderMode";b[b.Optimization=16384]="Optimization"})(a.UpdateFlags||(a.UpdateFlags={}));Object.defineProperty(a,"__esModule",{value:!0})})},"esri/libs/vxl/VxlModule":function(){define(["require","exports","../../assets"],function(a,b,c){function d(g){return c.getAssetUrl(`esri/libs/vxl/${g}`)}b.loadVoxelWASM=function(g){return(new Promise(x=>(new Promise((w,l)=>a(["../../chunks/vxlLayer"],w,l))).then(w=>w.vxlLayer).then(({default:w})=>{const l=w({locateFile:d,preinitializedWebGLContext:g,
onRuntimeInitialized:()=>x(l)})}))).catch(x=>Promise.reject(x))};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/RenderPass":function(){define(["exports"],function(a){a.RenderPass=void 0;var b=a.RenderPass||(a.RenderPass={});b[b.MATERIAL=0]="MATERIAL";b[b.MATERIAL_ALPHA=1]="MATERIAL_ALPHA";b[b.MATERIAL_DEPTH=2]="MATERIAL_DEPTH";b[b.MATERIAL_NORMAL=3]="MATERIAL_NORMAL";b[b.MATERIAL_DEPTH_SHADOWMAP_ALL=4]="MATERIAL_DEPTH_SHADOWMAP_ALL";b[b.MATERIAL_HIGHLIGHT=5]="MATERIAL_HIGHLIGHT";
b[b.MATERIAL_DEPTH_SHADOWMAP_DEFAULT=6]="MATERIAL_DEPTH_SHADOWMAP_DEFAULT";b[b.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT=7]="MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT";b[b.MAX_PASS=8]="MAX_PASS";Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/RenderSlot":function(){define(["exports"],function(a){a.RenderSlot=void 0;var b=a.RenderSlot||(a.RenderSlot={});b[b.INTEGRATED_MESH=0]="INTEGRATED_MESH";b[b.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN";b[b.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL";b[b.OPAQUE_PLUGIN=
3]="OPAQUE_PLUGIN";b[b.TRANSPARENT_MATERIAL=4]="TRANSPARENT_MATERIAL";b[b.TRANSPARENT_PLUGIN=5]="TRANSPARENT_PLUGIN";b[b.TRANSPARENT_TERRAIN=6]="TRANSPARENT_TERRAIN";b[b.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=7]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL";b[b.OCCLUDED_TERRAIN=8]="OCCLUDED_TERRAIN";b[b.OCCLUDER_MATERIAL=9]="OCCLUDER_MATERIAL";b[b.TRANSPARENT_OCCLUDER_MATERIAL=10]="TRANSPARENT_OCCLUDER_MATERIAL";b[b.OCCLUSION_PIXELS=11]="OCCLUSION_PIXELS";b[b.POSTPROCESSING_ENVIRONMENT_OPAQUE=12]=
"POSTPROCESSING_ENVIRONMENT_OPAQUE";b[b.POSTPROCESSING_ENVIRONMENT_TRANSPARENT=13]="POSTPROCESSING_ENVIRONMENT_TRANSPARENT";b[b.LASERLINES=14]="LASERLINES";b[b.LASERLINES_CONTRAST_CONTROL=15]="LASERLINES_CONTRAST_CONTROL";b[b.HUD_MATERIAL=16]="HUD_MATERIAL";b[b.LABEL_MATERIAL=17]="LABEL_MATERIAL";b[b.LINE_CALLOUTS=18]="LINE_CALLOUTS";b[b.LINE_CALLOUTS_HUD_DEPTH=19]="LINE_CALLOUTS_HUD_DEPTH";b[b.DRAPED_MATERIAL=20]="DRAPED_MATERIAL";b[b.DRAPED_WATER=21]="DRAPED_WATER";b[b.VOXEL=22]="VOXEL";b[b.MAX_SLOTS=
23]="MAX_SLOTS";Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/context-util":function(){define(["exports","../../core/has","../../core/maybe"],function(a,b,c){function d(l){const n=b("esri-force-webgl");if(n===a.ContextType.WEBGL1||n===a.ContextType.WEBGL2)return[n];switch(l){case "2d":return[a.ContextType.WEBGL1];case "3d":return[a.ContextType.WEBGL2,a.ContextType.WEBGL1]}}function g(l,n,f={}){if(!window.WebGLRenderingContext)return w(l,'This page requires a browser that supports WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org"\x3eClick here to upgrade your browser.\x3c/a\x3e'),
null;n=x(l,n,f);c.isNone(n)&&w(l,'It doesn\'t appear your computer can support WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org/troubleshooting/"\x3eClick here for more information.\x3c/a\x3e');return n}function x(l,n,f={}){n=n===a.ContextType.WEBGL1?["webgl","experimental-webgl","webkit-3d","moz-webgl"]:["webgl2"];let e=null;for(const k of n){try{e=l.getContext(k,f)}catch(r){}if(e)break}return e}function w(l,n){(l=l.parentNode)&&(l.innerHTML='\x3ctable style\x3d"background-color: #8CE; width: 100%; height: 100%;"\x3e\x3ctr\x3e\x3ctd align\x3d"center"\x3e\x3cdiv style\x3d"display: table-cell; vertical-align: middle;"\x3e\x3cdiv style\x3d""\x3e'+
n+"\x3c/div\x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e")}a.ContextType=void 0;(function(l){l[l.WEBGL1=1]="WEBGL1";l[l.WEBGL2=2]="WEBGL2"})(a.ContextType||(a.ContextType={}));a.createContext=x;a.createContextOrErrorHTML=function(l,n,f={}){for(l=d(l);1<l.length;){const e=x(n,l.shift(),f);if(c.isSome(e))return e}return g(n,l.shift(),f)};a.getContextTypes=d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/enums":function(){define(["exports"],function(a){a.ClearBufferBit=
void 0;(function(b){b[b.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT";b[b.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT";b[b.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(a.ClearBufferBit||(a.ClearBufferBit={}));a.PrimitiveType=void 0;(function(b){b[b.POINTS=0]="POINTS";b[b.LINES=1]="LINES";b[b.LINE_LOOP=2]="LINE_LOOP";b[b.LINE_STRIP=3]="LINE_STRIP";b[b.TRIANGLES=4]="TRIANGLES";b[b.TRIANGLE_STRIP=5]="TRIANGLE_STRIP";b[b.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(a.PrimitiveType||(a.PrimitiveType={}));a.BlendFactor=
void 0;(function(b){b[b.ZERO=0]="ZERO";b[b.ONE=1]="ONE";b[b.SRC_COLOR=768]="SRC_COLOR";b[b.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR";b[b.SRC_ALPHA=770]="SRC_ALPHA";b[b.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA";b[b.DST_ALPHA=772]="DST_ALPHA";b[b.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA";b[b.DST_COLOR=774]="DST_COLOR";b[b.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR";b[b.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE";b[b.CONSTANT_COLOR=32769]="CONSTANT_COLOR";b[b.ONE_MINUS_CONSTANT_COLOR=
32770]="ONE_MINUS_CONSTANT_COLOR";b[b.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA";b[b.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"})(a.BlendFactor||(a.BlendFactor={}));a.BlendOperation=void 0;(function(b){b[b.ADD=32774]="ADD";b[b.SUBTRACT=32778]="SUBTRACT";b[b.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"})(a.BlendOperation||(a.BlendOperation={}));a.BufferType=void 0;(function(b){b[b.ARRAY_BUFFER=34962]="ARRAY_BUFFER";b[b.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER";b[b.UNIFORM_BUFFER=
35345]="UNIFORM_BUFFER";b[b.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER";b[b.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER";b[b.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER";b[b.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER"})(a.BufferType||(a.BufferType={}));a.Face=void 0;(function(b){b[b.FRONT=1028]="FRONT";b[b.BACK=1029]="BACK";b[b.FRONT_AND_BACK=1032]="FRONT_AND_BACK"})(a.Face||(a.Face={}));a.CullMode=void 0;(function(b){b[b.CW=2304]="CW";b[b.CCW=2305]="CCW"})(a.CullMode||(a.CullMode={}));a.DataType=
void 0;(function(b){b[b.BYTE=5120]="BYTE";b[b.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE";b[b.SHORT=5122]="SHORT";b[b.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT";b[b.INT=5124]="INT";b[b.UNSIGNED_INT=5125]="UNSIGNED_INT";b[b.FLOAT=5126]="FLOAT"})(a.DataType||(a.DataType={}));a.CompareFunction=void 0;(function(b){b[b.NEVER=512]="NEVER";b[b.LESS=513]="LESS";b[b.EQUAL=514]="EQUAL";b[b.LEQUAL=515]="LEQUAL";b[b.GREATER=516]="GREATER";b[b.NOTEQUAL=517]="NOTEQUAL";b[b.GEQUAL=518]="GEQUAL";b[b.ALWAYS=519]="ALWAYS"})(a.CompareFunction||
(a.CompareFunction={}));a.StencilOperation=void 0;(function(b){b[b.ZERO=0]="ZERO";b[b.KEEP=7680]="KEEP";b[b.REPLACE=7681]="REPLACE";b[b.INCR=7682]="INCR";b[b.DECR=7683]="DECR";b[b.INVERT=5386]="INVERT";b[b.INCR_WRAP=34055]="INCR_WRAP";b[b.DECR_WRAP=34056]="DECR_WRAP"})(a.StencilOperation||(a.StencilOperation={}));a.TextureSamplingMode=void 0;(function(b){b[b.NEAREST=9728]="NEAREST";b[b.LINEAR=9729]="LINEAR";b[b.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST";b[b.LINEAR_MIPMAP_NEAREST=9985]=
"LINEAR_MIPMAP_NEAREST";b[b.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR";b[b.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"})(a.TextureSamplingMode||(a.TextureSamplingMode={}));a.TextureWrapMode=void 0;(function(b){b[b.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE";b[b.REPEAT=10497]="REPEAT";b[b.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"})(a.TextureWrapMode||(a.TextureWrapMode={}));a.TextureType=void 0;(function(b){b[b.TEXTURE_2D=3553]="TEXTURE_2D";b[b.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP";b[b.TEXTURE_3D=
32879]="TEXTURE_3D";b[b.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X";b[b.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X";b[b.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y";b[b.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y";b[b.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z";b[b.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z";b[b.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"})(a.TextureType||(a.TextureType=
{}));a.PixelFormat=void 0;(function(b){b[b.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT";b[b.DEPTH_STENCIL=34041]="DEPTH_STENCIL";b[b.ALPHA=6406]="ALPHA";b[b.RGB=6407]="RGB";b[b.RGBA=6408]="RGBA";b[b.LUMINANCE=6409]="LUMINANCE";b[b.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA";b[b.RED=6403]="RED";b[b.RG=33319]="RG";b[b.RED_INTEGER=36244]="RED_INTEGER";b[b.RG_INTEGER=33320]="RG_INTEGER";b[b.RGB_INTEGER=36248]="RGB_INTEGER";b[b.RGBA_INTEGER=36249]="RGBA_INTEGER"})(a.PixelFormat||(a.PixelFormat={}));a.SizedPixelFormat=
void 0;(function(b){b[b.RGBA4=32854]="RGBA4";b[b.R16F=33325]="R16F";b[b.RG16F=33327]="RG16F";b[b.RGB32F=34837]="RGB32F";b[b.RGBA16F=34842]="RGBA16F";b[b.R32F=33326]="R32F";b[b.RG32F=33328]="RG32F";b[b.RGBA32F=34836]="RGBA32F";b[b.R11F_G11F_B10F=35898]="R11F_G11F_B10F";b[b.RGB8=32849]="RGB8";b[b.RGBA8=32856]="RGBA8";b[b.RGB5_A1=32855]="RGB5_A1";b[b.R8=33321]="R8";b[b.RG8=33323]="RG8";b[b.R8I=33329]="R8I";b[b.R8UI=33330]="R8UI";b[b.R16I=33331]="R16I";b[b.R16UI=33332]="R16UI";b[b.R32I=33333]="R32I";
b[b.R32UI=33334]="R32UI";b[b.RG8I=33335]="RG8I";b[b.RG8UI=33336]="RG8UI";b[b.RG16I=33337]="RG16I";b[b.RG16UI=33338]="RG16UI";b[b.RG32I=33339]="RG32I";b[b.RG32UI=33340]="RG32UI";b[b.RGB16F=34843]="RGB16F";b[b.RGB9_E5=35901]="RGB9_E5";b[b.SRGB8=35905]="SRGB8";b[b.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8";b[b.RGB565=36194]="RGB565";b[b.RGBA32UI=36208]="RGBA32UI";b[b.RGB32UI=36209]="RGB32UI";b[b.RGBA16UI=36214]="RGBA16UI";b[b.RGB16UI=36215]="RGB16UI";b[b.RGBA8UI=36220]="RGBA8UI";b[b.RGB8UI=36221]="RGB8UI";b[b.RGBA32I=
36226]="RGBA32I";b[b.RGB32I=36227]="RGB32I";b[b.RGBA16I=36232]="RGBA16I";b[b.RGB16I=36233]="RGB16I";b[b.RGBA8I=36238]="RGBA8I";b[b.RGB8I=36239]="RGB8I";b[b.R8_SNORM=36756]="R8_SNORM";b[b.RG8_SNORM=36757]="RG8_SNORM";b[b.RGB8_SNORM=36758]="RGB8_SNORM";b[b.RGBA8_SNORM=36759]="RGBA8_SNORM";b[b.RGB10_A2=32857]="RGB10_A2";b[b.RGB10_A2UI=36975]="RGB10_A2UI"})(a.SizedPixelFormat||(a.SizedPixelFormat={}));a.PixelType=void 0;(function(b){b[b.FLOAT=5126]="FLOAT";b[b.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE";b[b.UNSIGNED_INT_24_8=
34042]="UNSIGNED_INT_24_8";b[b.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4";b[b.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1";b[b.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5";b[b.BYTE=5120]="BYTE";b[b.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT";b[b.SHORT=5122]="SHORT";b[b.UNSIGNED_INT=5125]="UNSIGNED_INT";b[b.INT=5124]="INT";b[b.HALF_FLOAT=5131]="HALF_FLOAT";b[b.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV";b[b.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV";
b[b.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV";b[b.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"})(a.PixelType||(a.PixelType={}));a.RenderbufferFormat=void 0;(function(b){b[b.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16";b[b.STENCIL_INDEX8=36168]="STENCIL_INDEX8";b[b.DEPTH_STENCIL=34041]="DEPTH_STENCIL";b[b.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24";b[b.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F";b[b.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8";b[b.DEPTH32F_STENCIL8=
36013]="DEPTH32F_STENCIL8"})(a.RenderbufferFormat||(a.RenderbufferFormat={}));a.Usage=void 0;(function(b){b[b.STATIC_DRAW=35044]="STATIC_DRAW";b[b.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW";b[b.STREAM_DRAW=35040]="STREAM_DRAW";b[b.STATIC_READ=35045]="STATIC_READ";b[b.DYNAMIC_READ=35049]="DYNAMIC_READ";b[b.STREAM_READ=35041]="STREAM_READ";b[b.STATIC_COPY=35046]="STATIC_COPY";b[b.DYNAMIC_COPY=35050]="DYNAMIC_COPY";b[b.STREAM_COPY=35042]="STREAM_COPY"})(a.Usage||(a.Usage={}));a.ShaderType=void 0;(function(b){b[b.FRAGMENT_SHADER=
35632]="FRAGMENT_SHADER";b[b.VERTEX_SHADER=35633]="VERTEX_SHADER"})(a.ShaderType||(a.ShaderType={}));a.FramebufferTarget=void 0;(function(b){b[b.FRAMEBUFFER=36160]="FRAMEBUFFER";b[b.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER";b[b.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"})(a.FramebufferTarget||(a.FramebufferTarget={}));a.TargetType=void 0;(function(b){b[b.TEXTURE=0]="TEXTURE";b[b.RENDER_BUFFER=1]="RENDER_BUFFER";b[b.CUBEMAP=2]="CUBEMAP"})(a.TargetType||(a.TargetType={}));a.DepthStencilTargetType=
void 0;(function(b){b[b.NONE=0]="NONE";b[b.DEPTH_RENDER_BUFFER=1]="DEPTH_RENDER_BUFFER";b[b.STENCIL_RENDER_BUFFER=2]="STENCIL_RENDER_BUFFER";b[b.DEPTH_STENCIL_RENDER_BUFFER=3]="DEPTH_STENCIL_RENDER_BUFFER";b[b.DEPTH_STENCIL_TEXTURE=4]="DEPTH_STENCIL_TEXTURE"})(a.DepthStencilTargetType||(a.DepthStencilTargetType={}));a.ResourceType=void 0;(function(b){b[b.Texture=0]="Texture";b[b.Buffer=1]="Buffer";b[b.VAO=2]="VAO";b[b.Shader=3]="Shader";b[b.Program=4]="Program";b[b.Framebuffer=5]="Framebuffer";b[b.Renderbuffer=
6]="Renderbuffer";b[b.Sync=7]="Sync";b[b.COUNT=8]="COUNT"})(a.ResourceType||(a.ResourceType={}));a.ColorAttachment=void 0;(function(b){b[b.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0";b[b.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1";b[b.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2";b[b.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3";b[b.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4";b[b.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5";b[b.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6";b[b.COLOR_ATTACHMENT7=36071]=
"COLOR_ATTACHMENT7";b[b.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8";b[b.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9";b[b.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10";b[b.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11";b[b.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12";b[b.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13";b[b.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14";b[b.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"})(a.ColorAttachment||(a.ColorAttachment={}));a.CompressedTextureFormat=void 0;
(function(b){b[b.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT";b[b.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT";b[b.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT";b[b.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT";b[b.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC";b[b.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC";b[b.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC";b[b.COMPRESSED_SIGNED_RG11_EAC=
37491]="COMPRESSED_SIGNED_RG11_EAC";b[b.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2";b[b.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2";b[b.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2";b[b.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2";b[b.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC";b[b.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(a.CompressedTextureFormat||
(a.CompressedTextureFormat={}));a.UniformType=void 0;(function(b){b[b.FLOAT=5126]="FLOAT";b[b.FLOAT_VEC2=35664]="FLOAT_VEC2";b[b.FLOAT_VEC3=35665]="FLOAT_VEC3";b[b.FLOAT_VEC4=35666]="FLOAT_VEC4";b[b.INT=5124]="INT";b[b.INT_VEC2=35667]="INT_VEC2";b[b.INT_VEC3=35668]="INT_VEC3";b[b.INT_VEC4=35669]="INT_VEC4";b[b.BOOL=35670]="BOOL";b[b.BOOL_VEC2=35671]="BOOL_VEC2";b[b.BOOL_VEC3=35672]="BOOL_VEC3";b[b.BOOL_VEC4=35673]="BOOL_VEC4";b[b.FLOAT_MAT2=35674]="FLOAT_MAT2";b[b.FLOAT_MAT3=35675]="FLOAT_MAT3";b[b.FLOAT_MAT4=
35676]="FLOAT_MAT4";b[b.SAMPLER_2D=35678]="SAMPLER_2D";b[b.SAMPLER_CUBE=35680]="SAMPLER_CUBE";b[b.UNSIGNED_INT=5125]="UNSIGNED_INT";b[b.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2";b[b.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3";b[b.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4";b[b.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3";b[b.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4";b[b.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2";b[b.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4";b[b.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2";b[b.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3";
b[b.SAMPLER_3D=35679]="SAMPLER_3D";b[b.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW";b[b.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY";b[b.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW";b[b.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW";b[b.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D";b[b.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D";b[b.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE";b[b.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY";b[b.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D";b[b.UNSIGNED_INT_SAMPLER_3D=
36307]="UNSIGNED_INT_SAMPLER_3D";b[b.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE";b[b.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"})(a.UniformType||(a.UniformType={}));a.SyncParameter=void 0;(function(b){b[b.OBJECT_TYPE=37138]="OBJECT_TYPE";b[b.SYNC_CONDITION=37139]="SYNC_CONDITION";b[b.SYNC_STATUS=37140]="SYNC_STATUS";b[b.SYNC_FLAGS=37141]="SYNC_FLAGS"})(a.SyncParameter||(a.SyncParameter={}));a.SyncStatus=void 0;(function(b){b[b.UNSIGNALED=37144]="UNSIGNALED";
b[b.SIGNALED=37145]="SIGNALED"})(a.SyncStatus||(a.SyncStatus={}));a.ClientWaitSyncStatus=void 0;(function(b){b[b.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED";b[b.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED";b[b.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED";b[b.WAIT_FAILED=37149]="WAIT_FAILED"})(a.ClientWaitSyncStatus||(a.ClientWaitSyncStatus={}));a.SyncCondition=void 0;(function(b){b[b.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"})(a.SyncCondition||(a.SyncCondition={}));a.SyncFlag=
void 0;(function(b){b[b.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"})(a.SyncFlag||(a.SyncFlag={}));a.BASE_TEXTURE_UNIT=33984;a.DepthStencilAttachment=33306;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/support/layerUtils":function(){define(["exports"],function(a){a.areLabelsVisible=function(b){return!0===b.labelsVisible&&null!=b.labelingInfo&&0<b.labelingInfo.length};a.getLayersForScale=function(b,c){const d=[];if(0<b&&c)for(let g=0;g<c.length;g++)if(!(0<=c[g].parentLayerId&&
-1===d.indexOf(c[g].parentLayerId)&&c.some(function(x){return x.id===c[g].parentLayerId}))&&0<=c[g].id){let x=!0;const w=c[g].maxScale,l=c[g].minScale;if(0<w||0<l)0<w&&0<l?x=w<=b&&b<=l:0<w?x=w<=b:0<l&&(x=b<=l);x&&d.push(c[g].id)}return d};a.getTileMaxtrixSetFromActiveLayer=function(b){if(b.activeLayer){const c=b.activeLayer.tileMatrixSet;if(c)return c;if(b=b.activeLayer.tileMatrixSets)return b}return null};a.isBaseLayer=function(b){return b.parent&&"esri.Basemap"===b.parent.declaredClass&&-1<b.parent.baseLayers.indexOf(b)};
a.isReprojectableTiledLayer=function(b){return b&&"imagery-tile"===b.type};a.isTiledLayer=function(b){return b&&"base-tile"===b.type||"tile"===b.type||"elevation"===b.type||"imagery-tile"===b.type||"base-elevation"===b.type||"open-street-map"===b.type||"wcs"===b.type||"web-tile"===b.type||"wmts"===b.type||"vector-tile"===b.type};a.isVoxelLayer=function(b){return b&&"voxel"===b.type};a.isWMTSLayer=function(b){return b&&"wmts"===b.type};a.serializeLayerDefinitions=function(b){const c=/[:;]/,d=[];let g=
!1;if(b&&(b.forEach(function(x,w){d.push([w,x]);!g&&c.test(x)&&(g=!0)}),0<d.length)){if(g){const x={};d.forEach(w=>{x[w[0]]=w[1]});b=JSON.stringify(x)}else{const x=[];d.forEach(w=>{x.push(w[0]+":"+w[1])});b=x.join(";")}return b}return null};a.serializeTimeOptions=function(b){if(b){var c=[];b.forEach(function(d,g){c.push('"'+g+'":'+JSON.stringify(d))});if(c.length)return"{"+c.join(",")+"}"}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/BreakpointsOwner":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/ArrayPool ../core/Handles ../core/maybe ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k){function r(h,m){return m?y[h].valueToClassName[m].split(" "):[]}const y={widthBreakpoint:{getValue(h){const m=h.viewSize[0];h=h.breakpoints;const u=this.values;return m<=h.xsmall?u.xsmall:m<=h.small?u.small:m<=h.medium?u.medium:m<=h.large?u.large:u.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",
small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",
xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(h){const m=h.viewSize[1];h=h.breakpoints;const u=this.values;return m<=h.xsmall?u.xsmall:m<=h.small?u.small:m<=h.medium?u.medium:m<=h.large?u.large:u.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",
small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",
xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(h){h=h.viewSize;const m=this.values;return h[1]>=h[0]?m.portrait:m.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},p={xsmall:544,small:768,medium:992,large:1200};a.BreakpointsOwner=
h=>{h=function(m){function u(...q){q=m.call(this,...q)||this;q._breakpointsHandles=new g;q.orientation=null;q.widthBreakpoint=null;q.heightBreakpoint=null;q.breakpoints=p;return q}b._inheritsLoose(u,m);var t=u.prototype;t.initialize=function(){this._breakpointsHandles.add(w.watch(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),w.initial))};t.destroy=function(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles=x.destroyMaybe(this._breakpointsHandles))};t._updateClassNames=
function(){if(this.container){var q=d.acquire(),z=d.acquire(),v=!1,B;for(B in y){const A=this[B],E=y[B].getValue({viewSize:this.size,breakpoints:this.breakpoints});A!==E&&(v=!0,this[B]=E,r(B,A).forEach(C=>z.push(C)),r(B,E).forEach(C=>q.push(C)))}v&&(this._applyClassNameChanges(q,z),d.release(q),d.release(z))}};t._applyClassNameChanges=function(q,z){const v=this.container;v&&(z.forEach(B=>v.classList.remove(B)),q.forEach(B=>v.classList.add(B)))};t._removeActiveClassNames=function(){const q=this.container;
if(q)for(var z in y)r(z,this[z]).forEach(v=>q.classList.remove(v))};b._createClass(u,[{key:"breakpoints",set:function(q){var z=this._get("breakpoints");if(q!==z){z=(z=q)&&z.xsmall<z.small&&z.small<z.medium&&z.medium<z.large;if(!z){const v=JSON.stringify(p,null,2);console.warn("provided breakpoints are not valid, using defaults:"+v)}q=z?q:p;this._set("breakpoints",{...q})}}}]);return u}(h);c.__decorate([l.property()],h.prototype,"breakpoints",null);c.__decorate([l.property()],h.prototype,"orientation",
void 0);c.__decorate([l.property()],h.prototype,"widthBreakpoint",void 0);c.__decorate([l.property()],h.prototype,"heightBreakpoint",void 0);return h=c.__decorate([k.subclass("esri.views.BreakpointsOwner")],h)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/DOMContainer":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/domUtils ../core/reactiveUtils ../core/scheduling ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ./overlay/ViewOverlay ../widgets/Popup".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r){function y(h){h&&(d.empty(h),h.parentNode&&h.parentNode.removeChild(h))}const p=[0,0];a.DOMContainer=h=>{h=function(m){function u(...q){var z=m.call(this,...q)||this;z._freqInfo={freq:16,time:750};z._overlayRenderTaskHandle=null;z.height=0;z.position=null;z.resizing=!1;z.root=null;z.surface=null;z.suspended=!0;z.ui=null;z.userContent=null;z.width=0;z.widthBreakpoint=null;z.handles.add([z.watch("cursor",v=>{const B=z.surface;B&&B.setAttribute("data-cursor",v)}),
z.watch("interacting",v=>{const B=z.surface;B&&B.setAttribute("data-interacting",v.toString())})]);return z}b._inheritsLoose(u,m);var t=u.prototype;t.initialize=function(){this.handles.add(this.watch("ui",(q,z)=>this._handleUIChange(q,z)));this._wireUI(this.ui);this.handles.add([this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])};t.destroy=function(){this.destroyed||(this.ui&&(this.ui.destroy(),this.ui=null),this.popup&&!this.popup.destroyed&&this.popup.destroy(),
this.container=null)};t.blur=function(){this.surface&&this.surface.blur()};t.focus=function(){this.surface&&this.surface.focus()};t.pageToContainer=function(q,z,v){const B=this.position;q-=B[0];z-=B[1];v?(v[0]=q,v[1]=z):v=[q,z];return v};t.containerToPage=function(q,z,v){const B=this.position;q+=B[0];z+=B[1];v?(v[0]=q,v[1]=z):v=[q,z];return v};t._handleUIChange=function(q,z){z&&(this.handles.remove("ui"),z.destroy());q&&this._wireUI(q);this._set("ui",q)};t._wireUI=function(q){this.handles.remove("ui");
q&&(q.view=this,this.handles.add([g.watch(()=>this.root,z=>{if(z){{const v=document.createElement("div");z.appendChild(v);z=v}}else z=null;q.container=z},g.initial),g.watch(()=>this.popup,(z,v)=>{v&&q.remove(v,"popup");z&&(z.view=q.view,q.add(z,{key:"popup",position:"manual"}))},g.initial)],"ui"))};t._stopMeasuring=function(){this.handles.remove("measuring");this._get("resizing")&&this._set("resizing",!1)};t._startMeasuring=function(){const q=this._freqInfo;q.freq=16;q.time=750;this.handles.add([(()=>
{const z=()=>{q.freq=16;q.time=750};window.addEventListener("resize",z);return{remove(){window.removeEventListener("resize",z)}}})(),x.addFrameTask({prepare:z=>{const v=this._measure(),B=this._freqInfo;B.time+=z.deltaTime;v&&(B.freq=16,this._get("resizing")||this._set("resizing",!0));B.time<B.freq||(B.time=0,this._position()||v?B.freq=16:B.freq=Math.min(750,2*B.freq),!v&&512<=B.freq&&this._get("resizing")&&this._set("resizing",!1))}})],"measuring");this._measure();this._position()};t._measure=function(){var q=
this.container;const z=q?q.clientWidth:0;q=q?q.clientHeight:0;if(0===z||0===q)return this.suspended||this._set("suspended",!0),!1;const v=this.width,B=this.height;if(z===v&&q===B)return this.suspended&&this._set("suspended",!1),!1;this._set("width",z);this._set("height",q);this.suspended&&this._set("suspended",!1);this.emit("resize",{oldWidth:v,oldHeight:B,width:z,height:q});return!0};t._position=function(){var q=this.container;const z=this.position;{const v=(q.ownerDocument||window.document).defaultView;
q=q.getBoundingClientRect();p[0]=q.left+v.pageXOffset;p[1]=q.top+v.pageYOffset}return z&&p[0]===z[0]&&p[1]===z[1]?!1:(this._set("position",[p[0],p[1]]),!0)};t.forceDOMReadyCycle=function(){};b._createClass(u,[{key:"container",set:function(q){var z=this._get("container");if(z!==q)if(this.handles.remove("dom-size"),this._stopMeasuring(),z&&(z.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay.destroy(),
this._set("overlay",null),y(this.root),this._set("root",null),d.reparent(this.userContent,z),y(this.userContent),this._set("userContent",null)),q){q.classList.add("esri-view");z=document.createElement("div");z.className="esri-view-user-storage";d.reparent(q,z);q.appendChild(z);this._set("userContent",z);z=document.createElement("div");z.className="esri-view-root";q.insertBefore(z,q.firstChild);this._set("root",z);const v=document.createElement("div");v.className="esri-view-surface";v.setAttribute("role",
"application");v.tabIndex=0;z.appendChild(v);this._set("surface",v);const B=new k;z.appendChild(B.surface);this._set("overlay",B);B.watch("needsRender",A=>{A&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=x.addFrameTask({render:()=>{this.overlay.render()}}):this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null)});this.forceDOMReadyCycle();this.handles.add(g.watch(()=>this.size,A=>{const [E,C]=A;E>=document.body.clientWidth||C>=document.body.clientHeight?
v.classList.add("esri-view-surface--inset-outline"):v.classList.remove("esri-view-surface--inset-outline")},g.initial),"dom-size");this._set("container",q);this._startMeasuring()}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),this._set("container",null)}},{key:"focused",get:function(){const q=document.activeElement===this.surface;return document.hasFocus()&&q}},{key:"popup",get:function(){return this._get("popup")||new r({view:this})},
set:function(q){const z=this._get("popup");z&&z!==q&&z.destroy();this._set("popup",q)}},{key:"size",get:function(){return[this.width,this.height]}}]);return u}(h);c.__decorate([w.property({value:null,cast:m=>d.byId(m)})],h.prototype,"container",null);c.__decorate([w.property({readOnly:!0})],h.prototype,"focused",null);c.__decorate([w.property({readOnly:!0})],h.prototype,"height",void 0);c.__decorate([w.property({type:r})],h.prototype,"popup",null);c.__decorate([w.property({type:k})],h.prototype,"overlay",
void 0);c.__decorate([w.property({readOnly:!0})],h.prototype,"position",void 0);c.__decorate([w.property({readOnly:!0})],h.prototype,"resizing",void 0);c.__decorate([w.property({readOnly:!0})],h.prototype,"root",void 0);c.__decorate([w.property({value:null,readOnly:!0})],h.prototype,"size",null);c.__decorate([w.property({readOnly:!0})],h.prototype,"surface",void 0);c.__decorate([w.property({readOnly:!0})],h.prototype,"suspended",void 0);c.__decorate([w.property()],h.prototype,"ui",void 0);c.__decorate([w.property({readOnly:!0})],
h.prototype,"userContent",void 0);c.__decorate([w.property({readOnly:!0})],h.prototype,"width",void 0);c.__decorate([w.property()],h.prototype,"widthBreakpoint",void 0);return h=c.__decorate([e.subclass("esri.views.DOMContainer")],h)};a.isDOMContainer=function(h){return h&&"focus"in h};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/overlay/ViewOverlay":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/Collection ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../libs/maquette/projection ../../libs/maquette/projector ../support/WatchUpdatingTracking".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k){c=function(r){function y(){var h=r.apply(this,arguments)||this;h.items=new d;h._watchUpdatingTracking=new k.WatchUpdatingTracking;h._callbacks=new Map;h._projector=e.createProjector();h._hiddenProjector=e.createProjector();return h}a._inheritsLoose(y,r);var p=y.prototype;p.initialize=function(){const h=document.createElement("div");h.className="esri-overlay-surface";this._set("surface",h);this._hiddenSurface=document.createElement("div");this._hiddenSurface.setAttribute("style",
"visibility: hidden;");h.appendChild(this._hiddenSurface);this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,m=>{for(const u of m.added){const t=()=>u.render();this._callbacks.set(u,t);this._projector.append(this.surface,t)}for(const u of m.removed)m=this._projector.detach(this._callbacks.get(u)),this.surface.removeChild(m.domNode),this._callbacks.delete(u)})};p.addItem=function(h){this.items.add(h)};p.removeItem=function(h){this.items.remove(h)};p.destroy=function(){this.items.removeAll();
this._callbacks.forEach(h=>this._projector.detach(h));this._projector=this._callbacks=null;this._watchUpdatingTracking.destroy()};p.render=function(){this._projector.renderNow()};p.computeBoundingRect=function(h){const m=this._hiddenSurface,u=this._hiddenProjector;let t=null;const q=()=>t=h.render();u.append(m,q);u.renderNow();const z={left:0,top:0,right:0,bottom:0};if(t&&t.domNode){const v=t.domNode.getBoundingClientRect();z.left=v.left;z.top=v.top;z.right=v.right;z.bottom=v.bottom}for(u.detach(q);m.firstChild;)m.removeChild(m.firstChild);
return z};p.overlaps=function(h,m){h=this.computeBoundingRect(h);m=this.computeBoundingRect(m);return Math.max(h.left,m.left)<=Math.min(h.right,m.right)&&Math.max(h.top,m.top)<=Math.min(h.bottom,m.bottom)};p.renderCanvas=function(h){if(this.items.some(u=>u.visible)){var m=h.getContext("2d");m.save();m.font=`10px ${getComputedStyle(this.surface).fontFamily}`;this.items.forEach(u=>{m.save();u.renderCanvas(m);m.restore()});m.restore()}};a._createClass(y,[{key:"needsRender",get:function(){return 0<this.items.length}},
{key:"hasVisibleItems",get:function(){return this.items.some(h=>h.visible)}}]);return y}(c);b.__decorate([g.property({readOnly:!0})],c.prototype,"surface",void 0);b.__decorate([g.property({readOnly:!0})],c.prototype,"items",void 0);b.__decorate([g.property({readOnly:!0})],c.prototype,"needsRender",null);b.__decorate([g.property({readOnly:!0})],c.prototype,"_watchUpdatingTracking",void 0);b.__decorate([g.property({readOnly:!0,aliasOf:"_watchUpdatingTracking.updating"})],c.prototype,"updating",void 0);
return c=b.__decorate([n.subclass("esri.views.overlay.ViewOverlay")],c)})},"esri/widgets/Popup":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../intl ../core/Collection ../core/events ../core/Handles ../core/Logger ../core/maybe ../core/reactiveUtils ../core/throttle ../core/watchUtils ../core/accessorSupport/decorators/aliasOf ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/cast ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Feature ./Spinner ./Widget ./Feature/support/FeatureContentMixin ./Popup/PopupViewModel ./support/Heading ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/decorators/vmEvent ./support/jsxFactory ./support/widgetUtils ../intl/substitute".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E,C,D,F,G){function J(K,M){return void 0===M?`${"esri-popup"}__${K}`:`${"esri-popup"}__${K}-${M}`}const I={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},O=w.getLogger("esri.widgets.Popup"),P={closeButton:!0,featureNavigation:!0};c=function(K){function M(R,L){var N=K.call(this,R,L)||this;N._blurClose=!1;N._blurContainer=!1;N._containerNode=null;N._mainContainerNode=null;N._featureMenuNode=null;N._actionsMenuNode=null;N._focusClose=
!1;N._focusContainer=!1;N._focusDockButton=!1;N._focusFeatureMenuButton=!1;N._focusActionsMenuButton=!1;N._focusFirstFeature=!1;N._focusFirstAction=!1;N._handles=new x;N._pointerOffsetInPx=16;N._spinner=null;N._feature=null;N._featureMenuIntersectionObserverCallback=([T])=>{null!=T&&T.isIntersecting&&N.viewModel.featurePage++};N._featureMenuIntersectionObserver=new IntersectionObserver(N._featureMenuIntersectionObserverCallback,{root:window.document});N._displaySpinnerThrottled=f.throttle(()=>N._displaySpinner(),
0);N.actions=null;N.alignment="auto";N.autoCloseEnabled=null;N.autoOpenEnabled=null;N.defaultPopupTemplateEnabled=null;N.content=null;N.collapsed=!1;N.collapseEnabled=!0;N.dockEnabled=!1;N.featureCount=null;N.featureMenuOpen=!1;N.features=null;N.goToOverride=null;N.headingLevel=2;N.highlightEnabled=null;N.location=null;N.label=void 0;N.maxInlineActions=3;N.messages=null;N.messagesCommon=null;N.promises=null;N.selectedFeature=null;N.selectedFeatureIndex=null;N.spinnerEnabled=!0;N.title=null;N.updateLocationEnabled=
null;N.view=null;N.viewModel=new v;N.visible=null;N.visibleElements={...P};N._addSelectedFeatureIndexHandle();N.own([e.watch(a._assertThisInitialized(N),"viewModel.screenLocation",()=>N._positionContainer()),e.watch(a._assertThisInitialized(N),["viewModel.active","dockEnabled"],()=>N._toggleScreenLocationEnabled()),e.watch(a._assertThisInitialized(N),"viewModel.screenLocation",(T,S)=>{!!T!==!!S&&N.reposition()}),e.watch(a._assertThisInitialized(N),["viewModel.view.padding","viewModel.view.size","viewModel.active",
"viewModel.location","alignment"],()=>N.reposition()),e.watch(a._assertThisInitialized(N),"spinnerEnabled",T=>N._spinnerEnabledChange(T)),e.watch(a._assertThisInitialized(N),"viewModel.view.size",(T,S)=>N._updateDockEnabledForViewSize(T,S)),e.watch(a._assertThisInitialized(N),"viewModel.view",(T,S)=>N._viewChange(T,S)),e.watch(a._assertThisInitialized(N),"viewModel.view.ready",(T,S)=>N._viewReadyChange(T,S)),e.watch(a._assertThisInitialized(N),["viewModel.waitingForResult","viewModel.location"],()=>
{N._hideSpinner();N._displaySpinnerThrottled()}),e.watch(a._assertThisInitialized(N),["selectedFeatureWidget.viewModel.title","selectedFeatureWidget.viewModel.state"],()=>N._setTitleFromFeatureWidget()),e.watch(a._assertThisInitialized(N),["selectedFeatureWidget.viewModel.content","selectedFeatureWidget.viewModel.state"],()=>N._setContentFromFeatureWidget()),e.whenFalse(a._assertThisInitialized(N),"collapsed",()=>{var T,S;"xsmall"===(null==(T=N.viewModel)?void 0:null==(S=T.view)?void 0:S.widthBreakpoint)&&
N.viewModel.active&&N.collapseEnabled&&N.viewModel.centerAtLocation()}),e.on(a._assertThisInitialized(N),"viewModel.allActions","change",()=>N._watchActions()),e.init(a._assertThisInitialized(N),"viewModel.allActions",()=>N._watchActions()),e.watch(a._assertThisInitialized(N),"viewModel.featureViewModels",()=>N._featureMenuViewportScrollTop())]);return N}a._inheritsLoose(M,K);var U=M.prototype;U.destroy=function(){var R,L;this._destroySelectedFeatureWidget();this._destroySpinner();null==(R=this._handles)?
void 0:R.destroy();this._unobserveFeatureMenuObserver();null==(L=this._featureMenuIntersectionObserver)?void 0:L.disconnect();this._handles=null};U.castVisibleElements=function(R){return{...P,...R}};U.blur=function(){const {active:R}=this.viewModel;R||O.warn("Popup can only be blurred when currently active.");this.visibleElements.closeButton?this._blurClose=!0:this._blurContainer=!0;this.scheduleRender()};U.clear=function(){this.viewModel.clear()};U.close=function(){this.visible=!1};U.fetchFeatures=
function(R,L){return this.viewModel.fetchFeatures(R,L)};U.focus=function(){const {active:R}=this.viewModel;R||O.warn("Popup can only be focused when currently active.");this.visibleElements.closeButton?this._focusClose=!0:this._focusContainer=!0;this.scheduleRender()};U.next=function(){return this.viewModel.next()};U.open=function(R){var L,N;this._handles.remove("selected-index");const T={collapsed:R?!!R.collapsed:!1,actionsMenuOpen:R?!!R.actionsMenuOpen:!1,featureMenuOpen:R?!!R.featureMenuOpen:!1};
"xsmall"===(null==(L=this.viewModel)?void 0:null==(N=L.view)?void 0:N.widthBreakpoint)&&(T.collapsed=!0);this.set(T);this.viewModel.open(R);this._shouldFocus(R);this._addSelectedFeatureIndexHandle()};U.previous=function(){return this.viewModel.previous()};U.reposition=function(){this.renderNow();this._positionContainer();this._setCurrentAlignment()};U.triggerAction=function(R){this.viewModel.triggerAction(R)};U.render=function(){var R,L,N,T;const {actionsMenuOpen:S,dockEnabled:H,featureMenuVisible:Q,
dividedActions:W,currentAlignment:V,currentDockPosition:Y}=this,{active:aa}=this.viewModel;var {menuActions:X}=W;X=aa&&1<X.length&&S;const ba=null==(R=this.selectedFeature)?void 0:null==(L=R.layer)?void 0:L.title;R=null==(N=this.selectedFeature)?void 0:null==(T=N.layer)?void 0:T.id;return D.tsx("div",{class:this.classes("esri-popup",{["esri-popup--aligned-top-center"]:"top-center"===V,["esri-popup--aligned-bottom-center"]:"bottom-center"===V,["esri-popup--aligned-top-left"]:"top-left"===V,["esri-popup--aligned-bottom-left"]:"bottom-left"===
V,["esri-popup--aligned-top-right"]:"top-right"===V,["esri-popup--aligned-bottom-right"]:"bottom-right"===V,["esri-popup--is-docked"]:aa&&H,["esri-popup--shadow"]:aa&&!H,["esri-popup--is-docked-top-left"]:"top-left"===Y,["esri-popup--is-docked-top-center"]:"top-center"===Y,["esri-popup--is-docked-top-right"]:"top-right"===Y,["esri-popup--is-docked-bottom-left"]:"bottom-left"===Y,["esri-popup--is-docked-bottom-center"]:"bottom-center"===Y,["esri-popup--is-docked-bottom-right"]:"bottom-right"===Y,["esri-popup--feature-menu-open"]:Q,
["esri-popup--actions-menu-open"]:X}),role:"presentation","data-layer-title":ba,"data-layer-id":R,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},aa?[this.renderMainContainer(),this.renderPointer()]:null)};U.renderLoadingIcon=function(){return D.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon","esri-icon-loading-indicator","esri-rotating")})};U.renderNavigationLoading=function(){const {messagesCommon:R}=this;return this.viewModel.pendingPromisesCount?
D.tsx("div",{key:J("loading-container"),role:"presentation",class:"esri-popup__loading-container","aria-label":R.loading,title:R.loading},this.renderLoadingIcon()):null};U.renderPreviousIcon=function(){const R=F.isRTL(this.container);return D.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon",{["esri-icon-right-triangle-arrow"]:R,["esri-popup__pagination-previous-icon--rtl"]:R,["esri-icon-left-triangle-arrow"]:!R,["esri-popup__pagination-previous-icon"]:!R})})};U.renderPreviousButton=
function(){const {messages:R}=this;return D.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes("esri-popup__button","esri-popup__pagination-previous"),"aria-label":R.previous,title:R.previous},this.renderPreviousIcon())};U.renderNextIcon=function(){const R=F.isRTL(this.container);return D.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon",{["esri-icon-left-triangle-arrow"]:R,["esri-popup__pagination-next-icon--rtl"]:R,
["esri-icon-right-triangle-arrow"]:!R,["esri-popup__pagination-next-icon"]:!R})})};U.renderNextButton=function(){const {messages:R}=this;return D.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes("esri-popup__button","esri-popup__pagination-next"),"aria-label":R.next,title:R.next},this.renderNextIcon())};U.renderFeatureMenuButton=function(){const {featureMenuOpen:R,featureMenuId:L,messagesCommon:N}=this,{featureCount:T,selectedFeatureIndex:S}=
this.viewModel;return D.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes("esri-popup__button","esri-popup__feature-menu-button"),"aria-haspopup":"true","aria-controls":L,"aria-expanded":R.toString(),"aria-label":N.menu,title:N.menu},this._getPageText(T,S))};U.renderNavigationButtons=function(){return this.featureNavigationVisible?
[this.renderPreviousButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton(),this.renderNextButton()]:null};U.renderDockIcon=function(){const {dockEnabled:R}=this,L=this._wouldDockTo();return D.tsx("span",{"aria-hidden":"true",class:this.classes({["esri-icon-minimize"]:R,["esri-popup__icon--dock-icon"]:!R,["esri-icon-dock-right"]:!R&&("top-right"===L||"bottom-right"===L),["esri-icon-dock-left"]:!R&&("top-left"===L||"bottom-left"===L),["esri-icon-maximize"]:!R&&"top-center"===L,["esri-icon-dock-bottom"]:!R&&
"bottom-center"===L},"esri-popup__icon")})};U.renderDockButton=function(){var R,L,N;const {dockEnabled:T,messages:S}=this,H=null==(R=this.viewModel)?void 0:null==(L=R.view)?void 0:L.widthBreakpoint;R=T?S.undock:S.dock;return"xsmall"!==H&&null!=(N=this.dockOptions)&&N.buttonEnabled?D.tsx("div",{role:"button","aria-label":R,title:R,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes("esri-popup__button",
"esri-popup__button--dock")},this.renderDockIcon()):null};U.renderTitle=function(){const {title:R}=this.viewModel,{titleId:L,collapsible:N,contentCollapsed:T,messagesCommon:S}=this;var H={["esri-popup__header-container--button"]:N};const Q=D.tsx(B.Heading,{level:this.headingLevel,class:"esri-popup__header-title",innerHTML:R});H=N?D.tsx("button",{key:`${R}--collapsible`,id:L,title:T?S.expand:S.collapse,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes("esri-popup__header-container",
H),"aria-expanded":T?"false":"true",onclick:this._toggleCollapsed,type:"button"},Q):D.tsx("div",{key:R,id:L,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes("esri-popup__header-container",H)},Q);return R?H:null};U.renderCloseIcon=function(){return D.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon","esri-icon-close")})};U.renderCloseButton=function(){const {visibleElements:R,messagesCommon:L}=this;return R.closeButton?D.tsx("div",{role:"button",
tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:"esri-popup__button","aria-label":L.close,title:L.close,afterCreate:this._closeButtonNodeUpdated,afterUpdate:this._closeButtonNodeUpdated},this.renderCloseIcon()):null};U.renderHeader=function(){return D.tsx("header",{class:"esri-popup__header"},this.renderTitle(),D.tsx("div",{class:"esri-popup__header-buttons"},this.renderDockButton(),this.renderCloseButton()))};U.renderContentContainer=function(){const {contentId:R,hasContent:L,
contentCollapsed:N}=this,{content:T}=this.viewModel;return L&&!N?D.tsx("article",{key:T,enterAnimation:this._createFeatureUpdatedAnimation(),id:R,class:"esri-popup__content"},this.renderContent()):null};U.renderActionsMenuButton=function(){const {actionsMenuId:R,actionsMenuButtonId:L,actionsMenuOpen:N,dividedActions:T,messagesCommon:S}=this,H=N?S.close:S.open,{menuActions:Q}=T;return Q.length?D.tsx("div",{key:J("actions-menu-button"),class:this.classes("esri-popup__button","esri-popup__actions-menu-button"),
role:"button",id:L,"aria-haspopup":"true","aria-controls":N?R:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":H,title:H},D.tsx("span",{"aria-hidden":"true",class:"esri-icon-handle-horizontal"})):null};U.renderMenuActions=function(){const {actionsMenuId:R,actionsMenuButtonId:L,actionsMenuOpen:N,dividedActions:T}=this,{menuActions:S}=T;return S.length&&N?
D.tsx("ul",{id:R,role:"menu","aria-labelledby":L,key:J("actions"),class:"esri-popup__actions",bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},S.toArray().map(H=>this.renderAction({action:H,type:"menu-item"}))):null};U.renderInlineActions=function(){const {inlineActions:R}=this.dividedActions;return!!R.length&&R.toArray().map(L=>this.renderAction({action:L,type:"inline"}))};U.renderInlineActionsContainer=function(){const {inlineActions:R,
menuActions:L}=this.dividedActions,N=!!R.length,T=!!L.length;return N||T?D.tsx("div",{key:"inline-actions-container","data-inline-actions":N.toString(),"data-menu-actions":T.toString(),class:"esri-popup__inline-actions-container"},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null};U.renderNavigation=function(){return this.featureNavigationVisible?D.tsx("section",{key:J("navigation"),class:this.classes("esri-popup__navigation")},this.renderNavigationButtons()):
null};U.renderFooter=function(){const {featureNavigationVisible:R,dividedActions:L}=this,{inlineActions:N,menuActions:T}=L,S=!!N.length,H={["esri-popup__footer--has-pagination"]:R,["esri-popup__footer--has-actions"]:S,["esri-popup__footer--has-actions-menu"]:!!T.length};return R||S?D.tsx("div",{key:J("feature-buttons"),class:this.classes("esri-popup__footer",H)},this.renderInlineActionsContainer(),this.renderNavigation()):null};U.renderFeatureMenuContainer=function(){var {messages:R}=this;const {featureViewModels:L,
isLoadingFeature:N}=this.viewModel;R=G.substitute(R.selectedFeatures,{total:L.length});return D.tsx("section",{key:J("menu"),class:"esri-popup__feature-menu"},D.tsx("strong",{class:"esri-popup__feature-menu-header"},R),D.tsx("nav",{bind:this,class:"esri-popup__feature-menu-viewport","data-node-ref":"_featureMenuViewportNode",afterCreate:F.storeNode},this.renderFeatureMenu(),D.tsx("div",{class:"esri-popup__feature-menu-observer",bind:this,afterCreate:this._featureMenuIntersectionObserverCreated}),
N?D.tsx("div",{class:"esri-popup__feature-menu-loader"},this.renderLoadingIcon()):null))};U.renderPointer=function(){return this.dockEnabled?null:D.tsx("div",{key:J("pointer"),class:"esri-popup__pointer",role:"presentation"},D.tsx("div",{class:this.classes("esri-popup__pointer-direction","esri-popup--shadow")}))};U.renderMainContainer=function(){const {dockEnabled:R,currentAlignment:L,currentDockPosition:N,titleId:T,contentId:S,collapsible:H,hasContent:Q,contentCollapsed:W,visibleElements:V}=this,
{title:Y}=this.viewModel,aa="bottom-left"===L||"bottom-center"===L||"bottom-right"===L||"top-left"===N||"top-center"===N||"top-right"===N,X="top-left"===L||"top-center"===L||"top-right"===L||"bottom-left"===N||"bottom-center"===N||"bottom-right"===N;return D.tsx("div",{class:this.classes("esri-popup__main-container","esri-widget",{["esri-popup--shadow"]:R,["esri-popup--is-collapsible"]:H,["esri-popup--is-collapsed"]:W}),tabIndex:V.closeButton?null:-1,role:"dialog","aria-labelledby":Y?T:"","aria-describedby":Q&&
!W?S:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},aa?this.renderFooter():null,aa?this.renderFeatureMenuContainer():null,this.renderHeader(),this.renderContentContainer(),X?this.renderFooter():null,X?this.renderFeatureMenuContainer():null)};U.renderContent=function(){var R;const L=null==(R=this.viewModel)?void 0:R.content;return L?"string"===typeof L?D.tsx("div",{key:L,innerHTML:L}):this.renderNodeContent(L):null};
U.renderActionText=function(R){return D.tsx("span",{key:"text",class:"esri-popup__action-text"},R)};U.renderActionIcon=function(R){const L=this._getActionClass(R),N=this._getActionImage(R),T={["esri-icon-loading-indicator"]:R.active,["esri-rotating"]:R.active,["esri-popup__icon"]:!!L,["esri-popup__action-image"]:!R.active&&!!N};L&&(T[L]=!R.active);return D.tsx("span",{key:"icon","aria-hidden":"true",class:this.classes("esri-popup__icon",T),styles:this._getIconStyles(N)})};U.renderAction=function(R){const {action:L,
type:N}=R;R=this._getActionTitle(L);const T={["esri-popup__action"]:"toggle"!==L.type,["esri-popup__action-toggle"]:"toggle"===L.type,["esri-popup__action-toggle--on"]:"toggle"===L.type&&L.value,["esri-popup__button--disabled"]:L.disabled},S=[this.renderActionIcon(L),this.renderActionText(R)];R="menu-item"===N?D.tsx("li",{key:L.uid,role:"menuitem",tabIndex:0,title:R,"aria-label":R,class:this.classes("esri-popup__button",T),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":L.uid,
onclick:this._triggerAction,onkeydown:this._triggerAction},S):D.tsx("div",{key:L.uid,role:"button",tabIndex:0,title:R,"aria-label":R,class:this.classes("esri-popup__button",T),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":L.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},S);return L.visible?R:null};U.renderFeatureMenuItem=function(R,L){const {messages:N,messagesCommon:T}=this,{selectedFeatureIndex:S,selectedFeatureViewModel:H}=this.viewModel;var Q=R===H;const W=
{["esri-popup__feature-menu-item--selected"]:Q};Q=Q?D.tsx("span",{key:J(`feature-menu-selected-feature-${S}`),title:N.selectedFeature,"aria-label":N.selectedFeature,class:"esri-icon-check-mark"}):null;R=D.tsx("span",{innerHTML:R.title||T.untitled});return D.tsx("li",{role:"menuitem",tabIndex:-1,key:J(`feature-menu-feature-${S}`),class:this.classes(W,"esri-popup__feature-menu-item"),bind:this,"data-feature-index":L,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature},
D.tsx("span",{class:"esri-popup__feature-menu-title"},R,Q))};U.renderFeatureMenu=function(){const {featureMenuId:R}=this,{featureViewModels:L}=this.viewModel;return 1<L.length?D.tsx("ol",{class:"esri-popup__feature-menu-list",id:R,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},L.filter(N=>!!N.graphic).map((N,T)=>this.renderFeatureMenuItem(N,T))):null};U._getActionTitle=function(R){const {messages:L,selectedFeature:N,
messagesCommon:T}=this,{id:S}=R,H=null==N?void 0:N.attributes;return(R="zoom-to-feature"===S?G.substitute(R.title,{messages:L}):"remove-selected-feature"===S?G.substitute(R.title,{messages:T}):"zoom-to-clustered-features"===S?G.substitute(R.title,{messages:L}):"browse-clustered-features"===S?G.substitute(R.title,{messages:L}):R.title)&&H?G.substitute(R,H):R};U._getActionClass=function(R){var {selectedFeature:L}=this;L=null==L?void 0:L.attributes;const {className:N,image:T}=R;return(R=T||N?N:"esri-icon-default-action")&&
L?G.substitute(R,L):R};U._getActionImage=function(R){var {selectedFeature:L}=this;L=null==L?void 0:L.attributes;({image:R}=R);return R&&L?G.substitute(R,L):R};U._createFeatureUpdatedAnimation=function(){return F.cssTransition("enter","esri-popup--feature-updated")};U._getInlineActionCount=function(){const {maxInlineActions:R,featureNavigationVisible:L}=this;if("number"!==typeof R)return null;const N=Math.round(R);return Math.max(L?N-1:N,0)};U._watchActions=function(){const {allActions:R}=this.viewModel;
this.notifyChange("dividedActions");this._handles.remove("actions");R&&R.forEach(L=>{this._handles.add(e.watch(L,"uid active className disabled id title image visible".split(" "),()=>this.scheduleRender()),"actions")})};U._divideActions=function(){var {allActions:R}=this.viewModel;R=R.filter(S=>S.visible);const L=this._getInlineActionCount(),N=null===L,T=0===L;return{inlineActions:N?R.slice(0):T?new d:R.slice(0,L),menuActions:N?new d:T?R.slice(0):R.slice(L)}};U._featureMenuOpenChanged=function(R){R?
this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0};U._actionsMenuOpenChanged=function(R){R?this._focusFirstAction=!0:this._focusActionsMenuButton=!0};U._setTitleFromFeatureWidget=function(){const {selectedFeatureWidget:R,messagesCommon:L}=this;if(R){var N,T;this.viewModel.title="error"===(null==(N=R.viewModel)?void 0:N.state)?L.errorMessage:(null==(T=R.viewModel)?void 0:T.title)||""}};U._setContentFromFeatureWidget=function(){const {selectedFeatureWidget:R}=this;R&&(this.viewModel.content=
R)};U._unobserveFeatureMenuObserver=function(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)};U._featureMenuIntersectionObserverCreated=function(R){this._unobserveFeatureMenuObserver();this._featureMenuIntersectionObserver.observe(R);this._featureMenuIntersectionObserverNode=R};U._handleFeatureMenuKeyup=function(R){"Escape"===g.eventKey(R)&&(R.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=
!1,this.scheduleRender())};U._handleActionMenuKeyup=function(R){"Escape"===g.eventKey(R)&&(R.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())};U._handleFeatureMenuItemKeyup=function(R){const L=g.eventKey(R);var {_featureMenuNode:N}=this;const T=R.currentTarget["data-feature-index"];if(N){N=N.querySelectorAll("li");var S=N.length;"ArrowUp"===L?(R.stopPropagation(),N[(T-1+S)%S].focus()):"ArrowDown"===L?(R.stopPropagation(),N[(T+1+S)%S].focus()):"Home"===
L?(R.stopPropagation(),N[0].focus()):"End"===L&&(R.stopPropagation(),N[N.length-1].focus())}};U._handleActionMenuItemKeyup=function(R){const L=g.eventKey(R);var {_actionsMenuNode:N}=this;const T=R.currentTarget.dataset.actionUid;var {menuActions:S}=this.dividedActions;S=S.findIndex(Q=>Q.uid===T);if(N){N=N.querySelectorAll("li");var H=N.length;"ArrowUp"===L?(R.stopPropagation(),N[(S-1+H)%H].focus()):"ArrowDown"===L?(R.stopPropagation(),N[(S+1+H)%H].focus()):"Home"===L?(R.stopPropagation(),N[0].focus()):
"End"===L&&(R.stopPropagation(),N[N.length-1].focus())}};U._handleMainKeyup=function(R){const L=g.eventKey(R);"ArrowLeft"===L&&(R.stopPropagation(),this.previous());"ArrowRight"===L&&(R.stopPropagation(),this.next())};U._spinnerEnabledChange=function(R){this._destroySpinner();R&&(R=this.get("viewModel.view"),this._createSpinner(R))};U._hideSpinner=function(){const {_spinner:R}=this;R&&(R.location=null,R.hide())};U._displaySpinner=function(){const {_spinner:R}=this;if(R){var {location:L,waitingForResult:N}=
this.viewModel;N?R.show({location:L}):R.hide()}};U._getIconStyles=function(R){return{"background-image":R?`url(${R})`:""}};U._shouldFocus=function(){var R=a._asyncToGenerator(function*(L){L.shouldFocus&&(yield n.whenOnce(()=>{var N;return!0===(null==(N=this.viewModel)?void 0:N.active)}),this.focus())});return function(L){return R.apply(this,arguments)}}();U._addSelectedFeatureIndexHandle=function(){const R=e.watch(this,"viewModel.selectedFeatureIndex",(L,N)=>this._selectedFeatureIndexUpdated(L,N));
this._handles.add(R,"selected-index")};U._selectedFeatureIndexUpdated=function(R,L){const {featureCount:N}=this;N&&R!==L&&-1!==R&&(this.featureMenuOpen=this.actionsMenuOpen=!1)};U._destroySelectedFeatureWidget=function(){const {_feature:R}=this;R&&(R.viewModel=null,R&&!R.destroyed&&R.destroy());this._feature=null};U._isScreenLocationWithinView=function(R,L){return-1<R.x&&-1<R.y&&R.x<=L.width&&R.y<=L.height};U._isOutsideView=function(R){const {popupHeight:L,popupWidth:N,screenLocation:T,side:S,view:H}=
R;if(isNaN(N)||isNaN(L)||!H||!T)return!1;R=H.padding;return"right"===S&&T.x+N/2>H.width-R.right||"left"===S&&T.x-N/2<R.left||"top"===S&&T.y-L<R.top||"bottom"===S&&T.y+L>H.height-R.bottom?!0:!1};U._calculateAutoAlignment=function(R){if("auto"!==R)return R;const {_pointerOffsetInPx:L,_containerNode:N,_mainContainerNode:T,viewModel:S}=this,{screenLocation:H,view:Q}=S;if(l.isNone(H)||!Q||!N)return"top-center";if(!this._isScreenLocationWithinView(H,Q))return this._get("currentAlignment")||"top-center";
var W=(R=T?window.getComputedStyle(T,null):null)?parseInt(R.getPropertyValue("max-height").replace(/[^-\d\.]/g,""),10):0,V=R?parseInt(R.getPropertyValue("height").replace(/[^-\d\.]/g,""),10):0;const {height:Y,width:aa}=N.getBoundingClientRect();R=aa+L;const X=Math.max(Y,W,V)+L;W=this._isOutsideView({popupHeight:X,popupWidth:R,screenLocation:H,side:"right",view:Q});V=this._isOutsideView({popupHeight:X,popupWidth:R,screenLocation:H,side:"left",view:Q});const ba=this._isOutsideView({popupHeight:X,popupWidth:R,
screenLocation:H,side:"top",view:Q});R=this._isOutsideView({popupHeight:X,popupWidth:R,screenLocation:H,side:"bottom",view:Q});return V?ba?"bottom-right":"top-right":W?ba?"bottom-left":"top-left":ba?R?"top-center":"bottom-center":"top-center"};U._callCurrentAlignment=function(R){return"function"===typeof R?R.call(this):R};U._getCurrentAlignment=function(){const {alignment:R,dockEnabled:L}=this;return L||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(R)))};
U._setCurrentAlignment=function(){this._set("currentAlignment",this._getCurrentAlignment())};U._setCurrentDockPosition=function(){this._set("currentDockPosition",this._getCurrentDockPosition())};U._calculatePositionResult=function(R){const L=["left","right"];F.isRTL(this.container)&&L.reverse();return R.replace(/leading/gi,L[0]).replace(/trailing/gi,L[1])};U._callDockPosition=function(R){return"function"===typeof R?R.call(this):R};U._getDockPosition=function(){var R;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition(null==
(R=this.dockOptions)?void 0:R.position)))};U._getCurrentDockPosition=function(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null};U._wouldDockTo=function(){return this.dockEnabled?null:this._getDockPosition()};U._calculateAutoDockPosition=function(R){var L;if("auto"!==R)return R;R=null==(L=this.viewModel)?void 0:L.view;L=F.isRTL(this.container)?"top-left":"top-right";if(!R)return L;var N=R.padding||{left:0,right:0,top:0,bottom:0};N=R.width-N.left-N.right;({breakpoints:R}=
R);return R&&N<=R.xsmall?"bottom-center":L};U._positionContainer=function(R=this._containerNode){R&&(this._containerNode=R);if(R){var {screenLocation:L}=this.viewModel,{width:N}=R.getBoundingClientRect();if(L=this._calculatePositionStyle(L,N))R.style.top=L.top,R.style.left=L.left,R.style.bottom=L.bottom,R.style.right=L.right}};U._calculateFullWidth=function(R){const {currentAlignment:L,_pointerOffsetInPx:N}=this;return"top-left"===L||"bottom-left"===L||"top-right"===L||"bottom-right"===L?R+N:R};U._calculateAlignmentPosition=
function(R,L,N,T){const {currentAlignment:S,_pointerOffsetInPx:H}=this;T/=2;const Q=N.height-L;N=N.width-R;const {padding:W}=this.view;if("bottom-center"===S)return{top:L+H-W.top,left:R-T-W.left};if("top-left"===S)return{bottom:Q+H-W.bottom,right:N+H-W.right};if("bottom-left"===S)return{top:L+H-W.top,right:N+H-W.right};if("top-right"===S)return{bottom:Q+H-W.bottom,left:R+H-W.left};if("bottom-right"===S)return{top:L+H-W.top,left:R+H-W.left};if("top-center"===S)return{bottom:Q+H-W.bottom,left:R-T-W.left}};
U._calculatePositionStyle=function(R,L){const {dockEnabled:N,view:T}=this;if(T){if(N)return{left:"",top:"",right:"",bottom:""};if(!l.isNone(R)&&L&&(L=this._calculateFullWidth(L),R=this._calculateAlignmentPosition(R.x,R.y,T,L)))return{top:void 0!==R.top?`${R.top}px`:"auto",left:void 0!==R.left?`${R.left}px`:"auto",bottom:void 0!==R.bottom?`${R.bottom}px`:"auto",right:void 0!==R.right?`${R.right}px`:"auto"}}};U._viewChange=function(R,L){R&&L&&(this.close(),this.clear())};U._viewReadyChange=function(R,
L){R?(R=this.get("viewModel.view"),this._wireUpView(R)):L&&(this.close(),this.clear())};U._wireUpView=function(R){this._destroySpinner();if(R){var {spinnerEnabled:L}=this;L&&this._createSpinner(R);this._setDockEnabledForViewSize(this.dockOptions)}};U._dockingThresholdCrossed=function(R,L,N){const [T,S]=R,[H,Q]=L,{width:W,height:V}=N;return T<=W&&H>W||T>W&&H<=W||S<=V&&Q>V||S>V&&Q<=V};U._updateDockEnabledForViewSize=function(R,L){if(R&&L){var N=this.get("viewModel.view.padding")||{left:0,right:0,top:0,
bottom:0},T=N.left+N.right,S=N.top+N.bottom;N=[];var H=[];N[0]=R[0]-T;N[1]=R[1]-S;H[0]=L[0]-T;H[1]=L[1]-S;({dockOptions:R}=this);this._dockingThresholdCrossed(N,H,R.breakpoint)&&this._setDockEnabledForViewSize(R);this._setCurrentDockPosition()}};U._focusDockButtonNode=function(R){this._focusDockButton&&(this._focusDockButton=!1,R.focus())};U._closeButtonNodeUpdated=function(R){this._focusClose?(this._focusClose=!1,R.focus()):this._blurClose&&(this._blurClose=!1,R.blur())};U._mainContainerNodeUpdated=
function(R){this._mainContainerNode=R;this._focusContainer?(this._focusContainer=!1,R.focus()):this._blurContainer&&(this._blurContainer=!1,R.blur())};U._featureMenuNodeUpdated=function(R){(this._featureMenuNode=R)&&this._focusFirstFeature&&(this._focusFirstFeature=!1,R=R.querySelectorAll("li"),R.length&&R[0].focus())};U._actionsMenuNodeUpdated=function(R){(this._actionsMenuNode=R)&&this._focusFirstAction&&(this._focusFirstAction=!1,R=R.querySelectorAll("li"),R.length&&R[0].focus())};U._focusFeatureMenuButtonNode=
function(R){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,R.focus())};U._focusActionsMenuButtonNode=function(R){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,R.focus())};U._featureMenuViewportScrollTop=function(){this._featureMenuViewportNode&&(this._featureMenuViewportNode.scrollTop=0)};U._toggleScreenLocationEnabled=function(){const {dockEnabled:R,viewModel:L}=this;L&&(L.screenLocationEnabled=L.active&&!R)};U._shouldDockAtCurrentViewSize=function(R){var L,N;R=R.breakpoint;
const T=null==(L=this.viewModel)?void 0:null==(N=L.view)?void 0:N.ui;if(!T)return!1;const {width:S,height:H}=T;if(isNaN(S)||isNaN(H))return!1;L=R.hasOwnProperty("width")&&S<=R.width;N=R.hasOwnProperty("height")&&H<=R.height;return L||N};U._setDockEnabledForViewSize=function(R){R.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(R))};U._getPageText=function(R,L){return this.featureNavigationVisible?G.substitute(this.messages.pageText,{index:L+1,total:R}):null};U._destroySpinner=function(){const {_spinner:R,
view:L}=this;R&&(L&&L.ui&&L.ui.remove(this._spinner,"popup-spinner"),R.destroy(),this._spinner=null)};U._createSpinner=function(R){R&&(this._spinner=new t({view:R}),R.ui.add(this._spinner,{key:"popup-spinner",position:"manual"}))};U._toggleCollapsed=function(){this.collapsed=!this.collapsed};U._close=function(){this.close();this.view&&this.view.focus()};U._toggleDockEnabled=function(){this.dockEnabled=!this.dockEnabled;this._focusDockButton=!0;this.scheduleRender()};U._toggleFeatureMenu=function(){const R=
!this.featureMenuOpen;this._featureMenuOpenChanged(R);this.actionsMenuOpen=!1;this.featureMenuOpen=R};U._toggleActionsMenu=function(){const R=!this.actionsMenuOpen;this._actionsMenuOpenChanged(R);this.featureMenuOpen=!1;this.actionsMenuOpen=R};U._triggerAction=function(R){const L=R.currentTarget.dataset.actionUid;var {allActions:N}=this.viewModel;R=N.findIndex(T=>T.uid===L);(N=N.getItemAt(R))&&"toggle"===N.type&&(N.value=!N.value);this.actionsMenuOpen=!1;this.viewModel.triggerAction(R)};U._selectFeature=
function(R){R=R.currentTarget["data-feature-index"];isNaN(R)||(this.viewModel.selectedFeatureIndex=R);this.featureMenuOpen=!1;this._focusFeatureMenuButton=!0;this.scheduleRender()};U._next=function(){this.next()};U._previous=function(){this.previous()};a._createClass(M,[{key:"actionsMenuId",get:function(){return`${this.id}-actions-menu`}},{key:"actionsMenuButtonId",get:function(){return`${this.id}-actions-menu-button`}},{key:"featureMenuId",get:function(){return`${this.id}-feature-menu`}},{key:"titleId",
get:function(){return`${this.id}-popup-title`}},{key:"contentId",get:function(){return`${this.id}-popup-content`}},{key:"hasContent",get:function(){var R,L,N,T,S,H,Q;return!!(this.selectedFeatureWidget?(null==(R=this.selectedFeatureWidget)?0:null==(L=R.viewModel)?0:L.waitingForContent)||"error"===(null==(N=this.selectedFeatureWidget)?void 0:null==(T=N.viewModel)?void 0:T.state)||(null==(S=this.selectedFeatureWidget)?0:null==(H=S.viewModel)?0:H.content):null==(Q=this.viewModel)?0:Q.content)}},{key:"featureNavigationVisible",
get:function(){return this.viewModel.active&&1<this.viewModel.featureCount&&this.visibleElements.featureNavigation}},{key:"collapsible",get:function(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}},{key:"featureMenuVisible",get:function(){return this.featureNavigationVisible&&this.featureMenuOpen}},{key:"contentCollapsed",get:function(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}},{key:"dividedActions",get:function(){return this._divideActions()}},{key:"actionsMenuOpen",
get:function(){return this.viewModel.active?this._get("actionsMenuOpen"):!1},set:function(R){this._set("actionsMenuOpen",!!R)}},{key:"currentAlignment",get:function(){return this._getCurrentAlignment()}},{key:"currentDockPosition",get:function(){return this._getCurrentDockPosition()}},{key:"dockOptions",get:function(){return this._get("dockOptions")||I},set:function(R){var L={...I};const N=this.get("viewModel.view.breakpoints");var T={};N&&(T.width=N.xsmall,T.height=N.xsmall);R={...L,...R};L={...L.breakpoint,
...T};({breakpoint:T}=R);!0===T?R.breakpoint=L:"object"===typeof T&&(R.breakpoint={...L,...T});this._set("dockOptions",R);this._setCurrentDockPosition();this.reposition()}},{key:"selectedFeatureWidget",get:function(){const {_feature:R,visibleElements:L,headingLevel:N}=this,{selectedFeatureViewModel:T}=this.viewModel,S={...L,title:!1};if(!T)return null;R?(R.viewModel=T,R.visibleElements=S):this._feature=new u({headingLevel:N+1,viewModel:T,visibleElements:S});return this._feature}}]);return M}(z.FeatureContentMixin(q));
b.__decorate([h.property({readOnly:!0})],c.prototype,"actionsMenuId",null);b.__decorate([h.property({readOnly:!0})],c.prototype,"actionsMenuButtonId",null);b.__decorate([h.property({readOnly:!0})],c.prototype,"featureMenuId",null);b.__decorate([h.property({readOnly:!0})],c.prototype,"titleId",null);b.__decorate([h.property({readOnly:!0})],c.prototype,"contentId",null);b.__decorate([h.property({readOnly:!0})],c.prototype,"hasContent",null);b.__decorate([h.property({readOnly:!0})],c.prototype,"featureNavigationVisible",
null);b.__decorate([h.property({readOnly:!0})],c.prototype,"collapsible",null);b.__decorate([h.property({readOnly:!0})],c.prototype,"featureMenuVisible",null);b.__decorate([h.property({readOnly:!0})],c.prototype,"contentCollapsed",null);b.__decorate([h.property({readOnly:!0})],c.prototype,"dividedActions",null);b.__decorate([k.aliasOf("viewModel.actions")],c.prototype,"actions",void 0);b.__decorate([h.property()],c.prototype,"actionsMenuOpen",null);b.__decorate([h.property()],c.prototype,"alignment",
void 0);b.__decorate([k.aliasOf("viewModel.autoCloseEnabled")],c.prototype,"autoCloseEnabled",void 0);b.__decorate([k.aliasOf("viewModel.autoOpenEnabled")],c.prototype,"autoOpenEnabled",void 0);b.__decorate([k.aliasOf("viewModel.defaultPopupTemplateEnabled")],c.prototype,"defaultPopupTemplateEnabled",void 0);b.__decorate([k.aliasOf("viewModel.content")],c.prototype,"content",void 0);b.__decorate([h.property()],c.prototype,"collapsed",void 0);b.__decorate([h.property()],c.prototype,"collapseEnabled",
void 0);b.__decorate([h.property({readOnly:!0})],c.prototype,"currentAlignment",null);b.__decorate([h.property({readOnly:!0})],c.prototype,"currentDockPosition",null);b.__decorate([h.property()],c.prototype,"dockOptions",null);b.__decorate([h.property()],c.prototype,"dockEnabled",void 0);b.__decorate([k.aliasOf("viewModel.featureCount")],c.prototype,"featureCount",void 0);b.__decorate([h.property()],c.prototype,"featureMenuOpen",void 0);b.__decorate([k.aliasOf("viewModel.features")],c.prototype,"features",
void 0);b.__decorate([k.aliasOf("viewModel.goToOverride")],c.prototype,"goToOverride",void 0);b.__decorate([h.property()],c.prototype,"headingLevel",void 0);b.__decorate([k.aliasOf("viewModel.highlightEnabled")],c.prototype,"highlightEnabled",void 0);b.__decorate([k.aliasOf("viewModel.location")],c.prototype,"location",void 0);b.__decorate([h.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],c.prototype,"label",void 0);b.__decorate([h.property()],c.prototype,"maxInlineActions",void 0);
b.__decorate([h.property(),E.messageBundle("esri/widgets/Popup/t9n/Popup")],c.prototype,"messages",void 0);b.__decorate([h.property(),E.messageBundle("esri/t9n/common")],c.prototype,"messagesCommon",void 0);b.__decorate([k.aliasOf("viewModel.promises")],c.prototype,"promises",void 0);b.__decorate([k.aliasOf("viewModel.selectedFeature")],c.prototype,"selectedFeature",void 0);b.__decorate([k.aliasOf("viewModel.selectedFeatureIndex")],c.prototype,"selectedFeatureIndex",void 0);b.__decorate([h.property({readOnly:!0})],
c.prototype,"selectedFeatureWidget",null);b.__decorate([h.property()],c.prototype,"spinnerEnabled",void 0);b.__decorate([k.aliasOf("viewModel.title")],c.prototype,"title",void 0);b.__decorate([k.aliasOf("viewModel.updateLocationEnabled")],c.prototype,"updateLocationEnabled",void 0);b.__decorate([k.aliasOf("viewModel.view")],c.prototype,"view",void 0);b.__decorate([h.property({type:v}),C.vmEvent(["triggerAction","trigger-action"])],c.prototype,"viewModel",void 0);b.__decorate([k.aliasOf("viewModel.visible")],
c.prototype,"visible",void 0);b.__decorate([h.property()],c.prototype,"visibleElements",void 0);b.__decorate([p.cast("visibleElements")],c.prototype,"castVisibleElements",null);b.__decorate([A.accessibleHandler()],c.prototype,"_close",null);b.__decorate([A.accessibleHandler()],c.prototype,"_toggleDockEnabled",null);b.__decorate([A.accessibleHandler()],c.prototype,"_toggleFeatureMenu",null);b.__decorate([A.accessibleHandler()],c.prototype,"_toggleActionsMenu",null);b.__decorate([A.accessibleHandler()],
c.prototype,"_triggerAction",null);b.__decorate([A.accessibleHandler()],c.prototype,"_selectFeature",null);b.__decorate([A.accessibleHandler()],c.prototype,"_next",null);b.__decorate([A.accessibleHandler()],c.prototype,"_previous",null);return c=b.__decorate([m.subclass("esri.widgets.Popup")],c)})},"esri/core/throttle":function(){define(["exports"],function(a){a.throttle=function(b,c,d,g){let x=null,w=1E3;"number"===typeof c?(w=c,g=d):(x=null!=c?c:null,w=d);let l=0,n;const f=()=>{l=0;b.apply(g,n)};
c=(...e)=>{x&&x.apply(g,e);n=e;w?l||(l=setTimeout(f,w)):f()};c.remove=()=>{l&&(clearTimeout(l),l=0)};c.forceUpdate=()=>{l&&(clearTimeout(l),f())};c.hasPendingUpdates=()=>!!l;return c};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/widgets/Feature":function(){define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../intl ../core/watchUtils ../core/accessorSupport/decorators/aliasOf ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/cast ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Widget ./Feature/FeatureAttachments ./Feature/FeatureContent ./Feature/FeatureExpression ./Feature/FeatureFields ./Feature/FeatureMedia ./Feature/FeatureViewModel ./Feature/support/FeatureContentMixin ./support/Heading ./support/widgetUtils ./support/decorators/messageBundle ../core/Logger ./support/jsxFactory ../intl/substitute".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E){const C={title:!0,content:!0,lastEditedInfo:!0};d=function(D){function F(J,I){J=D.call(this,J,I)||this;J._contentWidgets=[];J.graphic=null;J.defaultPopupTemplateEnabled=!1;J.headingLevel=2;J.label=void 0;J.messages=null;J.messagesCommon=null;J.messagesURIUtils=null;J.spatialReference=null;J.title=null;J.visibleElements={...C};J.map=null;J.view=null;J.viewModel=new u;return J}b._inheritsLoose(F,D);var G=F.prototype;G.initialize=function(){this.own(g.init(this,
"viewModel.contentViewModels",()=>this._setupContentWidgets()))};G.loadDependencies=function(){return new Promise((J,I)=>a(["../chunks/calcite-notice"],J,I))};G.destroy=function(){this._destroyContentWidgets()};G.castVisibleElements=function(J){return{...C,...J}};G.render=function(){var {state:J}=this.viewModel;J=A.tsx("div",{class:"esri-feature__size-container",key:"container"},this.renderTitle(),"error"===J?this.renderError():"loading"===J?this.renderLoading():this.renderContentContainer());return A.tsx("div",
{class:this.classes("esri-feature","esri-widget")},J)};G.setActiveMedia=function(J,I){this.viewModel.setActiveMedia(J,I)};G.nextMedia=function(J){this.viewModel.nextMedia(J)};G.previousMedia=function(J){this.viewModel.previousMedia(J)};G.renderError=function(){const {messagesCommon:J,messages:I,visibleElements:O}=this;return A.tsx("calcite-notice",{active:!0,color:"red",icon:"exclamation-mark-circle",scale:"s"},O.title?A.tsx("div",{key:"error-title",slot:"title"},J.errorMessage):null,A.tsx("div",
{key:"error-message",slot:"message"},I.loadingError))};G.renderLoading=function(){return A.tsx("div",{key:"loading-container",class:"esri-feature__loading-container"},A.tsx("span",{class:this.classes("esri-icon-loading-indicator esri-rotating","esri-feature__loading-spinner")}))};G.renderContentContainer=function(){const {visibleElements:J}=this;return J.content?A.tsx("div",{class:"esri-feature__main-container"},[this.renderContent(),this.renderLastEditInfo()]):null};G.renderTitle=function(){const {visibleElements:J,
title:I}=this;return J.title?A.tsx(q.Heading,{level:this.headingLevel,class:"esri-feature__title",innerHTML:I}):null};G.renderContent=function(){var J=this.viewModel.content;return J?Array.isArray(J)?J.length?A.tsx("div",{key:"content-content-elements"},J.map(this.renderContentElement,this)):null:"string"===typeof J?(J=this._contentWidgets[0],!J||J.destroyed?null:A.tsx("div",{key:"content-content"},J.render())):this.renderNodeContent(J):null};G.renderContentElement=function(J,I){const {visibleElements:O}=
this;if("boolean"!==typeof O.content&&!O.content[J.type])return null;switch(J.type){case "attachments":return this.renderAttachments(I);case "custom":return this.renderCustom(J,I);case "fields":return this.renderFields(I);case "media":return this.renderMedia(I);case "text":return this.renderText(J,I);case "expression":return this.renderExpression(I);default:return null}};G.renderAttachments=function(J){const I=this._contentWidgets[J];if(!I||I.destroyed)return null;const {state:O,attachmentInfos:P}=
I.viewModel;return"loading"===O||0<P.length?A.tsx("div",{key:this._buildKey("attachments-element",J),class:this.classes("esri-feature__content-element")},I.render()):null};G.renderExpression=function(J){const I=this._contentWidgets[J];return!I||I.destroyed?null:A.tsx("div",{key:this._buildKey("expression-element",J),class:"esri-feature__content-element"},I.render())};G.renderCustom=function(J,I){({creator:J}=J);const O=this._contentWidgets[I];return!O||O.destroyed?null:J?A.tsx("div",{key:this._buildKey("custom-element",
I),class:"esri-feature__content-element"},O.render()):null};G.renderFields=function(J){const I=this._contentWidgets[J];return!I||I.destroyed?null:A.tsx("div",{key:this._buildKey("fields-element",J),class:"esri-feature__content-element"},I.render())};G.renderMedia=function(J){const I=this._contentWidgets[J];return!I||I.destroyed?null:A.tsx("div",{key:this._buildKey("media-element",J),class:"esri-feature__content-element"},I.render())};G.renderLastEditInfo=function(){const {visibleElements:J,messages:I}=
this;var {lastEditInfo:O}=this.viewModel;if(!O||!J.lastEditedInfo)return null;const {date:P,user:K}=O;O=E.substitute("edit"===O.type?K?I.lastEditedByUser:I.lastEdited:K?I.lastCreatedByUser:I.lastCreated,{date:P,user:K});return A.tsx("div",{key:"edit-info-element",class:this.classes("esri-feature__last-edited-info","esri-feature__content-element")},O)};G.renderText=function(J,I){const O=this._contentWidgets[I];return!O||O.destroyed?null:J.text?A.tsx("div",{key:this._buildKey("text-element",I),class:this.classes("esri-feature__content-element",
"esri-feature__text")},O.render()):null};G._buildKey=function(J,...I){const O=this.get("viewModel.graphic.uid")||"0";I=I.join("-");return`${J}__${O}-${I}`};G._destroyContentWidget=function(J){J&&(J.viewModel=null,!J.destroyed&&J.destroy())};G._destroyContentWidgets=function(){this._contentWidgets.forEach(J=>this._destroyContentWidget(J));this._contentWidgets=[]};G._setupContentWidgets=function(){this._destroyContentWidgets();const {headingLevel:J,visibleElements:I}=this;var O=this.get("viewModel.content");
const {contentViewModels:P}=this.viewModel;Array.isArray(O)?O.forEach((K,M)=>{"attachments"===K.type&&(this._contentWidgets[M]=new r({displayType:K.displayType,headingLevel:I.title?J+1:J,viewModel:P[M]}));"fields"===K.type&&(this._contentWidgets[M]=new h({viewModel:P[M]}));"media"===K.type&&(this._contentWidgets[M]=new m({viewModel:P[M]}));"text"===K.type&&(this._contentWidgets[M]=new y({viewModel:P[M]}));"custom"===K.type&&(this._contentWidgets[M]=new y({viewModel:P[M]}));"expression"===K.type&&
(this._contentWidgets[M]=new p({viewModel:P[M]}))},this):(O=P[0])&&!O.destroyed&&(this._contentWidgets[0]=new y({viewModel:O}));this.scheduleRender()};return F}(t.FeatureContentMixin(k));c.__decorate([x.aliasOf("viewModel.graphic")],d.prototype,"graphic",void 0);c.__decorate([x.aliasOf("viewModel.defaultPopupTemplateEnabled")],d.prototype,"defaultPopupTemplateEnabled",void 0);c.__decorate([f.property()],d.prototype,"headingLevel",void 0);c.__decorate([f.property({aliasOf:{source:"messages.widgetLabel",
overridable:!0}})],d.prototype,"label",void 0);c.__decorate([f.property(),v.messageBundle("esri/widgets/Feature/t9n/Feature")],d.prototype,"messages",void 0);c.__decorate([f.property(),v.messageBundle("esri/t9n/common")],d.prototype,"messagesCommon",void 0);c.__decorate([f.property(),v.messageBundle("esri/widgets/support/t9n/uriUtils")],d.prototype,"messagesURIUtils",void 0);c.__decorate([x.aliasOf("viewModel.spatialReference")],d.prototype,"spatialReference",void 0);c.__decorate([x.aliasOf("viewModel.title")],
d.prototype,"title",void 0);c.__decorate([f.property()],d.prototype,"visibleElements",void 0);c.__decorate([n.cast("visibleElements")],d.prototype,"castVisibleElements",null);c.__decorate([x.aliasOf("viewModel.map")],d.prototype,"map",void 0);c.__decorate([x.aliasOf("viewModel.view")],d.prototype,"view",void 0);c.__decorate([f.property({type:u})],d.prototype,"viewModel",void 0);return d=c.__decorate([e.subclass("esri.widgets.Feature")],d)})},"esri/widgets/Feature/FeatureAttachments":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/watchUtils ../../core/accessorSupport/decorators/aliasOf ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/subclass ../Attachments ../Widget ./FeatureAttachments/FeatureAttachmentsViewModel ./support/FeatureElementInfo ../support/widgetUtils ../../core/Logger ../support/jsxFactory".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h){g=function(m){function u(q,z){q=m.call(this,q,z)||this;q._featureElementInfo=null;q.attachmentsWidget=new f;q.description=null;q.displayType=null;q.graphic=null;q.headingLevel=2;q.title=null;q.viewModel=new k;return q}a._inheritsLoose(u,m);var t=u.prototype;t.initialize=function(){this._featureElementInfo=new r;c.init(this,["viewModel.description","viewModel.title","headingLevel"],()=>this._setupFeatureElementInfo());c.init(this,"viewModel.graphic",q=>this.attachmentsWidget.graphic=
q)};t.destroy=function(){this.attachmentsWidget.destroy();this._featureElementInfo.destroy()};t.render=function(){var q;const {attachmentsWidget:z}=this;return h.tsx("div",{class:"esri-feature-attachments"},null==(q=this._featureElementInfo)?void 0:q.render(),null==z?void 0:z.render())};t._setupFeatureElementInfo=function(){const {description:q,title:z,headingLevel:v}=this;this._featureElementInfo.set({description:q,title:z,headingLevel:v})};return u}(e);b.__decorate([l.property({readOnly:!0})],g.prototype,
"attachmentsWidget",void 0);b.__decorate([d.aliasOf("viewModel.description")],g.prototype,"description",void 0);b.__decorate([d.aliasOf("attachmentsWidget.displayType")],g.prototype,"displayType",void 0);b.__decorate([d.aliasOf("viewModel.graphic")],g.prototype,"graphic",void 0);b.__decorate([l.property()],g.prototype,"headingLevel",void 0);b.__decorate([d.aliasOf("viewModel.title")],g.prototype,"title",void 0);b.__decorate([l.property({type:k})],g.prototype,"viewModel",void 0);return g=b.__decorate([n.subclass("esri.widgets.Feature.FeatureAttachments")],
g)})},"esri/widgets/Attachments":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/Error ../core/unitFormatUtils ../core/watchUtils ../core/accessorSupport/decorators/aliasOf ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/cast ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Widget ./Attachments/AttachmentsViewModel ./Attachments/support/attachmentUtils ./support/widgetUtils ./support/decorators/messageBundle ../core/Logger ./support/jsxFactory".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u){const t={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},q=window.CSS;w=function(z){function v(A,E){A=z.call(this,A,E)||this;A.abilities=null;A.displayType="auto";A.graphic=null;A.label=void 0;A.messages=null;A.messagesUnits=null;A.selectedFile=null;A.submitting=!1;A.viewModel=new r;A.visibleElements={...t};A._supportsImageOrientation=q&&q.supports&&q.supports("image-orientation",
"from-image");A._addAttachmentForm=null;A._updateAttachmentForm=null;return A}a._inheritsLoose(v,z);var B=v.prototype;B.initialize=function(){this.own(g.on(this,"viewModel.attachmentInfos","change",()=>this.scheduleRender()),g.init(this,"viewModel.mode",()=>this._modeChanged()))};B.castVisibleElements=function(A){return{...t,...A}};B.addAttachment=function(){const {_addAttachmentForm:A,viewModel:E}=this;this._set("submitting",!0);this._set("error",null);return E.addAttachment(A).then(C=>{this._set("submitting",
!1);this._set("error",null);E.mode="view";return C}).catch(C=>{this._set("submitting",!1);this._set("error",new c("attachments:add-attachment",this.messages.addErrorMessage,C));throw C;})};B.deleteAttachment=function(A){const {viewModel:E}=this;this._set("submitting",!0);this._set("error",null);return E.deleteAttachment(A).then(C=>{this._set("submitting",!1);this._set("error",null);E.mode="view";return C}).catch(C=>{this._set("submitting",!1);this._set("error",new c("attachments:delete-attachment",
this.messages.deleteErrorMessage,C));throw C;})};B.updateAttachment=function(){const {viewModel:A}=this,{_updateAttachmentForm:E}=this;this._set("submitting",!0);this._set("error",null);return A.updateAttachment(E).then(C=>{this._set("submitting",!1);this._set("error",null);A.mode="view";return C}).catch(C=>{this._set("submitting",!1);this._set("error",new c("attachments:update-attachment",this.messages.updateErrorMessage,C));throw C;})};B.render=function(){const {submitting:A,viewModel:E}=this,{state:C}=
E;return u.tsx("div",{class:this.classes("esri-attachments","esri-widget")},A?this.renderProgressBar():null,"loading"===C?this.renderLoading():this.renderAttachments(),this.renderErrorMessage())};B.renderErrorMessage=function(){const {error:A,visibleElements:E}=this;return A&&E.errorMessage?u.tsx("div",{key:"error-message",class:"esri-attachments__error-message"},A.message):null};B.renderAttachments=function(){const {mode:A,activeAttachmentInfo:E}=this.viewModel;return"add"===A?this.renderAddForm():
"edit"===A?this.renderDetailsForm(E):this.renderAttachmentContainer()};B.renderLoading=function(){return u.tsx("div",{class:"esri-attachments__loader-container",key:"loader"},u.tsx("div",{class:"esri-attachments__loader"}))};B.renderProgressBar=function(){return this.visibleElements.progressBar?u.tsx("div",{class:"esri-attachments__progress-bar",key:"progress-bar"}):null};B.renderAddForm=function(){const {submitting:A,selectedFile:E}=this;var C=A||!E,D=this.visibleElements.cancelAddButton?u.tsx("button",
{type:"button",bind:this,disabled:A,onclick:this._cancelForm,class:this.classes("esri-button","esri-button--tertiary","esri-button--small","esri-button--half",A&&"esri-button--disabled")},this.messages.cancel):null;C=this.visibleElements.addSubmitButton?u.tsx("button",{type:"submit",disabled:C,class:this.classes("esri-button","esri-button--secondary","esri-button--small","esri-button--half",{["esri-button--disabled"]:C})},this.messages.add):null;const F=E?u.tsx("span",{key:"file-name",class:"esri-attachments__file-name"},
E.name):null;D=u.tsx("form",{bind:this,afterCreate:p.storeNode,afterRemoved:p.discardNode,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},u.tsx("fieldset",{class:"esri-attachments__file-fieldset"},F,u.tsx("label",{class:this.classes("esri-attachments__file-label","esri-button","esri-button--secondary")},E?this.messages.changeFile:this.messages.selectFile,u.tsx("input",{class:"esri-attachments__file-input",type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))),
C,D);return u.tsx("div",{key:"add-form-container",class:"esri-attachments__form-node"},D)};B.renderDetailsForm=function(A){const {visibleElements:E,viewModel:C,selectedFile:D,submitting:F}=this,{contentType:G,size:J,url:I}=A;var {abilities:O}=C,P=F||!D,K=O.editing&&O.operations.delete&&E.deleteButton?u.tsx("button",{key:"delete-button",type:"button",disabled:F,bind:this,onclick:L=>this._submitDeleteAttachment(L,A),class:this.classes("esri-button","esri-button--small","esri-button--tertiary","esri-attachments__delete-button",
{["esri-button--disabled"]:F})},this.messages.delete):null;P=O.editing&&O.operations.update&&E.updateButton?u.tsx("button",{disabled:P,key:"update-button",type:"submit",class:this.classes("esri-button","esri-button--small","esri-button--third",{["esri-button--disabled"]:P})},this.messages.update):null;const M=this.visibleElements.cancelUpdateButton?u.tsx("button",{disabled:F,key:"cancel-button",type:"button",bind:this,onclick:this._cancelForm,class:this.classes("esri-button","esri-button--small",
"esri-button--tertiary","esri-button--third",{["esri-button--disabled"]:F})},this.messages.cancel):null;var U=D?u.tsx("span",{key:"file-name",class:"esri-attachments__file-name"},D.name):null;O=O.editing&&O.operations.update?u.tsx("fieldset",{key:"file",class:"esri-attachments__file-fieldset"},U,u.tsx("label",{class:this.classes("esri-attachments__file-label","esri-button","esri-button--secondary")},this.messages.changeFile,u.tsx("input",{class:"esri-attachments__file-input",type:"file",name:"attachment",
bind:this,onchange:this._handleFileInputChange}))):null;U=u.tsx("fieldset",{key:"size",class:"esri-attachments__metadata-fieldset"},u.tsx("label",null,d.formatFileSize(this.messagesUnits,J)));const R=u.tsx("fieldset",{key:"content-type",class:"esri-attachments__metadata-fieldset"},u.tsx("label",null,G));K=u.tsx("form",{bind:this,afterCreate:p.storeNode,afterRemoved:p.discardNode,"data-node-ref":"_updateAttachmentForm",onsubmit:this._submitUpdateAttachment},u.tsx("div",{class:"esri-attachments__metadata"},
U,R),O,u.tsx("div",{class:"esri-attachments__actions"},K,M,P));return u.tsx("div",{key:"edit-form-container",class:"esri-attachments__form-node"},u.tsx("a",{class:"esri-attachments__item-link",href:I,rel:"noreferrer",target:"_blank"},this.renderImageMask({attachmentInfo:A,size:400}),u.tsx("div",{class:"esri-attachments__item-link-overlay"},u.tsx("span",{class:"esri-attachments__item-link-overlay-icon"},u.tsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32"},u.tsx("path",
{d:"M28 13h1v16H3V3h16v1H4v24h24zm-5-9h4.293L15.646 15.638l.707.707L28 4.707V9h1V3h-6z"}),u.tsx("path",{fill:"none",d:"M0 0h32v32H0z"}))))),K)};B.renderImageMask=function({attachmentInfo:A,size:E}){var {supportsResizeAttachments:C}=this.viewModel;const {contentType:D,name:F,url:G}=A,J=C&&y.isSupportedImage(D);A=(A=this._getCSSTransform(A,J))?{transform:A,"image-orientation":"none"}:{};const I=-1===G.indexOf("?")?"?":"\x26";E=J?`${G}${I}w=${E}`:y.getIconPath(D);C={["esri-attachments__image--resizable"]:C};
return u.tsx("div",{class:this.classes({["esri-attachments__item-mask--icon"]:!J},"esri-attachments__item-mask")},u.tsx("img",{styles:A,alt:F,src:E,class:this.classes(C,"esri-attachments__image")}))};B.renderAttachmentInfo=function({attachmentInfo:A,displayType:E}){var {viewModel:C}=this;({abilities:C}=C);const {name:D,url:F}=A;E=this.renderImageMask({attachmentInfo:A,size:"list"===E?48:400});var G=C.editing?u.tsx("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-chevron-icon",
p.isRTL(this.container)?"esri-icon-left":"esri-icon-right")}):null;G=u.tsx("label",{class:"esri-attachments__label"},u.tsx("span",{class:"esri-attachments__filename"},D||this.messages.noTitle),G);E=[E,G];C=C.editing?u.tsx("button",{key:"details-button",bind:this,class:"esri-attachments__item-button",title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,"data-attachment-info-id":A.id,onclick:()=>this._startEditAttachment(A),type:"button"},E):u.tsx("a",{key:"details-link",
class:"esri-attachments__item-button",href:F,target:"_blank"},E);return u.tsx("li",{class:"esri-attachments__item",key:A},C)};B.renderAttachmentContainer=function(){const {effectiveDisplayType:A,viewModel:E,visibleElements:C}=this,{attachmentInfos:D,abilities:F}=E;var G=D&&D.length;const J={["esri-attachments__container--list"]:"preview"!==A,["esri-attachments__container--preview"]:"preview"===A},I=F.editing&&F.operations.add&&C.addButton?u.tsx("button",{bind:this,onclick:()=>this._startAddAttachment(),
class:this.classes("esri-button","esri-button--tertiary","esri-attachments__add-attachment-button"),type:"button"},u.tsx("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-add-icon","esri-icon-plus")}),this.messages.add):null;G=G?u.tsx("ul",{class:"esri-attachments__items"},D.toArray().map(O=>this.renderAttachmentInfo({attachmentInfo:O,displayType:A}))):u.tsx("div",{class:"esri-widget__content--empty"},this.messages.noAttachments);return u.tsx("div",{key:"attachments-container",
class:this.classes("esri-attachments__container",J)},G,I)};B._modeChanged=function(){this._set("error",null);this._set("selectedFile",null)};B._handleFileInputChange=function(A){A=(A=A.target)&&A.files&&A.files.item(0);this._set("selectedFile",A)};B._submitDeleteAttachment=function(A,E){A.preventDefault();this.deleteAttachment(E)};B._submitAddAttachment=function(A){A.preventDefault();this.addAttachment()};B._submitUpdateAttachment=function(A){A.preventDefault();this.updateAttachment()};B._startEditAttachment=
function(A){const {viewModel:E}=this;E.activeAttachmentInfo=A;E.mode="edit"};B._startAddAttachment=function(){this.viewModel.mode="add"};B._cancelForm=function(A){A.preventDefault();this.viewModel.mode="view"};B._getCSSTransform=function(A,E){({orientationInfo:A}=A);return!this._supportsImageOrientation&&E&&A?[A.rotation?`rotate(${A.rotation}deg)`:"",A.mirrored?"scaleX(-1)":""].join(" "):""};a._createClass(v,[{key:"effectiveDisplayType",get:function(){const {displayType:A}=this;return A&&"auto"!==
A?A:this.viewModel.supportsResizeAttachments?"preview":"list"}}]);return v}(k);b.__decorate([x.aliasOf("viewModel.abilities")],w.prototype,"abilities",void 0);b.__decorate([f.property()],w.prototype,"displayType",void 0);b.__decorate([f.property({readOnly:!0})],w.prototype,"effectiveDisplayType",null);b.__decorate([x.aliasOf("viewModel.graphic")],w.prototype,"graphic",void 0);b.__decorate([f.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],w.prototype,"label",void 0);b.__decorate([f.property(),
h.messageBundle("esri/widgets/Attachments/t9n/Attachments")],w.prototype,"messages",void 0);b.__decorate([f.property(),h.messageBundle("esri/core/t9n/Units")],w.prototype,"messagesUnits",void 0);b.__decorate([f.property({readOnly:!0})],w.prototype,"selectedFile",void 0);b.__decorate([f.property({readOnly:!0})],w.prototype,"submitting",void 0);b.__decorate([f.property({readOnly:!0})],w.prototype,"error",void 0);b.__decorate([f.property({type:r})],w.prototype,"viewModel",void 0);b.__decorate([f.property()],
w.prototype,"visibleElements",void 0);b.__decorate([n.cast("visibleElements")],w.prototype,"castVisibleElements",null);return w=b.__decorate([e.subclass("esri.widgets.Attachments")],w)})},"esri/core/unitFormatUtils":function(){define("exports ./byteSizeEstimations ./mathUtils ./string ./unitUtils ../intl/number".split(" "),function(a,b,c,d,g,x){function w(f,e,k){return f.units[e][k]}function l(f,e,k,r=2,y="abbr"){return`${x.formatNumber(e,{minimumFractionDigits:r,maximumFractionDigits:r})} ${w(f,
k,y)}`}const n=["B","kB","MB","GB","TB"];a.formatAngleDegrees=function(f,e,k=2){f=g.convertUnit(f,e,"degrees");return x.formatNumber(f,{style:"unit",unitDisplay:"narrow",unit:"degree",maximumFractionDigits:k,minimumFractionDigits:k})};a.formatDMS=function(f,e,k=2){f=g.convertUnit(f,e,"degrees");e=f-Math.floor(f);f-=e;e*=60;let r=e-Math.floor(e);e-=r;r*=60;return`${f.toFixed()}\u00b0 ${e.toFixed()}' ${r.toFixed(k)}"`};a.formatDecimal=l;a.formatFileSize=function(f,e){let k=0===e?0:Math.floor(Math.log(e)/
Math.log(b.ByteSizeUnit.KILOBYTES));k=c.clamp(k,0,n.length-1);e=x.formatNumber(e/b.ByteSizeUnit.KILOBYTES**k,{maximumFractionDigits:2});return d.replace(f.units.bytes[n[k]],{fileSize:e})};a.formatImperialArea=function(f,e,k,r=2,y="abbr"){const p=g.preferredImperialAreaUnit(e,k);return l(f,g.convertUnit(e,k,p),p,r,y)};a.formatImperialLength=function(f,e,k,r=2,y="abbr"){const p=g.preferredImperialLengthUnit(e,k);return l(f,g.convertUnit(e,k,p),p,r,y)};a.formatImperialVerticalLength=function(f,e,k,r=
2,y="abbr"){const p=g.preferredImperialVerticalLengthUnit(e,k);return l(f,g.convertUnit(e,k,p),p,r,y)};a.formatMetricArea=function(f,e,k,r=2,y="abbr"){const p=g.preferredMetricAreaUnit(e,k);return l(f,g.convertUnit(e,k,p),p,r,y)};a.formatMetricLength=function(f,e,k,r=2,y="abbr"){const p=g.preferredMetricLengthUnit(e,k);return l(f,g.convertUnit(e,k,p),p,r,y)};a.formatMetricVerticalLength=function(f,e,k,r=2,y="abbr"){const p=g.preferredMetricVerticalLengthUnit(e,k);return l(f,g.convertUnit(e,k,p),p,
r,y)};a.unitName=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/widgets/Attachments/AttachmentsViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Graphic ../../core/Collection ../../core/Error ../../core/HandleOwner ../../core/maybe ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ../../rest/query/support/AttachmentInfo ../../rest/support/AttachmentQuery ../Feature/support/featureUtils".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h){const m={editing:!1,operations:{add:!0,update:!0,delete:!0}},u=d.ofType(y);d=function(t){function q(v){var B=t.call(this,v)||this;B._getAttachmentsPromise=null;B._attachmentLayer=null;B.abilities={...m};B.activeAttachmentInfo=null;B.attachmentInfos=new u;B.graphic=null;B.mode="view";B.handles.add([l.init(a._assertThisInitialized(B),"graphic",()=>B._graphicChanged())]);return B}a._inheritsLoose(q,t);var z=q.prototype;z.destroy=function(){this.graphic=this._attachmentLayer=
null};z.castAbilities=function(v){return{...m,...v}};z.getAttachments=function(){var v=a._asyncToGenerator(function*(){const {_attachmentLayer:B,attachmentInfos:A}=this;if(!B||"function"!==typeof B.queryAttachments)throw new g("invalid-layer","getAttachments(): A valid layer is required.");const E=this._getFeatureId();var C=new p({objectIds:[E],returnMetadata:!0});const D=[];this._getAttachmentsPromise=C=B.queryAttachments(C).then(F=>F[E]||D).catch(()=>D);this.notifyChange("state");C=yield C;A.removeAll();
C.length&&A.addMany(C);this._getAttachmentsPromise=null;this.notifyChange("state");return C});return function(){return v.apply(this,arguments)}}();z.addAttachment=function(){var v=a._asyncToGenerator(function*(B){const {_attachmentLayer:A,attachmentInfos:E,graphic:C,abilities:D}=this;if(!B)throw new g("invalid-attachment","addAttachment(): An attachment is required.",{attachment:B});if(!D.operations.add)throw new g("invalid-abilities","addAttachment(): add abilities are required.");if(!A||"function"!==
typeof A.addAttachment)throw new g("invalid-layer","addAttachment(): A valid layer is required.");B=yield A.addAttachment(C,B).then(F=>this._queryAttachment(F.objectId));E.add(B);return B});return function(B){return v.apply(this,arguments)}}();z.deleteAttachment=function(){var v=a._asyncToGenerator(function*(B){const {_attachmentLayer:A,attachmentInfos:E,graphic:C,abilities:D}=this;if(!B)throw new g("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:B});
if(!D.operations.delete)throw new g("invalid-abilities","deleteAttachment(): delete abilities are required.");if(!A||"function"!==typeof A.deleteAttachments)throw new g("invalid-layer","deleteAttachment(): A valid layer is required.");const F=yield A.deleteAttachments(C,[B.id]).then(()=>B);E.remove(F);return F});return function(B){return v.apply(this,arguments)}}();z.updateAttachment=function(){var v=a._asyncToGenerator(function*(B,A=this.activeAttachmentInfo){const {_attachmentLayer:E,attachmentInfos:C,
graphic:D,abilities:F}=this;if(!B)throw new g("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:B});if(!A)throw new g("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:A});if(!F.operations.update)throw new g("invalid-abilities","updateAttachment(): Update abilities are required.");const G=C.findIndex(J=>J===A);if(!E||"function"!==typeof E.updateAttachment)throw new g("invalid-layer","updateAttachment(): A valid layer is required.");
B=yield E.updateAttachment(D,A.id,B).then(J=>this._queryAttachment(J.objectId));C.splice(G,1,B);return B});return function(B){return v.apply(this,arguments)}}();z._queryAttachment=function(){var v=a._asyncToGenerator(function*(B){if(!B)throw new g("invalid-attachment-id","Could not query attachment.");const {_attachmentLayer:A}=this,E=this._getFeatureId();B=new p({objectIds:[E],attachmentsWhere:`AttachmentId=${B}`,returnMetadata:!0});return A.queryAttachments(B).then(C=>C[E][0])});return function(B){return v.apply(this,
arguments)}}();z._getFeatureId=function(){const {_attachmentLayer:v,graphic:B}=this;if(!v||!B)return null;const {objectIdField:A}=v,{attributes:E}=B;return E&&E[A]};z._graphicChanged=function(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>{}))};z._setAttachmentLayer=function(){var {graphic:v}=this;this._attachmentLayer=(v=h.getSourceLayer(v))?"scene"===v.type&&w.isSome(v.associatedLayer)?v.associatedLayer:v:null};a._createClass(q,[{key:"state",get:function(){return this._getAttachmentsPromise?
"loading":this.graphic?"ready":"disabled"}},{key:"supportsResizeAttachments",get:function(){return this.get("graphic.layer.capabilities.operations.supportsResizeAttachments")||!1}}]);return q}(x.HandleOwner);b.__decorate([n.property()],d.prototype,"abilities",void 0);b.__decorate([k.cast("abilities")],d.prototype,"castAbilities",null);b.__decorate([n.property()],d.prototype,"activeAttachmentInfo",void 0);b.__decorate([n.property({readOnly:!0,type:u})],d.prototype,"attachmentInfos",void 0);b.__decorate([n.property({type:c})],
d.prototype,"graphic",void 0);b.__decorate([n.property()],d.prototype,"mode",void 0);b.__decorate([n.property({readOnly:!0})],d.prototype,"state",null);b.__decorate([n.property({readOnly:!0})],d.prototype,"supportsResizeAttachments",null);return d=b.__decorate([r.subclass("esri.widgets.Attachments.AttachmentsViewModel")],d)})},"esri/widgets/Feature/support/featureUtils":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../intl ../../../core/Logger ../../../core/maybe ../../../core/string ../../../intl/date ../../../intl/number ../../../layers/support/fieldUtils ../../../popup/support/FieldInfoFormat ../../../support/arcadeOnDemand".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e){function k(){k=b._asyncToGenerator(function*(X,ba){return"function"===typeof X?X.call(null,ba):X});return k.apply(this,arguments)}function r(X){return X?T.test(X):!1}function y(X,ba){if(!r(ba)||!X)return null;const ha=ba.replace(T,"").toLowerCase();let ka;X.some(ia=>ia.name.toLowerCase()===ha?(ka=ia,!0):!1);return ka}function p(X,ba){return(ba=h(ba,X))?ba.name:X}function h(X,ba){return X&&"function"===typeof X.getField?X.getField(ba):null}function m({formattedAttributes:X,
template:ba,fieldInfoMap:ha}){return`${x.replace(x.replace(ba,ka=>{{const ia=ha.get(ka.toLowerCase());ka=`{${ia&&ia.fieldName||ka}}`}return ka}),X).replace(R,"")}`.trim()}function u(X,ba,ha=!1){const ka=ba[X];"string"===typeof ka&&(ha=(ha?encodeURIComponent(ka):ka).replace(N,"%27"),ba[X]=ha)}function t(X,ba=!1){const ha={...X};Object.keys(ha).forEach(ka=>u(ka,ha,ba));return ha}function q(X,ba){return X.replace(L,(ha,ka,ia)=>(ha=h(ba,ia))?`{${ha.name}}`:ka)}function z(X,ba,ha){return(X=q(X,ha))?X.replace(Q,
(ka,ia,ea)=>{ia=`${ia||ea}`.trim();return x.replace(ka,t(ba,ia&&"{"!==ia[0]))}):X}function v(X,ba){var ha=ba.fieldName,ka=B(ba.fieldInfos,ha),ia=null==ka?void 0:ka.clone();ka=ba.preventPlacesFormatting;ba=ba.layer;ha=h(ba,ha);if(ia&&"date"===(null==ha?void 0:ha.type)){ha=ia.format||new f;ha.dateFormat=ha.dateFormat||"short-date-short-time";var ea;if(!(ea="feature"===(null==ba?void 0:ba.type)&&ba.datesInUnknownTimezone)){if(ea=!(null==ba||!ba.layer))ea=ba.layer,ea="map-image"===(null==ea?void 0:ea.type);
ea=ea&&ba.layer.datesInUnknownTimezone}ha.dateTimeFormatOptions=ea?{timeZone:"UTC"}:null;ia.format=ha}ia=ia&&ia.format;"string"!==typeof X||!ia||null!=ia.dateFormat||null==ia.places&&null==ia.digitSeparator||(ba=Number(X),isNaN(ba)||(X=ba));return"string"===typeof X||null==X||null==ia?C(X):ka?l.formatNumber(X,{...l.convertNumberFormatToIntlOptions(ia),minimumFractionDigits:0,maximumFractionDigits:20}):ia.format(X)}function B(X,ba){if(X&&X.length&&ba){var ha=ba.toLowerCase(),ka=void 0;X.some(ia=>ia.fieldName&&
ia.fieldName.toLowerCase()===ha?(ka=ia,!0):!1);return ka}}function A({fieldName:X,graphic:ba,layer:ha}){if(P(X)||!ha||"function"!==typeof ha.getFeatureType)return null;const {typeIdField:ka}=ha;return ka&&X===ka?(X=ha.getFeatureType(ba))?X.name:null:null}function E({fieldName:X,value:ba,graphic:ha,layer:ka}){return P(X)||!ka||"function"!==typeof ka.getFieldDomain?null:(X=ka.getFieldDomain(X,{feature:ha}))&&"coded-value"===X.type?X.getName(ba):null}function C(X){return"string"===typeof X?X.replace(S,
'\x3cbr class\x3d"esri-text-new-line" /\x3e'):X}function D(X){const {value:ba,fieldName:ha,fieldInfos:ka,fieldInfoMap:ia,layer:ea,graphic:ca}=X;return null==ba?"":(X=E({fieldName:ha,value:ba,graphic:ca,layer:ea}))||(X=A({fieldName:ha,graphic:ca,layer:ea}))?X:ia.get(ha.toLowerCase())?v(ba,{fieldInfos:ka,fieldName:ha,layer:ea}):(X=ea&&ea.fieldsIndex)&&X.isDateField(ha)?w.formatDate(ba,V):C(ba)}function F(X,ba){return G.apply(this,arguments)}function G(){G=b._asyncToGenerator(function*(X,ba){var ha,
ka;const {layer:ia,graphic:ea,outFields:ca,objectIds:Z,returnGeometry:fa,spatialReference:ja}=X;X=Z[0];if("number"!==typeof X&&"string"!==typeof X)return U.warn("Could not query required fields for the specified feature. The feature's ID is invalid.",{layer:ia,graphic:ea,objectId:X,requiredFields:ca}),null;if(null==(ha=ia.capabilities)||null==(ka=ha.operations)||!ka.supportsQuery)return U.warn("The specified layer cannot be queried. The following fields will not be available.",{layer:ia,graphic:ea,
requiredFields:ca,returnGeometry:fa}),null;ha=ia.createQuery();ha.objectIds=Z;ha.outFields=null!=ca&&ca.length?ca:[ia.objectIdField];ha.returnGeometry=!!fa;ha.returnZ=!!fa;ha.returnM=!!fa;ha.outSpatialReference=ja;return(yield ia.queryFeatures(ha,ba)).features[0]});return G.apply(this,arguments)}function J(X){return I.apply(this,arguments)}function I(){I=b._asyncToGenerator(function*(X){var ba;if(null==(ba=X.expressionInfos)||!ba.length)return!1;ba=yield e.loadArcade();({arcadeUtils:{hasGeometryFunctions:ba}}=
ba);return ba(X)});return I.apply(this,arguments)}function O(){O=b._asyncToGenerator(function*({graphic:X,popupTemplate:ba,layer:ha,spatialReference:ka},ia){if(ha&&ba&&("function"===typeof ha.load&&(yield ha.load(ia)),X.attributes)){var ea=X.attributes[ha.objectIdField];if(null!=ea){ea=[ea];var ca=yield ba.getRequiredFields(ha.fieldsIndex),Z=n.featureHasFields(ca,X);ca=Z?[]:ca;ba=ba.returnGeometry||(yield J(ba));if(!Z||ba)if(ha=yield F({layer:ha,graphic:X,outFields:ca,objectIds:ea,returnGeometry:ba,
spatialReference:ka},ia))ha.geometry&&(X.geometry=ha.geometry),ha.attributes&&(X.attributes={...X.attributes,...ha.attributes})}}});return O.apply(this,arguments)}function P(X=""){return X?-1!==X.indexOf("relationships/"):!1}function K({attributes:X,graphic:ba,relatedInfo:ha}){X&&ba&&ha&&Object.keys(ba.attributes).forEach(ka=>{var ia={layerId:ha.relation.id.toString(),fieldName:ka};X[ia?`${"relationships/"}${ia.layerId}/${ia.fieldName}`:""]=ba.attributes[ka]})}function M(X,ba){X&&ba&&(ba.relatedFeatures&&
ba.relatedFeatures&&ba.relatedFeatures.forEach(ha=>K({attributes:X,graphic:ha,relatedInfo:ba})),ba.relatedStatsFeatures&&ba.relatedStatsFeatures&&ba.relatedStatsFeatures.forEach(ha=>K({attributes:X,graphic:ha,relatedInfo:ba})))}const U=d.getLogger("esri.widgets.Feature.support.featureUtils"),R=/href=(""|'')/gi,L=/(\{([^\{\r\n]+)\})/g,N=/'/g,T=/^\s*expression\//i,S=/(\n)/gi,H=/[\u00A0-\u9999<>&]/gim,Q=/href\s*=\s*(?:"([^"]+)"|'([^']+)')/gi,W=/^(?:mailto:|tel:)/,V=w.convertDateFormatToIntlOptions("short-date-short-time"),
Y=X=>{if(!X)return!1;X=X.toUpperCase();return-1<X.indexOf("CURRENT_TIMESTAMP")||-1<X.indexOf("CURRENT_DATE")||-1<X.indexOf("CURRENT_TIME")},aa=({layer:X,method:ba,query:ha,definitionExpression:ka})=>{var ia,ea;null!=(ia=X.capabilities)&&null!=(ea=ia.query)&&ea.supportsCacheHint&&"attachments"!==ba&&(X=g.isSome(ha.where)&&ha.where,ba=g.isSome(ha.geometry)&&ha.geometry,Y(ka)||Y(X)||"extent"===(null==ba?void 0:ba.type)||"tile"===ha.resultType||(ha.cacheHint=!0))};a.applyTextFormattingHTML=C;a.createfieldInfoMap=
function(X,ba){const ha=new Map;X&&X.forEach(ka=>{const ia=p(ka.fieldName,ba);ka.fieldName=ia;ha.set(ia.toLowerCase(),ka)});return ha};a.fixTokens=q;a.formatAttributes=function({fieldInfos:X,attributes:ba,layer:ha,graphic:ka,fieldInfoMap:ia,relatedInfos:ea}){const ca={};null==ea?void 0:ea.forEach(Z=>M(ca,Z));Object.keys(ba).forEach(Z=>{ca[Z]=D({fieldName:Z,fieldInfos:X,fieldInfoMap:ia,layer:ha,value:ba[Z],graphic:ka})});return ca};a.formatEditInfo=function(X,ba){const {creatorField:ha,creationDateField:ka,
editorField:ia,editDateField:ea}=X;if(ba){X=ba[ea];if("number"===typeof X)return ba=ba[ia],{type:"edit",date:w.formatDate(X,V),user:ba};X=ba[ka];return"number"===typeof X?(ba=ba[ha],{type:"create",date:w.formatDate(X,V),user:ba}):null}};a.formatValueToFieldInfo=v;a.getAllFieldInfos=function(X){const ba=[];if(!X)return ba;const {fieldInfos:ha,content:ka}=X;ha&&ba.push(...ha);if(!ka||!Array.isArray(ka))return ba;ka.forEach(ia=>{"fields"===ia.type&&(ia=ia&&ia.fieldInfos)&&ba.push(...ia)});return ba};
a.getFieldInfo=B;a.getFieldInfoLabel=function(X,ba){return(ba=y(ba,null==X?void 0:X.fieldName))?ba.title||null:X?X.label||X.fieldName:null};a.getFixedFieldName=p;a.getFixedFieldNames=function(X,ba){return X&&X.map(ha=>p(ha,ba))};a.getSourceLayer=function(X){if(!g.isNone(X))return X.get("sourceLayer")||X.get("layer")};a.graphicCallback=function(X,ba){return k.apply(this,arguments)};a.htmlEntities=function(X){return X.replace(H,ba=>`&#${ba.charCodeAt(0)};`)};a.isExpressionField=r;a.isRelatedField=P;
a.preLayerQueryCallback=({query:X,layer:ba,method:ha})=>{aa({layer:ba,method:ha,query:X,definitionExpression:`${ba.definitionExpression} ${ba.serviceDefinitionExpression}`})};a.preRequestCallback=({queryPayload:X,layer:ba,method:ha})=>{aa({layer:ba,method:ha,query:X,definitionExpression:`${ba.definitionExpression} ${ba.serviceDefinitionExpression}`})};a.queryUpdatedFeature=function(X,ba){return O.apply(this,arguments)};a.shouldOpenInNewTab=function(X=""){if(X)return!W.test(X.trim().toLowerCase())};
a.substituteAttributes=m;a.substituteFieldsInLinksAndAttributes=function({attributes:X,globalAttributes:ba,layer:ha,text:ka,expressionAttributes:ia,fieldInfoMap:ea}){return ka?m({formattedAttributes:ba,template:z(ka,{...ba,...ia,...X},ha),fieldInfoMap:ea}):""};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/widgets/Attachments/support/attachmentUtils":function(){define(["exports","../../../assets"],function(a,b){a.getIconPath=function(c){const d=b.getAssetUrl("esri/themes/base/images/files/");
return c?"text/plain"===c?`${d}text-32.svg`:"application/pdf"===c?`${d}pdf-32.svg`:"text/csv"===c?`${d}csv-32.svg`:"application/gpx+xml"===c?`${d}gpx-32.svg`:"application/x-dwf"===c?`${d}cad-32.svg`:"application/postscript"===c||"application/json"===c||"text/xml"===c||"model/vrml"===c?`${d}code-32.svg`:"application/x-zip-compressed"===c||"application/x-7z-compressed"===c||"application/x-gzip"===c||"application/x-tar"===c||"application/x-gtar"===c||"application/x-bzip2"===c||"application/gzip"===c||
"application/x-compress"===c||"application/x-apple-diskimage"===c||"application/x-rar-compressed"===c||"application/zip"===c?`${d}zip-32.svg`:-1!==c.indexOf("image/")?`${d}image-32.svg`:-1!==c.indexOf("audio/")?`${d}sound-32.svg`:-1!==c.indexOf("video/")?`${d}video-32.svg`:-1!==c.indexOf("msexcel")||-1!==c.indexOf("ms-excel")||-1!==c.indexOf("spreadsheetml")?`${d}excel-32.svg`:-1!==c.indexOf("msword")||-1!==c.indexOf("ms-word")||-1!==c.indexOf("wordprocessingml")?`${d}word-32.svg`:-1!==c.indexOf("powerpoint")||
-1!==c.indexOf("presentationml")?`${d}report-32.svg`:`${d}generic-32.svg`:`${d}generic-32.svg`};a.isSupportedImage=function(c){c=c.toLowerCase();return"image/bmp"===c||"image/emf"===c||"image/exif"===c||"image/gif"===c||"image/x-icon"===c||"image/jpeg"===c||"image/png"===c||"image/tiff"===c||"image/x-wmf"===c};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/widgets/Feature/FeatureAttachments/FeatureAttachmentsViewModel":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../Attachments/AttachmentsViewModel".split(" "),
function(a,b,c,d,g,x,w,l){d=function(n){function f(e){e=n.call(this,e)||this;e.description=null;e.title=null;return e}a._inheritsLoose(f,n);return f}(l);b.__decorate([c.property()],d.prototype,"description",void 0);b.__decorate([c.property()],d.prototype,"title",void 0);return d=b.__decorate([w.subclass("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],d)})},"esri/widgets/Feature/support/FeatureElementInfo":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../Widget ../../support/Heading ../../support/widgetUtils ../../../core/Logger ../../support/jsxFactory".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k){d=function(r){function y(h,m){h=r.call(this,h,m)||this;h.description=null;h.headingLevel=2;h.title=null;return h}a._inheritsLoose(y,r);var p=y.prototype;p.render=function(){return k.tsx("div",{class:"esri-feature-element-info"},this.renderTitle(),this.renderDescription())};p.renderTitle=function(){const {title:h}=this;return h?k.tsx(n.Heading,{level:this.headingLevel,class:"esri-feature-element-info__title"},h):null};p.renderDescription=function(){const {description:h}=
this;return h?k.tsx("div",{key:"description",class:"esri-feature-element-info__description"},h):null};return y}(l);b.__decorate([c.property()],d.prototype,"description",void 0);b.__decorate([c.property()],d.prototype,"headingLevel",void 0);b.__decorate([c.property()],d.prototype,"title",void 0);return d=b.__decorate([w.subclass("esri.widgets.Feature.support.FeatureElementInfo")],d)})},"esri/widgets/support/Heading":function(){define("exports ../../core/mathUtils ./widgetUtils ../../core/has ../../core/Logger ./jsxFactory".split(" "),
function(a,b,c,d,g,x){const w={heading:"esri-widget__heading"};a.CSS=w;a.Heading=function(l,n){const f=b.clamp(Math.ceil(l.level),1,6),e=`h${f}`;delete l.level;return x.tsx(e,{...l,class:c.classes(w.heading,l.class),role:"heading","aria-level":String(f)},n)};a.incrementHeadingLevel=function(l,n=1){return b.clamp(Math.ceil(l+n),1,6)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/widgets/Feature/FeatureContent":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/accessorSupport/decorators/aliasOf ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/subclass ../Widget ./FeatureContent/FeatureContentViewModel ./support/featureUtils ../support/widget ../support/jsxFactory".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r){d=function(y){function p(m,u){m=y.call(this,m,u)||this;m.creator=null;m.graphic=null;m.viewModel=null;m._addTargetToAnchors=t=>{Array.from(t.querySelectorAll("a")).forEach(q=>{e.shouldOpenInNewTab(q.href)&&!q.hasAttribute("target")&&q.setAttribute("target","_blank")})};return m}a._inheritsLoose(p,y);var h=p.prototype;h.renderLoading=function(){return r.tsx("div",{class:"esri-feature-content__loader-container",key:"loader"},r.tsx("div",{class:"esri-feature-content__loader"}))};
h.renderCreated=function(){var m;const u=null==(m=this.viewModel)?void 0:m.created;return u?u instanceof HTMLElement?r.tsx("div",{key:u,bind:u,afterCreate:this._attachToNode}):k.isWidget(u)?r.tsx("div",{key:u},!u.destroyed&&u.render()):r.tsx("div",{key:u,innerHTML:u,afterCreate:this._addTargetToAnchors}):null};h.render=function(){var m;const u=null==(m=this.viewModel)?void 0:m.state;return r.tsx("div",{class:"esri-feature-content"},"loading"===u?this.renderLoading():this.renderCreated())};h._attachToNode=
function(m){m.appendChild(this)};return p}(n);b.__decorate([c.aliasOf("viewModel.creator")],d.prototype,"creator",void 0);b.__decorate([c.aliasOf("viewModel.graphic")],d.prototype,"graphic",void 0);b.__decorate([w.property({type:f})],d.prototype,"viewModel",void 0);return d=b.__decorate([l.subclass("esri.widgets.Feature.FeatureContent")],d)})},"esri/widgets/Feature/FeatureContent/FeatureContentViewModel":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Accessor ../../../core/HandleOwner ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../support/featureUtils".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k){d=function(r){function y(h){var m=r.call(this,h)||this;m._loadingPromise=null;m.created=null;m.creator=null;m.destroyer=null;m.graphic=null;m.handles.add(x.init(a._assertThisInitialized(m),"creator",u=>{m._destroyContent();m._createContent(u)}));return m}a._inheritsLoose(y,r);var p=y.prototype;p.destroy=function(){this._destroyContent()};p._destroyContent=function(){const {created:h,graphic:m,destroyer:u}=this;h&&(k.graphicCallback(u,{graphic:m}).catch(()=>null),
this._set("created",null))};p._createContent=function(){var h=a._asyncToGenerator(function*(m){var {graphic:u}=this;this._loadingPromise=m=k.graphicCallback(m,{graphic:u}).catch(()=>null);this.notifyChange("state");u=yield m;m===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",u))});return function(m){return h.apply(this,arguments)}}();a._createClass(y,[{key:"state",get:function(){return this._loadingPromise?"loading":"ready"}}]);return y}(g.HandleOwnerMixin(d));
b.__decorate([w.property({readOnly:!0})],d.prototype,"created",void 0);b.__decorate([w.property()],d.prototype,"creator",void 0);b.__decorate([w.property()],d.prototype,"destroyer",void 0);b.__decorate([w.property({type:c})],d.prototype,"graphic",void 0);b.__decorate([w.property({readOnly:!0})],d.prototype,"state",null);return d=b.__decorate([e.subclass("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],d)})},"esri/widgets/Feature/FeatureExpression":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../Widget ./FeatureContent ./FeatureFields ./FeatureMedia ./FeatureExpression/FeatureExpressionViewModel ../support/widgetUtils ../../core/Logger ../support/jsxFactory".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h){g=function(m){function u(q,z){q=m.call(this,q,z)||this;q.viewModel=new r;return q}a._inheritsLoose(u,m);var t=u.prototype;t.initialize=function(){c.init(this,"viewModel.contentElementViewModel",()=>this._setupExpressionWidget())};t.destroy=function(){this._destroyContentWidget()};t.renderLoading=function(){return h.tsx("div",{key:"loading-container",class:"esri-feature__loading-container"},h.tsx("span",{class:this.classes("esri-icon-loading-indicator esri-rotating",
"esri-feature__loading-spinner")}))};t.render=function(){var q;const {state:z}=this.viewModel;return h.tsx("div",{class:"esri-feature-expression"},"loading"===z?this.renderLoading():"disabled"===z?null:null==(q=this._contentWidget)?void 0:q.render())};t._destroyContentWidget=function(){const {_contentWidget:q}=this;q&&(q.viewModel=null,q.destroy());this._contentWidget=null};t._setupExpressionWidget=function(){const {contentElementViewModel:q,contentElement:z}=this.viewModel,v=null==z?void 0:z.type;
this._destroyContentWidget();this._contentWidget=q?"fields"===v?new e({viewModel:q}):"media"===v?new k({viewModel:q}):"text"===v?new f({viewModel:q}):null:null;this.scheduleRender()};return u}(n);b.__decorate([d.property({type:r})],g.prototype,"viewModel",void 0);return g=b.__decorate([l.subclass("esri.widgets.Feature.FeatureExpression")],g)})},"esri/widgets/Feature/FeatureFields":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/watchUtils ../../core/accessorSupport/decorators/aliasOf ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/subclass ../Widget ./FeatureFields/FeatureFieldsViewModel ./support/FeatureElementInfo ../support/uriUtils ../support/widgetUtils ../support/decorators/messageBundle ../../core/Logger ../support/jsxFactory".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m){g=function(u){function t(z,v){z=u.call(this,z,v)||this;z._featureElementInfo=null;z.attributes=null;z.description=null;z.expressionInfos=null;z.fieldInfos=null;z.title=null;z.viewModel=new e;z.messages=null;z.messagesURIUtils=null;return z}a._inheritsLoose(t,u);var q=t.prototype;q.initialize=function(){this._featureElementInfo=new k;c.init(this,["viewModel.description","viewModel.title"],()=>this._setupFeatureElementInfo())};q.destroy=function(){this._featureElementInfo.destroy()};
q.renderFieldInfo=function(z,v){var {attributes:B}=this.viewModel;const A=z.fieldName,E=z.label||A;B=B?null==B[A]?"":B[A]:"";z=!(!z.format||!z.format.dateFormat);B="number"!==typeof B||z?r.autoLink(this.messagesURIUtils,B):this._forceLTR(B);z={["esri-feature-fields__field-data--date"]:z};return m.tsx("tr",{key:`fields-element-info-row-${A}-${v}`},m.tsx("th",{key:`fields-element-info-row-header-${A}-${v}`,class:"esri-feature-fields__field-header",innerHTML:E}),m.tsx("td",{key:`fields-element-info-row-data-${A}-${v}`,
class:this.classes("esri-feature-fields__field-data",z),innerHTML:B}))};q.renderFields=function(){const {formattedFieldInfos:z}=this.viewModel;return null!=z&&z.length?m.tsx("table",{class:"esri-widget__table",summary:this.messages.fieldsSummary},m.tsx("tbody",null,z.map((v,B)=>this.renderFieldInfo(v,B)))):null};q.render=function(){var z;return m.tsx("div",{class:"esri-feature-fields"},null==(z=this._featureElementInfo)?void 0:z.render(),this.renderFields())};q._setupFeatureElementInfo=function(){const {description:z,
title:v}=this;this._featureElementInfo.set({description:z,title:v})};q._forceLTR=function(z){return`&lrm;${z}`};return t}(f);b.__decorate([d.aliasOf("viewModel.attributes")],g.prototype,"attributes",void 0);b.__decorate([d.aliasOf("viewModel.description")],g.prototype,"description",void 0);b.__decorate([d.aliasOf("viewModel.expressionInfos")],g.prototype,"expressionInfos",void 0);b.__decorate([d.aliasOf("viewModel.fieldInfos")],g.prototype,"fieldInfos",void 0);b.__decorate([d.aliasOf("viewModel.title")],
g.prototype,"title",void 0);b.__decorate([l.property({type:e})],g.prototype,"viewModel",void 0);b.__decorate([l.property(),p.messageBundle("esri/widgets/Feature/t9n/Feature")],g.prototype,"messages",void 0);b.__decorate([l.property(),p.messageBundle("esri/widgets/support/t9n/uriUtils")],g.prototype,"messagesURIUtils",void 0);return g=b.__decorate([n.subclass("esri.widgets.Feature.FeatureFields")],g)})},"esri/widgets/Feature/FeatureFields/FeatureFieldsViewModel":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../popup/ExpressionInfo ../../../popup/FieldInfo ../support/featureUtils".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e){c=function(k){function r(y){y=k.call(this,y)||this;y.attributes=null;y.expressionInfos=null;y.description=null;y.fieldInfos=null;y.title=null;return y}a._inheritsLoose(r,k);a._createClass(r,[{key:"formattedFieldInfos",get:function(){const {expressionInfos:y,fieldInfos:p}=this,h=[];null==p?void 0:p.forEach(m=>{if(!m.hasOwnProperty("visible")||m.visible)m=m.clone(),m.label=e.getFieldInfoLabel(m,y),h.push(m)});return h}}]);return r}(c);b.__decorate([d.property()],c.prototype,
"attributes",void 0);b.__decorate([d.property({type:[n]})],c.prototype,"expressionInfos",void 0);b.__decorate([d.property()],c.prototype,"description",void 0);b.__decorate([d.property({type:[f]})],c.prototype,"fieldInfos",void 0);b.__decorate([d.property({readOnly:!0})],c.prototype,"formattedFieldInfos",null);b.__decorate([d.property()],c.prototype,"title",void 0);return c=b.__decorate([l.subclass("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],c)})},"esri/widgets/support/uriUtils":function(){define(["exports",
"../../core/string"],function(a,b){function c(g){let x=null;d.some(w=>{w.pattern.test(g)&&(x=w);return!!x});return x}const d=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",
appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",
appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];a.autoLink=function(g,x){if("string"!==typeof x||!x)return x;const w=c(x);if(!w)return x;const l=x.match(w.pattern);
g=b.replace(b.replace(w.label,{messages:g,hierPart:l&&l[2]}),{appName:w.appName});return x.replace(w.pattern,`<a${w.target?` target="${w.target}"`:""} href="$1"${"_blank"===w.target?' rel\x3d"noreferrer"':""}>${g}</a>`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/widgets/Feature/FeatureMedia":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/events ../../core/watchUtils ../../core/accessorSupport/decorators/aliasOf ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/subclass ../Widget ./FeatureMedia/FeatureMediaViewModel ./support/FeatureElementInfo ./support/featureUtils ../support/chartUtils ../support/widgetUtils ../support/decorators/messageBundle ../../core/Logger ../support/jsxFactory ../support/widgetThemeUtils".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q){x=function(z){function v(A,E){var C=z.call(this,A,E)||this;C._refreshTimer=null;C._refreshIntervalInfo=null;C._featureElementInfo=null;C.attributes=null;C.activeMediaInfoIndex=null;C.description=null;C.fieldInfoMap=null;C.layer=null;C.mediaInfos=null;C.popupTemplate=null;C.relatedInfos=null;C.title=null;C.viewModel=new k;C.messages=null;C._getChartDependencies=function(){var D=a._asyncToGenerator(function*(F){const G=yield p.loadChartsModule(),{destroyed:J,
viewModel:I}=a._assertThisInitialized(C);if(!J&&I&&F){var {activeMediaInfo:O}=I;C._renderChart({chartDiv:F,mediaInfo:O,chartsModule:G})}});return function(F){return D.apply(this,arguments)}}();return C}a._inheritsLoose(v,z);var B=v.prototype;B.initialize=function(){this._featureElementInfo=new r;this.own(d.init(this,["viewModel.activeMediaInfo","viewModel.activeMediaInfoIndex"],()=>this._setupMediaRefreshTimer()),d.init(this,["viewModel.description","viewModel.title"],()=>this._setupFeatureElementInfo()))};
B.destroy=function(){this._clearMediaRefreshTimer();this._featureElementInfo.destroy()};B.render=function(){var A;return t.tsx("div",{bind:this,class:"esri-feature-media",onkeyup:this._handleMediaKeyup},null==(A=this._featureElementInfo)?void 0:A.render(),this.renderMedia())};B.renderMedia=function(){const {formattedMediaInfoCount:A}=this.viewModel;return A?t.tsx("div",{key:"media-element-container",class:"esri-feature-media__container"},this.renderMediaPageButton("previous"),this.renderMediaInfo(),
this.renderMediaPageButton("next")):null};B.renderImageMediaInfo=function(A){var {_refreshIntervalInfo:E}=this;const {activeMediaInfoIndex:C,formattedMediaInfoCount:D}=this.viewModel,{value:F,refreshInterval:G,altText:J,title:I,type:O}=A,{sourceURL:P,linkURL:K}=F;A=y.shouldOpenInNewTab(K)?"_blank":"_self";const M="_blank"===A?"noreferrer":"";E=G?E:null;E=t.tsx("img",{alt:J||I,key:`media-${O}-${C}-${D}-${E?E.timestamp:0}`,src:E?E.sourceURL:P});return(A=K?t.tsx("a",{title:I,href:K,rel:M,target:A},E):
null)?A:E};B.renderChartMediaInfo=function(A){const {activeMediaInfoIndex:E,formattedMediaInfoCount:C}=this.viewModel;return t.tsx("div",{key:`media-${A.type}-${E}-${C}`,bind:this,class:"esri-feature-media__chart",afterCreate:this._getChartDependencies})};B.renderMediaInfoType=function(){const {activeMediaInfo:A}=this.viewModel;return A?"image"===A.type?this.renderImageMediaInfo(A):-1!==A.type.indexOf("chart")?this.renderChartMediaInfo(A):null:null};B.renderMediaInfo=function(){var {activeMediaInfo:A}=
this.viewModel;if(!A)return null;const E=A.title?t.tsx("div",{key:"media-title",class:"esri-feature-media__item-title",innerHTML:A.title}):null;A=A.caption?t.tsx("div",{key:"media-caption",class:"esri-feature-media__item-caption",innerHTML:A.caption}):null;return t.tsx("div",{key:"media-container",class:"esri-feature-media__item-container"},t.tsx("div",{key:"media-item-container",class:"esri-feature-media__item"},this.renderMediaInfoType()),E,A)};B.renderMediaPageButton=function(A){if(2>this.viewModel.formattedMediaInfoCount)return null;
const E=(A="previous"===A)?this.messages.previous:this.messages.next,C=A?this.classes("esri-feature-media__button","esri-feature-media__previous"):this.classes("esri-feature-media__button","esri-feature-media__next"),D=A?this.classes("esri-feature-media__icon","esri-feature-media__previous-icon","esri-icon-left-triangle-arrow"):this.classes("esri-feature-media__icon","esri-feature-media__next-icon","esri-icon-right-triangle-arrow"),F=A?this.classes("esri-feature-media__icon","esri-feature-media__previous-icon--rtl",
"esri-icon-right-triangle-arrow"):this.classes("esri-feature-media__icon","esri-feature-media__next-icon--rtl","esri-icon-left-triangle-arrow");return t.tsx("button",{type:"button",key:A?"media-previous":"media-next",title:E,"aria-label":E,tabIndex:0,class:C,bind:this,onclick:A?this._previous:this._next},t.tsx("span",{"aria-hidden":"true",class:D}),t.tsx("span",{"aria-hidden":"true",class:F}))};B._setupFeatureElementInfo=function(){const {description:A,title:E}=this;this._featureElementInfo.set({description:A,
title:E})};B._next=function(){this.viewModel.next()};B._previous=function(){this.viewModel.previous()};B._handleMediaKeyup=function(A){const E=c.eventKey(A);"ArrowLeft"===E&&(A.stopPropagation(),this.viewModel.previous());"ArrowRight"===E&&(A.stopPropagation(),this.viewModel.next())};B._renderChart=function(A){const {abilities:E}=this.viewModel,{chartsModule:C,chartDiv:D,mediaInfo:F}=A,{value:G,type:J}=F,{am4core:I}=C,O=p.getColorSet(I);q.isDarkTheme()&&I.useTheme(C.am4themes_dark);const P=window.matchMedia("(prefers-reduced-motion: reduce)");
E.chartAnimation&&!P.matches?I.useTheme(C.am4themes_animated):I.unuseTheme(C.am4themes_animated);I.useTheme(function(K){K instanceof I.ColorSet&&O&&(K.list=O)});A="pie-chart"===J?this._createPieChart(A):this._createXYChart(A);D.setAttribute("aria-label",F.altText||F.title);A.data=G.series.map(K=>({tooltip:K.tooltip,value:K.value})).filter(K=>"pie-chart"===J?0<K.value:!0)};B._customizeChartTooltip=function(A,E){A.label.wrap=!0;A.label.maxWidth=200;A.autoTextColor=!1;A.getFillFromObject=!1;A.label.fill=
E.color("#ffffff");A.background.fill=E.color({r:0,g:0,b:0,a:.7})};B._createPieChart=function(A){const {chartDiv:E,chartsModule:C}=A,{am4core:D,am4charts:F}=C;A=D.create(E,F.PieChart);A.rtl=h.isRTL(this.container);const G=A.series.push(new F.PieSeries);G.labels.template.disabled=!0;G.ticks.template.disabled=!0;G.dataFields.value="value";G.dataFields.category="tooltip";this._customizeChartTooltip(G.tooltip,D);G.slices.template.tooltipText=A.rtl?"{category}: %{value.percent.formatNumber('#.0')}":"{category}: {value.percent.formatNumber('#.0')}%";
return A};B._getMinSeriesValue=function(A){let E=0;A.forEach(C=>E=Math.min(C.value,E));return E};B._createColumnChart=function(A,E){const {chartsModule:C,mediaInfo:D}=E;({value:E}=D);const {am4core:F,am4charts:G}=C,J=A.xAxes.push(new G.CategoryAxis);J.dataFields.category="tooltip";J.renderer.labels.template.disabled=!0;this._customizeChartTooltip(J.tooltip,F);J.tooltip.events.on("sizechanged",()=>{J.tooltip.dy=-J.tooltip.contentHeight});var I=A.yAxes.push(new G.ValueAxis);const O=I.renderer.labels.template;
I.renderer.minLabelPosition=.05;I.renderer.maxLabelPosition=.95;I.min=this._getMinSeriesValue(E.series);this._customizeChartTooltip(I.tooltip,F);O.wrap=!0;I=A.series.push(new G.ColumnSeries);I.dataFields.valueY="value";I.dataFields.categoryX="tooltip";A.cursor=new G.XYCursor;15<E.series.length&&(A.scrollbarX=new F.Scrollbar)};B._createBarChart=function(A,E){const {chartsModule:C,mediaInfo:D}=E;({value:E}=D);const {am4core:F,am4charts:G}=C,J=A.yAxes.push(new G.CategoryAxis);J.dataFields.category="tooltip";
J.renderer.inversed=!0;J.renderer.labels.template.disabled=!0;this._customizeChartTooltip(J.tooltip,F);J.tooltip.events.on("sizechanged",()=>{J.tooltip.dx=J.tooltip.contentWidth});var I=A.xAxes.push(new G.ValueAxis);const O=I.renderer.labels.template;I.renderer.minLabelPosition=.05;I.renderer.maxLabelPosition=.95;I.min=this._getMinSeriesValue(E.series);this._customizeChartTooltip(I.tooltip,F);O.wrap=!0;I=A.series.push(new G.ColumnSeries);I.dataFields.valueX="value";I.dataFields.categoryY="tooltip";
A.cursor=new G.XYCursor;15<E.series.length&&(A.scrollbarY=new F.Scrollbar)};B._createLineChart=function(A,E){const {chartsModule:C,mediaInfo:D}=E;({value:E}=D);const {am4core:F,am4charts:G}=C,J=A.xAxes.push(new G.CategoryAxis);J.dataFields.category="tooltip";J.renderer.labels.template.disabled=!0;this._customizeChartTooltip(J.tooltip,F);J.tooltip.events.on("sizechanged",()=>{J.tooltip.dy=-J.tooltip.contentHeight});var I=A.yAxes.push(new G.ValueAxis);const O=I.renderer.labels.template;I.renderer.minLabelPosition=
.05;I.renderer.maxLabelPosition=.95;I.min=this._getMinSeriesValue(E.series);this._customizeChartTooltip(I.tooltip,F);O.wrap=!0;I=A.series.push(new G.LineSeries);I.dataFields.categoryX="tooltip";I.dataFields.valueY="value";A.cursor=new G.XYCursor;15<E.series.length&&(A.scrollbarX=new F.Scrollbar)};B._createXYChart=function(A){const {chartDiv:E,chartsModule:C,mediaInfo:D}=A,{type:F}=D,{am4core:G,am4charts:J}=C,I=G.create(E,J.XYChart);I.rtl=h.isRTL(this.container);"column-chart"===F&&this._createColumnChart(I,
A);"bar-chart"===F&&this._createBarChart(I,A);"line-chart"===F&&this._createLineChart(I,A);return I};B._clearMediaRefreshTimer=function(){const {_refreshTimer:A}=this;A&&(clearTimeout(A),this._refreshTimer=null)};B._updateMediaInfoTimestamp=function(A){const E=Date.now();this._refreshIntervalInfo={timestamp:E,sourceURL:this._getImageSource(A,E)};this.scheduleRender()};B._setupMediaRefreshTimer=function(){this._clearMediaRefreshTimer();const {activeMediaInfo:A}=this.viewModel;A&&"image"===A.type&&
A.refreshInterval&&this._setRefreshTimeout(A)};B._setRefreshTimeout=function(A){const {refreshInterval:E,value:C}=A;E&&(A=6E4*E,this._updateMediaInfoTimestamp(C.sourceURL),this._refreshTimer=setInterval(()=>{this._updateMediaInfoTimestamp(C.sourceURL)},A))};B._getImageSource=function(A,E){const C=-1!==A.indexOf("?")?"\x26":"?",[D,F=""]=A.split("#");return`${D}${C}timestamp=${E}${F?"#":""}${F}`};return v}(e);b.__decorate([g.aliasOf("viewModel.attributes")],x.prototype,"attributes",void 0);b.__decorate([g.aliasOf("viewModel.activeMediaInfoIndex")],
x.prototype,"activeMediaInfoIndex",void 0);b.__decorate([g.aliasOf("viewModel.description")],x.prototype,"description",void 0);b.__decorate([g.aliasOf("viewModel.fieldInfoMap")],x.prototype,"fieldInfoMap",void 0);b.__decorate([g.aliasOf("viewModel.layer")],x.prototype,"layer",void 0);b.__decorate([g.aliasOf("viewModel.mediaInfos")],x.prototype,"mediaInfos",void 0);b.__decorate([g.aliasOf("viewModel.popupTemplate")],x.prototype,"popupTemplate",void 0);b.__decorate([g.aliasOf("viewModel.relatedInfos")],
x.prototype,"relatedInfos",void 0);b.__decorate([g.aliasOf("viewModel.title")],x.prototype,"title",void 0);b.__decorate([n.property({type:k})],x.prototype,"viewModel",void 0);b.__decorate([n.property(),m.messageBundle("esri/widgets/Feature/t9n/Feature")],x.prototype,"messages",void 0);return x=b.__decorate([f.subclass("esri.widgets.Feature.FeatureMedia")],x)})},"esri/widgets/Feature/FeatureMedia/FeatureMediaViewModel":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/cast ../../../core/accessorSupport/decorators/subclass ../../../popup/FieldInfo ../../../popup/content/support/ChartMediaInfoValueSeries ../support/featureUtils ../support/relatedFeatureUtils".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k){const r={chartAnimation:!0};c=function(y){function p(m){m=y.call(this,m)||this;m.abilities={...r};m.activeMediaInfoIndex=0;m.attributes=null;m.description=null;m.fieldInfoMap=null;m.formattedAttributes=null;m.expressionAttributes=null;m.layer=null;m.mediaInfos=null;m.popupTemplate=null;m.relatedInfos=null;m.title=null;return m}a._inheritsLoose(p,y);var h=p.prototype;h.castAbilities=function(m){return{...r,...m}};h.setActiveMedia=function(m){this._setContentElementMedia(m)};
h.next=function(){this._pageContentElementMedia(1)};h.previous=function(){this._pageContentElementMedia(-1)};h._setContentElementMedia=function(m){const {formattedMediaInfoCount:u}=this;this.activeMediaInfoIndex=(m+u)%u};h._pageContentElementMedia=function(m){const {activeMediaInfoIndex:u}=this;this._setContentElementMedia(u+m)};h._formatMediaInfos=function(){const {attributes:m,mediaInfos:u,formattedAttributes:t,expressionAttributes:q,fieldInfoMap:z,layer:v}=this;return null==u?void 0:u.map(B=>{B=
null==B?void 0:B.clone();if(!B)return null;B.title=e.substituteFieldsInLinksAndAttributes({attributes:m,fieldInfoMap:z,globalAttributes:t,expressionAttributes:q,layer:v,text:B.title});B.caption=e.substituteFieldsInLinksAndAttributes({attributes:m,fieldInfoMap:z,globalAttributes:t,expressionAttributes:q,layer:v,text:B.caption});B.altText=e.substituteFieldsInLinksAndAttributes({attributes:m,fieldInfoMap:z,globalAttributes:t,expressionAttributes:q,layer:v,text:B.altText});if("image"===B.type){var {value:A}=
B;this._setImageValue({value:A,formattedAttributes:t,layer:v});return B.value.sourceURL?B:void 0}return"pie-chart"===B.type||"line-chart"===B.type||"column-chart"===B.type||"bar-chart"===B.type?({value:A}=B,this._setChartValue({value:A,chartType:B.type,attributes:m,formattedAttributes:t,layer:v}),B):null}).filter(Boolean)};h._setImageValue=function(m){const {fieldInfoMap:u}=this,{value:t,formattedAttributes:q,layer:z}=m,{linkURL:v,sourceURL:B}=t;B&&(m=e.fixTokens(B,z),t.sourceURL=e.substituteAttributes({formattedAttributes:q,
template:m,fieldInfoMap:u}));v&&(m=e.fixTokens(v,z),t.linkURL=e.substituteAttributes({formattedAttributes:q,template:m,fieldInfoMap:u}))};h._setChartValue=function(m){const {value:u,attributes:t,formattedAttributes:q,chartType:z,layer:v}=m,{popupTemplate:B,relatedInfos:A}=this,{fields:E,normalizeField:C}=u;u.fields=e.getFixedFieldNames(E,v);C&&(u.normalizeField=e.getFixedFieldName(C,v));if(E.some(F=>!!(null!=q[F]||e.isRelatedField(F)&&A.size))){var D=null==B?void 0:B.fieldInfos;E.forEach(F=>{e.isRelatedField(F)?
u.series=[...u.series,...this._getRelatedChartInfos({fieldInfos:D,fieldName:F,formattedAttributes:q,chartType:z,value:u})]:(F=this._getChartOption({value:u,attributes:t,chartType:z,formattedAttributes:q,fieldName:F,fieldInfos:D}),u.series.push(F))})}};h._getRelatedChartInfos=function(m){var u;const {fieldInfos:t,fieldName:q,formattedAttributes:z,chartType:v,value:B}=m,A=[];m=k.getRelatedFieldInfo(q);const {layerId:E,fieldName:C}=m;m=null==(u=this.relatedInfos)?void 0:u.get(E.toString());if(!m)return A;
const {relatedFeatures:D,relation:F}=m;if(!F||!D)return A;({cardinality:u}=F);D.forEach(G=>{const {attributes:J}=G;J&&Object.keys(J).forEach(I=>{I===C&&A.push(this._getChartOption({value:B,attributes:J,formattedAttributes:z,fieldName:q,chartType:v,relatedFieldName:I,fieldInfos:t}))})});return"one-to-many"===u||"many-to-many"===u?A:[A[0]]};h._getTooltip=function({label:m,value:u,chartType:t}){return"pie-chart"===t?m:`${m}: ${u}`};h._getChartOption=function(m){const {value:u,attributes:t,formattedAttributes:q,
fieldName:z,relatedFieldName:v,fieldInfos:B,chartType:A}=m;var {layer:E}=this;const {normalizeField:C,tooltipField:D}=u;var F=C?e.isRelatedField(C)?t[k.getRelatedFieldInfo(C).fieldName]:t[C]:null;m=v&&void 0!==t[v]?t[v]:void 0!==t[z]?t[z]:q[z];const G=void 0===m?null:m&&F?m/F:m;m=new f({value:G});if(e.isRelatedField(z)){var J=k.getRelatedFieldInfo(z);var I=k.getRelatedFieldInfo(D);I=I?I.fieldName:null;E=e.formatValueToFieldInfo(G,{fieldInfos:B,fieldName:v,layer:E,preventPlacesFormatting:!!F});J=J?
J.label||J.fieldName:v;m.tooltip=this._getTooltip({label:I&&void 0!==t[I]?t[I]:J,value:E,chartType:A});return m}F=e.getFieldInfo(B,z);E=e.getFixedFieldName(z,E);F=D&&void 0!==q[D]?q[D]:e.getFieldInfoLabel(F||new n({fieldName:E}),null==(J=this.popupTemplate)?void 0:J.expressionInfos);m.tooltip=this._getTooltip({label:F,value:q[E],chartType:A});return m};a._createClass(p,[{key:"activeMediaInfo",get:function(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}},{key:"formattedMediaInfos",
get:function(){return this._formatMediaInfos()||[]}},{key:"formattedMediaInfoCount",get:function(){return this.formattedMediaInfos.length}}]);return p}(c);b.__decorate([d.property()],c.prototype,"abilities",void 0);b.__decorate([w.cast("abilities")],c.prototype,"castAbilities",null);b.__decorate([d.property()],c.prototype,"activeMediaInfoIndex",void 0);b.__decorate([d.property({readOnly:!0})],c.prototype,"activeMediaInfo",null);b.__decorate([d.property()],c.prototype,"attributes",void 0);b.__decorate([d.property()],
c.prototype,"description",void 0);b.__decorate([d.property()],c.prototype,"fieldInfoMap",void 0);b.__decorate([d.property()],c.prototype,"formattedAttributes",void 0);b.__decorate([d.property()],c.prototype,"expressionAttributes",void 0);b.__decorate([d.property({readOnly:!0})],c.prototype,"formattedMediaInfos",null);b.__decorate([d.property()],c.prototype,"layer",void 0);b.__decorate([d.property({readOnly:!0})],c.prototype,"formattedMediaInfoCount",null);b.__decorate([d.property()],c.prototype,"mediaInfos",
void 0);b.__decorate([d.property()],c.prototype,"popupTemplate",void 0);b.__decorate([d.property()],c.prototype,"relatedInfos",void 0);b.__decorate([d.property()],c.prototype,"title",void 0);return c=b.__decorate([l.subclass("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],c)})},"esri/widgets/Feature/support/relatedFeatureUtils":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../request ../../../core/Error ../../../core/Logger ../../../core/promiseUtils ../../../layers/support/fieldUtils ../../../rest/support/Query ../../../rest/support/RelationshipQuery ../../../rest/support/StatisticDefinition ../../../tasks/QueryTask ./featureUtils".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k){function r(B,A){if(!A.relationships)return null;let E=null;({relationships:A}=A);A.some(C=>C.id===parseInt(B,10)?(E=C,!0):!1);return E}function y({originRelationship:B,relationships:A,layerId:E}){let C;A&&A.some(D=>{`${D.relatedTableId}`===E&&D.id===B.id&&(C=D);return!!C});return C}function p(B,A){A=A.toLowerCase();for(const E in B)if(E.toLowerCase()===A)return B[E];return null}function h(B,A,E,C){const D=new n;D.outFields=["*"];D.relationshipId="number"===typeof A.id?
A.id:parseInt(A.id,10);D.objectIds=[B.attributes[E.objectIdField]];return E.queryRelatedFeatures(D,C)}function m(B,A,E){let C=0;const D=[];for(;C<A.length;)D.push(`${B} IN (${A.slice(C,E+C)})`),C+=E;return D.join(" OR ")}function u(B,A,E,C){return t.apply(this,arguments)}function t(){t=b._asyncToGenerator(function*(B,A,E,C){var D=E.layerId.toString();const {layerInfo:F,queryTask:G,relation:J,relatedFields:I,outStatistics:O}=A;D=y({originRelationship:J,relationships:F.relationships,layerId:D});if(D.relationshipTableId&&
D.keyFieldInRelationshipTable){E=(yield h(B,D,E,C))[B.attributes[E.objectIdField]];if(!E)return null;const P=E.features.map(K=>K.attributes[F.objectIdField]);if(0<(null==O?void 0:O.length)&&F.supportsStatistics)return A=new l,A.where=m(F.objectIdField,P,1E3),A.outFields=I,A.outStatistics=O,A={features:Promise.resolve(E),statsFeatures:G.execute(A)},x.eachAlways(A)}return(D=null==D?void 0:D.keyField)?(E=w.isNumericField(q(F.fields,D)),B=p(B.attributes,J.keyField),D=E?`${D}=${B}`:`${D}='${B}'`,B=G.execute(new l({where:D,
outFields:A.relatedFields}),C),A=A.outStatistics&&0<A.outStatistics.length&&F.supportsStatistics?G.execute(new l({where:D,outFields:A.relatedFields,outStatistics:A.outStatistics}),C):null,C={features:B},A&&(C.statsFeatures=A),x.eachAlways(C)):null});return t.apply(this,arguments)}function q(B,A){if(null!=B){A=A.toLowerCase();for(const E of B)if(E&&E.name.toLowerCase()===A)return E}return null}const z=g.getLogger("esri.widgets.Feature.support.relatedFeatureUtils"),v=new Map;a.createRelatedInfo=function(B,
A){if(B=r(B,A)){var E=`${A.url}/${B.relatedTableId}`;A=new e({url:E,sourceSpatialReference:A.spatialReference});return{url:E,queryTask:A,relation:B,relatedFields:[],outStatistics:[]}}};a.getDestinationRelation=y;a.getRelatedFieldInfo=function(B){if(!k.isRelatedField(B))return null;const [A,E]=B.split("/").slice(1);return{layerId:A,fieldName:E}};a.queryLayerInfos=function({relatedInfos:B,layer:A},E){const C={};B.forEach((D,F)=>{({relation:D}=D);if(!D)throw F=new d("relation-required","A relation is required on a layer to retrieve related records."),
z.error(F),F;({relatedTableId:D}=D);if("number"!==typeof D)throw F=new d("A related table ID is required on a layer to retrieve related records."),z.error(F),F;D=`${A.url}/${D}`;const G=v.get(D),J=G?G:c(D,{query:{f:"json"},signal:E&&E.signal});G||v.set(D,J);C[F]=J});return x.eachAlways(C)};a.queryRelatedFeatures=function({graphic:B,relatedInfos:A,layer:E},C){const D={};A.forEach((F,G)=>{F.layerInfo&&(D[G]=u(B,F,E,C))});return x.eachAlways(D)};a.setRelatedFeatures=function(B,A){if(A&&B){var {features:E,
statsFeatures:C}=B;B=E&&E.value;A.relatedFeatures=B?B.features:[];B=C&&C.value;A.relatedStatsFeatures=B?B.features:[]}};a.updateRelatedInfo=function({relatedInfo:B,fieldName:A,fieldInfo:E}){B.relatedFields.push(A);E.statisticType&&(A=new f({statisticType:E.statisticType,onStatisticField:A,outStatisticFieldName:A}),B.outStatistics.push(A))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/widgets/support/chartUtils":function(){define("require exports ../../chunks/_rollupPluginBabelHelpers ../../intl ../../core/has ../../intl/locale".split(" "),
function(a,b,c,d,g,x){function w(r){if(!r)return"en-us";if(f.has(r.toLowerCase()))return r.toLowerCase();{r=r.split("-")[0].toLowerCase();let p=null;for(y of f.keys())if(y.startsWith(r)){p=y;break}var y=p}return y||"en-us"}function l(){l=c._asyncToGenerator(function*(r=x.getLocale()){r=w(r);if(e&&r===k)return e;e=(new Promise((y,p)=>a(["../../chunks/index"],y,p))).then(y=>y.index);k=r;try{const [y,p]=yield Promise.all([e,f.get(k)()]);k===r&&(y.am4core.options.defaultLocale=p.default);y.am4core.options.suppressWarnings=
!0;y.am4core.options.autoDispose=!0}catch{return k=e=null}return e});return l.apply(this,arguments)}d="#ffffff #858585 #ffbebe #ffebbe #ffebaf #ffffbe #e9ffbe #d3ffbe #beffe8 #bee8ff #bed2ff #e8beff #ffbee8 #ebebeb #707070 #ff7f7f #ffa77f #ffd37f #ffff73 #d1ff73 #a3ff73 #73ffdf #73dfff #73b2ff #df73ff #ff73df #d6d6d6 #5c5c5c #ff0000 #ff5500 #ffaa00 #ffff00 #aaff00 #55ff00 #00ffc5 #00c5ff #0070ff #c500ff #ff00c5 #c2c2c2 #474747 #e60000 #e64c00 #e69800 #e6e600 #98e600 #4ce600 #00e6a9 #00a9e6 #005ce6 #a900e6 #e600a9 #adadad #242424 #a80000 #a83800 #a87000 #a8a800 #70a800 #38a800 #00a884 #0084a8 #004da8 #8400a8 #a80084 #999999 #1a1a1a #730000 #732600 #734c00 #737300 #4c7300 #267300 #00734c #004c73 #002673 #4c0073 #73004".split(" ");
var n=[{name:"default",colors:[].concat(d.slice(30,39),d.slice(28,30).reverse())},{name:"cat-dark",colors:"#ed5151 #149ece #a7c636 #9e559c #fc921f #ffde3e #f789d8 #b7814a #3caf99 #6b6bd6 #b54779 #7f7f7f".split(" ")},{name:"tropical-bliss",colors:"#fce138 #ff9399 #fcd27e #f1983c #a553b7 #b1a9d0 #6ecffc #4c81cd #fc6f84 #fc3e5a #6af689 #48885c".split(" ")},{name:"desert-blooms",colors:"#102432 #144d59 #ffc730 #ed9310 #a64f1b #661510 #d9351a #b31515 #4a0932 #8c213f #18382e #2c6954".split(" ")},{name:"under-the-sea",
colors:"#bf9727 #607100 #00734c #704489 #01acca #024e76 #f09100 #ea311f #c6004b #7570b3 #666666 #333333".split(" ")},{name:"vibrant-rainbow",colors:"#fffb00 #f5cb11 #9fd40c #46e39c #32b8a6 #7ff2fa #ac08cc #dd33ff #eb7200 #e8a784 #bf2e2e #6c7000".split(" ")},{name:"ocean-bay",colors:"#191921 #11495c #78b1c2 #454f4b #8f8f82 #9be0c0 #87b051 #f7ec88 #ebdcc1 #dbb658 #c43541 #75351e".split(" ")},{name:"prairie-summer",colors:"#332424 #751555 #d47013 #d68989 #211173 #82aad6 #7bfaeb #6ec9a8 #6b6408 #eada40 #ccc54a #1fc235".split(" ")},
{name:"pastel-chalk",colors:"#fffd99 #f5e6a4 #c1d48c #b8e3d0 #a0b8b5 #cbf7fa #d791f2 #dfc1eb #f2b983 #e8c4b2 #bf8e8e #94995c".split(" ")},{name:"seq-yellow-orange-red-bright",colors:"#910000 #b1260b #c0370f #e05919 #ef6a1d #ff7b22 #ffa143 #ffb454 #ffda74 #ffed85".split(" ")},{name:"seq-reds-bright",colors:"#57453b #7b4238 #9f4036 #c23d33 #d7483c #ec5244 #f3696c #f9816c #ffc4ae #fff0dc".split(" ")},{name:"seq-purples-bright",colors:"#4e465c #5a4a78 #695291 #775baa #8663c3 #946bdc #aa89e8 #c1a6f3 #d7c4ff #e6e1ff".split(" ")},
{name:"seq-blues-bright",colors:"#404d54 #435c6c #48799d #4b88b6 #4d96ce #50a5e7 #74bbed #98d0f3 #bce6f9 #e6faff".split(" ")},{name:"seq-greens-bright",colors:"#39544c #386757 #368165 #359b73 #33b581 #4bc392 #64d2a2 #7ce0b3 #cbf6d9 #f4ffea".split(" ")},{name:"seq-browns-bright",colors:"#524834 #715b38 #8f6e3c #ae8140 #cc9444 #eba748 #eeb664 #f0c47f #f9e0b7 #fff8eb".split(" ")}];const f=new Map([["ar",()=>(new Promise((r,y)=>a(["../../chunks/ar"],r,y))).then(r=>r.ar)],["bg-bg",()=>(new Promise((r,
y)=>a(["../../chunks/bg_BG"],r,y))).then(r=>r.bg_BG)],["bs-ba",()=>(new Promise((r,y)=>a(["../../chunks/bs_BA"],r,y))).then(r=>r.bs_BA)],["ca-es",()=>(new Promise((r,y)=>a(["../../chunks/ca_ES"],r,y))).then(r=>r.ca_ES)],["cs-cz",()=>(new Promise((r,y)=>a(["../../chunks/cs_CZ"],r,y))).then(r=>r.cs_CZ)],["da-dk",()=>(new Promise((r,y)=>a(["../../chunks/da_DK"],r,y))).then(r=>r.da_DK)],["de-de",()=>(new Promise((r,y)=>a(["../../chunks/de_DE"],r,y))).then(r=>r.de_DE)],["de-ch",()=>(new Promise((r,y)=>
a(["../../chunks/de_CH"],r,y))).then(r=>r.de_CH)],["el-gr",()=>(new Promise((r,y)=>a(["../../chunks/el_GR"],r,y))).then(r=>r.el_GR)],["en-us",()=>(new Promise((r,y)=>a(["../../chunks/en_US"],r,y))).then(r=>r.en_US)],["en-ca",()=>(new Promise((r,y)=>a(["../../chunks/en_CA"],r,y))).then(r=>r.en_CA)],["es-es",()=>(new Promise((r,y)=>a(["../../chunks/es_ES"],r,y))).then(r=>r.es_ES)],["et-ee",()=>(new Promise((r,y)=>a(["../../chunks/et_EE"],r,y))).then(r=>r.et_EE)],["fi-fi",()=>(new Promise((r,y)=>a(["../../chunks/fi_FI"],
r,y))).then(r=>r.fi_FI)],["fr-fr",()=>(new Promise((r,y)=>a(["../../chunks/fr_FR"],r,y))).then(r=>r.fr_FR)],["he-il",()=>(new Promise((r,y)=>a(["../../chunks/he_IL"],r,y))).then(r=>r.he_IL)],["hr-hr",()=>(new Promise((r,y)=>a(["../../chunks/hr_HR"],r,y))).then(r=>r.hr_HR)],["hu-hu",()=>(new Promise((r,y)=>a(["../../chunks/hu_HU"],r,y))).then(r=>r.hu_HU)],["id-id",()=>(new Promise((r,y)=>a(["../../chunks/id_ID"],r,y))).then(r=>r.id_ID)],["it-it",()=>(new Promise((r,y)=>a(["../../chunks/it_IT"],r,y))).then(r=>
r.it_IT)],["ja-jp",()=>(new Promise((r,y)=>a(["../../chunks/ja_JP"],r,y))).then(r=>r.ja_JP)],["ko-kr",()=>(new Promise((r,y)=>a(["../../chunks/ko_KR"],r,y))).then(r=>r.ko_KR)],["lt-lt",()=>(new Promise((r,y)=>a(["../../chunks/lt_LT"],r,y))).then(r=>r.lt_LT)],["lv-lv",()=>(new Promise((r,y)=>a(["../../chunks/lv_LV"],r,y))).then(r=>r.lv_LV)],["nb-no",()=>(new Promise((r,y)=>a(["../../chunks/nb_NO"],r,y))).then(r=>r.nb_NO)],["nl-nl",()=>(new Promise((r,y)=>a(["../../chunks/nl_NL"],r,y))).then(r=>r.nl_NL)],
["pl-pl",()=>(new Promise((r,y)=>a(["../../chunks/pl_PL"],r,y))).then(r=>r.pl_PL)],["pt-br",()=>(new Promise((r,y)=>a(["../../chunks/pt_BR"],r,y))).then(r=>r.pt_BR)],["pt-pt",()=>(new Promise((r,y)=>a(["../../chunks/pt_PT"],r,y))).then(r=>r.pt_PT)],["ro-ro",()=>(new Promise((r,y)=>a(["../../chunks/ro_RO"],r,y))).then(r=>r.ro_RO)],["ru-ru",()=>(new Promise((r,y)=>a(["../../chunks/ru_RU"],r,y))).then(r=>r.ru_RU)],["sk-sk",()=>(new Promise((r,y)=>a(["../../chunks/sk_SK"],r,y))).then(r=>r.sk_SK)],["sl-sl",
()=>(new Promise((r,y)=>a(["../../chunks/sl_SL"],r,y))).then(r=>r.sl_SL)],["sr-rs",()=>(new Promise((r,y)=>a(["../../chunks/sr_RS"],r,y))).then(r=>r.sr_RS)],["sv-se",()=>(new Promise((r,y)=>a(["../../chunks/sv_SE"],r,y))).then(r=>r.sv_SE)],["th-th",()=>(new Promise((r,y)=>a(["../../chunks/th_TH"],r,y))).then(r=>r.th_TH)],["tr-tr",()=>(new Promise((r,y)=>a(["../../chunks/tr_TR"],r,y))).then(r=>r.tr_TR)],["uk-ua",()=>(new Promise((r,y)=>a(["../../chunks/uk_UA"],r,y))).then(r=>r.uk_UA)],["vi-vn",()=>
(new Promise((r,y)=>a(["../../chunks/vi_VN"],r,y))).then(r=>r.vi_VN)],["zh-cn",()=>(new Promise((r,y)=>a(["../../chunks/zh_Hans"],r,y))).then(r=>r.zh_Hans)],["zh-hk",()=>(new Promise((r,y)=>a(["../../chunks/zh_Hant"],r,y))).then(r=>r.zh_Hant)],["zh-tw",()=>(new Promise((r,y)=>a(["../../chunks/zh_Hant"],r,y))).then(r=>r.zh_Hant)]]);let e,k;b.getChartLocale=w;b.getColorSet=function(r,y="default"){const p=n.find(h=>h.name===y);return p?p.colors.map(h=>r.color(h)):null};b.loadChartsModule=function(){return l.apply(this,
arguments)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/widgets/Feature/FeatureExpression/FeatureExpressionViewModel":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../chunks/languageUtils ../../../core/Accessor ../../../core/HandleOwner ../../../core/throttle ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../popup/content/AttachmentsContent ../../../popup/content/Content ../../../popup/content/CustomContent ../../../popup/content/ExpressionContent ../../../popup/content/FieldsContent ../../../popup/content/MediaContent ../../../popup/content/TextContent ../../../popup/ElementExpressionInfo ../FeatureContent/FeatureContentViewModel ../FeatureFields/FeatureFieldsViewModel ../FeatureMedia/FeatureMediaViewModel ../support/arcadeFeatureUtils".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E){g=function(C){function D(F){var G=C.call(this,F)||this;G._abortController=null;G.expressionInfo=null;G.graphic=null;G.contentElement=null;G.contentElementViewModel=null;G.interceptor=null;G.view=null;G._cancelQuery=()=>{const {_abortController:J}=a._assertThisInitialized(G);J&&J.abort();G._abortController=null};G._createVM=()=>{var J,I;const O=null==(J=G.contentElement)?void 0:J.type;null==(I=G.contentElementViewModel)?void 0:I.destroy();
J="fields"===O?new B:"media"===O?new A:"text"===O?new v:null;G._set("contentElementViewModel",J)};G._compile=a._asyncToGenerator(function*(){G._cancelQuery();const J=new AbortController;G._abortController=J;yield G._compileExpression();G._abortController===J&&(G._abortController=null)});G._compileThrottled=w.throttle(G._compile,1,a._assertThisInitialized(G));G._compileExpression=a._asyncToGenerator(function*(){const {expressionInfo:J,graphic:I,interceptor:O,spatialReference:P,map:K,view:M,_abortController:U}=
a._assertThisInitialized(G);if(J&&I&&P&&K){var R=yield E.loadArcadeUtils();if(U===G._abortController)if((R=yield E.createCompiledExpression({arcadeUtils:R,expressionInfo:J,graphic:I,interceptor:O,map:K,spatialReference:P,view:M}))&&"esri.arcade.Dictionary"===R.declaredClass){R=yield d.castAsJsonAsync(R,U.signal);var L=null==R?void 0:R.type;R="media"===L?t.fromJSON(R):"text"===L?q.fromJSON(R):"fields"===L?u.fromJSON(R):null;G._set("contentElement",R)}else G._set("contentElement",null)}else G._set("contentElement",
null)});G.handles.add([l.init(a._assertThisInitialized(G),["expressionInfo","graphic","map","spatialReference","view"],G._compileThrottled),l.init(a._assertThisInitialized(G),"contentElement",G._createVM)]);return G}a._inheritsLoose(D,C);D.prototype.destroy=function(){var F;this._cancelQuery();null==(F=this.contentElementViewModel)?void 0:F.destroy();this._set("contentElementViewModel",null);this._set("contentElement",null)};a._createClass(D,[{key:"spatialReference",get:function(){var F;return(null==
(F=this.view)?void 0:F.spatialReference)||null},set:function(F){void 0===F?this._clearOverride("spatialReference"):this._override("spatialReference",F)}},{key:"state",get:function(){const {_abortController:F,contentElement:G,contentElementViewModel:J}=this;return F?"loading":G||J?"ready":"disabled"}},{key:"map",get:function(){var F;return(null==(F=this.view)?void 0:F.map)||null},set:function(F){void 0===F?this._clearOverride("map"):this._override("map",F)}}]);return D}(x.HandleOwnerMixin(g));b.__decorate([n.property()],
g.prototype,"_abortController",void 0);b.__decorate([n.property({type:z})],g.prototype,"expressionInfo",void 0);b.__decorate([n.property({type:c})],g.prototype,"graphic",void 0);b.__decorate([n.property({readOnly:!0})],g.prototype,"contentElement",void 0);b.__decorate([n.property({readOnly:!0})],g.prototype,"contentElementViewModel",void 0);b.__decorate([n.property()],g.prototype,"interceptor",void 0);b.__decorate([n.property()],g.prototype,"spatialReference",null);b.__decorate([n.property({readOnly:!0})],
g.prototype,"state",null);b.__decorate([n.property()],g.prototype,"map",null);b.__decorate([n.property()],g.prototype,"view",void 0);return g=b.__decorate([r.subclass("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],g)})},"esri/chunks/languageUtils":function(){define("exports ../arcade/FunctionWrapper ../arcade/ImmutableArray ../arcade/ImmutablePathArray ../arcade/ImmutablePointArray ../core/promiseUtils ../geometry/Extent ../geometry/Geometry ../geometry/Multipoint ../geometry/Point ../geometry/Polygon ../geometry/Polyline ./datetime ../core/maybe ../core/number ../geometry/support/coordsUtils ../intl/locale ../arcade/featureset/support/shared".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u){function t(sa,Ca,Ma){return""===Ca||null===Ca||void 0===Ca||Ca===Ma||Ca===Ma?sa:sa=sa.split(Ca).join(Ma)}function q(sa){return sa instanceof Pa||sa instanceof b||sa instanceof ua}function z(sa){return B(sa)||E(sa)||O(sa)||A(sa)||null===sa||sa===Na||"number"===typeof sa?!0:!1}function v(sa,Ca){return void 0===sa?Ca:sa}function B(sa){return"string"===typeof sa||sa instanceof String}function A(sa){return"boolean"===typeof sa}function E(sa){return"number"===
typeof sa}function C(sa){return"number"===typeof sa&&isFinite(sa)&&Math.floor(sa)===sa}function D(sa){return sa instanceof Array}function F(sa){return"esri.arcade.Feature"===(null==sa?void 0:sa.arcadeDeclaredClass)?!0:!1}function G(sa){return!0===(sa&&sa.declaredRootClass&&"esri.arcade.featureset.support.FeatureSet"===sa.declaredRootClass)}function J(sa){return!0===(sa&&sa.declaredRootClass&&"esri.arcade.featureSetCollection"===sa.declaredRootClass)}function I(sa){return sa instanceof c}function O(sa){return sa instanceof
Date}function P(sa,Ca,Ma){if(sa.length<Ca||sa.length>Ma)throw Error("Function called with wrong number of Parameters");}function K(sa){return 0>sa?-Math.round(-sa):Math.round(sa)}function M(){let sa=Date.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(Ca){const Ma=(sa+16*Math.random())%16|0;sa=Math.floor(sa/16);return("x"===Ca?Ma:Ma&3|8).toString(16)})}function U(sa,Ca){if(!1===isNaN(sa)){if(void 0===Ca||null===Ca||""===Ca)return sa.toString();Ca=t(Ca,"\u2030","");Ca=t(Ca,
"\u00a4","");return p.format(sa,{pattern:Ca})}return sa.toString()}function R(sa,Ca){sa=r.DateTime.fromJSDate(sa);return void 0===Ca||null===Ca||""===Ca?sa.toISO({suppressMilliseconds:!0}):sa.toFormat(L(Ca),{locale:m.getLocale(),numberingSystem:"latn"})}function L(sa){sa=sa.replace(/LTS|LT|LL?L?L?|l{1,4}/g,"[$\x26]");let Ca="";const Ma=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;
for(const Xa of sa.match(Ma))switch(Xa){case "D":Ca+="d";break;case "DD":Ca+="dd";break;case "DDD":Ca+="o";break;case "d":Ca+="c";break;case "ddd":Ca+="ccc";break;case "dddd":Ca+="cccc";break;case "M":Ca+="L";break;case "MM":Ca+="LL";break;case "MMM":Ca+="LLL";break;case "MMMM":Ca+="LLLL";break;case "YY":Ca+="yy";break;case "Y":case "YYYY":Ca+="yyyy";break;case "Q":Ca+="q";break;case "Z":Ca+="ZZ";break;case "ZZ":Ca+="ZZZ";break;case "S":Ca+="'S'";break;case "SS":Ca+="'SS'";break;case "SSS":Ca+="u";
break;case "A":case "a":Ca+="a";break;case "m":case "mm":case "h":case "hh":case "H":case "HH":case "s":case "ss":case "X":case "x":Ca+=Xa;break;default:Ca=2<=Xa.length&&"["===Xa.slice(0,1)&&"]"===Xa.slice(-1)?Ca+`'${Xa.slice(1,-1)}'`:Ca+`'${Xa}'`}return Ca}function N(sa,Ca,Ma){switch(Ma){case "\x3e":return sa>Ca;case "\x3c":return sa<Ca;case "\x3e\x3d":return sa>=Ca;case "\x3c\x3d":return sa<=Ca}return!1}function T(sa,Ca,Ma){if(null===sa){if(null===Ca||Ca===Na)return N(null,null,Ma);if(E(Ca))return N(0,
Ca,Ma);if(B(Ca)||A(Ca))return N(0,Y(Ca),Ma);if(O(Ca))return N(0,Ca.getTime(),Ma)}if(sa===Na){if(null===Ca||Ca===Na)return N(null,null,Ma);if(E(Ca))return N(0,Ca,Ma);if(B(Ca)||A(Ca))return N(0,Y(Ca),Ma);if(O(Ca))return N(0,Ca.getTime(),Ma)}else if(E(sa)){if(E(Ca))return N(sa,Ca,Ma);if(A(Ca))return N(sa,Y(Ca),Ma);if(null===Ca||Ca===Na)return N(sa,0,Ma);if(B(Ca))return N(sa,Y(Ca),Ma);if(O(Ca))return N(sa,Ca.getTime(),Ma)}else if(B(sa)){if(B(Ca))return N(H(sa),H(Ca),Ma);if(O(Ca))return N(Y(sa),Ca.getTime(),
Ma);if(E(Ca))return N(Y(sa),Ca,Ma);if(null===Ca||Ca===Na)return N(Y(sa),0,Ma);if(A(Ca))return N(Y(sa),Y(Ca),Ma)}else if(O(sa)){if(O(Ca))return N(sa,Ca,Ma);if(null===Ca||Ca===Na)return N(sa.getTime(),0,Ma);if(E(Ca))return N(sa.getTime(),Ca,Ma);if(A(Ca)||B(Ca))return N(sa.getTime(),Y(Ca),Ma)}else if(A(sa)){if(A(Ca))return N(sa,Ca,Ma);if(E(Ca))return N(Y(sa),Y(Ca),Ma);if(O(Ca))return N(Y(sa),Ca.getTime(),Ma);if(null===Ca||Ca===Na)return N(Y(sa),0,Ma);if(B(Ca))return N(Y(sa),Y(Ca),Ma)}return!S(sa,Ca)||
"\x3c\x3d"!==Ma&&"\x3e\x3d"!==Ma?!1:!0}function S(sa,Ca){if(sa===Ca||null===sa&&Ca===Na||null===Ca&&sa===Na)return!0;if(O(sa)&&O(Ca))return sa.getTime()===Ca.getTime();if(sa instanceof d||sa instanceof g)return sa.equalityTest(Ca);if(sa instanceof f&&Ca instanceof f){const Ma=sa.cache._arcadeCacheId,Xa=Ca.cache._arcadeCacheId;if(void 0!==Ma&&null!==Ma)return Ma===Xa}return void 0!==sa&&void 0!==Ca&&null!==sa&&null!==Ca&&"object"===typeof sa&&"object"===typeof Ca&&(sa._arcadeCacheId===Ca._arcadeCacheId&&
void 0!==sa._arcadeCacheId&&null!==sa._arcadeCacheId||sa._underlyingGraphic===Ca._underlyingGraphic&&void 0!==sa._underlyingGraphic&&null!==sa._underlyingGraphic)?!0:!1}function H(sa,Ca){if(B(sa))return sa;if(null===sa)return"";if(E(sa))return U(sa,Ca);if(A(sa))return sa.toString();if(O(sa))return R(sa,Ca);if(sa instanceof l)return JSON.stringify(sa.toJSON());if(D(sa)){Ca=[];for(var Ma=0;Ma<sa.length;Ma++)Ca[Ma]=V(sa[Ma]);return"["+Ca.join(",")+"]"}if(sa instanceof c){Ca=[];for(Ma=0;Ma<sa.length();Ma++)Ca[Ma]=
V(sa.get(Ma));return"["+Ca.join(",")+"]"}return null!==sa&&"object"===typeof sa&&void 0!==sa.castToText?sa.castToText():q(sa)?"object, Function":""}function Q(sa){const Ca=[];if(!1===D(sa))return null;if(sa instanceof c){for(var Ma=0;Ma<sa.length();Ma++)Ca[Ma]=Y(sa.get(Ma));return Ca}for(Ma=0;Ma<sa.length;Ma++)Ca[Ma]=Y(sa[Ma]);return Ca}function W(sa,Ca){if(B(sa))return sa;if(null===sa)return"";if(E(sa))return U(sa,Ca);if(A(sa))return sa.toString();if(O(sa))return R(sa,Ca);if(sa instanceof l)return sa instanceof
w?'{"xmin":'+sa.xmin.toString()+',"ymin":'+sa.ymin.toString()+","+(sa.hasZ?'"zmin":'+sa.zmin.toString()+",":"")+(sa.hasM?'"mmin":'+sa.mmin.toString()+",":"")+'"xmax":'+sa.xmax.toString()+',"ymax":'+sa.ymax.toString()+","+(sa.hasZ?'"zmax":'+sa.zmax.toString()+",":"")+(sa.hasM?'"mmax":'+sa.mmax.toString()+",":"")+'"spatialReference":'+ja(sa.spatialReference)+"}":ja(sa.toJSON(),(Xa,Va)=>Xa.key===Va.key?0:"spatialReference"===Xa.key?1:"spatialReference"===Va.key||Xa.key<Va.key?-1:Xa.key>Va.key?1:0);if(D(sa)){Ca=
[];for(var Ma=0;Ma<sa.length;Ma++)Ca[Ma]=V(sa[Ma]);return"["+Ca.join(",")+"]"}if(sa instanceof c){Ca=[];for(Ma=0;Ma<sa.length();Ma++)Ca[Ma]=V(sa.get(Ma));return"["+Ca.join(",")+"]"}return null!==sa&&"object"===typeof sa&&void 0!==sa.castToText?sa.castToText():q(sa)?"object, Function":""}function V(sa){return null===sa?"null":A(sa)||E(sa)||B(sa)?JSON.stringify(sa):sa instanceof l||sa instanceof c||sa instanceof Array?W(sa):sa instanceof Date?JSON.stringify(R(sa,"")):null!==sa&&"object"===typeof sa&&
void 0!==sa.castToText?sa.castToText():"null"}function Y(sa,Ca){return E(sa)?sa:null===sa||""===sa?0:O(sa)?NaN:A(sa)?sa?1:0:D(sa)||""===sa||void 0===sa?NaN:void 0!==Ca&&B(sa)?(Ca=t(Ca,"\u2030",""),Ca=t(Ca,"\u00a4",""),p.parse(sa,{pattern:Ca})):sa===Na?0:Number(sa)}function aa(sa){return O(sa)?sa:B(sa)&&(sa=ba(sa))?sa.toJSDate():null}function X(sa){return O(sa)?r.DateTime.fromJSDate(sa):B(sa)?ba(sa):null}function ba(sa){const Ca=/ (\d\d)/;let Ma=r.DateTime.fromISO(sa);return Ma.isValid||Ca.test(sa)&&
(sa=sa.replace(Ca,"T$1"),Ma=r.DateTime.fromISO(sa),Ma.isValid)?Ma:null}function ha(sa){return A(sa)?sa:B(sa)?(sa=sa.toLowerCase(),"true"===sa?!0:!1):E(sa)?0===sa||isNaN(sa)?!1:!0:!1}function ka(sa,Ca){if(y.isNone(sa))return null;if(null===sa.spatialReference||void 0===sa.spatialReference)sa.spatialReference=Ca;return sa}function ia(sa){if(null===sa)return null;if(sa instanceof f)return"NaN"===sa.x||null===sa.x||isNaN(sa.x)?null:sa;if(sa instanceof e){if(0===sa.rings.length)return null;for(const Ca of sa.rings)if(0<
Ca.length)return sa;return null}if(sa instanceof k){if(0===sa.paths.length)return null;for(const Ca of sa.paths)if(0<Ca.length)return sa;return null}return sa instanceof n?0===sa.points.length?null:sa:sa instanceof w?"NaN"===sa.xmin||null===sa.xmin||isNaN(sa.xmin)?null:sa:null}function ea(sa,Ca){if(!sa||!sa.domain)return Ca;let Ma=null;if("string"===sa.field.type||"esriFieldTypeString"===sa.field.type)Ca=H(Ca);else{if(null===Ca||void 0===Ca)return null;if(""===Ca)return Ca;Ca=Y(Ca)}for(let Xa=0;Xa<
sa.domain.codedValues.length;Xa++){const Va=sa.domain.codedValues[Xa];Va.code===Ca&&(Ma=Va)}return null===Ma?Ca:Ma.name}function ca(sa,Ca){if(!sa||!sa.domain)return Ca;let Ma=null;Ca=H(Ca);for(let Xa=0;Xa<sa.domain.codedValues.length;Xa++){const Va=sa.domain.codedValues[Xa];Va.name===Ca&&(Ma=Va)}return null===Ma?Ca:Ma.code}function Z(sa,Ca,Ma=null,Xa=null){if(!Ca||!Ca.fields)return null;let Va=null;for(let qb=0;qb<Ca.fields.length;qb++){const hb=Ca.fields[qb];hb.name.toLowerCase()===sa.toString().toLowerCase()&&
(Va=hb)}if(null===Va)throw Error("Field not found");let eb,fb;null===Xa&&Ma&&Ca.typeIdField&&(Xa=Ma.hasField(Ca.typeIdField)?Ma.field(Ca.typeIdField):null);null!==Xa&&void 0!==Xa&&Ca.types.some(function(qb){return qb.id===Xa?((eb=qb.domains&&qb.domains[Va.name])&&"inherited"===eb.type&&(eb=fa(Va.name,Ca),fb=!0),!0):!1});fb||eb||(eb=fa(sa,Ca));return{field:Va,domain:eb}}function fa(sa,Ca){let Ma;Ca.fields.some(function(Xa){Xa.name.toLowerCase()===sa.toLowerCase()&&(Ma=Xa.domain);return!!Ma});return Ma}
function ja(sa,Ca){Ca||(Ca={});"function"===typeof Ca&&(Ca={cmp:Ca});const Ma="boolean"===typeof Ca.cycles?Ca.cycles:!1,Xa=Ca.cmp&&function(eb){return function(fb){return function(qb,hb){return eb({key:qb,value:fb[qb]},{key:hb,value:fb[hb]})}}}(Ca.cmp),Va=[];return function qb(fb){fb&&fb.toJSON&&"function"===typeof fb.toJSON&&(fb=fb.toJSON());if(void 0!==fb){if("number"===typeof fb)return isFinite(fb)?""+fb:"null";if("object"!==typeof fb)return JSON.stringify(fb);var hb;if(Array.isArray(fb)){var kb=
"[";for(hb=0;hb<fb.length;hb++)hb&&(kb+=","),kb+=qb(fb[hb])||"null";return kb+"]"}if(null===fb)return"null";if(-1!==Va.indexOf(fb)){if(Ma)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON");}var Ab=Va.push(fb)-1,yb=Object.keys(fb).sort(Xa&&Xa(fb));kb="";for(hb=0;hb<yb.length;hb++){const zb=yb[hb],wb=qb(fb[zb]);wb&&(kb&&(kb+=","),kb+=JSON.stringify(zb)+":"+wb)}Va.splice(Ab,1);return"{"+kb+"}"}}(sa)}function la(sa){if(null===sa)return null;const Ca=[];for(const Ma of sa)Ma&&
Ma.arcadeDeclaredClass&&"esri.arcade.Feature"===Ma.arcadeDeclaredClass?Ca.push(Ma.geometry()):Ca.push(Ma);return Ca}function ma(sa,Ca){if(Ca instanceof f)sa.push(Ca.hasZ?Ca.hasM?[Ca.x,Ca.y,Ca.z,Ca.m]:[Ca.x,Ca.y,Ca.z]:[Ca.x,Ca.y]);else throw Error("Invalid Argument");}function ra(sa,Ca){if(D(sa)||I(sa)){let Ma=!1,Xa=!1,Va=[];if(D(sa)){for(const eb of sa)ma(Va,eb);0<Va.length&&(Ca=sa[0].spatialReference,Ma=sa[0].hasZ,Xa=sa[0].hasM)}else if(sa instanceof g)Va=sa._elements,0<Va.length&&(Ma=sa._hasZ,Xa=
sa._hasM,Ca=sa.get(0).spatialReference);else if(I(sa)){for(const eb of sa.toArray())ma(Va,eb);0<Va.length&&(Ca=sa.get(0).spatialReference,Ma=!0===sa.get(0).hasZ,Xa=!0===sa.get(0).hasM)}else throw Error("Invalid Argument");if(0===Va.length)return null;!1===h.isClockwise(Va,Xa,Ma)&&(Va=Va.slice(0).reverse());return new e({rings:[Va],spatialReference:Ca,hasZ:Ma,hasM:Xa})}return sa}function va(sa,Ca){if(D(sa)||I(sa)){let Ma=!1,Xa=!1,Va=[];if(D(sa)){for(const eb of sa)ma(Va,eb);0<Va.length&&(Ca=sa[0].spatialReference,
Ma=!0===sa[0].hasZ,Xa=!0===sa[0].hasM)}else if(sa instanceof g)Va=sa._elements,0<Va.length&&(Ma=sa._hasZ,Xa=sa._hasM,Ca=sa.get(0).spatialReference);else if(I(sa)){for(const eb of sa.toArray())ma(Va,eb);0<Va.length&&(Ca=sa.get(0).spatialReference,Ma=!0===sa.get(0).hasZ,Xa=!0===sa.get(0).hasM)}return 0===Va.length?null:new k({paths:[Va],spatialReference:Ca,hasZ:Ma,hasM:Xa})}return sa}function ya(sa,Ca){if(D(sa)||I(sa)){let Ma=!1,Xa=!1,Va=[];if(D(sa)){for(const eb of sa)ma(Va,eb);0<Va.length&&(Ca=sa[0].spatialReference,
Ma=!0===sa[0].hasZ,Xa=!0===sa[0].hasM)}else if(sa instanceof g)Va=sa._elements,0<Va.length&&(Ma=sa._hasZ,Xa=sa._hasM,Ca=sa.get(0).spatialReference);else if(I(sa)){for(const eb of sa.toArray())ma(Va,eb);0<Va.length&&(Ca=sa.get(0).spatialReference,Ma=!0===sa.get(0).hasZ,Xa=!0===sa.get(0).hasM)}return 0===Va.length?null:new n({points:Va,spatialReference:Ca,hasZ:Ma,hasM:Xa})}return sa}function za(sa,Ca=!1){const Ma=[];if(null===sa)return Ma;if(!0===D(sa)){for(var Xa=0;Xa<sa.length;Xa++){var Va=H(sa[Xa]);
""===Va&&!0!==Ca||Ma.push(Va)}return Ma}if(sa instanceof c){for(Xa=0;Xa<sa.length();Xa++)Va=H(sa.get(Xa)),""===Va&&!0!==Ca||Ma.push(Va);return Ma}return z(sa)?(sa=H(sa),""===sa&&!0!==Ca||Ma.push(sa),Ma):[]}function pa(sa){Ya++;return 0===Ya%100?(Ya=0,x.create(Ca=>{setTimeout(()=>{Ca(sa)},0)})):sa}function wa(sa,Ca,Ma){switch(Ma){case "\x26":return sa&Ca;case "|":return sa|Ca;case "^":return sa^Ca;case "\x3c\x3c":return sa<<Ca;case "\x3e\x3e":return sa>>Ca;case "\x3e\x3e\x3e":return sa>>>Ca}}function na(sa,
Ca=null){if(null!=sa){if(A(sa)||E(sa)||B(sa))return sa;if(sa instanceof l)return!0===(null==Ca?void 0:Ca.keepGeometryType)?sa:sa.toJSON();if(sa instanceof c)return sa.toArray().map(Ma=>na(Ma,Ca));if(sa instanceof Array)return sa.map(Ma=>na(Ma,Ca));if(sa instanceof Date)return sa;if(null!==sa&&"object"===typeof sa&&void 0!==sa.castAsJson)return sa.castAsJson(Ca)}return null}function qa(sa,Ca,Ma,Xa,Va){return ta(sa,Ca,Ma).then(eb=>{Va[Xa]=eb})}function ta(sa,Ca=null,Ma=null){sa instanceof c&&(sa=sa.toArray());
if(null!=sa){if(z(sa)||sa instanceof l||sa instanceof Date)return x.resolve(na(sa,Ma));if(sa instanceof Array){const Xa=[],Va=[];for(const eb of sa)null===eb||z(eb)||eb instanceof l||eb instanceof Date?Va.push(na(eb,Ma)):(Va.push(null),Xa.push(qa(eb,Ca,Ma,Va.length-1,Va)));return 0<Xa.length?x.all(Xa).then(()=>Va):x.resolve(Va)}if(null!==sa&&"object"===typeof sa&&void 0!==sa.castAsJsonAsync)return sa.castAsJsonAsync(Ca,Ma)}return x.resolve(null)}function Fa(sa,Ca,Ma){const Xa=sa.fullSchema();return null!==
Xa&&Xa.fields?Z(Ca,Xa,sa,Ma):null}function Ha(sa){sa=sa.fullSchema();return null!==sa&&sa.fields?sa.typeIdField?{subtypeField:sa.typeIdField,subtypes:sa.types?sa.types.map(Ca=>({name:Ca.name,code:Ca.id})):[]}:null:null}function Ka(sa,Ca,Ma,Xa){const Va=sa.fullSchema();if(null===Va||!Va.fields)return null;Xa=Z(Ca,Va,sa,Xa);if(void 0===Ma)try{Ma=sa.field(Ca)}catch(eb){return null}return ea(Xa,Ma)}function La(sa,Ca,Ma,Xa){const Va=sa.fullSchema();if(null===Va||!Va.fields)return null;if(void 0===Ma){try{Ma=
sa.field(Ca)}catch(eb){return null}return Ma}sa=Z(Ca,Va,sa,Xa);return ca(sa,Ma)}function Ra(sa){sa=sa.fullSchema();if(null===sa||!sa.fields)return null;const Ca=[];for(const Ma of sa.fields)Ca.push(u.esriFieldToJson(Ma));return{objectIdField:sa.objectIdField,globalIdField:sa.globalIdField,geometryType:void 0===u.layerGeometryEsriRestConstants[sa.geometryType]?"":u.layerGeometryEsriRestConstants[sa.geometryType],fields:Ca}}let ab=function(sa){this.value=sa},Za=function(sa){this.value=sa},Pa=function(sa){this.fn=
sa},ua=function(sa,Ca){this.paramCount=Ca;this.fn=sa};const Aa=Pa,Ia=ua,Na={type:"VOID"},Sa={type:"BREAK"},Ua={type:"CONTINUE"};let Ya=0;const $a=Object.freeze({__proto__:null,ReturnResultE:ab,ImplicitResultE:Za,NativeFunctionE:Pa,SizzleFunctionE:ua,NativeFunction:Aa,ImplicitResult:Za,ReturnResult:ab,SizzleFunction:Ia,voidOperation:Na,breakResult:Sa,continueResult:Ua,multiReplace:t,isFunctionParameter:q,isSimpleType:z,defaultUndefined:v,isString:B,isBoolean:A,isNumber:E,isInteger:C,isArray:D,isFeature:F,
isFeatureSet:G,isFeatureSetCollection:J,isImmutableArray:I,isDate:O,pcCheck:P,absRound:K,generateUUID:M,formatNumber:U,formatDate:R,standardiseDateFormat:L,greaterThanLessThan:T,equalityTest:S,toString:H,toNumberArray:Q,toStringExplicit:W,toNumber:Y,toDate:aa,toDateTime:X,toBoolean:ha,fixSpatialReference:ka,fixNullGeometry:ia,getDomainValue:ea,getDomainCode:ca,getDomain:Z,stableStringify:ja,autoCastFeatureToGeometry:la,autoCastArrayOfPointsToPolygon:ra,autoCastArrayOfPointsToPolyline:va,autoCastArrayOfPointsToMultiPoint:ya,
toStringArray:za,tick:pa,binaryOperator:wa,castAsJson:na,castAsJsonAsync:ta,featureFullDomain:Fa,featureSubtypes:Ha,featureDomainValueLookup:Ka,featureDomainCodeLookup:La,featureSchema:Ra});a.ImplicitResult=Za;a.ImplicitResultE=Za;a.NativeFunction=Aa;a.NativeFunctionE=Pa;a.ReturnResult=ab;a.ReturnResultE=ab;a.SizzleFunction=Ia;a.SizzleFunctionE=ua;a.absRound=K;a.autoCastArrayOfPointsToMultiPoint=ya;a.autoCastArrayOfPointsToPolygon=ra;a.autoCastArrayOfPointsToPolyline=va;a.autoCastFeatureToGeometry=
la;a.binaryOperator=wa;a.breakResult=Sa;a.castAsJson=na;a.castAsJsonAsync=ta;a.continueResult=Ua;a.defaultUndefined=v;a.equalityTest=S;a.featureDomainCodeLookup=La;a.featureDomainValueLookup=Ka;a.featureFullDomain=Fa;a.featureSchema=Ra;a.featureSubtypes=Ha;a.fixNullGeometry=ia;a.fixSpatialReference=ka;a.formatDate=R;a.formatNumber=U;a.generateUUID=M;a.getDomain=Z;a.getDomainCode=ca;a.getDomainValue=ea;a.greaterThanLessThan=T;a.isArray=D;a.isBoolean=A;a.isDate=O;a.isFeature=F;a.isFeatureSet=G;a.isFeatureSetCollection=
J;a.isFunctionParameter=q;a.isImmutableArray=I;a.isInteger=C;a.isNumber=E;a.isSimpleType=z;a.isString=B;a.lc=$a;a.multiReplace=t;a.pcCheck=P;a.stableStringify=ja;a.standardiseDateFormat=L;a.tick=pa;a.toBoolean=ha;a.toDate=aa;a.toDateTime=X;a.toNumber=Y;a.toNumberArray=Q;a.toString=H;a.toStringArray=za;a.toStringExplicit=W;a.voidOperation=Na})},"esri/arcade/FunctionWrapper":function(){define(function(){return function(a,b){this.context=this.definition=null;this.definition=a;this.context=b}})},"esri/arcade/ImmutableArray":function(){define(function(){return function(){function a(c=
[]){this._elements=c}var b=a.prototype;b.length=function(){return this._elements.length};b.get=function(c){return this._elements[c]};b.toArray=function(){const c=[];for(let d=0;d<this.length();d++)c.push(this.get(d));return c};return a}()})},"esri/arcade/ImmutablePathArray":function(){define(["../chunks/_rollupPluginBabelHelpers","./ImmutableArray","./ImmutablePointArray"],function(a,b,c){return function(d){function g(w,l,n,f,e){w=d.call(this,w)||this;w._lazyPath=[];w._hasZ=!1;w._hasM=!1;w._hasZ=
n;w._hasM=f;w._spRef=l;w._cacheId=e;return w}a._inheritsLoose(g,d);var x=g.prototype;x.get=function(w){if(void 0===this._lazyPath[w]){const l=this._elements[w];if(void 0===l)return;this._lazyPath[w]=new c(l,this._spRef,this._hasZ,this._hasM,this._cacheId,w)}return this._lazyPath[w]};x.equalityTest=function(w){return w===this?!0:null===w||!1===w instanceof g?!1:w.getUniqueHash()===this.getUniqueHash()};x.getUniqueHash=function(){return this._cacheId.toString()};return g}(b)})},"esri/arcade/ImmutablePointArray":function(){define(["../chunks/_rollupPluginBabelHelpers",
"./ImmutableArray","../geometry/Point"],function(a,b,c){return function(d){function g(w,l,n,f,e,k){w=d.call(this,w)||this;w._lazyPt=[];w._hasZ=!1;w._hasM=!1;w._spRef=l;w._hasZ=n;w._hasM=f;w._cacheId=e;w._partId=k;return w}a._inheritsLoose(g,d);var x=g.prototype;x.get=function(w){if(void 0===this._lazyPt[w]){const l=this._elements[w];if(void 0===l)return;const n=this._hasZ,f=this._hasM;let e=null;e=n&&!f?new c(l[0],l[1],l[2],void 0,this._spRef):f&&!n?new c(l[0],l[1],void 0,l[2],this._spRef):n&&f?new c(l[0],
l[1],l[2],l[3],this._spRef):new c(l[0],l[1],this._spRef);e.cache._arcadeCacheId=this._cacheId.toString()+"-"+this._partId.toString()+"-"+w.toString();this._lazyPt[w]=e}return this._lazyPt[w]};x.equalityTest=function(w){return w===this?!0:null===w||!1===w instanceof g?!1:w.getUniqueHash()===this.getUniqueHash()};x.getUniqueHash=function(){return this._cacheId.toString()+"-"+this._partId.toString()};return g}(b)})},"esri/chunks/datetime":function(){define(["exports"],function(a){function b(da){return"undefined"===
typeof da}function c(da){return"number"===typeof da}function d(da){return"number"===typeof da&&0===da%1}function g(){try{return"undefined"!==typeof Intl&&!!Intl.RelativeTimeFormat}catch(da){return!1}}function x(da,oa,xa){if(0!==da.length)return da.reduce((Ba,Ga)=>{Ga=[oa(Ga),Ga];return Ba?xa(Ba[0],Ga[0])===Ba[0]?Ba:Ga:Ga},null)[1]}function w(da,oa){return oa.reduce((xa,Ba)=>{xa[Ba]=da[Ba];return xa},{})}function l(da,oa){return Object.prototype.hasOwnProperty.call(da,oa)}function n(da,oa,xa){return d(da)&&
da>=oa&&da<=xa}function f(da,oa=2){return 0>da?"-"+(""+-da).padStart(oa,"0"):(""+da).padStart(oa,"0")}function e(da){if(!b(da)&&null!==da&&""!==da)return parseInt(da,10)}function k(da){if(!b(da)&&null!==da&&""!==da)return parseFloat(da)}function r(da){if(!b(da)&&null!==da&&""!==da)return da=1E3*parseFloat("0."+da),Math.floor(da)}function y(da,oa,xa=!1){oa=10**oa;return(xa?Math.trunc:Math.round)(da*oa)/oa}function p(da){return 0===da%4&&(0!==da%100||0===da%400)}function h(da,oa){var xa=oa-1;xa=xa-
12*Math.floor(xa/12)+1;return 2===xa?p(da+(oa-xa)/12)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][xa-1]}function m(da){let oa=Date.UTC(da.year,da.month-1,da.day,da.hour,da.minute,da.second,da.millisecond);100>da.year&&0<=da.year&&(oa=new Date(oa),oa.setUTCFullYear(oa.getUTCFullYear()-1900));return+oa}function u(da){var oa=da-1;oa=(oa+Math.floor(oa/4)-Math.floor(oa/100)+Math.floor(oa/400))%7;return 4===(da+Math.floor(da/4)-Math.floor(da/100)+Math.floor(da/400))%7||3===oa?53:52}function t(da){return 99<
da?da:60<da?1900+da:2E3+da}function q(da,oa,xa,Ba=null){da=new Date(da);const Ga={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};Ba&&(Ga.timeZone=Ba);return(oa=(new Intl.DateTimeFormat(xa,{timeZoneName:oa,...Ga})).formatToParts(da).find(Ja=>"timezonename"===Ja.type.toLowerCase()))?oa.value:null}function z(da,oa){da=parseInt(da,10);Number.isNaN(da)&&(da=0);oa=parseInt(oa,10)||0;oa=0>da||Object.is(da,-0)?-oa:oa;return 60*da+oa}function v(da){const oa=Number(da);
if("boolean"===typeof da||""===da||Number.isNaN(oa))throw new Oa(`Invalid unit value ${da}`);return oa}function B(da,oa){const xa={};for(const Ba in da)if(l(da,Ba)){const Ga=da[Ba];void 0!==Ga&&null!==Ga&&(xa[oa(Ba)]=v(Ga))}return xa}function A(da,oa){const xa=Math.trunc(Math.abs(da/60)),Ba=Math.trunc(Math.abs(da%60));da=0<=da?"+":"-";switch(oa){case "short":return`${da}${f(xa,2)}:${f(Ba,2)}`;case "narrow":return`${da}${xa}${0<Ba?`:${Ba}`:""}`;case "techie":return`${da}${f(xa,2)}${f(Ba,2)}`;default:throw new RangeError(`Value format ${oa} is out of range for property format`);
}}function E(da){return w(da,["hour","minute","second","millisecond"])}function C(da){switch(da){case "narrow":return[...Kc];case "short":return[...$b];case "long":return[...Lc];case "numeric":return"1 2 3 4 5 6 7 8 9 10 11 12".split(" ");case "2-digit":return"01 02 03 04 05 06 07 08 09 10 11 12".split(" ");default:return null}}function D(da){switch(da){case "narrow":return[...Mc];case "short":return[...ac];case "long":return[...bc];case "numeric":return"1234567".split("");default:return null}}function F(da){switch(da){case "narrow":return[...Nc];
case "short":return[...Oc];case "long":return[...Pc];default:return null}}function G(da,oa,xa="always",Ba=!1){const Ga={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]};var Ja=-1===["hours","minutes","seconds"].indexOf(da);if("auto"===xa&&Ja)switch(xa="days"===da,oa){case 1:return xa?"tomorrow":`next ${Ga[da][0]}`;case -1:return xa?"yesterday":`last ${Ga[da][0]}`;
case 0:return xa?"today":`this ${Ga[da][0]}`}xa=Object.is(oa,-0)||0>oa;oa=Math.abs(oa);Ja=1===oa;const Qa=Ga[da];da=Ba?Ja?Qa[1]:Qa[2]||Qa[1]:Ja?Ga[da][0]:da;return xa?`${oa} ${da} ago`:`in ${oa} ${da}`}function J(da,oa){let xa="";for(const Ba of da)xa=Ba.literal?xa+Ba.val:xa+oa(Ba.val);return xa}function I(da,oa){if(b(da)||null===da)return oa;if(da instanceof Ib)return da;if("string"===typeof da){const xa=da.toLowerCase();return"local"===xa||"system"===xa?oa:"utc"===xa||"gmt"===xa?vb.utcInstance:
vb.parseSpecifier(xa)||Fb.create(da)}return c(da)?vb.instance(da):"object"===typeof da&&da.offset&&"number"===typeof da.offset?da:new Qc(da)}function O(da,oa={}){const xa=JSON.stringify([da,oa]);let Ba=cc[xa];Ba||(Ba=new Intl.ListFormat(da,oa),cc[xa]=Ba);return Ba}function P(da,oa={}){const xa=JSON.stringify([da,oa]);let Ba=Ob[xa];Ba||(Ba=new Intl.DateTimeFormat(da,oa),Ob[xa]=Ba);return Ba}function K(da,oa={}){const xa=JSON.stringify([da,oa]);let Ba=Pb[xa];Ba||(Ba=new Intl.NumberFormat(da,oa),Pb[xa]=
Ba);return Ba}function M(da,oa={}){const {base:xa,...Ba}=oa,Ga=JSON.stringify([da,Ba]);let Ja=Qb[Ga];Ja||(Ja=new Intl.RelativeTimeFormat(da,oa),Qb[Ga]=Ja);return Ja}function U(da){const oa=[];for(let xa=1;12>=xa;xa++){const Ba=jb.utc(2016,xa,1);oa.push(da(Ba))}return oa}function R(da){const oa=[];for(let xa=1;7>=xa;xa++){const Ba=jb.utc(2016,11,13+xa);oa.push(da(Ba))}return oa}function L(da,oa,xa,Ba,Ga){da=da.listingMode(xa);return"error"===da?null:"en"===da?Ba(oa):Ga(oa)}function N(...da){da=da.reduce((oa,
xa)=>oa+xa.source,"");return RegExp(`^${da}$`)}function T(...da){return oa=>da.reduce(([xa,Ba,Ga],Ja)=>{const [Qa,Wa,db]=Ja(oa,Ga);return[{...xa,...Qa},Ba||Wa,db]},[{},null,1]).slice(0,2)}function S(da,...oa){if(null==da)return[null,null];for(const [xa,Ba]of oa)if(oa=xa.exec(da))return Ba(oa);return[null,null]}function H(...da){return(oa,xa)=>{const Ba={};let Ga;for(Ga=0;Ga<da.length;Ga++)Ba[da[Ga]]=e(oa[xa+Ga]);return[Ba,null,xa+Ga]}}function Q(da,oa,xa){da=da[oa];return b(da)?xa:e(da)}function W(da,
oa){return[{year:Q(da,oa),month:Q(da,oa+1,1),day:Q(da,oa+2,1)},null,oa+3]}function V(da,oa){return[{hours:Q(da,oa,0),minutes:Q(da,oa+1,0),seconds:Q(da,oa+2,0),milliseconds:r(da[oa+3])},null,oa+4]}function Y(da,oa){const xa=!da[oa]&&!da[oa+1];da=z(da[oa+1],da[oa+2]);return[{},xa?null:vb.instance(da),oa+3]}function aa(da,oa){return[{},da[oa]?Fb.create(da[oa]):null,oa+1]}function X(da){const [oa,xa,Ba,Ga,Ja,Qa,Wa,db,ob]=da,gb="-"===oa[0];da=db&&"-"===db[0];const lb=(pb,Db=!1)=>void 0!==pb&&(Db||pb&&
gb)?-pb:pb;return[{years:lb(k(xa)),months:lb(k(Ba)),weeks:lb(k(Ga)),days:lb(k(Ja)),hours:lb(k(Qa)),minutes:lb(k(Wa)),seconds:lb(k(db),"-0"===db),milliseconds:lb(r(ob),da)}]}function ba(da,oa,xa,Ba,Ga,Ja,Qa){oa={year:2===oa.length?t(e(oa)):e(oa),month:$b.indexOf(xa)+1,day:e(Ba),hour:e(Ga),minute:e(Ja)};Qa&&(oa.second=e(Qa));da&&(oa.weekday=3<da.length?bc.indexOf(da)+1:ac.indexOf(da)+1);return oa}function ha(da){const [,oa,xa,Ba,Ga,Ja,Qa,Wa,db,ob,gb,lb]=da;da=ba(oa,Ga,Ba,xa,Ja,Qa,Wa);let pb;pb=db?Rc[db]:
ob?0:z(gb,lb);return[da,new vb(pb)]}function ka(da){const [,oa,xa,Ba,Ga,Ja,Qa,Wa]=da;return[ba(oa,Ga,Ba,xa,Ja,Qa,Wa),vb.utcInstance]}function ia(da){const [,oa,xa,Ba,Ga,Ja,Qa,Wa]=da;return[ba(oa,Wa,xa,Ba,Ga,Ja,Qa),vb.utcInstance]}function ea(da,oa,xa=!1){da={values:xa?oa.values:{...da.values,...oa.values||{}},loc:da.loc.clone(oa.loc),conversionAccuracy:oa.conversionAccuracy||da.conversionAccuracy};return new nb(da)}function ca(da,oa,xa,Ba,Ga){da=da[Ga][xa];var Ja=oa[xa]/da;Ja=Math.sign(Ja)!==Math.sign(Ba[Ga])&&
0!==Ba[Ga]&&1>=Math.abs(Ja)?0>Ja?Math.floor(Ja):Math.ceil(Ja):Math.trunc(Ja);Ba[Ga]+=Ja;oa[xa]-=Ja*da}function Z(da,oa){Sc.reduce((xa,Ba)=>{if(b(oa[Ba]))return xa;xa&&ca(da,oa,xa,oa,Ba);return Ba},null)}function fa(da,oa){da=oa.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf()-da.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf();return Math.floor(nb.fromMillis(da).as("days"))}function ja(da,oa,xa){var Ba=[["years",(Wa,db)=>db.year-Wa.year],["quarters",(Wa,db)=>db.quarter-Wa.quarter],["months",
(Wa,db)=>db.month-Wa.month+12*(db.year-Wa.year)],["weeks",(Wa,db)=>{Wa=fa(Wa,db);return(Wa-Wa%7)/7}],["days",fa]];const Ga={};let Ja,Qa;for(const [Wa,db]of Ba)0<=xa.indexOf(Wa)&&(Ja=Wa,Ba=db(da,oa),Qa=da.plus({[Wa]:Ba}),Qa>oa?(da=da.plus({[Wa]:Ba-1}),--Ba):da=Qa,Ga[Wa]=Ba);return[da,Ga,Qa,Ja]}function la(da,oa,xa,Ba){let [Ga,Ja,Qa,Wa]=ja(da,oa,xa);da=oa-Ga;xa=xa.filter(db=>0<=["hours","minutes","seconds","milliseconds"].indexOf(db));0===xa.length&&(Qa<oa&&(Qa=Ga.plus({[Wa]:1})),Qa!==Ga&&(Ja[Wa]=(Ja[Wa]||
0)+da/(Qa-Ga)));oa=nb.fromObject(Ja,Ba);return 0<xa.length?nb.fromMillis(da,Ba).shiftTo(...xa).plus(oa):oa}function ma({numberingSystem:da},oa=""){return new RegExp(`${Rb[da||"latn"]}${oa}`)}function ra(da,oa=xa=>xa){return{regex:da,deser:([xa])=>{{let Ba=parseInt(xa,10);if(isNaN(Ba)){Ba="";for(let Ga=0;Ga<xa.length;Ga++){const Ja=xa.charCodeAt(Ga);if(-1!==xa[Ga].search(Rb.hanidec))Ba+=Tc.indexOf(xa[Ga]);else for(const Qa in dc){const [Wa,db]=dc[Qa];Ja>=Wa&&Ja<=db&&(Ba+=Ja-Wa)}}xa=parseInt(Ba,10)}else xa=
Ba}return oa(xa)}}}function va(da){return da.replace(/\./g,"\\.?").replace(Sb,ec)}function ya(da,oa){return null===da?null:{regex:RegExp(da.map(va).join("|")),deser:([xa])=>da.findIndex(Ba=>xa.replace(/\./g,"").replace(Sb," ").toLowerCase()===Ba.replace(/\./g,"").replace(Sb," ").toLowerCase())+oa}}function za(da,oa){return{regex:da,deser:([,xa,Ba])=>z(xa,Ba),groups:oa}}function pa(da){return{regex:da,deser:([oa])=>oa}}function wa(da,oa){const xa=ma(oa),Ba=ma(oa,"{2}"),Ga=ma(oa,"{3}"),Ja=ma(oa,"{4}"),
Qa=ma(oa,"{6}"),Wa=ma(oa,"{1,2}"),db=ma(oa,"{1,3}"),ob=ma(oa,"{1,6}"),gb=ma(oa,"{1,9}"),lb=ma(oa,"{2,4}"),pb=ma(oa,"{4,6}"),Db=Jb=>({regex:RegExp(Jb.val.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$\x26")),deser:([Uc])=>Uc,literal:!0}),Hb=(Jb=>{if(da.literal)return Db(Jb);switch(Jb.val){case "G":return ya(oa.eras("short",!1),0);case "GG":return ya(oa.eras("long",!1),0);case "y":return ra(ob);case "yy":return ra(lb,t);case "yyyy":return ra(Ja);case "yyyyy":return ra(pb);case "yyyyyy":return ra(Qa);case "M":return ra(Wa);
case "MM":return ra(Ba);case "MMM":return ya(oa.months("short",!0,!1),1);case "MMMM":return ya(oa.months("long",!0,!1),1);case "L":return ra(Wa);case "LL":return ra(Ba);case "LLL":return ya(oa.months("short",!1,!1),1);case "LLLL":return ya(oa.months("long",!1,!1),1);case "d":return ra(Wa);case "dd":return ra(Ba);case "o":return ra(db);case "ooo":return ra(Ga);case "HH":return ra(Ba);case "H":return ra(Wa);case "hh":return ra(Ba);case "h":return ra(Wa);case "mm":return ra(Ba);case "m":return ra(Wa);
case "q":return ra(Wa);case "qq":return ra(Ba);case "s":return ra(Wa);case "ss":return ra(Ba);case "S":return ra(db);case "SSS":return ra(Ga);case "u":return pa(gb);case "uu":return pa(Wa);case "uuu":return ra(xa);case "a":return ya(oa.meridiems(),0);case "kkkk":return ra(Ja);case "kk":return ra(lb,t);case "W":return ra(Wa);case "WW":return ra(Ba);case "E":case "c":return ra(xa);case "EEE":return ya(oa.weekdays("short",!1,!1),1);case "EEEE":return ya(oa.weekdays("long",!1,!1),1);case "ccc":return ya(oa.weekdays("short",
!0,!1),1);case "cccc":return ya(oa.weekdays("long",!0,!1),1);case "Z":case "ZZ":return za(new RegExp(`([+-]${Wa.source})(?::(${Ba.source}))?`),2);case "ZZZ":return za(new RegExp(`([+-]${Wa.source})(${Ba.source})?`),2);case "z":return pa(/[a-z_+-/]{1,256}?/i);default:return Db(Jb)}})(da)||{invalidReason:"missing Intl.DateTimeFormat.formatToParts support"};Hb.token=da;return Hb}function na(da){return[`^${da.map(oa=>oa.regex).reduce((oa,xa)=>`${oa}(${xa.source})`,"")}$`,da]}function qa(da,oa,xa){if(da=
da.match(oa)){oa={};let Ba=1;for(const Ga in xa)if(l(xa,Ga)){const Ja=xa[Ga],Qa=Ja.groups?Ja.groups+1:1;!Ja.literal&&Ja.token&&(oa[Ja.token.val[0]]=Ja.deser(da.slice(Ba,Ba+Qa)));Ba+=Qa}return[da,oa]}return[da,{}]}function ta(da){const oa=Ga=>{switch(Ga){case "S":return"millisecond";case "s":return"second";case "m":return"minute";case "h":case "H":return"hour";case "d":return"day";case "o":return"ordinal";case "L":case "M":return"month";case "y":return"year";case "E":case "c":return"weekday";case "W":return"weekNumber";
case "k":return"weekYear";case "q":return"quarter";default:return null}};let xa=null,Ba;b(da.z)||(xa=Fb.create(da.z));b(da.Z)||(xa||(xa=new vb(da.Z)),Ba=da.Z);b(da.q)||(da.M=3*(da.q-1)+1);b(da.h)||(12>da.h&&1===da.a?da.h+=12:12===da.h&&0===da.a&&(da.h=0));0===da.G&&da.y&&(da.y=-da.y);b(da.u)||(da.S=r(da.u));return[Object.keys(da).reduce((Ga,Ja)=>{const Qa=oa(Ja);Qa&&(Ga[Qa]=da[Ja]);return Ga},{}),xa,Ba]}function Fa(){Tb||(Tb=jb.fromMillis(1555555555555));return Tb}function Ha(da,oa){if(da.literal)return da;
const xa=xb.macroTokenToFormatOpts(da.val);if(!xa)return da;oa=xb.create(oa,xa).formatDateTimeParts(Fa()).map(Ba=>{{const {type:Ja,value:Qa}=Ba;if("literal"===Ja)Ba={literal:!0,val:Qa};else{Ba=xa[Ja];var Ga=Vc[Ja];"object"===typeof Ga&&(Ga=Ga[Ba]);Ba=Ga?{literal:!1,val:Ga}:void 0}}return Ba});return oa.includes(void 0)?da:oa}function Ka(da,oa){return Array.prototype.concat(...da.map(xa=>Ha(xa,oa)))}function La(da,oa,xa){xa=Ka(xb.parseFormat(xa),da);var Ba=xa.map(Ja=>wa(Ja,da));const Ga=Ba.find(Ja=>
Ja.invalidReason);if(Ga)return{input:oa,tokens:xa,invalidReason:Ga.invalidReason};{const [Ja,Qa]=na(Ba);Ba=RegExp(Ja,"i");const [Wa,db]=qa(oa,Ba,Qa),[ob,gb,lb]=db?ta(db):[null,null,void 0];if(l(db,"a")&&l(db,"H"))throw new Ea("Can't include meridiem when specifying 24-hour format");return{input:oa,tokens:xa,regex:Ba,rawMatches:Wa,matches:db,result:ob,zone:gb,specificOffset:lb}}}function Ra(da,oa){return new Cb("unit out of range",`you specified ${oa} (of type ${typeof oa}) as a ${da}, which is invalid`)}
function ab(da,oa,xa){da=(new Date(Date.UTC(da,oa-1,xa))).getUTCDay();return 0===da?7:da}function Za(da,oa){da=p(da)?Ub:Vb;const xa=da.findIndex(Ba=>Ba<oa);return{month:xa+1,day:oa-da[xa]}}function Pa(da){const {year:oa,month:xa,day:Ba}=da;var Ga=Ba+(p(oa)?Ub:Vb)[xa-1];const Ja=ab(oa,xa,Ba);Ga=Math.floor((Ga-Ja+10)/7);let Qa;1>Ga?(Qa=oa-1,Ga=u(Qa)):Ga>u(oa)?(Qa=oa+1,Ga=1):Qa=oa;return{weekYear:Qa,weekNumber:Ga,weekday:Ja,...E(da)}}function ua(da){const {weekYear:oa,weekNumber:xa,weekday:Ba}=da;var Ga=
ab(oa,1,4),Ja=p(oa)?366:365;Ga=7*xa+Ba-Ga-3;1>Ga?(Ja=oa-1,Ga+=p(Ja)?366:365):Ga>Ja?(Ja=oa+1,Ga-=p(oa)?366:365):Ja=oa;const {month:Qa,day:Wa}=Za(Ja,Ga);return{year:Ja,month:Qa,day:Wa,...E(da)}}function Aa(da){const {year:oa,month:xa,day:Ba}=da;var Ga=Ba+(p(oa)?Ub:Vb)[xa-1];return{year:oa,ordinal:Ga,...E(da)}}function Ia(da){const {year:oa,ordinal:xa}=da,{month:Ba,day:Ga}=Za(oa,xa);return{year:oa,month:Ba,day:Ga,...E(da)}}function Na(da){const oa=d(da.year),xa=n(da.month,1,12),Ba=n(da.day,1,h(da.year,
da.month));return oa?xa?Ba?!1:Ra("day",da.day):Ra("month",da.month):Ra("year",da.year)}function Sa(da){const {hour:oa,minute:xa,second:Ba,millisecond:Ga}=da;da=n(oa,0,23)||24===oa&&0===xa&&0===Ba&&0===Ga;const Ja=n(xa,0,59),Qa=n(Ba,0,59),Wa=n(Ga,0,999);return da?Ja?Qa?Wa?!1:Ra("millisecond",Ga):Ra("second",Ba):Ra("minute",xa):Ra("hour",oa)}function Ua(da){return new Cb("unsupported zone",`the zone "${da.name}" is not supported`)}function Ya(da){null===da.weekData&&(da.weekData=Pa(da.c));return da.weekData}
function $a(da,oa){da={ts:da.ts,zone:da.zone,c:da.c,o:da.o,loc:da.loc,invalid:da.invalid};return new jb({...da,...oa,old:da})}function sa(da,oa,xa){let Ba=da-6E4*oa;const Ga=xa.offset(Ba);if(oa===Ga)return[Ba,oa];Ba-=6E4*(Ga-oa);oa=xa.offset(Ba);return Ga===oa?[Ba,Ga]:[da-6E4*Math.min(Ga,oa),Math.max(Ga,oa)]}function Ca(da,oa){da=new Date(da+6E4*oa);return{year:da.getUTCFullYear(),month:da.getUTCMonth()+1,day:da.getUTCDate(),hour:da.getUTCHours(),minute:da.getUTCMinutes(),second:da.getUTCSeconds(),
millisecond:da.getUTCMilliseconds()}}function Ma(da,oa,xa){return sa(m(da),oa,xa)}function Xa(da,oa){const xa=da.o;var Ba=da.c.year+Math.trunc(oa.years);const Ga=da.c.month+Math.trunc(oa.months)+3*Math.trunc(oa.quarters);Ba={...da.c,year:Ba,month:Ga,day:Math.min(da.c.day,h(Ba,Ga))+Math.trunc(oa.days)+7*Math.trunc(oa.weeks)};oa=nb.fromObject({years:oa.years-Math.trunc(oa.years),quarters:oa.quarters-Math.trunc(oa.quarters),months:oa.months-Math.trunc(oa.months),weeks:oa.weeks-Math.trunc(oa.weeks),days:oa.days-
Math.trunc(oa.days),hours:oa.hours,minutes:oa.minutes,seconds:oa.seconds,milliseconds:oa.milliseconds}).as("milliseconds");Ba=m(Ba);let [Ja,Qa]=sa(Ba,xa,da.zone);0!==oa&&(Ja+=oa,Qa=da.zone.offset(Ja));return{ts:Ja,o:Qa}}function Va(da,oa,xa,Ba,Ga,Ja){const {setZone:Qa,zone:Wa}=xa;return da&&0!==Object.keys(da).length?(da=jb.fromObject(da,{...xa,zone:oa||Wa,specificOffset:Ja}),Qa?da:da.setZone(Wa)):jb.invalid(new Cb("unparsable",`the input "${Ga}" can't be parsed as ${Ba}`))}function eb(da,oa,xa=!0){return da.isValid?
xb.create(sb.create("en-US"),{allowZ:xa,forceSimple:!0}).formatDateTimeFromString(da,oa):null}function fb(da,oa){const xa=9999<da.c.year||0>da.c.year;let Ba="";xa&&0<=da.c.year&&(Ba+="+");Ba+=f(da.c.year,xa?6:4);oa?(Ba=Ba+"-"+f(da.c.month),Ba=Ba+"-"+f(da.c.day)):(Ba+=f(da.c.month),Ba+=f(da.c.day));return Ba}function qb(da,oa,xa,Ba,Ga){let Ja=f(da.c.hour);oa?(Ja=Ja+":"+f(da.c.minute),0===da.c.second&&xa||(Ja+=":")):Ja+=f(da.c.minute);0===da.c.second&&xa||(Ja+=f(da.c.second),0===da.c.millisecond&&Ba||
(Ja=Ja+"."+f(da.c.millisecond,3)));Ga&&(da.isOffsetFixed&&0===da.offset?Ja+="Z":0>da.o?(Ja=Ja+"-"+f(Math.trunc(-da.o/60)),Ja=Ja+":"+f(Math.trunc(-da.o%60))):(Ja=Ja+"+"+f(Math.trunc(da.o/60)),Ja=Ja+":"+f(Math.trunc(da.o%60))));return Ja}function hb(da){const oa={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",
weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[da.toLowerCase()];if(!oa)throw new Da(da);return oa}function kb(da,oa){const xa=I(oa.zone,ub.defaultZone);oa=sb.fromObject(oa);const Ba=ub.now();var Ga;if(b(da.year))da=Ba;else{for(const Ja of fc)b(da[Ja])&&(da[Ja]=gc[Ja]);if(Ga=Na(da)||Sa(da))return jb.invalid(Ga);Ga=xa.offset(Ba);[da,Ga]=Ma(da,Ga,xa)}return new jb({ts:da,zone:xa,
loc:oa,o:Ga})}function Ab(da,oa,xa){const Ba=b(xa.round)?!0:xa.round,Ga=(Qa,Wa)=>{Qa=y(Qa,Ba||xa.calendary?0:2,!0);return oa.loc.clone(xa).relFormatter(xa).format(Qa,Wa)},Ja=Qa=>xa.calendary?oa.hasSame(da,Qa)?0:oa.startOf(Qa).diff(da.startOf(Qa),Qa).get(Qa):oa.diff(da,Qa).get(Qa);if(xa.unit)return Ga(Ja(xa.unit),xa.unit);for(const Qa of xa.units){const Wa=Ja(Qa);if(1<=Math.abs(Wa))return Ga(Wa,Qa)}return Ga(da>oa?-0:0,xa.units[xa.units.length-1])}function yb(da){let oa={};0<da.length&&"object"===
typeof da[da.length-1]?(oa=da[da.length-1],da=Array.from(da).slice(0,da.length-1)):da=Array.from(da);return[oa,da]}function zb(da){if(jb.isDateTime(da))return da;if(da&&da.valueOf&&c(da.valueOf()))return jb.fromJSDate(da);if(da&&"object"===typeof da)return jb.fromObject(da);throw new Oa(`Unknown datetime argument: ${da}, of type ${typeof da}`);}class wb extends Error{}class rb extends wb{constructor(da){super(`Invalid DateTime: ${da.toMessage()}`)}}class Bb extends wb{constructor(da){super(`Invalid Interval: ${da.toMessage()}`)}}
class cb extends wb{constructor(da){super(`Invalid Duration: ${da.toMessage()}`)}}class Ea extends wb{}class Da extends wb{constructor(da){super(`Invalid unit ${da}`)}}class Oa extends wb{}class Ta extends wb{constructor(){super("Zone is an abstract class")}}const bb={year:"numeric",month:"numeric",day:"numeric"},ib={year:"numeric",month:"short",day:"numeric"},mb={year:"numeric",month:"short",day:"numeric",weekday:"short"},Eb={year:"numeric",month:"long",day:"numeric"},hc={year:"numeric",month:"long",
day:"numeric",weekday:"long"},ic={hour:"numeric",minute:"numeric"},jc={hour:"numeric",minute:"numeric",second:"numeric"},kc={hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"},lc={hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"long"},mc={hour:"numeric",minute:"numeric",hourCycle:"h23"},nc={hour:"numeric",minute:"numeric",second:"numeric",hourCycle:"h23"},oc={hour:"numeric",minute:"numeric",second:"numeric",hourCycle:"h23",timeZoneName:"short"},pc={hour:"numeric",
minute:"numeric",second:"numeric",hourCycle:"h23",timeZoneName:"long"},qc={year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric"},rc={year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"},sc={year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"},tc={year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"},Wc={year:"numeric",month:"short",day:"numeric",weekday:"short",hour:"numeric",
minute:"numeric"},uc={year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",timeZoneName:"short"},vc={year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"},wc={year:"numeric",month:"long",day:"numeric",weekday:"long",hour:"numeric",minute:"numeric",timeZoneName:"long"},xc={year:"numeric",month:"long",day:"numeric",weekday:"long",hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"long"},Lc="January February March April May June July August September October November December".split(" "),
$b="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),Kc="JFMAMJJASOND".split(""),bc="Monday Tuesday Wednesday Thursday Friday Saturday Sunday".split(" "),ac="Mon Tue Wed Thu Fri Sat Sun".split(" "),Mc="MTWTFSS".split(""),yc=["AM","PM"],Pc=["Before Christ","Anno Domini"],Oc=["BC","AD"],Nc=["B","A"],Xc={D:bb,DD:ib,DDD:Eb,DDDD:hc,t:ic,tt:jc,ttt:kc,tttt:lc,T:mc,TT:nc,TTT:oc,TTTT:pc,f:qc,ff:sc,fff:uc,ffff:wc,F:rc,FF:tc,FFF:vc,FFFF:xc};class xb{static create(da,oa={}){return new xb(da,oa)}static parseFormat(da){let oa=
null,xa="",Ba=!1;const Ga=[];for(let Ja=0;Ja<da.length;Ja++){const Qa=da.charAt(Ja);"'"===Qa?(0<xa.length&&Ga.push({literal:Ba,val:xa}),oa=null,xa="",Ba=!Ba):Ba?xa+=Qa:Qa===oa?xa+=Qa:(0<xa.length&&Ga.push({literal:!1,val:xa}),oa=xa=Qa)}0<xa.length&&Ga.push({literal:Ba,val:xa});return Ga}static macroTokenToFormatOpts(da){return Xc[da]}constructor(da,oa){this.opts=oa;this.loc=da;this.systemLoc=null}formatWithSystemDefault(da,oa){null===this.systemLoc&&(this.systemLoc=this.loc.redefaultToSystem());return this.systemLoc.dtFormatter(da,
{...this.opts,...oa}).format()}formatDateTime(da,oa={}){return this.loc.dtFormatter(da,{...this.opts,...oa}).format()}formatDateTimeParts(da,oa={}){return this.loc.dtFormatter(da,{...this.opts,...oa}).formatToParts()}resolvedOptions(da,oa={}){return this.loc.dtFormatter(da,{...this.opts,...oa}).resolvedOptions()}num(da,oa=0){if(this.opts.forceSimple)return f(da,oa);const xa={...this.opts};0<oa&&(xa.padTo=oa);return this.loc.numberFormatter(xa).format(da)}formatDateTimeFromString(da,oa){const xa="en"===
this.loc.listingMode(),Ba=this.loc.outputCalendar&&"gregory"!==this.loc.outputCalendar,Ga=(gb,lb)=>this.loc.extract(da,gb,lb),Ja=gb=>da.isOffsetFixed&&0===da.offset&&gb.allowZ?"Z":da.isValid?da.zone.formatOffset(da.ts,gb.format):"",Qa=(gb,lb)=>xa?C(gb)[da.month-1]:Ga(lb?{month:gb}:{month:gb,day:"numeric"},"month"),Wa=(gb,lb)=>xa?D(gb)[da.weekday-1]:Ga(lb?{weekday:gb}:{weekday:gb,month:"long",day:"numeric"},"weekday"),db=gb=>{const lb=xb.macroTokenToFormatOpts(gb);return lb?this.formatWithSystemDefault(da,
lb):gb},ob=gb=>xa?F(gb)[0>da.year?0:1]:Ga({era:gb},"era");return J(xb.parseFormat(oa),gb=>{switch(gb){case "S":return this.num(da.millisecond);case "u":case "SSS":return this.num(da.millisecond,3);case "s":return this.num(da.second);case "ss":return this.num(da.second,2);case "uu":return this.num(Math.floor(da.millisecond/10),2);case "uuu":return this.num(Math.floor(da.millisecond/100));case "m":return this.num(da.minute);case "mm":return this.num(da.minute,2);case "h":return this.num(0===da.hour%
12?12:da.hour%12);case "hh":return this.num(0===da.hour%12?12:da.hour%12,2);case "H":return this.num(da.hour);case "HH":return this.num(da.hour,2);case "Z":return Ja({format:"narrow",allowZ:this.opts.allowZ});case "ZZ":return Ja({format:"short",allowZ:this.opts.allowZ});case "ZZZ":return Ja({format:"techie",allowZ:this.opts.allowZ});case "ZZZZ":return da.zone.offsetName(da.ts,{format:"short",locale:this.loc.locale});case "ZZZZZ":return da.zone.offsetName(da.ts,{format:"long",locale:this.loc.locale});
case "z":return da.zoneName;case "a":return xa?yc[12>da.hour?0:1]:Ga({hour:"numeric",hourCycle:"h12"},"dayperiod");case "d":return Ba?Ga({day:"numeric"},"day"):this.num(da.day);case "dd":return Ba?Ga({day:"2-digit"},"day"):this.num(da.day,2);case "c":return this.num(da.weekday);case "ccc":return Wa("short",!0);case "cccc":return Wa("long",!0);case "ccccc":return Wa("narrow",!0);case "E":return this.num(da.weekday);case "EEE":return Wa("short",!1);case "EEEE":return Wa("long",!1);case "EEEEE":return Wa("narrow",
!1);case "L":return Ba?Ga({month:"numeric",day:"numeric"},"month"):this.num(da.month);case "LL":return Ba?Ga({month:"2-digit",day:"numeric"},"month"):this.num(da.month,2);case "LLL":return Qa("short",!0);case "LLLL":return Qa("long",!0);case "LLLLL":return Qa("narrow",!0);case "M":return Ba?Ga({month:"numeric"},"month"):this.num(da.month);case "MM":return Ba?Ga({month:"2-digit"},"month"):this.num(da.month,2);case "MMM":return Qa("short",!1);case "MMMM":return Qa("long",!1);case "MMMMM":return Qa("narrow",
!1);case "y":return Ba?Ga({year:"numeric"},"year"):this.num(da.year);case "yy":return Ba?Ga({year:"2-digit"},"year"):this.num(da.year.toString().slice(-2),2);case "yyyy":return Ba?Ga({year:"numeric"},"year"):this.num(da.year,4);case "yyyyyy":return Ba?Ga({year:"numeric"},"year"):this.num(da.year,6);case "G":return ob("short");case "GG":return ob("long");case "GGGGG":return ob("narrow");case "kk":return this.num(da.weekYear.toString().slice(-2),2);case "kkkk":return this.num(da.weekYear,4);case "W":return this.num(da.weekNumber);
case "WW":return this.num(da.weekNumber,2);case "o":return this.num(da.ordinal);case "ooo":return this.num(da.ordinal,3);case "q":return this.num(da.quarter);case "qq":return this.num(da.quarter,2);case "X":return this.num(Math.floor(da.ts/1E3));case "x":return this.num(da.ts);default:return db(gb)}})}formatDurationFromString(da,oa){const xa=Ga=>{switch(Ga[0]){case "S":return"millisecond";case "s":return"second";case "m":return"minute";case "h":return"hour";case "d":return"day";case "M":return"month";
case "y":return"year";default:return null}};oa=xb.parseFormat(oa);const Ba=oa.reduce((Ga,{literal:Ja,val:Qa})=>Ja?Ga:Ga.concat(Qa),[]);da=da.shiftTo(...Ba.map(xa).filter(Ga=>Ga));return J(oa,(Ga=>Ja=>{const Qa=xa(Ja);return Qa?this.num(Ga.get(Qa),Ja.length):Ja})(da))}}class Cb{constructor(da,oa){this.reason=da;this.explanation=oa}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}class Ib{get type(){throw new Ta;}get name(){throw new Ta;}get isUniversal(){throw new Ta;
}offsetName(da,oa){throw new Ta;}formatOffset(da,oa){throw new Ta;}offset(da){throw new Ta;}equals(da){throw new Ta;}get isValid(){throw new Ta;}}let Wb=null;class zc extends Ib{static get instance(){null===Wb&&(Wb=new zc);return Wb}get type(){return"system"}get name(){return(new Intl.DateTimeFormat).resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(da,{format:oa,locale:xa}){return q(da,oa,xa)}formatOffset(da,oa){return A(this.offset(da),oa)}offset(da){return-(new Date(da)).getTimezoneOffset()}equals(da){return"system"===
da.type}get isValid(){return!0}}let Lb={};const Yc={year:0,month:1,day:2,hour:3,minute:4,second:5};let Mb={};class Fb extends Ib{static create(da){Mb[da]||(Mb[da]=new Fb(da));return Mb[da]}static resetCache(){Mb={};Lb={}}static isValidSpecifier(da){return this.isValidZone(da)}static isValidZone(da){if(!da)return!1;try{return(new Intl.DateTimeFormat("en-US",{timeZone:da})).format(),!0}catch(oa){return!1}}constructor(da){super();this.zoneName=da;this.valid=Fb.isValidZone(da)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(da,
{format:oa,locale:xa}){return q(da,oa,xa,this.name)}formatOffset(da,oa){return A(this.offset(da),oa)}offset(da){da=new Date(da);if(isNaN(da))return NaN;var oa=this.name;Lb[oa]||(Lb[oa]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:oa,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}));oa=Lb[oa];if(oa.formatToParts){oa=oa.formatToParts(da);var xa=[];for(let ob=0;ob<oa.length;ob++){const {type:gb,value:lb}=oa[ob],pb=Yc[gb];b(pb)||(xa[pb]=parseInt(lb,
10))}oa=xa}else{{oa=oa.format(da).replace(/\u200E/g,"");oa=/(\d+)\/(\d+)\/(\d+),? (\d+):(\d+):(\d+)/.exec(oa);const [,ob,gb,lb,pb,Db,Hb]=oa;oa=[lb,ob,gb,pb,Db,Hb]}}const [Ba,Ga,Ja,Qa,Wa,db]=oa;oa=m({year:Ba,month:Ga,day:Ja,hour:24===Qa?0:Qa,minute:Wa,second:db,millisecond:0});da=+da;xa=da%1E3;return(oa-(da-(0<=xa?xa:1E3+xa)))/6E4}equals(da){return"iana"===da.type&&da.name===this.name}get isValid(){return this.valid}}let Xb=null;class vb extends Ib{static get utcInstance(){null===Xb&&(Xb=new vb(0));
return Xb}static instance(da){return 0===da?vb.utcInstance:new vb(da)}static parseSpecifier(da){return da&&(da=da.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i))?new vb(z(da[1],da[2])):null}constructor(da){super();this.fixed=da}get type(){return"fixed"}get name(){return 0===this.fixed?"UTC":`UTC${A(this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(da,oa){return A(this.fixed,oa)}get isUniversal(){return!0}offset(){return this.fixed}equals(da){return"fixed"===da.type&&da.fixed===this.fixed}get isValid(){return!0}}
class Qc extends Ib{constructor(da){super();this.zoneName=da}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}let Ac=()=>Date.now(),Bc="system",Cc=null,Dc=null,Ec=null,Fc;class ub{static get now(){return Ac}static set now(da){Ac=da}static set defaultZone(da){Bc=da}static get defaultZone(){return I(Bc,zc.instance)}static get defaultLocale(){return Cc}static set defaultLocale(da){Cc=
da}static get defaultNumberingSystem(){return Dc}static set defaultNumberingSystem(da){Dc=da}static get defaultOutputCalendar(){return Ec}static set defaultOutputCalendar(da){Ec=da}static get throwOnInvalid(){return Fc}static set throwOnInvalid(da){Fc=da}static resetCaches(){sb.resetCache();Fb.resetCache()}}let cc={},Ob={},Pb={},Qb={},Nb=null;class Zc{constructor(da,oa,xa){this.padTo=xa.padTo||0;this.floor=xa.floor||!1;const {padTo:Ba,floor:Ga,...Ja}=xa;if(!oa||0<Object.keys(Ja).length)oa={useGrouping:!1,
...xa},0<xa.padTo&&(oa.minimumIntegerDigits=xa.padTo),this.inf=K(da,oa)}format(da){if(this.inf)return this.inf.format(this.floor?Math.floor(da):da);da=this.floor?Math.floor(da):y(da,3);return f(da,this.padTo)}}class $c{constructor(da,oa,xa){this.opts=xa;if(da.zone.isUniversal){var Ba=da.offset/60*-1;Ba=0<=Ba?`Etc/GMT+${Ba}`:`Etc/GMT${Ba}`;0!==da.offset&&Fb.create(Ba).valid?this.dt=da:(Ba="UTC",this.dt=xa.timeZoneName?da:0===da.offset?da:jb.fromMillis(da.ts+6E4*da.offset))}else"system"===da.zone.type?
this.dt=da:(this.dt=da,Ba=da.zone.name);da={...this.opts};Ba&&(da.timeZone=Ba);this.dtf=P(oa,da)}format(){return this.dtf.format(this.dt.toJSDate())}formatToParts(){return this.dtf.formatToParts(this.dt.toJSDate())}resolvedOptions(){return this.dtf.resolvedOptions()}}class ad{constructor(da,oa,xa){this.opts={style:"long",...xa};!oa&&g()&&(this.rtf=M(da,xa))}format(da,oa){return this.rtf?this.rtf.format(da,oa):G(oa,da,this.opts.numeric,"long"!==this.opts.style)}formatToParts(da,oa){return this.rtf?
this.rtf.formatToParts(da,oa):[]}}class sb{static fromOpts(da){return sb.create(da.locale,da.numberingSystem,da.outputCalendar,da.defaultToEN)}static create(da,oa,xa,Ba=!1){da=da||ub.defaultLocale;var Ga;(Ga=da)||(Ba?Ba="en-US":(Nb||(Nb=(new Intl.DateTimeFormat).resolvedOptions().locale),Ba=Nb),Ga=Ba);return new sb(Ga,oa||ub.defaultNumberingSystem,xa||ub.defaultOutputCalendar,da)}static resetCache(){Nb=null;Ob={};Pb={};Qb={}}static fromObject({locale:da,numberingSystem:oa,outputCalendar:xa}={}){return sb.create(da,
oa,xa)}constructor(da,oa,xa,Ba){var Ga=da.indexOf("-u-");if(-1===Ga)da=[da];else{let db;Ga=da.substring(0,Ga);try{db=P(da).resolvedOptions()}catch(lb){db=P(Ga).resolvedOptions()}const {numberingSystem:ob,calendar:gb}=db;da=[Ga,ob,gb]}const [Ja,Qa,Wa]=da;this.locale=Ja;this.numberingSystem=oa||Qa||null;this.outputCalendar=xa||Wa||null;oa=this.locale;xa=this.numberingSystem;if((da=this.outputCalendar)||xa)oa+="-u",da&&(oa+=`-ca-${da}`),xa&&(oa+=`-nu-${xa}`);this.intl=oa;this.weekdaysCache={format:{},
standalone:{}};this.monthsCache={format:{},standalone:{}};this.meridiemCache=null;this.eraCache={};this.specifiedLocale=Ba;this.fastNumbersCached=null}get fastNumbers(){if(null==this.fastNumbersCached){var da=this.numberingSystem&&"latn"!==this.numberingSystem?!1:"latn"===this.numberingSystem||!this.locale||this.locale.startsWith("en")||"latn"===(new Intl.DateTimeFormat(this.intl)).resolvedOptions().numberingSystem;this.fastNumbersCached=da}return this.fastNumbersCached}listingMode(){const da=this.isEnglish(),
oa=(null===this.numberingSystem||"latn"===this.numberingSystem)&&(null===this.outputCalendar||"gregory"===this.outputCalendar);return da&&oa?"en":"intl"}clone(da){return da&&0!==Object.getOwnPropertyNames(da).length?sb.create(da.locale||this.specifiedLocale,da.numberingSystem||this.numberingSystem,da.outputCalendar||this.outputCalendar,da.defaultToEN||!1):this}redefaultToEN(da={}){return this.clone({...da,defaultToEN:!0})}redefaultToSystem(da={}){return this.clone({...da,defaultToEN:!1})}months(da,
oa=!1,xa=!0){return L(this,da,xa,C,()=>{const Ba=oa?{month:da,day:"numeric"}:{month:da},Ga=oa?"format":"standalone";this.monthsCache[Ga][da]||(this.monthsCache[Ga][da]=U(Ja=>this.extract(Ja,Ba,"month")));return this.monthsCache[Ga][da]})}weekdays(da,oa=!1,xa=!0){return L(this,da,xa,D,()=>{const Ba=oa?{weekday:da,year:"numeric",month:"long",day:"numeric"}:{weekday:da},Ga=oa?"format":"standalone";this.weekdaysCache[Ga][da]||(this.weekdaysCache[Ga][da]=R(Ja=>this.extract(Ja,Ba,"weekday")));return this.weekdaysCache[Ga][da]})}meridiems(da=
!0){return L(this,void 0,da,()=>yc,()=>{if(!this.meridiemCache){const oa={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[jb.utc(2016,11,13,9),jb.utc(2016,11,13,19)].map(xa=>this.extract(xa,oa,"dayperiod"))}return this.meridiemCache})}eras(da,oa=!0){return L(this,da,oa,F,()=>{const xa={era:da};this.eraCache[da]||(this.eraCache[da]=[jb.utc(-40,1,1),jb.utc(2017,1,1)].map(Ba=>this.extract(Ba,xa,"era")));return this.eraCache[da]})}extract(da,oa,xa){return(da=this.dtFormatter(da,oa).formatToParts().find(Ba=>
Ba.type.toLowerCase()===xa))?da.value:null}numberFormatter(da={}){return new Zc(this.intl,da.forceSimple||this.fastNumbers,da)}dtFormatter(da,oa={}){return new $c(da,this.intl,oa)}relFormatter(da={}){return new ad(this.intl,this.isEnglish(),da)}listFormatter(da={}){return O(this.intl,da)}isEnglish(){return"en"===this.locale||"en-us"===this.locale.toLowerCase()||(new Intl.DateTimeFormat(this.intl)).resolvedOptions().locale.startsWith("en-us")}equals(da){return this.locale===da.locale&&this.numberingSystem===
da.numberingSystem&&this.outputCalendar===da.outputCalendar}}const Gc=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,Yb=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,Hc=RegExp(`${Yb.source}${Gc.source}?`),Zb=RegExp(`(?:T${Hc.source})?`),bd=H("weekYear","weekNumber","weekDay"),cd=H("year","ordinal"),Ic=RegExp(`${Yb.source} ?(?:${Gc.source}|(${/[A-Za-z_+-]{1,256}(:?\/[A-Za-z0-9_+-]{1,256}(\/[A-Za-z0-9_+-]{1,256})?)?/.source}))?`),dd=RegExp(`(?: ${Ic.source})?`),ed=RegExp(`^T?${Yb.source}$`),fd=/^-?P(?:(?:(-?\d{1,9}(?:\.\d{1,9})?)Y)?(?:(-?\d{1,9}(?:\.\d{1,9})?)M)?(?:(-?\d{1,9}(?:\.\d{1,9})?)W)?(?:(-?\d{1,9}(?:\.\d{1,9})?)D)?(?:T(?:(-?\d{1,9}(?:\.\d{1,9})?)H)?(?:(-?\d{1,9}(?:\.\d{1,9})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,9}))?S)?)?)$/,
Rc={GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480},gd=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/,hd=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,id=/^(Monday|Tuesday|Wedsday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,
jd=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/,kd=N(/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,Zb),ld=N(/(\d{4})-?W(\d\d)(?:-?(\d))?/,Zb),md=N(/(\d{4})-?(\d{3})/,Zb),nd=N(Hc),od=T(W,V,Y),pd=T(bd,V,Y),qd=T(cd,V,Y),rd=T(V,Y),sd=T(V),td=N(/(\d{4})-(\d\d)-(\d\d)/,dd),ud=N(Ic),vd=T(W,V,Y,aa),wd=T(V,Y,aa),Jc={weeks:{days:7,hours:168,minutes:10080,seconds:604800,milliseconds:6048E5},days:{hours:24,minutes:1440,seconds:86400,
milliseconds:864E5},hours:{minutes:60,seconds:3600,milliseconds:36E5},minutes:{seconds:60,milliseconds:6E4},seconds:{milliseconds:1E3}},xd={years:{quarters:4,months:12,weeks:52,days:365,hours:8760,minutes:525600,seconds:31536E3,milliseconds:31536E6},quarters:{months:3,weeks:13,days:91,hours:2184,minutes:131040,seconds:7862400,milliseconds:78624E5},months:{weeks:4,days:30,hours:720,minutes:43200,seconds:2592E3,milliseconds:2592E6},...Jc},yd={years:{quarters:4,months:12,weeks:52.1775,days:365.2425,
hours:8765.82,minutes:525949.2,seconds:31556952,milliseconds:31556952E3},quarters:{months:3,weeks:13.044375,days:91.310625,hours:2191.455,minutes:131487.3,seconds:7889238,milliseconds:7889238E3},months:{weeks:30.436875/7,days:30.436875,hours:730.485,minutes:43829.1,seconds:2629746,milliseconds:2629746E3},...Jc},Gb="years quarters months weeks days hours minutes seconds milliseconds".split(" "),Sc=Gb.slice(0).reverse();class nb{constructor(da){const oa="longterm"===da.conversionAccuracy||!1;this.values=
da.values;this.loc=da.loc||sb.create();this.conversionAccuracy=oa?"longterm":"casual";this.invalid=da.invalid||null;this.matrix=oa?yd:xd;this.isLuxonDuration=!0}static fromMillis(da,oa){return nb.fromObject({milliseconds:da},oa)}static fromObject(da,oa={}){if(null==da||"object"!==typeof da)throw new Oa(`Duration.fromObject: argument expected to be an object, got ${null===da?"null":typeof da}`);return new nb({values:B(da,nb.normalizeUnit),loc:sb.fromObject(oa),conversionAccuracy:oa.conversionAccuracy})}static fromDurationLike(da){if(c(da))return nb.fromMillis(da);
if(nb.isDuration(da))return da;if("object"===typeof da)return nb.fromObject(da);throw new Oa(`Unknown duration argument ${da} of type ${typeof da}`);}static fromISO(da,oa){const [xa]=S(da,[fd,X]);return xa?nb.fromObject(xa,oa):nb.invalid("unparsable",`the input "${da}" can't be parsed as ISO 8601`)}static fromISOTime(da,oa){const [xa]=S(da,[ed,sd]);return xa?nb.fromObject(xa,oa):nb.invalid("unparsable",`the input "${da}" can't be parsed as ISO 8601`)}static invalid(da,oa=null){if(!da)throw new Oa("need to specify a reason the Duration is invalid");
da=da instanceof Cb?da:new Cb(da,oa);if(ub.throwOnInvalid)throw new cb(da);return new nb({invalid:da})}static normalizeUnit(da){const oa={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[da?da.toLowerCase():da];if(!oa)throw new Da(da);return oa}static isDuration(da){return da&&
da.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(da,oa={}){oa={...oa,floor:!1!==oa.round&&!1!==oa.floor};return this.isValid?xb.create(this.loc,oa).formatDurationFromString(this,da):"Invalid Duration"}toHuman(da={}){const oa=Gb.map(xa=>{const Ba=this.values[xa];return b(Ba)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...da,unit:xa.slice(0,-1)}).format(Ba)}).filter(xa=>xa);
return this.loc.listFormatter({type:"conjunction",style:da.listStyle||"narrow",...da}).format(oa)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let da="P";0!==this.years&&(da+=this.years+"Y");if(0!==this.months||0!==this.quarters)da+=this.months+3*this.quarters+"M";0!==this.weeks&&(da+=this.weeks+"W");0!==this.days&&(da+=this.days+"D");if(0!==this.hours||0!==this.minutes||0!==this.seconds||0!==this.milliseconds)da+="T";0!==this.hours&&(da+=this.hours+"H");
0!==this.minutes&&(da+=this.minutes+"M");if(0!==this.seconds||0!==this.milliseconds)da+=y(this.seconds+this.milliseconds/1E3,3)+"S";"P"===da&&(da+="T0S");return da}toISOTime(da={}){if(!this.isValid)return null;var oa=this.toMillis();if(0>oa||864E5<=oa)return null;da={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...da};oa=this.shiftTo("hours","minutes","seconds","milliseconds");let xa="basic"===da.format?"hhmm":"hh:mm";da.suppressSeconds&&0===oa.seconds&&0===oa.milliseconds||
(xa+="basic"===da.format?"ss":":ss",da.suppressMilliseconds&&0===oa.milliseconds||(xa+=".SSS"));oa=oa.toFormat(xa);da.includePrefix&&(oa="T"+oa);return oa}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.as("milliseconds")}valueOf(){return this.toMillis()}plus(da){if(!this.isValid)return this;da=nb.fromDurationLike(da);const oa={};for(const xa of Gb)if(l(da.values,xa)||l(this.values,xa))oa[xa]=da.get(xa)+this.get(xa);return ea(this,{values:oa},!0)}minus(da){if(!this.isValid)return this;
da=nb.fromDurationLike(da);return this.plus(da.negate())}mapUnits(da){if(!this.isValid)return this;const oa={};for(const xa of Object.keys(this.values))oa[xa]=v(da(this.values[xa],xa));return ea(this,{values:oa},!0)}get(da){return this[nb.normalizeUnit(da)]}set(da){if(!this.isValid)return this;da={...this.values,...B(da,nb.normalizeUnit)};return ea(this,{values:da})}reconfigure({locale:da,numberingSystem:oa,conversionAccuracy:xa}={}){da={loc:this.loc.clone({locale:da,numberingSystem:oa})};xa&&(da.conversionAccuracy=
xa);return ea(this,da)}as(da){return this.isValid?this.shiftTo(da).get(da):NaN}normalize(){if(!this.isValid)return this;const da=this.toObject();Z(this.matrix,da);return ea(this,{values:da},!0)}shiftTo(...da){if(!this.isValid||0===da.length)return this;da=da.map(Ja=>nb.normalizeUnit(Ja));const oa={},xa={},Ba=this.toObject();let Ga;for(const Ja of Gb)if(0<=da.indexOf(Ja)){Ga=Ja;let Qa=0;for(const db in xa)Qa+=this.matrix[db][Ja]*xa[db],xa[db]=0;c(Ba[Ja])&&(Qa+=Ba[Ja]);const Wa=Math.trunc(Qa);oa[Ja]=
Wa;xa[Ja]=(1E3*Qa-1E3*Wa)/1E3;for(const db in Ba)Gb.indexOf(db)>Gb.indexOf(Ja)&&ca(this.matrix,Ba,db,oa,Ja)}else c(Ba[Ja])&&(xa[Ja]=Ba[Ja]);for(const Ja in xa)0!==xa[Ja]&&(oa[Ga]+=Ja===Ga?xa[Ja]:xa[Ja]/this.matrix[Ga][Ja]);return ea(this,{values:oa},!0).normalize()}negate(){if(!this.isValid)return this;const da={};for(const oa of Object.keys(this.values))da[oa]=0===this.values[oa]?0:-this.values[oa];return ea(this,{values:da},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?
this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return null===this.invalid}get invalidReason(){return this.invalid?
this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(da){if(!this.isValid||!da.isValid||!this.loc.equals(da.loc))return!1;for(const Ba of Gb){var oa=this.values[Ba];var xa=da.values[Ba];oa=void 0===oa||0===oa?void 0===xa||0===xa:oa===xa;if(!oa)return!1}return!0}}class tb{constructor(da){this.s=da.start;this.e=da.end;this.invalid=da.invalid||null;this.isLuxonInterval=!0}static invalid(da,oa=null){if(!da)throw new Oa("need to specify a reason the Interval is invalid");
da=da instanceof Cb?da:new Cb(da,oa);if(ub.throwOnInvalid)throw new Bb(da);return new tb({invalid:da})}static fromDateTimes(da,oa){da=zb(da);oa=zb(oa);var xa=da&&da.isValid?oa&&oa.isValid?oa<da?tb.invalid("end before start",`The end of an interval must be after its start, but you had start=${da.toISO()} and end=${oa.toISO()}`):null:tb.invalid("missing or invalid end"):tb.invalid("missing or invalid start");return null==xa?new tb({start:da,end:oa}):xa}static after(da,oa){oa=nb.fromDurationLike(oa);
da=zb(da);return tb.fromDateTimes(da,da.plus(oa))}static before(da,oa){oa=nb.fromDurationLike(oa);da=zb(da);return tb.fromDateTimes(da.minus(oa),da)}static fromISO(da,oa){const [xa,Ba]=(da||"").split("/",2);if(xa&&Ba){let Qa;try{var Ga=jb.fromISO(xa,oa);Qa=Ga.isValid}catch(db){Qa=!1}let Wa;try{var Ja=jb.fromISO(Ba,oa);Wa=Ja.isValid}catch(db){Wa=!1}if(Qa&&Wa)return tb.fromDateTimes(Ga,Ja);if(Qa){if(Ja=nb.fromISO(Ba,oa),Ja.isValid)return tb.after(Ga,Ja)}else if(Wa&&(Ga=nb.fromISO(xa,oa),Ga.isValid))return tb.before(Ja,
Ga)}return tb.invalid("unparsable",`the input "${da}" can't be parsed as ISO 8601`)}static isInterval(da){return da&&da.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return null===this.invalidReason}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(da="milliseconds"){return this.isValid?this.toDuration(...[da]).get(da):NaN}count(da=
"milliseconds"){if(!this.isValid)return NaN;const oa=this.start.startOf(da),xa=this.end.startOf(da);return Math.floor(xa.diff(oa,da).get(da))+1}hasSame(da){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,da):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(da){return this.isValid?this.s>da:!1}isBefore(da){return this.isValid?this.e<=da:!1}contains(da){return this.isValid?this.s<=da&&this.e>da:!1}set({start:da,end:oa}={}){return this.isValid?tb.fromDateTimes(da||this.s,
oa||this.e):this}splitAt(...da){if(!this.isValid)return[];da=da.map(zb).filter(Ja=>this.contains(Ja)).sort();const oa=[];let {s:xa}=this,Ba=0;for(;xa<this.e;){var Ga=da[Ba]||this.e;Ga=+Ga>+this.e?this.e:Ga;oa.push(tb.fromDateTimes(xa,Ga));xa=Ga;Ba+=1}return oa}splitBy(da){da=nb.fromDurationLike(da);if(!this.isValid||!da.isValid||0===da.as("milliseconds"))return[];let {s:oa}=this,xa=1;const Ba=[];for(;oa<this.e;){var Ga=this.start.plus(da.mapUnits(Ja=>Ja*xa));Ga=+Ga>+this.e?this.e:Ga;Ba.push(tb.fromDateTimes(oa,
Ga));oa=Ga;xa+=1}return Ba}divideEqually(da){return this.isValid?this.splitBy(this.length()/da).slice(0,da):[]}overlaps(da){return this.e>da.s&&this.s<da.e}abutsStart(da){return this.isValid?+this.e===+da.s:!1}abutsEnd(da){return this.isValid?+da.e===+this.s:!1}engulfs(da){return this.isValid?this.s<=da.s&&this.e>=da.e:!1}equals(da){return this.isValid&&da.isValid?this.s.equals(da.s)&&this.e.equals(da.e):!1}intersection(da){if(!this.isValid)return this;const oa=this.s>da.s?this.s:da.s;da=this.e<da.e?
this.e:da.e;return oa>=da?null:tb.fromDateTimes(oa,da)}union(da){return this.isValid?tb.fromDateTimes(this.s<da.s?this.s:da.s,this.e>da.e?this.e:da.e):this}static merge(da){const [oa,xa]=da.sort((Ba,Ga)=>Ba.s-Ga.s).reduce(([Ba,Ga],Ja)=>Ga?Ga.overlaps(Ja)||Ga.abutsStart(Ja)?[Ba,Ga.union(Ja)]:[Ba.concat([Ga]),Ja]:[Ba,Ja],[[],null]);xa&&oa.push(xa);return oa}static xor(da){let oa=null,xa=0;const Ba=[];da=da.map(Ga=>[{time:Ga.s,type:"s"},{time:Ga.e,type:"e"}]);da=Array.prototype.concat(...da).sort((Ga,
Ja)=>Ga.time-Ja.time);for(const Ga of da)xa+="s"===Ga.type?1:-1,1===xa?oa=Ga.time:(oa&&+oa!==+Ga.time&&Ba.push(tb.fromDateTimes(oa,Ga.time)),oa=null);return tb.merge(Ba)}difference(...da){return tb.xor([this].concat(da)).map(oa=>this.intersection(oa)).filter(oa=>oa&&!oa.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} \u2013 ${this.e.toISO()})`:"Invalid Interval"}toISO(da){return this.isValid?`${this.s.toISO(da)}/${this.e.toISO(da)}`:"Invalid Interval"}toISODate(){return this.isValid?
`${this.s.toISODate()}/${this.e.toISODate()}`:"Invalid Interval"}toISOTime(da){return this.isValid?`${this.s.toISOTime(da)}/${this.e.toISOTime(da)}`:"Invalid Interval"}toFormat(da,{separator:oa=" \u2013 "}={}){return this.isValid?`${this.s.toFormat(da)}${oa}${this.e.toFormat(da)}`:"Invalid Interval"}toDuration(da,oa){return this.isValid?this.e.diff(this.s,da,oa):nb.invalid(this.invalidReason)}mapEndpoints(da){return tb.fromDateTimes(da(this.s),da(this.e))}}class Kb{static hasDST(da=ub.defaultZone){const oa=
jb.now().setZone(da).set({month:12});return!da.isUniversal&&oa.offset!==oa.set({month:6}).offset}static isValidIANAZone(da){return Fb.isValidZone(da)}static normalizeZone(da){return I(da,ub.defaultZone)}static months(da="long",{locale:oa=null,numberingSystem:xa=null,locObj:Ba=null,outputCalendar:Ga="gregory"}={}){return(Ba||sb.create(oa,xa,Ga)).months(da)}static monthsFormat(da="long",{locale:oa=null,numberingSystem:xa=null,locObj:Ba=null,outputCalendar:Ga="gregory"}={}){return(Ba||sb.create(oa,xa,
Ga)).months(da,!0)}static weekdays(da="long",{locale:oa=null,numberingSystem:xa=null,locObj:Ba=null}={}){return(Ba||sb.create(oa,xa,null)).weekdays(da)}static weekdaysFormat(da="long",{locale:oa=null,numberingSystem:xa=null,locObj:Ba=null}={}){return(Ba||sb.create(oa,xa,null)).weekdays(da,!0)}static meridiems({locale:da=null}={}){return sb.create(da).meridiems()}static eras(da="short",{locale:oa=null}={}){return sb.create(oa,null,"gregory").eras(da)}static features(){return{relative:g()}}}const Rb=
{arab:"[\u0660-\u0669]",arabext:"[\u06f0-\u06f9]",bali:"[\u1b50-\u1b59]",beng:"[\u09e6-\u09ef]",deva:"[\u0966-\u096f]",fullwide:"[\uff10-\uff19]",gujr:"[\u0ae6-\u0aef]",hanidec:"[\u3007|\u4e00|\u4e8c|\u4e09|\u56db|\u4e94|\u516d|\u4e03|\u516b|\u4e5d]",khmr:"[\u17e0-\u17e9]",knda:"[\u0ce6-\u0cef]",laoo:"[\u0ed0-\u0ed9]",limb:"[\u1946-\u194f]",mlym:"[\u0d66-\u0d6f]",mong:"[\u1810-\u1819]",mymr:"[\u1040-\u1049]",orya:"[\u0b66-\u0b6f]",tamldec:"[\u0be6-\u0bef]",telu:"[\u0c66-\u0c6f]",thai:"[\u0e50-\u0e59]",
tibt:"[\u0f20-\u0f29]",latn:"\\d"},dc={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},Tc=Rb.hanidec.replace(/[\[|\]]/g,"").split(""),ec=`( |${String.fromCharCode(160)})`,Sb=new RegExp(ec,"g"),Vc={year:{"2-digit":"yy",
numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour:{numeric:"h","2-digit":"hh"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"}};let Tb=null;const Vb=[0,31,59,90,120,151,181,212,243,273,304,334],Ub=[0,31,60,91,121,152,182,213,244,274,305,335],gc={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},zd={weekNumber:1,weekday:1,hour:0,minute:0,second:0,
millisecond:0},Ad={ordinal:1,hour:0,minute:0,second:0,millisecond:0},fc="year month day hour minute second millisecond".split(" "),Bd="weekYear weekNumber weekday hour minute second millisecond".split(" "),Cd="year ordinal hour minute second millisecond".split(" ");class jb{constructor(da){const oa=da.zone||ub.defaultZone;let xa=da.invalid||(Number.isNaN(da.ts)?new Cb("invalid input"):null)||(oa.isValid?null:Ua(oa));this.ts=b(da.ts)?ub.now():da.ts;let Ba=null;var Ga=null;xa||(da.old&&da.old.ts===
this.ts&&da.old.zone.equals(oa)?[Ba,Ga]=[da.old.c,da.old.o]:(Ga=oa.offset(this.ts),Ba=Ca(this.ts,Ga),Ba=(xa=Number.isNaN(Ba.year)?new Cb("invalid input"):null)?null:Ba,Ga=xa?null:Ga));this._zone=oa;this.loc=da.loc||sb.create();this.invalid=xa;this.weekData=null;this.c=Ba;this.o=Ga;this.isLuxonDateTime=!0}static now(){return new jb({})}static local(){const [da,oa]=yb(arguments),[xa,Ba,Ga,Ja,Qa,Wa,db]=oa;return kb({year:xa,month:Ba,day:Ga,hour:Ja,minute:Qa,second:Wa,millisecond:db},da)}static utc(){const [da,
oa]=yb(arguments),[xa,Ba,Ga,Ja,Qa,Wa,db]=oa;da.zone=vb.utcInstance;return kb({year:xa,month:Ba,day:Ga,hour:Ja,minute:Qa,second:Wa,millisecond:db},da)}static fromJSDate(da,oa={}){da="[object Date]"===Object.prototype.toString.call(da)?da.valueOf():NaN;if(Number.isNaN(da))return jb.invalid("invalid input");const xa=I(oa.zone,ub.defaultZone);return xa.isValid?new jb({ts:da,zone:xa,loc:sb.fromObject(oa)}):jb.invalid(Ua(xa))}static fromMillis(da,oa={}){if(c(da))return-864E13>da||864E13<da?jb.invalid("Timestamp out of range"):
new jb({ts:da,zone:I(oa.zone,ub.defaultZone),loc:sb.fromObject(oa)});throw new Oa(`fromMillis requires a numerical input, but received a ${typeof da} with value ${da}`);}static fromSeconds(da,oa={}){if(c(da))return new jb({ts:1E3*da,zone:I(oa.zone,ub.defaultZone),loc:sb.fromObject(oa)});throw new Oa("fromSeconds requires a numerical input");}static fromObject(da,oa={}){da=da||{};var xa=I(oa.zone,ub.defaultZone);if(!xa.isValid)return jb.invalid(Ua(xa));var Ba=ub.now();const Ga=b(oa.specificOffset)?
xa.offset(Ba):oa.specificOffset,Ja=B(da,hb);var Qa=!b(Ja.ordinal),Wa=!b(Ja.year),db=!b(Ja.month)||!b(Ja.day);Wa=Wa||db;var ob=Ja.weekYear||Ja.weekNumber;oa=sb.fromObject(oa);if((Wa||Qa)&&ob)throw new Ea("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(db&&Qa)throw new Ea("Can't mix ordinal dates with month/day");db=ob||Ja.weekday&&!Wa;let gb=Ca(Ba,Ga);db?(Ba=Bd,ob=zd,gb=Pa(gb)):Qa?(Ba=Cd,ob=Ad,gb=Aa(gb)):(Ba=fc,ob=gc);let lb=!1;for(var pb of Ba)b(Ja[pb])?Ja[pb]=lb?ob[pb]:
gb[pb]:lb=!0;db?(pb=d(Ja.weekYear),Ba=n(Ja.weekNumber,1,u(Ja.weekYear)),ob=n(Ja.weekday,1,7),pb=pb?Ba?ob?!1:Ra("weekday",Ja.weekday):Ra("week",Ja.week):Ra("weekYear",Ja.weekYear)):Qa?(pb=d(Ja.year),Ba=n(Ja.ordinal,1,p(Ja.year)?366:365),pb=pb?Ba?!1:Ra("ordinal",Ja.ordinal):Ra("year",Ja.year)):pb=Na(Ja);if(pb=pb||Sa(Ja))return jb.invalid(pb);Qa=db?ua(Ja):Qa?Ia(Ja):Ja;const [Db,Hb]=Ma(Qa,Ga,xa);xa=new jb({ts:Db,zone:xa,o:Hb,loc:oa});return Ja.weekday&&Wa&&da.weekday!==xa.weekday?jb.invalid("mismatched weekday",
`you can't specify both a weekday of ${Ja.weekday} and a date of ${xa.toISO()}`):xa}static fromISO(da,oa={}){const [xa,Ba]=S(da,[kd,od],[ld,pd],[md,qd],[nd,rd]);return Va(xa,Ba,oa,"ISO 8601",da)}static fromRFC2822(da,oa={}){const [xa,Ba]=S(da.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim(),[gd,ha]);return Va(xa,Ba,oa,"RFC 2822",da)}static fromHTTP(da,oa={}){const [xa,Ba]=S(da,[hd,ka],[id,ka],[jd,ia]);return Va(xa,Ba,oa,"HTTP",oa)}static fromFormat(da,oa,xa={}){if(b(da)||b(oa))throw new Oa("fromFormat requires an input string and a format");
const {locale:Ba=null,numberingSystem:Ga=null}=xa;var Ja=sb.fromOpts({locale:Ba,numberingSystem:Ga,defaultToEN:!0});{const {result:gb,zone:lb,specificOffset:pb,invalidReason:Db}=La(Ja,da,oa);Ja=[gb,lb,pb,Db]}const [Qa,Wa,db,ob]=Ja;return ob?jb.invalid(ob):Va(Qa,Wa,xa,`format ${oa}`,da,db)}static fromString(da,oa,xa={}){return jb.fromFormat(da,oa,xa)}static fromSQL(da,oa={}){const [xa,Ba]=S(da,[td,vd],[ud,wd]);return Va(xa,Ba,oa,"SQL",da)}static invalid(da,oa=null){if(!da)throw new Oa("need to specify a reason the DateTime is invalid");
da=da instanceof Cb?da:new Cb(da,oa);if(ub.throwOnInvalid)throw new rb(da);return new jb({invalid:da})}static isDateTime(da){return da&&da.isLuxonDateTime||!1}get(da){return this[da]}get isValid(){return null===this.invalid}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?
this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?
this.c.millisecond:NaN}get weekYear(){return this.isValid?Ya(this).weekYear:NaN}get weekNumber(){return this.isValid?Ya(this).weekNumber:NaN}get weekday(){return this.isValid?Ya(this).weekday:NaN}get ordinal(){return this.isValid?Aa(this.c).ordinal:NaN}get monthShort(){return this.isValid?Kb.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?Kb.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?Kb.weekdays("short",{locObj:this.loc})[this.weekday-
1]:null}get weekdayLong(){return this.isValid?Kb.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1}).offset||
this.offset>this.set({month:5}).offset}get isInLeapYear(){return p(this.year)}get daysInMonth(){return h(this.year,this.month)}get daysInYear(){return this.isValid?p(this.year)?366:365:NaN}get weeksInWeekYear(){return this.isValid?u(this.weekYear):NaN}resolvedLocaleOptions(da={}){const {locale:oa,numberingSystem:xa,calendar:Ba}=xb.create(this.loc.clone(da),da).resolvedOptions(this);return{locale:oa,numberingSystem:xa,outputCalendar:Ba}}toUTC(da=0,oa={}){return this.setZone(vb.instance(da),oa)}toLocal(){return this.setZone(ub.defaultZone)}setZone(da,
{keepLocalTime:oa=!1,keepCalendarTime:xa=!1}={}){da=I(da,ub.defaultZone);if(da.equals(this.zone))return this;if(da.isValid){let Ba=this.ts;if(oa||xa)oa=da.offset(this.ts),xa=this.toObject(),[Ba]=Ma(xa,oa,da);return $a(this,{ts:Ba,zone:da})}return jb.invalid(Ua(da))}reconfigure({locale:da,numberingSystem:oa,outputCalendar:xa}={}){da=this.loc.clone({locale:da,numberingSystem:oa,outputCalendar:xa});return $a(this,{loc:da})}setLocale(da){return this.reconfigure({locale:da})}set(da){if(!this.isValid)return this;
da=B(da,hb);var oa=!b(da.weekYear)||!b(da.weekNumber)||!b(da.weekday);const xa=!b(da.ordinal),Ba=!b(da.year),Ga=!b(da.month)||!b(da.day),Ja=da.weekYear||da.weekNumber;if((Ba||Ga||xa)&&Ja)throw new Ea("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(Ga&&xa)throw new Ea("Can't mix ordinal dates with month/day");oa?oa=ua({...Pa(this.c),...da}):b(da.ordinal)?(oa={...this.toObject(),...da},b(da.day)&&(oa.day=Math.min(h(oa.year,oa.month),oa.day))):oa=Ia({...Aa(this.c),...da});const [Qa,
Wa]=Ma(oa,this.o,this.zone);return $a(this,{ts:Qa,o:Wa})}plus(da){if(!this.isValid)return this;da=nb.fromDurationLike(da);return $a(this,Xa(this,da))}minus(da){if(!this.isValid)return this;da=nb.fromDurationLike(da).negate();return $a(this,Xa(this,da))}startOf(da){if(!this.isValid)return this;const oa={};da=nb.normalizeUnit(da);switch(da){case "years":oa.month=1;case "quarters":case "months":oa.day=1;case "weeks":case "days":oa.hour=0;case "hours":oa.minute=0;case "minutes":oa.second=0;case "seconds":oa.millisecond=
0}"weeks"===da&&(oa.weekday=1);"quarters"===da&&(oa.month=3*(Math.ceil(this.month/3)-1)+1);return this.set(oa)}endOf(da){return this.isValid?this.plus({[da]:1}).startOf(da).minus(1):this}toFormat(da,oa={}){return this.isValid?xb.create(this.loc.redefaultToEN(oa)).formatDateTimeFromString(this,da):"Invalid DateTime"}toLocaleString(da=bb,oa={}){return this.isValid?xb.create(this.loc.clone(oa),da).formatDateTime(this):"Invalid DateTime"}toLocaleParts(da={}){return this.isValid?xb.create(this.loc.clone(da),
da).formatDateTimeParts(this):[]}toISO({format:da="extended",suppressSeconds:oa=!1,suppressMilliseconds:xa=!1,includeOffset:Ba=!0}={}){if(!this.isValid)return null;da="extended"===da;let Ga=fb(this,da);return Ga=Ga+"T"+qb(this,da,oa,xa,Ba)}toISODate({format:da="extended"}={}){return this.isValid?fb(this,"extended"===da):null}toISOWeekDate(){return eb(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:da=!1,suppressSeconds:oa=!1,includeOffset:xa=!0,includePrefix:Ba=!1,format:Ga="extended"}={}){return this.isValid?
(Ba?"T":"")+qb(this,"extended"===Ga,oa,da,xa):null}toRFC2822(){return eb(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return eb(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?fb(this,!0):null}toSQLTime({includeOffset:da=!0,includeZone:oa=!1,includeOffsetSpace:xa=!0}={}){let Ba="HH:mm:ss.SSS";if(oa||da)xa&&(Ba+=" "),oa?Ba+="z":da&&(Ba+="ZZ");return eb(this,Ba,!0)}toSQL(da={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(da)}`:null}toString(){return this.isValid?
this.toISO():"Invalid DateTime"}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1E3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1E3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(da={}){if(!this.isValid)return{};const oa={...this.c};da.includeConfig&&(oa.outputCalendar=this.outputCalendar,oa.numberingSystem=this.loc.numberingSystem,oa.locale=this.loc.locale);return oa}toJSDate(){return new Date(this.isValid?
this.ts:NaN)}diff(da,oa="milliseconds",xa={}){if(!this.isValid||!da.isValid)return nb.invalid("created by diffing an invalid DateTime");xa={locale:this.locale,numberingSystem:this.numberingSystem,...xa};const Ba=(Array.isArray(oa)?oa:[oa]).map(nb.normalizeUnit);oa=da.valueOf()>this.valueOf();da=la(oa?this:da,oa?da:this,Ba,xa);return oa?da.negate():da}diffNow(da="milliseconds",oa={}){return this.diff(jb.now(),da,oa)}until(da){return this.isValid?tb.fromDateTimes(this,da):this}hasSame(da,oa){if(!this.isValid)return!1;
const xa=da.valueOf();da=this.setZone(da.zone,{keepLocalTime:!0});return da.startOf(oa)<=xa&&xa<=da.endOf(oa)}equals(da){return this.isValid&&da.isValid&&this.valueOf()===da.valueOf()&&this.zone.equals(da.zone)&&this.loc.equals(da.loc)}toRelative(da={}){if(!this.isValid)return null;const oa=da.base||jb.fromObject({},{zone:this.zone}),xa=da.padding?this<oa?-da.padding:da.padding:0;let Ba="years months days hours minutes seconds".split(" "),Ga=da.unit;Array.isArray(da.unit)&&(Ba=da.unit,Ga=void 0);
return Ab(oa,this.plus(xa),{...da,numeric:"always",units:Ba,unit:Ga})}toRelativeCalendar(da={}){return this.isValid?Ab(da.base||jb.fromObject({},{zone:this.zone}),this,{...da,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...da){if(!da.every(jb.isDateTime))throw new Oa("min requires all arguments be DateTimes");return x(da,oa=>oa.valueOf(),Math.min)}static max(...da){if(!da.every(jb.isDateTime))throw new Oa("max requires all arguments be DateTimes");return x(da,oa=>
oa.valueOf(),Math.max)}static fromFormatExplain(da,oa,xa={}){const {locale:Ba=null,numberingSystem:Ga=null}=xa;xa=sb.fromOpts({locale:Ba,numberingSystem:Ga,defaultToEN:!0});return La(xa,da,oa)}static fromStringExplain(da,oa,xa={}){return jb.fromFormatExplain(da,oa,xa)}static get DATE_SHORT(){return bb}static get DATE_MED(){return ib}static get DATE_MED_WITH_WEEKDAY(){return mb}static get DATE_FULL(){return Eb}static get DATE_HUGE(){return hc}static get TIME_SIMPLE(){return ic}static get TIME_WITH_SECONDS(){return jc}static get TIME_WITH_SHORT_OFFSET(){return kc}static get TIME_WITH_LONG_OFFSET(){return lc}static get TIME_24_SIMPLE(){return mc}static get TIME_24_WITH_SECONDS(){return nc}static get TIME_24_WITH_SHORT_OFFSET(){return oc}static get TIME_24_WITH_LONG_OFFSET(){return pc}static get DATETIME_SHORT(){return qc}static get DATETIME_SHORT_WITH_SECONDS(){return rc}static get DATETIME_MED(){return sc}static get DATETIME_MED_WITH_SECONDS(){return tc}static get DATETIME_MED_WITH_WEEKDAY(){return Wc}static get DATETIME_FULL(){return uc}static get DATETIME_FULL_WITH_SECONDS(){return vc}static get DATETIME_HUGE(){return wc}static get DATETIME_HUGE_WITH_SECONDS(){return xc}}
a.DateTime=jb;a.Info=Kb;a.Interval=tb})},"esri/core/number":function(){define(["exports","./string","../intl/locale"],function(a,b,c){function d(k){k||(k=c.getLocale());let r=k in n;if(!r){const m=k.split("-");1<m.length&&m[0]in n&&(k=m[0],r=!0);r||(k="en")}const [y,p,h="#,##0.###"]=n[k];return{decimal:y,group:p,pattern:h}}function g(k,r,y){y=y||{};!0===y.places&&(y.places=0);Infinity===y.places&&(y.places=6);r=r.split(".");var p="string"===typeof y.places&&y.places.indexOf(","),h=y.places;p?h=y.places.substring(p+
1):0<=h||(h=(r[1]||[]).length);0>y.round||(k=Number(k.toFixed(Number(h))));k=String(Math.abs(k)).split(".");const m=k[1]||"";r[1]||y.places?(p&&(y.places=y.places.substring(0,p)),p=void 0!==y.places?y.places:r[1]&&r[1].lastIndexOf("0")+1,p>m.length&&(k[1]=m.padEnd(Number(p),"0")),h<m.length&&(k[1]=m.substr(0,Number(h)))):k[1]&&k.pop();h=r[0].replace(",","");p=h.indexOf("0");-1!==p&&(p=h.length-p,p>k[0].length&&(k[0]=k[0].padStart(p,"0")),-1===h.indexOf("#")&&(k[0]=k[0].substr(k[0].length-p)));h=r[0].lastIndexOf(",");
let u,t;-1!==h&&(u=r[0].length-h-1,r=r[0].substr(0,h),h=r.lastIndexOf(","),-1!==h&&(t=r.length-h-1));r=[];for(h=k[0];h;)p=h.length-u,r.push(0<p?h.substr(p):h),h=0<p?h.slice(0,p):"",t&&(u=t,t=void 0);k[0]=r.reverse().join(y.group||",");return k.join(y.decimal||".")}function x(k){k=k||{};var r=d(k.locale);const y=k.pattern||r.pattern,p=r.group,h=r.decimal;let m=1;if(-1!==y.indexOf("%"))m/=100;else if(-1!==y.indexOf("\u2030"))m/=1E3;else if(-1!==y.indexOf("\u00a4"))throw Error("currency notation not supported");
r=y.split(";");1===r.length&&r.push("-"+r[0]);return{regexp:e(r,function(u){u="(?:"+b.escapeRegExpString(u,".")+")";return u.replace(f,function(t){const q={signed:!1,separator:k.strict?p:[p,""],fractional:k.fractional,decimal:h,exponent:!1};t=t.split(".");let z=k.places;1===t.length&&1!==m&&(t[1]="###");1===t.length||0===z?q.fractional=!1:(void 0===z&&(z=k.pattern?t[1].lastIndexOf("0")+1:Infinity),z&&null==k.fractional&&(q.fractional=!0),!k.places&&z<t[1].length&&(z+=","+t[1].length),q.places=z);
t=t[0].split(",");1<t.length&&(q.groupSize=t.pop().length,1<t.length&&(q.groupSize2=t.pop().length));return"("+w(q)+")"})},!0).replace(/[\xa0 ]/g,"[\\s\\xa0]"),group:p,decimal:h,factor:m}}function w(k){k=k||{};"places"in k||(k.places=Infinity);"string"!==typeof k.decimal&&(k.decimal=".");"fractional"in k&&!/^0/.test(String(k.places))||(k.fractional=[!0,!1]);"exponent"in k||(k.exponent=[!0,!1]);"eSigned"in k||(k.eSigned=[!0,!1]);var r=l(k);const y=e(k.fractional,function(h){let m="";h&&0!==k.places&&
(m="\\"+k.decimal,m=Infinity===k.places?"(?:"+m+"\\d+)?":m+("\\d{"+k.places+"}"));return m},!0),p=e(k.exponent,function(h){return h?"([eE]"+l({signed:k.eSigned})+")":""});r+=y;y&&(r="(?:(?:"+r+")|(?:"+y+"))");return r+p}function l(k){k=k||{};"signed"in k||(k.signed=[!0,!1]);"separator"in k?"groupSize"in k||(k.groupSize=3):k.separator="";const r=e(k.signed,function(p){return p?"[-+]":""},!0),y=e(k.separator,function(p){if(!p)return"(?:\\d+)";p=b.escapeRegExpString(p);" "===p?p="\\s":"\u00a0"===p&&
(p="\\s\\xa0");const h=k.groupSize,m=k.groupSize2;return m?(p="(?:0|[1-9]\\d{0,"+(m-1)+"}(?:["+p+"]\\d{"+m+"})*["+p+"]\\d{"+h+"})",0<h-m?"(?:"+p+"|(?:0|[1-9]\\d{0,"+(h-1)+"}))":p):"(?:0|[1-9]\\d{0,"+(h-1)+"}(?:["+p+"]\\d{"+h+"})*)"},!0);return r+y}const n={ar:[".",","],bg:[",","\u00a0"],bs:[",","."],ca:[",","."],cs:[",","\u00a0"],da:[",","."],de:[",","."],"de-ch":[".","\u2019"],el:[",","."],en:[".",","],"en-au":[".",","],es:[",","."],"es-mx":[".",","],et:[",","\u00a0"],fi:[",","\u00a0"],fr:[",","\u202f"],
"fr-ch":[",","\u202f"],he:[".",","],hi:[".",",","#,##,##0.###"],hr:[",","."],hu:[",","\u00a0"],id:[",","."],it:[",","."],"it-ch":[".","\u2019"],ja:[".",","],ko:[".",","],lt:[",","\u00a0"],lv:[",","\u00a0"],mk:[",","."],nb:[",","\u00a0"],nl:[",","."],pl:[",","\u00a0"],pt:[",","."],"pt-pt":[",","\u00a0"],ro:[",","."],ru:[",","\u00a0"],sk:[",","\u00a0"],sl:[",","."],sr:[",","."],sv:[",","\u00a0"],th:[".",","],tr:[",","."],uk:[",","\u00a0"],vi:[",","."],zh:[".",","]},f=/[#0,]*[#0](?:\.0*#*)?/,e=function(k,
r,y){if(!(k instanceof Array))return r(k);const p=[];for(let h=0;h<k.length;h++)p.push(r(k[h]));k=p.join("|");return"("+(y?"?:":"")+k+")"};a._parseInfo=x;a.format=function(k,r){r={...r};var y=d(r.locale);r.customs=y;var p=r.pattern||y.pattern;if(isNaN(k)||Infinity===Math.abs(k))return null;{r=r||{};y=r.customs.group;const m=r.customs.decimal;p=p.split(";");var h=p[0];p=p[0>k?1:0]||"-"+h;if(-1!==p.indexOf("%"))k*=100;else if(-1!==p.indexOf("\u2030"))k*=1E3;else{if(-1!==p.indexOf("\u00a4"))throw Error("currency notation not supported");
if(-1!==p.indexOf("E"))throw Error("exponential notation not supported");}const u=f;h=h.match(u);if(!h)throw Error("unable to find a number expression in pattern: "+p);!1===r.fractional&&(r.places=0);k=p.replace(u,g(k,h[0],{decimal:m,group:y,places:r.places,round:r.round}))}return k};a.getCustoms=d;a.parse=function(k,r){r=x(r);k=(new RegExp("^"+r.regexp+"$")).exec(k);if(!k)return NaN;let y=k[1];if(!k[1]){if(!k[2])return NaN;y=k[2];r.factor*=-1}y=y.replace(new RegExp("["+r.group+"\\s\\xa0]","g"),"").replace(r.decimal,
".");return Number(y)*r.factor};a.regexp=function(k){return x(k).regexp};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/arcade/featureset/support/shared":function(){define(["exports","../../../core/promiseUtils","../../../geometry/Extent","../../../layers/support/Field"],function(a,b,c,d){function g(x){return x instanceof Date}a.FeatureServiceDatabaseType=void 0;(function(x){x[x.Standardised=0]="Standardised";x[x.StandardisedNoInterval=1]="StandardisedNoInterval";x[x.SqlServer=2]="SqlServer";
x[x.Oracle=3]="Oracle";x[x.Postgres=4]="Postgres";x[x.PGDB=5]="PGDB";x[x.FILEGDB=6]="FILEGDB";x[x.NotEvaluated=7]="NotEvaluated"})(a.FeatureServiceDatabaseType||(a.FeatureServiceDatabaseType={}));a.IdState=void 0;(function(x){x[x.InFeatureSet=0]="InFeatureSet";x[x.NotInFeatureSet=1]="NotInFeatureSet";x[x.Unknown=2]="Unknown"})(a.IdState||(a.IdState={}));a.callback=function(x,w){return function(){try{x.apply(null,arguments)}catch(l){w.reject(l)}}};a.cloneAttributes=function(x){const w={};for(const l in x)w[l]=
x[l];return w};a.cloneField=function(x){return d.fromJSON(x.toJSON())};a.convertLinearUnitsToCode=function(x){if(void 0===x)return null;if("number"===typeof x||"number"===typeof x)return x;switch(x.toLowerCase()){case "meters":case "meter":return 9001;case "miles":case "mile":return 9035;case "kilometers":case "kilometer":case "km":return 9036}return null};a.convertSquareUnitsToCode=function(x){if(void 0===x)return null;if("number"===typeof x)return x;switch(x.toLowerCase()){case "meters":case "meter":return 109404;
case "miles":case "mile":return 109413;case "kilometers":case "kilometer":case "km":return 109414}return null};a.defaultMaxRecords=1E3;a.equalityTest=function(x,w){return x===w?!0:g(x)&&g(w)?x.getTime()===w.getTime():!1};a.errback=function(x){return function(w){x.reject(w)}};a.esriFieldToJson=function(x){return x.toJSON?x.toJSON():x};a.extractServiceUrl=function(x){if(void 0===x)return"";x=x.replace(/\/featureserver\/[0-9]*/i,"/FeatureServer");x=x.replace(/\/mapserver\/[0-9]*/i,"/MapServer");return x=
x.split("?")[0]};a.isArray=function(x){return x instanceof Array};a.isBoolean=function(x){return"boolean"===typeof x};a.isDate=g;a.isNumber=function(x){return"number"===typeof x};a.isString=function(x){return"string"===typeof x||x instanceof String};a.layerFieldEsriConstants={"small-integer":"esriFieldTypeSmallInteger",integer:"esriFieldTypeInteger",long:"esriFieldTypeLong",single:"esriFieldTypeSingle",double:"esriFieldTypeDouble",string:"esriFieldTypeString",date:"esriFieldTypeDate",oid:"esriFieldTypeOID",
geometry:"esriFieldTypeGeometry",blob:"esriFieldTypeBlob",raster:"esriFieldTypeRaster",guid:"esriFieldTypeGUID","global-id":"esriFieldTypeGlobalID",xml:"eesriFieldTypeXML",esriFieldTypeSmallInteger:"esriFieldTypeSmallInteger",esriFieldTypeInteger:"esriFieldTypeInteger",esriFieldTypeLong:"esriFieldTypeLong",esriFieldTypeSingle:"esriFieldTypeSingle",esriFieldTypeDouble:"esriFieldTypeDouble",esriFieldTypeString:"esriFieldTypeString",esriFieldTypeDate:"esriFieldTypeDate",esriFieldTypeOID:"esriFieldTypeOID",
esriFieldTypeGeometry:"esriFieldTypeGeometry",esriFieldTypeBlob:"esriFieldTypeBlob",esriFieldTypeRaster:"esriFieldTypeRaster",esriFieldTypeGUID:"esriFieldTypeGUID",esriFieldTypeGlobalID:"esriFieldTypeGlobalID",esriFieldTypeXML:"eesriFieldTypeXML"};a.layerGeometryEsriConstants={point:"point",polygon:"polygon",polyline:"polyline",multipoint:"multipoint",extent:"extent",esriGeometryPoint:"point",esriGeometryPolygon:"polygon",esriGeometryPolyline:"polyline",esriGeometryMultipoint:"multipoint",esriGeometryEnvelope:"extent",
envelope:"extent"};a.layerGeometryEsriRestConstants={point:"esriGeometryPoint",polygon:"esriGeometryPolygon",polyline:"esriGeometryPolyline",multipoint:"esriGeometryMultipoint",extent:"esriGeometryEnvelope",esriGeometryPoint:"esriGeometryPoint",esriGeometryPolygon:"esriGeometryPolygon",esriGeometryPolyline:"esriGeometryPolyline",esriGeometryMultipoint:"esriGeometryMultipoint",esriGeometryEnvelope:"esriGeometryEnvelope",envelope:"esriGeometryEnvelope"};a.reduceArrayWithPromises=function(x,w){return b.create((l,
n)=>{const f=b.resolve(!0);x.reduce((e,k,r,y)=>e.then(p=>{try{return w(p,k,r,y)}catch(h){return b.reject(h)}},p=>b.reject(p)),f).then(l,n)})};a.sameGeomType=function(x,w){return x===w||"point"===x&&"esriGeometryPoint"===w||"polyline"===x&&"esriGeometryPolyline"===w||"polygon"===x&&"esriGeometryPolygon"===w||"extent"===x&&"esriGeometryEnvelope"===w||"multipoint"===x&&"esriGeometryMultipoint"===w||"point"===w&&"esriGeometryPoint"===x||"polyline"===w&&"esriGeometryPolyline"===x||"polygon"===w&&"esriGeometryPolygon"===
x||"extent"===w&&"esriGeometryEnvelope"===x||"multipoint"===w&&"esriGeometryMultipoint"===x?!0:!1};a.shapeExtent=function(x){if(null===x)return null;switch(x.type){case "polygon":case "multipoint":case "polyline":return x.extent;case "point":return new c({xmin:x.x,ymin:x.y,xmax:x.x,ymax:x.y,spatialReference:x.spatialReference});case "extent":return x}return null};a.stableStringify=function(x,w){w||(w={});"function"===typeof w&&(w={cmp:w});const l="boolean"===typeof w.cycles?w.cycles:!1,n=w.cmp&&function(e){return function(k){return function(r,
y){return e({key:r,value:k[r]},{key:y,value:k[y]})}}}(w.cmp),f=[];return function r(k){k&&k.toJSON&&"function"===typeof k.toJSON&&(k=k.toJSON());if(void 0!==k){if("number"===typeof k)return isFinite(k)?""+k:"null";if("object"!==typeof k)return JSON.stringify(k);var y;if(Array.isArray(k)){var p="[";for(y=0;y<k.length;y++)y&&(p+=","),p+=r(k[y])||"null";return p+"]"}if(null===k)return"null";if(-1!==f.indexOf(k)){if(l)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON");
}var h=f.push(k)-1,m=Object.keys(k).sort(n&&n(k));p="";for(y=0;y<m.length;y++){const u=m[y],t=r(k[u]);t&&(p&&(p+=","),p+=JSON.stringify(u)+":"+t)}f.splice(h,1);return"{"+p+"}"}}(x)};a.toEsriGeometryType=function(x){switch(x){case "point":return"esriGeometryPoint";case "polygon":return"esriGeometryPolygon";case "multipoint":return"esriGeometryMultipoint";case "polyline":return"esriGeometryPolyline";default:return"esriGeometryPoint"}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/widgets/Feature/support/arcadeFeatureUtils":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Logger ../../../core/promiseUtils ../../../layers/FeatureLayer ./featureUtils".split(" "),
function(a,b,c,d,g,x,w){function l(t){return`<ul class="esri-widget__list">${t.map(q=>`<li>${"string"===typeof q?w.applyTextFormattingHTML(w.htmlEntities(q)):q}</li>`).join("")}</ul>`}function n(t){return`<table class="esri-widget__table">${t.keys().map(q=>{var z=t.field(q);z="string"===typeof z?w.applyTextFormattingHTML(w.htmlEntities(z)):z;return`<tr><th>${q}</th><td>${z}</td></tr>`}).join("")}</table>`}function f({aggregatedFeatures:t,arcadeUtils:q,featureSetVars:z,context:v,viewInfo:B,map:A,graphic:E,
interceptor:C}){z.forEach(D=>{D=D.toLowerCase();var F={map:A,spatialReference:B.sr,interceptor:C};"$map"===D&&(v.vars[D]=q.convertMapToFeatureSetCollection(F));"$layer"===D&&(v.vars[D]=q.convertFeatureLayerToFeatureSet({layer:E.sourceLayer,spatialReference:B.sr,interceptor:C}));"$datastore"===D&&(v.vars[D]=q.convertServiceUrlToWorkspace({url:E.sourceLayer.url,spatialReference:B.sr,interceptor:C}));if("$aggregatedfeatures"===D){F=E.layer;const {fields:G,objectIdField:J,geometryType:I,spatialReference:O,
displayField:P}=F;F=new x({fields:G,objectIdField:J,geometryType:I,spatialReference:O,displayField:P,..."feature"===F.type?{templates:F.templates,typeIdField:F.typeIdField,types:F.types}:null,source:t});v.vars[D]=q.convertFeatureLayerToFeatureSet({layer:F,spatialReference:B.sr,interceptor:C})}})}function e(){return new Promise((t,q)=>a(["../../../support/arcadeUtils"],t,q))}function k(t){return r.apply(this,arguments)}function r(){r=c._asyncToGenerator(function*({graphic:t,view:q}){const {isAggregate:z,
layer:v}=t;if(!z||!v||"2d"!==(null==q?void 0:q.type))return[];q=yield q.whenLayerView(v);if(!q.createQuery||!q.queryFeatures)return[];const B=q.createQuery();B.aggregateIds=[t.getObjectId()];({features:t}=yield q.queryFeatures(B));return t});return r.apply(this,arguments)}function y(t){return p.apply(this,arguments)}function p(){p=c._asyncToGenerator(function*({expressionInfo:t,arcadeUtils:q,interceptor:z,spatialReference:v,map:B,graphic:A,view:E}){if(!t||!t.expression)return null;const C=q.createSyntaxTree(t.expression),
D=m.filter(G=>q.hasVariable(C,G));[E]=yield g.all([k({graphic:A,view:E}),q.loadScriptDependencies(C,!0,D)]);const F=q.getViewInfo({spatialReference:v});v=q.createExecContext(A,F);v.interceptor=z;v.useAsync=!0;f({aggregatedFeatures:E,arcadeUtils:q,featureSetVars:D,context:v,viewInfo:F,map:B,graphic:A,interceptor:z});z=q.createFunction(C,v);return q.executeAsyncFunction(z,v).catch(G=>u.error("arcade-execution-error",{error:G,graphic:A,expressionInfo:t}))});return p.apply(this,arguments)}function h(){h=
c._asyncToGenerator(function*({expressionInfos:t,spatialReference:q,graphic:z,interceptor:v,map:B,view:A}){if(!t||!t.length)return{};const E=yield e(),C={};for(const D of t)C[`expression/${D.name}`]=y({expressionInfo:D,arcadeUtils:E,interceptor:v,spatialReference:q,map:B,graphic:z,view:A});t=yield g.eachAlways(C);q={};for(const D in t)z=t[D].value,z="string"===typeof z?w.applyTextFormattingHTML(w.htmlEntities(z)):Array.isArray(z)?l(z):"esri.arcade.Dictionary"===(null==z?void 0:z.declaredClass)?n(z):
z,q[D]=z;return q});return h.apply(this,arguments)}const m=["$datastore","$map","$layer","$aggregatedfeatures"],u=d.getLogger("esri.widgets.Feature.support.arcadeFeatureUtils");b.createCompiledExpression=y;b.createCompiledExpressions=function(t){return h.apply(this,arguments)};b.loadArcadeUtils=e;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/widgets/Feature/FeatureViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Graphic ../../arcade/featureset/support/FeatureSetQueryInterceptor ../../core/Accessor ../../core/Handles ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/throttle ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ../../popup/content/TextContent ./FeatureAttachments/FeatureAttachmentsViewModel ./FeatureContent/FeatureContentViewModel ./FeatureExpression/FeatureExpressionViewModel ./FeatureFields/FeatureFieldsViewModel ./FeatureMedia/FeatureMediaViewModel ./support/arcadeFeatureUtils ./support/featureUtils ./support/relatedFeatureUtils".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E){var C;const D=w.getLogger("esri.widgets.FeatureViewModel"),F={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0};g=C=function(G){function J(O){var P=G.call(this,O)||this;P._handles=new x;P._error=null;P._featureAbortController=null;P.graphicChangedThrottled=f.throttle(P._graphicChanged,1,a._assertThisInitialized(P));P._expressionAttributes=null;P._graphicExpressionAttributes=
null;P.abilities={...F};P.content=null;P.contentViewModels=[];P.defaultPopupTemplateEnabled=!1;P.formattedAttributes=null;P.lastEditInfo=null;P.relatedInfos=new Map;P.title="";P.view=null;P._isAllowedContentType=K=>{const {abilities:M}=a._assertThisInitialized(P);return"attachments"===K.type&&M.attachmentsContent||"custom"===K.type&&M.customContent||"fields"===K.type&&M.fieldsContent||"media"===K.type&&M.mediaContent||"text"===K.type&&M.textContent||"expression"===K.type&&M.expressionContent};P._handles.add(e.init(a._assertThisInitialized(P),
["graphic","_effectivePopupTemplate","abilities"],()=>P.graphicChangedThrottled()));return P}a._inheritsLoose(J,G);var I=J.prototype;I.destroy=function(){this._clear();this._cancelFeatureQuery();this._error=null;this._handles.destroy();this.graphic=this._handles=null;this._destroyContentViewModels();this.relatedInfos.clear()};I.castAbilities=function(O){return{...F,...O}};I.setActiveMedia=function(O,P){O=this.contentViewModels[O];O instanceof v&&O.setActiveMedia(P)};I.nextMedia=function(O){O=this.contentViewModels[O];
O instanceof v&&O.next()};I.previousMedia=function(O){O=this.contentViewModels[O];O instanceof v&&O.previous()};I._clear=function(){this._set("title","");this._set("content",null);this._set("formattedAttributes",null)};I._graphicChanged=function(){var O=a._asyncToGenerator(function*(){this._cancelFeatureQuery();this._error=null;this._clear();const {graphic:P}=this;if(P){var K=new AbortController;this._featureAbortController=K;try{yield this._queryFeature({signal:K.signal})}catch(M){n.isAbortError(M)||
(this._error=M,D.error("error","The popupTemplate could not be displayed for this feature.",{error:M,graphic:P,popupTemplate:this._effectivePopupTemplate}))}this._featureAbortController===K&&(this._featureAbortController=null)}});return function(){return O.apply(this,arguments)}}();I._cancelFeatureQuery=function(){const {_featureAbortController:O}=this;O&&O.abort();this._featureAbortController=null};I._compileContentElement=function(O,P){if("attachments"===O.type)return this._compileAttachments(O,
P);if("custom"===O.type)return this._compileCustom(O,P);if("fields"===O.type)return this._compileFields(O,P);if("media"===O.type)return this._compileMedia(O,P);if("text"===O.type)return this._compileText(O,P);if("expression"===O.type)return this._compileExpression(O,P)};I._compileContent=function(O){this._destroyContentViewModels();if(this.graphic)return Array.isArray(O)?O.filter(this._isAllowedContentType).map((P,K)=>this._compileContentElement(P,K)):"string"===typeof O?this._compileText(new m({text:O}),
0).text:O};I._destroyContentViewModels=function(){var O;null==(O=this._handles)?void 0:O.remove("content-view-models");this.contentViewModels.forEach(P=>P&&!P.destroyed&&P.destroy());this._set("contentViewModels",[])};I._setExpressionContentVM=function(O,P){const {formattedAttributes:K}=this,{contentElement:M,contentElementViewModel:U}=O;O=null==M?void 0:M.type;U&&O&&("fields"===O&&(this._createFieldsFormattedAttributes({contentElement:M,contentElementIndex:P,formattedAttributes:K}),U.set(this._createFieldsVMParams(M,
P))),"media"===O&&(this._createMediaFormattedAttributes({contentElement:M,contentElementIndex:P,formattedAttributes:K}),U.set(this._createMediaVMParams(M,P))),"text"===O&&U.set(this._createTextVMParams(M)))};I._compileExpression=function(O,P){const {expressionInfo:K}=O,{graphic:M,map:U,spatialReference:R,view:L}=this,N=new q({expressionInfo:K,graphic:M,interceptor:C.interceptor,map:U,spatialReference:R,view:L});this.contentViewModels[P]=N;this._handles.add(e.init(N,"contentElementViewModel",()=>this._setExpressionContentVM(N,
P)),"content-view-models");return O};I._compileAttachments=function(O,P){const {graphic:K}=this,{description:M,title:U}=O;this.contentViewModels[P]=new u({graphic:K,...this._compileTitleAndDesc({title:U,description:M})});return O};I._compileCustom=function(O,P){const {graphic:K}=this,{creator:M,destroyer:U}=O;this.contentViewModels[P]=new t({graphic:K,creator:M,destroyer:U});return O};I._compileTitleAndDesc=function({title:O,description:P}){const {_fieldInfoMap:K,_sourceLayer:M,graphic:U,formattedAttributes:R,
_expressionAttributes:L}=this,{attributes:N}=U,T=R.global;return{title:A.substituteFieldsInLinksAndAttributes({attributes:N,fieldInfoMap:K,globalAttributes:T,expressionAttributes:L,layer:M,text:O}),description:A.substituteFieldsInLinksAndAttributes({attributes:N,fieldInfoMap:K,globalAttributes:T,expressionAttributes:L,layer:M,text:P})}};I._createFieldsVMParams=function(O,P){const {_effectivePopupTemplate:K,formattedAttributes:M}=this,U={...M.global,...M.content[P]};P=(null==O?void 0:O.fieldInfos)||
(null==K?void 0:K.fieldInfos);P=null==P?void 0:P.filter(({fieldName:T})=>A.isExpressionField(T)||A.isRelatedField(T)||U.hasOwnProperty(T));const R=null==K?void 0:K.expressionInfos,{description:L,title:N}=O;return{attributes:U,expressionInfos:R,fieldInfos:P,...this._compileTitleAndDesc({title:N,description:L})}};I._compileFields=function(O,P){const K=O.clone();O=new z(this._createFieldsVMParams(O,P));this.contentViewModels[P]=O;K.fieldInfos=O.formattedFieldInfos.slice(0);return K};I._createMediaVMParams=
function(O,P){const {abilities:K,graphic:M,_fieldInfoMap:U,formattedAttributes:R,_effectivePopupTemplate:L,relatedInfos:N,_sourceLayer:T,_expressionAttributes:S}=this,{attributes:H}=M,{description:Q,mediaInfos:W,title:V}=O;return{abilities:{chartAnimation:K.chartAnimation},activeMediaInfoIndex:O.activeMediaInfoIndex||0,attributes:H,layer:T,fieldInfoMap:U,formattedAttributes:{...R.global,...R.content[P]},expressionAttributes:S,mediaInfos:W,popupTemplate:L,relatedInfos:N,...this._compileTitleAndDesc({title:V,
description:Q})}};I._compileMedia=function(O,P){const K=O.clone();O=new v(this._createMediaVMParams(O,P));K.mediaInfos=O.formattedMediaInfos.slice(0);this.contentViewModels[P]=O;return K};I._createTextVMParams=function(O){const {graphic:P,_fieldInfoMap:K,_sourceLayer:M,_expressionAttributes:U}=this;if(O&&O.text){const {attributes:R}=P;O.text=A.substituteFieldsInLinksAndAttributes({attributes:R,fieldInfoMap:K,globalAttributes:this.formattedAttributes.global,expressionAttributes:U,layer:M,text:O.text})}return{graphic:P,
creator:O.text}};I._compileText=function(O,P){O=O.clone();this.contentViewModels[P]=new t(this._createTextVMParams(O));return O};I._compileLastEditInfo=function(){const {_effectivePopupTemplate:O,_sourceLayer:P,graphic:K}=this;if(O){var {lastEditInfoEnabled:M}=O,U=null==P?void 0:P.editFieldsInfo;if(M&&U)return A.formatEditInfo(U,K.attributes)}};I._compileTitle=function(O){const {_fieldInfoMap:P,_sourceLayer:K,graphic:M,_expressionAttributes:U}=this,{attributes:R}=M;return A.substituteFieldsInLinksAndAttributes({attributes:R,
fieldInfoMap:P,globalAttributes:this.formattedAttributes.global,expressionAttributes:U,layer:K,text:O})};I._getTitle=function(){var O=a._asyncToGenerator(function*(){const {_effectivePopupTemplate:P,graphic:K}=this;return A.graphicCallback(null==P?void 0:P.title,{graphic:K})});return function(){return O.apply(this,arguments)}}();I._getContent=function(){var O=a._asyncToGenerator(function*(){const {_effectivePopupTemplate:P,graphic:K}=this;return A.graphicCallback(null==P?void 0:P.content,{graphic:K})});
return function(){return O.apply(this,arguments)}}();I._queryFeature=function(){var O=a._asyncToGenerator(function*(P){const {_featureAbortController:K,_sourceLayer:M,graphic:U,_effectivePopupTemplate:R,spatialReference:L,map:N,view:T}=this,{content:{value:S},title:{value:H}}=yield n.eachAlways({content:this._getContent(),title:this._getTitle()});K===this._featureAbortController&&U&&(yield A.queryUpdatedFeature({graphic:U,popupTemplate:R,layer:M,spatialReference:L},P),{expressionAttributes:{value:P}}=
yield n.eachAlways({checkForRelatedFeatures:this._checkForRelatedFeatures(P),expressionAttributes:B.createCompiledExpressions({expressionInfos:null==R?void 0:R.expressionInfos,spatialReference:L,graphic:U,map:N,interceptor:C.interceptor,view:T})}),K===this._featureAbortController&&U&&(this._expressionAttributes=P,this._graphicExpressionAttributes={...U.attributes,...P},this._set("formattedAttributes",this._createFormattedAttributes(S)),this._set("title",this._compileTitle(H)),this._set("lastEditInfo",
this._compileLastEditInfo()||null),this._set("content",this._compileContent(S)||null)))});return function(P){return O.apply(this,arguments)}}();I._createMediaFormattedAttributes=function({contentElement:O,contentElementIndex:P,formattedAttributes:K}){const {_effectivePopupTemplate:M,graphic:U,relatedInfos:R,_sourceLayer:L,_fieldInfoMap:N,_graphicExpressionAttributes:T}=this;K.content[P]=A.formatAttributes({fieldInfos:null==M?void 0:M.fieldInfos,graphic:U,attributes:{...T,...O.attributes},layer:L,
fieldInfoMap:N,relatedInfos:R})};I._createFieldsFormattedAttributes=function({contentElement:O,contentElementIndex:P,formattedAttributes:K}){if(O.fieldInfos){const {graphic:M,relatedInfos:U,_sourceLayer:R,_fieldInfoMap:L,_graphicExpressionAttributes:N}=this;K.content[P]=A.formatAttributes({fieldInfos:O.fieldInfos,graphic:M,attributes:{...N,...O.attributes},layer:R,fieldInfoMap:L,relatedInfos:U})}};I._createFormattedAttributes=function(O){const {_effectivePopupTemplate:P,graphic:K,relatedInfos:M,_sourceLayer:U,
_fieldInfoMap:R,_graphicExpressionAttributes:L}=this,N={global:A.formatAttributes({fieldInfos:null==P?void 0:P.fieldInfos,graphic:K,attributes:L,layer:U,fieldInfoMap:R,relatedInfos:M}),content:[]};Array.isArray(O)&&O.forEach((T,S)=>{"fields"===T.type&&this._createFieldsFormattedAttributes({contentElement:T,contentElementIndex:S,formattedAttributes:N});"media"===T.type&&this._createMediaFormattedAttributes({contentElement:T,contentElementIndex:S,formattedAttributes:N})});return N};I._checkForRelatedFeatures=
function(O){const {graphic:P,_effectivePopupTemplate:K}=this;return this._queryRelatedInfos(P,A.getAllFieldInfos(K),O)};I._queryRelatedInfos=function(){var O=a._asyncToGenerator(function*(P,K,M){const {relatedInfos:U,_sourceLayer:R}=this;U.clear();const L=l.isSome(R.associatedLayer)?yield R.associatedLayer.load(M):R;if(L){var N=K.filter(H=>H&&A.isRelatedField(H.fieldName));if(N&&N.length){K.forEach(H=>this._configureRelatedInfo(H,L));var T=yield E.queryLayerInfos({relatedInfos:U,layer:L},M);Object.keys(T).forEach(H=>
{var Q;const W=U.get(H.toString());H=null==(Q=T[H])?void 0:Q.value;W&&H&&(W.layerInfo=H.data)});var S=yield E.queryRelatedFeatures({graphic:P,relatedInfos:U,layer:L},M);Object.keys(S).forEach(H=>{var Q;E.setRelatedFeatures(null==(Q=S[H])?void 0:Q.value,U.get(H.toString()))})}}});return function(P,K,M){return O.apply(this,arguments)}}();I._configureRelatedInfo=function(O,P){const {relatedInfos:K}=this,M=E.getRelatedFieldInfo(O.fieldName);if(M){var {layerId:U,fieldName:R}=M;U&&(P=K.get(U.toString())||
E.createRelatedInfo(U,P))&&(E.updateRelatedInfo({relatedInfo:P,fieldName:R,fieldInfo:O}),this.relatedInfos.set(U,P))}};a._createClass(J,[{key:"_effectivePopupTemplate",get:function(){return l.isSome(this.graphic)?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}},{key:"_fieldInfoMap",get:function(){return A.createfieldInfoMap(A.getAllFieldInfos(this._effectivePopupTemplate),this._sourceLayer)}},{key:"_sourceLayer",get:function(){return A.getSourceLayer(this.graphic)}},
{key:"state",get:function(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}},{key:"graphic",set:function(O){this._set("graphic",O?O.clone():null)}},{key:"spatialReference",get:function(){return this.get("view.spatialReference")||null},set:function(O){void 0===O?this._clearOverride("spatialReference"):this._override("spatialReference",O)}},{key:"map",get:function(){return this.get("view.map")||null},set:function(O){void 0===O?this._clearOverride("map"):
this._override("map",O)}},{key:"waitingForContent",get:function(){return!!this._featureAbortController}}]);return J}(g);g.interceptor=new d.FeatureSetQueryInterceptor(A.preLayerQueryCallback,A.preRequestCallback);b.__decorate([k.property()],g.prototype,"_error",void 0);b.__decorate([k.property()],g.prototype,"_featureAbortController",void 0);b.__decorate([k.property({readOnly:!0})],g.prototype,"_effectivePopupTemplate",null);b.__decorate([k.property({readOnly:!0})],g.prototype,"_fieldInfoMap",null);
b.__decorate([k.property({readOnly:!0})],g.prototype,"_sourceLayer",null);b.__decorate([k.property()],g.prototype,"abilities",void 0);b.__decorate([p.cast("abilities")],g.prototype,"castAbilities",null);b.__decorate([k.property({readOnly:!0})],g.prototype,"content",void 0);b.__decorate([k.property({readOnly:!0})],g.prototype,"contentViewModels",void 0);b.__decorate([k.property({type:Boolean})],g.prototype,"defaultPopupTemplateEnabled",void 0);b.__decorate([k.property({readOnly:!0})],g.prototype,"state",
null);b.__decorate([k.property({readOnly:!0})],g.prototype,"formattedAttributes",void 0);b.__decorate([k.property({type:c,value:null})],g.prototype,"graphic",null);b.__decorate([k.property({readOnly:!0})],g.prototype,"lastEditInfo",void 0);b.__decorate([k.property({readOnly:!0})],g.prototype,"relatedInfos",void 0);b.__decorate([k.property()],g.prototype,"spatialReference",null);b.__decorate([k.property({readOnly:!0})],g.prototype,"title",void 0);b.__decorate([k.property()],g.prototype,"map",null);
b.__decorate([k.property({readOnly:!0})],g.prototype,"waitingForContent",null);b.__decorate([k.property()],g.prototype,"view",void 0);return g=C=b.__decorate([h.subclass("esri.widgets.FeatureViewModel")],g)})},"esri/arcade/featureset/support/FeatureSetQueryInterceptor":function(){define(["exports"],function(a){a.FeatureSetQueryInterceptor=function(b,c){this.preLayerQueryCallback=b;this.preRequestCallback=c;this.preLayerQueryCallback||(this.preLayerQueryCallback=d=>{});this.preRequestCallback||(this.preLayerQueryCallback=
d=>{})};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/widgets/Feature/support/FeatureContentMixin":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/set ../../../core/accessorSupport/decorators/subclass ../../support/widget ../../support/jsxFactory".split(" "),function(a,b,c,d,g,x,w,l,n,f,e){a.FeatureContentMixin=
k=>{k=function(r){function y(){var p=r.apply(this,arguments)||this;p.renderNodeContent=h=>f.isWidget(h)&&!h.destroyed?e.tsx("div",{key:h},h.render()):h instanceof HTMLElement?e.tsx("div",{key:h,bind:h,afterCreate:p._attachToNode}):f.hasDomNode(h)?e.tsx("div",{key:h,bind:h.domNode,afterCreate:p._attachToNode}):null;return p}b._inheritsLoose(y,r);y.prototype._attachToNode=function(p){p.appendChild(this)};return y}(k);return k=c.__decorate([n.subclass("esri.widgets.Feature.ContentMixin")],k)};Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/widgets/Spinner":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/maybe ../core/promiseUtils ../core/watchUtils ../core/accessorSupport/decorators/aliasOf ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Widget ./Spinner/SpinnerViewModel ./support/widgetUtils ../core/Logger ./support/jsxFactory".split(" "),function(a,b,c,d,g,
x,w,l,n,f,e,k,r,y,p,h){w=function(m){function u(q,z){q=m.call(this,q,z)||this;q._animationDelay=500;q._animationPromise=null;q.location=null;q.view=null;q.viewModel=new r;q.visible=!1;return q}a._inheritsLoose(u,m);var t=u.prototype;t.initialize=function(){this.own([g.watch(this,"visible",q=>this._visibleChange(q))])};t.destroy=function(){this._animationPromise=null};t.show=function(q){const {location:z,promise:v}=q;z&&(this.viewModel.location=z);this.visible=!0;q=()=>this.hide();v&&v.catch(()=>{}).then(q)};
t.hide=function(){this.visible=!1};t.render=function(){var {visible:q}=this,{screenLocation:z}=this.viewModel;z=!!z;q={["esri-spinner--start"]:q&&z,["esri-spinner--finish"]:!q&&z};z=this._getPositionStyles();return h.tsx("div",{class:this.classes("esri-spinner",q),styles:z})};t._visibleChange=function(q){if(q)this.viewModel.screenLocationEnabled=!0;else{var z=d.after(this._animationDelay);this._animationPromise=z;z.catch(()=>{}).then(()=>{this._animationPromise===z&&(this.viewModel.screenLocationEnabled=
!1,this._animationPromise=null)})}};t._getPositionStyles=function(){const {screenLocation:q,view:z}=this.viewModel;if(!z||c.isNone(q))return{};const {padding:v}=z;return{left:`${q.x-v.left}px`,top:`${q.y-v.top}px`}};return u}(k);b.__decorate([x.aliasOf("viewModel.location")],w.prototype,"location",void 0);b.__decorate([x.aliasOf("viewModel.view")],w.prototype,"view",void 0);b.__decorate([f.property({type:r})],w.prototype,"viewModel",void 0);b.__decorate([x.aliasOf("viewModel.visible")],w.prototype,
"visible",void 0);return w=b.__decorate([e.subclass("esri.widgets.Spinner")],w)})},"esri/widgets/Spinner/SpinnerViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../support/AnchorElementViewModel".split(" "),function(a,b,c,d,g,x,w,l){d=function(n){function f(e){e=n.call(this,e)||this;e.visible=
!1;return e}a._inheritsLoose(f,n);return f}(l);b.__decorate([c.property()],d.prototype,"visible",void 0);return d=b.__decorate([w.subclass("esri.widgets.CompassViewModel")],d)})},"esri/widgets/support/AnchorElementViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Evented ../../core/Handles ../../core/maybe ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e){c=function(k){function r(p){var h=k.call(this,p)||this;h._anchorHandles=new d;h.location=null;h.screenLocation=null;h.screenLocationEnabled=!1;h.view=null;h._anchorHandles.add([x.watch(a._assertThisInitialized(h),["screenLocationEnabled","location","view.size","view.stationary"],()=>h._updateScreenPointAndHandle()),x.watch(a._assertThisInitialized(h),["view","view.ready"],()=>h._wireUpView())]);return h}a._inheritsLoose(r,k);var y=r.prototype;y.destroy=function(){this.view=
null;this._anchorHandles&&this._anchorHandles.destroy();this._viewpointHandle=this._anchorHandles=null};y._wireUpView=function(){this._anchorHandles.remove("view");this._viewpointHandle=null;if(this.get("view.ready")){this._setScreenLocation();var {view:p}=this;p=x.pausable(p,"3d"===p.type?"camera":"viewpoint",()=>this._viewpointChange());this._anchorHandles.add(p,"view");this._viewpointHandle=p;this._toggleWatchingViewpoint()}};y._viewpointChange=function(){this._setScreenLocation();this.emit("view-change")};
y._updateScreenPointAndHandle=function(){this._setScreenLocation();this._toggleWatchingViewpoint()};y._toggleWatchingViewpoint=function(){const {_viewpointHandle:p,location:h,screenLocationEnabled:m}=this;p&&(h&&m?p.resume():p.pause())};y._setScreenLocation=function(){const {location:p,view:h,screenLocationEnabled:m}=this;var u=this.get("view.ready");u=m&&u&&g.isSome(p)?h.toScreen(p):null;this._set("screenLocation",u)};return r}(c.EventedAccessor);b.__decorate([w.property()],c.prototype,"location",
void 0);b.__decorate([w.property({readOnly:!0})],c.prototype,"screenLocation",void 0);b.__decorate([w.property()],c.prototype,"screenLocationEnabled",void 0);b.__decorate([w.property()],c.prototype,"view",void 0);return c=b.__decorate([e.subclass("esri.widgets.support.AnchorElementViewModel")],c)})},"esri/widgets/Popup/PopupViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../Graphic ../../symbols ../../core/Collection ../../core/Error ../../core/Handles ../../core/Logger ../../core/maybe ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../geometry/support/webMercatorUtils ../../layers/Layer ../../support/actions/ActionBase ../../support/actions/ActionButton ../../support/actions/ActionToggle ../../symbols/support/symbolUtils ../../views/input/InputManager ../../views/support/layerViewUtils ../Feature/FeatureViewModel ./actions ./actionUtils ../support/AnchorElementViewModel ../support/GoTo ../../geometry/Point ../../symbols/SimpleFillSymbol".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E,C,D,F,G,J,I){const O=x.ofType({key:"type",defaultKeyValue:"button",base:t,typeMap:{button:q,toggle:z}}),P=n.getLogger("esri.widgets.Popup.PopupViewModel");c=function(K){function M(R){R=K.call(this,R)||this;R._handles=new l;R._pendingPromises=new Set;R._fetchFeaturesController=null;R._selectedClusterFeature=null;R.featurePage=null;R.actions=new O;R.defaultPopupTemplateEnabled=!1;R.autoCloseEnabled=!1;R.autoOpenEnabled=!0;R.browseClusterEnabled=
!1;R.content=null;R.featuresPerPage=20;R.featureViewModelAbilities=null;R.featureViewModels=[];R.highlightEnabled=!0;R.includeDefaultActions=!0;R.selectedClusterBoundaryFeature=new d({symbol:new I({outline:{width:1.5,color:"cyan"},style:"none"})});R.title=null;R.updateLocationEnabled=!1;R.view=null;R.visible=!1;R.zoomFactor=4;R.zoomToLocation=null;return R}a._inheritsLoose(M,K);var U=M.prototype;U.initialize=function(){this._handles.add([e.init(this,["autoOpenEnabled","view"],()=>this._autoOpenEnabledChange()),
this.on("view-change",()=>this._autoClose()),e.watch(this,["highlightEnabled","selectedFeature","visible","view"],()=>this._highlightFeature()),e.watch(this,"view.animation.state",R=>this._animationStateChange(R)),e.watch(this,"location",R=>this._locationChange(R)),e.watch(this,"selectedFeature",R=>this._selectedFeatureChange(R)),e.watch(this,["selectedFeatureIndex","featureCount","featuresPerPage"],()=>this._selectedFeatureIndexChange()),e.watch(this,["featurePage","selectedFeatureIndex","featureCount",
"featuresPerPage, featureViewModels"],()=>this._setGraphicOnFeatureViewModels()),e.watch(this,"featureViewModels",()=>this._featureViewModelsChange()),this.on("trigger-action",R=>D.triggerAction({event:R,view:this.view})),e.whenFalse(this,"waitingForResult",()=>this._waitingForResultChange(),!0),e.watch(this,["features","view","view.map","view.spatialReference"],()=>this._updateFeatureVMs()),e.watch(this,["view.scale"],this._viewScaleChange),e.whenFalse(this,"visible",()=>this.browseClusterEnabled=
!1),e.watch(this,"browseClusterEnabled",R=>R?this.enableClusterBrowsing():this.disableClusterBrowsing())])};U.destroy=function(){this._cancelFetchingFeatures();this._handles.destroy();this._handles=null;this._pendingPromises.clear();this.browseClusterEnabled=!1;this.view=null};U.centerAtLocation=function(){var {view:R}=this;const L=D.getSelectedTarget(this);return L?this.callGoTo({target:{target:L,scale:R.scale}}):(R=new w("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",
{target:L,view:R}),P.error(R),Promise.reject(R))};U.clear=function(){this.set({promises:[],features:[],content:null,title:null,location:null})};U.fetchFeatures=function(R,L){const {view:N}=this;return N&&R?N.fetchPopupFeatures(R,{event:L&&L.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:L&&L.signal}):(R=new w("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:R,view:N}),P.error(R),Promise.reject(R))};U.open=
function(R){R={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...R,visible:!0};var {fetchFeatures:L}=R;delete R.fetchFeatures;L&&this._setFetchFeaturesPromises(R.location);L=["actionsMenuOpen","collapsed","featureMenuOpen"];for(const N of L)delete R[N];this.set(R)};U.triggerAction=function(R){(R=this.allActions.getItemAt(R))&&!R.disabled&&this.emit("trigger-action",{action:R})};U.next=function(){this.selectedFeatureIndex+=1;return this};U.previous=function(){--this.selectedFeatureIndex;return this};
U.disableClusterBrowsing=function(){D.removeClusteredFeaturesForBrowsing(this);this._clearBrowsedClusterGraphics()};U.enableClusterBrowsing=function(){var R=a._asyncToGenerator(function*(){yield D.displayClusterExtent(this);yield D.browseAggregateFeatures(this)});return function(){return R.apply(this,arguments)}}();U._animationStateChange=function(R){this.zoomToLocation||(C.zoomToFeature.disabled="waiting-for-target"===R)};U._clearBrowsedClusterGraphics=function(){var R;const L=null==(R=this.view)?
void 0:R.graphics;L&&(L.remove(this.selectedClusterBoundaryFeature),L.remove(this._selectedClusterFeature));this._selectedClusterFeature=null;this.selectedClusterBoundaryFeature.geometry=null};U._viewScaleChange=function(){var R;null!=(R=this.selectedFeature)&&R.isAggregate?(this.visible=this.browseClusterEnabled=!1,this.clear()):this.browseClusterEnabled&&(this.browseClusterEnabled=!1,this.features=[this.selectedFeature])};U._locationChange=function(R){const {selectedFeature:L,updateLocationEnabled:N}=
this;N&&R&&(!L||L.geometry)&&this.centerAtLocation()};U._selectedFeatureIndexChange=function(){this.featurePage=1<this.featureCount?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null};U._featureViewModelsChange=function(){this.featurePage=1<this.featureCount?1:null};U._setGraphicOnFeatureViewModels=function(){const {features:R,featureCount:L,featurePage:N,featuresPerPage:T,featureViewModels:S}=this;if(null!==N){var H=((N-1)*T+L)%L;S.slice(H,H+T).forEach((Q,W)=>{Q&&!Q.graphic&&(Q.graphic=
R[H+W])})}};U._selectedFeatureChange=function(){var R=a._asyncToGenerator(function*(L){if(L){var {location:N,updateLocationEnabled:T,view:S}=this;this.browseClusterEnabled?(this._selectedClusterFeature&&(S.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),L.isAggregate||(L.symbol=yield v.getDisplayedSymbol(L),this._selectedClusterFeature=L,S.graphics.add(this._selectedClusterFeature))):!T&&N||!L.geometry?T&&!L.geometry&&this.centerAtLocation().then(()=>{this.location=
S.center.clone()}):this.location=f.unwrap(this._getPointFromGeometry(L.geometry))}});return function(L){return R.apply(this,arguments)}}();U._waitingForResultChange=function(){!this.featureCount&&this.promises&&(this.visible=!1)};U._setFetchFeaturesPromises=function(R){return this._fetchFeaturesWithController(this._getScreenPoint(R||this.location)).then(L=>{const {clientOnlyGraphics:N,promisesPerLayerView:T}=L;L=Promise.resolve(N);const S=T.map(H=>H.promise);this.promises=[L,...S]})};U._destroyFeatureVMs=
function(){this.featureViewModels.forEach(R=>R&&!R.destroyed&&R.destroy());this._set("featureViewModels",[])};U._updateFeatureVMs=function(){const {selectedFeature:R,features:L,featureViewModels:N}=this;null!=R&&R.isAggregate||(this.browseClusterEnabled=!1);this._destroyFeatureVMs();if(L&&L.length){var T=N.slice(0),S=[];L.forEach((H,Q)=>{if(H){var W=null;T.some((aa,X)=>{aa&&aa.graphic===H&&(W=aa,T.splice(X,1));return!!W});if(W)S[Q]=W;else{var V,Y;const aa=new E({abilities:this.featureViewModelAbilities,
defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:null==(V=this.view)?void 0:V.spatialReference,graphic:H===R?H:null,map:null==(Y=this.view)?void 0:Y.map,view:this.view});S[Q]=aa}}});T.forEach(H=>H&&!H.destroyed&&H.destroy());this._set("featureViewModels",S)}};U._getScreenPoint=function(R){const {view:L}=this;return L&&R&&"function"===typeof L.toScreen?L.toScreen(R):null};U._autoOpenEnabledChange=function(){const {_handles:R,autoOpenEnabled:L}=this;R.remove("auto-fetch-features");
if(L&&this.view){const N=this.view.on("click",T=>{"mouse"===T.pointerType&&0!==T.button||this._fetchFeaturesAndOpen(T)},B.ViewEventPriorities.WIDGET);R.add(N,"auto-fetch-features")}};U._cancelFetchingFeatures=function(){const R=this._fetchFeaturesController;R&&R.abort();this._fetchFeaturesController=null;this.notifyChange("waitingForResult")};U._fetchFeaturesWithController=function(R,L){this._cancelFetchingFeatures();const N=new AbortController,{signal:T}=N;this._fetchFeaturesController=N;this.notifyChange("waitingForResult");
R=this.fetchFeatures(R,{signal:T,event:L});R.catch(()=>{}).then(()=>{this._fetchFeaturesController=null;this.notifyChange("waitingForResult")});return R};U._fetchFeaturesAndOpen=function(R){const {screenPoint:L,mapPoint:N}=R,{view:T}=this;this._fetchFeaturesWithController(L,R).then(S=>{const {clientOnlyGraphics:H,promisesPerLayerView:Q,location:W}=S,V=[Promise.resolve(H),...Q.map(Y=>Y.promise)];T.popup.open({location:W||N,promises:V});return S})};U._updatePendingPromises=function(R){R&&this._pendingPromises.has(R)&&
(this._pendingPromises.delete(R),this.notifyChange("pendingPromisesCount"))};U._autoClose=function(){this.autoCloseEnabled&&(this.visible=!1)};U._getPointFromGeometry=function(R){return f.isNone(R)?null:"point"===R.type?R:"extent"===R.type?R.center:"polygon"===R.type?R.centroid:"multipoint"===R.type||"polyline"===R.type?R.extent.center:null};U._getLayerView=function(){var R=a._asyncToGenerator(function*(L,N){yield L.when();return L.whenLayerView(N)});return function(L,N){return R.apply(this,arguments)}}();
U._highlightFeature=function(){var R=a._asyncToGenerator(function*(){this._handles.remove("highlight");const {selectedFeature:L,highlightEnabled:N,view:T,visible:S}=this;if(L&&T&&N&&S){var {layer:H,sourceLayer:Q}=L;if("map-notes"===(null==Q?void 0:Q.type)||"subtype-group"===(null==Q?void 0:Q.type))H=Q;if(H&&H instanceof u){var W=this._getLayerView(T,H);this._highlightPromise=W;var V=yield W;if(V&&A.highlightsSupported(V)&&this._highlightPromise===W&&this.selectedFeature&&this.highlightEnabled&&this.visible){W=
"imagery"===H.type?void 0:"objectIdField"in H&&H.objectIdField;var Y=L.attributes;V=V.highlight(Y&&W&&Y[W]||L);this._handles.add(V,"highlight")}}}});return function(){return R.apply(this,arguments)}}();U._updateFeatures=function(R){const {features:L}=this;R&&R.length&&(L.length?(R=R.filter(N=>-1===L.indexOf(N)),this.features=L.concat(R)):this.features=R)};a._createClass(M,[{key:"isLoadingFeature",get:function(){return this.featureViewModels.some(R=>R.waitingForContent)}},{key:"active",get:function(){return!(!this.visible||
this.waitingForResult)}},{key:"allActions",get:function(){const R=this._get("allActions")||new O;R.removeAll();const {actions:L,defaultActions:N,defaultPopupTemplateEnabled:T,includeDefaultActions:S,selectedFeature:H}=this;var Q=S?N.concat(L):L;const W=H&&("function"===typeof H.getEffectivePopupTemplate&&H.getEffectivePopupTemplate(T)||H.popupTemplate),V=W&&W.actions;(Q=W&&W.overwriteActions?V:V?V.concat(Q):Q)&&Q.filter(Boolean).forEach(Y=>R.add(Y));return R}},{key:"defaultActions",get:function(){var R;
const L=this._get("defaultActions")||new O;L.removeAll();L.addMany(null!=(R=this.selectedFeature)&&R.isAggregate?[C.zoomToClusteredFeatures.clone(),C.browseClusteredFeatures.clone()]:[C.zoomToFeature.clone()]);return L}},{key:"featureCount",get:function(){return this.features.length}},{key:"features",get:function(){return this._get("features")||[]},set:function(R){R=R||[];this._set("features",R);const {pendingPromisesCount:L,promiseCount:N,selectedFeatureIndex:T}=this,S=N&&R.length;S&&L&&-1===T?this.selectedFeatureIndex=
0:S&&-1!==T||(this.selectedFeatureIndex=R.length?0:-1)}},{key:"location",get:function(){return this._get("location")||null},set:function(R){const L=this.get("view.spatialReference.isWebMercator");R&&R.get("spatialReference.isWGS84")&&L&&(R=m.geographicToWebMercator(R));this._set("location",R)}},{key:"pendingPromisesCount",get:function(){return this._pendingPromises.size}},{key:"waitingForResult",get:function(){return!(!(this._fetchFeaturesController||0<this.pendingPromisesCount)||0!==this.featureCount)}},
{key:"promiseCount",get:function(){return this.promises.length}},{key:"promises",get:function(){return this._get("promises")||[]},set:function(R){this._pendingPromises.clear();this.features=[];Array.isArray(R)&&R.length?(this._set("promises",R),R=R.slice(0),R.forEach(L=>{this._pendingPromises.add(L);L.then(N=>{this._pendingPromises.has(L)&&this._updateFeatures(N);this._updatePendingPromises(L)},()=>this._updatePendingPromises(L))})):this._set("promises",[]);this.notifyChange("pendingPromisesCount")}},
{key:"selectedFeature",get:function(){const {features:R,selectedFeatureIndex:L}=this;return-1===L?null:R[L]||null}},{key:"selectedFeatureIndex",get:function(){const R=this._get("selectedFeatureIndex");return"number"===typeof R?R:-1},set:function(R){const {featureCount:L}=this;R=isNaN(R)||-1>R||!L?-1:(R+L)%L;this._set("selectedFeatureIndex",R)}},{key:"selectedFeatureViewModel",get:function(){return this.featureViewModels[this.selectedFeatureIndex]||null}},{key:"state",get:function(){return this.get("view.ready")?
"ready":"disabled"}}]);return M}(G.GoToMixin(F));b.__decorate([k.property()],c.prototype,"featurePage",void 0);b.__decorate([k.property()],c.prototype,"isLoadingFeature",null);b.__decorate([k.property({type:O})],c.prototype,"actions",void 0);b.__decorate([k.property({readOnly:!0})],c.prototype,"active",null);b.__decorate([k.property({readOnly:!0})],c.prototype,"allActions",null);b.__decorate([k.property({type:Boolean})],c.prototype,"defaultPopupTemplateEnabled",void 0);b.__decorate([k.property()],
c.prototype,"autoCloseEnabled",void 0);b.__decorate([k.property()],c.prototype,"autoOpenEnabled",void 0);b.__decorate([k.property()],c.prototype,"browseClusterEnabled",void 0);b.__decorate([k.property()],c.prototype,"content",void 0);b.__decorate([k.property({type:O,readOnly:!0})],c.prototype,"defaultActions",null);b.__decorate([k.property({readOnly:!0})],c.prototype,"featureCount",null);b.__decorate([k.property()],c.prototype,"features",null);b.__decorate([k.property()],c.prototype,"featuresPerPage",
void 0);b.__decorate([k.property()],c.prototype,"featureViewModelAbilities",void 0);b.__decorate([k.property({readOnly:!0})],c.prototype,"featureViewModels",void 0);b.__decorate([k.property()],c.prototype,"highlightEnabled",void 0);b.__decorate([k.property()],c.prototype,"includeDefaultActions",void 0);b.__decorate([k.property({type:J})],c.prototype,"location",null);b.__decorate([k.property({readOnly:!0})],c.prototype,"pendingPromisesCount",null);b.__decorate([k.property({readOnly:!0})],c.prototype,
"selectedClusterBoundaryFeature",void 0);b.__decorate([k.property({readOnly:!0})],c.prototype,"waitingForResult",null);b.__decorate([k.property({readOnly:!0})],c.prototype,"promiseCount",null);b.__decorate([k.property()],c.prototype,"promises",null);b.__decorate([k.property({value:null,readOnly:!0})],c.prototype,"selectedFeature",null);b.__decorate([k.property({value:-1})],c.prototype,"selectedFeatureIndex",null);b.__decorate([k.property({readOnly:!0})],c.prototype,"selectedFeatureViewModel",null);
b.__decorate([k.property({readOnly:!0})],c.prototype,"state",null);b.__decorate([k.property()],c.prototype,"title",void 0);b.__decorate([k.property()],c.prototype,"updateLocationEnabled",void 0);b.__decorate([k.property()],c.prototype,"view",void 0);b.__decorate([k.property()],c.prototype,"visible",void 0);b.__decorate([k.property()],c.prototype,"zoomFactor",void 0);b.__decorate([k.property()],c.prototype,"zoomToLocation",void 0);b.__decorate([k.property()],c.prototype,"centerAtLocation",null);return c=
b.__decorate([h.subclass("esri.widgets.Popup.PopupViewModel")],c)})},"esri/symbols/support/symbolUtils":function(){define("require exports ../../chunks/_rollupPluginBabelHelpers ../../core/has ../../core/maybe ../../support/arcadeOnDemand ./previewUtils ./utils".split(" "),function(a,b,c,d,g,x,w,l){function n(h,m){if(m&&(h.style.filter=l.getCSSFilterFromEffectList(m),m=m.effects))for(const u of m)if("drop-shadow"===(null==u?void 0:u.type)){0>u.offsetX?h.style.marginLeft=`${Math.abs(u.offsetX)}px`:
h.style.marginRight=`${u.offsetX}px`;break}}function f(h,m){return e.apply(this,arguments)}function e(){e=c._asyncToGenerator(function*(h,m){switch(h.type){case "web-style":var {previewWebStyleSymbol:u}=yield new Promise((t,q)=>a(["./previewWebStyleSymbol"],t,q));return u(h,f,m);case "label-3d":case "line-3d":case "mesh-3d":case "point-3d":case "polygon-3d":return{previewSymbol3D:u}=yield new Promise((t,q)=>a(["./previewSymbol3D"],t,q)),u(h,m);case "simple-marker":case "simple-line":case "simple-fill":case "picture-marker":case "picture-fill":case "text":return{previewSymbol2D:u}=
yield new Promise((t,q)=>a(["./previewSymbol2D"],t,q)),u(h,m);case "cim":return{previewCIMSymbol:u}=yield new Promise((t,q)=>a(["./previewCIMSymbol"],t,q)),u(h,m)}});return e.apply(this,arguments)}function k(h){return h&&"opacity"in h?h.opacity*k(h.parent):1}function r(){r=c._asyncToGenerator(function*(h,m){var u,t;if(h){var q=h.sourceLayer;q=null!=(u=g.isSome(m)&&null!=(t=m.useSourceLayer)&&t?q:h.layer)?u:q;u=k(q);if(g.isSome(h.symbol)&&(!g.isSome(m)||!0!==m.ignoreGraphicSymbol))return h="web-style"===
h.symbol.type?yield h.symbol.fetchSymbol(g.isSome(m)?m.abortOptions:null):h.symbol.clone(),l.applyColorToSymbol(h,null,u),h;var z=g.isSome(m)&&m.renderer||q&&"renderer"in q&&q.renderer;if(t=z&&"getSymbolAsync"in z?yield z.getSymbolAsync(h,m):null){t="web-style"===t.type?yield t.fetchSymbol(g.isSome(m)?m.abortOptions:null):t.clone();if(!("visualVariables"in z&&z.visualVariables&&z.visualVariables.length))return l.applyColorToSymbol(t,null,u),t;"arcadeRequiredForVisualVariables"in z&&z.arcadeRequiredForVisualVariables&&
(g.isNone(m)||g.isNone(m.arcade))&&(m={...g.unwrap(m)},m.arcade=yield x.loadArcade());q=yield new Promise((D,F)=>a(["../../renderers/visualVariables/support/visualVariableUtils"],D,F));var v=[],B=[],A=[],E=[];for(var C of z.visualVariables)switch(C.type){case "color":v.push(C);break;case "opacity":B.push(C);break;case "rotation":E.push(C);break;case "size":C.target||A.push(C)}C=(C=!!v.length&&v[v.length-1])?q.getColor(C,h,m):null;B=(B=!!B.length&&B[B.length-1])?q.getOpacity(B,h,m):null;null!=u&&(B=
null!=B?B*u:u);l.applyColorToSymbol(t,C,B);A.length&&(u=q.getAllSizes(A,h,m),yield l.applySizesToSymbol(t,u));for(const D of E)l.applyRotationToSymbol(t,q.getRotationAngle(D,h,m),D.axis);return t}}});return r.apply(this,arguments)}function y(){y=c._asyncToGenerator(function*(h,m){var u;if(h){var t=k(h.layer||h.sourceLayer);if(g.isSome(h.symbol)&&(!g.isSome(m)||!0!==m.ignoreGraphicSymbol))return h="web-style"===h.symbol.type?yield h.symbol.fetchSymbol(g.isSome(m)?m.abortOptions:null):h.symbol.clone(),
l.getColorFromSymbol(h,t);var q=g.isSome(m)&&m.renderer||h.get("layer.renderer")||h.get("sourceLayer.renderer"),z=yield q.getSymbolAsync(h,m);if(z){z="web-style"===z.type?yield z.fetchSymbol(g.isSome(m)?m.abortOptions:null):z.clone();z=l.getColorFromSymbol(z,t);if(!("visualVariables"in q)||"visualVariables"in q&&!q.visualVariables||"visualVariables"in q&&(null==(u=q.visualVariables)||!u.length))return z;q.arcadeRequiredForVisualVariables&&(g.isNone(m)||g.isNone(m.arcade))&&(m={...g.unwrap(m)},m.arcade=
yield x.loadArcade());u=yield new Promise((A,E)=>a(["../../renderers/visualVariables/support/visualVariableUtils"],A,E));var v=[],B=[];for(const A of q.visualVariables)switch(A.type){case "color":v.push(A);break;case "opacity":B.push(A)}q=(q=0<v.length?v[v.length-1]:null)?u.getColor(q,h,m):z;h=(z=0<B.length?B[B.length-1]:null)?u.getOpacity(z,h,m):null;null!=t&&(h=null!=h?h*t:t);return q?l.applyOpacityToColor(q,h):null}}});return y.apply(this,arguments)}let p=null;b.getDisplayedColor=function(h,m){return y.apply(this,
arguments)};b.getDisplayedSymbol=function(h,m){return r.apply(this,arguments)};b.renderColorRampPreviewHTML=function(h,m={}){var u="horizontal"===m.align;const {width:t=u?75:24,height:q=u?24:75,gradient:z=!0}=m;var v=window.devicePixelRatio,B=t*v,A=q*v;v=document.createElement("canvas");v.width=B;v.height=A;v.style.width=`${t}px`;v.style.height=`${q}px`;const E=v.getContext("2d");var C=u?B:0,D=u?0:A;if(z){const F=E.createLinearGradient(0,0,C,D);u=h.length;const G=1===u?0:1/(u-1);h.forEach((J,I)=>
F.addColorStop(I*G,J.toString()));E.fillStyle=F;E.fillRect(0,0,B,A)}else{B=u?B/h.length:B;A=u?A:A/h.length;D=C=0;for(const F of h)E.fillStyle=F.toString(),E.fillRect(C,D,B,A),C=u?C+B:0,D=u?0:D+A}h=document.createElement("div");h.style.width=`${t}px`;h.style.height=`${q}px`;n(h,null==m?void 0:m.effectList);h.appendChild(v);return h};b.renderDotDensityPreviewHTML=function(h,m,u){const {backgroundColor:t,outline:q,dotSize:z}=h;u=u&&u.swatchSize||w.SymbolSizeDefaults.size;const v=Math.round(u*u/z**2*
.8),B=window.devicePixelRatio;h=document.createElement("canvas");const A=u*B;h.width=A;h.height=A;h.style.width=`${h.width/B}px`;h.style.height=`${h.height/B}px`;const E=h.getContext("2d");t&&(E.fillStyle=t.toCss(!0),E.fillRect(0,0,A,A),E.fill());E.fillStyle=m.toCss(!0);if(p&&p.length/2===v)for(m=0;m<2*v;m+=2)E.fillRect(p[m],p[m+1],z*B,z*B),E.fill();else for(p=[],m=0;m<2*v;m+=2){const C=Math.floor(Math.random()*(A-0+1)),D=Math.floor(Math.random()*(A-0+1));p.push(C,D);E.fillRect(C,D,z*B,z*B);E.fill()}q&&
(q.color&&(E.strokeStyle=q.color.toCss(!0)),E.lineWidth=q.width,E.strokeRect(0,0,A,A));u=new Image(u,u);u.src=h.toDataURL();return u};b.renderPreviewHTML=f;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/symbols/support/previewUtils":function(){define(["exports","../../Color"],function(a,b){function c(d,g){return Math.round(Math.min(Math.max(d+191.25*g,0),255))}a.SymbolSizeDefaults=void 0;(function(d){d[d.size=22]="size";d[d.lineWidth=50]="lineWidth";d[d.maxSize=120]="maxSize";d[d.maxOutlineSize=
80]="maxOutlineSize";d[d.tallSymbolWidth=20]="tallSymbolWidth"})(a.SymbolSizeDefaults||(a.SymbolSizeDefaults={}));a.adjustColorBrightness=function(d,g){if("type"in d&&("linear"===d.type||"pattern"===d.type))return d;d=new b(d);return new b([c(d.r,g),c(d.g,g),c(d.b,g),d.a])};a.adjustColorComponentBrightness=c;a.getConeShapes=function(d,g){let x=g?a.SymbolSizeDefaults.tallSymbolWidth:d;g=g?4:6;x=x<=a.SymbolSizeDefaults.size?x-.5*g:x-g;g=.15*x;const w=x;d-=g;return[{type:"ellipse",cx:.5*x,cy:d,rx:.5*
x,ry:g},{type:"path",path:[{command:"M",values:[.5*w,0]},{command:"L",values:[w,d]},{command:"L",values:[0,d]},{command:"Z",values:[]}]}]};a.getCubeShapes=function(d,g){let x=g?a.SymbolSizeDefaults.tallSymbolWidth:d;var w=g?4:6;w=x=x<=a.SymbolSizeDefaults.size?x-.5*w:x-w;g=g?.35*x:.5*x;return[{type:"path",path:[{command:"M",values:[.5*w,0]},{command:"L",values:[w,.5*g]},{command:"L",values:[.5*w,g]},{command:"L",values:[0,.5*g]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,
.5*g]},{command:"L",values:[.5*w,g]},{command:"L",values:[.5*w,d]},{command:"L",values:[0,d-.5*g]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.5*w,g]},{command:"L",values:[.5*w,d]},{command:"L",values:[w,d-.5*g]},{command:"L",values:[w,.5*g]},{command:"Z",values:[]}]}]};a.getCylinderShapes=function(d,g){var x=g?a.SymbolSizeDefaults.tallSymbolWidth:d;g=g?4:6;x=x<=a.SymbolSizeDefaults.size?x-.5*g:x-g;g=.5*x;const w=.15*x;d-=w;return[{type:"ellipse",cx:.5*x,cy:d,rx:g,ry:w},{type:"path",
path:[{command:"M",values:[0,w]},{command:"L",values:[0,d]},{command:"L",values:[x,d]},{command:"L",values:[x,w]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*x,cy:w,rx:g,ry:w}]};a.getDiamondShapes=function(d){var g=d;g=g<a.SymbolSizeDefaults.size?g-2:g-4;const x=Math.floor(d/10)-1||1;return[{type:"path",path:[{command:"M",values:[.45*g,0]},{command:"L",values:[g,.5*d-x]},{command:"L",values:[.45*g-x,.5*d+x]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*g,0]},{command:"L",
values:[.45*g-x,.5*d+x]},{command:"L",values:[0,.5*d-x]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*d-x]},{command:"L",values:[.45*g-x,.5*d+x]},{command:"L",values:[.45*g,d]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*g,d]},{command:"L",values:[g,.5*d-x]},{command:"L",values:[.45*g-x,.5*d+x]},{command:"Z",values:[]}]}]};a.getExtrudeSymbolShapes=function(d){const g=a.SymbolSizeDefaults.size;d*=.5;return[{type:"path",path:[{command:"M",values:[0,
.35*g]},{command:"L",values:[.3*g,.7*g]},{command:"L",values:[.3*g,.7*g+d]},{command:"L",values:[0,.7*g+d-.35*g]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.3*g,.7*g]},{command:"L",values:[.3*g,.7*g+d]},{command:"L",values:[g,d]},{command:"L",values:[g,0]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.3*g,0]},{command:"L",values:[g,0]},{command:"L",values:[.3*g,.7*g]},{command:"L",values:[0,.35*g]},{command:"Z",values:[]}]}]};a.getInvertedConeShapes=function(d){let g=
d;g=g<a.SymbolSizeDefaults.size?g-3:g-6;const x=.15*g,w=g;return[{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[w,0]},{command:"L",values:[.5*w,d-x]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*g,cy:0,rx:.5*g,ry:x}]};a.getPathSymbolShapes=function(d,g,x){var w=a.SymbolSizeDefaults.size;let l=w,n=w;1>d?l*=.75:1<d&&(n*=1.25);d=w;g&&x&&(l=n=d=w=0);return[{type:"path",path:[{command:"M",values:[d,0]},{command:"L",values:[x?d:.875*d,0]},{command:"L",values:[x?l-.5*d:0,n-.5*w]},
{command:"L",values:[l-.5*d,n-.5*w]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[d,0]},{command:"L",values:[d,g?0:.125*w]},{command:"L",values:[l-.5*d,g?n-.5*w:w]},{command:"L",values:[l-.5*d,n-.5*w]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[l-.5*d,n-.5*w]},{command:"L",values:[x?l-.5*d:0,n-.5*w]},{command:"L",values:[x?l-.5*d:0,g?n-.5*w:w]},{command:"L",values:[l-.5*d,g?n-.5*w:w]},{command:"Z",values:[]}]}]};a.getTetrahedronShapes=function(d){var g=
d;g=g<a.SymbolSizeDefaults.size?g-1:g-2;return[{type:"path",path:[{command:"M",values:[.45*d,0]},{command:"L",values:[d,g]},{command:"L",values:[.45*d,.6*g]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*d,0]},{command:"L",values:[.45*d,.6*g]},{command:"L",values:[0,g]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,g]},{command:"L",values:[.45*d,.6*g]},{command:"L",values:[d,g]},{command:"Z",values:[]}]}]};a.getWaterSymbolShapes=function(){return[{type:"path",
path:"M80,80.2v-27c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4C8.3,59.3,5.7,58,3.9,56c-1.1-1.2-2.4-2.1-3.9-2.8v27"},{type:"path",path:"M11,59.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8v-24c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-1.1-1.2-2.4-2.1-3.9-2.8v24c1.5,0.7,2.8,1.6,3.9,2.8C5.7,58,8.3,59.3,11,59.4z"},
{type:"path",path:"M11,35.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8V3.6c-1.5,0.7-2.8,1.6-3.9,2.8c-2.2,2.1-4.6,3.4-7.1,3.4s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6S42.5,9.9,40,9.9s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.5,0-5-1.3-7.1-3.4C2.8,5.3,1.4,4.3,0,3.6v25.6c1.5,0.7,2.8,1.6,3.9,2.8C5.7,34.1,8.3,35.3,11,35.4z"}]};
a.shapes={fill:[{type:"path",path:"M -10,-10 L 10,0 L 10,10 L -10,10 L -10,-10 Z"}],squareFill:[{type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 Z"}],pathSymbol3DLayer:[{type:"path",path:"M 3,12 L 12,0 L 11,-2 L -4,5 L -1,5 L 1,7 L 3,10 L 3,12 Z"},{type:"circle",cx:-2,cy:10,r:5}],extrudeSymbol3DLayer:[{type:"path",path:"M -7,-5 L -2,0 L -2,7 L -7,3 L -7,-5 Z"},{type:"path",path:"M -2,0 L -2,7 L 10,-3 L 10,-10 L -2,0 Z"},{type:"path",path:"M -7,-5 L -2,0 L 10,-10 L -2,-10 L -7,-5 Z"}],
cone:[{type:"path",path:"M 0,-10 L -8,5 L -4,6.5 L 0,7 L 4,6.5 L 8,5 Z"}],tallCone:[{type:"path",path:"M 0,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 0,-9 Z"}],invertedCone:[{type:"path",path:"M 0,7 L -8,-8 L 8,-8 Z"},{type:"path",path:"M -8,-8 L -4,-9.5 L 0,-10 L 4,-9.5 L 8,-8 L 4,-6.5 L 0,-6 L -4,-6.5 Z"}],cube:[{type:"path",path:"M -10,-7 L 0,-12 L 10,-7 L 0,-2 L -10,-7 Z"},{type:"path",path:"M -10,-7 L 0,-2 L 0,12 L -10,7 L -10,-7 Z"},{type:"path",path:"M 0,-2 L 10,-7 L 10,7 L 0,12 L 0,-2 Z"}],
tallCube:[{type:"path",path:"M -3.5,-8.5 L 0,-9.5 L 3.5,-8.5 L 0,-7.5 L -3.5,-8.5 Z"},{type:"path",path:"M -3.5,-8.5 L 0,-7.5 L 0,9 L -3.5,8 L -3.5,-8.5 Z"},{type:"path",path:"M 0,-7.5 L 3.5,-8.5 L 3.5,8 L 0,9 L 0,-7.5 Z"}],cylinder:[{type:"path",path:"M -8,-9 L -8,7 L -4,8.5 L 0,9 L 4,8.5 L 8,7 L 8,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:8,ry:2}],tallCylinder:[{type:"path",path:"M -3.5,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 3.5,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:3.5,ry:1}],diamond:[{type:"path",
path:"M 0,-10 L 10,-1 L -1,1 L 0,-10 Z"},{type:"path",path:"M 0,-10 L -1,1 L -8,-1 L 0,-10 Z"},{type:"path",path:"M -1,1 L 0,10 L -8,-1 L -1,1 Z"},{type:"path",path:"M -1,0 L 0,10 L 10,-1 L -1,1 Z"}],tetrahedron:[{type:"path",path:"M 0,-10 L 10,7 L 0,0 L 0,-10 Z"},{type:"path",path:"M 0,-10 L 0,0 L -8,7 L 0,-10 Z"},{type:"path",path:"M 10,7 L 0,0 L -8,7 L 10,7 Z"}]};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/symbols/support/utils":function(){define("require exports ../../chunks/_rollupPluginBabelHelpers ../../Color ../../symbols ../../core/asyncUtils ../../core/has ../../core/maybe ../../core/screenUtils ../../chunks/vec3f64 ../../layers/effects/jsonUtils ./gfxUtils ./Symbol3DMaterial".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r){function y(I){I=I.symbolLayers;if(!I)return null;let O=null;I.forEach(P=>{if("object"!==P.type||null==P.resource.href)O="water"===P.type?l.unwrap(P.color):l.isSome(P.material)?l.unwrap(P.material.color):null});return O?new d(O):null}function p(I,O){if(null==O)return I;I=I.toRgba();I[3]*=O;return new d(I)}function h(I,O,P){if(I=I.symbolLayers){var K=M=>{M=l.isSome(M)?M:null;O=O||M||null!=P&&J;return p(O,P)};I.forEach(M=>{if("object"!==M.type||null==M.resource.href||
O)if("water"===M.type)M.color=K(M.color);else{var U=l.isSome(M.material)?M.material.color:null;U=K(U);l.isNone(M.material)?M.material=new r.Symbol3DMaterial({color:U}):M.material.color=U;null!=P&&"outline"in M&&l.isSome(M.outline)&&l.isSome(M.outline.color)&&(M.outline.color=p(M.outline.color,P))}})}}function m(I,O){return u.apply(this,arguments)}function u(){u=c._asyncToGenerator(function*(I,O){(I=I.symbolLayers)&&(yield x.forEach(I,function(){var P=c._asyncToGenerator(function*(K){return t(K,O)});
return function(K){return P.apply(this,arguments)}}()))});return u.apply(this,arguments)}function t(I,O){return q.apply(this,arguments)}function q(){q=c._asyncToGenerator(function*(I,O){switch(I.type){case "extrude":I.size="number"===typeof O[2]?O[2]:0;break;case "icon":case "line":case "text":O=z(O);l.isSome(O)&&(I.size=O);break;case "path":{const P=A(O,f.ONES,[I.width,void 0,I.height]);I.width=D(O[0],I.width,1,P);I.height=D(O[2],I.height,1,P)}break;case "object":yield v(I,O)}});return q.apply(this,
arguments)}function z(I){for(const O of I)if("number"===typeof O)return O;return null}function v(I,O){return B.apply(this,arguments)}function B(){B=c._asyncToGenerator(function*(I,O){const {resourceSize:P,symbolSize:K}=yield E(I),M=A(O,P,K);I.width=D(O[0],K[0],P[0],M);I.depth=D(O[1],K[1],P[1],M);I.height=D(O[2],K[2],P[2],M)});return B.apply(this,arguments)}function A(I,O,P){for(let K=0;3>K;K++){const M=I[K];switch(M){case "symbol-value":return null!=P[K]?P[K]/O[K]:1;case "proportional":break;default:if(M&&
O[K])return M/O[K]}}return 1}function E(I){return C.apply(this,arguments)}function C(){C=c._asyncToGenerator(function*(I){const O=yield(yield new Promise((L,N)=>a(["./symbolLayerUtils"],L,N))).computeObjectLayerResourceSize(I,10),{width:P,height:K,depth:M}=I;I=[P,M,K];let U=1;for(var R=0;3>R;R++)if(null!=I[R]){U=I[R]/O[R];break}for(R=0;3>R;R++)null==I[R]&&(I[R]=O[R]*U);return{resourceSize:O,symbolSize:I}});return C.apply(this,arguments)}function D(I,O,P,K){switch(I){case "proportional":return P*K;
case "symbol-value":return null!=O?O:P;default:return I}}function F(){F=c._asyncToGenerator(function*(I,O){if(I&&O){if(g.isSymbol3D(I))return m(I,O);if(g.isSymbol2D(I)&&(O=z(O),!l.isNone(O)))switch(I.type){case "simple-marker":I.size=O;break;case "picture-marker":{const P=I.width/I.height;1<P?(I.width=O,I.height=O*P):(I.width=O*P,I.height=O);break}case "simple-line":I.width=O;break;case "text":I.font.size=O}}});return F.apply(this,arguments)}const G=/\/resource\/(.*?)\.svg$/,J=new d("white");b.applyColorToSymbol=
function(I,O,P){if(I&&(O||null!=P))if(O&&(O=new d(O)),g.isSymbol3D(I))h(I,O,P);else if(g.isSymbol2D(I)){if(O=O||I.color)I.color=p(O,P);null!=P&&"outline"in I&&I.outline&&I.outline.color&&(I.outline.color=p(I.outline.color,P))}};b.applyOpacityToColor=p;b.applyRotationToSymbol=function(I,O,P){I&&null!=O&&(g.isSymbol3D(I)?(I=I.symbolLayers)&&I.forEach(K=>{if(K&&"object"===K.type)switch(P){case "tilt":K.tilt=O;break;case "roll":K.roll=O;break;default:K.heading=O}}):!g.isSymbol2D(I)||"simple-marker"!==
I.type&&"picture-marker"!==I.type&&"text"!==I.type||(I.angle=O))};b.applySizesToSymbol=function(I,O){return F.apply(this,arguments)};b.getCSSFilterFromEffectList=function(I){if(!I)return null;I=I.effects.filter(O=>"bloom"!==O.type).map(O=>O.toJSON());return e.effectFunctionsFromJSON(I)};b.getColorFromSymbol=function(I,O){if(!I)return null;let P=null;g.isSymbol3D(I)?P=y(I):g.isSymbol2D(I)&&(P=I.color?new d(I.color):null);return P?p(P,O):null};b.getIconHref=function(I,O){O=O.resource.href;return!w("esri-canvas-svg-support")&&
I.styleOrigin&&G.test(O)?O.replace(G,"/resource/png/$1.png"):O};b.getSymbolOutlineSize=function(I){if(!I)return 0;if(g.isSymbol3D(I)){{const O=I.symbolLayers&&I.symbolLayers.length;O?(I=I.symbolLayers.getItemAt(O-1),I="outline"in I?l.get(I,"outline","size"):void 0):I=void 0}return l.isSome(I)?I:0}return(I=k.getStroke(I))&&n.px2pt(I.width)||0};b.isVolumetricSymbol=function(I){if(l.isNone(I)||!("symbolLayers"in I)||l.isNone(I.symbolLayers))return!1;switch(I.type){case "point-3d":return I.symbolLayers.some(O=>
"object"===O.type);case "line-3d":return I.symbolLayers.some(O=>"path"===O.type);case "polygon-3d":return I.symbolLayers.some(O=>"object"===O.type||"extrude"===O.type);default:return!1}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/symbols/support/gfxUtils":function(){define("exports ../../assets ../../Color ../../request ../../core/ItemCache ../../core/screenUtils ./cimSymbolUtils".split(" "),function(a,b,c,d,g,x,w){function l(r){if(!r)return null;let y;switch(r.type){case "simple-fill":case "picture-fill":case "simple-marker":y=
l(r.outline);break;case "simple-line":{const p=x.pt2px(r.width);"none"!==r.style&&0!==p&&(y={color:r.color,style:k(r.style),width:p,cap:r.cap,join:"miter"===r.join?x.pt2px(r.miterLimit):r.join});break}default:y=null}return y}const n={left:"start",center:"middle",right:"end",justify:"start"},f={top:"text-before-edge",middle:"central",baseline:"alphabetic",bottom:"text-after-edge"},e=new g(1E3),k=function(){const r={};return function(y){if(r[y])return r[y];const p=y.replace(/-/g,"");return r[y]=p}}();
c=new c([128,128,128]);a.defaultThematicColor=c;a.dekebabifyLineStyle=k;a.getFill=function(r){const y=r.style;let p=null;if(r)switch(r.type){case "simple-marker":"cross"!==y&&"x"!==y&&(p=r.color);break;case "simple-fill":"solid"===y?p=r.color:"none"!==y&&(p={type:"pattern",x:0,y:0,src:b.getAssetUrl(`esri/symbols/patterns/${y}.png`),width:5,height:5});break;case "picture-fill":p={type:"pattern",src:r.url,width:x.pt2px(r.width)*r.xscale,height:x.pt2px(r.height)*r.yscale,x:x.pt2px(r.xoffset),y:x.pt2px(r.yoffset)};
break;case "text":p=r.color;break;case "cim":p=w.getCIMSymbolColor(r)}return p};a.getPatternUrlWithColor=function(r,y){const p=r+"-"+y;return void 0!==e.get(p)?Promise.resolve(e.get(p)):d(r,{responseType:"image"}).then(h=>{h=h.data;const m=h.naturalWidth,u=h.naturalHeight,t=document.createElement("canvas");t.width=m;t.height=u;const q=t.getContext("2d");q.fillStyle=y;q.fillRect(0,0,m,u);q.globalCompositeOperation="destination-in";q.drawImage(h,0,0);h=t.toDataURL();e.put(p,h);return h})};a.getSVGAlign=
function(r){return r=(r=r.horizontalAlignment)&&n[r.toLowerCase()]||"middle"};a.getSVGBaseline=function(r){return(r=r.verticalAlignment)&&f[r.toLowerCase()]||"alphabetic"};a.getSVGBaselineShift=function(r){return"bottom"===r.verticalAlignment?"super":null};a.getStroke=l;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/ItemCache":function(){define(["./MemCache"],function(a){return function(){function b(d,g){this._storage=new a.MemCacheStorage;this._storage.maxSize=d;g&&this._storage.registerRemoveFunc("",
g)}var c=b.prototype;c.put=function(d,g){this._storage.put(d,g,1,1)};c.pop=function(d){return this._storage.pop(d)};c.get=function(d){return this._storage.get(d)};c.clear=function(){this._storage.clearAll()};c.destroy=function(){this._storage.destroy()};return b}()})},"esri/symbols/support/cimSymbolUtils":function(){define(["exports","../../Color","../cim/utils"],function(a,b,c){function d(k){k=c.toCIMSymbolJSON(k);if("CIMTextSymbol"===k.type)return k.height;let r=0;if(k.symbolLayers)for(const y of k.symbolLayers)c.isCIMMarker(y)&&
y.size>r?r=y.size:c.isCIMStroke(y)&&y.width>r?r=y.width:c.isCIMFill(y);return r}function g(k,r,y,p){if("CIMTextSymbol"===k.type)k.height*=r;else{if(y&&k.effects)for(const h of k.effects)l(h,r);if(k.symbolLayers)for(const h of k.symbolLayers)switch(h.type){case "CIMPictureMarker":case "CIMVectorMarker":x(h,r,p);break;case "CIMPictureStroke":case "CIMSolidStroke":null!=p&&p.preserveOutlineWidth||!h.width||(h.width*=r);break;case "CIMPictureFill":h.height&&(h.height*=r);h.offsetX&&(h.offsetX*=r);h.offsetY&&
(h.offsetY*=r);break;case "CIMHatchFill":g(h.lineSymbol,r,!0,{...p,preserveOutlineWidth:!1}),h.offsetX&&(h.offsetX*=r),h.offsetY&&(h.offsetY*=r),h.separation&&(h.separation*=r)}}}function x(k,r,y){k.markerPlacement&&w(k.markerPlacement,r);k.offsetX&&(k.offsetX*=r);k.offsetY&&(k.offsetY*=r);k.anchorPoint&&"Absolute"===k.anchorPointUnits&&(k.anchorPoint={x:k.anchorPoint.x*r,y:k.anchorPoint.y*r});k.size*=r;if("CIMVectorMarker"===k.type&&k.markerGraphics)for(const p of k.markerGraphics)k.scaleSymbolsProportionally||
g(p.symbol,r,!0,y)}function w(k,r){c.isCIMMarkerStrokePlacement(k)&&k.offset&&(k.offset*=r);switch(k.type){case "CIMMarkerPlacementAlongLineRandomSize":case "CIMMarkerPlacementAlongLineSameSize":k.customEndingOffset&&(k.customEndingOffset*=r);k.offsetAlongLine&&(k.offsetAlongLine*=r);if(k.placementTemplate&&k.placementTemplate.length){var y=k.placementTemplate.map(p=>p*r);k.placementTemplate=y}break;case "CIMMarkerPlacementAlongLineVariableSize":k.maxRandomOffset&&(k.maxRandomOffset*=r);k.placementTemplate&&
k.placementTemplate.length&&(y=k.placementTemplate.map(p=>p*r),k.placementTemplate=y);break;case "CIMMarkerPlacementOnLine":k.startPointOffset&&(k.startPointOffset*=r);break;case "CIMMarkerPlacementAtExtremities":k.offsetAlongLine&&(k.offsetAlongLine*=r);break;case "CIMMarkerPlacementAtRatioPositions":k.beginPosition&&(k.beginPosition*=r);k.endPosition&&(k.endPosition*=r);break;case "CIMMarkerPlacementPolygonCenter":k.offsetX&&(k.offsetX*=r);k.offsetY&&(k.offsetY*=r);break;case "CIMMarkerPlacementInsidePolygon":k.offsetX&&
(k.offsetX*=r),k.offsetY&&(k.offsetY*=r),k.stepX&&(k.stepX*=r),k.stepY&&(k.stepY*=r)}}function l(k,r){switch(k.type){case "CIMGeometricEffectArrow":case "CIMGeometricEffectDonut":k.width&&(k.width*=r);break;case "CIMGeometricEffectBuffer":k.size&&(k.size*=r);break;case "CIMGeometricEffectCut":k.beginCut&&(k.beginCut*=r);k.endCut&&(k.endCut*=r);k.middleCut&&(k.middleCut*=r);break;case "CIMGeometricEffectDashes":k.customEndingOffset&&(k.customEndingOffset*=r);k.offsetAlongLine&&(k.offsetAlongLine*=
r);if(k.dashTemplate&&k.dashTemplate.length){const y=k.dashTemplate.map(p=>p*r);k.dashTemplate=y}break;case "CIMGeometricEffectExtension":case "CIMGeometricEffectJog":case "CIMGeometricEffectRadial":k.length&&(k.length*=r);break;case "CIMGeometricEffectMove":k.offsetX&&(k.offsetX*=r);k.offsetY&&(k.offsetY*=r);break;case "CIMGeometricEffectOffset":case "CIMGeometricEffectOffsetTangent":k.offset&&(k.offset*=r);break;case "CIMGeometricEffectRegularPolygon":k.radius&&(k.radius*=r);break;case "CIMGeometricEffectTaperedPolygon":k.fromWidth&&
(k.fromWidth*=r);k.length&&(k.length*=r);k.toWidth&&(k.toWidth*=r);break;case "CIMGeometricEffectWave":k.amplitude&&(k.amplitude*=r),k.period&&(k.period*=r)}}function n(k,r){let y;y="CIMTextSymbol"===k.type?k.symbol:k;k="CIMPolygonSymbol"===k.type;if(y.symbolLayers)for(const p of y.symbolLayers)if(!(p.colorLocked||k&&(c.isCIMStroke(p)||c.isCIMMarker(p)&&p.markerPlacement&&c.isCIMMarkerStrokePlacement(p.markerPlacement))))switch(p.type){case "CIMPictureMarker":case "CIMPictureStroke":case "CIMPictureFill":p.tintColor&&
f(r,p.tintColor);break;case "CIMVectorMarker":p.markerGraphics.forEach(h=>{n(h.symbol,r)});break;case "CIMSolidStroke":case "CIMSolidFill":f(r,p.color);break;case "CIMHatchFill":n(p.lineSymbol,r)}}function f(k,r){for(const y of k)if(y.join(".")===r.join("."))return;k.push(r)}function e(k,r,y){var p="CIMTextSymbol"===k.type?k.symbol:k;k="CIMPolygonSymbol"===p.type?!0:!1;if(p.symbolLayers)for(const h of p.symbolLayers)if(!h.colorLocked){if(k)if(y){if({layersToColor:p}=y,(c.isCIMStroke(h)||c.isCIMMarker(h)&&
h.markerPlacement&&c.isCIMMarkerStrokePlacement(h.markerPlacement))&&"fill"===p||c.isCIMFill(h)&&"outline"===p)continue}else if(c.isCIMStroke(h)||c.isCIMMarker(h)&&h.markerPlacement&&c.isCIMMarkerStrokePlacement(h.markerPlacement))continue;p=r.toArray();switch(h.type){case "CIMPictureMarker":case "CIMPictureStroke":case "CIMPictureFill":h.tintColor=p;break;case "CIMVectorMarker":h.markerGraphics.forEach(m=>{e(m.symbol,r,y)});break;case "CIMSolidStroke":case "CIMSolidFill":h.color=p;break;case "CIMHatchFill":e(h.lineSymbol,
r,y)}}}a.applyCIMSymbolColor=function(k,r,y){r instanceof b||(r=new b(r));(k=c.toCIMSymbolJSON(k))&&e(k,r,y)};a.applyCIMSymbolRotation=function(k,r,y=!1){k=c.toCIMSymbolJSON(k);y&&0!==r&&(r=360-r);if("CIMTextSymbol"===k.type)k.angle=r;else if("CIMPointSymbol"===k.type&&k.symbolLayers){y=r-(k.angle||0);for(const p of k.symbolLayers)if(c.isCIMMarker(p)){let h=p.rotation||0;h=p.rotateClockwise?h-y:h+y;p.rotation=h}k.angle=r}};a.getCIMSymbolColor=function(k){k=c.toCIMSymbolJSON(k);const r=[];n(k,r);return r.length?
new b(c.fromCIMColor(r[0])):null};a.getCIMSymbolRotation=function(k,r=!1){k=c.toCIMSymbolJSON(k);return"CIMTextSymbol"===k.type||"CIMPointSymbol"===k.type?r&&0!==k.angle?360-k.angle:k.angle||0:0};a.getCIMSymbolSize=d;a.scaleCIMMarker=x;a.scaleCIMSymbolTo=function(k,r,y){const p=c.toCIMSymbolJSON(k);k=d(k);if(0===k)if("CIMTextSymbol"===p.type)p.height=r;else{if(p.symbolLayers)for(const h of p.symbolLayers)switch(h.type){case "CIMPictureMarker":case "CIMVectorMarker":h.size=r;break;case "CIMPictureStroke":case "CIMSolidStroke":h.width=
r}}else g(p,r/k,!1,y)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/symbols/cim/utils":function(){define(["require","exports"],function(a,b){function c(d,g){"string"!==typeof d&&(d=String(d));switch(g){case "LowerCase":return d.toLowerCase();case "Allcaps":return d.toUpperCase();default:return d}}b._adjustTextCase=c;b.colorToArray=function(d){return[d.r,d.g,d.b,d.a]};b.createLabelOverrideFunction=function(d,g,x){const w=e=>{let k=e.length;for(;k--;)if(-1===" /-,\n".indexOf(e.charAt(k)))return!1;
return!0},l=[];var n=0;let f=-1;do f=g.indexOf("[",n),f>=n&&(f>n&&(n=g.substr(n,f-n),l.push([n,null,w(n)])),n=f+1,f=g.indexOf("]",n),f>=n&&(f>n&&(n=g.substr(n,f-n),(n=d[n])&&l.push([null,n,!1])),n=f+1));while(-1!==f);n<g.length-1&&(d=g.substr(n),l.push([d,null,w(d)]));return e=>{let k="",r=null;for(const y of l){const [p,h,m]=y;if(p)m?r=p:(r&&(k+=r,r=null),k+=p);else{const u=e.attributes[h];u&&(r&&(k+=r,r=null),k+=u)}}return c(k,x)}};b.evaluateValueOrFunction=function(d,g,x,w){return"function"===
typeof d?d(g,x,w):d};b.fromCIMColor=function(d){return d?{r:d[0],g:d[1],b:d[2],a:d[3]/255}:{r:0,g:0,b:0,a:0}};b.getValue=d=>isNaN(d)||!d?0:d;b.importGeometryEngine=function(){return new Promise((d,g)=>a(["../../geometry/geometryEngineJSON"],d,g))};b.isCIMFill=function(d){return"CIMGradientFill"===d.type||"CIMHatchFill"===d.type||"CIMPictureFill"===d.type||"CIMSolidFill"===d.type||"CIMWaterFill"===d.type};b.isCIMMarker=function(d){return"CIMVectorMarker"===d.type||"CIMPictureMarker"===d.type||"CIMBarChartMarker"===
d.type||"CIMCharacterMarker"===d.type||"CIMPieChartMarker"===d.type||"CIMStackedBarChartMarker"===d.type};b.isCIMMarkerStrokePlacement=function(d){return"CIMMarkerPlacementAlongLineRandomSize"===d.type||"CIMMarkerPlacementAlongLineSameSize"===d.type||"CIMMarkerPlacementAlongLineVariableSize"===d.type||"CIMMarkerPlacementAtExtremities"===d.type||"CIMMarkerPlacementAtMeasuredUnits"===d.type||"CIMMarkerPlacementAtRatioPositions"===d.type||"CIMMarkerPlacementOnLine"===d.type||"CIMMarkerPlacementOnVertices"===
d.type};b.isCIMStroke=function(d){return"CIMGradientStroke"===d.type||"CIMPictureStroke"===d.type||"CIMSolidStroke"===d.type};b.isGeometryEngineRequired=d=>{if(!d)return!1;for(const g of d)switch(g.type){case "CIMGeometricEffectBuffer":case "CIMGeometricEffectOffset":return!0}return!1};b.resampleHermite=function(d,g,x,w,l,n,f=!0){const e=g/l;x/=n;const k=Math.ceil(e/2),r=Math.ceil(x/2);for(let h=0;h<n;h++)for(let m=0;m<l;m++){const u=4*(m+(f?n-h-1:h)*l);var y=0;let t=0,q=0,z=0,v=0,B=0,A=0;const E=
(h+.5)*x;for(let C=Math.floor(h*x);C<(h+1)*x;C++){var p=Math.abs(E-(C+.5))/r;const D=(m+.5)*e;p*=p;for(let F=Math.floor(m*e);F<(m+1)*e;F++){let G=Math.abs(D-(F+.5))/k;y=Math.sqrt(p+G*G);-1<=y&&1>=y&&(y=2*y*y*y-3*y*y+1,0<y&&(G=4*(F+C*g),A+=y*d[G+3],q+=y,255>d[G+3]&&(y=y*d[G+3]/250),z+=y*d[G],v+=y*d[G+1],B+=y*d[G+2],t+=y))}}w[u]=z/t;w[u+1]=v/t;w[u+2]=B/t;w[u+3]=A/q}};b.toCIMSymbolJSON=function(d){var g;return null==(g=d.data)?void 0:g.symbol};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/support/layerViewUtils":function(){define(["exports",
"../../core/maybe"],function(a,b){a.extractSafeScaleBounds=function(c){var d,g;const x=c.effectiveScaleRange;c=null!=(d=null==x?void 0:x.minScale)?d:0;d=null!=(g=null==x?void 0:x.maxScale)?g:0;return{minScale:c,maxScale:d}};a.highlightsSupported=function(c){return c&&"function"===typeof c.highlight};a.isScaleRangeActive=function(c,d){return 0<c||0<d};a.occludeesSupported=function(c){return c&&"function"===typeof c.maskOccludee};a.scaleBoundsPredicate=function(c,d,g){return b.isNone(c)||c>g&&(0===
d||c<d)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/widgets/Popup/actions":function(){define(["exports","../../support/actions/ActionButton"],function(a,b){const c=new b({id:"zoom-to-feature",title:"{messages.zoom}",className:"esri-icon-zoom-in-magnifying-glass"}),d=new b({id:"remove-selected-feature",title:"{messages.remove}",className:"esri-icon-trash"}),g=new b({id:"zoom-to-clustered-features",title:"{messages.zoom}",className:"esri-icon-zoom-in-magnifying-glass"});b=new b({id:"browse-clustered-features",
title:"{messages.browseClusteredFeatures}",className:"esri-icon-table"});a.all=[c,d,b,g];a.browseClusteredFeatures=b;a.removeSelectedFeature=d;a.zoomToClusteredFeatures=g;a.zoomToFeature=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/widgets/Popup/actionUtils":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/Error ../../core/Logger ../../core/promiseUtils ./actions".split(" "),function(a,b,c,d,g,x){function w(h){const {selectedFeature:m,location:u,view:t}=
h;return t?"3d"===t.type?m||u:h.get("selectedFeature.geometry")||u:null}function l(h,m){if("3d"!==(null==m?void 0:m.type)||!h||"esri.Graphic"!==h.declaredClass)return!0;if((m=m.getViewForGraphic(h))&&"whenGraphicBounds"in m){let u=!1;m.whenGraphicBounds(h,{useViewElevation:!0}).then(t=>{u=!t||!t.boundingBox||t.boundingBox[0]===t.boundingBox[3]&&t.boundingBox[1]===t.boundingBox[4]&&t.boundingBox[2]===t.boundingBox[5]}).catch(()=>{const t=new c("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",
{graphic:h});p.error(t)});return u}return!0}function n(h){return f.apply(this,arguments)}function f(){f=b._asyncToGenerator(function*(h){const {location:m,selectedFeature:u,view:t,zoomFactor:q}=h,z=w(h);if(!z)return h=new c("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:z,view:t}),p.error(h),Promise.reject(h);const v=t.scale/q,B=h.get("selectedFeature.geometry")||m,A=B&&"point"===B.type&&l(u,t);x.zoomToFeature.active=!0;x.zoomToFeature.disabled=!0;try{yield h.view.goTo({target:z,
scale:A?v:void 0})}finally{x.zoomToFeature.active=!1,x.zoomToFeature.disabled=!1,h.zoomToLocation=null,A&&(h.location=B)}});return f.apply(this,arguments)}function e(h){return k.apply(this,arguments)}function k(){k=b._asyncToGenerator(function*(h){const {selectedFeature:m,view:u}=h;if("2d"!==(null==u?void 0:u.type))throw h=new c("zoomToCluster:invalid-view","View must be 2d MapView.",{view:u}),p.error(h),h;if(!m.isAggregate)throw h=new c("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",
{selectedFeature:m}),p.error(h),h;h=yield u.whenLayerView(m.sourceLayer);const t=h.createQuery();t.aggregateIds=[m.getObjectId()];x.zoomToClusteredFeatures.active=!0;x.zoomToClusteredFeatures.disabled=!0;({extent:h}=yield h.queryExtent(t));yield u.goTo({target:h});x.zoomToClusteredFeatures.active=!1;x.zoomToClusteredFeatures.disabled=!1});return k.apply(this,arguments)}function r(){r=b._asyncToGenerator(function*(h){const {selectedFeature:m,view:u}=h;if("2d"!==(null==u?void 0:u.type))throw h=new c("displayClusterExtent:invalid-view",
"View must be 2d MapView.",{view:u}),p.error(h),h;if(!m.isAggregate)throw h=new c("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:m}),p.error(h),h;var t=yield u.whenLayerView(m.sourceLayer);const q=t.createQuery();q.aggregateIds=[m.getObjectId()];({extent:t}=yield t.queryExtent(q));h.selectedClusterBoundaryFeature.geometry=t;u.graphics.add(h.selectedClusterBoundaryFeature)});return r.apply(this,arguments)}function y(){y=b._asyncToGenerator(function*(h){const {selectedFeature:m,
view:u}=h;if("2d"!==(null==u?void 0:u.type))throw h=new c("browseAggregateFeatures:invalid-view","View must be 2d MapView.",{view:u}),p.error(h),h;if(!m.isAggregate)throw h=new c("browseAggregateFeatures:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:m}),p.error(h),h;h=yield u.whenLayerView(m.sourceLayer);const t=h.createQuery();t.aggregateIds=[m.getObjectId()];x.browseClusteredFeatures.active=!0;x.browseClusteredFeatures.disabled=!0;({features:h}=
yield h.queryFeatures(t));x.browseClusteredFeatures.active=!1;x.browseClusteredFeatures.disabled=!1;u.popup.open({features:[m].concat(h),featureMenuOpen:!0})});return y.apply(this,arguments)}const p=d.getLogger("esri.widgets.Popup.PopupViewModel");a.browseAggregateFeatures=function(h){return y.apply(this,arguments)};a.displayClusterExtent=function(h){return r.apply(this,arguments)};a.getSelectedTarget=w;a.isZoomScreenSize=l;a.removeClusteredFeaturesForBrowsing=function(h){var m;null!=(m=h.selectedFeature)&&
m.isAggregate&&(h.features=h.features.filter(u=>u.isAggregate))};a.triggerAction=function(h){const {event:m,view:u}=h;({action:h}=m);var t=u&&u.popup;if(!h)return Promise.reject(new c("trigger-action:missing-arguments","Event has no action"));if(!t)return Promise.reject(new c("trigger-action:missing-arguments","view.popup is missing"));const {disabled:q,id:z}=h;if(!z)return Promise.reject(new c("trigger-action:invalid-action","action.id is missing"));if(q)return Promise.reject(new c("trigger-action:invalid-action",
"Action is disabled"));if(z===x.zoomToFeature.id)return n(t.viewModel).catch(g.throwIfNotAbortError);if(z===x.zoomToClusteredFeatures.id)return e(t.viewModel);if(z===x.browseClusteredFeatures.id)return t.featureMenuOpen=!t.featureMenuOpen,t.viewModel.browseClusterEnabled=!t.viewModel.browseClusterEnabled,Promise.resolve();t.viewModel.browseClusterEnabled=!1;if(z===x.removeSelectedFeature.id){t.close();({selectedFeature:h}=t);if(!h)return Promise.reject(new c(`trigger-action:${x.removeSelectedFeature.id}`,
"selectedFeature is required",{selectedFeature:h}));({sourceLayer:t}=h);t?t.remove(h):u.graphics.remove(h)}return Promise.resolve()};a.zoomToClusterExtent=e;a.zoomToLocation=n;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/widgets/support/GoTo":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,d,g,x,w,l){a.GoToMixin=n=>{n=function(f){function e(...k){k=f.call(this,...k)||this;k.goToOverride=null;k.view=null;return k}b._inheritsLoose(e,f);e.prototype.callGoTo=function(k){const {view:r}=this;return this.goToOverride?this.goToOverride(r,k):r.goTo(k.target,k.options)};return e}(n);c.__decorate([d.property()],n.prototype,"goToOverride",void 0);c.__decorate([d.property()],n.prototype,"view",void 0);return n=c.__decorate([l.subclass("esri.widgets.support.GoTo")],n)};Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/GroundView":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/Accessor ../core/Collection ../core/Handles ../core/watchUtils ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ./support/GroundViewElevationSampler".split(" "),function(a,b,c,d,g,x,w,l,n,f,e,k){c=function(r){function y(h){h=r.call(this,h)||this;h.handles=new g;
h.view=null;h.layerViews=new d;return h}a._inheritsLoose(y,r);var p=y.prototype;p.initialize=function(){this.handles.add(x.when(this,"view.map.ground",h=>h.load()));this.handles.add(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))};p.destroy=function(){this._set("view",null);this.handles&&(this.handles.destroy(),this.handles=null)};p._layerViewsAfterChangesHandler=function(){this.handles.remove("updating");this.handles.add(this.layerViews.map(h=>h.watch("updating",()=>
this._updateUpdating(),!0)).toArray(),"updating");this._updateUpdating()};p._updateUpdating=function(){this.notifyChange("updating")};a._createClass(y,[{key:"elevationSampler",get:function(){return this.view&&"2d"!==this.view.type&&this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new k({view:this.view}):null}},{key:"updating",get:function(){return this.suspended?!1:this.layerViews.some(h=>h.updating)}},{key:"suspended",get:function(){return!this.view||this.view.suspended}}]);
return y}(c);b.__decorate([w.property({readOnly:!0})],c.prototype,"elevationSampler",null);b.__decorate([w.property({type:Boolean,readOnly:!0})],c.prototype,"updating",null);b.__decorate([w.property({constructOnly:!0})],c.prototype,"view",void 0);b.__decorate([w.property({type:d,readOnly:!0})],c.prototype,"layerViews",void 0);b.__decorate([w.property({readOnly:!0})],c.prototype,"suspended",null);return c=b.__decorate([e.subclass("esri.views.GroundView")],c)})},"esri/views/support/GroundViewElevationSampler":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Evented ../../core/Logger ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../geometry/support/aaBoundingRect ../../geometry/support/contains ../../geometry/support/webMercatorUtils ../../layers/support/ElevationSampler ../3d/support/ElevationProvider ../3d/terrain/TerrainConst".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h){const m=d.getLogger("esri.views.support.GroundViewElevationSampler");c=function(u){function t(z){z=u.call(this,z)||this;z.demResolution={min:-1,max:-1};z.noDataValue=h.ELEVATION_NODATA_VALUE;return z}a._inheritsLoose(t,u);var q=t.prototype;q.initialize=function(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))};q.elevationAt=function(z){var v=z.spatialReference;const B=this.spatialReference;return r.canProject(v,B)?g.isNone(this.extent)||
!k.extentContainsPoint(this.extent,z)?(v=g.isSome(this.extent)?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null,m.warn("#elevationAt()",`Point used to sample elevation (${z.x}, ${z.y}) is outside of the sampler extent (${v})`),this.noDataValue):p.getElevationAtPoint(this.view.elevationProvider,z):(m.error(`Cannot sample elevation at a location with spatial reference (${v?v.wkid:"unknown"}) different from the view (${B.wkid})`),null)};q.queryElevation=function(z){return y.updateGeometryElevation(z.clone(),
this)};a._createClass(t,[{key:"extent",get:function(){const z=this.view.basemapTerrain;return g.isSome(z.extent)&&z.spatialReference?e.toExtent(z.extent,z.spatialReference):null}}]);return t}(c.EventedAccessor);b.__decorate([x.property({readOnly:!0})],c.prototype,"demResolution",void 0);b.__decorate([x.property({readOnly:!0})],c.prototype,"extent",null);b.__decorate([x.property({readOnly:!0})],c.prototype,"noDataValue",void 0);b.__decorate([x.property({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],
c.prototype,"spatialReference",void 0);b.__decorate([x.property({constructOnly:!0})],c.prototype,"view",void 0);return c=b.__decorate([f.subclass("esri.views.support.GroundViewElevationSampler")],c)})},"esri/layers/support/ElevationSampler":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../geometry ../../core/has ../../core/Logger ../../core/maybe ../../core/unitUtils ../../geometry/support/aaBoundingRect ../../geometry/support/contains ../../geometry/support/webMercatorUtils ../../geometry/Point".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e){function k(u,t){const q=r(u,t.spatialReference);if(!q)return null;switch(u.type){case "point":u.z=x.unwrapOr(t.elevationAt(q),0);break;case "polyline":h.spatialReference=q.spatialReference;var z=u.hasM&&!u.hasZ;for(var v=0;v<u.paths.length;v++){var B=u.paths[v],A=q.paths[v];for(let E=0;E<B.length;E++){const C=B[E],D=A[E];h.x=D[0];h.y=D[1];z&&(C[3]=C[2]);C[2]=x.unwrapOr(t.elevationAt(h),0)}}u.hasZ=!0;break;case "multipoint":h.spatialReference=q.spatialReference;z=u.hasM&&
!u.hasZ;for(v=0;v<u.points.length;v++)B=u.points[v],A=q.points[v],h.x=A[0],h.y=A[1],z&&(B[3]=B[2]),B[2]=x.unwrapOr(t.elevationAt(h),0);u.hasZ=!0}return u}function r(u,t){if(x.isNone(u))return null;const q=u.spatialReference;if(q.equals(t))return u;(u=f.project(u,t))||y.error(`Cannot project geometry spatial reference (wkid:${q.wkid}) to elevation sampler spatial reference (wkid:${t.wkid})`);return u}const y=g.getLogger("esri.layers.support.ElevationSampler");c=function(){function u(){}var t=u.prototype;
t.queryElevation=function(q){return k(q.clone(),this)};t.on=function(){return m};t.projectIfRequired=function(q,z){return r(q,z)};return u}();let p=function(u){function t(z,v,B){var A=u.call(this)||this;A.tile=z;A.noDataValue=B;A.extent=l.toExtent(z.tile.extent,v.spatialReference);B=w.getMetersPerUnitForSR(v.spatialReference);z=v.lodAt(z.tile.level).resolution*B;A.demResolution={min:z,max:z};return A}b._inheritsLoose(t,u);var q=t.prototype;q.contains=function(z){z=this.projectIfRequired(z,this.spatialReference);
return n.extentContainsPoint(this.extent,z)};q.elevationAt=function(z){var v=this.projectIfRequired(z,this.spatialReference);return x.isNone(v)?null:this.contains(z)?this.tile.sample(v.x,v.y):(v=this.extent,y.warn("#elevationAt()",`Point used to sample elevation (${z.x}, ${z.y}) is outside of the sampler extent (${`${v.xmin}, ${v.ymin}, ${v.xmax}, ${v.ymax}`})`),this.noDataValue)};b._createClass(t,[{key:"spatialReference",get:function(){return this.extent.spatialReference}}]);return t}(c);d=function(u){function t(q,
z,v){var B=u.call(this)||this;let A;"number"===typeof z?(B.noDataValue=z,A=null):(A=z,B.noDataValue=v);B.samplers=A?q.map(E=>new p(E,A,B.noDataValue)):q;if(q=B.samplers[0]){B.extent=q.extent.clone();const {min:E,max:C}=q.demResolution;B.demResolution={min:E,max:C};for(q=1;q<B.samplers.length;q++)z=B.samplers[q],B.extent.union(z.extent),B.demResolution.min=Math.min(B.demResolution.min,z.demResolution.min),B.demResolution.max=Math.max(B.demResolution.max,z.demResolution.max)}else B.extent=l.toExtent(l.create(),
A.spatialReference),B.demResolution={min:0,max:0};return B}b._inheritsLoose(t,u);t.prototype.elevationAt=function(q){const z=this.projectIfRequired(q,this.spatialReference);if(!z)return null;for(const v of this.samplers)if(v.contains(z))return v.elevationAt(z);y.warn("#elevationAt()",`Point used to sample elevation (${q.x}, ${q.y}) is outside of the sampler`);return this.noDataValue};b._createClass(t,[{key:"spatialReference",get:function(){return this.extent.spatialReference}}]);return t}(c);const h=
new e,m={remove(){}};a.ElevationSamplerBase=c;a.MultiTileElevationSampler=d;a.TileElevationSampler=p;a.updateGeometryElevation=k;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/TerrainConst":function(){define(["exports","../../../core/mathUtils","../../../geometry/support/aaBoundingRect","./TilingScheme"],function(a,b,c,d){b=b.clampFloat32(b.NUMBER_MAX_FLOAT32/10);const g=c.create();d.default.WebMercatorAuxiliarySphere.getExtent(0,0,0,g);c=c.create([-180,-90,180,90]);a.DEFAULT_TILE_BACKGROUND=
"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAIAAADTED8xAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAA2JJREFUeNrs3d1O20AQgFFvRJInQLQBhHj/h0JVW34El1yQ2F73DVq3jTys55zrqUBbPrErZUSZ+vcOsto4AjK76Lqu1vr8+G3mPzjc3D/+eJj/Bcz/cd75R80fbu79BsAVCAQAAgABgABAACAAEAAIAAQAAgABQPOKfQAy83Ho+HnnHzXv49B4A4AAQAAgABAACAAEAAIAAYAAQAAgABAANM4+AKnZB4ifd/5R8/YB8AYAAYAAQAAgABAACAAEAAIAAYAAQAAgAGicfQBSsw8QP+/8o+btA+ANAAIAAYAAQAAgABAACAAEAAIAAYAAQADQOPsApGYfIH7e+UfN2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAXA201QdggAggH0AUrMPED8/jsPL03fns/y8fQC8AUAAIAAQAAgABAACAAGAAEAAIAAQAAgAGmcfgNTsA8TP2weImrcPgDcACAAEAAIAAYAAQAAgABAACAAEAAIAAUDj7AOQmn2A+Hn7AFHz9gHwBgABgABAACAAEAAIAAQAAgABgABgNS4cAf9pu9u3O1+m/n2aplKK/0j+TX86/tVP5+eZ3+729gFIfwWyDxA7bx8gat4+ANkJAAGAAEAAIAAQAAgABAACAAGAAEAAIABonn0AUrMPED9vHyBq3j4A3gAgABAACAAEAAIAAYAAQAAgABAA51VrdQgCAAHAsuwDkJp9gPj5vj+9vvx0PsvP2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAYAAoHH2AUjNPkD8vH2AqHn7AHgDgABAACAAEAAIAAQAAgABgABAACAAEAA0zj4AqdkHiJ+3DxA1bx8AbwAQACQ0DL0AyKuOowBwBYKUSikCIHUBAsAVCAQAAgABgABAALBy9gFIzT5A/Lx9gKj5y6trVyC8AUAAIAAQAAgAVq90Pg5N5gA2AsAVCAQAAgABgABAALB29gFIzT5A/Lx9gKj5q6+3rkB4A4AAQAAgABAACADWzB/IIHsCAsAVCARAlKlWhyAAEAAIABZjH4DU7APEz5+OH2+vT85n+fkvhztXILwBQAAgABAACAAEAGtWigBIHcBGALgCgQBAACAAyPMO9nHosxuHodZx5vB2t691HIdh/nx/Os7/Zsz/fvgXAAAA//8DAF1P1hM2ICMfAAAAAElFTkSuQmCC";
a.ELEVATION_DESIRED_MAX_UPSCALING_DISTANCE=4;a.ELEVATION_NODATA_VALUE=b;a.GEOGRAPHIC_WORLD_EXTENT=c;a.GEOMETRY_VERTEX_STRIDE=5;a.MAX_MEMORY_LOD_BIAS=2.5;a.MAX_PATCH_TESSELATION=512;a.MAX_ROOT_TILES=64;a.PROGRESSIVE_LOADING_MODULO=4;a.TILE_LOADING_DEBUGLOG=!1;a.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR="Cannot extend surface to encompass all layers because it would result in too many root tiles.";a.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR="Surface extent is too large for tile resolution at level 0.";a.WEBMERCATOR_WORLD_EXTENT=
g;a.getElevationDesiredResolutionLevel=x=>4>x?3:4;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/TilingScheme":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Error ../../../core/mathUtils ../../../core/maybe ../../../core/unitUtils ../../../geometry/Extent ../../../geometry/projection ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils ../../../layers/support/TileInfo".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r){function y(){return new c("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}let p=function(){function m(t){var q=m.checkUnsupported(t);if(g.isSome(q))throw q;t=g.unwrap(t);this.spatialReference=t.spatialReference;this._isWebMercator=this.spatialReference.isWebMercator;this._isGCS=l.canProjectToWGS84ComparableLonLat(this.spatialReference)||e.isMars(this.spatialReference)||e.isMoon(this.spatialReference);this.origin=[t.origin.x,t.origin.y];
this.pixelSize=t.size[0];this.dpi=t.dpi;var z=t.lods.reduce(function(A,E,C){E.level<A.min&&(A.min=E.level,A.minIndex=C);A.max=Math.max(A.max,E.level);return A},{min:Infinity,minIndex:0,max:-Infinity}),v=t.lods[z.minIndex];const B=2**v.level;q=v.resolution*B;v=v.scale*B;this.levels=Array(z.max+1);for(z=0;z<this.levels.length;z++)this.levels[z]={resolution:q,scale:v,tileSize:[q*t.size[0],q*t.size[1]]},q/=2,v/=2}var u=m.prototype;u.clone=function(){return new m(this.toTileInfo())};u.toTileInfo=function(){return new r({dpi:this.dpi,
origin:{x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference},size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((t,q)=>({level:q,scale:t.scale,resolution:t.resolution}))})};u.getExtent=function(t,q,z,v){var B=this.levels[t];t=B.tileSize[0];B=B.tileSize[1];v[0]=this.origin[0]+z*t;v[2]=v[0]+t;v[3]=this.origin[1]-q*B;v[1]=v[3]-B};u.convertExtentToRadians=function(t,q){this._isWebMercator?(q[0]=k.x2lon(t[0]),q[1]=k.y2lat(t[1]),q[2]=k.x2lon(t[2]),
q[3]=k.y2lat(t[3])):this._isGCS&&(q[0]=d.deg2rad(t[0]),q[1]=d.deg2rad(t[1]),q[2]=d.deg2rad(t[2]),q[3]=d.deg2rad(t[3]))};u.getExtentGeometry=function(t,q,z,v=new w){this.getExtent(t,q,z,h);v.spatialReference=this.spatialReference;v.xmin=h[0];v.ymin=h[1];v.xmax=h[2];v.ymax=h[3];v.zmin=void 0;v.zmax=void 0;return v};u.ensureMaxLod=function(t){if(null==t)return!1;for(var q=!1;this.levels.length<=t;){q=this.levels[this.levels.length-1];const z=q.resolution/2;this.levels.push({resolution:z,scale:q.scale/
2,tileSize:[z*this.pixelSize,z*this.pixelSize]});q=!0}return q};u.capMaxLod=function(t){this.levels.length>t+1&&(this.levels.length=t+1)};u.getMaxLod=function(){return this.levels.length-1};u.scaleAtLevel=function(t){return this.levels[0].scale/2**t};u.levelAtScale=function(t){const q=this.levels[0].scale;return t>=q?0:Math.log(q/t)*Math.LOG2E};u.resolutionAtLevel=function(t){return this.levels[0].resolution/2**t};u.compatibleWith=function(t){if(!(t instanceof m)){if(m.checkUnsupported(t))return!1;
t=new m(t)}if(!t.spatialReference.equals(this.spatialReference)||t.pixelSize!==this.pixelSize)return!1;const q=Math.min(this.levels.length,t.levels.length)-1,z=this.levels[q].resolution;let v=.5*z;if(!d.floatEqualAbsolute(t.origin[0],this.origin[0],v)||!d.floatEqualAbsolute(t.origin[1],this.origin[1],v))return!1;v=.5*z/2**q/this.pixelSize*12;return d.floatEqualAbsolute(z,t.levels[q].resolution,v)};u.rootTilesInExtent=function(t,q=null,z=Infinity){const v=[],B=this.levels[0].tileSize;if(g.isNone(t)||
0===B[0]||0===B[1])return v;m.computeRowColExtent(t,B,this.origin,h);t=h[1];let A=h[3],E=h[0],C=h[2];var D=C-E;const F=A-t;D*F>z&&(z=Math.floor(Math.sqrt(z)),F>z&&(t=t+Math.floor(.5*F)-Math.floor(.5*z),A=t+z),D>z&&(E=E+Math.floor(.5*D)-Math.floor(.5*z),C=E+z));for(z=t;z<A;z++)for(D=E;D<C;D++)v.push([0,z,D]);g.isSome(q)&&(q[0]=this.origin[0]+E*B[0],q[1]=this.origin[1]-A*B[1],q[2]=this.origin[0]+C*B[0],q[3]=this.origin[1]-t*B[1]);return v};m.computeRowColExtent=function(t,q,z,v){const B=.001*(t[2]-
t[0]+(t[3]-t[1]));v[0]=Math.max(0,Math.floor((t[0]+B-z[0])/q[0]));v[2]=Math.max(0,Math.ceil((t[2]-B-z[0])/q[0]));v[1]=Math.max(0,Math.floor((z[1]-t[3]+B)/q[1]));v[3]=Math.max(0,Math.ceil((z[1]-t[1]-B)/q[1]))};m.isPowerOfTwo=function(t){t=t.lods;const q=t[0].resolution*2**t[0].level;return!t.some(function(z){return!d.floatEqualRelative(z.resolution,q/2**z.level)})};m.hasGapInLevels=function(t){t=t.lods.map(function(q){return q.level});t.sort(function(q,z){return q-z});for(let q=1;q<t.length;q++)if(t[q]!==
t[0]+q)return!0;return!1};m.tileSizeSupported=function(t){const q=t.size[1];return q===t.size[0]&&0===(q&q-1)&&128<=q&&512>=q};m.hasOriginPerLODs=function(t){const q=t.origin;return t.lods.some(z=>null!=z.origin&&(z.origin[0]!==q.x||z.origin[1]!==q.y))};m.getMissingTileInfoError=function(){return new c("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")};m.checkUnsupported=function(t){return g.isNone(t)?y():1>t.lods.length?new c("tilingscheme:generic","Tiling scheme must have at least one level"):
m.isPowerOfTwo(t)?m.hasGapInLevels(t)?new c("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):m.tileSizeSupported(t)?m.hasOriginPerLODs(t)?new c("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new c("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new c("tilingscheme:power-of-two","Tiling scheme must be power of two")};m.fromExtent=function(t,q){const z=t[2]-t[0],v=t[3]-t[1],B=
x.getMetersPerUnitForSR(q),A=1.2*Math.max(z,v);t=new m(new r({size:[256,256],origin:{x:t[0]-.5*(A-z),y:t[3]+.5*(A-v)},lods:[{level:0,resolution:A/256,scale:1/(256/96*.0254/(A*B))}],spatialReference:q}));t.ensureMaxLod(20);return t};m.makeWebMercatorAuxiliarySphere=function(t){const q=new m(m.WebMercatorAuxiliarySphereTileInfo);q.ensureMaxLod(t);return q};m.makeGCSWithTileSize=function(t,q=256,z=16){const v=256/q;t=new m(new r({size:[q,q],origin:{x:-180,y:90,spatialReference:t},spatialReference:t,
lods:[{level:0,resolution:.703125*v,scale:2.95497598570834E8*v}]}));t.ensureMaxLod(z);return t};b._createClass(m,[{key:"test",get:function(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}}]);return m}();p.WebMercatorAuxiliarySphereTileInfo=new r({size:[256,256],origin:{x:-2.0037508342787E7,y:2.0037508342787E7,spatialReference:n.WebMercator},spatialReference:n.WebMercator,lods:[{level:0,resolution:156543.03392800014,scale:5.91657527591555E8}]});p.WebMercatorAuxiliarySphere=p.makeWebMercatorAuxiliarySphere(19);
const h=f.create();a.default=p;a.getMissingTileInfoError=y;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/PopupView":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/maybe ../core/promiseUtils ../core/Logger ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/set ../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,d,g,x,w,l,n,f,e){a.PopupView=k=>{k=function(r){function y(){return r.apply(this,
arguments)||this}b._inheritsLoose(y,r);var p=y.prototype;p.fetchPopupFeatures=function(){var h=b._asyncToGenerator(function*(m,u){yield this.when();const {location:t,queryArea:q,layerViewsAndGraphics:z,clientOnlyGraphics:v}=yield this._prepareFetchPopupFeatures(m,u);m=Promise.resolve(v);u=this._queryLayerPopupFeatures(q,z,u);const B=u.map(A=>A.promise);m=g.eachAlwaysValues([m,...B]).then(A=>Array.from(new Set(A.flat())));return{location:t,clientOnlyGraphics:v,allGraphicsPromise:m,promisesPerLayerView:u}});
return function(m,u){return h.apply(this,arguments)}}();p._queryLayerPopupFeatures=function(h,m,u){return m.map(({layerView:t,graphics:q})=>{q={clientGraphics:q,event:d.isSome(u)?u.event:null,signal:d.isSome(u)?u.signal:null,defaultPopupTemplateEnabled:d.isSome(u)?!!u.defaultPopupTemplateEnabled:!1};q=t.fetchPopupFeatures(h,q);return{layerView:t,promise:q}})};p._isValidPopupGraphic=function(h,m){return h&&!!h.getEffectivePopupTemplate(d.isSome(m)&&m.defaultPopupTemplateEnabled)};p._prepareFetchPopupFeatures=
function(){var h=b._asyncToGenerator(function*(m,u){const {clientGraphics:t,queryArea:q,location:z}=yield this._popupHitTestGraphics(m,u);m=this._getFetchPopupLayerViews();const {layerViewsAndGraphics:v,clientOnlyGraphics:B}=this._graphicsPerFetchPopupLayerView(t,m);return{clientOnlyGraphics:B,layerViewsAndGraphics:v,queryArea:q,location:z}});return function(m,u){return h.apply(this,arguments)}}();p._popupHitTestGraphics=function(){var h=b._asyncToGenerator(function*(m,u){const {results:t,mapPoint:q}=
yield this.popupHitTest(m);m=t.filter(v=>this._isValidPopupGraphic(v.graphic,u));const z=m.length?m[0].mapPoint:null;return{clientGraphics:m.map(v=>v.graphic),queryArea:q,location:q||z}});return function(m,u){return h.apply(this,arguments)}}();p._getFetchPopupLayerViews=function(){const h=[];this.allLayerViews.forEach(m=>{this._isValidPopupLayerView(m)&&h.push(m)});d.isSome(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&h.push(this.graphicsView);return h.reverse()};p._isValidPopupLayerView=
function(h){return d.isSome(h)&&(!("layer"in h)||!h.suspended)&&"fetchPopupFeatures"in h};p._graphicsPerFetchPopupLayerView=function(h,m){const u=[],t=new Map;m=m.map(q=>{const z=[];"layer"in q?t.set(q.layer,z):t.set(q.graphics,z);return{layerView:q,graphics:z}});for(const q of h)(h=t.get(q.layer)||t.get(q.sourceLayer)||null)?h.push(q):u.push(q);return{layerViewsAndGraphics:m,clientOnlyGraphics:u}};return y}(k);return k=c.__decorate([e.subclass("esri.views.PopupView")],k)};Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/layerViewModuleImportUtils":function(){define(["require","exports","../../core/Error","../../core/maybe"],function(a,b,c,d){const g=n=>Object.freeze({__proto__:null,default:n}),x=()=>new Promise((n,f)=>a(["./layers/TileLayerView3D"],e=>n(g(e)),f)),w=()=>new Promise((n,f)=>a(["./layers/ElevationLayerView3D"],e=>n(g(e)),f)),l={analysis:()=>new Promise((n,f)=>a(["./layers/AnalysisLayerView3D"],e=>n(g(e)),f)),"base-dynamic":()=>new Promise((n,f)=>a(["./layers/BaseDynamicLayerView3D"],
e=>n(g(e)),f)),"base-elevation":w,"base-tile":x,"bing-maps":x,"building-scene":()=>new Promise((n,f)=>a(["./layers/BuildingSceneLayerView3D"],e=>n(g(e)),f)),csv:()=>new Promise((n,f)=>a(["./layers/CSVLayerView3D"],e=>n(g(e)),f)),elevation:w,feature:()=>new Promise((n,f)=>a(["./layers/FeatureLayerView3D"],e=>n(g(e)),f)),geojson:()=>new Promise((n,f)=>a(["./layers/GeoJSONLayerView3D"],e=>n(g(e)),f)),graphics:()=>new Promise((n,f)=>a(["./layers/GraphicsLayerView3D"],e=>n(g(e)),f)),group:()=>new Promise((n,
f)=>a(["../layers/GroupLayerView"],e=>n(g(e)),f)),imagery:()=>new Promise((n,f)=>a(["./layers/ImageryLayerView3D"],e=>n(g(e)),f)),"integrated-mesh":()=>new Promise((n,f)=>a(["./layers/IntegratedMeshLayerView3D"],e=>n(g(e)),f)),"map-image":()=>new Promise((n,f)=>a(["./layers/MapImageLayerView3D"],e=>n(g(e)),f)),"ogc-feature":()=>new Promise((n,f)=>a(["./layers/OGCFeatureLayerView3D"],e=>n(g(e)),f)),"open-street-map":x,"point-cloud":()=>new Promise((n,f)=>a(["./layers/PointCloudLayerView3D"],e=>n(g(e)),
f)),voxel:()=>new Promise((n,f)=>a(["./layers/VoxelLayerView3D"],e=>n(g(e)),f)),route:()=>new Promise((n,f)=>a(["./layers/RouteLayerView3D"],e=>n(g(e)),f)),scene:n=>null==n.profile||"mesh-pyramids"===n.profile?new Promise((f,e)=>a(["./layers/SceneLayerView3D"],k=>f(g(k)),e)):new Promise((f,e)=>a(["./layers/SceneLayerGraphicsView3D"],k=>f(g(k)),e)),stream:()=>new Promise((n,f)=>a(["./layers/StreamLayerView3D"],e=>n(g(e)),f)),tile:x,"imagery-tile":()=>new Promise((n,f)=>a(["./layers/ImageryTileLayerView3D"],
e=>n(g(e)),f)),"vector-tile":()=>new Promise((n,f)=>a(["./layers/VectorTileLayerView3D"],e=>n(g(e)),f)),wcs:()=>new Promise((n,f)=>a(["./layers/ImageryTileLayerView3D"],e=>n(g(e)),f)),"web-tile":x,wfs:()=>new Promise((n,f)=>a(["./layers/WFSLayerView3D"],e=>n(g(e)),f)),wms:()=>new Promise((n,f)=>a(["./layers/WMSLayerView3D"],e=>n(g(e)),f)),wmts:()=>new Promise((n,f)=>a(["./layers/WMTSLayerView3D"],e=>n(g(e)),f)),"geo-rss":null,kml:null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null};
b.layerView3DImporter={hasLayerViewModule:n=>d.isSome(l[n.type]),importLayerView:n=>{var f=l[n.type];if(!d.isSome(f))throw n=n.declaredClass?n.declaredClass.slice(n.declaredClass.lastIndexOf(".")+1):"Unknown",f=n.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),n=new c(`${f}:view-not-supported`,`${n} is not supported in 3D`),n;return f(n)}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/analysis/AnalysisViewManager3D":function(){define("require ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Collection ../../../core/Error ../../../core/HandleOwner ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/scheduling ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r){const y=u=>Object.freeze({__proto__:null,default:u}),p=l.getLogger("esri.views.3d.analysis.AnalysisViewManager3D");var h;(function(u){u[u.PENDING=0]="PENDING";u[u.CREATED=1]="CREATED"})(h||(h={}));var m;(function(u){u[u.ADDED=0]="ADDED";u[u.REMOVED=1]="REMOVED"})(m||(m={}));d=function(u){function t(z){z=u.call(this,z)||this;z._allAnalysisViews=new g;z._creatingViewCount=0;z._items=new Map;z._scheduledUpdateHandle=null;z._analysisModules={"area-measurement":{module:null},
"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}};return z}b._inheritsLoose(t,u);var q=t.prototype;q.destroy=function(){this.detach()};q.attach=function(){this.handles.add(this._connectOwner(this.view),"analyses-owner-handles")};q.detach=function(){this.handles.remove("analyses-owner-handles");this._update();this._creatingViewCount=0};q.whenAnalysisView=function(z){const v=this._items.get(z);return n.isNone(v)||v.state.list===m.REMOVED?(z=new x("AnalysisViewManager:no-analysisview-for-analysis",
"The analysis has not been added to view.analyses",{analysis:z}),Promise.reject(z)):v.createAnalysisViewTask.promise};q._connectOwner=function(z){return this._connectAnalysesCollection(z.analyses)};q._connectAnalysesCollection=function(z){for(const A of z)this._addAnalysis(A);const v=z.on("after-add",A=>this._addAnalysis(A.item)),B=z.on("after-remove",A=>this._removeAnalysis(A.item));return{remove:()=>{v.remove();B.remove();for(const A of z)this._removeAnalysis(A)}}};q._addAnalysis=function(z){const v=
this._items.get(z);if(null==v){const B={state:{view:h.PENDING,list:m.ADDED},analysis:z,view:null,createAnalysisViewTask:null};this._items.set(z,B);B.createAnalysisViewTask=f.createTask(A=>this._createAnalysisViewPromise(B,A))}else v.state.list=m.ADDED};q._removeAnalysis=function(z){z=this._items.get(z);null==z?p.error("Trying to remove analysis which was not added"):(z.state.list=m.REMOVED,this._scheduleUpdate())};q._scheduleUpdate=function(){n.isSome(this._scheduledUpdateHandle)||(this._scheduledUpdateHandle=
e.schedule(()=>this._update()))};q._update=function(){this._scheduledUpdateHandle=n.removeMaybe(this._scheduledUpdateHandle);this._items.forEach(z=>{if(z.state.list===m.REMOVED)switch(this._items.delete(z.analysis),z.state.view){case h.PENDING:z.createAnalysisViewTask=n.abortMaybe(z.createAnalysisViewTask);break;case h.CREATED:n.isSome(z.view)&&(this._allAnalysisViews.remove(z.view),z.view=n.destroyMaybe(z.view),z.createAnalysisViewTask=null)}})};q._createAnalysisViewPromise=function(){var z=b._asyncToGenerator(function*(v,
B){var A=v.analysis;const E=A.type,C=this._analysisModules[E];this._creatingViewCount+=1;if(n.isNone(C.module))try{C.module=yield this._loadAnalysisModule(E)}catch(D){throw--this._creatingViewCount,D;}if(f.isAborted(B))throw--this._creatingViewCount,f.createAbortError("AnalysisView creation aborted");A=new C.module.default({analysis:A,view:this.view});try{yield A.when()}catch(D){throw--this._creatingViewCount,D;}if(f.isAborted(B))throw--this._creatingViewCount,A.destroy(),f.createAbortError("AnalysisView creation aborted");
v.view=A;v.state.view=h.CREATED;this._allAnalysisViews.add(A);--this._creatingViewCount;return A});return function(v,B){return z.apply(this,arguments)}}();q._loadAnalysisModule=function(z){switch(z){case "area-measurement":return new Promise((v,B)=>a(["./AreaMeasurementAnalysisView3D"],A=>v(y(A)),B));case "direct-line-measurement":return new Promise((v,B)=>a(["./DirectLineMeasurementAnalysisView3D"],A=>v(y(A)),B));case "line-of-sight":return new Promise((v,B)=>a(["./LineOfSightAnalysisView3D"],A=>
v(y(A)),B));case "slice":return new Promise((v,B)=>a(["./SliceAnalysisView3D"],A=>v(y(A)),B));default:return null}};b._createClass(t,[{key:"updating",get:function(){return!this.view.ready||0!==this._creatingViewCount||this._allAnalysisViews.some(z=>z.updating)}},{key:"testInfo",get:function(){return{allAnalysisViews:this._allAnalysisViews}}}]);return t}(w.HandleOwnerMixin(d));c.__decorate([k.property()],d.prototype,"updating",null);c.__decorate([k.property({constructOnly:!0})],d.prototype,"view",
void 0);c.__decorate([k.property()],d.prototype,"_allAnalysisViews",void 0);c.__decorate([k.property()],d.prototype,"_creatingViewCount",void 0);return d=c.__decorate([r.subclass("esri.views.3d.analysis.AnalysisViewManager3D")],d)})},"esri/views/3d/constraints/Constraints":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./AltitudeConstraint ./ClipDistanceConstraint ./TiltConstraint".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k){a.Constraints=function(r){function y(){var p=r.apply(this,arguments)||this;p.tilt=new k.default;p.altitude=new f.default;p.clipDistance=new e.default;return p}b._inheritsLoose(y,r);return y}(d);c.__decorate([g.property({type:k.default})],a.Constraints.prototype,"tilt",void 0);c.__decorate([g.property({type:f.default})],a.Constraints.prototype,"altitude",void 0);c.__decorate([g.property({type:e.default})],a.Constraints.prototype,"clipDistance",void 0);a.Constraints=
c.__decorate([n.subclass("esri.views.3d.constraints.Constraints")],a.Constraints);a.default=a.Constraints;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/constraints/AltitudeConstraint":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/deprecate ../../../core/Logger ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../state/Constraints".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k){a.AltitudeConstraint=function(r){function y(){var p=r.apply(this,arguments)||this;p.min=k.earthAltitudeConstraint.min;p.max=k.earthAltitudeConstraint.max;return p}b._inheritsLoose(y,r);b._createClass(y,[{key:"mode",get:function(){g.deprecated(x.getLogger(this.declaredClass),"esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.",{version:"4.6"});return"manual"},
set:function(p){g.deprecated(x.getLogger(this.declaredClass),"esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.",{version:"4.6"})}}]);return y}(d);c.__decorate([w.property({type:Number})],a.AltitudeConstraint.prototype,"min",void 0);c.__decorate([w.property({type:Number})],a.AltitudeConstraint.prototype,"max",void 0);a.AltitudeConstraint=c.__decorate([e.subclass("esri.views.3d.constraints.AltitudeConstraint")],
a.AltitudeConstraint);a.default=a.AltitudeConstraint;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/Constraints":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Logger ../../../core/mathUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/Ellipsoid ../../ViewingMode ../support/mathUtils".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y){const p=g.getLogger("esri.views.3d.state.Constraints");a.Constraints=function(t){function q(v){v=t.call(this,v)||this;v.collision=new u;v.distance=Infinity;v.minimumPoiDistance=4;return v}b._inheritsLoose(q,t);var z=q.prototype;z.clampAltitude=function(v){return this.altitude?x.clamp(v,this.altitude.min,this.altitude.max):v};z.clampTilt=function(v,B){if(!this.tilt)return B;v=this.tilt(v);return x.clamp(B,v.min,v.max)};z.clampDistance=function(v){return Math.min(v,
this.distance)};z.createDefaultTilt=function(){return this.mode===r.ViewingMode.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()};z.createConstantMaxTilt=function(v){return(B,A=m)=>{A.min=h.min;A.max=v;return A}};z._createDefaultTiltLocal=function(){const v=this.collision.enabled?y.makePiecewiseLinearFunction([[4E3,h.max],[1E4,x.deg2rad(88)],[6E6,x.deg2rad(88)]]):()=>h.max;return(B,A=m)=>{A.min=h.min;A.max=v(B);return A}};z._createDefaultTiltGlobal=function(){const v=this.collision.enabled?
y.makePiecewiseLinearFunction([[4E3,h.max],[5E4,x.deg2rad(88)],[6E6,x.deg2rad(88)],[2E7,h.min]]):y.makePiecewiseLinearFunction([[3E5,h.max],[3E6,x.deg2rad(88)],[6E6,x.deg2rad(88)],[2E7,h.min]]);return(B,A=m)=>{A.min=h.min;A.max=v(B);return A}};b._createClass(q,[{key:"altitude",get:function(){return this.mode===r.ViewingMode.Local?null:this._get("altitude")||null},set:function(v){this.mode===r.ViewingMode.Local?p.warn("Altitude constraint is ignored in local scenes"):this._set("altitude",v)}}]);return q}(d);
c.__decorate([w.property()],a.Constraints.prototype,"altitude",null);c.__decorate([w.property({readOnly:!0})],a.Constraints.prototype,"collision",void 0);c.__decorate([w.property()],a.Constraints.prototype,"distance",void 0);c.__decorate([w.property({readOnly:!0})],a.Constraints.prototype,"minimumPoiDistance",void 0);c.__decorate([w.property()],a.Constraints.prototype,"tilt",void 0);c.__decorate([w.property({constructOnly:!0})],a.Constraints.prototype,"mode",void 0);a.Constraints=c.__decorate([e.subclass("esri.views.3d.state.Constraints")],
a.Constraints);g={min:-2E5,max:4*k.earth.radius};const h={min:x.deg2rad(.5),max:x.deg2rad(179.5)},m={min:0,max:0};let u=function(t){function q(){var z=t.apply(this,arguments)||this;z.enabled=!0;z.elevationMargin=5;return z}b._inheritsLoose(q,t);return q}(d);c.__decorate([w.property({type:Boolean})],u.prototype,"enabled",void 0);c.__decorate([w.property({type:Number})],u.prototype,"elevationMargin",void 0);u=c.__decorate([e.subclass("esri.views.3d.state.Constraints.CollisionConstraint")],u);c=a.Constraints;
a.TiltDefault=h;a.default=c;a.earthAltitudeConstraint=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/constraints/ClipDistanceConstraint":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/cast ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,d,g,x,w,
l,n){a.ClipDistanceConstraint=function(f){function e(){var r=f.apply(this,arguments)||this;r.mode="auto";return r}b._inheritsLoose(e,f);var k=e.prototype;k.castNear=function(r){return Math.max(1E-8,r)};k.castFar=function(r){return Math.max(1E-8,r)};k.autoUpdate=function(r,y){"auto"===this.mode&&(this._get("near")!==r&&this._set("near",r),this._get("far")!==y&&this._set("far",y))};b._createClass(e,[{key:"near",get:function(){return this._get("near")},set:function(r){this._set("near",r);r>=this._get("far")&&
(this.far=r+1E-9);this.mode="manual"}},{key:"far",get:function(){return this._get("far")},set:function(r){this._set("far",r);r<=this._get("near")&&(this.near=r-1E-9);this.mode="manual"}}]);return e}(d);c.__decorate([g.property({type:Number,value:1E-8})],a.ClipDistanceConstraint.prototype,"near",null);c.__decorate([l.cast("near")],a.ClipDistanceConstraint.prototype,"castNear",null);c.__decorate([g.property({type:Number,value:1E-8})],a.ClipDistanceConstraint.prototype,"far",null);c.__decorate([l.cast("far")],
a.ClipDistanceConstraint.prototype,"castFar",null);c.__decorate([g.property({type:["auto","manual"]})],a.ClipDistanceConstraint.prototype,"mode",void 0);a.ClipDistanceConstraint=c.__decorate([n.subclass("esri.views.3d.constraints.ClipDistanceConstraint")],a.ClipDistanceConstraint);a.default=a.ClipDistanceConstraint;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/constraints/TiltConstraint":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/cast ../../../core/accessorSupport/decorators/subclass ../state/Constraints".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e){var k=g.rad2deg(e.TiltDefault.min),r=g.rad2deg(e.TiltDefault.max);a.TiltConstraint=function(y){function p(){var m=y.apply(this,arguments)||this;m.mode="auto";return m}b._inheritsLoose(p,y);var h=p.prototype;h.castMax=function(m){return g.clamp(m,k,r)};h.autoUpdate=function(m){"auto"===this.mode&&this._get("max")!==m&&this._set("max",m)};b._createClass(p,[{key:"max",get:function(){return this._get("max")},set:function(m){this._set("max",m);this.mode="manual"}}]);return p}(d);
c.__decorate([x.property({type:["auto","manual"]})],a.TiltConstraint.prototype,"mode",void 0);c.__decorate([x.property({type:Number,value:r})],a.TiltConstraint.prototype,"max",null);c.__decorate([n.cast("max")],a.TiltConstraint.prototype,"castMax",null);a.TiltConstraint=c.__decorate([f.subclass("esri.views.3d.constraints.TiltConstraint")],a.TiltConstraint);a.default=a.TiltConstraint;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/SceneViewEnvironment":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/lang ../../../core/Logger ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/cast ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/ensureType ./lightingUtils ./SceneViewAtmosphere ./SunLighting ./SunnyWeather ./VirtualLighting ./weather ../../../webscene/Environment ../../../webscene/Lighting".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h){var m;const u=d.getLogger("esri.views.3d.environment.SceneViewEnvironment");d=m=function(t){function q(v){v=t.call(this,v)||this;v.atmosphere=new f.default;v.lighting=new e;return v}a._inheritsLoose(q,t);q.fromWebsceneEnvironment=function(v){v=v.cloneConstructProperties();return new m({...v,lighting:e.fromWebsceneLighting(v.lighting)})};var z=q.prototype;z.castLighting=function(v){return this._convertLighting(v)};z.applyLighting=function(v){this.lighting=
this._convertLighting(v)};z._convertLighting=function(v){if(!v)return new e;if(v instanceof e||v instanceof r)return v;if(v instanceof h){var B;return"sun"===(null==(B=this.lighting)?void 0:B.type)?this.lighting.cloneWithWebsceneLighting(v):e.fromWebsceneLighting(v)}return l.ensureOneOfType(n.lightingTypes,v)};z.clone=function(){return new m({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,
background:c.clone(this.background)})};z.cloneWithWebsceneEnvironment=function(v){return new m({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:c.clone(this.background),...v.cloneConstructProperties(),lighting:this.lighting.type&&"sun"!==this.lighting.type?e.fromWebsceneLighting(v.lighting):this.lighting.cloneWithWebsceneLighting(v.lighting)})};a._createClass(q,[{key:"weather",set:function(v){y.validateWeatherType(null==
v?void 0:v.type,u)&&this._set("weather",v)}}]);return q}(p);b.__decorate([g.property({type:f.default,json:{read:!1},nonNullable:!0})],d.prototype,"atmosphere",void 0);b.__decorate([g.property({types:y.weatherTypes,nonNullable:!0,json:{write:!1},value:new k})],d.prototype,"weather",null);b.__decorate([g.property({nonNullable:!0})],d.prototype,"lighting",void 0);b.__decorate([x.cast("lighting")],d.prototype,"castLighting",null);return d=m=b.__decorate([w.subclass("esri.views.3d.environment.SceneViewEnvironment")],
d)})},"esri/views/3d/environment/lightingUtils":function(){define(["exports","./SunLighting","./VirtualLighting"],function(a,b,c){a.lightingTypes={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:b,virtual:c}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/SunLighting":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Evented ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../webscene/Lighting".split(" "),
function(a,b,c,d,g,x,w,l,n){var f;c=f=function(k){function r(p){p=k.call(this,p)||this;p.type="sun";p.cameraTrackingEnabled=!0;p.ambientOcclusionEnabled=!1;p.waterReflectionEnabled=!1;p.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};var h=(new Date).getFullYear();h=new Date("March 15, "+h+" 12:00:00 UTC");p._set("defaultDate",h);p._set("date",h);return p}a._inheritsLoose(r,k);r.fromWebsceneLighting=function(p){return new f(p.cloneConstructProperties())};var y=r.prototype;y.autoUpdate=
function(p,h){const m=f.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=h.hours;this.positionTimezoneInfo.minutes=h.minutes;this.positionTimezoneInfo.seconds=h.seconds;h=null;null!=p&&(this.positionTimezoneInfo.autoUpdated=!0,h=this.date&&this.date.getTime(),this._set("date",new Date(p.getTime())));const u=f.calculateTimezoneOffset(this.positionTimezoneInfo);m!==u&&(e.target=this,e.timezoneOffset=u,this.emit("timezone-will-change",e));if(null!=p)return h!==p.getTime()};
y.clone=function(){const p=this._get("date")===this._get("defaultDate"),h=new f({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled});p&&h._set("date",h._get("defaultDate"));h.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated;h.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours;h.positionTimezoneInfo.minutes=
this.positionTimezoneInfo.minutes;h.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds;return h};y.cloneWithWebsceneLighting=function(p){const h=this.clone();null!=p.date&&(h.date=p.date);h.directShadowsEnabled=p.directShadowsEnabled;h.displayUTCOffset=p.displayUTCOffset;return h};a._createClass(r,[{key:"defaultDate",get:function(){return new Date(this._get("defaultDate").getTime())},set:function(p){const h=this._get("date")===this._get("defaultDate");p=new Date(p.getTime());this._set("defaultDate",
p);h&&this._set("date",p)}},{key:"date",set:function(p){null!=p&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(p.getTime())))}}]);return r}(c.EventedMixin(n));b.__decorate([d.property({readOnly:!0})],c.prototype,"type",void 0);b.__decorate([d.property({type:Boolean})],c.prototype,"cameraTrackingEnabled",void 0);b.__decorate([d.property({type:Boolean})],c.prototype,"ambientOcclusionEnabled",void 0);b.__decorate([d.property({type:Boolean})],c.prototype,"waterReflectionEnabled",
void 0);b.__decorate([d.property({type:Date})],c.prototype,"defaultDate",null);b.__decorate([d.property({type:Date})],c.prototype,"date",null);c=f=b.__decorate([l.subclass("esri.views.3d.environment.SunLighting")],c);(function(k){k.calculateTimezoneOffset=function({hours:r,minutes:y,seconds:p}){return Math.round(r+y/60+p/3600)}})(c||(c={}));const e={target:null,timezoneOffset:0};return c})},"esri/views/3d/environment/VirtualLighting":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Evented ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../webscene/Lighting".split(" "),
function(a,b,c,d,g,x,w,l,n){var f;c=f=function(e){function k(y){y=e.call(this,y)||this;y.type="virtual";y.ambientOcclusionEnabled=!1;y.waterReflectionEnabled=!1;return y}a._inheritsLoose(k,e);var r=k.prototype;r.clone=function(){return new f({...this.cloneConstructProperties(),ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled})};r.cloneWithWebsceneLighting=function(y){const p=this.clone();p.directShadowsEnabled=y.directShadowsEnabled;return p};
return k}(c.EventedMixin(n));b.__decorate([d.property({readOnly:!0})],c.prototype,"type",void 0);b.__decorate([d.property({type:Boolean})],c.prototype,"ambientOcclusionEnabled",void 0);b.__decorate([d.property({type:Boolean})],c.prototype,"waterReflectionEnabled",void 0);return c=f=b.__decorate([l.subclass("esri.views.3d.environment.VirtualLighting")],c)})},"esri/views/3d/environment/SceneViewAtmosphere":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,d,g,x,w,l,n){var f;a.SceneViewAtmosphere=f=function(e){function k(){return e.apply(this,arguments)||this}b._inheritsLoose(k,e);k.prototype.clone=function(){return new f({quality:this.quality})};b._createClass(k,[{key:"quality",set:function(r){-1!==["low","high"].indexOf(r)&&this._set("quality",r)}}]);return k}(d);c.__decorate([g.property({type:["low","high"],value:"low"})],a.SceneViewAtmosphere.prototype,"quality",null);a.SceneViewAtmosphere=f=c.__decorate([n.subclass("esri.views.3d.environment.SceneViewAtmosphere")],
a.SceneViewAtmosphere);a.default=a.SceneViewAtmosphere;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/SunnyWeather":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,d,g,x,w,l,n){var f;c=f=function(e){function k(r){r=e.call(this,r)||this;r.type="sunny";r.cloudCover=.5;return r}a._inheritsLoose(k,e);k.prototype.clone=function(){return new f({cloudCover:this.cloudCover})};return k}(c.JSONSupport);b.__decorate([l.enumeration({sunny:"sunny"})],c.prototype,"type",void 0);b.__decorate([d.property({type:Number,nonNullable:!0,range:{min:0,max:1}})],c.prototype,"cloudCover",void 0);return c=f=b.__decorate([n.subclass("esri.views.3d.environment.SunnyWeather")],
c)})},"esri/views/3d/environment/weather":function(){define("exports ../../../core/has ./CloudyWeather ./FoggyWeather ./RainyWeather ./SnowyWeather ./SunnyWeather".split(" "),function(a,b,c,d,g,x,w){function l(){return b("enable-feature:precipitation")?n:n.filter(f=>"snowy"!==f)}c={key:"type",base:null,typeMap:{sunny:w,cloudy:c,rainy:g,snowy:x,foggy:d}};const n=Object.keys(c.typeMap);a.getWeatherTypes=l;a.validateWeatherType=function(f,e){return l().includes(f)?!0:(e.error(`"${f}" is not a valid weather type`),
!1)};a.weatherEquals=function(f,e){if(f.type!==e.type)return!1;switch(f.type){case "sunny":case "rainy":case "snowy":case "cloudy":return f.cloudCover===e.cloudCover;case "foggy":return f.fogStrength===e.fogStrength}};a.weatherHeightLimit=1E4;a.weatherTypes=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/CloudyWeather":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,d,g,x,w,l,n){var f;c=f=function(e){function k(r){r=e.call(this,r)||this;r.type="cloudy";r.cloudCover=.5;return r}a._inheritsLoose(k,e);k.prototype.clone=function(){return new f({cloudCover:this.cloudCover})};return k}(c.JSONSupport);b.__decorate([l.enumeration({cloudy:"cloudy"})],c.prototype,"type",void 0);b.__decorate([d.property({type:Number,nonNullable:!0,range:{min:0,max:1}})],c.prototype,"cloudCover",void 0);return c=f=b.__decorate([n.subclass("esri.views.3d.environment.CloudyWeather")],
c)})},"esri/views/3d/environment/FoggyWeather":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,d,g,x,w,l,n){var f;c=f=function(e){function k(r){r=e.call(this,r)||this;r.type=
"foggy";r.fogStrength=.5;return r}a._inheritsLoose(k,e);k.prototype.clone=function(){return new f({fogStrength:this.fogStrength})};return k}(c.JSONSupport);b.__decorate([l.enumeration({foggy:"foggy"})],c.prototype,"type",void 0);b.__decorate([d.property({type:Number,nonNullable:!0,range:{min:0,max:1}})],c.prototype,"fogStrength",void 0);return c=f=b.__decorate([n.subclass("esri.views.3d.environment.FoggyWeather")],c)})},"esri/views/3d/environment/RainyWeather":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,d,g,x,w,l,n){var f;c=f=function(e){function k(r){r=e.call(this,r)||this;r.type="rainy";r.cloudCover=.5;r.precipitation=.5;return r}a._inheritsLoose(k,e);k.prototype.clone=function(){return new f({cloudCover:this.cloudCover,precipitation:this.precipitation})};return k}(c.JSONSupport);b.__decorate([l.enumeration({rainy:"rainy"})],c.prototype,"type",void 0);b.__decorate([d.property({type:Number,nonNullable:!0,range:{min:0,max:1}})],c.prototype,"cloudCover",void 0);b.__decorate([d.property({type:Number,
nonNullable:!0,range:{min:0,max:1}})],c.prototype,"precipitation",void 0);return c=f=b.__decorate([n.subclass("esri.views.3d.environment.RainyWeather")],c)})},"esri/views/3d/environment/SnowyWeather":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,d,g,x,w,l,n){var f;c=f=function(e){function k(r){r=e.call(this,r)||this;r.type="snowy";r.cloudCover=.5;r.precipitation=.5;return r}a._inheritsLoose(k,e);k.prototype.clone=function(){return new f({cloudCover:this.cloudCover,precipitation:this.precipitation})};return k}(c);b.__decorate([l.enumeration({snowy:"snowy"})],c.prototype,"type",void 0);b.__decorate([d.property({type:Number,nonNullable:!0,range:{min:0,max:1}})],c.prototype,"cloudCover",void 0);b.__decorate([d.property({type:Number,
nonNullable:!0,range:{min:0,max:1}})],c.prototype,"precipitation",void 0);return c=f=b.__decorate([n.subclass("esri.views.3d.environment.SnowyWeather")],c)})},"esri/views/3d/environment/SceneViewEnvironmentManager":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/Evented ../../../core/Handles ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4f64 ../../../geometry/projection ../../../geometry/support/spatialReferenceUtils ../../ViewingMode ./EnvironmentRenderer ../support/earthUtils ../support/sunUtils ../webgl-engine/lighting/Lightsources ../../../webscene/background/ColorBackground".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E){a.SceneViewEnvironmentManager=function(O){function P(){var M=O.call(this)||this;M._referencePointUpdateDelay=200;M._referencePointUpdateInterval=3E3;M._referencePointUpdateDistThreshold=1E6;M._referencePosUpdateQuery=null;M._referencePosMapCoordsRequested=null;M._viewHandles=new x;M._preserveAbsoluteDateTime=!1;M._trackingEnabled=!1;M._referencePosResetPreserveAbsoluteTime=!1;M._referencePosUpdateTimer=null;M._referencePosMapCoords=null;
M._mainLight=new A.MainLight;M._ambientLight=new A.AmbientLight;M._moonLight=new A.FillLight;M.disableQueries=!1;M._disableWeather=!1;M._renderer=null;M._referencePosWGS84Comparable=null;M._resetReferencePosition();return M}b._inheritsLoose(P,O);var K=P.prototype;K.destroy=function(){this.disconnectView();this._viewHandles.destroy()};K.connectView=function(M){if(!this._renderer){this._renderer=new z.EnvironmentRenderer({view:M});var U=()=>this._updateRenderParameters(),R=()=>this._cameraHandler(),
L=()=>this._updateLighting();this._viewHandles.add([n.watch(()=>M.environment.lighting,N=>this._updateLightingHandler(N),n.sync),n.watch(()=>M.environment.lighting.date,N=>this._lightingDateHandler(N),n.sync),n.watch(()=>M.stationary,()=>this._interactingStationaryHandler()),n.watch(()=>M.environment.lighting.directShadowsEnabled,U,n.sync),n.watch(()=>M.environment.lighting.ambientOcclusionEnabled,U,n.sync),n.watch(()=>M.environment.lighting.waterReflectionEnabled,U,n.sync),n.watch(()=>{var N;return null==
(N=M.environment.background)?void 0:N.color},U,n.sync),n.watch(()=>M.spatialReference,()=>this._resetReferencePosition(!0),n.sync),n.watch(()=>M.environment.weather.type,L,n.sync),n.watch(()=>this.weatherEnabled,L,n.sync),n.watch(()=>M.viewingMode,()=>this._resetReferencePosition(!0),n.syncAndInitial),n.watch(()=>"sun"===M.environment.lighting.type?M.environment.lighting.cameraTrackingEnabled:!1,N=>this._updateCameraTracking(N),n.syncAndInitial),n.watch(()=>M.state.camera,R,n.syncAndInitial),n.watch(()=>
this.disableQueries,R)]);this._updateRenderParameters();this._updateLighting();this._cameraHandler();this.notifyChange("updating")}};K.disconnectView=function(){this._viewHandles.removeAll();this._resetReferencePosition();this._renderer=w.destroyMaybe(this._renderer)};K._updateLightingHandler=function(M){this._updateCameraTracking("sun"===M.type?M.cameraTrackingEnabled:!1);this._lightingDateHandler(M.date);this._updateRenderParameters()};K._updateCameraTracking=function(M){(this._trackingEnabled=
M)?this._cameraHandler():(M=this._view.environment.lighting,"sun"===(null==M?void 0:M.type)&&(M.positionTimezoneInfo.autoUpdated=!1))};K._lightingDateHandler=function(M){const U=this._view.environment.lighting;if("virtual"===(null==U?void 0:U.type))this._updateLighting();else if(M){if(!U.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;if(!u.canProjectToWGS84ComparableLonLat(this._view.spatialReference)){var R=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(R)){this._requestReferencePositionUpdate(R);
return}}this._preupdateTracking(M);w.isSome(this._referencePosWGS84Comparable)&&(R=v.positionToTimezoneInfo(this._referencePosWGS84Comparable,G),w.isSome(R)&&(U.autoUpdate(null,R),this._trackingEnabled&&(U.positionTimezoneInfo.autoUpdated=!0)))}this._updateLighting(M)}};K._preupdateTracking=function(M){!this._trackingEnabled&&"sun"===this._view.environment.lighting.type&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(M)};K._cameraHandler=function(M=null){var U=this._view;
U.ready&&(U=U.stateManager.camera)&&(this._cameraHandlerClientSide(U,M)||this._cameraHandlerServerSide(U))};K._cameraHandlerClientSide=function(M,U){const R=t.isEarth(this._view.spatialReference);if(R&&!u.canProjectToWGS84ComparableLonLat(this._view.spatialReference))return!1;M=M.position;w.isNone(this._referencePosWGS84Comparable)&&(this._referencePosWGS84Comparable=h.create());R?u.projectPointToWGS84ComparableLonLat(M,this._referencePosWGS84Comparable):p.set(this._referencePosWGS84Comparable,M.longitude,
M.latitude,M.z);this.notifyChange("referencePositionWGS84Comparable");this._autoUpdateTimezone(this._referencePosWGS84Comparable,U)||this._updateLighting(U);return!0};K._cameraHandlerServerSide=function(M){M=M.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(M))&&this._requestReferencePositionUpdate(M,!0);this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=M.z*this._view.mapCoordsHelper.unitInMeters,
this._referencePosChanged())};K._interactingStationaryHandler=function(){this._view.stationary&&this._executePendingReferencePositionUpdate()};K._updateLighting=function(M){const U=this._view;var R=M||U.environment.lighting.date,L=this._referencePosWGS84Comparable;M=w.isSome(L)?C:D;w.isSome(L)&&B.computeColorAndIntensity(R,L,U.state.viewingMode,this.weatherVisible?U.environment.weather.type:"disabled",U.state.camera,U.environment.lighting.type,M);R=this._mainLight;L=M.direct;p.scale(R.intensity,L.color,
L.intensity*Math.PI);p.copy(R.direction,L.directionToLightSource);R.specularStrength=M.specularStrength;R.environmentStrength=M.environmentStrength;const N=this._ambientLight;p.scale(N.intensity,M.ambient.color,M.ambient.intensity);const T=this._moonLight;p.lerp(T.intensity,J,I,M.globalFactor);p.scale(T.intensity,T.intensity,(1-.5*M.globalFactor)*(1-.4*M.noonFactor*(1-M.globalFactor)));p.copy(T.direction,L.directionToLightSource);U._stage.renderView.updateLightSources([R,N,T],1-M.noonFactor,M.globalFactor);
this._updateRenderParameters()};K._autoUpdateTimezone=function(M,U=null){if("virtual"===this._view.environment.lighting.type||!this._view.environment.lighting.cameraTrackingEnabled||w.isNone(M))return!1;const R=F;R.setTime((U||this._view.environment.lighting.date).getTime());M=v.positionToTimezoneInfo(M,G);if(w.isNone(M))return!1;var L=this._view.environment.lighting.positionTimezoneInfo;if(!L.autoUpdated)L=M;else if(L.hours===M.hours&&L.minutes===M.minutes&&L.seconds===M.seconds)return!1;const N=
R.getUTCHours()-(M.hours-L.hours),T=R.getUTCMinutes()-(M.minutes-L.minutes);L=R.getUTCSeconds()-(M.seconds-L.seconds);R.setUTCHours(N);R.setUTCMinutes(T);R.setUTCSeconds(L);return U?!1:this._view.environment.lighting.autoUpdate(R,M)};K._updateRenderParameters=function(){const M=this._view._stage;if(M){var U=w.mapOr(this._referencePosWGS84Comparable,!0,L=>B.computeShadowsEnabled(L[2],this._view.state.viewingMode)),R=this._view.environment.background;R=R instanceof E?{type:"color",color:m.fromArray(d.toUnitRGBA(R.color))}:
{type:"color",color:m.fromValues(0,0,0,1)};M.renderView.setRenderParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&U,ssao:this._view.environment.lighting.ambientOcclusionEnabled,waterReflectionEnabled:this._view.environment.lighting.waterReflectionEnabled,fillLightsEnabled:"sun"===this._view.environment.lighting.type,background:R})}};K._resetReferencePosition=function(M=!1){this._cancelReferencePosUpdates();this._referencePosWGS84Comparable=this._referencePosResetPreserveAbsoluteTime=
this._referencePosMapCoordsRequested=this._referencePosMapCoords=null;this.notifyChange("updating");M&&this._cameraHandler()};K._requestReferencePositionUpdate=function(M,U=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(M):this._referencePosMapCoordsRequested=M.clone(),this._referencePosResetPreserveAbsoluteTime=!!U,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const R=this._referencePosUpdateQuery=
l.after(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===R)return this._doReferencePositionUpdateQuery(()=>this._referencePosUpdateQuery!==R)}).catch(N=>{"mapcoordshelper:missing-geometry-service"===N.name&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===R&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),L=this._referencePosUpdateTimer=l.after(this._referencePointUpdateInterval).then(()=>
{this._referencePosUpdateTimer===L&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}};K._doReferencePositionUpdateQuery=function(){var M=b._asyncToGenerator(function*(U){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1);this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone();
this._referencePosMapCoordsRequested=this._referencePosResetPreserveAbsoluteTime=null;const R=yield this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);U()||isNaN(R[0])||isNaN(R[1])||(U=this._referencePosMapCoords.z*this._view.mapCoordsHelper.unitInMeters,this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=R[0],this._referencePosWGS84Comparable[1]=R[1],this._referencePosWGS84Comparable[2]=U):this._referencePosWGS84Comparable=[R[0],R[1],U],this._referencePosChanged())});
return function(U){return M.apply(this,arguments)}}();K._executePendingReferencePositionUpdate=function(){const M=this._referencePosMapCoordsRequested;M&&this._requestReferencePositionUpdate(M,this._referencePosResetPreserveAbsoluteTime)};K._referencePosChanged=function(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting();this.notifyChange("referencePositionWGS84Comparable")};K._exceedsReferencePosDistThreshold=
function(M){return this._referencePosMapCoords?(M=this._referencePosMapCoords.distance(M),this._view.mapCoordsHelper&&(M*=this._view.mapCoordsHelper.unitInMeters),M>this._referencePointUpdateDistThreshold):!0};K._cancelReferencePosUpdates=function(){const M=!!this._referencePosUpdateQuery;this._referencePosUpdateTimer=this._referencePosUpdateQuery=null;return M};b._createClass(P,[{key:"_view",get:function(){var M;return null==(M=this._renderer)?void 0:M.view}},{key:"updating",get:function(){var M;
return!!(!this.disableQueries&&(this._referencePosUpdateQuery||this._referencePosMapCoordsRequested)||null!=(M=this._renderer)&&M.updating)}},{key:"weatherEnabled",get:function(){var M,U,R;return(null==(M=this._view)?void 0:M.environment.atmosphereEnabled)&&!this._disableWeather&&(null==(U=this._view)?void 0:null==(R=U.state)?void 0:R.viewingMode)===q.ViewingMode.Global&&t.isEarth(this._view.spatialReference)}},{key:"weatherVisible",get:function(){var M;return this.weatherEnabled&&(null==(M=this._renderer)?
void 0:M.weatherVisible)}},{key:"referencePositionWGS84Comparable",get:function(){return this._referencePosWGS84Comparable}},{key:"test",get:function(){const M=this;return{get renderer(){return M._renderer},set referencePointUpdateInterval(U){M._referencePointUpdateInterval=U},set referencePointUpdateDistThreshold(U){M._referencePointUpdateDistThreshold=U},set referencePosUpdateTimer(U){M._referencePosUpdateTimer=U},set referencePointUpdateDelay(U){M._referencePointUpdateDelay=U},set disableWeather(U){M._disableWeather=
U}}}}]);return P}(g.EventedAccessor);c.__decorate([f.property({type:Boolean,readOnly:!0})],a.SceneViewEnvironmentManager.prototype,"updating",null);c.__decorate([f.property()],a.SceneViewEnvironmentManager.prototype,"disableQueries",void 0);c.__decorate([f.property()],a.SceneViewEnvironmentManager.prototype,"_disableWeather",void 0);c.__decorate([f.property()],a.SceneViewEnvironmentManager.prototype,"weatherEnabled",null);c.__decorate([f.property()],a.SceneViewEnvironmentManager.prototype,"weatherVisible",
null);c.__decorate([f.property()],a.SceneViewEnvironmentManager.prototype,"referencePositionWGS84Comparable",null);c.__decorate([f.property()],a.SceneViewEnvironmentManager.prototype,"_renderer",void 0);c.__decorate([f.property()],a.SceneViewEnvironmentManager.prototype,"_referencePosWGS84Comparable",void 0);a.SceneViewEnvironmentManager=c.__decorate([y.subclass("esri.views.3d.environment.SceneViewEnvironmentManager")],a.SceneViewEnvironmentManager);const C=new B.ColorAndIntensity,D=new B.ColorAndIntensity,
F=new Date,G={hours:0,minutes:0,seconds:0},J=h.fromValues(.22,.22,.33),I=h.fromValues(.22,.22,.22);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/EnvironmentRenderer":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/has ../../../core/Handles ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../geometry/projectionEllipsoid ../../../geometry/support/spatialReferenceUtils ../../../support/featureFlags ./ChapmanAtmosphere ./CloudsComposition ./CloudsData ./CloudsGenerator ./CloudsPresets ./Fog ./PanoramicAtmosphere ./Precipitation ../../../chunks/Precipitation.glsl ./SimpleAtmosphere ./Stars ./weather ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E,C,D,F,G,J,I,O){var P;const K=[O.RenderSlot.POSTPROCESSING_ENVIRONMENT_OPAQUE,O.RenderSlot.POSTPROCESSING_ENVIRONMENT_TRANSPARENT];a.EnvironmentRenderer=P=function(U){function R(N){N=U.call(this,N)||this;N._handles=new x;N._context=null;N._pendingAtmosphere=null;N._atmosphere=null;N._precipitationEnabled=u.enablePrecipitation();return N}b._inheritsLoose(R,U);var L=R.prototype;L.initialize=function(){this.view._stage.addRenderPlugin(K,this)};
L.destroy=function(){var N;this._pendingAtmosphere=l.destroyMaybe(this._pendingAtmosphere);null!=(null==(N=this.view)?void 0:N._stage)&&this.view._stage.removeRenderPlugin(this);this._handles=l.destroyMaybe(this._handles);this._set("view",null)};L.updateAnimation=function(N){return l.isSome(this._precipitation)?this._precipitation.update(N):!1};L.initializeRenderContext=function(N=null){this._context=N;this._handles.add([f.when(this.view,"basemapTerrain",()=>this._updateBasemapTerrain(),!0),n.watch(()=>
({viewingMode:this.view.viewingMode,atmosphereEnabled:this.view.environment.atmosphereEnabled,atmosphereQuality:this.view.environment.atmosphere.quality}),()=>this._updateAtmosphere(),n.syncAndInitial),n.watch(()=>this._stars,()=>this._setNeedsRender()),n.watch(()=>this._clouds,()=>this._updateWeather(this._weatherUpdateParameters),n.initial),n.watch(()=>this._precipitation,()=>this._setNeedsRender()),n.watch(()=>this._fog,()=>this._updateFog(this._weatherUpdateParameters),n.initial),n.watch(()=>
this._weatherUpdateParameters,T=>{this._updateWeather(T);this._updateFog(T)},n.syncAndInitial)])};L.uninitializeRenderContext=function(){this._context=null;this._atmosphere=l.destroyMaybe(this._atmosphere);this._set("_stars",l.destroyMaybe(this._stars));this._set("_precipitation",l.destroyMaybe(this._precipitation));this._set("_clouds",l.destroyMaybe(this._clouds));this._set("_cloudComposition",l.destroyMaybe(this._cloudComposition));this._set("_fog",l.destroyMaybe(this._fog))};L.render=function(N){if(N.pass===
I.RenderPass.MATERIAL)switch(N.slot){case O.RenderSlot.POSTPROCESSING_ENVIRONMENT_OPAQUE:l.isSome(this._stars)&&this._stars.render(N);l.isSome(this._atmosphere)&&this._atmosphere.canRender&&(this._atmosphere.render(N),z.isReadyCloudsData(this._clouds)&&l.isSome(this._cloudComposition)&&(this._cloudComposition.render(N,this._clouds,l.isSome(this.view.animation)),this._cloudComposition.isFading&&this._setNeedsRender()));break;case O.RenderSlot.POSTPROCESSING_ENVIRONMENT_TRANSPARENT:if(l.isSome(this._atmosphere)&&
this._atmosphere.canRender){const T=this.weatherEnabled?this.view.environment.weather.type:"disabled";this._atmosphere.renderHaze(N,"rainy"===T);if(l.isSome(this._fog)){const S="foggy"===T||"rainy"===T||"snowy"===T;(S||"realistic"!==this._selectAtmosphereType())&&this._fog.render(N,S,"rainy"===T)}"rainy"!==this.view.environment.weather.type&&"snowy"!==this.view.environment.weather.type||!l.isSome(this._precipitation)||this._precipitation.render(N,this.view.environment.weather.precipitation,"rainy"===
this.view.environment.weather.type?D.PrecipitationType.RAIN:D.PrecipitationType.SNOW)}}};L._updateWeather=function(N){l.isNone(N)||l.isNone(this._clouds)||(this._clouds.applyPreset(B.cloudPresets[N.type],N.weatherAdjustment),this._setNeedsRender())};L._setNeedsRender=function(){l.isSome(this._context)&&this._context.requestRender()};L._updateFog=function(N){if(!l.isNone(this._fog)&&!l.isNone(N))switch(N.type){case "foggy":this._fog.strength=w.lerp(3E-5,.005,N.weatherAdjustment**3);this._setNeedsRender();
break;case "rainy":case "snowy":this._fog.strength=w.lerp(4E-6,8E-5,N.effect**3);this._setNeedsRender();break;default:this._fog.strength=4E-6,this._setNeedsRender()}};L._updateAtmosphere=function(){var N=this._selectAtmosphereType();if(this.atmosphereType!==N)if(l.isSome(this._pendingAtmosphere)&&(this._pendingAtmosphere!==this._atmosphere&&this._pendingAtmosphere.destroy(),this._pendingAtmosphere=null),N=this._getAtmosphereClass()){var T=new N(this.view);l.isSome(this._context)&&T.initializeRenderContext(this._context);
l.isNone(this._atmosphere)&&(this._atmosphere=T,this._setNeedsRender());this._pendingAtmosphere=T;T.when().then(()=>{l.isSome(this._atmosphere)&&this._pendingAtmosphere&&this._pendingAtmosphere!==this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=this._pendingAtmosphere);this._pendingAtmosphere=null;this._setNeedsRender();this._updateBasemapTerrain()}).catch(()=>{this._pendingAtmosphere===T&&(this._pendingAtmosphere=null)})}else l.isSome(this._atmosphere)&&(this._atmosphere.destroy(),
this._atmosphere=null,this._setNeedsRender()),this._updateBasemapTerrain()};L._getAtmosphereClass=function(){switch(this._selectAtmosphereType()){case "none":return null;case "realistic":return t.ChapmanAtmosphere;case "panoramic":return E.PanoramicAtmosphere;case "simple":return F}};L._selectAtmosphereType=function(){const N=this.view.get("environment.atmosphereEnabled"),T=this.view.get("environment.atmosphere.quality"),S=this.view.viewingMode;return!N||null==T||m.isMoon(this.view.spatialReference)?
"none":"local"===S?"panoramic":"high"===T&&l.isSome(this._context)&&t.ChapmanAtmosphere.isSupported(this._context)&&m.isEarth(this.view.spatialReference)?"realistic":"simple"};L._updateBasemapTerrain=function(){this.view.basemapTerrain&&(this.view.basemapTerrain.velvetOverground=l.isSome(this._atmosphere)&&"simple"===this.atmosphereType)};b._createClass(R,[{key:"atmosphereType",get:function(){return l.isSome(this._pendingAtmosphere)?this._pendingAtmosphere.type:l.isSome(this._atmosphere)?this._atmosphere.type:
"none"}},{key:"canRender",get:function(){var N;return!(null==(N=this.view.basemapTerrain)||!N.renderer.canRender)||"global"!==this.view.viewingMode}},{key:"needsLinearDepth",get:function(){return"realistic"===this._selectAtmosphereType()}},{key:"updating",get:function(){return l.isSome(this._pendingAtmosphere)||l.isSome(this._stars)&&this._stars.updating||l.isSome(this._clouds)&&this._clouds.running}},{key:"weatherVisible",get:function(){return p.length(this.view.state.camera.eye)-h.getReferenceEllipsoid(this.view.spatialReference).radius<=
J.weatherHeightLimit}},{key:"_stars",get:function(){var N,T;const S=this.view,H=null!=(N=null==(T=S.environment)?void 0:T.starsEnabled)?N:!1;N=this._get("_stars");return!H||l.isNone(this._context)?(l.destroyMaybe(N),null):l.isSome(N)?N:new G.Stars({view:S,requestRender:()=>this._setNeedsRender()})}},{key:"_precipitation",get:function(){const N=this._get("_precipitation");if(!this._precipitationEnabled||l.isNone(this._context))return l.destroyMaybe(N),null;const T=this.view,S=this._context;if(l.isSome(N)&&
N.context===S)return N;l.destroyMaybe(N);return new C.Precipitation({context:S,view:T})}},{key:"_clouds",get:function(){const N=this._get("_clouds");if(!this.weatherEnabled||l.isNone(this._context))return l.destroyMaybe(N),null;if(l.isSome(N))return N;const T=this.view,S=this._context.renderContext.rctx;l.destroyMaybe(N);return new v.CloudsGenerator({rctx:S,view:T,requestRender:()=>this._setNeedsRender()})}},{key:"_cloudComposition",get:function(){const N=this._get("_cloudComposition");if(!this.weatherEnabled||
l.isNone(this._context))return l.destroyMaybe(N),null;const T=this.view.state.viewingMode,S=this._context.renderContext.rctx,H=h.getReferenceEllipsoid(this.view.spatialReference).radius;if(l.isSome(N)&&N.viewingMode===T&&N.radius===H)return N;l.destroyMaybe(N);return new q.CloudsComposition({rctx:S,viewingMode:T,radius:H})}},{key:"_fog",get:function(){const N=this._get("_fog");if(!this.weatherEnabled||l.isNone(this._context))return l.destroyMaybe(N),null;if(l.isSome(N))return N;const T=this.view,
S=this._context;l.destroyMaybe(N);return new A.Fog({context:S,view:T})}},{key:"weatherEnabled",get:function(){var N,T;return!(null==(N=this.view)||null==(T=N.environmentManager)||!T.weatherEnabled)}},{key:"precipitationEnabled",get:function(){return this._precipitationEnabled},set:function(N){this._precipitationEnabled=N}},{key:"_weatherUpdateParameters",get:function(){const N=this.weatherEnabled?this.view.environment.weather:null;return l.isNone(N)?null:"rainy"===N.type||"snowy"===N.type?{type:N.type,
weatherAdjustment:N.cloudCover,effect:N.precipitation}:{type:N.type,weatherAdjustment:"foggy"===N.type?N.fogStrength:N.cloudCover}}},{key:"test",get:function(){return{atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType(),stubGetAtmosphereClass:N=>{M=P.prototype._getAtmosphereClass;P.prototype._getAtmosphereClass=N},restoreGetAtmosphereClass:()=>{P.prototype._getAtmosphereClass=M},precipitationEnabled:N=>{this.precipitationEnabled=N}}}}]);return R}(d);
c.__decorate([e.property({constructOnly:!0})],a.EnvironmentRenderer.prototype,"view",void 0);c.__decorate([e.property({type:Boolean,readOnly:!0})],a.EnvironmentRenderer.prototype,"updating",null);c.__decorate([e.property()],a.EnvironmentRenderer.prototype,"weatherVisible",null);c.__decorate([e.property()],a.EnvironmentRenderer.prototype,"_context",void 0);c.__decorate([e.property()],a.EnvironmentRenderer.prototype,"_pendingAtmosphere",void 0);c.__decorate([e.property({readOnly:!0})],a.EnvironmentRenderer.prototype,
"_stars",null);c.__decorate([e.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_precipitation",null);c.__decorate([e.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_clouds",null);c.__decorate([e.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_cloudComposition",null);c.__decorate([e.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_fog",null);c.__decorate([e.property()],a.EnvironmentRenderer.prototype,"weatherEnabled",null);c.__decorate([e.property()],a.EnvironmentRenderer.prototype,
"_precipitationEnabled",void 0);c.__decorate([e.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_weatherUpdateParameters",null);a.EnvironmentRenderer=P=c.__decorate([y.subclass("esri.views.3d.environment.EnvironmentRenderer")],a.EnvironmentRenderer);let M;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/ChapmanAtmosphere":function(){define("exports ../../../core/Handles ../../../core/mathUtils ../../../core/maybe ../../../core/watchUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4f64 ../../../geometry/support/Ellipsoid ./atmosphereUtils ./ChapmanAtmosphereTechnique ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../../webgl/enums".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u){let t=function(){function q(v){this._view=v;this.type="realistic";this.canRender=!0;this._cameraPosition=e.create();this._projectionInverse=w.create();this._viewInverse=w.create();this._heightParameters=k.create();this._betasRayleigh=e.create();this._betasCombined=e.create();this._scaleHeight=0;this._radii=n.create();this._nearFar=n.create();this._lowerElevationBoundRadius=this._altitudeFade=this._innerFadeDistance=this._cAtmosphere=this._cameraHeightSq=
this._cameraHeight=0;this._lowerBoundEarthRadius=r.earth.radius;this._hazeStrength=1;this._darkenHaze=!1;this._updateRadius(r.earth.radius)}var z=q.prototype;z.destroy=function(){this._atmosphereTechnique=d.releaseMaybe(this._atmosphereTechnique);this._atmosphereHazeTechnique=d.releaseMaybe(this._atmosphereHazeTechnique);this._vao=d.disposeMaybe(this._vao);this._handles=d.destroyMaybe(this._handles)};z.when=function(){return Promise.resolve()};z.initializeRenderContext=function(v){const B=v.renderContext.rctx;
this._handles=new b;d.isSome(this._view.basemapTerrain.rootTiles)&&this._updateElevation({spatialReference:this._view.basemapTerrain.spatialReference,tile:this._view.basemapTerrain.rootTiles[0],extent:this._view.basemapTerrain.rootTiles[0].extent,context:"ground"});this._handles.add(g.on(this._view,"basemapTerrain","elevation-change",E=>this._updateElevation(E),()=>this._updateElevation()));this._handles.add(g.on(this._view,"basemapTerrain","elevation-bounds-change",()=>this._updateVisibleElevationBounds()));
const A=new p.ChapmanAtmosphereTechniqueConfiguration;A.haze=!1;this._atmosphereTechnique=v.shaderTechniqueRepository.acquire(p.ChapmanAtmosphereTechnique,A);A.haze=!0;this._atmosphereHazeTechnique=v.shaderTechniqueRepository.acquire(p.ChapmanAtmosphereTechnique,A);this._vao=m.createQuadVAO(B,h.Pos2Tex);this._scaleHeight=y.rayLeighScaleHeight*y.atmosphereHeight;f.set(this._betasRayleigh,y.betaRayleigh[0],y.betaRayleigh[1],y.betaRayleigh[2]);f.set(this._betasCombined,y.betaRayleigh[0]+y.betaOzone[0],
y.betaRayleigh[1]+y.betaOzone[1],y.betaRayleigh[2]+y.betaOzone[2])};z.render=function(v){this._render(v,this._atmosphereTechnique,v.offscreenRenderingHelper.depthTexture)};z.renderHaze=function(v,B){this._darkenHaze=B;this._render(v,this._atmosphereHazeTechnique,v.offscreenRenderingHelper.linearDepthTexture)};z._render=function(v,B,A){this._update(v.camera);const E=v.rctx.useTechnique(B);v.offscreenRenderingHelper.renderDepthDetached(()=>{E.bindTexture(A,"depthTex");this._renderCommon(B.program,v)})};
z._renderCommon=function(v,B){if(!d.isNone(this._vao)){var A=B.rctx;B.scenelightingData.setLightDirectionUniform(v);v.setUniform4fv("heightParameters",this._heightParameters);v.setUniform3fv("cameraPosition",this._cameraPosition);v.setUniformMatrix4fv("inverseProjectionMatrix",this._projectionInverse);v.setUniformMatrix4fv("inverseViewMatrix",this._viewInverse);v.setUniform2fv("nearFar",this._nearFar);v.setUniform2fv("radii",this._radii);v.setUniform1f("scaleHeight",this._scaleHeight);v.setUniform1f("betaMie",
y.betaMie);v.setUniform3fv("betaRayleigh",this._betasRayleigh);v.setUniform3fv("betaCombined",this._betasCombined);v.setUniform1f("innerFadeDistance",this._innerFadeDistance);v.setUniform1f("altitudeFade",this._altitudeFade);v.setUniform1f("hazeStrength",this._hazeStrength);A.bindVAO(this._vao);v.assertCompatibleVertexAttributeLocations(this._vao);A.drawArrays(u.PrimitiveType.TRIANGLE_STRIP,0,4)}};z._adjustRadiusForTesselation=function(v){return v*Math.cos(Math.PI/16/16)};z._updateElevation=function(v){v=
v?v.tile:d.unwrapOr(this._view.basemapTerrain.rootTiles,[null])[0];d.isNone(v)||0!==v.level||(v=this._adjustRadiusForTesselation(r.earth.radius+v.elevationBounds[0]),v!==this._lowerElevationBoundRadius&&(this._lowerElevationBoundRadius=v,this._lowerBoundEarthRadius=-1,this._updateVisibleElevationBounds()))};z._updateVisibleElevationBounds=function(){const v=this._adjustRadiusForTesselation(r.earth.radius+this._view.basemapTerrain.elevationBounds.min);(0>this._lowerBoundEarthRadius||v<this._lowerBoundEarthRadius)&&
this._updateRadius(v)};z._updateRadius=function(v){this._lowerBoundEarthRadius=v;l.set(this._radii,v,v+y.atmosphereHeight);this._innerFadeDistance=2*Math.sqrt((2*v-y.innerAtmosphereDepth)*y.innerAtmosphereDepth)};z._update=function(v){d.isNone(v)||(this._cameraHeight=f.length(v.eye),this._cameraHeightSq=this._cameraHeight*this._cameraHeight,this._cAtmosphere=this._cameraHeightSq-this._radii[1]*this._radii[1],this._heightParameters=k.fromValues(this._cameraHeight,this._cameraHeightSq,this._cAtmosphere,
Math.min(1,Math.max(0,(this._cameraHeight-this._radii[0])/y.atmosphereHeight))),f.copy(this._cameraPosition,v.eye),x.invert(this._projectionInverse,v.projectionMatrix),x.invert(this._viewInverse,v.viewMatrix),l.set(this._nearFar,v.near,v.far),this._altitudeFade=y.computeInnerAltitudeFade(this._cameraHeight-this._lowerBoundEarthRadius),this._hazeStrength=this._darkenHaze?c.lerp(.6,1,c.smoothstep(9500,10500,this._cameraHeight-r.earth.radius)):1)};q.isSupported=function(v){return v.renderContext.rctx.capabilities.depthTexture};
return q}();a.ChapmanAtmosphere=t;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/atmosphereUtils":function(){define(["exports","../../../chunks/vec3f64"],function(a,b){const c=b.fromValues(5.802E-6,1.3558E-5,3.31E-5);b=b.fromValues(1.95E-6,5.643E-6,2.55E-7);a.atmosphereHeight=1E5;a.betaMie=3.996E-6;a.betaOzone=b;a.betaRayleigh=c;a.computeInnerAltitudeFade=function(d){return Math.min(1,Math.max(0,(d-1E5)/9E5))};a.innerAtmosphereDepth=1E4;a.rayLeighScaleHeight=.085;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/environment/ChapmanAtmosphereTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../chunks/ChapmanAtmosphere.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k){w=function(r){function y(){return r.apply(this,arguments)||this}c._inheritsLoose(y,r);var p=y.prototype;p.initializeProgram=function(h){const m=y.shader.get().build({haze:this.configuration.haze});return new f.Program(h.rctx,m,n.Default3D)};p.initializePipeline=function(){return this.configuration.haze?k.makePipelineState({blending:k.separateBlendingParams(e.BlendFactor.ONE,e.BlendFactor.ZERO,e.BlendFactor.ONE_MINUS_SRC_COLOR,e.BlendFactor.ONE),colorWrite:k.defaultColorWriteParams}):
k.makePipelineState({blending:k.separateBlendingParams(e.BlendFactor.SRC_ALPHA,e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA,e.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:e.CompareFunction.LEQUAL},colorWrite:k.defaultColorWriteParams})};return y}(w.ShaderTechnique);w.shader=new x.ReloadableShaderModule(g.ChapmanAtmosphereShader,()=>new Promise((r,y)=>a(["./ChapmanAtmosphere.glsl"],r,y)));g=function(r){function y(){var p=r.apply(this,arguments)||this;p.haze=!1;return p}c._inheritsLoose(y,
r);return y}(l.ShaderTechniqueConfiguration);d.__decorate([l.parameter()],g.prototype,"haze",void 0);b.ChapmanAtmosphereTechnique=w;b.ChapmanAtmosphereTechniqueConfiguration=g;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/ChapmanAtmosphere.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,d,g,x,w){function l(f){const e=new x.ShaderBuilder;e.attributes.add(w.VertexAttribute.POSITION,"vec2");e.include(b.TextureCoordinateAttribute,{attributeTextureCoordinates:b.TextureCoordinateAttributeType.Default});e.varyings.add("worldRay","vec3");e.varyings.add("eyeDir","vec3");e.vertex.uniforms.add("inverseProjectionMatrix","mat4");e.vertex.uniforms.add("inverseViewMatrix","mat4");e.vertex.code.add(g.glsl`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`);e.fragment.uniforms.add("lightingMainDirection","vec3").add("radii","vec2").add("scaleHeight","float").add("cameraPosition","vec3").add("nearFar","vec2").add("heightParameters","vec4").add("innerFadeDistance","float").add("altitudeFade","float").add("depthTex","sampler2D").add("betaRayleigh","vec3").add("betaCombined","vec3").add("betaMie","float").add("hazeStrength","float");e.include(d.Gamma);f.haze&&e.fragment.include(c.ReadLinearDepth);e.fragment.code.add(g.glsl`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`);e.fragment.code.add(g.glsl`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`);e.fragment.code.add(g.glsl`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`);e.fragment.code.add(g.glsl`
    const int STEPS = 6;

    float getGlow(float dist, float radius, float intensity) {
      return pow(radius / max(dist, 1e-6), intensity);
    }

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${f.haze?g.glsl`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${f.haze?g.glsl``:" mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * "} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${f.haze?"":g.glsl`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.05968310365 * mumu;

      ${f.haze?g.glsl`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:g.glsl`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.11936620731 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie += getGlow(1.0 - mu, 5e-5, 3.0) * smoothstep(0.01, 0.1, length(scattering));
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
      vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
      if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
        return fragColor;
      }

      float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
      vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
      float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
      if (relDist > 1.0) {
        return surfaceColor;
      }

      return mix(gl_FragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${f.haze?g.glsl`
          vec4 depthSample = texture2D(depthTex, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;
            cameraSpaceRay *= -linearDepthFromTexture(depthTex, vuv0, nearFar);
            terrainDepth = max(0.0, length(cameraSpaceRay));
          }`:g.glsl`
          float depthSample = texture2D(depthTex, vuv0).r;
          if (depthSample != 1.0) {
            gl_FragColor = vec4(0);
            return;
          }`}

      ${f.haze?g.glsl`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, lightingMainDirection, terrainDepth);
            }
            float alpha = 1.0 - fadeOut;`:g.glsl`
            vec3 col = getAtmosphereColour(cameraPosition, rayDir, lightingMainDirection, terrainDepth);;
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}
      col = tonemapACES(col);
      gl_FragColor = delinearizeGamma(vec4(col, alpha));
      ${f.haze?"":g.glsl`
          if (depthSample == 1.0) {
            gl_FragColor = applyUndergroundAtmosphere(rayDir, lightingMainDirection, gl_FragColor);
          }`}
    }
  `);return e}const n=Object.freeze({__proto__:null,build:l});a.ChapmanAtmosphereShader=n;a.build=l})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl":function(){define(["exports","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,c){a.TextureCoordinateAttributeType=void 0;(function(d){d[d.None=0]="None";d[d.Default=1]="Default";d[d.Atlas=2]="Atlas";d[d.COUNT=3]="COUNT"})(a.TextureCoordinateAttributeType||(a.TextureCoordinateAttributeType=
{}));a.TextureCoordinateAttribute=function(d,g){g.attributeTextureCoordinates===a.TextureCoordinateAttributeType.Default&&(d.attributes.add(c.VertexAttribute.UV0,"vec2"),d.varyings.add("vuv0","vec2"),d.vertex.code.add(b.glsl`void forwardTextureCoordinates() {
vuv0 = uv0;
}`));g.attributeTextureCoordinates===a.TextureCoordinateAttributeType.Atlas&&(d.attributes.add(c.VertexAttribute.UV0,"vec2"),d.varyings.add("vuv0","vec2"),d.attributes.add(c.VertexAttribute.UVREGION,"vec4"),d.varyings.add("vuvRegion","vec4"),d.vertex.code.add(b.glsl`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`));g.attributeTextureCoordinates===a.TextureCoordinateAttributeType.None&&d.vertex.code.add(b.glsl`void forwardTextureCoordinates() {}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderModules/interfaces":function(){define(["exports"],function(a){function b(c,...d){let g="";for(let x=0;x<d.length;x++)g+=c[x]+d[x];return g+=c[c.length-1]}(function(c){c.int=function(d){return Math.round(d).toString()};c.float=function(d){return d.toPrecision(8)}})(b||(b=
{}));a.glsl=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/VertexAttribute":function(){define(["exports"],function(a){a.VertexAttribute=void 0;var b=a.VertexAttribute||(a.VertexAttribute={});b.POSITION="position";b.NORMAL="normal";b.UV0="uv0";b.AUXPOS1="auxpos1";b.AUXPOS2="auxpos2";b.MAPPOS="mapPos";b.COLOR="color";b.SYMBOLCOLOR="symbolColor";b.SIZE="size";b.TANGENT="tangent";b.OFFSET="offset";b.SUBDIVISIONFACTOR="subdivisionFactor";b.COLORFEATUREATTRIBUTE="colorFeatureAttribute";
b.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute";b.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute";b.DISTANCETOSTART="distanceToStart";b.UVMAPSPACE="uvMapSpace";b.BOUNDINGRECT="boundingRect";b.UVREGION="uvRegion";b.NORMALCOMPRESSED="normalCompressed";b.PROFILERIGHT="profileRight";b.PROFILEUP="profileUp";b.PROFILEVERTEXANDNORMAL="profileVertexAndNormal";b.FEATUREVALUE="featureValue";b.MODELORIGINHI="modelOriginHi";b.MODELORIGINLO="modelOriginLo";b.MODEL="model";b.MODELNORMAL="modelNormal";b.INSTANCECOLOR=
"instanceColor";b.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute";b.LOCALTRANSFORM="localTransform";b.GLOBALTRANSFORM="globalTransform";b.BOUNDINGSPHERE="boundingSphere";b.MODELORIGIN="modelOrigin";b.MODELSCALEFACTORS="modelScaleFactors";b.FEATUREATTRIBUTE="featureAttribute";b.STATE="state";b.LODLEVEL="lodLevel";b.POSITION0="position0";b.POSITION1="position1";b.NORMALA="normalA";b.NORMALB="normalB";b.COMPONENTINDEX="componentIndex";b.VARIANTOFFSET="variantOffset";b.VARIANTSTROKE="variantStroke";
b.VARIANTEXTENSION="variantExtension";b.U8PADDING="u8padding";b.U16PADDING="u16padding";b.SIDENESS="sideness";b.START="start";b.END="end";b.UP="up";b.EXTRUDE="extrude";Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl":function(){define(["exports","../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(a,b,c){a.ReadLinearDepth=function(d){d.include(b.RgbaFloatEncoding);d.code.add(c.glsl`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture2D(depthTex, uv)), nearFar);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.RgbaFloatEncoding=function(c){c.code.add(b.glsl`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.Gamma=function(c){c.fragment.code.add(b.glsl`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderModules/ShaderBuilder":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/Logger"],function(a,b,c){const d=c.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");c=function(){function r(){this.includedModules=new Map}r.prototype.include=function(y,p){this.includedModules.has(y)?this.includedModules.get(y)!==p&&d.error("Trying to include shader module multiple times with different sets of options."):
(this.includedModules.set(y,p),y(this.builder,p))};return r}();let g=function(r){function y(){var p=r.apply(this,arguments)||this;p.vertex=new l;p.fragment=new l;p.attributes=new n;p.varyings=new f;p.extensions=new e;p.constants=new k;return p}b._inheritsLoose(y,r);y.prototype.generateSource=function(p){const h=this.extensions.generateSource(p),m=this.attributes.generateSource(p),u=this.varyings.generateSource();var t="vertex"===p?this.vertex:this.fragment;const q=t.uniforms.generateSource(),z=t.code.generateSource();
p="vertex"===p?"precision highp float;\nprecision highp sampler2D;":"#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif";t=this.constants.generateSource().concat(t.constants.generateSource());return`\n${h.join("\n")}\n\n${p}\n\n${t.join("\n")}\n\n${q.join("\n")}\n\n${m.join("\n")}\n\n${u.join("\n")}\n\n${z.join("\n")}`};b._createClass(y,[{key:"fragmentUniforms",get:function(){return this.fragment.uniforms}},
{key:"builder",get:function(){return this}}]);return y}(c),x=function(){function r(){this._entries=new Map}var y=r.prototype;y.add=function(p,h,m){this._entries.set(`${p}_${h}_${m}`,{name:p,type:h,arraySize:m});return this};y.generateSource=function(){return Array.from(this._entries.values()).map(p=>{var h=p.arraySize;return`uniform ${p.type} ${p.name}${h?`[${h}]`:""};`})};b._createClass(r,[{key:"entries",get:function(){return Array.from(this._entries.values())}}]);return r}(),w=function(){function r(){this._entries=
[]}var y=r.prototype;y.add=function(p){this._entries.push(p)};y.generateSource=function(){return this._entries};return r}(),l=function(r){function y(){var p=r.apply(this,arguments)||this;p.uniforms=new x;p.code=new w;p.constants=new k;return p}b._inheritsLoose(y,r);b._createClass(y,[{key:"builder",get:function(){return this}}]);return y}(c),n=function(){function r(){this._entries=[]}var y=r.prototype;y.add=function(p,h){this._entries.push([p,h])};y.generateSource=function(p){return"fragment"===p?
[]:this._entries.map(h=>`attribute ${h[1]} ${h[0]};`)};return r}(),f=function(){function r(){this._entries=[]}var y=r.prototype;y.add=function(p,h){this._entries.push([p,h])};y.generateSource=function(){return this._entries.map(p=>`varying ${p[1]} ${p[0]};`)};return r}(),e=function(){function r(){this._entries=new Set}var y=r.prototype;y.add=function(p){this._entries.add(p)};y.generateSource=function(p){const h="vertex"===p?r.ALLOWLIST_VERTEX:r.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(m=>
h.includes(m)).map(m=>`#extension ${m} : enable`)};return r}();e.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"];e.ALLOWLIST_VERTEX=[];let k=function(){function r(){this._entries=[]}var y=r.prototype;y.add=function(p,h,m){let u="ERROR_CONSTRUCTOR_STRING";switch(h){case "float":u=r._numberToFloatStr(m);break;case "int":u=r._numberToIntStr(m);break;case "bool":u=m.toString();break;case "vec2":u=`vec2(${r._numberToFloatStr(m[0])},                            ${r._numberToFloatStr(m[1])})`;
break;case "vec3":u=`vec3(${r._numberToFloatStr(m[0])},                            ${r._numberToFloatStr(m[1])},                            ${r._numberToFloatStr(m[2])})`;break;case "vec4":u=`vec4(${r._numberToFloatStr(m[0])},                            ${r._numberToFloatStr(m[1])},                            ${r._numberToFloatStr(m[2])},                            ${r._numberToFloatStr(m[3])})`;break;case "ivec2":u=`ivec2(${r._numberToIntStr(m[0])},                             ${r._numberToIntStr(m[1])})`;
break;case "ivec3":u=`ivec3(${r._numberToIntStr(m[0])},                             ${r._numberToIntStr(m[1])},                             ${r._numberToIntStr(m[2])})`;break;case "ivec4":u=`ivec4(${r._numberToIntStr(m[0])},                             ${r._numberToIntStr(m[1])},                             ${r._numberToIntStr(m[2])},                             ${r._numberToIntStr(m[3])})`;break;case "mat2":case "mat3":case "mat4":u=`${h}(${Array.prototype.map.call(m,t=>r._numberToFloatStr(t)).join(", ")})`}this._entries.push(`const ${h} ${p} = ${u};`);
return this};r._numberToIntStr=function(p){return p.toFixed(0)};r._numberToFloatStr=function(p){return Number.isInteger(p)?p.toFixed(1):p.toString()};y.generateSource=function(){return Array.from(this._entries)};return r}();a.Code=w;a.Includes=c;a.ShaderBuilder=g;a.Stage=l;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ReloadableShaderModule":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function d(x,
w){this._module=x;this._loadModule=w}var g=d.prototype;g.get=function(){return this._module};g.reload=function(){var x=b._asyncToGenerator(function*(){return this._module=yield this._loadModule()});return function(){return x.apply(this,arguments)}}();return d}();a.ReloadableShaderModule=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechnique":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe",
"../../../../webgl/enums"],function(a,b,c,d){let g=function(){function x(l,n,f){this.release=f;n&&(this._config=n.snapshot());this._program=this.initializeProgram(l);this._pipeline=this.initializePipeline(l)}var w=x.prototype;w.destroy=function(){this._program=c.disposeMaybe(this._program);this._pipeline=this._config=null};w.reload=function(l){c.disposeMaybe(this._program);this._program=this.initializeProgram(l);this._pipeline=this.initializePipeline(l)};w.bindPass=function(l,n){};w.bindMaterial=
function(l,n){};w.bindDraw=function(l){};w.bindPipelineState=function(l,n=null,f){l.setPipelineState(this.getPipelineState(n,f))};w.ensureAttributeLocations=function(l){this.program.assertCompatibleVertexAttributeLocations(l)};w.getPipelineState=function(l,n){return this._pipeline};b._createClass(x,[{key:"program",get:function(){return this._program}},{key:"key",get:function(){return this._config.key}},{key:"configuration",get:function(){return this._config}},{key:"primitiveType",get:function(){return d.PrimitiveType.TRIANGLES}}]);
return x}();a.ShaderTechnique=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function d(){this._key="";this._keyDirty=!1;this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[];this._parameterNames||(this._parameterNames=[])}d.prototype.snapshot=function(){const g=this._parameterNames,
x={key:this.key};for(const w of g)x[w]=this[w];return x};b._createClass(d,[{key:"key",get:function(){this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits));return this._key}}]);return d}();a.ShaderTechniqueConfiguration=c;a.parameter=function(d={}){return(g,x)=>{var w,l;g._parameterNames=null!=(w=g._parameterNames)?w:[];g._parameterNames.push(x);const n=g._parameterNames.length-1;w=Math.ceil(Math.log2(d.count||2));const f=null!=(l=g._parameterBits)?l:[0];
let e=0;for(;16<f[e]+w;)e++,e>=f.length&&f.push(0);g._parameterBits=f;const k=f[e],r=(1<<w)-1<<k;f[e]+=w;Object.defineProperty(g,x,{get(){return this[n]},set(y){if(this[n]!==y&&(this[n]=y,this._keyDirty=!0,this._parameterBits[e]=this._parameterBits[e]&~r|+y<<k&r,"number"!==typeof y&&"boolean"!==typeof y))throw"Configuration value for "+x+" must be boolean or number, got "+typeof y;}})}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":function(){define(["exports",
"./VertexAttribute"],function(a,b){b=new Map([[b.VertexAttribute.POSITION,0],[b.VertexAttribute.NORMAL,1],[b.VertexAttribute.UV0,2],[b.VertexAttribute.COLOR,3],[b.VertexAttribute.SIZE,4],[b.VertexAttribute.TANGENT,4],[b.VertexAttribute.AUXPOS1,5],[b.VertexAttribute.SYMBOLCOLOR,5],[b.VertexAttribute.AUXPOS2,6],[b.VertexAttribute.FEATUREATTRIBUTE,6],[b.VertexAttribute.INSTANCEFEATUREATTRIBUTE,6],[b.VertexAttribute.INSTANCECOLOR,7],[b.VertexAttribute.MODEL,8],[b.VertexAttribute.MODELNORMAL,12],[b.VertexAttribute.MODELORIGINHI,
11],[b.VertexAttribute.MODELORIGINLO,15]]);a.Default3D=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Program":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/PooledArray","../../../webgl/checkWebGLError"],function(a,b,c,d,g){let x=function(){function w(n,f,e){this._context=n;this._locations=e;this._textures=new Map;this._freeTextureUnits=new d({deallocator:null});this._glProgram=n.programCache.acquire(f.generateSource("vertex"),
f.generateSource("fragment"),e);this._glProgram.stop=()=>{throw Error("Wrapped _glProgram used directly");};this._fragmentUniforms=g.webglDebugEnabled()?f.fragmentUniforms.entries:null}var l=w.prototype;l.dispose=function(){this._glProgram.dispose()};l.setUniform1b=function(n,f){this._glProgram.setUniform1i(n,f?1:0)};l.setUniform1i=function(n,f){this._glProgram.setUniform1i(n,f)};l.setUniform1f=function(n,f){this._glProgram.setUniform1f(n,f)};l.setUniform1fv=function(n,f){this._glProgram.setUniform1fv(n,
f)};l.setUniform1iv=function(n,f){this._glProgram.setUniform1iv(n,f)};l.setUniform2f=function(n,f,e){this._glProgram.setUniform2f(n,f,e)};l.setUniform2fv=function(n,f){this._glProgram.setUniform2fv(n,f)};l.setUniform2iv=function(n,f){this._glProgram.setUniform2iv(n,f)};l.setUniform3f=function(n,f,e,k){this._glProgram.setUniform3f(n,f,e,k)};l.setUniform3fv=function(n,f){this._glProgram.setUniform3fv(n,f)};l.setUniform3iv=function(n,f){this._glProgram.setUniform3iv(n,f)};l.setUniform4f=function(n,f,
e,k,r){this._glProgram.setUniform4f(n,f,e,k,r)};l.setUniform4fv=function(n,f){this._glProgram.setUniform4fv(n,f)};l.setUniform4iv=function(n,f){this._glProgram.setUniform4iv(n,f)};l.setUniformMatrix3fv=function(n,f){this._glProgram.setUniformMatrix3fv(n,f)};l.setUniformMatrix4fv=function(n,f){this._glProgram.setUniformMatrix4fv(n,f)};l.assertCompatibleVertexAttributeLocations=function(n){n.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")};l.stop=function(){this._textures.clear();
this._freeTextureUnits.clear()};l.bindTexture=function(n,f){if(c.isNone(n)||null==n.glName){if(n=this._textures.get(f))this._context.bindTexture(null,n.unit),this._freeTextureUnit(n),this._textures.delete(f);return null}let e=this._textures.get(f);null==e?(e=this._allocTextureUnit(n),this._textures.set(f,e)):e.texture=n;this._context.useProgram(this);this.setUniform1i(f,e.unit);this._context.bindTexture(n,e.unit);return e.unit};l.rebindTextures=function(){this._context.useProgram(this);this._textures.forEach((n,
f)=>{this._context.bindTexture(n.texture,n.unit);this.setUniform1i(f,n.unit)});c.isSome(this._fragmentUniforms)&&this._fragmentUniforms.forEach(n=>{if(("sampler2D"===n.type||"samplerCube"===n.type)&&!this._textures.has(n.name))throw Error(`Texture sampler ${n.name} has no bound texture`);})};l._allocTextureUnit=function(n){return{texture:n,unit:0===this._freeTextureUnits.length?this._textures.size:this._freeTextureUnits.pop()}};l._freeTextureUnit=function(n){this._freeTextureUnits.push(n.unit)};b._createClass(w,
[{key:"glName",get:function(){return this._glProgram.glName}},{key:"isCompiled",get:function(){return this._glProgram.isCompiled}}]);return w}();a.Program=x;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/checkWebGLError":function(){define(["exports","../../core/Error","../../core/has","../../core/Logger"],function(a,b,c,d){function g(l,n){switch(n){case l.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case l.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";
case l.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case l.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case l.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case l.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const x=d.getLogger("esri/views/webgl"),
w=!!c("enable-feature:webgl-debug");a.checkWebGLError=function(l){if(w){const n=l.getError();n&&(l=g(l,n),x.error(new b("webgl-error","WebGL error occured",{message:l,stack:Error().stack})))}};a.hasFeatureFlagWebGLDebug=w;a.webglDebugEnabled=function(){return w};a.webglValidateShadersEnabled=function(){return w};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/renderState":function(){define(["exports","../3d/webgl-engine/lib/basicInterfaces","./enums"],function(a,b,c){function d(P){return A.intern(P)}
function g(P){return E.intern(P)}function x(P){return C.intern(P)}function w(P){return D.intern(P)}function l(P){return F.intern(P)}function n(P){return G.intern(P)}function f(P){return J.intern(P)}function e(P){return I.intern(P)}function k(P){return"["+P.join(",")+"]"}function r(P){return P?k([P.srcRgb,P.srcAlpha,P.dstRgb,P.dstAlpha,P.opRgb,P.opAlpha,P.color.r,P.color.g,P.color.b,P.color.a]):null}function y(P){return P?k([P.face,P.mode]):null}function p(P){return P?k([P.factor,P.units]):null}function h(P){return P?
k([P.func]):null}function m(P){return P?k([P.function.func,P.function.ref,P.function.mask,P.operation.fail,P.operation.zFail,P.operation.zPass]):null}function u(P){return P?k([P.zNear,P.zFar]):null}function t(P){return P?k([P.r,P.g,P.b,P.a]):null}function q(P){return P?k([P.mask]):null}const z={face:c.Face.BACK,mode:c.CullMode.CCW},v={face:c.Face.FRONT,mode:c.CullMode.CCW};var B=function(){function P(K,M){this.makeKey=K;this.makeRef=M;this.interns=new Map}P.prototype.intern=function(K){if(!K)return null;
const M=this.makeKey(K),U=this.interns;U.has(M)||U.set(M,this.makeRef(K));return U.get(M)};return P}();const A=new B(r,P=>({__tag:"Blending",...P})),E=new B(y,P=>({__tag:"Culling",...P})),C=new B(p,P=>({__tag:"PolygonOffset",...P})),D=new B(h,P=>({__tag:"DepthTest",...P})),F=new B(m,P=>({__tag:"StencilTest",...P})),G=new B(u,P=>({__tag:"DepthWrite",...P})),J=new B(t,P=>({__tag:"ColorWrite",...P})),I=new B(q,P=>({__tag:"StencilWrite",...P})),O=new B(function(P){return P?k([r(P.blending),y(P.culling),
p(P.polygonOffset),h(P.depthTest),m(P.stencilTest),u(P.depthWrite),t(P.colorWrite),q(P.stencilWrite)]):null},P=>({blending:d(P.blending),culling:g(P.culling),polygonOffset:x(P.polygonOffset),depthTest:w(P.depthTest),stencilTest:l(P.stencilTest),depthWrite:n(P.depthWrite),colorWrite:f(P.colorWrite),stencilWrite:e(P.stencilWrite)}));B=function(){function P(M){this._stencilWriteInvalid=this._colorWriteInvalid=this._depthWriteInvalid=this._stencilTestInvalid=this._depthTestInvalid=this._polygonOffsetInvalid=
this._cullingInvalid=this._blendingInvalid=this._pipelineInvalid=!0;this._stateSetters=M}var K=P.prototype;K.setPipeline=function(M){if(this._pipelineInvalid||M!==this._pipeline)this._setBlending(M.blending),this._setCulling(M.culling),this._setPolygonOffset(M.polygonOffset),this._setDepthTest(M.depthTest),this._setStencilTest(M.stencilTest),this._setDepthWrite(M.depthWrite),this._setColorWrite(M.colorWrite),this._setStencilWrite(M.stencilWrite),this._pipeline=M;this._pipelineInvalid=!1};K.invalidateBlending=
function(){this._pipelineInvalid=this._blendingInvalid=!0};K.invalidateCulling=function(){this._pipelineInvalid=this._cullingInvalid=!0};K.invalidatePolygonOffset=function(){this._pipelineInvalid=this._polygonOffsetInvalid=!0};K.invalidateDepthTest=function(){this._pipelineInvalid=this._depthTestInvalid=!0};K.invalidateStencilTest=function(){this._pipelineInvalid=this._stencilTestInvalid=!0};K.invalidateDepthWrite=function(){this._pipelineInvalid=this._depthWriteInvalid=!0};K.invalidateColorWrite=
function(){this._pipelineInvalid=this._colorWriteInvalid=!0};K.invalidateStencilWrite=function(){this._pipelineInvalid=this._stencilTestInvalid=!0};K._setBlending=function(M){this._blending=this._setSubState(M,this._blending,this._blendingInvalid,this._stateSetters.setBlending);this._blendingInvalid=!1};K._setCulling=function(M){this._culling=this._setSubState(M,this._culling,this._cullingInvalid,this._stateSetters.setCulling);this._cullingInvalid=!1};K._setPolygonOffset=function(M){this._polygonOffset=
this._setSubState(M,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset);this._polygonOffsetInvalid=!1};K._setDepthTest=function(M){this._depthTest=this._setSubState(M,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest);this._depthTestInvalid=!1};K._setStencilTest=function(M){this._stencilTest=this._setSubState(M,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest);this._stencilTestInvalid=!1};K._setDepthWrite=function(M){this._depthWrite=
this._setSubState(M,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite);this._depthWriteInvalid=!1};K._setColorWrite=function(M){this._colorWrite=this._setSubState(M,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite);this._colorWriteInvalid=!1};K._setStencilWrite=function(M){this._stencilWrite=this._setSubState(M,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite);this._stencilTestInvalid=!1};K._setSubState=function(M,U,R,
L){if(R||M!==U)L(M),this._pipelineInvalid=!0;return M};return P}();a.StateTracker=B;a.backFaceCullingParams=z;a.cullingParams=P=>P===b.CullFaceOptions.Back?z:P===b.CullFaceOptions.Front?v:null;a.defaultColorWriteParams={r:!0,g:!0,b:!0,a:!0};a.defaultDepthWriteParams={zNear:0,zFar:1};a.frontFaceCullingParams=v;a.makeBlending=d;a.makeColorWrite=f;a.makeCulling=g;a.makeDepthTest=w;a.makeDepthWrite=n;a.makePipelineState=function(P){return O.intern(P)};a.makePolygonOffset=x;a.makeStencilTest=l;a.makeStencilWrite=
e;a.separateBlendingParams=function(P,K,M,U,R=c.BlendOperation.ADD,L=c.BlendOperation.ADD,N=[0,0,0,0]){return{srcRgb:P,srcAlpha:K,dstRgb:M,dstAlpha:U,opRgb:R,opAlpha:L,color:{r:N[0],g:N[1],b:N[2],a:N[3]}}};a.simpleBlendingParams=function(P,K,M=c.BlendOperation.ADD,U=[0,0,0,0]){return{srcRgb:P,srcAlpha:P,dstRgb:K,dstAlpha:K,opRgb:M,opAlpha:M,color:{r:U[0],g:U[1],b:U[2],a:U[3]}}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/basicInterfaces":function(){define(["exports"],
function(a){a.CullFaceOptions=void 0;(function(b){b[b.None=0]="None";b[b.Front=1]="Front";b[b.Back=2]="Back";b[b.COUNT=3]="COUNT"})(a.CullFaceOptions||(a.CullFaceOptions={}));a.DepthTestFunction=void 0;(function(b){b[b.Less=0]="Less";b[b.Lequal=1]="Lequal";b[b.COUNT=2]="COUNT"})(a.DepthTestFunction||(a.DepthTestFunction={}));a.AntiAliasingMode=void 0;(function(b){b[b.NONE=0]="NONE";b[b.SMAA=1]="SMAA"})(a.AntiAliasingMode||(a.AntiAliasingMode={}));a.TransparencyPassType=void 0;(function(b){b[b.Color=
0]="Color";b[b.Alpha=1]="Alpha";b[b.FrontFace=2]="FrontFace";b[b.NONE=3]="NONE";b[b.COUNT=4]="COUNT"})(a.TransparencyPassType||(a.TransparencyPassType={}));a.RenderRequestType=void 0;(function(b){b[b.BACKGROUND=0]="BACKGROUND";b[b.UPDATE=1]="UPDATE"})(a.RenderRequestType||(a.RenderRequestType={}));a.ResourceState=void 0;(function(b){b[b.NOT_LOADED=0]="NOT_LOADED";b[b.LOADING=1]="LOADING";b[b.LOADED=2]="LOADED"})(a.ResourceState||(a.ResourceState={}));a.StencilBits=void 0;(function(b){b[b.IntegratedMeshMaskExcluded=
1]="IntegratedMeshMaskExcluded";b[b.OutlineVisualElementMask=2]="OutlineVisualElementMask"})(a.StencilBits||(a.StencilBits={}));a.UpdatePolicy=void 0;(function(b){b[b.ASYNC=0]="ASYNC";b[b.SYNC=1]="SYNC"})(a.UpdatePolicy||(a.UpdatePolicy={}));a.Object3DState=void 0;(function(b){b[b.Highlight=0]="Highlight";b[b.MaskOccludee=1]="MaskOccludee";b[b.COUNT=2]="COUNT"})(a.Object3DState||(a.Object3DState={}));a.PrimitiveType=void 0;(function(b){b[b.Triangle=0]="Triangle";b[b.Point=1]="Point";b[b.Line=2]="Line"})(a.PrimitiveType||
(a.PrimitiveType={}));a.PowerOfTwoResizeMode=void 0;(function(b){b[b.STRETCH=1]="STRETCH";b[b.PAD=2]="PAD"})(a.PowerOfTwoResizeMode||(a.PowerOfTwoResizeMode={}));a.ValidationState=void 0;(function(b){b[b.CHANGED=0]="CHANGED";b[b.UNCHANGED=1]="UNCHANGED"})(a.ValidationState||(a.ValidationState={}));a.AlphaDiscardMode=void 0;(function(b){b[b.Blend=0]="Blend";b[b.Opaque=1]="Opaque";b[b.Mask=2]="Mask";b[b.MaskBlend=3]="MaskBlend";b[b.COUNT=4]="COUNT"})(a.AlphaDiscardMode||(a.AlphaDiscardMode={}));a.Decorations=
void 0;(function(b){b[b.OFF=0]="OFF";b[b.ON=1]="ON"})(a.Decorations||(a.Decorations={}));Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/DefaultVertexBufferLayouts":function(){define(["exports","./VertexAttribute","../../../webgl/enums","../../../webgl/VertexElementDescriptor"],function(a,b,c,d){const g=[new d.VertexElementDescriptor(b.VertexAttribute.POSITION,3,c.DataType.FLOAT,0,12)],x=[new d.VertexElementDescriptor(b.VertexAttribute.POSITION,3,c.DataType.FLOAT,
0,20),new d.VertexElementDescriptor(b.VertexAttribute.UV0,2,c.DataType.FLOAT,12,20)],w=[new d.VertexElementDescriptor(b.VertexAttribute.POSITION,3,c.DataType.FLOAT,0,32),new d.VertexElementDescriptor(b.VertexAttribute.NORMAL,3,c.DataType.FLOAT,12,32),new d.VertexElementDescriptor(b.VertexAttribute.UV0,2,c.DataType.FLOAT,24,32)],l=[new d.VertexElementDescriptor(b.VertexAttribute.POSITION,3,c.DataType.FLOAT,0,16),new d.VertexElementDescriptor(b.VertexAttribute.COLOR,4,c.DataType.UNSIGNED_BYTE,12,16)],
n=[new d.VertexElementDescriptor(b.VertexAttribute.POSITION,2,c.DataType.FLOAT,0,8)];b=[new d.VertexElementDescriptor(b.VertexAttribute.POSITION,2,c.DataType.FLOAT,0,16),new d.VertexElementDescriptor(b.VertexAttribute.UV0,2,c.DataType.FLOAT,8,16)];a.Pos2=n;a.Pos2Tex=b;a.Pos3=g;a.Pos3Col=l;a.Pos3NormalTex=w;a.Pos3Tex=x;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/VertexElementDescriptor":function(){define(["exports"],function(a){a.VertexElementDescriptor=function(b,c,d,g,x,
w=!1,l=0){this.name=b;this.count=c;this.type=d;this.offset=g;this.stride=x;this.normalized=w;this.divisor=l};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/glUtil3D":function(){define("exports ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/Texture ../../../webgl/VertexArrayObject".split(" "),function(a,b,c,d,g,x,w){a.createColorTexture=function(l,n,f=4){const e=new Uint8Array(f*f*4);
for(let k=0;k<e.length;k+=4)e[k+0]=255*n[0],e[k+1]=255*n[1],e[k+2]=255*n[2],e[k+3]=255*n[3];return new x.Texture(l,{target:g.TextureType.TEXTURE_2D,pixelFormat:g.PixelFormat.RGBA,dataType:g.PixelType.UNSIGNED_BYTE,samplingMode:g.TextureSamplingMode.NEAREST,width:f,height:f},e)};a.createEmptyDepthTexture=function(l){return new x.Texture(l,{target:g.TextureType.TEXTURE_2D,pixelFormat:g.PixelFormat.RGBA,dataType:g.PixelType.UNSIGNED_BYTE,samplingMode:g.TextureSamplingMode.NEAREST,width:1,height:1},new Uint8Array([255,
255,255,255]))};a.createEmptyTexture=function(l,n=4){return new x.Texture(l,{target:g.TextureType.TEXTURE_2D,pixelFormat:g.PixelFormat.RGBA,dataType:g.PixelType.UNSIGNED_BYTE,samplingMode:g.TextureSamplingMode.NEAREST,width:n,height:n})};a.createQuadVAO=function(l,n=c.Pos2,f=b.Default3D,e=-1,k=1){let r=null;switch(n){case c.Pos2Tex:r=new Float32Array([e,e,0,0,k,e,1,0,e,k,0,1,k,k,1,1]);break;default:r=new Float32Array([e,e,k,e,e,k,k,k])}return new w.VertexArrayObject(l,f,{geometry:n},{geometry:d.BufferObject.createVertex(l,
g.Usage.STATIC_DRAW,r)})};a.createScreenSizeTriangleVAO=function(l,n=c.Pos2,f=b.Default3D){const e=new Float32Array([-1,-1,3,-1,-1,3]);return new w.VertexArrayObject(l,f,{geometry:n},{geometry:d.BufferObject.createVertex(l,g.Usage.STATIC_DRAW,e)})};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/BufferObject":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/arrayUtils ../../core/Logger ../../core/maybe ../../core/typedArrayUtil ./checkWebGLError ./context-util ./enums".split(" "),
function(a,b,c,d,g,x,w,l,n){const f=d.getLogger("esri.views.webgl.BufferObject");d=function(){function e(r,y,p,h){this._context=r;this.bufferType=y;this.usage=p;this._glName=null;this._size=-1;this._indexType=void 0;r.instanceCounter.increment(n.ResourceType.Buffer,this);this._glName=this._context.gl.createBuffer();w.checkWebGLError(this._context.gl);h&&this.setData(h)}e.createIndex=function(r,y,p){return new e(r,n.BufferType.ELEMENT_ARRAY_BUFFER,y,p)};e.createVertex=function(r,y,p){return new e(r,
n.BufferType.ARRAY_BUFFER,y,p)};e.createUniform=function(r,y,p){if(r.type!==l.ContextType.WEBGL2)throw Error("Uniform buffers are supported in WebGL2 only!");return new e(r,n.BufferType.UNIFORM_BUFFER,y,p)};e.createPixelPack=function(r,y=n.Usage.STREAM_READ,p){if(r.type!==l.ContextType.WEBGL2)throw Error("Pixel pack buffers are supported in WebGL2 only!");r=new e(r,n.BufferType.PIXEL_PACK_BUFFER,y);p&&r.setSize(p);return r};e.createPixelUnpack=function(r,y=n.Usage.STREAM_DRAW,p){if(r.type!==l.ContextType.WEBGL2)throw Error("Pixel unpack buffers are supported in WebGL2 only!");
return new e(r,n.BufferType.PIXEL_UNPACK_BUFFER,y,p)};var k=e.prototype;k.dispose=function(){var r;null!=(r=this._context)&&r.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(n.ResourceType.Buffer,this),this._context=null):this._glName&&f.warn("Leaked WebGL buffer object")};k.setSize=function(r,y=null){0>=r&&f.error("Buffer size needs to be positive!");if(this.bufferType===n.BufferType.ELEMENT_ARRAY_BUFFER&&g.isSome(y))switch(this._indexType=
y,y){case n.DataType.UNSIGNED_SHORT:r*=2;break;case n.DataType.UNSIGNED_INT:r*=4}this._setBufferData(r)};k.setData=function(r){if(r){var y=r.byteLength;this.bufferType===n.BufferType.ELEMENT_ARRAY_BUFFER&&(x.isUint16Array(r)&&(y/=2,this._indexType=n.DataType.UNSIGNED_SHORT),x.isUint32Array(r)&&(y/=4,this._indexType=n.DataType.UNSIGNED_INT));this._setBufferData(y,r)}};k._setBufferData=function(r,y=null){this._size=r;const p=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null);
this._context.bindBuffer(this);const h=this._context.gl;g.isSome(y)?h.bufferData(this.bufferType,y,this.usage):h.bufferData(this.bufferType,r,this.usage);w.checkWebGLError(h);this._isVAOAware&&this._context.bindVAO(p)};k.setSubData=function(r,y=0,p=0,h=r.byteLength){if(r){(0>y||y>=this._size)&&f.error("offset is out of range!");var m=y,u=p,t=h,q=r.byteLength;this.bufferType===n.BufferType.ELEMENT_ARRAY_BUFFER&&(x.isUint16Array(r)?(q/=2,m*=2,u*=2,t*=2):x.isUint32Array(r)&&(q/=4,m*=4,u*=4,t*=4));void 0===
h&&(h=q-1);p>=h&&f.error("end must be bigger than start!");y+p-h>this._size&&f.error("An attempt to write beyond the end of the buffer!");y=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null);this._context.bindBuffer(this);p=this._context.gl;h=ArrayBuffer.isView(r)?r.buffer:r;r=0===u&&t===r.byteLength?h:h.slice(u,t);p.bufferSubData(this.bufferType,m,r);w.checkWebGLError(p);this._isVAOAware&&this._context.bindVAO(y)}};k.setSubDataFromView=function(r,y,p,h){if(r){(0>y||y>=this._size)&&
f.error("offset is out of range!");p>=h&&f.error("end must be bigger than start!");y+p-h>this._size&&f.error("An attempt to write beyond the end of the buffer!");var m=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null);this._context.bindBuffer(this);var u=this._context.gl;this._context.type===l.ContextType.WEBGL2?u.bufferSubData(this.bufferType,y*r.BYTES_PER_ELEMENT,r,p,h-p):(p=0===p&&h===r.length?r:r.subarray(p,h),u.bufferSubData(this.bufferType,y*r.BYTES_PER_ELEMENT,p));w.checkWebGLError(u);
this._isVAOAware&&this._context.bindVAO(m)}};k.getSubData=function(r,y=0,p,h){if(this._context.type!==l.ContextType.WEBGL2)f.error("Get buffer subdata is supported in WebGL2 only!");else if(0>p||0>h)f.error("Problem getting subdata: offset and length were less than zero!");else{var m=c.isArrayLike(r)?r.BYTES_PER_ELEMENT:1;m*((null!=p?p:0)+(null!=h?h:0))>r.byteLength?f.error("Problem getting subdata: offset and length exceeded destination size!"):(y+m*(null!=h?h:0)>this.byteSize&&f.warn("Potential problem getting subdata: requested data exceeds buffer size!"),
m=this._context.gl,this._context.bindBuffer(this,n.BufferType.COPY_READ_BUFFER),m.getBufferSubData(n.BufferType.COPY_READ_BUFFER,y,r,p,h),this._context.unbindBuffer(n.BufferType.COPY_READ_BUFFER))}};k.getSubDataAsync=function(){var r=b._asyncToGenerator(function*(y,p=0,h,m){this._context.type!==l.ContextType.WEBGL2?f.error("Get buffer subdata is supported in WebGL2 only!"):(yield this._context.clientWaitAsync(),this.getSubData(y,p,h,m))});return function(y){return r.apply(this,arguments)}}();b._createClass(e,
[{key:"glName",get:function(){return this._glName}},{key:"size",get:function(){return this._size}},{key:"indexType",get:function(){return this._indexType}},{key:"byteSize",get:function(){return this.bufferType===n.BufferType.ELEMENT_ARRAY_BUFFER?this._indexType===n.DataType.UNSIGNED_INT?4*this._size:2*this._size:this._size}},{key:"_isVAOAware",get:function(){return this.bufferType===n.BufferType.ELEMENT_ARRAY_BUFFER||this.bufferType===n.BufferType.ARRAY_BUFFER}}]);return e}();a.BufferObject=d;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/webgl/Texture":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/has ../../core/mathUtils ../../core/maybe ./checkWebGLError ./context-util ./enums ./capabilities/isWebGL2Context".split(" "),function(a,b,c,d,g,x,w,l,n){function f(y){return g.isSome(y)&&"type"in y&&"compressed"===y.type}function e(y){var p;if(p=g.isSome(y)&&!f(y))p=!(g.isSome(y)&&"byteLength"in y);return p}function k(y){return y===l.TextureType.TEXTURE_3D||y===l.TextureType.TEXTURE_2D_ARRAY}
function r(y,p,h,m=1){p=Math.max(p,h);y===l.TextureType.TEXTURE_3D&&(p=Math.max(p,m));return Math.round(Math.log(p)/Math.LN2)+1}c=function(){function y(h,m,u=null){this._context=h;this.type="texture";this._glName=null;this._descriptor=void 0;this._wasImmutablyAllocated=this._wrapModeDirty=this._samplingModeDirty=!1;h.instanceCounter.increment(l.ResourceType.Texture,this);this._descriptor={target:l.TextureType.TEXTURE_2D,samplingMode:l.TextureSamplingMode.LINEAR,wrapMode:l.TextureWrapMode.REPEAT,flipped:!1,
hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1,isImmutable:!1,...m};if(h.type!==w.ContextType.WEBGL2&&(this._descriptor.isImmutable&&(this._descriptor.isImmutable=!1),k(this._descriptor.target)))throw Error("3D and array textures are not supported in WebGL1");this._descriptor.target===l.TextureType.TEXTURE_CUBE_MAP?this._setDataCubeMap(u):this.setData(u)}var p=y.prototype;p.dispose=function(){this._context.gl&&this._glName&&(this._context.unbindTextureAllUnits(this),this._context.gl.deleteTexture(this._glName),
this._glName=null,this._context.instanceCounter.decrement(l.ResourceType.Texture,this))};p.release=function(){this.dispose()};p.resize=function(h,m){const u=this._descriptor;if(u.width!==h||u.height!==m){if(this._wasImmutablyAllocated)throw Error("Immutable textures can't be resized!");u.width=h;u.height=m;this._descriptor.target===l.TextureType.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}};p._setDataCubeMap=function(h=null){for(let m=l.TextureType.TEXTURE_CUBE_MAP_POSITIVE_X;m<=
l.TextureType.TEXTURE_CUBE_MAP_NEGATIVE_Z;m++)this._setData(h,m)};p.setData=function(h){this._setData(h)};p._setData=function(h,m){var u;if(this._context&&this._context.gl){var t=this._context.gl;this._glName||(this._glName=t.createTexture());void 0===h&&(h=null);var q=this._descriptor;null!=(u=m)?u:m=q.target;u=k(m);if(null===h&&(q.width=q.width||4,q.height=q.height||4,u)){var z;q.depth=null!=(z=q.depth)?z:1}z=this._context.bindTexture(this,y.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(y.TEXTURE_UNIT_FOR_UPDATES);
y._validateTexture(this._context,q);this._configurePixelStorage();var v=q.pixelFormat,B=q.internalFormat?q.internalFormat:this._deriveInternalFormat(v,q.dataType);if(e(h)){v=h.width;let A=h.height;h instanceof HTMLVideoElement&&(v=h.videoWidth,A=h.videoHeight);q.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(m,B,q.hasMipmap,v,A,1);this._texImage(m,0,B,v,A,1,h);x.checkWebGLError(t);q.hasMipmap&&this.generateMipmap();void 0===q.width&&(q.width=v);void 0===q.height&&(q.height=A);u&&void 0===
q.depth&&(q.depth=1)}else{const {width:A,height:E,depth:C}=q;null!=A&&null!=E||console.error("Width and height must be specified!");u&&null==C&&console.error("Depth must be specified!");q.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(m,B,q.hasMipmap,A,E,C);t.DEPTH24_STENCIL8&&B===t.DEPTH_STENCIL&&(B=t.DEPTH24_STENCIL8);if(f(h)){const D=h.levels;h=r(m,A,E,C);u=Math.min(h-1,D.length-1);n(t)?t.texParameteri(q.target,t.TEXTURE_MAX_LEVEL,u):q.hasMipmap=q.hasMipmap&&h===D.length;const F=B;
if(!(F in l.CompressedTextureFormat))throw Error("Attempting to use compressed data with an umcompressed format!");this._forEachMipmapLevel((G,J,I,O)=>{this._compressedTexImage(m,G,F,J,I,O,D[Math.min(G,D.length-1)])},u)}else g.isSome(h)?(this._texImage(m,0,B,A,E,C,h),x.checkWebGLError(t),q.hasMipmap&&this.generateMipmap()):this._forEachMipmapLevel((D,F,G,J)=>{this._texImage(m,D,B,F,G,J,null);x.checkWebGLError(t)})}y._applySamplingMode(t,this._descriptor);y._applyWrapMode(t,this._descriptor);y._applyAnisotropicFilteringParameters(this._context,
this._descriptor);x.checkWebGLError(t);this._context.bindTexture(z,y.TEXTURE_UNIT_FOR_UPDATES)}};p.updateData=function(h,m,u,t,q,z){z||console.error("An attempt to use uninitialized data!");this._glName||console.error("An attempt to update uninitialized texture!");const v=this._context.gl,B=this._descriptor,{pixelFormat:A,internalFormat:E,dataType:C,isImmutable:D,target:F}=B;if(D&&!this._wasImmutablyAllocated)throw Error("Cannot update immutable texture before allocation!");const G=this._context.bindTexture(this,
y.TEXTURE_UNIT_FOR_UPDATES);(0>m||0>u||t>B.width||q>B.height||m+t>B.width||u+q>B.height)&&console.error("An attempt to update out of bounds of the texture!");this._configurePixelStorage();e(z)?v.texSubImage2D(F,h,m,u,A,C,z):f(z)?v.compressedTexSubImage2D(F,h,m,u,t,q,E,z.levels[h]):v.texSubImage2D(F,h,m,u,t,q,A,C,z);this._context.bindTexture(G,y.TEXTURE_UNIT_FOR_UPDATES)};p.updateData3D=function(h,m,u,t,q,z,v,B){B||console.error("An attempt to use uninitialized data!");this._glName||console.error("An attempt to update uninitialized texture!");
const A=this._context.gl;if(!n(A))throw Error("3D textures are not supported in WebGL1");const E=this._descriptor,{pixelFormat:C,dataType:D,isImmutable:F,target:G,internalFormat:J}=E;if(F&&!this._wasImmutablyAllocated)throw Error("Cannot update immutable texture before allocation!");k(G)||console.warn("Attempting to set 3D texture data on a non-3D texture");const I=this._context.bindTexture(this,y.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(y.TEXTURE_UNIT_FOR_UPDATES);(0>m||0>u||0>t||
q>E.width||z>E.height||v>E.depth||m+q>E.width||u+z>E.height||t+v>E.depth)&&console.error("An attempt to update out of bounds of the texture!");this._configurePixelStorage();f(B)?(B=B.levels[h],A.compressedTexSubImage3D(G,h,m,u,t,q,z,v,J,B)):A.texSubImage3D(G,h,m,u,t,q,z,v,C,D,B);this._context.bindTexture(I,y.TEXTURE_UNIT_FOR_UPDATES)};p.generateMipmap=function(){const h=this._descriptor;if(!h.hasMipmap){if(this._wasImmutablyAllocated)throw Error("Cannot add mipmaps to immutable texture after allocation");
this._samplingModeDirty=h.hasMipmap=!0;y._validateTexture(this._context,h)}h.samplingMode===l.TextureSamplingMode.LINEAR?(this._samplingModeDirty=!0,h.samplingMode=l.TextureSamplingMode.LINEAR_MIPMAP_NEAREST):h.samplingMode===l.TextureSamplingMode.NEAREST&&(this._samplingModeDirty=!0,h.samplingMode=l.TextureSamplingMode.NEAREST_MIPMAP_NEAREST);const m=this._context.bindTexture(this,y.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(y.TEXTURE_UNIT_FOR_UPDATES);this._context.gl.generateMipmap(h.target);
this._context.bindTexture(m,y.TEXTURE_UNIT_FOR_UPDATES)};p.setSamplingMode=function(h){h!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=h,this._samplingModeDirty=!0)};p.setWrapMode=function(h){h!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=h,y._validateTexture(this._context,this._descriptor),this._wrapModeDirty=!0)};p.applyChanges=function(){const h=this._context.gl,m=this._descriptor;this._samplingModeDirty&&(y._applySamplingMode(h,m),this._samplingModeDirty=!1);this._wrapModeDirty&&
(y._applyWrapMode(h,m),this._wrapModeDirty=!1)};p._deriveInternalFormat=function(h,m){if(this._context.type===w.ContextType.WEBGL1)return h;switch(m){case l.PixelType.FLOAT:switch(h){case l.PixelFormat.RGBA:return l.SizedPixelFormat.RGBA32F;case l.PixelFormat.RGB:return l.SizedPixelFormat.RGB32F;default:throw Error("Unable to derive format");}case l.PixelType.UNSIGNED_BYTE:switch(h){case l.PixelFormat.RGBA:return l.SizedPixelFormat.RGBA8;case l.PixelFormat.RGB:return l.SizedPixelFormat.RGB8}default:return h}};
p._configurePixelStorage=function(){const h=this._context.gl,{unpackAlignment:m,flipped:u,preMultiplyAlpha:t}=this._descriptor;h.pixelStorei(h.UNPACK_ALIGNMENT,m);h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,u?1:0);h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t?1:0)};p._texStorage=function(h,m,u,t,q,z){const v=this._context.gl;if(!n(v))throw Error("Immutable textures are not supported in WebGL1");if(!(m in l.SizedPixelFormat))throw Error("Immutable textures must have a sized internal format");this._descriptor.isImmutable&&
(u=u?r(h,t,q,z):1,k(h)?v.texStorage3D(h,u,m,t,q,z):v.texStorage2D(h,u,m,t,q),this._wasImmutablyAllocated=!0)};p._texImage=function(h,m,u,t,q,z,v){const B=this._context.gl;let A=null;const E=this._context.type===w.ContextType.WEBGL2,C=k(h),{isImmutable:D,pixelFormat:F,dataType:G}=this._descriptor;E&&(A=B);!E&&e(v)?B.texImage2D(h,0,u,F,G,v):D?g.isSome(v)&&(C?A.texSubImage3D(h,m,0,0,0,t,q,z,F,G,v):B.texSubImage2D(h,m,0,0,t,q,F,G,v)):(v=g.unwrap(v),C?A.texImage3D(h,m,u,t,q,z,0,F,G,v):B.texImage2D(h,m,
u,t,q,0,F,G,v))};p._compressedTexImage=function(h,m,u,t,q,z,v){const B=this._context.gl;let A=null;const E=k(h),C=this._descriptor.isImmutable;if(E){if(this._context.type!==w.ContextType.WEBGL2)throw Error("3D textures are not supported in WebGL1");A=B}C?g.isSome(v)&&(E?A.compressedTexSubImage3D(h,m,0,0,0,t,q,z,u,v):B.compressedTexSubImage2D(h,m,0,0,t,q,u,v)):E?A.compressedTexImage3D(h,m,u,t,q,z,0,v):B.compressedTexImage2D(h,m,u,t,q,0,v)};p._forEachMipmapLevel=function(h,m=Infinity){let {width:u,
height:t,depth:q,hasMipmap:z,target:v}=this._descriptor;const B=v===l.TextureType.TEXTURE_3D;for(let A=0;;++A){h(A,u,t,q);if(!z||1===u&&1===t&&(!B||1===q)||A>=m)break;u=Math.max(1,u>>1);t=Math.max(1,t>>1);B&&(q=Math.max(1,q>>1))}};y._validateTexture=function(h,m){(0>m.width||0>m.height||0>m.depth)&&console.error("Negative dimension parameters are not allowed!");h=n(h.gl);const u=d.isPowerOfTwo(m.width)&&d.isPowerOfTwo(m.height);h||!m.isImmutable&&!k(m.target)||console.error("Immutable and 3D-like textures are not supported in WebGL1!");
h||u||("number"===typeof m.wrapMode?m.wrapMode!==l.TextureWrapMode.CLAMP_TO_EDGE&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):(m.wrapMode.s!==l.TextureWrapMode.CLAMP_TO_EDGE||m.wrapMode.t!==l.TextureWrapMode.CLAMP_TO_EDGE)&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),m.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))};y._applySamplingMode=function(h,m){let u=m.samplingMode,t=m.samplingMode;if(u===
l.TextureSamplingMode.LINEAR_MIPMAP_NEAREST||u===l.TextureSamplingMode.LINEAR_MIPMAP_LINEAR)u=l.TextureSamplingMode.LINEAR,m.hasMipmap||(t=l.TextureSamplingMode.LINEAR);else if(u===l.TextureSamplingMode.NEAREST_MIPMAP_NEAREST||u===l.TextureSamplingMode.NEAREST_MIPMAP_LINEAR)u=l.TextureSamplingMode.NEAREST,m.hasMipmap||(t=l.TextureSamplingMode.NEAREST);h.texParameteri(m.target,h.TEXTURE_MAG_FILTER,u);h.texParameteri(m.target,h.TEXTURE_MIN_FILTER,t)};y._applyWrapMode=function(h,m){"number"===typeof m.wrapMode?
(h.texParameteri(m.target,h.TEXTURE_WRAP_S,m.wrapMode),h.texParameteri(m.target,h.TEXTURE_WRAP_T,m.wrapMode)):(h.texParameteri(m.target,h.TEXTURE_WRAP_S,m.wrapMode.s),h.texParameteri(m.target,h.TEXTURE_WRAP_T,m.wrapMode.t))};y._applyAnisotropicFilteringParameters=function(h,m){var u;const t=h.capabilities.textureFilterAnisotropic;t&&h.gl.texParameterf(m.target,t.TEXTURE_MAX_ANISOTROPY,null!=(u=m.maxAnisotropy)?u:1)};b._createClass(y,[{key:"glName",get:function(){return this._glName}},{key:"descriptor",
get:function(){return this._descriptor}},{key:"isDirty",get:function(){return this._samplingModeDirty||this._wrapModeDirty}}]);return y}();c.TEXTURE_UNIT_FOR_UPDATES=0;a.Texture=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/capabilities/isWebGL2Context":function(){define(function(){return function(a){return window.WebGL2RenderingContext&&a instanceof window.WebGL2RenderingContext}})},"esri/views/webgl/VertexArrayObject":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/Logger ../../core/maybe ./enums ./Util".split(" "),
function(a,b,c,d,g,x){const w=c.getLogger("esri.views.webgl.VertexArrayObject");c=function(){function l(f,e,k,r,y=null){this._context=f;this._locations=e;this._layout=k;this._buffers=r;this._indexBuffer=y;this._glName=null;this._initialized=!1;f.instanceCounter.increment(g.ResourceType.VAO,this)}var n=l.prototype;n.dispose=function(f=!0){if(this._context){if(this._glName){var e,k;const r=null==(e=this._context)?void 0:null==(k=e.capabilities)?void 0:k.vao;r?(r.deleteVertexArray(this._glName),this._glName=
null):w.warn("Leaked WebGL VAO")}this._context.getBoundVAO()===this&&this._context.bindVAO(null);if(f){for(const r in this._buffers)this._buffers[r].dispose(),delete this._buffers[r];this._indexBuffer=d.disposeMaybe(this._indexBuffer)}this._context.instanceCounter.decrement(g.ResourceType.VAO,this);this._context=null}else(this._glName||f&&0<Object.getOwnPropertyNames(this._buffers).length)&&w.warn("Leaked WebGL VAO")};n.initialize=function(){if(!this._initialized){var f=this._context.capabilities.vao;
if(f){const e=f.createVertexArray();f.bindVertexArray(e);this._bindLayout();f.bindVertexArray(null);this._glName=e}this._initialized=!0}};n.bind=function(){this.initialize();const f=this._context.capabilities.vao;f?f.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())};n._bindLayout=function(){const {_buffers:f,_layout:e,_indexBuffer:k}=this;f||w.error("Vertex buffer dictionary is empty!");const r=this._context.gl;for(const y in f){const p=f[y];p||w.error("Vertex buffer is uninitialized!");
const h=e[y];h||w.error("Vertex element descriptor is empty!");x.bindVertexBufferLayout(this._context,this._locations,p,h)}d.isSome(k)&&(this._context.capabilities.vao?r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,k.glName):this._context.bindBuffer(k))};n.unbind=function(){this.initialize();const f=this._context.capabilities.vao;f?f.bindVertexArray(null):this._unbindLayout()};n._unbindLayout=function(){const {_buffers:f,_layout:e}=this;f||w.error("Vertex buffer dictionary is empty!");for(const k in f){const r=
f[k];r||w.error("Vertex buffer is uninitialized!");x.unbindVertexBufferLayout(this._context,this._locations,r,e[k])}d.isSome(this._indexBuffer)&&this._context.unbindBuffer(this._indexBuffer.bufferType)};b._createClass(l,[{key:"glName",get:function(){return this._glName}},{key:"vertexBuffers",get:function(){return this._buffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}},{key:"size",get:function(){return Object.keys(this._buffers).reduce((f,e)=>f+this._buffers[e].size,d.isSome(this._indexBuffer)?
this._indexBuffer.size:0)}},{key:"layout",get:function(){return this._layout}},{key:"locations",get:function(){return this._locations}}]);return l}();a.VertexArrayObject=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/Util":function(){define(["exports","../../core/has","../../core/maybe","./enums"],function(a,b,c,d){function g(l){return l[0].stride}function x(l){switch(l){case d.PixelFormat.ALPHA:case d.PixelFormat.LUMINANCE:case d.PixelFormat.RED:case d.PixelFormat.RED_INTEGER:case d.SizedPixelFormat.R8:case d.SizedPixelFormat.R8I:case d.SizedPixelFormat.R8UI:case d.SizedPixelFormat.R8_SNORM:case d.RenderbufferFormat.STENCIL_INDEX8:return 1;
case d.PixelFormat.LUMINANCE_ALPHA:case d.PixelFormat.RG:case d.PixelFormat.RG_INTEGER:case d.SizedPixelFormat.RGBA4:case d.SizedPixelFormat.R16F:case d.SizedPixelFormat.R16I:case d.SizedPixelFormat.R16UI:case d.SizedPixelFormat.RG8:case d.SizedPixelFormat.RG8I:case d.SizedPixelFormat.RG8UI:case d.SizedPixelFormat.RG8_SNORM:case d.SizedPixelFormat.RGB565:case d.SizedPixelFormat.RGB5_A1:case d.RenderbufferFormat.DEPTH_COMPONENT16:return 2;case d.PixelFormat.DEPTH_COMPONENT:case d.PixelFormat.RGB:case d.PixelFormat.RGB_INTEGER:case d.SizedPixelFormat.RGB8:case d.SizedPixelFormat.RGB8I:case d.SizedPixelFormat.RGB8UI:case d.SizedPixelFormat.RGB8_SNORM:case d.SizedPixelFormat.SRGB8:case d.RenderbufferFormat.DEPTH_COMPONENT24:return 3;
case d.PixelFormat.DEPTH_STENCIL:case d.PixelFormat.RGBA:case d.PixelFormat.RGBA_INTEGER:case d.SizedPixelFormat.RGBA8:case d.SizedPixelFormat.R32F:case d.SizedPixelFormat.R11F_G11F_B10F:case d.SizedPixelFormat.RG16F:case d.SizedPixelFormat.R32I:case d.SizedPixelFormat.R32UI:case d.SizedPixelFormat.RG16I:case d.SizedPixelFormat.RG16UI:case d.SizedPixelFormat.RGBA8I:case d.SizedPixelFormat.RGBA8UI:case d.SizedPixelFormat.RGBA8_SNORM:case d.SizedPixelFormat.SRGB8_ALPHA8:case d.SizedPixelFormat.RGB9_E5:case d.SizedPixelFormat.RGB10_A2UI:case d.SizedPixelFormat.RGB10_A2:case d.RenderbufferFormat.DEPTH_STENCIL:case d.RenderbufferFormat.DEPTH_COMPONENT32F:case d.RenderbufferFormat.DEPTH24_STENCIL8:return 4;
case d.RenderbufferFormat.DEPTH32F_STENCIL8:return 5;case d.SizedPixelFormat.RGB16F:case d.SizedPixelFormat.RGB16I:case d.SizedPixelFormat.RGB16UI:return 6;case d.SizedPixelFormat.RG32F:case d.SizedPixelFormat.RG32I:case d.SizedPixelFormat.RG32UI:case d.SizedPixelFormat.RGBA16F:case d.SizedPixelFormat.RGBA16I:case d.SizedPixelFormat.RGBA16UI:return 8;case d.SizedPixelFormat.RGB32F:case d.SizedPixelFormat.RGB32I:case d.SizedPixelFormat.RGB32UI:return 12;case d.SizedPixelFormat.RGBA32F:case d.SizedPixelFormat.RGBA32I:case d.SizedPixelFormat.RGBA32UI:return 16;
case d.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT:case d.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT1_EXT:return.5;case d.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT3_EXT:case d.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case d.CompressedTextureFormat.COMPRESSED_R11_EAC:case d.CompressedTextureFormat.COMPRESSED_SIGNED_R11_EAC:case d.CompressedTextureFormat.COMPRESSED_RGB8_ETC2:case d.CompressedTextureFormat.COMPRESSED_SRGB8_ETC2:case d.CompressedTextureFormat.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case d.CompressedTextureFormat.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return.5;
case d.CompressedTextureFormat.COMPRESSED_RG11_EAC:case d.CompressedTextureFormat.COMPRESSED_SIGNED_RG11_EAC:case d.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC:case d.CompressedTextureFormat.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}function w(l){if(c.isNone(l))return 0;if("descriptor"in l)return l.glName?w(l.descriptor):0;const n=l.internalFormat||"pixelFormat"in l&&l.pixelFormat;if(!n)return 0;const f="hasMipmap"in l&&l.hasMipmap?1.3:1;l=l.width*l.height;return x(n)*l*f}a.bindVertexBufferLayout=
function(l,n,f,e,k=0){const r=l.gl,y=l.capabilities.instancing;l.bindBuffer(f);for(const p of e)if(l=n.get(p.name),void 0===l&&console.error(`There is no location for vertex attribute '${p.name}' defined.`),f=k*p.stride,4>=p.count)r.vertexAttribPointer(l,p.count,p.type,p.normalized,p.stride,p.offset+f),r.enableVertexAttribArray(l),0<p.divisor&&y&&y.vertexAttribDivisor(l,p.divisor);else if(9===p.count)for(e=0;3>e;e++)r.vertexAttribPointer(l+e,3,p.type,p.normalized,p.stride,p.offset+12*e+f),r.enableVertexAttribArray(l+
e),0<p.divisor&&y&&y.vertexAttribDivisor(l+e,p.divisor);else if(16===p.count)for(e=0;4>e;e++)r.vertexAttribPointer(l+e,4,p.type,p.normalized,p.stride,p.offset+16*e+f),r.enableVertexAttribArray(l+e),0<p.divisor&&y&&y.vertexAttribDivisor(l+e,p.divisor);else console.error("Unsupported vertex attribute element count: "+p.count)};a.getBytesPerElementFormat=x;a.getErrorString=function(l){l=l.gl;switch(l.getError()){case l.NO_ERROR:return null;case l.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";
case l.INVALID_VALUE:return"A numeric argument is out of range";case l.INVALID_OPERATION:return"The specified command is not allowed for the current state";case l.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case l.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case l.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"};a.getGpuMemoryUsage=w;a.getStride=g;a.unbindVertexBufferLayout=function(l,n,f,e){const k=
l.gl,r=l.capabilities.instancing;l.bindBuffer(f);for(const y of e)if(f=n.get(y.name),4>=y.count)k.disableVertexAttribArray(f),y.divisor&&0<y.divisor&&r&&r.vertexAttribDivisor(f,0);else if(9===y.count)for(e=0;3>e;e++)k.disableVertexAttribArray(f+e),y.divisor&&0<y.divisor&&r&&r.vertexAttribDivisor(f+e,0);else if(16===y.count)for(e=0;4>e;e++)k.disableVertexAttribArray(f+e),y.divisor&&0<y.divisor&&r&&r.vertexAttribDivisor(f+e,0);else console.error("Unsupported vertex attribute element count: "+y.count);
l.unbindBuffer(d.BufferType.ARRAY_BUFFER)};a.vertexCount=function(l,n){return l.vertexBuffers[n].size/g(l.layout[n])};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/CloudsComposition":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/support/axisAngle ./CloudsCompositionTechnique ./weather ../webgl-engine/lib/glUtil3D ../../webgl/enums".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q){function z(J,I,O){J.bindTexture(O.clouds.cubeMap.colorTexture,"cubeMap");J.setUniform1f("cloudsHeight",O.parallax.cloudsHeight);J.setUniformMatrix4fv("rotationMatrixClouds",O.parallax.transform);J.setUniformMatrix4fv("rotationMatrixCloudsCrossFade",O.parallaxNew.transform);J.setUniform3fv("anchorPosition",O.parallax.anchorPointClouds);J.setUniform3fv("anchorPositionCrossFade",O.parallaxNew.anchorPointClouds);O.fadeInOut.stage!==B.FINISHED?J.setUniform1f("totalFadeInOut",
O.fadeInOutHeight.factor+Math.max(g.clamp(O.fadeInOut.factor,0,1))):J.setUniform1f("totalFadeInOut",O.fadeInOutHeight.factor+Math.max(g.clamp(O.fadeIn.factor,0,1)));J.setUniform1f("radiusCurvatureCorrectionFactor",O.parallax.radiusCurvatureCorrectionFactor);J.setUniform1i("crossFade",O.crossFade.stage);J.setUniform1f("crossFadeAnchorFactor",g.clamp(O.crossFade.factor,0,1));J.setUniform1f("radius",O.parallax.radius);J.setUniform3fv("cameraPosition",I.eye)}a.CloudsComposition=function(J){function I(P){var K=
J.call(this,P)||this;K._inverseProjectionMatrix=r.create();K._inverseViewMatrix=r.create();K._technique=new m.CloudsCompositionTechnique(P);K._vao=t.createQuadVAO(P.rctx);K._setDefaultParallax(P.radius);return K}b._inheritsLoose(I,J);var O=I.prototype;O.destroy=function(){this._technique=x.releaseMaybe(this._technique);this._vao=x.disposeMaybe(this._vao)};O.render=function(P,K,M){this._parameters.clouds=K;K=P.camera;if(!x.isNone(this._vao)&&!x.isNone(K)){var U=P.rctx,R=U.useTechnique(this._technique);
P.scenelightingData.setLightDirectionUniform(R);P.scenelightingData.setUniforms(R,!1,!1);k.invert(this._inverseProjectionMatrix,K.projectionMatrix);k.invert(this._inverseViewMatrix,K.viewMatrix);R.setUniformMatrix4fv("inverseProjectionMatrix",this._inverseProjectionMatrix);R.setUniformMatrix4fv("inverseViewMatrix",this._inverseViewMatrix);R.setUniform2f("cloudVariables",this._parameters.clouds.coverage,this._parameters.clouds.absorption);this._setParallaxParams(K.eye,M);P.cloudsCompositionParams=
this._parameters;z(R,K,this._parameters);U.bindVAO(this._vao);R.assertCompatibleVertexAttributeLocations(this._vao);U.drawArrays(q.PrimitiveType.TRIANGLE_STRIP,0,4)}};O._setDefaultParallax=function(P){this._parameters={parallax:{anchorPointClouds:p.create(),radius:P,cloudsHeight:1E5,radiusCurvatureCorrectionFactor:0,transform:r.create()},parallaxNew:{anchorPointClouds:p.create(),radius:P,cloudsHeight:1E5,radiusCurvatureCorrectionFactor:0,transform:r.create()},crossFade:{stage:A.FINISHED,factor:0,
distanceThresholdFactor:.3},fadeInOut:{stage:B.FINISHED,factor:0,distanceThresholdFactor:.6},fadeIn:{stage:v.FINISHED,factor:0,distanceThresholdFactor:2},fadeInOutHeight:{stage:E.FINISHED,factor:-1},cameraPositionLastFrame:p.create(),startTime:0,startTimeHeightFade:0,clouds:null}};O._isCameraPositionFinal=function(P){return y.equals(this._parameters.cameraPositionLastFrame,P)};O._setFadeInStage=function(P){P=this._isCameraPositionFinal(P);this._parameters.fadeIn.stage===v.FINISHED&&(this._parameters.fadeIn.factor=
1,y.copy(this._parameters.parallax.anchorPointClouds,F),this._parameters.fadeIn.stage=v.CHANGE_ANCHOR,this._parameters.crossFade.stage=A.FINISHED,this._parameters.fadeInOut.stage=B.FINISHED);this._parameters.fadeIn.stage===v.CHANGE_ANCHOR&&P&&(y.copy(this._parameters.parallax.anchorPointClouds,F),this._parameters.fadeIn.stage=v.FADE_IN,this._parameters.startTime=performance.now());0<this._parameters.fadeIn.factor&&this._parameters.fadeIn.stage===v.FADE_IN&&(this._parameters.fadeIn.factor=1-(performance.now()-
this._parameters.startTime)/500);0>=this._parameters.fadeIn.factor&&this._parameters.fadeIn.stage===v.FADE_IN&&(this._parameters.fadeIn.stage=v.FINISHED,this._parameters.fadeIn.factor=0)};O._setCrossFadingStage=function(){this._parameters.crossFade.stage===A.FINISHED&&(y.copy(this._parameters.parallaxNew.anchorPointClouds,F),this._parameters.startTime=performance.now(),this._parameters.crossFade.factor=0,this._parameters.crossFade.stage=A.CROSS_FADE);1>this._parameters.crossFade.factor&&this._parameters.crossFade.stage===
A.CROSS_FADE&&(this._parameters.crossFade.factor=(performance.now()-this._parameters.startTime)/500);1<=this._parameters.crossFade.factor&&this._parameters.crossFade.stage===A.CROSS_FADE&&(this._parameters.crossFade.stage=A.FINISHED,this._parameters.crossFade.factor=1,y.copy(this._parameters.parallax.anchorPointClouds,this._parameters.parallaxNew.anchorPointClouds))};O._setFadeInOutStage=function(P){this._parameters.fadeInOut.stage===B.FINISHED&&(this._parameters.startTime=performance.now(),this._parameters.fadeInOut.factor=
0,this._parameters.fadeInOut.stage=B.FADE_OUT);1>this._parameters.fadeInOut.factor&&this._parameters.fadeInOut.stage===B.FADE_OUT&&(this._parameters.fadeInOut.factor=(performance.now()-this._parameters.startTime)/250);1<=this._parameters.fadeInOut.factor&&this._parameters.fadeInOut.stage===B.FADE_OUT&&(this._parameters.fadeInOut.factor=1,y.copy(this._parameters.parallax.anchorPointClouds,F));1<=this._parameters.fadeInOut.factor&&this._parameters.fadeInOut.stage===B.FADE_OUT&&this._isCameraPositionFinal(P)&&
(this._parameters.startTime=performance.now(),this._parameters.fadeInOut.factor=1,this._parameters.fadeInOut.stage=B.FADE_IN,this._parameters.crossFade.stage=A.FINISHED,this._parameters.crossFade.factor=0);0<this._parameters.fadeInOut.factor&&this._parameters.fadeInOut.stage===B.FADE_IN&&(this._parameters.fadeInOut.factor=1-(performance.now()-this._parameters.startTime)/500);0>=this._parameters.fadeInOut.factor&&this._parameters.fadeInOut.stage===B.FADE_IN&&(this._parameters.fadeInOut.stage=B.FINISHED,
this._parameters.fadeInOut.factor=0)};O._setFadeInOutHeight=function(P){const K=performance.now();this._parameters.startTimeHeightFade=this._parameters.fadeInOutHeight.stage===E.FINISHED?K:this._parameters.startTimeHeightFade;this._parameters.fadeInOutHeight.factor=P?this._parameters.fadeInOutHeight.factor+(K-this._parameters.startTimeHeightFade)/500:this._parameters.fadeInOutHeight.factor-(K-this._parameters.startTimeHeightFade)/500;this._parameters.startTimeHeightFade=K;this._parameters.fadeInOutHeight.factor=
g.clamp(this._parameters.fadeInOutHeight.factor,0,1);this._parameters.fadeInOutHeight.stage=E.HEIGHT_FADE};O._setParallaxParams=function(P,K){0>this._parameters.fadeInOutHeight.factor&&(this._parameters.fadeInOutHeight.factor=y.length(P)-this._parameters.parallax.radius>u.weatherHeightLimit?1:0);y.normalize(F,P);y.scale(F,F,this._parameters.parallax.radius);0===this._parameters.parallax.anchorPointClouds[0]&&0===this._parameters.parallax.anchorPointClouds[1]&&0===this._parameters.parallax.anchorPointClouds[2]&&
y.copy(this._parameters.parallax.anchorPointClouds,F);var M=y.length(y.subtract(G,this._parameters.parallax.anchorPointClouds,F));let U=!0;M>this._parameters.fadeIn.distanceThresholdFactor*this._parameters.parallax.cloudsHeight||this._parameters.fadeIn.stage!==v.FINISHED?this._setFadeInStage(P):M>this._parameters.fadeInOut.distanceThresholdFactor*this._parameters.parallax.cloudsHeight||this._parameters.fadeInOut.stage!==B.FINISHED?this._setFadeInOutStage(P):M>this._parameters.crossFade.distanceThresholdFactor*
this._parameters.parallax.cloudsHeight&&!K||this._parameters.crossFade.stage!==A.FINISHED?this._setCrossFadingStage():U=!1;K=y.length(P);M=K-this._parameters.parallax.radius;(M>1.7*u.weatherHeightLimit||M<-u.weatherHeightLimit)&&1>this._parameters.fadeInOutHeight.factor?this._parameters.fadeInOutHeight.factor=1:(M>u.weatherHeightLimit||M<-.35*u.weatherHeightLimit)&&1>this._parameters.fadeInOutHeight.factor?this._setFadeInOutHeight(!0):M<u.weatherHeightLimit&&M>-.35*u.weatherHeightLimit&&0<this._parameters.fadeInOutHeight.factor?
this._setFadeInOutHeight(!1):this._parameters.fadeInOutHeight.stage=E.FINISHED;this._parameters.parallax.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(K*K-this._parameters.parallax.radius*this._parameters.parallax.radius,0))/K;h.fromPoints(C,this._parameters.parallax.anchorPointClouds,D);this._parameters.parallax.transform=r.create();k.rotate(this._parameters.parallax.transform,this._parameters.parallax.transform,D[3],h.axis(D));U&&(h.fromPoints(C,this._parameters.parallaxNew.anchorPointClouds,
D),this._parameters.parallaxNew.transform=r.create(),k.rotate(this._parameters.parallaxNew.transform,this._parameters.parallaxNew.transform,D[3],h.axis(D)));y.copy(this._parameters.cameraPositionLastFrame,P)};b._createClass(I,[{key:"isFading",get:function(){return this._parameters.crossFade.stage!==A.FINISHED||this._parameters.fadeInOut.stage!==B.FINISHED||this._parameters.fadeIn.stage!==v.FINISHED||this._parameters.fadeInOutHeight.stage!==E.FINISHED}}]);return I}(d);c.__decorate([w.property({constructOnly:!0})],
a.CloudsComposition.prototype,"rctx",void 0);c.__decorate([w.property({constructOnly:!0})],a.CloudsComposition.prototype,"viewingMode",void 0);c.__decorate([w.property({constructOnly:!0})],a.CloudsComposition.prototype,"radius",void 0);a.CloudsComposition=c.__decorate([e.subclass("esri.views.3d.environment.CloudsComposition")],a.CloudsComposition);var v;(function(J){J[J.FINISHED=0]="FINISHED";J[J.CHANGE_ANCHOR=1]="CHANGE_ANCHOR";J[J.FADE_IN=2]="FADE_IN"})(v||(v={}));var B;(function(J){J[J.FINISHED=
0]="FINISHED";J[J.FADE_OUT=1]="FADE_OUT";J[J.FADE_IN=2]="FADE_IN"})(B||(B={}));var A;(function(J){J[J.FINISHED=0]="FINISHED";J[J.CROSS_FADE=1]="CROSS_FADE"})(A||(A={}));var E;(function(J){J[J.FINISHED=0]="FINISHED";J[J.HEIGHT_FADE=1]="HEIGHT_FADE"})(E||(E={}));const C=p.fromValues(0,0,1),D=h.create(),F=p.create(),G=p.create();a.bindCloudsComposition=z;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/axisAngle":function(){define("exports ../../chunks/quat ../../chunks/quatf64 ../../chunks/vec3 ./vector ./vectorStacks".split(" "),
function(a,b,c,d,g,x){function w(r=f){return[r[0],r[1],r[2],r[3]]}function l(r,y,p,h,m=w()){m[0]=r;m[1]=y;m[2]=p;m[3]=h;return m}function n(r,y){r[3]=y;return r}const f=[0,0,1,0],e=c.create(),k=c.create();a.UP=f;a.angle=function(r){return r[3]};a.axis=function(r){return r};a.compose=function(r,y,p=w()){b.setAxisAngle(e,r,r[3]);b.setAxisAngle(k,y,y[3]);b.multiply(e,k,e);return n(p,b.getAxisAngle(p,e))};a.copy=function(r,y=w()){return l(r[0],r[1],r[2],r[3],y)};a.create=w;a.fromAxisAndAngle=function(r,
y,p=w()){d.copy(p,r);p[3]=y;return p};a.fromPoints=function(r,y,p=w()){d.cross(p,r,y);d.normalize(p,p);p[3]=g.angle(r,y);return p};a.fromValues=l;a.setAngle=n;a.wrap=function(r,y,p,h){return l(r,y,p,h,x.sv4d.get())};a.wrapAxisAngle=function(r,y){return l(r[0],r[1],r[2],y,x.sv4d.get())};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/CloudsCompositionTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/CloudsComposition.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,d,g,x,w,l,n,f){x=function(e){function k(y){var p;return p=e.call(this,y,null,()=>p.destroy())||this}c._inheritsLoose(k,e);var r=k.prototype;r.initializeProgram=function(y){const p=k.shader.get().build();return new l.Program(y.rctx,p,w.Default3D)};r.initializePipeline=function(){return f.makePipelineState({blending:f.simpleBlendingParams(n.BlendFactor.ONE,n.BlendFactor.SRC_ALPHA),depthTest:{func:n.CompareFunction.LEQUAL},colorWrite:f.defaultColorWriteParams})};return k}(x.ShaderTechnique);
x.shader=new g.ReloadableShaderModule(d.CloudsCompositionShader,()=>new Promise((e,k)=>a(["./CloudsComposition.glsl"],e,k)));b.CloudsCompositionTechnique=x;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/CloudsComposition.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateMainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CloudsParallaxShading.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k){function r(){const p=new e.ShaderBuilder;p.attributes.add(k.VertexAttribute.POSITION,"vec2");p.varyings.add("worldRay","vec3");p.vertex.uniforms.add("inverseProjectionMatrix","mat4");p.vertex.uniforms.add("inverseViewMatrix","mat4");p.vertex.code.add(f.glsl`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`);p.fragment.uniforms.add("lightingMainDirection","vec3");p.fragment.include(l.ColorConversion);p.fragment.include(n.RgbaFloatEncoding);p.include(c.EvaluateMainLighting);p.include(b.EvaluateAmbientLighting,{pbrMode:g.PBRMode.Disabled,lightingSphericalHarmonicsOrder:2});p.include(x.PiUtils);p.include(d.Gamma);p.include(w.CloudsParallaxShading);p.fragment.code.add(f.glsl`void main() {
vec4 cloudsColor = crossFade == 0 ? renderCloud(normalize(worldRay), cameraPosition) : renderCloudCrossFade(normalize(worldRay), cameraPosition);
gl_FragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`);return p}const y=Object.freeze({__proto__:null,build:r});a.CloudsCompositionShader=y;a.build=r})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl":function(){define(["exports","./PhysicallyBasedRenderingParameters.glsl","../../shaderModules/interfaces"],function(a,b,c){a.EvaluateAmbientLighting=function(d,g){d=d.fragment;const x=void 0!==g.lightingSphericalHarmonicsOrder?g.lightingSphericalHarmonicsOrder:2;0===x?(d.uniforms.add("lightingAmbientSH0","vec3"),
d.code.add(c.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):1===x?(d.uniforms.add("lightingAmbientSH_R","vec4"),d.uniforms.add("lightingAmbientSH_G","vec4"),d.uniforms.add("lightingAmbientSH_B","vec4"),d.code.add(c.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):2===x&&(d.uniforms.add("lightingAmbientSH0","vec3"),d.uniforms.add("lightingAmbientSH_R1","vec4"),d.uniforms.add("lightingAmbientSH_G1","vec4"),d.uniforms.add("lightingAmbientSH_B1","vec4"),d.uniforms.add("lightingAmbientSH_R2","vec4"),d.uniforms.add("lightingAmbientSH_G2","vec4"),d.uniforms.add("lightingAmbientSH_B2","vec4"),d.code.add(c.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),g.pbrMode!==b.PBRMode.Normal&&g.pbrMode!==b.PBRMode.Schematic||d.code.add(c.glsl`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl":function(){define(["exports","../../../../../../chunks/vec3f32","../attributes/VertexTextureCoordinates.glsl","../../shaderModules/interfaces"],function(a,b,c,d){b=b.fromValues(0,.6,.2);a.PBRMode=void 0;(function(g){g[g.Disabled=0]="Disabled";g[g.Normal=1]="Normal";g[g.Schematic=2]="Schematic";g[g.Water=3]="Water";g[g.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh";
g[g.COUNT=5]="COUNT"})(a.PBRMode||(a.PBRMode={}));a.PBRSchematicMRRValues=b;a.PhysicallyBasedRenderingParameters=function(g,x){const w=g.fragment,l=x.hasMetalnessAndRoughnessTexture||x.hasEmissionTexture||x.hasOcclusionTexture;x.pbrMode===a.PBRMode.Normal&&l&&g.include(c.VertexTextureCoordinates,x);x.pbrMode===a.PBRMode.Schematic?w.code.add(d.glsl`const vec3 mrr = vec3(0.0, 0.6, 0.2);
const vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`):(x.pbrMode===a.PBRMode.Disabled&&w.code.add(d.glsl`float getBakedOcclusion() { return 1.0; }`),x.pbrMode===a.PBRMode.Normal&&(w.uniforms.add("emissionFactor","vec3"),w.uniforms.add("mrrFactors","vec3"),w.code.add(d.glsl`vec3 mrr;
vec3 emission;
float occlusion;`),x.hasMetalnessAndRoughnessTexture&&(w.uniforms.add("texMetallicRoughness","sampler2D"),x.supportsTextureAtlas&&w.uniforms.add("texMetallicRoughnessSize","vec2"),w.code.add(d.glsl`void applyMetallnessAndRoughness(TextureLookupParameter params) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, params).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),x.hasEmissionTexture&&(w.uniforms.add("texEmission","sampler2D"),x.supportsTextureAtlas&&w.uniforms.add("texEmissionSize","vec2"),w.code.add(d.glsl`void applyEmission(TextureLookupParameter params) {
emission *= textureLookup(texEmission, params).rgb;
}`)),x.hasOcclusionTexture?(w.uniforms.add("texOcclusion","sampler2D"),x.supportsTextureAtlas&&w.uniforms.add("texOcclusionSize","vec2"),w.code.add(d.glsl`void applyOcclusion(TextureLookupParameter params) {
occlusion *= textureLookup(texOcclusion, params).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):w.code.add(d.glsl`float getBakedOcclusion() { return 1.0; }`),w.code.add(d.glsl`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;
      ${l?"vtc.uv \x3d vuv0;":""}
      ${x.hasMetalnessAndRoughnessTexture?x.supportsTextureAtlas?"vtc.size \x3d texMetallicRoughnessSize; applyMetallnessAndRoughness(vtc);":"applyMetallnessAndRoughness(vtc);":""}
      ${x.hasEmissionTexture?x.supportsTextureAtlas?"vtc.size \x3d texEmissionSize; applyEmission(vtc);":"applyEmission(vtc);":""}
      ${x.hasOcclusionTexture?x.supportsTextureAtlas?"vtc.size \x3d texOcclusionSize; applyOcclusion(vtc);":"applyOcclusion(vtc);":""}
    }
  `)))};a.bindPBRUniforms=function(g,x,w=!1){w||(g.setUniform3fv("mrrFactors",x.mrrFactors),g.setUniform3fv("emissionFactor",x.emissiveFactor))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTextureCoordinates.glsl":function(){define(["exports","./TextureCoordinateAttribute.glsl","../util/TextureAtlasLookup.glsl","../../shaderModules/interfaces"],function(a,b,c,d){a.VertexTextureCoordinates=function(g,x){g.include(b.TextureCoordinateAttribute,
x);g.fragment.code.add(d.glsl`
  struct TextureLookupParameter {
    vec2 uv;
    ${x.supportsTextureAtlas?"vec2 size;":""}
  } vtc;
  `);x.attributeTextureCoordinates===b.TextureCoordinateAttributeType.Default&&g.fragment.code.add(d.glsl`vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {
return texture2D(tex, params.uv);
}`);x.attributeTextureCoordinates===b.TextureCoordinateAttributeType.Atlas&&(g.include(c.TextureAtlasLookup),g.fragment.code.add(d.glsl`vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {
return textureAtlasLookup(tex, params.size, params.uv, vuvRegion);
}`))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/TextureAtlasLookup.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.TextureAtlasLookup=function(c){c.extensions.add("GL_EXT_shader_texture_lod");c.extensions.add("GL_OES_standard_derivatives");c.fragment.code.add(b.glsl`#ifndef GL_EXT_shader_texture_lod
float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {
float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));
return max(0.0, 0.5 * log2(deltaMaxSqr));
}
#endif
vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
#ifdef GL_EXT_shader_texture_lod
return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);
#else
vec2 dUVdxAuto = dFdx(uvAtlas);
vec2 dUVdyAuto = dFdy(uvAtlas);
float mipMapLevel = calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);
float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);
return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);
#endif
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateMainLighting.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.EvaluateMainLighting=function(c){c=c.fragment;c.uniforms.add("lightingMainDirection","vec3");c.uniforms.add("lightingMainIntensity","vec3");c.uniforms.add("lightingFixedFactor","float");c.uniforms.add("lightingSpecularStrength","float");c.uniforms.add("lightingEnvironmentStrength","float");
c.code.add(b.glsl`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, lightingMainDirection), 0.0, 1.0);
dotVal = mix(dotVal, 1.0, lightingFixedFactor);
return lightingMainIntensity * ((1.0 - shadowing) * dotVal);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.PiUtils=function(c){c.vertex.code.add(b.glsl`const float PI = 3.141592653589793;`);c.fragment.code.add(b.glsl`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/CloudsParallaxShading.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.CloudsParallaxShading=function(c){c.fragment.uniforms.add("anchorPosition","vec3").add("anchorPositionCrossFade","vec3").add("fadeInOutFactor","float").add("cloudsHeight","float").add("rotationMatrixClouds","mat4").add("rotationMatrixCloudsCrossFade",
"mat4").add("radiusCurvatureCorrectionFactor","float").add("radius","float").add("cameraPosition","vec3").add("totalFadeInOut","float").add("crossFade","int").add("crossFadeAnchorFactor","float").add("cloudVariables","vec2").add("cubeMap","samplerCube");c.fragment.code.add(b.glsl`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos, float radiusReduction)
{
vec3 dirAnchor = normalize(spherePos);
vec3 sphereOriginOffset = dirAnchor * radiusReduction;
float radiusClouds = radius + cloudsHeight - radiusReduction;
float B = 2.0 * dot(cameraPosition - sphereOriginOffset, dir);
float C = dot(cameraPosition - sphereOriginOffset, cameraPosition - sphereOriginOffset) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`);c.fragment.code.add(b.glsl`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`);c.fragment.code.add(b.glsl`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`);c.fragment.code.add(b.glsl`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(lightingMainDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(lightingMainDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((lightingMainIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * pow(dirDotLight, RIM_SCATTERING_FACTOR) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`);c.fragment.code.add(b.glsl`vec4 getCloudData(vec3 rayDir)
{
vec4 cloudData = textureCube(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
return mix(vec4(vec3(clamp(1.0 - cloudVariables.y, 0.6, 1.0)), 0.0), cloudData, smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(mu)));
}`);c.fragment.code.add(b.glsl`vec4 renderCloud(vec3 worldRay, vec3 position)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), position, anchorPosition, 0.0);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(normalize(-worldRay), cloudData), totalTransmittance);
}`);c.fragment.code.add(b.glsl`vec4 renderCloudCrossFade(vec3 worldRay, vec3 position)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), position, anchorPosition, 0.0);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected);
vec4 cloudColor = vec4(calculateCloudColor(normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), position, anchorPositionCrossFade, 0.0);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.ColorConversion=function(c){c.code.add(b.glsl`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/CloudsData":function(){define(["exports","../../../core/maybe"],function(a,b){a.isReadyCloudsData=function(c){return b.isSome(c)&&b.isSome(c.cubeMap)&&!c.running&&0<c.coverage};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/CloudsGenerator":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/has ../../../core/mathUtils ../../../core/maybe ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat3 ../../../chunks/mat3f64 ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3f32 ../../../geometry/projectionEllipsoid ./CloudsPresets ./CloudsTechnique ./NoiseTextureAtlas ../webgl-engine/lib/glUtil3D ../../support/Scheduler ../../webgl/enums ../../webgl/FramebufferObject".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E,C){a.CloudsGenerator=function(I){function O(K){K=I.call(this,K)||this;K._frameTask=null;K._handles=new g;K._cubeMapSize=x("esri-mobile")?1024:2048;K._techniques=[];K._techniqueConfiguration=new z.CloudsTechniqueConfiguration;K.coverage=w.lerp(J.coverage[0],J.coverage[1],.5);K.density=w.lerp(J.density[0],J.density[1],.5);K.absorption=w.lerp(J.absorption[0],J.absorption[1],.5);K.cloudSize=w.lerp(J.cloudSize[0],J.cloudSize[1],.5);K.detailSize=
w.lerp(J.detailSize[0],J.detailSize[1],.5);K.smoothness=w.lerp(J.smoothness[0],J.smoothness[1],.5);K.cloudHeight=w.lerp(J.cloudHeight[0],J.cloudHeight[1],.5);K.raymarchingStepType=J.raymarchingStepType;K._cloudRadius=0;K._viewMatrix=m.create();K._viewMatrix3=p.create();K.running=!1;return K}b._inheritsLoose(O,I);var P=O.prototype;P._getTechnique=function(K){const M=this._techniques[K];if(M)return M;this._techniqueConfiguration.steps=K;this._techniques[K]=new z.CloudsTechnique({rctx:this.rctx,viewingMode:this.view.state.viewingMode},
this._techniqueConfiguration);return this._techniques[K]};P.initialize=function(){this._vao=B.createQuadVAO(this.rctx);this._cloudRadius=.5*t.getReferenceEllipsoid(this.view.spatialReference).radius;this.setDirty();this._frameTask=this.view.resourceController.scheduler.registerTask(A.TaskPriority.CLOUDS_GENERATOR,this);this._handles.add(this._frameTask);this._handles.add(n.init(this,"coverage",()=>this.setDirty()));"coverage density absorption cloudSize detailSize smoothness cloudHeight raymarchingStepType".split(" ").forEach(K=>
this._handles.add(n.init(this,K,()=>this.setDirty())))};P.destroy=function(){this._handles.destroy();this._techniques.forEach(K=>l.releaseMaybe(K));this._techniques=null;this._frameBufferCube=l.disposeMaybe(this._frameBufferCube);this._vao=l.disposeMaybe(this._vao);this._noiseTexture=l.destroyMaybe(this._noiseTexture)};P._ensureNoiseTexture=function(){l.isNone(this._noiseTexture)&&(this._noiseTexture=new v.NoiseTextureAtlas(this.rctx,this.view),this._noiseTexture.render(this.rctx));return this._noiseTexture.textureAtlas};
P.applyPreset=function(K,M){const U=K.median,R=L=>{const N=w.lerp(L[0],L[1],U);return.5>M?w.lerp(L[0],N,2*M):w.lerp(N,L[1],2*(M-.5))};this.coverage=R(K.coverage);this.density=R(K.density);this.absorption=R(K.absorption);this.cloudSize=R(K.cloudSize);this.detailSize=R(K.detailSize);this.smoothness=R(K.smoothness);this.cloudHeight=R(K.cloudHeight);this.raymarchingStepType=K.raymarchingStepType};P.setDirty=function(){this.running=!0};P.runTask=function(K){if(0===this.coverage||l.isNone(this._vao))this.running=
!1;else{var M=this._ensureNoiseTexture();if(l.isNone(M))this.running=!1;else{var U=this._getTechnique(this.raymarchingStepType);if(this.rctx.isTechniqueCompiled(U)){var R=this.rctx.getViewport();this.rctx.setViewport(0,0,this._cubeMapSize,this._cubeMapSize);this.rctx.bindFramebuffer(this.frameBufferCube);U=this.rctx.useTechnique(U);var L=1+this.absorption,N=w.lerp(35,120,this.absorption);U.bindTexture(M,"cloudShapeTexture");U.setUniform1f("cloudRadius",this._cloudRadius);U.setUniform1f("halfCubeMapSize",
.5*this._cubeMapSize);U.setUniform1f("power",N);U.setUniform1f("sigmaE",L);U.setUniform1f("density",w.lerp(0,.3,this.density));U.setUniform1f("cloudSize",w.lerp(0,.02,Math.max(.01,1-this.cloudSize)));U.setUniform1f("detailSize",w.lerp(0,.2,Math.max(.01,1-this.detailSize)));U.setUniform1f("smoothness",w.lerp(0,.5,1-this.smoothness));U.setUniform1f("cloudHeight",w.lerp(0,1500,this.cloudHeight));U.setUniform1f("coverage",this.coverage);this.rctx.bindVAO(this._vao);U.assertCompatibleVertexAttributeLocations(this._vao);
for(M=0;5>M;M++)h.targetTo(this._viewMatrix,G,D[M],F[M]),y.fromMat4(this._viewMatrix3,this._viewMatrix),U.setUniformMatrix3fv("view",this._viewMatrix3),this.frameBufferCube.setColorTextureTarget(E.TextureType.TEXTURE_CUBE_MAP_POSITIVE_X+M),this.rctx.gl.drawArrays(this.rctx.gl.TRIANGLE_STRIP,0,4),this.rctx.gl.flush();this.running=!1;this.rctx.setViewport(R.x,R.y,R.width,R.height);this.requestRender();K.madeProgress()}}}};b._createClass(O,[{key:"frameBufferCube",get:function(){l.isNone(this._frameBufferCube)&&
(this._frameBufferCube=new C.FramebufferObject(this.rctx,{colorTarget:E.TargetType.CUBEMAP,width:this._cubeMapSize,height:this._cubeMapSize},{target:E.TextureType.TEXTURE_CUBE_MAP,pixelFormat:E.PixelFormat.RGBA,dataType:E.PixelType.UNSIGNED_BYTE,wrapMode:E.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:E.TextureSamplingMode.LINEAR,hasMipmap:!1,width:this._cubeMapSize,height:this._cubeMapSize}));return this._frameBufferCube}},{key:"cubeMap",get:function(){return this._frameBufferCube}}]);return O}(d);
c.__decorate([f.property({constructOnly:!0})],a.CloudsGenerator.prototype,"rctx",void 0);c.__decorate([f.property({constructOnly:!0})],a.CloudsGenerator.prototype,"view",void 0);c.__decorate([f.property({constructOnly:!0})],a.CloudsGenerator.prototype,"requestRender",void 0);c.__decorate([f.property()],a.CloudsGenerator.prototype,"_frameTask",void 0);c.__decorate([f.property()],a.CloudsGenerator.prototype,"coverage",void 0);c.__decorate([f.property()],a.CloudsGenerator.prototype,"density",void 0);
c.__decorate([f.property()],a.CloudsGenerator.prototype,"absorption",void 0);c.__decorate([f.property()],a.CloudsGenerator.prototype,"cloudSize",void 0);c.__decorate([f.property()],a.CloudsGenerator.prototype,"detailSize",void 0);c.__decorate([f.property()],a.CloudsGenerator.prototype,"smoothness",void 0);c.__decorate([f.property()],a.CloudsGenerator.prototype,"cloudHeight",void 0);c.__decorate([f.property()],a.CloudsGenerator.prototype,"raymarchingStepType",void 0);c.__decorate([f.property()],a.CloudsGenerator.prototype,
"running",void 0);a.CloudsGenerator=c.__decorate([r.subclass("esri.views.3d.environment.CloudsGenerator")],a.CloudsGenerator);const D=[u.fromValues(1,0,0),u.fromValues(-1,0,0),u.fromValues(0,1,0),u.fromValues(0,-1,0),u.fromValues(0,0,1)],F=[u.fromValues(0,1,0),u.fromValues(0,1,0),u.fromValues(0,0,-1),u.fromValues(0,0,1),u.fromValues(0,1,0)],G=u.zeros(),J=q.cloudPresets.sunny;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/CloudsPresets":function(){define(["exports",
"../../../chunks/Clouds.glsl"],function(a,b){let c=function(d,g,x,w,l,n,f,e,k=.5){this.coverage=d;this.density=g;this.absorption=x;this.cloudSize=w;this.detailSize=l;this.smoothness=n;this.cloudHeight=f;this.raymarchingStepType=e;this.median=k};b={sunny:new c([.1,.7],[.02,.02],[0,0],[.86,.86],[.8,.8],[.5,.5],[.05,.05],b.RayMarchingSteps.SIXTEEN),cloudy:new c([.24,.7],[.135,.2],[0,0],[.5,.5],[.65,.7],[.3,.3],[1,1],b.RayMarchingSteps.TWOHUNDRED),rainy:new c([.5,.9],[.2,.5],[.3,.6],[.4,.4],[.7,.7],[.5,
.5],[1,1],b.RayMarchingSteps.TWOHUNDRED),snowy:new c([.5,.9],[.2,.5],[0,0],[.4,.4],[.7,.7],[.5,.5],[1,1],b.RayMarchingSteps.TWOHUNDRED),foggy:new c([.8,.8],[.5,.5],[0,0],[.85,.85],[.75,.75],[.8,.8],[.3,.3],b.RayMarchingSteps.HUNDRED)};a.CloudPresets=c;a.cloudPresets=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/Clouds.glsl":function(){define(["exports","../views/3d/environment/NoiseTextureAtlas","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass","../views/3d/webgl-engine/core/shaderModules/interfaces",
"../views/3d/webgl-engine/core/shaderModules/ShaderBuilder"],function(a,b,c,d,g){function x(l){const n=new g.ShaderBuilder;n.include(c.ScreenSpacePass,!1);n.fragment.uniforms.add("cloudRadius","float").add("halfCubeMapSize","float").add("power","float").add("sigmaE","float").add("density","float").add("cloudSize","float").add("detailSize","float").add("smoothness","float").add("cloudHeight","float").add("coverage","float").add("view","mat3").add("cloudShapeTexture","sampler2D");n.fragment.code.add(d.glsl`
    const int STEPS = ${l.steps===a.RayMarchingSteps.SIXTEEN?d.glsl`16`:l.steps===a.RayMarchingSteps.HUNDRED?d.glsl`100`:d.glsl`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);

    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`);n.fragment.code.add(d.glsl`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${d.glsl.float(b.ATLAS_SIZE)};
      const float dataWidth = ${d.glsl.float(b.ATLAS_SIZE)};
      const float tileRows = ${d.glsl.float(b.TILE_ROWS)};
      const vec3 atlasDimensions = vec3(${d.glsl.float(b.TILE_SIZE)}, ${d.glsl.float(b.TILE_SIZE)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${d.glsl.float(b.TEXTURE_SCALE)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture2D(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }`);n.fragment.code.add(d.glsl`float clouds(vec3 p) {
float cloudVariations = getCloudShape(0.002 * p, 0.5);
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
cloud += (cloudVariations * 0.6 - 0.3) * ( -4.0 * (coverage * coverage - coverage));
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * saturate(remap(heightFraction, 0.75, 1.0, 1.0, 0.0));
float shape = getCloudShape(cloudSize * p, 0.0);
shape *= mix(0.0, 1.0, min(2.0 * (1.0 - coverage), 1.0));
cloud = saturate(remap(cloud, shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`);n.fragment.code.add(d.glsl`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`);n.fragment.code.add("\n    vec3 multipleOctaves(float extinction, float mu, float stepL) {\n      float attenuation \x3d 1.0;\n      float contribution \x3d 1.0;\n      float phaseAttenuation \x3d 1.0;\n      vec3 luminance \x3d vec3(0);\n\n      for (int i \x3d 0; i \x3c 4; i++) {\n        float phase \x3d mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);\n        luminance +\x3d contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);\n        attenuation *\x3d 0.2;\n        contribution *\x3d 0.6;\n        phaseAttenuation *\x3d 0.5;\n      }\n\n      return luminance;\n    }");
n.fragment.code.add(d.glsl`vec3 lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
vec3 beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`);n.fragment.code.add(d.glsl`vec3 mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return vec3(0);
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
vec3 color = vec3(0.0);
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
vec3 luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
color += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return color;
}`);n.fragment.code.add(d.glsl`void main() {
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
if (hitsPlanet) {
gl_FragColor = vec4(vec3(0), 1);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
float totalTransmittance = 1.0;
vec3 sunDirection = normalize(vec3(0, 0, 1));
vec3 col = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance).rgb;
gl_FragColor = vec4(col, totalTransmittance);
}`);return n}a.RayMarchingSteps=void 0;(function(l){l[l.SIXTEEN=0]="SIXTEEN";l[l.HUNDRED=1]="HUNDRED";l[l.TWOHUNDRED=2]="TWOHUNDRED";l[l.COUNT=3]="COUNT"})(a.RayMarchingSteps||(a.RayMarchingSteps={}));const w=Object.freeze({__proto__:null,get RayMarchingSteps(){return a.RayMarchingSteps},build:x});a.CloudsShader=w;a.build=x})},"esri/views/3d/environment/NoiseTextureAtlas":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/has ../../../core/maybe ./NoiseTextureAtlasTechnique ../webgl-engine/lib/glUtil3D ../../webgl/enums ../../webgl/FramebufferObject".split(" "),
function(a,b,c,d,g,x,w,l){const n=c("esri-mobile")?64:128;c=n/128;const f=Math.ceil(Math.sqrt(n)),e=(n+2)*f;let k=function(){function r(p,h){this._frameBuffer=new l.FramebufferObject(p,{colorTarget:w.TargetType.TEXTURE,width:e,height:e},{target:w.TextureType.TEXTURE_2D,pixelFormat:w.PixelFormat.RGBA,dataType:w.PixelType.UNSIGNED_BYTE,wrapMode:w.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:w.TextureSamplingMode.LINEAR,hasMipmap:!1,width:e,height:e});this._vao=x.createQuadVAO(p);this._technique=new g.NoiseTextureAtlasTechnique({rctx:p,
viewingMode:h.state.viewingMode})}var y=r.prototype;y.destroy=function(){this._technique=d.releaseMaybe(this._technique);this._frameBuffer=d.disposeMaybe(this._frameBuffer);this._vao=d.disposeMaybe(this._vao)};y.render=function(p){if(!d.isNone(this._vao)&&!d.isNone(this.textureAtlas)){var h=p.getViewport();p.setViewport(0,0,e,e);p.bindFramebuffer(this._frameBuffer);var m=p.useTechnique(this._technique);m.setUniform1f("tileSize",n);m.setUniform1f("tileRows",f);p.bindVAO(this._vao);m.assertCompatibleVertexAttributeLocations(this._vao);
p.gl.drawArrays(p.gl.TRIANGLE_STRIP,0,4);p.setViewport(h.x,h.y,h.width,h.height)}};b._createClass(r,[{key:"textureAtlas",get:function(){return this._frameBuffer.colorTexture}}]);return r}();a.ATLAS_SIZE=e;a.NoiseTextureAtlas=k;a.TEXTURE_SCALE=c;a.TILE_ROWS=f;a.TILE_SIZE=n;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/NoiseTextureAtlasTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/NoiseTextureAtlas.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,d,g,x,w,l,n,f){x=function(e){function k(y){var p;return p=e.call(this,y,null,()=>p.destroy())||this}c._inheritsLoose(k,e);var r=k.prototype;r.initializeProgram=function(y){const p=k.shader.get().build();return new l.Program(y.rctx,p,w.Default3D)};r.initializePipeline=function(){return f.makePipelineState({blending:f.simpleBlendingParams(n.BlendFactor.ONE,n.BlendFactor.ZERO),depthTest:{func:n.CompareFunction.LEQUAL},colorWrite:f.defaultColorWriteParams})};return k}(x.ShaderTechnique);
x.shader=new g.ReloadableShaderModule(d.NoiseTextureAtlasShader,()=>new Promise((e,k)=>a(["./NoiseTextureAtlas.glsl"],e,k)));b.NoiseTextureAtlasTechnique=x;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/NoiseTextureAtlas.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder"],function(a,b,c,d){function g(){const w=new d.ShaderBuilder;
w.include(b.ScreenSpacePass,!1);w.fragment.uniforms.add("tileRows","float").add("tileSize","float");w.fragment.code.add(c.glsl`
    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    vec4 taylorInvSqrt(vec4 r) {
      return 1.79284291400159 - 0.85373472095314 * r;
    }

    vec4 mod289(vec4 x) {
      return x - floor( x * (1.0 / 289.0)) * 289.0;
    }

    vec4 permute(vec4 x) {
      return mod289(((x * 34.0) + 1.0) * x);
    }

    vec4 fade(vec4 t) {
      return (t * t * t) * (t * (t * vec4(6.0) - vec4(15.0)) + vec4(10.0));
    }

    float glmPerlin(vec4 Position, vec4 rep) {
      vec4 Pi0 = mod(floor(Position), rep);
      vec4 Pi1 = mod(Pi0 + 1.0, rep);
      vec4 Pf0 = fract(Position);
      vec4 Pf1 = Pf0 - 1.0;
      vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
      vec4 iy = vec4(Pi0.y, Pi0.y, Pi1.y, Pi1.y);

      vec4 ixy = permute(permute(ix) + iy);
      vec4 ixy0 = permute(ixy + vec4(Pi0.z));
      vec4 ixy1 = permute(ixy + vec4(Pi1.z));
      vec4 ixy00 = permute(ixy0 + vec4(Pi0.w));
      vec4 ixy01 = permute(ixy0 + vec4(Pi1.w));
      vec4 ixy10 = permute(ixy1 + vec4(Pi0.w));
      vec4 ixy11 = permute(ixy1 + vec4(Pi1.w));

      vec4 gx00 = ixy00 / 7.0;
      vec4 gy00 = floor(gx00) / 7.0;
      vec4 gz00 = floor(gy00) / 6.0;
      gx00 = fract(gx00) - 0.5;
      gy00 = fract(gy00) - 0.5;
      gz00 = fract(gz00) - 0.5;
      vec4 gw00 = vec4(0.75) - abs(gx00) - abs(gy00) - abs(gz00);
      vec4 sw00 = step(gw00, vec4(0.0));
      gx00 -= sw00 * (step(0.0, gx00) - 0.5);
      gy00 -= sw00 * (step(0.0, gy00) - 0.5);

      vec4 gx01 = ixy01 / 7.0;
      vec4 gy01 = floor(gx01) / 7.0;
      vec4 gz01 = floor(gy01) / 6.0;
      gx01 = fract(gx01) - 0.5;
      gy01 = fract(gy01) - 0.5;
      gz01 = fract(gz01) - 0.5;
      vec4 gw01 = vec4(0.75) - abs(gx01) - abs(gy01) - abs(gz01);
      vec4 sw01 = step(gw01, vec4(0.0));
      gx01 -= sw01 * (step(0.0, gx01) - 0.5);
      gy01 -= sw01 * (step(0.0, gy01) - 0.5);

      vec4 gx10 = ixy10 / 7.0;
      vec4 gy10 = floor(gx10) / 7.0;
      vec4 gz10 = floor(gy10) / 6.0;
      gx10 = fract(gx10) - 0.5;
      gy10 = fract(gy10) - 0.5;
      gz10 = fract(gz10) - 0.5;
      vec4 gw10 = vec4(0.75) - abs(gx10) - abs(gy10) - abs(gz10);
      vec4 sw10 = step(gw10, vec4(0.0));
      gx10 -= sw10 * (step(0.0, gx10) - 0.5);
      gy10 -= sw10 * (step(0.0, gy10) - 0.5);

      vec4 gx11 = ixy11 / 7.0;
      vec4 gy11 = floor(gx11) / 7.0;
      vec4 gz11 = floor(gy11) / 6.0;
      gx11 = fract(gx11) - 0.5;
      gy11 = fract(gy11) - 0.5;
      gz11 = fract(gz11) - 0.5;
      vec4 gw11 = vec4(0.75) - abs(gx11) - abs(gy11) - abs(gz11);
      vec4 sw11 = step(gw11, vec4(0.0));
      gx11 -= sw11 * (step(0.0, gx11) - 0.5);
      gy11 -= sw11 * (step(0.0, gy11) - 0.5);

      vec4 g0000 = vec4(gx00.x, gy00.x, gz00.x, gw00.x);
      vec4 g1000 = vec4(gx00.y, gy00.y, gz00.y, gw00.y);
      vec4 g0100 = vec4(gx00.z, gy00.z, gz00.z, gw00.z);
      vec4 g1100 = vec4(gx00.w, gy00.w, gz00.w, gw00.w);
      vec4 g0010 = vec4(gx10.x, gy10.x, gz10.x, gw10.x);
      vec4 g1010 = vec4(gx10.y, gy10.y, gz10.y, gw10.y);
      vec4 g0110 = vec4(gx10.z, gy10.z, gz10.z, gw10.z);
      vec4 g1110 = vec4(gx10.w, gy10.w, gz10.w, gw10.w);
      vec4 g0001 = vec4(gx01.x, gy01.x, gz01.x, gw01.x);
      vec4 g1001 = vec4(gx01.y, gy01.y, gz01.y, gw01.y);
      vec4 g0101 = vec4(gx01.z, gy01.z, gz01.z, gw01.z);
      vec4 g1101 = vec4(gx01.w, gy01.w, gz01.w, gw01.w);
      vec4 g0011 = vec4(gx11.x, gy11.x, gz11.x, gw11.x);
      vec4 g1011 = vec4(gx11.y, gy11.y, gz11.y, gw11.y);
      vec4 g0111 = vec4(gx11.z, gy11.z, gz11.z, gw11.z);
      vec4 g1111 = vec4(gx11.w, gy11.w, gz11.w, gw11.w);

      vec4 norm00 = taylorInvSqrt(vec4(dot(g0000, g0000), dot(g0100, g0100), dot(g1000, g1000), dot(g1100, g1100)));
      g0000 *= norm00.x;
      g0100 *= norm00.y;
      g1000 *= norm00.z;
      g1100 *= norm00.w;

      vec4 norm01 = taylorInvSqrt(vec4(dot(g0001, g0001), dot(g0101, g0101), dot(g1001, g1001), dot(g1101, g1101)));
      g0001 *= norm01.x;
      g0101 *= norm01.y;
      g1001 *= norm01.z;
      g1101 *= norm01.w;

      vec4 norm10 = taylorInvSqrt(vec4(dot(g0010, g0010), dot(g0110, g0110), dot(g1010, g1010), dot(g1110, g1110)));
      g0010 *= norm10.x;
      g0110 *= norm10.y;
      g1010 *= norm10.z;
      g1110 *= norm10.w;

      vec4 norm11 = taylorInvSqrt(vec4(dot(g0011, g0011), dot(g0111, g0111), dot(g1011, g1011), dot(g1111, g1111)));
      g0011 *= norm11.x;
      g0111 *= norm11.y;
      g1011 *= norm11.z;
      g1111 *= norm11.w;

      float n0000 = dot(g0000, Pf0);
      float n1000 = dot(g1000, vec4(Pf1.x, Pf0.y, Pf0.z, Pf0.w));
      float n0100 = dot(g0100, vec4(Pf0.x, Pf1.y, Pf0.z, Pf0.w));
      float n1100 = dot(g1100, vec4(Pf1.x, Pf1.y, Pf0.z, Pf0.w));
      float n0010 = dot(g0010, vec4(Pf0.x, Pf0.y, Pf1.z, Pf0.w));
      float n1010 = dot(g1010, vec4(Pf1.x, Pf0.y, Pf1.z, Pf0.w));
      float n0110 = dot(g0110, vec4(Pf0.x, Pf1.y, Pf1.z, Pf0.w));
      float n1110 = dot(g1110, vec4(Pf1.x, Pf1.y, Pf1.z, Pf0.w));
      float n0001 = dot(g0001, vec4(Pf0.x, Pf0.y, Pf0.z, Pf1.w));
      float n1001 = dot(g1001, vec4(Pf1.x, Pf0.y, Pf0.z, Pf1.w));
      float n0101 = dot(g0101, vec4(Pf0.x, Pf1.y, Pf0.z, Pf1.w));
      float n1101 = dot(g1101, vec4(Pf1.x, Pf1.y, Pf0.z, Pf1.w));
      float n0011 = dot(g0011, vec4(Pf0.x, Pf0.y, Pf1.z, Pf1.w));
      float n1011 = dot(g1011, vec4(Pf1.x, Pf0.y, Pf1.z, Pf1.w));
      float n0111 = dot(g0111, vec4(Pf0.x, Pf1.y, Pf1.z, Pf1.w));
      float n1111 = dot(g1111, Pf1);

      vec4 fade_xyzw = fade(Pf0);
      vec4 n_0w = mix(vec4(n0000, n1000, n0100, n1100), vec4(n0001, n1001, n0101, n1101), fade_xyzw.w);
      vec4 n_1w = mix(vec4(n0010, n1010, n0110, n1110), vec4(n0011, n1011, n0111, n1111), fade_xyzw.w);
      vec4 n_zw = mix(n_0w, n_1w, fade_xyzw.z);
      vec2 n_yzw = mix(vec2(n_zw.x, n_zw.y), vec2(n_zw.z, n_zw.w), fade_xyzw.y);
      float n_xyzw = mix(n_yzw.x, n_yzw.y, fade_xyzw.x);
      return 2.2 * n_xyzw;
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * glmPerlin(vec4(p, 0.0), vec4(frequency));
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float hash(float p) {
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);;
    }

    float noise(vec3 x) {
      vec3 p = floor(x);
      vec3 f = fract(x);

      f = f * f * (3.0 - 2.0 * f);
      float n = p.x + p.y * 57.0 + 113.0 * p.z;

      return mix(
      mix(
        mix(hash(n + 0.0), hash(n + 1.0), f.x),
        mix(hash(n + 57.0), hash(n + 58.0), f.x),
        f.y),
      mix(
        mix(hash(n + 113.0), hash(n + 114.0), f.x),
        mix(hash(n + 170.0), hash(n + 171.0), f.x),
        f.y),
      f.z);
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - noise(mod(tp, numCells));
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv, float tileRows) {
      vec2 tile = floor(uv);
      float z = floor(tileRows * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${c.glsl.float(8)});

      float worley0 = worley(p, ${c.glsl.float(2)} * 2.0);
      float worley1 = worley(p, ${c.glsl.float(2)} * 8.0);
      float worley2 = worley(p, ${c.glsl.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${c.glsl.float(2)});
      float worley1 = worley(p, ${c.glsl.float(2)} * 2.0);
      float worley2 = worley(p, ${c.glsl.float(2)} * 4.0);
      float worley3 = worley(p, ${c.glsl.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `);w.fragment.code.add(c.glsl`void main() {
float padWidth = 1.0;
float paddedSize = tileSize + 2.0 * padWidth;
float tileCount = tileRows * tileRows;
vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);
bool padCell = false;
if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
padCell = true;
}
if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
padCell = true;
}
bool startPadX = false;
bool startPadY = false;
bool endPadX = false;
bool endPadY = false;
if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
startPadX = true;
}
if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
startPadY = true;
}
if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
endPadX = true;
}
if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
endPadY = true;
}
vec2 padding = vec2(2.0 * padWidth) * tile;
vec2 uv;
if (padCell) {
vec2 pixel = gl_FragCoord.xy - padWidth - padding;
if (startPadX) {
pixel.x += tileSize;
}
if (startPadY) {
pixel.y += tileSize;
}
if (endPadX) {
pixel.x -= tileSize;
}
if (endPadY) {
pixel.y -= tileSize;
}
uv = vec2(pixel.xy / tileSize);
} else {
vec2 pixel = gl_FragCoord.xy - padWidth - padding;
uv = vec2(pixel.xy / tileSize);
}
vec3 p_ = get3Dfrom2D(uv, tileRows);
vec3 p = p_;
p.z /= (tileRows * tileRows);
float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
float worleyNoise = getTextureForPointWorley(p);
gl_FragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
p_ = mod(p_ + 1.0, tileRows * tileRows);
p = p_;
p.z /= (tileRows * tileRows);
worleyPerlinNoise = getTextureForPointPerlinWorley(p);
worleyNoise = getTextureForPointWorley(p);
gl_FragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
gl_FragColor.ba = vec2(0.0, 1.0);
}`);return w}const x=Object.freeze({__proto__:null,build:g});a.NoiseTextureAtlasShader=x;a.build=g})},"esri/views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass":function(){define(["exports","../shaderModules/interfaces","../../lib/VertexAttribute"],function(a,b,c){a.ScreenSpacePass=function(d,g=!0){d.attributes.add(c.VertexAttribute.POSITION,"vec2");g&&d.varyings.add("uv","vec2");d.vertex.code.add(b.glsl`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${g?b.glsl`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/FramebufferObject":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/Logger ../../core/maybe ./BufferObject ./checkWebGLError ./context-util ./enums ./Renderbuffer ./Texture ./Util".split(" "),function(a,b,c,d,g,x,w,l,n,f,e){function k(u){return"type"in u&&"texture"===u.type}function r(u){return k(u)||"pixelFormat"in u}function y(u,t){u.target!==l.TextureType.TEXTURE_2D&&u.target!==l.TextureType.TEXTURE_CUBE_MAP&&
console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!");void 0!==t.width&&0<=t.width&&void 0!==t.height&&0<=t.height?t.width===u.width&&t.height===u.height||console.error("Color attachment texture must match the framebuffer's!"):(t.width=u.width,t.height=u.height)}function p(u,t){void 0!==t.width&&0<=t.width&&void 0!==t.height&&0<=t.height?t.width===u.width&&t.height===u.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(t.width=u.width,t.height=u.height)}
function h(u){return u.descriptor.target===l.TextureType.TEXTURE_CUBE_MAP?l.TextureType.TEXTURE_CUBE_MAP_POSITIVE_X:l.TextureType.TEXTURE_2D}const m=c.getLogger("esri.views.webgl.FrameBufferObject");c=function(){function u(q,z,v=null,B=null){this._context=q;this._stencilAttachment=this._depthAttachment=this._glName=null;this._colorAttachments=new Map;this._initialized=!1;this._desc={...z};q.instanceCounter.increment(l.ResourceType.Framebuffer,this);if(d.isSome(v))for(Array.isArray(v)||(v=[v]),q=0;q<
v.length;++q){z=v[q];const E=l.ColorAttachment.COLOR_ATTACHMENT0+q;let C;r(z)?(k(z)?(C=z.descriptor,this._colorAttachments.set(E,z)):(C=z,this._colorAttachments.set(E,new f.Texture(this._context,C))),y(C,this._desc)):("type"in z&&"renderbuffer"===z.type?(C=z.descriptor,this._colorAttachments.set(E,z)):(C=z,this._colorAttachments.set(E,new n.Renderbuffer(this._context,C))),p(C,this._desc));this._validateColorAttachmentPoint(E)}if(d.isSome(B))if(r(B))this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),
k(B)?(v=B.descriptor,this._depthStencilTexture=B):(v=B,this._depthStencilTexture=new f.Texture(this._context,v)),y(v,this._desc);else{var A;"type"in B&&"renderbuffer"===B.type?v=B.descriptor:(v=B,B=new n.Renderbuffer(this._context,v));q=null!=(A=this._desc.depthStencilTarget)?A:l.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER;q===l.DepthStencilTargetType.STENCIL_RENDER_BUFFER?this._stencilAttachment=B:q===l.DepthStencilTargetType.DEPTH_RENDER_BUFFER||q===l.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER?
this._depthAttachment=B:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER');p(v,this._desc)}}var t=u.prototype;t.dispose=function(){if(this._desc){var q=this._context.getBoundFramebufferObject();this._disposeColorAttachments();this._disposeDepthStencilAttachments();this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null);this._context.bindFramebuffer(q);this._context.instanceCounter.decrement(l.ResourceType.Framebuffer,
this);this._desc=null}};t.getColorTexture=function(q){return(q=this._colorAttachments.get(q))&&k(q)?q:null};t.attachColorTexture=function(q,z=l.ColorAttachment.COLOR_ATTACHMENT0){q&&(this._validateColorAttachmentPoint(z),y(q.descriptor,this._desc),this._disposeColorAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(q.glName,z)),this._colorAttachments.set(z,q))};t.detachColorTexture=function(q=l.ColorAttachment.COLOR_ATTACHMENT0){const z=this._colorAttachments.get(q);
if(k(z))return this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,q)),this._colorAttachments.delete(q),z};t.setColorTextureTarget=function(q,z=l.ColorAttachment.COLOR_ATTACHMENT0){const v=this._colorAttachments.get(z);k(v)&&this._framebufferTexture2D(v.glName,z,q)};t.attachDepthStencilTexture=function(q){if(!d.isNone(q)){var z=q.descriptor;z.pixelFormat!==l.PixelFormat.DEPTH_STENCIL&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!");
z.dataType!==l.PixelType.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!");this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!");y(z,this._desc);this._desc.depthStencilTarget&&this._desc.depthStencilTarget!==l.DepthStencilTargetType.DEPTH_STENCIL_TEXTURE&&(this._desc.depthStencilTarget=l.DepthStencilTargetType.DEPTH_STENCIL_TEXTURE);this._disposeDepthStencilAttachments();
this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(q.glName,l.DepthStencilAttachment));this._depthStencilTexture=q}};t.detachDepthStencilTexture=function(){const q=this._depthStencilTexture;q&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,l.DepthStencilAttachment));this._depthStencilTexture=null;return q};t.attachDepthStencilBuffer=function(q){if(!d.isNone(q)){var z=q.descriptor;z.internalFormat!==l.RenderbufferFormat.DEPTH_STENCIL&&
z.internalFormat!==l.RenderbufferFormat.DEPTH_COMPONENT16&&console.error("Depth/Stencil buffer must have correct internalFormat");p(z,this._desc);this._disposeDepthStencilAttachments();this._desc.depthStencilTarget=z.internalFormat===l.RenderbufferFormat.DEPTH_STENCIL?l.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER:l.DepthStencilTargetType.DEPTH_RENDER_BUFFER;this._initialized&&(this._context.bindFramebuffer(this),z=this._context.gl,z.framebufferRenderbuffer(l.FramebufferTarget.FRAMEBUFFER,this._desc.depthStencilTarget===
l.DepthStencilTargetType.DEPTH_RENDER_BUFFER?z.DEPTH_ATTACHMENT:z.DEPTH_STENCIL_ATTACHMENT,z.RENDERBUFFER,q.glName));this._depthAttachment=q}};t.detachDepthStencilBuffer=function(){const q=this._context.gl,z=this._depthAttachment;z&&this._initialized&&(this._context.bindFramebuffer(this),q.framebufferRenderbuffer(l.FramebufferTarget.FRAMEBUFFER,this._desc.depthStencilTarget===l.DepthStencilTargetType.DEPTH_RENDER_BUFFER?q.DEPTH_ATTACHMENT:q.DEPTH_STENCIL_ATTACHMENT,q.RENDERBUFFER,null));this._depthAttachment=
null;return z};t.detachAll=function(){this._colorAttachments.forEach((q,z)=>this._detachColorAttachment(z));this.detachDepthStencilBuffer();this.detachDepthStencilTexture()};t.copyToTexture=function(q,z,v,B,A,E,C){(0>q||0>z||0>A||0>E)&&console.error("Offsets cannot be negative!");(0>=v||0>=B)&&console.error("Copy width and height must be greater than zero!");var D=this._desc;const F=C.descriptor;C.descriptor.target!==l.TextureType.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!");(q+
v>D.width||z+B>D.height||A+v>F.width||E+B>F.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");D=this._context;C=D.bindTexture(C,f.Texture.TEXTURE_UNIT_FOR_UPDATES);D.setActiveTexture(f.Texture.TEXTURE_UNIT_FOR_UPDATES);D.bindFramebuffer(this);D.gl.copyTexSubImage2D(l.TextureType.TEXTURE_2D,0,A,E,q,z,v,B);D.bindTexture(C,f.Texture.TEXTURE_UNIT_FOR_UPDATES)};t.readPixels=function(q,z,v,B,A,E,C){(0>=v||0>=B)&&console.error("Copy width and height must be greater than zero!");
C||console.error("Target memory is not initialized!");this._context.bindFramebuffer(this);this._context.gl.readPixels(q,z,v,B,A,E,C)};t.readPixelsAsync=function(){var q=b._asyncToGenerator(function*(z,v,B,A,E,C,D){if(this._context.type!==w.ContextType.WEBGL2)x.webglDebugEnabled()&&console.warn("Attempting to read pixels using pixel buffer object without WebGL2"),this.readPixels(z,v,B,A,E,C,D);else{var F=this._context.gl,G=g.BufferObject.createPixelPack(this._context,l.Usage.STREAM_READ,D.byteLength);
this._context.bindBuffer(G);this._context.bindFramebuffer(this);F.readPixels(z,v,B,A,E,C,0);this._context.unbindBuffer(l.BufferType.PIXEL_PACK_BUFFER);yield G.getSubDataAsync(D);G.dispose()}});return function(z,v,B,A,E,C,D){return q.apply(this,arguments)}}();t.resize=function(q,z){const v=this._desc;if(v.width!==q||v.height!==z)if(this._initialized){v.width=q;v.height=z;this._colorAttachments.forEach(B=>{B&&B.resize(q,z)});if(null!=this._depthStencilTexture)this._depthStencilTexture.resize(q,z);else if(this._depthAttachment||
this._stencilAttachment)this._depthAttachment&&this._depthAttachment.resize(q,z),this._stencilAttachment&&this._stencilAttachment.resize(q,z);this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null);this._initialized=!1}else v.width=q,v.height=z,this._colorAttachments.forEach(B=>{B&&B.resize(q,z)}),this._depthStencilTexture&&this._depthStencilTexture.resize(q,z)};t.initializeAndBind=function(q=l.FramebufferTarget.FRAMEBUFFER){var z,v,B,A;const E=this._context.gl;if(this._initialized)E.bindFramebuffer(q,
this.glName);else{this._glName&&E.deleteFramebuffer(this._glName);var C=this._context,D=E.createFramebuffer(),F=this._desc,G=null!=(z=F.colorTarget)?z:l.TargetType.RENDER_BUFFER;z=null!=(v=F.width)?v:1;v=null!=(B=F.height)?B:1;E.bindFramebuffer(q,D);0===this._colorAttachments.size&&(G===l.TargetType.TEXTURE||G===l.TargetType.CUBEMAP?this._colorAttachments.set(l.ColorAttachment.COLOR_ATTACHMENT0,new f.Texture(C,{target:this.descriptor.colorTarget===l.TargetType.CUBEMAP?l.TextureType.TEXTURE_CUBE_MAP:
l.TextureType.TEXTURE_2D,pixelFormat:l.PixelFormat.RGBA,dataType:l.PixelType.UNSIGNED_BYTE,samplingMode:l.TextureSamplingMode.NEAREST,wrapMode:l.TextureWrapMode.CLAMP_TO_EDGE,width:F.width,height:F.height})):(B=new n.Renderbuffer(C,{internalFormat:l.SizedPixelFormat.RGBA4,width:z,height:v}),this._colorAttachments.set(l.ColorAttachment.COLOR_ATTACHMENT0,B)));this._colorAttachments.forEach((J,I)=>{J&&(k(J)?this._framebufferTexture2D(J.glName,I,h(J),q):E.framebufferRenderbuffer(q,I,E.RENDERBUFFER,J.glName))});
B=null!=(A=F.depthStencilTarget)?A:l.DepthStencilTargetType.NONE;switch(B){case l.DepthStencilTargetType.DEPTH_RENDER_BUFFER:case l.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER:this._depthAttachment||(this._depthAttachment=new n.Renderbuffer(C,{internalFormat:F.depthStencilTarget===l.DepthStencilTargetType.DEPTH_RENDER_BUFFER?l.RenderbufferFormat.DEPTH_COMPONENT16:l.RenderbufferFormat.DEPTH_STENCIL,width:z,height:v}));E.framebufferRenderbuffer(q,B===l.DepthStencilTargetType.DEPTH_RENDER_BUFFER?
E.DEPTH_ATTACHMENT:E.DEPTH_STENCIL_ATTACHMENT,E.RENDERBUFFER,this._depthAttachment.glName);break;case l.DepthStencilTargetType.STENCIL_RENDER_BUFFER:this._stencilAttachment||(this._stencilAttachment=new n.Renderbuffer(C,{internalFormat:l.RenderbufferFormat.STENCIL_INDEX8,width:z,height:v}));E.framebufferRenderbuffer(q,E.STENCIL_ATTACHMENT,E.RENDERBUFFER,this._stencilAttachment.glName);break;case l.DepthStencilTargetType.DEPTH_STENCIL_TEXTURE:this._depthStencilTexture||(C.capabilities.depthTexture||
console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),this._depthStencilTexture=new f.Texture(C,{target:l.TextureType.TEXTURE_2D,pixelFormat:l.PixelFormat.DEPTH_STENCIL,dataType:l.PixelType.UNSIGNED_INT_24_8,samplingMode:l.TextureSamplingMode.NEAREST,wrapMode:l.TextureWrapMode.CLAMP_TO_EDGE,width:z,height:v})),this._framebufferTexture2D(this._depthStencilTexture.glName,E.DEPTH_STENCIL_ATTACHMENT,h(this._depthStencilTexture),
q)}x.webglValidateShadersEnabled()&&E.checkFramebufferStatus(q)!==E.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!");this._glName=D;this._initialized=!0}};t._framebufferTexture2D=function(q,z=l.ColorAttachment.COLOR_ATTACHMENT0,v=l.TextureType.TEXTURE_2D,B=l.FramebufferTarget.FRAMEBUFFER,A=0){this._context.gl.framebufferTexture2D(B,z,v,q,A)};t._detachColorAttachment=function(q){x.webglDebugEnabled()&&console.warn("Detaching an FBO attachment can be a slow due to invalidating framebuffer completeness!");
const z=this._context.gl,v=this._colorAttachments.get(q);k(v)?this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,q)):this._initialized&&(this._context.bindFramebuffer(this),z.framebufferRenderbuffer(l.FramebufferTarget.FRAMEBUFFER,q,z.RENDERBUFFER,null));this._colorAttachments.delete(q);return v};t._disposeColorAttachments=function(){this._colorAttachments.forEach((q,z)=>{this._detachColorAttachment(z);q.dispose()});this._colorAttachments.clear()};t._disposeDepthStencilAttachments=
function(){const q=this._context.gl;this._depthAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),q.framebufferRenderbuffer(l.FramebufferTarget.FRAMEBUFFER,this._desc.depthStencilTarget===l.DepthStencilTargetType.DEPTH_RENDER_BUFFER?q.DEPTH_ATTACHMENT:q.DEPTH_STENCIL_ATTACHMENT,q.RENDERBUFFER,null)),this._depthAttachment.dispose(),this._depthAttachment=null);this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),q.framebufferRenderbuffer(l.FramebufferTarget.FRAMEBUFFER,
q.STENCIL_ATTACHMENT,q.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null);this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,q.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)};t._validateColorAttachmentPoint=function(q){if(-1===u._MAX_COLOR_ATTACHMENTS){const z=this._context.capabilities.drawBuffers;u._MAX_COLOR_ATTACHMENTS=z?this._context.gl.getParameter(z.MAX_COLOR_ATTACHMENTS):
1}q-=l.ColorAttachment.COLOR_ATTACHMENT0;q+1>u._MAX_COLOR_ATTACHMENTS&&m.error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${q+1}. Implementation supports up to ${u._MAX_COLOR_ATTACHMENTS} color attachments`)};b._createClass(u,[{key:"glName",get:function(){return this._glName}},{key:"descriptor",get:function(){return this._desc}},{key:"colorTexture",get:function(){const q=this._colorAttachments.get(l.ColorAttachment.COLOR_ATTACHMENT0);return q&&k(q)?q:null}},{key:"colorAttachment",
get:function(){return this._colorAttachments.get(l.ColorAttachment.COLOR_ATTACHMENT0)}},{key:"depthStencilAttachment",get:function(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment}},{key:"depthStencilTexture",get:function(){return this._depthStencilTexture}},{key:"width",get:function(){return this._desc.width}},{key:"height",get:function(){return this._desc.height}},{key:"gpuMemoryUsage",get:function(){return[...this._colorAttachments].reduce((q,[,z])=>q+e.getGpuMemoryUsage(z),
0)+e.getGpuMemoryUsage(this.depthStencilAttachment)}}]);return u}();c._MAX_COLOR_ATTACHMENTS=-1;a.FramebufferObject=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/Renderbuffer":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","./context-util","./enums"],function(a,b,c,d){let g=function(){function x(l,n){this._context=l;this._desc=n;this.type="renderbuffer";this._context.instanceCounter.increment(d.ResourceType.Renderbuffer,this);l=this._context.gl;this.glName=
l.createRenderbuffer();this._context.bindRenderbuffer(this);const {width:f,height:e,internalFormat:k,multisampled:r}=n;if(r){if(this._context.type!==c.ContextType.WEBGL2)throw Error("Multisampled renderbuffers are not supported in WebGL1!");l.renderbufferStorageMultisample(l.RENDERBUFFER,this.samples,k,f,e)}else l.renderbufferStorage(l.RENDERBUFFER,k,f,e)}var w=x.prototype;w.resize=function(l,n){const f=this._desc;if(f.width!==l||f.height!==n)f.width=l,f.height=n,l=this._context.gl,this._context.bindRenderbuffer(this),
f.multisampled?l.renderbufferStorageMultisample(l.RENDERBUFFER,this.samples,f.internalFormat,f.width,f.height):l.renderbufferStorage(l.RENDERBUFFER,f.internalFormat,f.width,f.height)};w.dispose=function(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(d.ResourceType.Renderbuffer,this),this._context=null)};b._createClass(x,[{key:"descriptor",get:function(){return this._desc}},{key:"samples",get:function(){const l=this._desc.samples,n=this._context.parameters.maxSamples;
return l?Math.min(l,n):n}}]);return x}();a.Renderbuffer=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/CloudsTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../chunks/Clouds.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k){w=function(r){function y(h,m){var u;return u=r.call(this,h,m,()=>u.destroy())||this}c._inheritsLoose(y,r);var p=y.prototype;p.initializeProgram=function(h){const m=y.shader.get().build({steps:this.configuration.steps});return new f.Program(h.rctx,m,n.Default3D)};p.initializePipeline=function(){return k.makePipelineState({blending:k.separateBlendingParams(e.BlendFactor.ONE,e.BlendFactor.ONE,e.BlendFactor.ZERO,e.BlendFactor.ZERO),depthTest:{func:e.CompareFunction.LEQUAL},
colorWrite:k.defaultColorWriteParams})};return y}(w.ShaderTechnique);w.shader=new x.ReloadableShaderModule(g.CloudsShader,()=>new Promise((r,y)=>a(["./Clouds.glsl"],r,y)));x=function(r){function y(){var p=r.apply(this,arguments)||this;p.steps=g.RayMarchingSteps.SIXTEEN;return p}c._inheritsLoose(y,r);return y}(l.ShaderTechniqueConfiguration);d.__decorate([l.parameter({count:g.RayMarchingSteps.COUNT})],x.prototype,"steps",void 0);b.CloudsTechnique=w;b.CloudsTechniqueConfiguration=x;Object.defineProperty(b,
"__esModule",{value:!0})})},"esri/views/3d/environment/Fog":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../chunks/vec3 ../../../chunks/vec3f32 ../../../geometry/projectionEllipsoid ./atmosphereUtils ./FogTechnique ./weather ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../../webgl/enums".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A){a.Fog=function(E){function C(F){var G=E.call(this,F)||this;G._projectionInverse=r.create();G._viewInverse=r.create();G._nearFar=p.create();G._fogColor=m.create();G._fogColorAtNight=m.create();G._cameraDirection=m.create();G._foggyFadeStart=.3;G._foggyFadeEnd=.6;G._hazeFadeStart=.7;G._hazeFadeEnd=1;G._strength=4E-6;G._vao=B.createQuadVAO(F.context.renderContext.rctx,v.Pos2Tex);F=u.getReferenceEllipsoid(F.view.spatialReference);G._planetRadius=
F.radius;G._atmosphereRadius=F.radius+t.atmosphereHeight;return G}b._inheritsLoose(C,E);var D=C.prototype;D.destroy=function(){this._hazeFogTechnique=x.releaseMaybe(this._hazeFogTechnique);this._thickFogTechnique=x.releaseMaybe(this._thickFogTechnique);this._vao=x.disposeMaybe(this._vao)};D.when=function(){return Promise.resolve()};D.render=function(F,G,J){if(0!==this.view.basemapTerrain.baseOpacity||G)if(this._update(F,G,J),!(0>=this._fogAmount)){var I=F.offscreenRenderingHelper,O=G?this.thickFogTechnique:
this.hazeFogTechnique,P=F.rctx.useTechnique(O);I.renderDepthDetached(()=>{P.bindTexture(I.depthTexture,"depthTex");this._renderFog(O.program,F)})}};D._renderFog=function(F,G){if(x.isNone(this._vao))return!1;const J=G.rctx;F.setUniform3fv("cameraPosition",G.camera.eye);F.setUniformMatrix4fv("inverseProjectionMatrix",this._projectionInverse);F.setUniformMatrix4fv("inverseViewMatrix",this._viewInverse);F.setUniform2fv("nearFar",this._nearFar);F.setUniform1f("atmosphereC",this._atmosphereC);F.setUniform1f("fogStrength",
this._strength);F.setUniform1f("fogAmount",this._fogAmount);F.setUniform3fv("fogColor",this._fogColor);J.bindVAO(this._vao);F.assertCompatibleVertexAttributeLocations(this._vao);J.drawArrays(A.PrimitiveType.TRIANGLE_STRIP,0,4);return!0};D._update=function(F,G,J){if(!x.isNone(F.camera)){var I=G?.1:0;J?h.set(this._fogColor,.5,.5,.5):G?h.set(this._fogColor,1.5,1.5,1.5):h.set(this._fogColor,.24,.44,.8);h.scale(this._fogColorAtNight,this._fogColor,I);h.normalize(this._cameraDirection,F.camera.eye);J=Math.max(0,
h.dot(this._cameraDirection,F.scenelightingData.lightingMainDirection));h.lerp(this._fogColor,this._fogColorAtNight,this._fogColor,J);k.invert(this._projectionInverse,F.camera.projectionMatrix);k.invert(this._viewInverse,F.camera.viewMatrix);y.set(this._nearFar,F.camera.near,F.camera.far);F=h.length(F.camera.eye);this._atmosphereC=F*F-this._atmosphereRadius*this._atmosphereRadius;this._fogAmount=G?1-g.smoothstep(this._foggyFadeStart*z.weatherHeightLimit,this._foggyFadeEnd*z.weatherHeightLimit,Math.abs(F-
this._planetRadius)):1-g.smoothstep(this._hazeFadeStart*z.weatherHeightLimit,this._hazeFadeEnd*z.weatherHeightLimit,Math.abs(F-this._planetRadius))}};C.isSupported=function(F){return F.capabilities.depthTexture};b._createClass(C,[{key:"_shaderTechniqueRepository",get:function(){return this.context.shaderTechniqueRepository}},{key:"strength",get:function(){return this._strength},set:function(F){this._strength=F}},{key:"thickFogTechnique",get:function(){if(x.isNone(this._thickFogTechnique)){const F=
new q.FogTechniqueConfiguration;F.haze=!1;this._thickFogTechnique=this._shaderTechniqueRepository.acquire(q.FogTechnique,F)}return this._thickFogTechnique}},{key:"hazeFogTechnique",get:function(){if(x.isNone(this._hazeFogTechnique)){const F=new q.FogTechniqueConfiguration;F.haze=!0;this._hazeFogTechnique=this._shaderTechniqueRepository.acquire(q.FogTechnique,F)}return this._hazeFogTechnique}}]);return C}(d);c.__decorate([w.property({constructOnly:!0})],a.Fog.prototype,"context",void 0);c.__decorate([w.property({constructOnly:!0})],
a.Fog.prototype,"view",void 0);a.Fog=c.__decorate([e.subclass("esri.views.3d.environment.Fog")],a.Fog);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/FogTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../chunks/Fog.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k){w=function(r){function y(){return r.apply(this,arguments)||this}c._inheritsLoose(y,r);var p=y.prototype;p.initializeProgram=function(h){const m=y.shader.get().build({haze:this.configuration.haze});return new f.Program(h.rctx,m,n.Default3D)};p.initializePipeline=function(){return this.configuration.haze?k.makePipelineState({blending:k.separateBlendingParams(e.BlendFactor.ONE,e.BlendFactor.ZERO,e.BlendFactor.ONE_MINUS_SRC_COLOR,e.BlendFactor.ONE),colorWrite:k.defaultColorWriteParams}):
k.makePipelineState({blending:k.separateBlendingParams(e.BlendFactor.SRC_ALPHA,e.BlendFactor.ZERO,e.BlendFactor.ONE_MINUS_SRC_ALPHA,e.BlendFactor.ONE),colorWrite:k.defaultColorWriteParams})};return y}(w.ShaderTechnique);w.shader=new x.ReloadableShaderModule(g.FogShader,()=>new Promise((r,y)=>a(["./Fog.glsl"],r,y)));g=function(r){function y(){var p=r.apply(this,arguments)||this;p.haze=!1;return p}c._inheritsLoose(y,r);return y}(l.ShaderTechniqueConfiguration);d.__decorate([l.parameter()],g.prototype,
"haze",void 0);b.FogTechnique=w;b.FogTechniqueConfiguration=g;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/Fog.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,d,g,x,w){function l(f){const e=new x.ShaderBuilder;e.attributes.add(w.VertexAttribute.POSITION,"vec2");e.include(b.TextureCoordinateAttribute,{attributeTextureCoordinates:b.TextureCoordinateAttributeType.Default});e.varyings.add("worldRay","vec3");e.varyings.add("eyeDir","vec3");e.vertex.uniforms.add("inverseProjectionMatrix","mat4");e.vertex.uniforms.add("inverseViewMatrix","mat4");e.vertex.code.add(g.glsl`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`);e.fragment.uniforms.add("atmosphereC","float").add("cameraPosition","vec3").add("nearFar","vec2").add("depthTex","sampler2D").add("fogStrength","float").add("fogAmount","float").add("fogColor","vec3");e.include(d.Gamma);e.fragment.include(c.ReadLinearDepth);e.fragment.code.add(g.glsl`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`);e.fragment.code.add(g.glsl`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`);e.fragment.code.add(g.glsl`
    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;

      float depthSample = texture2D(depthTex, vuv0).r;
      float zNorm = 2.0 * depthSample - 1.0;
      float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
      if(depthSample < 1.0 && depthSample > 0.0){
        vec3 cameraSpaceRay = normalize(eyeDir);
        cameraSpaceRay /= cameraSpaceRay.z;
        cameraSpaceRay *= linDepth;
        terrainDepth = max(0.0, length(cameraSpaceRay));
      }

      ${f.haze?g.glsl`
          if(terrainDepth == -1.0){
            gl_FragColor = vec4(0);
            return;
          }`:""}

      vec4 fog = applyFog(terrainDepth, rayDir);

      gl_FragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
    }
  `);return e}const n=Object.freeze({__proto__:null,build:l});a.FogShader=n;a.build=l})},"esri/views/3d/environment/PanoramicAtmosphere":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../support/requestImageUtils ../../../chunks/SimpleAtmosphere.glsl ./SimpleAtmosphereTechnique ./resources/SimpleAtmosphereTexture ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/core/shaderLibrary/util/View.glsl ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/GeometryUtil ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums ../../webgl/Texture ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v){const B=c.getLogger("esri.views.3d.environment.PanoramicAtmosphere");c=function(){function C(){this.type="panoramic";this._techniqueConfig=new f.SimpleAtmosphereTechniqueConfiguration;this._readyResolver=g.createResolver();this._readyController=new AbortController}var D=C.prototype;D.destroy=function(){this._readyResolver.reject();this._texture=d.disposeMaybe(this._texture);this._vao=d.disposeMaybe(this._vao);this._readyController=d.abortMaybe(this._readyController)};
D.when=function(){return this._readyResolver.promise};D.initializeRenderContext=function(F){this._techniqueConfig.geometry=n.SimpleAtmosphereGeometry.Cylinder;this._technique=F.shaderTechniqueRepository.acquire(f.SimpleAtmosphereTechnique,this._techniqueConfig);const G=F.renderContext.rctx;this._vao=this._createVertexArrayObject(G);this._vaoCount=z.vertexCount(this._vao,"geometry");l.requestImage(e,{signal:this._readyController.signal}).then(J=>{this._texture=new q.Texture(G,{pixelFormat:t.PixelFormat.RGBA,
dataType:t.PixelType.UNSIGNED_BYTE,wrapMode:t.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:t.TextureSamplingMode.LINEAR,flipped:!0},J);F.requestRender();this._readyController=null;this._readyResolver.resolve()}).catch(J=>{g.isAbortError(J)||B.error("Unable to initialize atmosphere: image request failed",J);this._readyResolver.reject()})};D.render=function(F){const G=F.rctx,J=G.useTechnique(this._technique);J.bindTexture(this._texture,"tex");y.bindProjectionMatrix(J,F.camera.projectionMatrix);var I=
A;x.copy(I,F.camera.viewMatrix);I[12]=0;I[13]=0;I[14]=0;I[15]=1;J.setUniformMatrix4fv("view",A);J.setUniform4f("uColor",1,1,1,1);F.scenelightingData.setLightDirectionUniform(J);G.bindVAO(this._vao);J.assertCompatibleVertexAttributeLocations(this._vao);G.drawArrays(t.PrimitiveType.TRIANGLES,0,this._vaoCount)};D.renderHaze=function(){return!1};D._createVertexArrayObject=function(F){var G=h.createPolySphereGeometry(1,2,!1);const J=G.indices.get(m.VertexAttribute.POSITION);for(var I=0;I<J.length;I+=3){var O=
J[I];J[I]=J[I+2];J[I+2]=O}G=G.vertexAttributes.get(m.VertexAttribute.POSITION).data;I=E.createBuffer(J.length);O=I.position;for(let P=0;P<J.length;++P){const K=3*J[P];O.set(P,0,G[K]);O.set(P,1,G[K+1]);O.set(P,2,G[K+2])}return new v.VertexArrayObject(F,p.Default3D,{geometry:k.glLayout(E)},{geometry:u.BufferObject.createVertex(F,t.Usage.STATIC_DRAW,I.buffer)})};b._createClass(C,[{key:"canRender",get:function(){return null!=this._texture}}]);return C}();const A=w.create(),E=r.newLayout().vec3f(m.VertexAttribute.POSITION);
a.PanoramicAtmosphere=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/support/requestImageUtils":function(){define(["exports","../chunks/_rollupPluginBabelHelpers","../request"],function(a,b,c){function d(){d=b._asyncToGenerator(function*(g,x){({data:g}=yield c(g,{responseType:"image",...x}));return g});return d.apply(this,arguments)}a.requestImage=function(g,x){return d.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/SimpleAtmosphere.glsl":function(){define(["exports",
"../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/lib/VertexAttribute"],function(a,b,c,d,g){function x(l){const n=new d.ShaderBuilder;l.geometry===a.SimpleAtmosphereGeometry.Underground?(n.attributes.add(g.VertexAttribute.POSITION,"vec2"),n.varyings.add("color","vec4"),n.vertex.uniforms.add("lightingMainDirection","vec3").add("cameraPosition","vec3").add("undergroundFadeAlpha",
"float"),n.vertex.code.add(c.glsl`void main(void) {
float ndotl = dot(normalize(cameraPosition), lightingMainDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),n.fragment.code.add(c.glsl`void main() {
gl_FragColor = color;
}`)):(n.include(b.Transform,{linearDepth:!1}),n.attributes.add(g.VertexAttribute.POSITION,"vec3"),n.varyings.add("vtc","vec2"),n.varyings.add("falloff","float"),l=l.geometry===a.SimpleAtmosphereGeometry.Cylinder,n.vertex.uniforms.add("proj","mat4").add("view","mat4").add("lightingMainDirection","vec3"),l||(n.varyings.add("innerFactor","float"),n.vertex.uniforms.add("silCircleCenter","vec3").add("silCircleV1","vec3").add("silCircleV2","vec3").add("texV","vec2").add("innerScale","float")),n.vertex.code.add(c.glsl`
		void main(void) {
      ${l?c.glsl`
      vec3 pos = position;
      float ndotl = lightingMainDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:c.glsl`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${c.glsl.float(.04908738515625)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), lightingMainDirection);
      vtc.x = position.x  * ${c.glsl.float(.0078125)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),n.fragment.uniforms.add("tex","sampler2D"),l||n.fragment.uniforms.add("altitudeFade","float"),n.fragment.code.add(c.glsl`
		void main() {
			vec4 atmosphereColor = texture2D(tex, vtc) * falloff;
      ${l?c.glsl`gl_FragColor = atmosphereColor;`:c.glsl`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			gl_FragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`));return n}a.SimpleAtmosphereGeometry=void 0;(function(l){l[l.Cone=0]="Cone";l[l.Cylinder=1]="Cylinder";l[l.Underground=2]="Underground";l[l.COUNT=3]="COUNT"})(a.SimpleAtmosphereGeometry||(a.SimpleAtmosphereGeometry={}));const w=Object.freeze({__proto__:null,get SimpleAtmosphereGeometry(){return a.SimpleAtmosphereGeometry},build:x});a.SimpleAtmosphereShader=w;a.build=x})},"esri/views/3d/webgl-engine/core/shaderLibrary/Transform.glsl":function(){define(["exports","../shaderModules/interfaces"],
function(a,b){a.Transform=function(c,d){d={hasModelTransformation:!1,...d};d.hasModelTransformation?d.linearDepth?c.vertex.code.add(b.glsl`vec4 transformPositionWithDepth(mat4 proj, mat4 view, mat4 model, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * (model * vec4(pos, 1.0));
depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;
return proj * eye;
}`):c.vertex.code.add(b.glsl`vec4 transformPosition(mat4 proj, mat4 view, mat4 model, vec3 pos) {
return proj * (view * (model * vec4(pos, 1.0)));
}`):d.linearDepth?c.vertex.code.add(b.glsl`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;
return proj * eye;
}`):c.vertex.code.add(b.glsl`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/SimpleAtmosphereTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../chunks/SimpleAtmosphere.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k){w=function(r){function y(){return r.apply(this,arguments)||this}c._inheritsLoose(y,r);var p=y.prototype;p.initializeProgram=function(h){const m=y.shader.get().build({geometry:this.configuration.geometry});return new f.Program(h.rctx,m,n.Default3D)};p.initializePipeline=function(){return this.configuration.geometry===g.SimpleAtmosphereGeometry.Cylinder?k.makePipelineState({blending:k.separateBlendingParams(e.BlendFactor.SRC_ALPHA,e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA,
e.BlendFactor.ONE_MINUS_SRC_ALPHA),culling:k.backFaceCullingParams,depthTest:{func:e.CompareFunction.LEQUAL},colorWrite:k.defaultColorWriteParams}):k.makePipelineState({blending:k.separateBlendingParams(e.BlendFactor.SRC_ALPHA,e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA,e.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:e.CompareFunction.LEQUAL},colorWrite:k.defaultColorWriteParams})};return y}(w.ShaderTechnique);w.shader=new x.ReloadableShaderModule(g.SimpleAtmosphereShader,()=>new Promise((r,
y)=>a(["./SimpleAtmosphere.glsl"],r,y)));x=function(r){function y(){var p=r.apply(this,arguments)||this;p.geometry=g.SimpleAtmosphereGeometry.Cone;return p}c._inheritsLoose(y,r);return y}(l.ShaderTechniqueConfiguration);d.__decorate([l.parameter({count:g.SimpleAtmosphereGeometry.COUNT})],x.prototype,"geometry",void 0);b.SimpleAtmosphereTechnique=w;b.SimpleAtmosphereTechniqueConfiguration=x;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/environment/resources/SimpleAtmosphereTexture":function(){define(function(){return"data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAABD1gYFAAAACXBIWXMAAC4jAAAuIwF4pT92AAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAXVJREFUeNq0k9GWhDAIQ3PjzP9/cuehFqhW19mz++IhkCZAq1prsqT+kSQS9g8Vnqp6VGVWkYVktR6tj3Gr968nLnfwlHzHYyHapkKS73bPd/39eI38AYWj24OGvqdwWjZ3l8IDgacXyl1Dj9tdLOzZiicj+P1YcGk0H2O2vN/VQpTveEHmPHQxZxYlqsQdhUeuCWREuDEvAjqlCqDIMYwIo2ijR1HdYUS58dQrKpgQ0EGeMocsTNXrxzyOhS9kfzlWjn82YuWLqwAnvfNEWJFjYXkJCT0s7AmS0NG4x7Lt6Cpy2MiVPBZmS668QT5AR1cevp7b6CpzQ/ZSNH0vmhy5CsNtdax0MBpXDBiFsrDiMSLKMc8b6hH93bNbEpRsIyHDUhNcfTyeKF16PC7c/2QdczvUnvOB1ylZHVFSMtd5s8C2IW/7w6hwM5GLavLCd1zkiFjB+BwH1DSgctQ7mPOimBLJrw35beSXkd8BM/cCqbXWPgMA+GQQ5sIgkfAAAAAASUVORK5CYII\x3d"})},
"esri/views/3d/support/buffer/glUtil":function(){define(["exports","../../../webgl/enums","../../../webgl/VertexElementDescriptor"],function(a,b,c){const d={u8:b.DataType.UNSIGNED_BYTE,u16:b.DataType.UNSIGNED_SHORT,u32:b.DataType.UNSIGNED_INT,i8:b.DataType.BYTE,i16:b.DataType.SHORT,i32:b.DataType.INT,f32:b.DataType.FLOAT};a.glLayout=function(g,x=0){const w=g.stride;return g.fieldNames.filter(l=>{l=g.fields.get(l).optional;return!(l&&l.glPadding)}).map(l=>{const n=g.fields.get(l),f=n.constructor.ElementCount;
var e=d[n.constructor.ElementType];if(!e)throw Error("BufferType not supported in WebGL");return new c.VertexElementDescriptor(l,f,e,n.offset,w,!(!n.optional||!n.optional.glNormalized),x)})};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/buffer/InterleavedLayout":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../geometry/support/buffer/BufferView","../../../../geometry/support/buffer/types"],function(a,b,c,d){let g=function(){function w(n,
f){this.layout=n;this.buffer="number"===typeof f?new ArrayBuffer(f*n.stride):f;for(const e of n.fieldNames)f=n.fields.get(e),this[e]=new f.constructor(this.buffer,f.offset,this.stride)}var l=w.prototype;l.getField=function(n,f){return(n=this[n])&&n.elementCount===f.ElementCount&&n.elementType===f.ElementType?n:null};l.slice=function(n,f){return new w(this.layout,this.buffer.slice(n*this.stride,f*this.stride))};l.copyFrom=function(n,f,e,k){const r=this.stride;0===r%4?(n=new Uint32Array(n.buffer,f*
r,k*r/4),(new Uint32Array(this.buffer,e*r,k*r/4)).set(n)):(n=new Uint8Array(n.buffer,f*r,k*r),(new Uint8Array(this.buffer,e*r,k*r)).set(n))};b._createClass(w,[{key:"stride",get:function(){return this.layout.stride}},{key:"count",get:function(){return this.buffer.byteLength/this.stride}},{key:"byteLength",get:function(){return this.buffer.byteLength}}]);return w}(),x=function(){function w(){this.stride=0;this.fields=new Map;this.fieldNames=[]}var l=w.prototype;l.vec2f=function(n,f){this._appendField(n,
c.BufferViewVec2f,f);return this};l.vec2f64=function(n,f){this._appendField(n,c.BufferViewVec2f64,f);return this};l.vec3f=function(n,f){this._appendField(n,c.BufferViewVec3f,f);return this};l.vec3f64=function(n,f){this._appendField(n,c.BufferViewVec3f64,f);return this};l.vec4f=function(n,f){this._appendField(n,c.BufferViewVec4f,f);return this};l.vec4f64=function(n,f){this._appendField(n,c.BufferViewVec4f64,f);return this};l.mat3f=function(n,f){this._appendField(n,c.BufferViewMat3f,f);return this};
l.mat3f64=function(n,f){this._appendField(n,c.BufferViewMat3f64,f);return this};l.mat4f=function(n,f){this._appendField(n,c.BufferViewMat4f,f);return this};l.mat4f64=function(n,f){this._appendField(n,c.BufferViewMat4f64,f);return this};l.vec4u8=function(n,f){this._appendField(n,c.BufferViewVec4u8,f);return this};l.f32=function(n,f){this._appendField(n,c.BufferViewFloat,f);return this};l.f64=function(n,f){this._appendField(n,c.BufferViewFloat64,f);return this};l.u8=function(n,f){this._appendField(n,
c.BufferViewUint8,f);return this};l.u16=function(n,f){this._appendField(n,c.BufferViewUint16,f);return this};l.i8=function(n,f){this._appendField(n,c.BufferViewInt8,f);return this};l.vec2i8=function(n,f){this._appendField(n,c.BufferViewVec2i8,f);return this};l.vec2i16=function(n,f){this._appendField(n,c.BufferViewVec2i16,f);return this};l.vec2u8=function(n,f){this._appendField(n,c.BufferViewVec2u8,f);return this};l.vec4u16=function(n,f){this._appendField(n,c.BufferViewVec4u16,f);return this};l.u32=
function(n,f){this._appendField(n,c.BufferViewUint32,f);return this};l._appendField=function(n,f,e){const k=f.ElementCount*d.elementTypeSize(f.ElementType);this.fields.set(n,{size:k,constructor:f,offset:this.stride,optional:e});this.stride+=k;this.fieldNames.push(n)};l.alignTo=function(n){this.stride=Math.floor((this.stride+n-1)/n)*n;return this};l.hasField=function(n){return 0<=this.fieldNames.indexOf(n)};l.createBuffer=function(n){return new g(this,n)};l.createView=function(n){return new g(this,
n)};l.clone=function(){const n=new w;n.stride=this.stride;n.fields=new Map;this.fields.forEach((f,e)=>n.fields.set(e,f));n.fieldNames=this.fieldNames.slice();n.BufferType=this.BufferType;return n};return w}();a.InterleavedBuffer=g;a.InterleavedLayout=x;a.newLayout=function(){return new x};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/buffer/BufferView":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ./internals/Mat3 ./internals/Mat4 ./internals/Scalar ./internals/Vec2 ./internals/Vec3 ./internals/Vec4".split(" "),
function(a,b,c,d,g,x,w,l){let n=function(N){function T(S,H=0,Q,W){S=N.call(this,Float32Array,S,H,Q,W)||this;S.elementType="f32";return S}b._inheritsLoose(T,N);T.fromTypedArray=function(S,H){return new T(S.buffer,S.byteOffset,H,S.byteOffset+S.byteLength)};return T}(g.BufferViewScalarImpl);n.ElementType="f32";let f=function(N){function T(S,H=0,Q,W){S=N.call(this,Float32Array,S,H,Q,W)||this;S.elementType="f32";return S}b._inheritsLoose(T,N);T.prototype.slice=function(S,H){return this.sliceBuffer(T,S,
H)};T.fromTypedArray=function(S,H){return new T(S.buffer,S.byteOffset,H,S.byteOffset+S.byteLength)};return T}(x.BufferViewVec2Impl);f.ElementType="f32";let e=function(N){function T(S,H=0,Q,W){S=N.call(this,Float32Array,S,H,Q,W)||this;S.elementType="f32";return S}b._inheritsLoose(T,N);T.prototype.slice=function(S,H){return this.sliceBuffer(T,S,H)};T.fromTypedArray=function(S,H){return new T(S.buffer,S.byteOffset,H,S.byteOffset+S.byteLength)};return T}(w.BufferViewVec3Impl);e.ElementType="f32";let k=
function(N){function T(S,H=0,Q,W){S=N.call(this,Float32Array,S,H,Q,W)||this;S.elementType="f32";return S}b._inheritsLoose(T,N);T.prototype.slice=function(S,H){return this.sliceBuffer(T,S,H)};T.fromTypedArray=function(S,H){return new T(S.buffer,S.byteOffset,H,S.byteOffset+S.byteLength)};return T}(l.BufferViewVec4Impl);k.ElementType="f32";let r=function(N){function T(S,H=0,Q,W){S=N.call(this,Float32Array,S,H,Q,W)||this;S.elementType="f32";return S}b._inheritsLoose(T,N);T.prototype.slice=function(S,
H){return this.sliceBuffer(T,S,H)};T.fromTypedArray=function(S,H){return new T(S.buffer,S.byteOffset,H,S.byteOffset+S.byteLength)};return T}(c.BufferViewMat3Impl);r.ElementType="f32";c=function(N){function T(S,H=0,Q,W){S=N.call(this,Float64Array,S,H,Q,W)||this;S.elementType="f64";return S}b._inheritsLoose(T,N);T.prototype.slice=function(S,H){return this.sliceBuffer(T,S,H)};T.fromTypedArray=function(S,H){return new T(S.buffer,S.byteOffset,H,S.byteOffset+S.byteLength)};return T}(c.BufferViewMat3Impl);
c.ElementType="f64";let y=function(N){function T(S,H=0,Q,W){S=N.call(this,Float32Array,S,H,Q,W)||this;S.elementType="f32";return S}b._inheritsLoose(T,N);T.prototype.slice=function(S,H){return this.sliceBuffer(T,S,H)};T.fromTypedArray=function(S,H){return new T(S.buffer,S.byteOffset,H,S.byteOffset+S.byteLength)};return T}(d.BufferViewMat4Impl);y.ElementType="f32";d=function(N){function T(S,H=0,Q,W){S=N.call(this,Float64Array,S,H,Q,W)||this;S.elementType="f64";return S}b._inheritsLoose(T,N);T.prototype.slice=
function(S,H){return this.sliceBuffer(T,S,H)};T.fromTypedArray=function(S,H){return new T(S.buffer,S.byteOffset,H,S.byteOffset+S.byteLength)};return T}(d.BufferViewMat4Impl);d.ElementType="f64";let p=function(N){function T(S,H=0,Q,W){S=N.call(this,Float64Array,S,H,Q,W)||this;S.elementType="f64";return S}b._inheritsLoose(T,N);T.prototype.slice=function(S,H){return this.sliceBuffer(T,S,H)};T.fromTypedArray=function(S,H){return new T(S.buffer,S.byteOffset,H,S.byteOffset+S.byteLength)};return T}(g.BufferViewScalarImpl);
p.ElementType="f64";let h=function(N){function T(S,H=0,Q,W){S=N.call(this,Float64Array,S,H,Q,W)||this;S.elementType="f64";return S}b._inheritsLoose(T,N);T.prototype.slice=function(S,H){return this.sliceBuffer(T,S,H)};T.fromTypedArray=function(S,H){return new T(S.buffer,S.byteOffset,H,S.byteOffset+S.byteLength)};return T}(x.BufferViewVec2Impl);h.ElementType="f64";let m=function(N){function T(S,H=0,Q,W){S=N.call(this,Float64Array,S,H,Q,W)||this;S.elementType="f64";return S}b._inheritsLoose(T,N);T.prototype.slice=
function(S,H){return this.sliceBuffer(T,S,H)};T.fromTypedArray=function(S,H){return new T(S.buffer,S.byteOffset,H,S.byteOffset+S.byteLength)};return T}(w.BufferViewVec3Impl);m.ElementType="f64";let u=function(N){function T(S,H=0,Q,W){S=N.call(this,Float64Array,S,H,Q,W)||this;S.elementType="f64";return S}b._inheritsLoose(T,N);T.prototype.slice=function(S,H){return this.sliceBuffer(T,S,H)};T.fromTypedArray=function(S,H){return new T(S.buffer,S.byteOffset,H,S.byteOffset+S.byteLength)};return T}(l.BufferViewVec4Impl);
u.ElementType="f64";let t=function(N){function T(S,H=0,Q,W){S=N.call(this,Uint8Array,S,H,Q,W)||this;S.elementType="u8";return S}b._inheritsLoose(T,N);T.prototype.slice=function(S,H){return this.sliceBuffer(T,S,H)};T.fromTypedArray=function(S,H){return new T(S.buffer,S.byteOffset,H,S.byteOffset+S.byteLength)};return T}(g.BufferViewScalarImpl);t.ElementType="u8";let q=function(N){function T(S,H=0,Q,W){S=N.call(this,Uint8Array,S,H,Q,W)||this;S.elementType="u8";return S}b._inheritsLoose(T,N);T.prototype.slice=
function(S,H){return this.sliceBuffer(T,S,H)};T.fromTypedArray=function(S,H){return new T(S.buffer,S.byteOffset,H,S.byteOffset+S.byteLength)};return T}(x.BufferViewVec2Impl);q.ElementType="u8";let z=function(N){function T(S,H=0,Q,W){S=N.call(this,Uint8Array,S,H,Q,W)||this;S.elementType="u8";return S}b._inheritsLoose(T,N);T.prototype.slice=function(S,H){return this.sliceBuffer(T,S,H)};T.fromTypedArray=function(S,H){return new T(S.buffer,S.byteOffset,H,S.byteOffset+S.byteLength)};return T}(w.BufferViewVec3Impl);
z.ElementType="u8";let v=function(N){function T(S,H=0,Q,W){S=N.call(this,Uint8Array,S,H,Q,W)||this;S.elementType="u8";return S}b._inheritsLoose(T,N);T.prototype.slice=function(S,H){return this.sliceBuffer(T,S,H)};T.fromTypedArray=function(S,H){return new T(S.buffer,S.byteOffset,H,S.byteOffset+S.byteLength)};return T}(l.BufferViewVec4Impl);v.ElementType="u8";let B=function(N){function T(S,H=0,Q,W){S=N.call(this,Uint16Array,S,H,Q,W)||this;S.elementType="u16";return S}b._inheritsLoose(T,N);T.prototype.slice=
function(S,H){return this.sliceBuffer(T,S,H)};T.fromTypedArray=function(S,H){return new T(S.buffer,S.byteOffset,H,S.byteOffset+S.byteLength)};return T}(g.BufferViewScalarImpl);B.ElementType="u16";let A=function(N){function T(S,H=0,Q,W){S=N.call(this,Uint16Array,S,H,Q,W)||this;S.elementType="u16";return S}b._inheritsLoose(T,N);T.prototype.slice=function(S,H){return this.sliceBuffer(T,S,H)};T.fromTypedArray=function(S,H){return new T(S.buffer,S.byteOffset,H,S.byteOffset+S.byteLength)};return T}(x.BufferViewVec2Impl);
A.ElementType="u16";let E=function(N){function T(S,H=0,Q,W){S=N.call(this,Uint16Array,S,H,Q,W)||this;S.elementType="u16";return S}b._inheritsLoose(T,N);T.prototype.slice=function(S,H){return this.sliceBuffer(T,S,H)};T.fromTypedArray=function(S,H){return new T(S.buffer,S.byteOffset,H,S.byteOffset+S.byteLength)};return T}(w.BufferViewVec3Impl);E.ElementType="u16";let C=function(N){function T(S,H=0,Q,W){S=N.call(this,Uint16Array,S,H,Q,W)||this;S.elementType="u16";return S}b._inheritsLoose(T,N);T.prototype.slice=
function(S,H){return this.sliceBuffer(T,S,H)};T.fromTypedArray=function(S,H){return new T(S.buffer,S.byteOffset,H,S.byteOffset+S.byteLength)};return T}(l.BufferViewVec4Impl);C.ElementType="u16";let D=function(N){function T(S,H=0,Q,W){S=N.call(this,Uint32Array,S,H,Q,W)||this;S.elementType="u32";return S}b._inheritsLoose(T,N);T.prototype.slice=function(S,H){return this.sliceBuffer(T,S,H)};T.fromTypedArray=function(S,H){return new T(S.buffer,S.byteOffset,H,S.byteOffset+S.byteLength)};return T}(g.BufferViewScalarImpl);
D.ElementType="u32";let F=function(N){function T(S,H=0,Q,W){S=N.call(this,Uint32Array,S,H,Q,W)||this;S.elementType="u32";return S}b._inheritsLoose(T,N);T.prototype.slice=function(S,H){return this.sliceBuffer(T,S,H)};T.fromTypedArray=function(S,H){return new T(S.buffer,S.byteOffset,H,S.byteOffset+S.byteLength)};return T}(x.BufferViewVec2Impl);F.ElementType="u32";let G=function(N){function T(S,H=0,Q,W){S=N.call(this,Uint32Array,S,H,Q,W)||this;S.elementType="u32";return S}b._inheritsLoose(T,N);T.prototype.slice=
function(S,H){return this.sliceBuffer(T,S,H)};T.fromTypedArray=function(S,H){return new T(S.buffer,S.byteOffset,H,S.byteOffset+S.byteLength)};return T}(w.BufferViewVec3Impl);G.ElementType="u32";let J=function(N){function T(S,H=0,Q,W){S=N.call(this,Uint32Array,S,H,Q,W)||this;S.elementType="u32";return S}b._inheritsLoose(T,N);T.prototype.slice=function(S,H){return this.sliceBuffer(T,S,H)};T.fromTypedArray=function(S,H){return new T(S.buffer,S.byteOffset,H,S.byteOffset+S.byteLength)};return T}(l.BufferViewVec4Impl);
J.ElementType="u32";let I=function(N){function T(S,H=0,Q,W){S=N.call(this,Int8Array,S,H,Q,W)||this;S.elementType="i8";return S}b._inheritsLoose(T,N);T.prototype.slice=function(S,H){return this.sliceBuffer(T,S,H)};T.fromTypedArray=function(S,H){return new T(S.buffer,S.byteOffset,H,S.byteOffset+S.byteLength)};return T}(g.BufferViewScalarImpl);I.ElementType="i8";let O=function(N){function T(S,H=0,Q,W){S=N.call(this,Int8Array,S,H,Q,W)||this;S.elementType="i8";return S}b._inheritsLoose(T,N);T.prototype.slice=
function(S,H){return this.sliceBuffer(T,S,H)};T.fromTypedArray=function(S,H){return new T(S.buffer,S.byteOffset,H,S.byteOffset+S.byteLength)};return T}(x.BufferViewVec2Impl);O.ElementType="i8";let P=function(N){function T(S,H=0,Q,W){S=N.call(this,Int8Array,S,H,Q,W)||this;S.elementType="i8";return S}b._inheritsLoose(T,N);T.prototype.slice=function(S,H){return this.sliceBuffer(T,S,H)};T.fromTypedArray=function(S,H){return new T(S.buffer,S.byteOffset,H,S.byteOffset+S.byteLength)};return T}(w.BufferViewVec3Impl);
P.ElementType="i8";let K=function(N){function T(S,H=0,Q,W){S=N.call(this,Int8Array,S,H,Q,W)||this;S.elementType="i8";return S}b._inheritsLoose(T,N);T.prototype.slice=function(S,H){return this.sliceBuffer(T,S,H)};T.fromTypedArray=function(S,H){return new T(S.buffer,S.byteOffset,H,S.byteOffset+S.byteLength)};return T}(l.BufferViewVec4Impl);K.ElementType="i8";let M=function(N){function T(S,H=0,Q,W){S=N.call(this,Int16Array,S,H,Q,W)||this;S.elementType="i16";return S}b._inheritsLoose(T,N);T.prototype.slice=
function(S,H){return this.sliceBuffer(T,S,H)};T.fromTypedArray=function(S,H){return new T(S.buffer,S.byteOffset,H,S.byteOffset+S.byteLength)};return T}(g.BufferViewScalarImpl);M.ElementType="i16";let U=function(N){function T(S,H=0,Q,W){S=N.call(this,Int16Array,S,H,Q,W)||this;S.elementType="i16";return S}b._inheritsLoose(T,N);T.prototype.slice=function(S,H){return this.sliceBuffer(T,S,H)};T.fromTypedArray=function(S,H){return new T(S.buffer,S.byteOffset,H,S.byteOffset+S.byteLength)};return T}(x.BufferViewVec2Impl);
U.ElementType="i16";let R=function(N){function T(S,H=0,Q,W){S=N.call(this,Int16Array,S,H,Q,W)||this;S.elementType="i16";return S}b._inheritsLoose(T,N);T.prototype.slice=function(S,H){return this.sliceBuffer(T,S,H)};T.fromTypedArray=function(S,H){return new T(S.buffer,S.byteOffset,H,S.byteOffset+S.byteLength)};return T}(w.BufferViewVec3Impl);R.ElementType="i16";let L=function(N){function T(S,H=0,Q,W){S=N.call(this,Int16Array,S,H,Q,W)||this;S.elementType="i16";return S}b._inheritsLoose(T,N);T.prototype.slice=
function(S,H){return this.sliceBuffer(T,S,H)};T.fromTypedArray=function(S,H){return new T(S.buffer,S.byteOffset,H,S.byteOffset+S.byteLength)};return T}(l.BufferViewVec4Impl);L.ElementType="i16";g=function(N){function T(S,H=0,Q,W){S=N.call(this,Int32Array,S,H,Q,W)||this;S.elementType="i32";return S}b._inheritsLoose(T,N);T.prototype.slice=function(S,H){return this.sliceBuffer(T,S,H)};T.fromTypedArray=function(S,H){return new T(S.buffer,S.byteOffset,H,S.byteOffset+S.byteLength)};return T}(g.BufferViewScalarImpl);
g.ElementType="i32";x=function(N){function T(S,H=0,Q,W){S=N.call(this,Int32Array,S,H,Q,W)||this;S.elementType="i32";return S}b._inheritsLoose(T,N);T.prototype.slice=function(S,H){return this.sliceBuffer(T,S,H)};T.fromTypedArray=function(S,H){return new T(S.buffer,S.byteOffset,H,S.byteOffset+S.byteLength)};return T}(x.BufferViewVec2Impl);x.ElementType="i32";w=function(N){function T(S,H=0,Q,W){S=N.call(this,Int32Array,S,H,Q,W)||this;S.elementType="i32";return S}b._inheritsLoose(T,N);T.prototype.slice=
function(S,H){return this.sliceBuffer(T,S,H)};T.fromTypedArray=function(S,H){return new T(S.buffer,S.byteOffset,H,S.byteOffset+S.byteLength)};return T}(w.BufferViewVec3Impl);w.ElementType="i32";l=function(N){function T(S,H=0,Q,W){S=N.call(this,Int32Array,S,H,Q,W)||this;S.elementType="i32";return S}b._inheritsLoose(T,N);T.prototype.slice=function(S,H){return this.sliceBuffer(T,S,H)};T.fromTypedArray=function(S,H){return new T(S.buffer,S.byteOffset,H,S.byteOffset+S.byteLength)};return T}(l.BufferViewVec4Impl);
l.ElementType="i32";a.BufferViewFloat=n;a.BufferViewFloat64=p;a.BufferViewInt16=M;a.BufferViewInt32=g;a.BufferViewInt8=I;a.BufferViewMat3f=r;a.BufferViewMat3f64=c;a.BufferViewMat4f=y;a.BufferViewMat4f64=d;a.BufferViewUint16=B;a.BufferViewUint32=D;a.BufferViewUint8=t;a.BufferViewVec2f=f;a.BufferViewVec2f64=h;a.BufferViewVec2i16=U;a.BufferViewVec2i32=x;a.BufferViewVec2i8=O;a.BufferViewVec2u16=A;a.BufferViewVec2u32=F;a.BufferViewVec2u8=q;a.BufferViewVec3f=e;a.BufferViewVec3f64=m;a.BufferViewVec3i16=
R;a.BufferViewVec3i32=w;a.BufferViewVec3i8=P;a.BufferViewVec3u16=E;a.BufferViewVec3u32=G;a.BufferViewVec3u8=z;a.BufferViewVec4f=k;a.BufferViewVec4f64=u;a.BufferViewVec4i16=L;a.BufferViewVec4i32=l;a.BufferViewVec4i8=K;a.BufferViewVec4u16=C;a.BufferViewVec4u32=J;a.BufferViewVec4u8=v;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/buffer/internals/Mat3":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function d(x,
w,l=0,n,f){this.TypedArrayConstructor=x;this.elementCount=9;x=this.TypedArrayConstructor;void 0===n&&(n=9*x.BYTES_PER_ELEMENT);const e=0===w.byteLength?0:l;this.typedBuffer=null==f?new x(w,e):new x(w,e,(f-l)/x.BYTES_PER_ELEMENT);this.typedBufferStride=n/x.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var g=d.prototype;g.sliceBuffer=function(x,w,l=this.count-w){w=this.typedBuffer.byteOffset+
w*this.stride;return new x(this.buffer,w,this.stride,w+l*this.stride)};g.getMat=function(x,w){x*=this.typedBufferStride;for(let l=0;9>l;l++)w[l]=this.typedBuffer[x++];return w};g.setMat=function(x,w){x*=this.typedBufferStride;for(let l=0;9>l;l++)this.typedBuffer[x++]=w[l]};g.get=function(x,w){return this.typedBuffer[x*this.typedBufferStride+w]};g.set=function(x,w,l){this.typedBuffer[x*this.typedBufferStride+w]=l};g.copyFrom=function(x,w,l){const n=this.typedBuffer,f=w.typedBuffer;x*=this.typedBufferStride;
w=l*w.typedBufferStride;for(l=0;9>l;++l)n[x++]=f[w++]};b._createClass(d,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return d}();c.ElementCount=9;a.BufferViewMat3Impl=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/buffer/internals/Mat4":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function d(x,w,l=0,n,f){this.TypedArrayConstructor=x;this.elementCount=16;x=this.TypedArrayConstructor;void 0===
n&&(n=16*x.BYTES_PER_ELEMENT);const e=0===w.byteLength?0:l;this.typedBuffer=null==f?new x(w,e):new x(w,e,(f-l)/x.BYTES_PER_ELEMENT);this.typedBufferStride=n/x.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var g=d.prototype;g.sliceBuffer=function(x,w,l=this.count-w){w=this.typedBuffer.byteOffset+w*this.stride;return new x(this.buffer,w,this.stride,w+l*this.stride)};g.getMat=function(x,
w){x*=this.typedBufferStride;for(let l=0;16>l;l++)w[l]=this.typedBuffer[x++];return w};g.setMat=function(x,w){x*=this.typedBufferStride;for(let l=0;16>l;l++)this.typedBuffer[x++]=w[l]};g.get=function(x,w){return this.typedBuffer[x*this.typedBufferStride+w]};g.set=function(x,w,l){this.typedBuffer[x*this.typedBufferStride+w]=l};g.copyFrom=function(x,w,l){const n=this.typedBuffer,f=w.typedBuffer;x*=this.typedBufferStride;w=l*w.typedBufferStride;for(l=0;16>l;++l)n[x++]=f[w++]};b._createClass(d,[{key:"buffer",
get:function(){return this.typedBuffer.buffer}}]);return d}();c.ElementCount=16;a.BufferViewMat4Impl=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/buffer/internals/Scalar":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function d(x,w,l=0,n,f){this.TypedArrayConstructor=x;this.elementCount=1;x=this.TypedArrayConstructor;void 0===n&&(n=x.BYTES_PER_ELEMENT);const e=0===w.byteLength?0:l;this.typedBuffer=null==
f?new x(w,e):new x(w,e,(f-l)/x.BYTES_PER_ELEMENT);this.typedBufferStride=n/x.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var g=d.prototype;g.sliceBuffer=function(x,w,l=this.count-w){w=this.typedBuffer.byteOffset+w*this.stride;return new x(this.buffer,w,this.stride,w+l*this.stride)};g.get=function(x){return this.typedBuffer[x*this.typedBufferStride]};g.set=function(x,w){this.typedBuffer[x*
this.typedBufferStride]=w};b._createClass(d,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return d}();c.ElementCount=1;a.BufferViewScalarImpl=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/buffer/internals/Vec2":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec2"],function(a,b,c){let d=function(){function g(w,l,n=0,f,e){this.TypedArrayConstructor=w;this.elementCount=2;w=this.TypedArrayConstructor;void 0===
f&&(f=2*w.BYTES_PER_ELEMENT);const k=0===l.byteLength?0:n;this.typedBuffer=null==e?new w(l,k):new w(l,k,(e-n)/w.BYTES_PER_ELEMENT);this.typedBufferStride=f/w.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var x=g.prototype;x.sliceBuffer=function(w,l,n=this.count-l){l=this.typedBuffer.byteOffset+l*this.stride;return new w(this.buffer,l,this.stride,l+n*this.stride)};x.getVec=function(w,
l){w*=this.typedBufferStride;return c.set(l,this.typedBuffer[w],this.typedBuffer[w+1])};x.setVec=function(w,l){w*=this.typedBufferStride;this.typedBuffer[w++]=l[0];this.typedBuffer[w]=l[1]};x.get=function(w,l){return this.typedBuffer[w*this.typedBufferStride+l]};x.set=function(w,l,n){this.typedBuffer[w*this.typedBufferStride+l]=n};x.setValues=function(w,l,n){w*=this.typedBufferStride;this.typedBuffer[w++]=l;this.typedBuffer[w]=n};x.copyFrom=function(w,l,n){const f=this.typedBuffer,e=l.typedBuffer;
w*=this.typedBufferStride;l=n*l.typedBufferStride;f[w++]=e[l++];f[w]=e[l]};b._createClass(g,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return g}();d.ElementCount=2;a.BufferViewVec2Impl=d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/buffer/internals/Vec3":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec3"],function(a,b,c){let d=function(){function g(w,l,n=0,f,e){this.TypedArrayConstructor=w;this.elementCount=
3;w=this.TypedArrayConstructor;void 0===f&&(f=3*w.BYTES_PER_ELEMENT);const k=0===l.byteLength?0:n;this.typedBuffer=null==e?new w(l,k):new w(l,k,(e-n)/w.BYTES_PER_ELEMENT);this.typedBufferStride=f/w.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var x=g.prototype;x.sliceBuffer=function(w,l,n=this.count-l){l=this.typedBuffer.byteOffset+l*this.stride;return new w(this.buffer,l,this.stride,
l+n*this.stride)};x.getVec=function(w,l){w*=this.typedBufferStride;return c.set(l,this.typedBuffer[w],this.typedBuffer[w+1],this.typedBuffer[w+2])};x.setVec=function(w,l){w*=this.typedBufferStride;this.typedBuffer[w++]=l[0];this.typedBuffer[w++]=l[1];this.typedBuffer[w]=l[2]};x.get=function(w,l){return this.typedBuffer[w*this.typedBufferStride+l]};x.set=function(w,l,n){this.typedBuffer[w*this.typedBufferStride+l]=n};x.setValues=function(w,l,n,f){w*=this.typedBufferStride;this.typedBuffer[w++]=l;this.typedBuffer[w++]=
n;this.typedBuffer[w]=f};x.copyFrom=function(w,l,n){const f=this.typedBuffer,e=l.typedBuffer;w*=this.typedBufferStride;l=n*l.typedBufferStride;f[w++]=e[l++];f[w++]=e[l++];f[w]=e[l]};b._createClass(g,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return g}();d.ElementCount=3;a.BufferViewVec3Impl=d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/buffer/internals/Vec4":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec4"],
function(a,b,c){let d=function(){function g(w,l,n=0,f,e){this.TypedArrayConstructor=w;this.elementCount=4;w=this.TypedArrayConstructor;void 0===f&&(f=4*w.BYTES_PER_ELEMENT);const k=0===l.byteLength?0:n;this.typedBuffer=null==e?new w(l,k):new w(l,k,(e-n)/w.BYTES_PER_ELEMENT);this.typedBufferStride=f/w.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var x=g.prototype;x.sliceBuffer=
function(w,l,n=this.count-l){l=this.typedBuffer.byteOffset+l*this.stride;return new w(this.buffer,l,this.stride,l+n*this.stride)};x.getVec=function(w,l){w*=this.typedBufferStride;return c.set(l,this.typedBuffer[w++],this.typedBuffer[w++],this.typedBuffer[w++],this.typedBuffer[w])};x.setVec=function(w,l){w*=this.typedBufferStride;this.typedBuffer[w++]=l[0];this.typedBuffer[w++]=l[1];this.typedBuffer[w++]=l[2];this.typedBuffer[w]=l[3]};x.get=function(w,l){return this.typedBuffer[w*this.typedBufferStride+
l]};x.set=function(w,l,n){this.typedBuffer[w*this.typedBufferStride+l]=n};x.setValues=function(w,l,n,f,e){w*=this.typedBufferStride;this.typedBuffer[w++]=l;this.typedBuffer[w++]=n;this.typedBuffer[w++]=f;this.typedBuffer[w]=e};x.copyFrom=function(w,l,n){const f=this.typedBuffer,e=l.typedBuffer;w*=this.typedBufferStride;l=n*l.typedBufferStride;f[w++]=e[l++];f[w++]=e[l++];f[w++]=e[l++];f[w]=e[l]};b._createClass(g,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return g}();d.ElementCount=
4;a.BufferViewVec4Impl=d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/buffer/types":function(){define(["exports","../../../core/has"],function(a,b){a.elementTypeSize=function(c){switch(c){case "u8":return 1;case "u16":return 2;case "u32":return 4;case "i8":return 1;case "i16":return 2;case "i32":return 4;case "f32":return 4;case "f64":return 8}};a.isInteger=function(c){switch(c){case "u8":case "u16":case "u32":case "i8":case "i16":case "i32":return!0;case "f32":case "f64":return!1}};
a.isSigned=function(c){switch(c){case "u8":case "u16":case "u32":return!1;case "i8":case "i16":case "i32":case "f32":case "f64":return!0}};a.maximumValue=function(c){switch(c){case "u8":return 255;case "u16":return 65535;case "u32":return 4294967295;case "i8":return 127;case "i16":return 32767;case "i32":return 2147483647;case "f32":return 3.402823E38;case "f64":return 1.79769E308}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/View.glsl":function(){define(["exports",
"../../../../../../chunks/mat4","../../../../../../chunks/mat4f32"],function(a,b,c){function d(x,w,l){b.translate(g,l,w);x.setUniform3fv("localOrigin",w);x.setUniformMatrix4fv("view",g)}const g=c.create();a.bindCameraPosition=function(x,w,l){x.setUniform3f("cameraPosition",l[3]-w[0],l[7]-w[1],l[11]-w[2])};a.bindProjectionMatrix=function(x,w){x.setUniformMatrix4fv("proj",w)};a.bindView=function(x,w){d(x,w.origin,w.camera.viewMatrix)};a.bindViewCustomOrigin=d;a.bindViewport=function(x,w){x.setUniform4fv("viewport",
w.camera.fullViewport)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/GeometryUtil":function(){define("../../../../chunks/vec3 ../../../../chunks/vec3f32 ../../../../chunks/vec3f64 ../../../../geometry/support/plane ../../../../geometry/support/ray ./basicInterfaces ./BufferVectorMath ./Geometry ./geometryDataUtils ./Util ./VertexAttribute".split(" "),function(a,b,c,d,g,x,w,l,n,f,e){const k=w.Vec3Compact;var r;(function(u){const t=[[-.5,-.5,.5],[.5,-.5,.5],[.5,
.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],q=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],z=[0,0,1,0,1,1,0,1],v=new Uint16Array([0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5]),B=new Uint16Array(36);for(var A=0;6>A;A++)for(let C=0;6>C;C++)B[6*A+C]=A;const E=new Uint16Array(36);for(A=0;6>A;A++)E[6*A]=0,E[6*A+1]=1,E[6*A+2]=2,E[6*A+3]=2,E[6*A+4]=3,E[6*A+5]=0;u.createGeometry=function(C){Array.isArray(C)||(C=[C,C,C]);const D=Array(24);for(let F=0;8>F;F++)D[3*
F]=t[F][0]*C[0],D[3*F+1]=t[F][1]*C[1],D[3*F+2]=t[F][2]*C[2];return new l.Geometry([[e.VertexAttribute.POSITION,{size:3,data:D,exclusive:!0}],[e.VertexAttribute.NORMAL,{size:3,data:q}],[e.VertexAttribute.UV0,{size:2,data:z}]],[[e.VertexAttribute.POSITION,v],[e.VertexAttribute.NORMAL,B],[e.VertexAttribute.UV0,E]])}})(r||(r={}));var y;(function(u){const t=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],q=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],z=new Uint16Array([5,
1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0]),v=new Uint16Array([0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7]);u.createGeometry=function(B){Array.isArray(B)||(B=[B,B,B]);const A=Array(18);for(let E=0;6>E;E++)A[3*E]=t[E][0]*B[0],A[3*E+1]=t[E][1]*B[1],A[3*E+2]=t[E][2]*B[2];return new l.Geometry([[e.VertexAttribute.POSITION,{size:3,data:A,exclusive:!0}],[e.VertexAttribute.NORMAL,{size:3,data:q}]],[[e.VertexAttribute.POSITION,z],[e.VertexAttribute.NORMAL,v]])}})(y||(y={}));var p;(function(u){const t=
b.fromValues(-.5,0,-.5),q=b.fromValues(.5,0,-.5),z=b.fromValues(0,0,.5),v=b.fromValues(0,.5,0),B=b.create(),A=b.create(),E=b.create(),C=b.create(),D=b.create();a.subtract(B,t,v);a.subtract(A,t,q);a.cross(E,B,A);a.normalize(E,E);a.subtract(B,q,v);a.subtract(A,q,z);a.cross(C,B,A);a.normalize(C,C);a.subtract(B,z,v);a.subtract(A,z,t);a.cross(D,B,A);a.normalize(D,D);const F=[t,q,z,v],G=[0,-1,0,E[0],E[1],E[2],C[0],C[1],C[2],D[0],D[1],D[2]],J=[0,1,2,3,1,0,3,2,1,3,0,2],I=[0,0,0,1,1,1,2,2,2,3,3,3];u.createGeometry=
function(O){Array.isArray(O)||(O=[O,O,O]);const P=Array(12);for(let K=0;4>K;K++)P[3*K]=F[K][0]*O[0],P[3*K+1]=F[K][1]*O[1],P[3*K+2]=F[K][2]*O[2];return new l.Geometry([[e.VertexAttribute.POSITION,{size:3,data:P,exclusive:!0}],[e.VertexAttribute.NORMAL,{size:3,data:G}]],[[e.VertexAttribute.POSITION,new Uint16Array(J)],[e.VertexAttribute.NORMAL,new Uint16Array(I)]])}})(p||(p={}));var h;(function(u){function t(v,B,A,E,C){if(Math.abs(a.dot(B,v))>C)return!1;a.cross(A,v,B);a.normalize(A,A);a.cross(E,A,v);
a.normalize(E,E);return!0}function q(v,B,A,E,C,D,F){return t(v,B,C,D,F)||t(v,A,C,D,F)||t(v,E,C,D,F)}u.createBoxGeometry=r.createGeometry;u.createDiamondGeometry=y.createGeometry;u.createTetrahedronGeometry=p.createGeometry;u.createSphereGeometry=function(v,B,A,E={uv:!0}){var C=-Math.PI,D=2*Math.PI,F=-Math.PI/2,G=Math.PI;B=Math.max(3,Math.floor(B));const J=Math.max(2,Math.floor(A));var I=(B+1)*(J+1);A=new Float32Array(3*I);const O=new Float32Array(3*I);I=new Float32Array(2*I);const P=[];let K=0;for(var M=
0;M<=J;M++){var U=[];const L=M/J,N=F+L*G,T=Math.cos(N);for(let S=0;S<=B;S++){const H=S/B;var R=C+H*D;const Q=Math.cos(R)*T,W=Math.sin(N);R=-Math.sin(R)*T;A[3*K]=Q*v;A[3*K+1]=W*v;A[3*K+2]=R*v;O[3*K]=Q;O[3*K+1]=W;O[3*K+2]=R;I[2*K]=H;I[2*K+1]=L;U.push(K);++K}P.push(U)}v=new Uint32Array(2*B*(J-1)*3);K=0;for(C=0;C<J;C++)for(D=0;D<B;D++)F=P[C][D],G=P[C][D+1],M=P[C+1][D+1],U=P[C+1][D],0===C?(v[K++]=F,v[K++]=M,v[K++]=U):C===J-1?(v[K++]=F,v[K++]=G,v[K++]=M):(v[K++]=F,v[K++]=G,v[K++]=M,v[K++]=M,v[K++]=U,v[K++]=
F);B=[[e.VertexAttribute.POSITION,v],[e.VertexAttribute.NORMAL,v]];A=[[e.VertexAttribute.POSITION,{size:3,data:A,exclusive:!0}],[e.VertexAttribute.NORMAL,{size:3,data:O,exclusive:!0}]];E.uv&&(A.push([e.VertexAttribute.UV0,{size:2,data:I,exclusive:!0}]),B.push([e.VertexAttribute.UV0,v]));E.offset&&(B[0][0]=e.VertexAttribute.OFFSET,A[0][0]=e.VertexAttribute.OFFSET,B.push([e.VertexAttribute.POSITION,new Uint32Array(v.length)]),A.push([e.VertexAttribute.POSITION,{size:3,data:Float64Array.from(E.offset),
exclusive:!0}]));return new l.Geometry(A,B)};u.createPolySphereGeometry=function(v,B,A){function E(G,J){G>J&&([G,J]=[J,G]);const I=G.toString()+"."+J.toString();if(F[I])return F[I];let O=C.length;C.length+=3;k.add(C,3*G,C,3*J,C,O);k.scale(C,O,v/k.length(C,O));O/=3;return F[I]=O}let C;A?(C=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],A=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1])):(A=v*(1+Math.sqrt(5))/2,C=[-v,A,0,v,A,0,-v,-A,0,v,-A,0,0,-v,A,0,v,A,0,-v,-A,0,v,-A,A,0,-v,A,0,v,-A,0,
-v,-A,0,v],A=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]));for(var D=0;D<C.length;D+=3)k.scale(C,D,v/k.length(C,D));let F={};for(D=0;D<B;D++){const G=A.length,J=new Uint32Array(4*G);for(let I=0;I<G;I+=3){const O=A[I],P=A[I+1],K=A[I+2],M=E(O,P),U=E(P,K),R=E(K,O),L=4*I;J[L]=O;J[L+1]=M;J[L+2]=R;J[L+3]=P;J[L+4]=U;J[L+5]=M;J[L+6]=K;J[L+7]=R;J[L+8]=U;J[L+9]=M;J[L+10]=U;J[L+11]=R}A=J;F={}}B=new Float32Array(C);
for(D=0;D<B.length;D+=3)k.normalize(B,D);A=[[e.VertexAttribute.POSITION,A],[e.VertexAttribute.NORMAL,A]];B=[[e.VertexAttribute.POSITION,{size:3,data:new Float32Array(C),exclusive:!0}],[e.VertexAttribute.NORMAL,{size:3,data:B,exclusive:!0}]];return new l.Geometry(B,A)};u.createPointGeometry=function(v,B,A,E,C,D,F){B=B?[B[0],B[1],B[2]]:[0,0,0];v=v?[v[0],v[1],v[2]]:[0,0,1];D=D||[0,0];A=[[e.VertexAttribute.POSITION,{size:3,data:B,exclusive:!0}],[e.VertexAttribute.NORMAL,{size:3,data:v,exclusive:!0}],
[e.VertexAttribute.UV0,{size:D.length,data:D}],[e.VertexAttribute.COLOR,{size:4,data:A?[255*A[0],255*A[1],255*A[2],3<A.length?255*A[3]:255]:[255,255,255,255],exclusive:!0}],[e.VertexAttribute.SIZE,{size:2,data:null!=E&&2===E.length?E:[1,1]}]];null!=C&&(C=new Float32Array([C[0],C[1],C[2],C[3]]),A.push([e.VertexAttribute.AUXPOS1,{size:4,data:C}]));null!=F&&(F=new Float32Array([F[0],F[1],F[2],F[3]]),A.push([e.VertexAttribute.AUXPOS2,{size:4,data:F}]));return new l.Geometry(A,null,x.PrimitiveType.Point)};
u.updatePointGeometry=function(v,B,A,E,C,D,F,G){if(null!=v){const {data:J}=G.getMutableAttribute(e.VertexAttribute.NORMAL);J[0]=v[0];J[1]=v[1];J[2]=v[2]}null!=B&&({data:v}=G.getMutableAttribute(e.VertexAttribute.POSITION),v[0]=B[0],v[1]=B[1],v[2]=B[2]);null!=A&&({data:B}=G.getMutableAttribute(e.VertexAttribute.COLOR),B[0]=A[0],B[1]=A[1],B[2]=A[2],B[3]=A[3]);null!=E&&({data:A}=G.getMutableAttribute(e.VertexAttribute.SIZE),A[0]=E[0],A[1]=E[1]);null!=C&&({data:E}=G.getMutableAttribute(e.VertexAttribute.AUXPOS1),
E[0]=C[0],E[1]=C[1],E[2]=C[2],E[3]=C[3]);null!=D&&({data:C}=G.getMutableAttribute(e.VertexAttribute.UV0),C[0]=D[0],C[1]=D[1]);null!=F&&({data:D}=G.getMutableAttribute(e.VertexAttribute.AUXPOS2),D[0]=F[0],D[1]=F[1],D[2]=F[2],D[3]=F[3])};u.createPointArrayGeometry=function(v,B){const A=new Float32Array(3*v.length),E=new Float32Array(B?3*v.length:3),C=new Uint32Array(v.length),D=new Uint32Array(v.length);for(let F=0;F<v.length;F++)A[3*F]=v[F][0],A[3*F+1]=v[F][1],A[3*F+2]=v[F][2],B&&(E[3*F]=B[F][0],E[3*
F+1]=B[F][1],E[3*F+2]=B[F][2]),C[F]=F,D[F]=0;B||(E[0]=0,E[1]=1,E[2]=0);return new l.Geometry([[e.VertexAttribute.POSITION,{size:3,data:A,exclusive:!0}],[e.VertexAttribute.NORMAL,{size:3,data:E,exclusive:!0}],[e.VertexAttribute.UV0,{size:2,data:[0,0],exclusive:!0}]],[[e.VertexAttribute.POSITION,C],[e.VertexAttribute.NORMAL,B?C:D],[e.VertexAttribute.UV0,D]],x.PrimitiveType.Point)};u.createTriangleGeometry=function(){const v=new Uint16Array([0,1,2]),B=new Uint16Array([0,0,0]),A=new Uint16Array([0,0,
0]);return new l.Geometry([[e.VertexAttribute.POSITION,{size:3,data:[0,0,0,0,0,100,100,0,0],exclusive:!0}],[e.VertexAttribute.NORMAL,{size:3,data:[0,1,0],exclusive:!0}],[e.VertexAttribute.UV0,{size:2,data:[0,0],exclusive:!0}]],[[e.VertexAttribute.POSITION,v],[e.VertexAttribute.NORMAL,B],[e.VertexAttribute.UV0,A]])};const z=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];u.createSquareGeometry=function(v=z){const B=Array(12);for(var A=0;4>A;A++)for(let E=0;3>E;E++)B[3*A+E]=v[A][E];v=new Uint32Array([0,1,2,2,
3,0]);A=new Uint32Array([0,0,0,0,0,0]);return new l.Geometry([[e.VertexAttribute.POSITION,{size:3,data:B,exclusive:!0}],[e.VertexAttribute.NORMAL,{size:3,data:[0,0,1],exclusive:!0}],[e.VertexAttribute.UV0,{size:2,data:[0,0,1,0,1,1,0,1],exclusive:!0}],[e.VertexAttribute.COLOR,{size:4,data:[255,255,255,255],exclusive:!0}]],[[e.VertexAttribute.POSITION,v],[e.VertexAttribute.NORMAL,A],[e.VertexAttribute.UV0,v],[e.VertexAttribute.COLOR,A]])};u.createConeGeometry=function(v,B,A,E,C=!0,D=!0){var F=0,G=b.fromValues(0,
F,0),J=b.fromValues(0,F+v,0),I=b.fromValues(0,-1,0),O=b.fromValues(0,1,0);E&&(F=v,J=b.fromValues(0,0,0),G=b.fromValues(0,F,0),I=b.fromValues(0,1,0),O=b.fromValues(0,-1,0));G=[J,G];I=[I,O];O=A+2;J=Math.sqrt(v*v+B*B);if(E)for(E=A-1;0<=E;E--){var P=2*Math.PI/A*E,K=b.fromValues(Math.cos(P)*B,F,Math.sin(P)*B);G.push(K);P=b.fromValues(v*Math.cos(P)/J,-B/J,v*Math.sin(P)/J);I.push(P)}else for(E=0;E<A;E++)P=2*Math.PI/A*E,K=b.fromValues(Math.cos(P)*B,F,Math.sin(P)*B),G.push(K),P=b.fromValues(v*Math.cos(P)/
J,B/J,v*Math.sin(P)/J),I.push(P);v=new Uint32Array(6*(A+2));A=new Uint32Array(6*(A+2));F=B=0;if(C){for(C=3;C<G.length;C++)v[B++]=1,v[B++]=C-1,v[B++]=C,A[F++]=0,A[F++]=0,A[F++]=0;v[B++]=G.length-1;v[B++]=2;v[B++]=1;A[F++]=0;A[F++]=0;A[F++]=0}if(D){for(D=3;D<G.length;D++)v[B++]=D,v[B++]=D-1,v[B++]=0,A[F++]=D,A[F++]=D-1,A[F++]=1;v[B++]=0;v[B++]=2;v[B++]=G.length-1;A[F++]=1;A[F++]=2;A[F++]=I.length-1}D=new Float32Array(3*O);for(C=0;C<O;C++)D[3*C]=G[C][0],D[3*C+1]=G[C][1],D[3*C+2]=G[C][2];G=new Float32Array(3*
O);for(C=0;C<O;C++)G[3*C]=I[C][0],G[3*C+1]=I[C][1],G[3*C+2]=I[C][2];return new l.Geometry([[e.VertexAttribute.POSITION,{size:3,data:D,exclusive:!0}],[e.VertexAttribute.NORMAL,{size:3,data:G,exclusive:!0}]],[[e.VertexAttribute.POSITION,v],[e.VertexAttribute.NORMAL,A]])};u.createCylinderGeometry=function(v,B,A,E,C,D){E=E?b.clone(E):b.fromValues(1,0,0);C=C?b.clone(C):b.fromValues(0,0,0);D=null==D?!0:D;var F=b.create();a.normalize(F,E);const G=b.create();a.scale(G,F,Math.abs(v));const J=b.create();a.scale(J,
G,-.5);a.add(J,J,C);const I=b.fromValues(0,1,0);.2>Math.abs(1-a.dot(F,I))&&a.set(I,0,0,1);const O=b.create();a.cross(O,F,I);a.normalize(O,O);a.cross(I,O,F);v=2*A+(D?2:0);C=A+(D?2:0);E=new Float32Array(3*v);const P=new Float32Array(3*C),K=new Float32Array(2*v),M=new Uint32Array(3*A*(D?4:2)),U=new Uint32Array(3*A*(D?4:2));D&&(E[3*(v-2)]=J[0],E[3*(v-2)+1]=J[1],E[3*(v-2)+2]=J[2],K[2*(v-2)]=0,K[2*(v-2)+1]=0,E[3*(v-1)]=E[3*(v-2)]+G[0],E[3*(v-1)+1]=E[3*(v-2)+1]+G[1],E[3*(v-1)+2]=E[3*(v-2)+2]+G[2],K[2*(v-
1)]=1,K[2*(v-1)+1]=1,P[3*(C-2)]=-F[0],P[3*(C-2)+1]=-F[1],P[3*(C-2)+2]=-F[2],P[3*(C-1)]=F[0],P[3*(C-1)+1]=F[1],P[3*(C-1)+2]=F[2]);F=function(S,H,Q){M[S]=H;U[S]=Q};let R=0;const L=b.create(),N=b.create();for(let S=0;S<A;S++){var T=2*Math.PI/A*S;a.scale(L,I,Math.sin(T));a.scale(N,O,Math.cos(T));a.add(L,L,N);P[3*S]=L[0];P[3*S+1]=L[1];P[3*S+2]=L[2];a.scale(L,L,B);a.add(L,L,J);E[3*S]=L[0];E[3*S+1]=L[1];E[3*S+2]=L[2];K[2*S]=S/A;K[2*S+1]=0;E[3*(S+A)]=E[3*S]+G[0];E[3*(S+A)+1]=E[3*S+1]+G[1];E[3*(S+A)+2]=E[3*
S+2]+G[2];K[2*(S+A)]=S/A;K[2*S+1]=1;T=(S+1)%A;F(R++,S,S);F(R++,S+A,S);F(R++,T,T);F(R++,T,T);F(R++,S+A,S);F(R++,T+A,T)}if(D){for(B=0;B<A;B++)D=(B+1)%A,F(R++,v-2,C-2),F(R++,B,C-2),F(R++,D,C-2);for(B=0;B<A;B++)D=(B+1)%A,F(R++,B+A,C-1),F(R++,v-1,C-1),F(R++,D+A,C-1)}return new l.Geometry([[e.VertexAttribute.POSITION,{size:3,data:E,exclusive:!0}],[e.VertexAttribute.NORMAL,{size:3,data:P,exclusive:!0}],[e.VertexAttribute.UV0,{size:2,data:K,exclusive:!0}]],[[e.VertexAttribute.POSITION,M],[e.VertexAttribute.NORMAL,
U],[e.VertexAttribute.UV0,M]])};u.createTubeGeometry=function(v,B,A,E,C){A=A||10;E=null!=E?E:!0;f.assert(1<v.length);const D=[],F=[];for(let G=0;G<A;G++){D.push([0,-G-1,-((G+1)%A)-1]);const J=G/A*2*Math.PI;F.push([Math.cos(J)*B,Math.sin(J)*B])}return u.createPathExtrusionGeometry(F,v,[[0,0,0]],D,E,C)};u.createPathExtrusionGeometry=function(v,B,A,E,C,D=b.fromValues(0,0,0)){var F=v.length;const G=new Float32Array(B.length*F*3+(6*A.length||0)),J=new Float32Array(B.length*F*3+(A?6:0));var I=(B.length-
1)*F*6+6*E.length;const O=new Uint32Array(I);I=new Uint32Array(I);let P=0;var K=0;let M=0,U=0;const R=b.create(),L=b.create(),N=b.create(),T=b.create(),S=b.create(),H=b.create(),Q=b.create(),W=c.create(),V=b.create(),Y=b.create(),aa=b.create(),X=b.create(),ba=b.create(),ha=d.create();a.set(V,0,1,0);a.subtract(L,B[1],B[0]);a.normalize(L,L);C?(a.add(W,B[0],D),a.normalize(N,W)):a.set(N,0,0,1);q(L,N,V,V,S,N,.99619469809);a.copy(T,N);a.copy(X,S);for(var ka=0;ka<A.length;ka++)a.scale(H,S,A[ka][0]),a.scale(W,
N,A[ka][2]),a.add(H,H,W),a.add(H,H,B[0]),G[P++]=H[0],G[P++]=H[1],G[P++]=H[2];J[K++]=-L[0];J[K++]=-L[1];J[K++]=-L[2];for(ka=0;ka<E.length;ka++)O[M++]=0<E[ka][0]?E[ka][0]:-E[ka][0]-1+A.length,O[M++]=0<E[ka][1]?E[ka][1]:-E[ka][1]-1+A.length,O[M++]=0<E[ka][2]?E[ka][2]:-E[ka][2]-1+A.length,I[U++]=0,I[U++]=0,I[U++]=0;ka=A.length;const ia=A.length-1;for(let ca=0;ca<B.length;ca++){let Z=!1;0<ca&&(a.copy(R,L),ca<B.length-1?(a.subtract(L,B[ca+1],B[ca]),a.normalize(L,L)):Z=!0,a.add(Y,R,L),a.normalize(Y,Y),a.add(aa,
B[ca-1],T),d.fromPositionAndNormal(B[ca],Y,ha),d.intersectRay(ha,g.wrap(aa,R),W)?(a.subtract(W,W,B[ca]),a.normalize(N,W),a.cross(S,Y,N),a.normalize(S,S)):q(Y,T,X,V,S,N,.99619469809),a.copy(T,N),a.copy(X,S));C&&(a.add(W,B[ca],D),a.normalize(ba,W));for(let fa=0;fa<F;fa++)if(a.scale(H,S,v[fa][0]),a.scale(W,N,v[fa][1]),a.add(H,H,W),a.normalize(Q,H),J[K++]=Q[0],J[K++]=Q[1],J[K++]=Q[2],a.add(H,H,B[ca]),G[P++]=H[0],G[P++]=H[1],G[P++]=H[2],!Z){var ea=(fa+1)%F;O[M++]=ka+fa;O[M++]=ka+F+fa;O[M++]=ka+ea;O[M++]=
ka+ea;O[M++]=ka+F+fa;O[M++]=ka+F+ea;for(ea=0;6>ea;ea++)I[U++]=O[M-6+ea]-ia}ka+=F}v=B[B.length-1];for(B=0;B<A.length;B++)a.scale(H,S,A[B][0]),a.scale(W,N,A[B][1]),a.add(H,H,W),a.add(H,H,v),G[P++]=H[0],G[P++]=H[1],G[P++]=H[2];A=K/3;J[K++]=L[0];J[K++]=L[1];J[K++]=L[2];F=ka-F;for(K=0;K<E.length;K++)O[M++]=0<=E[K][0]?ka+E[K][0]:-E[K][0]-1+F,O[M++]=0<=E[K][2]?ka+E[K][2]:-E[K][2]-1+F,O[M++]=0<=E[K][1]?ka+E[K][1]:-E[K][1]-1+F,I[U++]=A,I[U++]=A,I[U++]=A;return new l.Geometry([[e.VertexAttribute.POSITION,{size:3,
data:G,exclusive:!0}],[e.VertexAttribute.NORMAL,{size:3,data:J,exclusive:!0}]],[[e.VertexAttribute.POSITION,O],[e.VertexAttribute.NORMAL,I]])};u.createPolylineGeometry=function(v,B,A){f.assert(1<v.length,"createPolylineGeometry(): polyline needs at least 2 points");f.assert(3===v[0].length,"createPolylineGeometry(): malformed vertex");f.assert(null==B||B.length===v.length,"createPolylineGeometry: need same number of points and normals");f.assert(null==B||3===B[0].length,"createPolylineGeometry(): malformed normal");
var E=new Float64Array(3*v.length);const C=new Uint32Array(2*(v.length-1));var D=0,F=0;for(var G=0;G<v.length;G++){for(var J=0;3>J;J++)E[D++]=v[G][J];0<G&&(C[F++]=G-1,C[F++]=G)}D=[];F=[];D.push([e.VertexAttribute.POSITION,C]);F.push([e.VertexAttribute.POSITION,{size:3,data:E,exclusive:!0}]);if(B){E=new Float32Array(3*B.length);G=0;for(J=0;J<v.length;J++)for(let I=0;3>I;I++)E[G++]=B[J][I];D.push([e.VertexAttribute.NORMAL,C]);F.push([e.VertexAttribute.NORMAL,{size:3,data:E,exclusive:!0}])}A&&(F.push([e.VertexAttribute.COLOR,
{size:4,data:A}]),D.push([e.VertexAttribute.COLOR,n.generateDefaultIndexArray(A.length/4)]));return new l.Geometry(F,D,x.PrimitiveType.Line)};u.createExtrudedTriangle=function(v,B,A,E,C=0){const D=Array(18);v=[[-B,C,E/2],[A,C,E/2],[0,v+C,E/2],[-B,C,-E/2],[A,C,-E/2],[0,v+C,-E/2]];B=new Uint16Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]);for(A=0;6>A;A++)D[3*A]=v[A][0],D[3*A+1]=v[A][1],D[3*A+2]=v[A][2];return new l.Geometry([[e.VertexAttribute.POSITION,{size:3,data:D,exclusive:!0}]],[[e.VertexAttribute.POSITION,
B]])};u.transformInPlace=function(v,B){v=v.getMutableAttribute(e.VertexAttribute.POSITION).data;for(let A=0;A<v.length;A+=3)a.set(m,v[A],v[A+1],v[A+2]),a.transformMat4(m,m,B),v[A]=m[0],v[A+1]=m[1],v[A+2]=m[2]};u.cgToGIS=function(v,B=v){var A=v.vertexAttributes;v=A.get(e.VertexAttribute.POSITION).data;if(A=A.get(e.VertexAttribute.NORMAL).data){var E=B.getMutableAttribute(e.VertexAttribute.NORMAL).data;for(var C=0;C<A.length;C+=3){const D=A[C+1];E[C+1]=-A[C+2];E[C+2]=D}}if(v)for(A=B.getMutableAttribute(e.VertexAttribute.POSITION).data,
E=0;E<v.length;E+=3)C=v[E+1],A[E+1]=-v[E+2],A[E+2]=C;return B};u.makeOrthoBasisDirUp=t;u.makeOrthoBasisDirUpFallback=q})(h||(h={}));const m=b.create();return h})},"esri/views/3d/webgl-engine/lib/BufferVectorMath":function(){define(["exports"],function(a){a.Vec3Compact=void 0;(function(b){b.length=function(c,d){const g=c[d],x=c[d+1];c=c[d+2];return Math.sqrt(g*g+x*x+c*c)};b.normalize=function(c,d){var g=c[d];const x=c[d+1],w=c[d+2];g=1/Math.sqrt(g*g+x*x+w*w);c[d]*=g;c[d+1]*=g;c[d+2]*=g};b.scale=function(c,
d,g){c[d]*=g;c[d+1]*=g;c[d+2]*=g};b.add=function(c,d,g,x,w,l=d){w=w||c;w[l]=c[d]+g[x];w[l+1]=c[d+1]+g[x+1];w[l+2]=c[d+2]+g[x+2]};b.subtract=function(c,d,g,x,w,l=d){w=w||c;w[l]=c[d]-g[x];w[l+1]=c[d+1]-g[x+1];w[l+2]=c[d+2]-g[x+2]}})(a.Vec3Compact||(a.Vec3Compact={}));Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Geometry":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ./basicInterfaces ./BoundingInfo ./ContentObject ./ContentObjectType ./geometryDataUtils ./Util ./VertexAttribute".split(" "),
function(a,b,c,d,g,x,w,l,n,f){function e(k){if(k.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT)return k;for(const r of k)if(65536<=r)return k;return new Uint16Array(k)}x=function(k){function r(p,h=[],m=d.PrimitiveType.Triangle,u=-1){var t=k.call(this)||this;t._primitiveType=m;t.edgeIndicesLength=u;t.type=w.ContentObjectType.Geometry;t._vertexAttributes=new Map;t._indices=new Map;t._boundingInfo=null;for(const [q,z]of p)z&&t._vertexAttributes.set(q,{...z});if(null==h||0===h.length){p=t._vertexAttributes.values().next().value;
p=null==p?0:p.data.length/p.size;h=l.generateDefaultIndexArray(p);t.edgeIndicesLength=0>t.edgeIndicesLength?p:t.edgeIndicesLength;for(const q of t._vertexAttributes.keys())t._indices.set(q,h)}else for(const [q,z]of h)z&&(t._indices.set(q,e(z)),q===f.VertexAttribute.POSITION&&(t.edgeIndicesLength=0>t.edgeIndicesLength?t._indices.get(q).length:t.edgeIndicesLength));return t}b._inheritsLoose(r,k);var y=r.prototype;y.cloneShallow=function(){const p=new r([],void 0,this._primitiveType,void 0),{_vertexAttributes:h,
_indices:m}=p;this._vertexAttributes.forEach((u,t)=>{h.set(t,u)});this._indices.forEach((u,t)=>{m.set(t,u)});p.screenToWorldRatio=this.screenToWorldRatio;p._boundingInfo=this._boundingInfo;return p};y.getMutableAttribute=function(p){(p=this._vertexAttributes.get(p))&&!p.exclusive&&(p.data=Array.from(p.data),p.exclusive=!0);return p};y.computeAttachmentOrigin=function(p){return this.primitiveType===d.PrimitiveType.Triangle?this._computeAttachmentOriginTriangles(p):this._computeAttachmentOriginPoints(p)};
y._computeAttachmentOriginTriangles=function(p){const h=this.indices.get(f.VertexAttribute.POSITION),m=this.vertexAttributes.get(f.VertexAttribute.POSITION);return l.computeAttachmentOriginTriangles(m,h,p)};y._computeAttachmentOriginPoints=function(p){const h=this.indices.get(f.VertexAttribute.POSITION),m=this.vertexAttributes.get(f.VertexAttribute.POSITION);return l.computeAttachmentOriginPoints(m,h,p)};y.invalidateBoundingInfo=function(){this._boundingInfo=null};y._calculateBoundingInfo=function(){const p=
this.indices.get(f.VertexAttribute.POSITION);if(0===p.length)return null;const h=this.primitiveType===d.PrimitiveType.Triangle?3:1;n.assert(0===p.length%h,"Indexing error: "+p.length+" not divisible by "+h);const m=l.generateDefaultIndexArray(p.length/h),u=this.vertexAttributes.get(f.VertexAttribute.POSITION);return new g.BoundingInfo(m,h,p,u)};b._createClass(r,[{key:"vertexAttributes",get:function(){return this._vertexAttributes}},{key:"indices",get:function(){return this._indices}},{key:"indexCount",
get:function(){const p=this._indices.values().next().value;return p?p.length:0}},{key:"primitiveType",get:function(){return this._primitiveType}},{key:"faceCount",get:function(){return this.indexCount/3}},{key:"boundingInfo",get:function(){c.isNone(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo());return this._boundingInfo}}]);return r}(x.ContentObject);a.Geometry=x;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/BoundingInfo":function(){define(["exports",
"../../../../core/PooledArray","../../../../chunks/vec3","../../../../chunks/vec3f64","./Util"],function(a,b,c,d,g){let x=function(){function l(f,e,k,r){this.primitiveIndices=f;this._numIndexPerPrimitive=e;this.indices=k;this.position=r;this.center=d.create();g.assert(1<=f.length);g.assert(0===k.length%this._numIndexPerPrimitive);g.assert(k.length>=f.length*this._numIndexPerPrimitive);g.assert(3===r.size||4===r.size);const {data:y,size:p}=r;r=f.length;e=p*k[this._numIndexPerPrimitive*f[0]];w.clear();
w.push(e);this.bbMin=d.fromValues(y[e],y[e+1],y[e+2]);this.bbMax=d.clone(this.bbMin);for(var h=0;h<r;++h){var m=this._numIndexPerPrimitive*f[h];for(var u=0;u<this._numIndexPerPrimitive;++u){e=p*k[m+u];w.push(e);let t=y[e];this.bbMin[0]=Math.min(t,this.bbMin[0]);this.bbMax[0]=Math.max(t,this.bbMax[0]);t=y[e+1];this.bbMin[1]=Math.min(t,this.bbMin[1]);this.bbMax[1]=Math.max(t,this.bbMax[1]);t=y[e+2];this.bbMin[2]=Math.min(t,this.bbMin[2]);this.bbMax[2]=Math.max(t,this.bbMax[2])}}c.lerp(this.center,this.bbMin,
this.bbMax,.5);this.radius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);f=this.radius*this.radius;for(k=0;k<w.length;++k)e=w.getItemAt(k),r=y[e]-this.center[0],h=y[e+1]-this.center[1],e=y[e+2]-this.center[2],m=r*r+h*h+e*e,m<=f||(m=Math.sqrt(m),u=.5*(m-this.radius),this.radius+=u,f=this.radius*this.radius,m=u/m,this.center[0]+=r*m,this.center[1]+=h*m,this.center[2]+=e*m);w.clear()}var n=l.prototype;n.getCenter=function(){return this.center};
n.getBSRadius=function(){return this.radius};n.getBBMin=function(){return this.bbMin};n.getBBMax=function(){return this.bbMax};n.getChildren=function(){if(this._children)return this._children;if(1<c.squaredDistance(this.bbMin,this.bbMax)){var f=c.lerp(d.create(),this.bbMin,this.bbMax,.5),e=this.primitiveIndices.length;const p=new Uint8Array(e),h=Array(8);for(var k=0;8>k;++k)h[k]=0;const {data:m,size:u}=this.position;for(k=0;k<e;++k){var r=0;const t=this._numIndexPerPrimitive*this.primitiveIndices[k];
var y=u*this.indices[t];let q=m[y],z=m[y+1],v=m[y+2];for(let B=1;B<this._numIndexPerPrimitive;++B){y=u*this.indices[t+B];const A=m[y],E=m[y+1];y=m[y+2];A<q&&(q=A);E<z&&(z=E);y<v&&(v=y)}q<f[0]&&(r|=1);z<f[1]&&(r|=2);v<f[2]&&(r|=4);p[k]=r;++h[r]}f=0;for(k=0;8>k;++k)0<h[k]&&++f;if(2>f)return;f=Array(8);for(k=0;8>k;++k)f[k]=0<h[k]?new Uint32Array(h[k]):void 0;for(k=0;8>k;++k)h[k]=0;for(k=0;k<e;++k)r=p[k],f[r][h[r]++]=this.primitiveIndices[k];this._children=Array(8);for(e=0;8>e;++e)void 0!==f[e]&&(this._children[e]=
new l(f[e],this._numIndexPerPrimitive,this.indices,this.position))}return this._children};l.prune=function(){w.prune()};return l}();const w=new b({deallocator:null});a.BoundingInfo=x;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/ContentObject":function(){define(["exports","../../../../core/uid"],function(a,b){let c=function(){function d(){this.id=b.generateUID()}d.prototype.unload=function(){};return d}();a.ContentObject=c;Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/views/3d/webgl-engine/lib/ContentObjectType":function(){define(["exports"],function(a){a.ContentObjectType=void 0;var b=a.ContentObjectType||(a.ContentObjectType={});b[b.Layer=0]="Layer";b[b.Object=1]="Object";b[b.Geometry=2]="Geometry";b[b.Material=3]="Material";b[b.Texture=4]="Texture";b[b.COUNT=5]="COUNT";Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/geometryDataUtils":function(){define(["exports","../../../../chunks/vec3","../../../../chunks/vec3f64",
"../../../../geometry/support/triangle"],function(a,b,c,d){let g=(()=>{const k=new Uint32Array(131072);for(let r=0;r<k.length;++r)k[r]=r;return k})();const x=new Uint16Array([0]),w=(()=>{const k=new Uint16Array(65536);for(let r=0;r<k.length;++r)k[r]=r;return k})(),l=c.create(),n=c.create(),f=c.create(),e=c.create();a.computeAttachmentOriginLines=function(k,r,y,p){if(!k)return!1;const {size:h,data:m}=k;b.set(p,0,0,0);b.set(e,0,0,0);let u=k=0;const t=r?r.length-1:m.length/h-1;y=t+(y?2:0);for(let v=
0;v<y;v+=2){var q=v<t?v:t,z=v<t?v+1:0;q=(r?r[q]:q)*h;z=(r?r[z]:z)*h;l[0]=m[q+0];l[1]=m[q+1];l[2]=m[q+2];n[0]=m[z+0];n[1]=m[z+1];n[2]=m[z+2];b.scale(l,b.add(l,l,n),.5);z=b.dist(l,n);0<z?(b.add(p,p,b.scale(l,l,z)),k+=z):(b.add(e,e,l),u++)}return 0!==k?(b.scale(p,p,1/k),!0):0!==u?(b.scale(p,e,1/u),!0):!1};a.computeAttachmentOriginPoints=function(k,r,y){if(!k||!r)return!1;const {size:p,data:h}=k;b.set(y,0,0,0);k=-1;let m=0;for(let u=0;u<r.length;u++){const t=r[u]*p;k!==t&&(y[0]+=h[t+0],y[1]+=h[t+1],y[2]+=
h[t+2],m++);k=t}1<m&&b.scale(y,y,1/m);return 0<m};a.computeAttachmentOriginTriangles=function(k,r,y){if(!k)return!1;const {size:p,data:h}=k;b.set(y,0,0,0);b.set(e,0,0,0);let m=k=0;for(let t=0;t<r.length-2;t+=3){var u=r[t+0]*p;const q=r[t+1]*p,z=r[t+2]*p;b.set(l,h[u+0],h[u+1],h[u+2]);b.set(n,h[q+0],h[q+1],h[q+2]);b.set(f,h[z+0],h[z+1],h[z+2]);(u=d.areaPoints3d(l,n,f))?(b.add(l,l,n),b.add(l,l,f),b.scale(l,l,1/3*u),b.add(y,y,l),k+=u):(b.add(e,e,l),b.add(e,e,n),b.add(e,e,f),m+=3)}return 0===m&&0===k?
!1:0!==k?(b.scale(y,y,1/k),!0):0!==m?(b.scale(y,e,1/m),!0):!1};a.generateDefaultIndexArray=function(k){if(1===k)return x;if(k<w.length)return new Uint16Array(w.buffer,0,k);if(k>g.length){g=new Uint32Array(Math.max(2*g.length,k));for(let r=0;r<g.length;r++)g[r]=r}return new Uint32Array(g.buffer,0,k)};a.generateIndexArray=function(k){if(1===k)return new Uint16Array(x);if(k<w.length)return new Uint16Array(w.slice(0,k));if(k>g.length){k=new Uint32Array(k);for(let r=0;r<k.length;r++)k[r]=r;return k}return new Uint32Array(g.slice(0,
k))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/triangle":function(){define("exports ../../core/ObjectStack ../../chunks/vec2 ../../chunks/vec3 ../../chunks/vec3f64 ./lineSegment ./vectorStacks".split(" "),function(a,b,c,d,g,x,w){function l(p){return p?{p0:g.clone(p.p0),p1:g.clone(p.p1),p2:g.clone(p.p2)}:{p0:g.create(),p1:g.create(),p2:g.create()}}function n(p,h,m,u=l()){d.copy(u.p0,p);d.copy(u.p1,h);d.copy(u.p2,m);return u}function f(p,h,m){var u=c.distance(p,h);h=
c.distance(h,m);p=c.distance(m,p);m=(u+h+p)/2;u=m*(m-u)*(m-h)*(m-p);return 0>=u?0:Math.sqrt(u)}const e=new b.ObjectStack(x.create),k=new b.ObjectStack(()=>({p0:null,p1:null,p2:null})),r=g.create(),y=g.create();a.area2d=function(p){return f(p.p0,p.p1,p.p2)};a.areaPoints2d=f;a.areaPoints3d=function(p,h,m){d.subtract(r,h,p);d.subtract(y,m,p);return d.length(d.cross(r,r,y))/2};a.copy=function(p,h=l()){return n(p.p0,p.p1,p.p2,h)};a.create=l;a.distance2=function(p,h){var m=p.p0,u=p.p1;p=p.p2;const t=d.subtract(w.sv3d.get(),
u,m),q=d.subtract(w.sv3d.get(),p,u),z=d.subtract(w.sv3d.get(),m,p),v=d.subtract(w.sv3d.get(),h,m);var B=d.subtract(w.sv3d.get(),h,u),A=d.subtract(w.sv3d.get(),h,p);const E=d.cross(t,t,z),C=d.dot(d.cross(w.sv3d.get(),t,E),v);B=d.dot(d.cross(w.sv3d.get(),q,E),B);A=d.dot(d.cross(w.sv3d.get(),z,E),A);if(0<C&&0<B&&0<A)return h=d.dot(E,v),h*h/d.dot(E,E);m=x.distance2(x.fromValues(m,t,e.get()),h);u=x.distance2(x.fromValues(u,q,e.get()),h);h=x.distance2(x.fromValues(p,z,e.get()),h);return Math.min(m,u,h)};
a.fromValues=n;a.intersectRay=function(p,h,m){const {direction:u,origin:t}=h,{p0:q,p1:z,p2:v}=p;var B=z[0]-q[0],A=z[1]-q[1],E=z[2]-q[2];p=v[0]-q[0];h=v[1]-q[1];const C=v[2]-q[2];var D=u[1]*C-h*u[2],F=u[2]*p-C*u[0];const G=u[0]*h-p*u[1];var J=B*D+A*F+E*G;if(-1E-5<J&&1E-5>J)return!1;J=1/J;const I=t[0]-q[0],O=t[1]-q[1],P=t[2]-q[2];D=J*(I*D+O*F+P*G);if(0>D||1<D)return!1;F=O*E-A*P;E=P*B-E*I;B=I*A-B*O;A=J*(u[0]*F+u[1]*E+u[2]*B);if(0>A||1<D+A)return!1;m&&(d.scale(m,u,J*(p*F+h*E+C*B)),d.add(m,t,m));return!0};
a.wrap=function(p,h,m){const u=k.get();u.p0=p;u.p1=h;u.p2=m;return u};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/Precipitation":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/maybe ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f32 ../../../chunks/vec3f64 ../../../geometry/projectionEllipsoid ../../../chunks/Precipitation.glsl ./PrecipitationTechnique ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/core/shaderLibrary/util/View.glsl ../webgl-engine/lib/AnimationTimer ../webgl-engine/lib/VertexAttribute ../../support/WatchUpdatingTracking ../../webgl/BufferObject ../../webgl/enums ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E,C,D){a.Precipitation=function(J){function I(P){var K=J.call(this,P)||this;K._numParticles=25E4;K._rainSpeed=.1;K._snowSpeed=.01;K._opacity=1;K._width=500;K._offset=y.create();K._tile=y.create();K._particleColor=r.create();K._particleColorAtNight=r.create();K._nightMultiplier=.7;K._cameraDirection=r.create();K._renderParameters={camera:null,time:0,radius:1};K._animation=new z.AnimationTimer;K._updatingTracking=new B.WatchUpdatingTracking;K._renderParameters.time=
0;K._renderParameters.radius=p.getReferenceEllipsoid(P.view.spatialReference).radius;K._shaderTechniqueRepository=P.context.shaderTechniqueRepository;return K}b._inheritsLoose(I,J);var O=I.prototype;O.destroy=function(){this._updatingTracking.destroy();this._numParticles=0;this._snowTechnique=g.releaseMaybe(this._snowTechnique);this._rainTechnique=g.releaseMaybe(this._rainTechnique);this._vao=g.disposeMaybe(this._vao);this._instanceIdBuffer=g.disposeMaybe(this._instanceIdBuffer)};O.update=function(P){return this._animation.advance(P)};
O.render=function(P,K,M){const {rctx:U,camera:R}=P;this._ensureResources(U);var L=M===h.PrecipitationType.RAIN?this.rainTechnique:this.snowTechnique;g.isNone(L)||g.isNone(this._vao)||g.isNone(this._instanceIdBuffer)||(g.isSome(P.cloudsCompositionParams)&&(this._opacity=1-P.cloudsCompositionParams.fadeInOutHeight.factor),0>=this._opacity||(L=U.useTechnique(L),this._renderParameters.camera=R,this._renderParameters.time=(M===h.PrecipitationType.RAIN?this._rainSpeed:this._snowSpeed)*x.secondsFromMilliseconds(this._animation.time),
this._update(L,R,M,P),U.bindVAO(this._vao),P=m.PrecipitationTechnique.attributeLocation,L.assertCompatibleVertexAttributeLocations(this._vao),C.bindVertexBufferLayout(U,P,this._instanceIdBuffer,G,0),U.capabilities.instancing.drawArraysInstanced(E.PrimitiveType.TRIANGLES,0,3,this._numParticles*K),C.unbindVertexBufferLayout(U,P,this._instanceIdBuffer,G)))};O._update=function(P,K,M,U){const R=K.eye;this._tile[0]=Math.floor((R[0]+.5*this._width)/this._width);this._tile[1]=Math.floor((R[1]+.5*this._width)/
this._width);this._tile[2]=Math.floor((R[2]+.5*this._width)/this._width);this._offset[0]=R[0]-this._tile[0]*this._width;this._offset[1]=R[1]-this._tile[1]*this._width;this._offset[2]=R[2]-this._tile[2]*this._width;P.setUniform1f("width",this._width);P.setUniform3fv("offset",this._offset);P.setUniformMatrix4fv("view",K.viewMatrix);P.setUniform3fv("cameraPosition",R);q.bindProjectionMatrix(P,K.projectionMatrix);P.setUniform1f("time",this._renderParameters.time);M===h.PrecipitationType.RAIN?k.set(this._particleColor,
.85,.85,.85):k.set(this._particleColor,1,1,1);k.scale(this._particleColorAtNight,this._particleColor,this._nightMultiplier);k.normalize(this._cameraDirection,R);K=Math.max(0,k.dot(this._cameraDirection,U.scenelightingData.lightingMainDirection));k.lerp(this._particleColor,this._particleColorAtNight,this._particleColor,K);P.setUniform3fv("particleColor",this._particleColor);P.setUniform1f("opacity",this._opacity)};O._ensureResources=function(P){g.isSome(this._vao)||(this._vao=this._createVertexArrayObject(P),
g.isSome(this._instanceIdBuffer)||(this._instanceIdBuffer=this._createInstanceIndices(P)))};O._createInstanceIndices=function(P){const K=[];for(let M=0;M<this._numParticles;M++)K.push(M);return A.BufferObject.createVertex(P,E.Usage.STATIC_DRAW,new Float32Array(K))};O._createVertexArrayObject=function(P){const K=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new D.VertexArrayObject(P,m.PrecipitationTechnique.attributeLocation,{geometry:u.glLayout(F)},{geometry:A.BufferObject.createVertex(P,E.Usage.STATIC_DRAW,
K)})};b._createClass(I,[{key:"updating",get:function(){return this._updatingTracking.updating}},{key:"rainTechnique",get:function(){if(g.isNone(this._rainTechnique)){const P=new m.PrecipitationTechniqueConfiguration;P.type=h.PrecipitationType.RAIN;this._rainTechnique=this._shaderTechniqueRepository.acquire(m.PrecipitationTechnique,P)}return this._rainTechnique}},{key:"snowTechnique",get:function(){if(g.isNone(this._snowTechnique)){const P=new m.PrecipitationTechniqueConfiguration;P.type=h.PrecipitationType.SNOW;
this._snowTechnique=this._shaderTechniqueRepository.acquire(m.PrecipitationTechnique,P)}return this._snowTechnique}}]);return I}(d);c.__decorate([w.property({constructOnly:!0})],a.Precipitation.prototype,"context",void 0);c.__decorate([w.property({constructOnly:!0})],a.Precipitation.prototype,"view",void 0);c.__decorate([w.property({readOnly:!0})],a.Precipitation.prototype,"updating",null);c.__decorate([w.property()],a.Precipitation.prototype,"_updatingTracking",void 0);a.Precipitation=c.__decorate([e.subclass("esri.views.3d.environment.Precipitation")],
a.Precipitation);const F=t.newLayout().vec3f(v.VertexAttribute.POSITION),G=u.glLayout(t.newLayout().f32(v.VertexAttribute.INSTANCEFEATUREATTRIBUTE),1);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/Precipitation.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/lib/VertexAttribute"],function(a,b,c,d){function g(w){const l=new c.ShaderBuilder;l.attributes.add(d.VertexAttribute.POSITION,
"vec3");l.attributes.add(d.VertexAttribute.INSTANCEFEATUREATTRIBUTE,"float");l.vertex.uniforms.add("cameraPosition","vec3").add("offset","vec3").add("width","float").add("proj","mat4").add("view","mat4").add("time","float");l.varyings.add("vUv","vec2");l.vertex.code.add(b.glsl`
    //https://www.shadertoy.com/view/4djSRW
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${w.type===a.PrecipitationType.RAIN?b.glsl`

            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:b.glsl`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `);l.fragment.uniforms.add("opacity","float").add("particleColor","vec3");l.fragment.code.add(b.glsl`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${w.type===a.PrecipitationType.RAIN?b.glsl`d = 0.5 * smoothstep(0.5, 0.0, d);`:b.glsl`d = smoothstep(0.5, 0.1, d);`}
      gl_FragColor = opacity * vec4(particleColor * d, d);
    }
  `);return l}a.PrecipitationType=void 0;(function(w){w[w.RAIN=0]="RAIN";w[w.SNOW=1]="SNOW"})(a.PrecipitationType||(a.PrecipitationType={}));const x=Object.freeze({__proto__:null,get PrecipitationType(){return a.PrecipitationType},build:g});a.PrecipitationShader=x;a.build=g})},"esri/views/3d/environment/PrecipitationTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../chunks/Precipitation.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/Program ../webgl-engine/lib/VertexAttribute ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k){w=function(r){function y(){return r.apply(this,arguments)||this}c._inheritsLoose(y,r);var p=y.prototype;p.initializeProgram=function(h){const m=y.shader.get().build({type:this.configuration.type});return new n.Program(h.rctx,m,y.attributeLocation)};p.initializePipeline=function(){return k.makePipelineState({blending:k.separateBlendingParams(e.BlendFactor.ONE,e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA,e.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:e.CompareFunction.LEQUAL},
colorWrite:k.defaultColorWriteParams})};return y}(w.ShaderTechnique);w.shader=new x.ReloadableShaderModule(g.PrecipitationShader,()=>new Promise((r,y)=>a(["./Precipitation.glsl"],r,y)));w.attributeLocation=new Map([[f.VertexAttribute.POSITION,0],[f.VertexAttribute.INSTANCEFEATUREATTRIBUTE,1]]);x=function(r){function y(){var p=r.apply(this,arguments)||this;p.type=g.PrecipitationType.RAIN;return p}c._inheritsLoose(y,r);return y}(l.ShaderTechniqueConfiguration);d.__decorate([l.parameter()],x.prototype,
"type",void 0);b.PrecipitationTechnique=w;b.PrecipitationTechniqueConfiguration=x;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/AnimationTimer":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/time"],function(a,b,c,d){let g=function(){function x(){this.enabled=!0;this._time=0}x.prototype.advance=function(w){if(c.isSome(w.forcedTime)){if(this._time===w.forcedTime)return!1;this._time=w.forcedTime;
return!0}return this.enabled&&0!==w.dt?(this._time+=w.dt,!0):!1};b._createClass(x,[{key:"time",get:function(){return d.Milliseconds(this._time)}}]);return x}();a.AnimationTimer=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/SimpleAtmosphere":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../core/Logger ../../../core/mathUtils ../../../core/maybe ../../../core/promiseUtils ../../../core/watchUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projectionEllipsoid ../../../geometry/support/spatialReferenceUtils ../../../support/requestImageUtils ./atmosphereUtils ../../../chunks/SimpleAtmosphere.glsl ./SimpleAtmosphereTechnique ./resources/MarsAtmosphereTexture ./resources/SimpleAtmosphereTexture ../support/mathUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/Util ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums ../../webgl/Texture ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E,C,D,F,G,J,I,O){function P(S,H,Q,W,V){const Y=e.length(S),aa=W*Math.sqrt(Y*Y-W*W)/Y,X=V.silCircleV1,ba=V.silCircleV2;e.scale(V.silCircleCenter,S,Math.sqrt(W*W-aa*aa)/Y);e.cross(X,S,H);1>e.squaredLength(X)&&e.cross(X,S,Q);e.scale(X,X,aa/e.length(X));e.cross(ba,X,S);e.scale(ba,ba,aa/e.length(ba));return aa}const K=b.getLogger("esri.views.3d.environment.SimpleAtmosphere"),M=-h.innerAtmosphereDepth,U=z.makePiecewiseLinearFunction([[50,.1015625],
[500,.21875],[5E3,.51171875],[5E4,.4140625]]);b=function(){function S(Q){this.view=Q;this.type="simple";this._renderData={texV:f.create(),silCircleCenter:k.create(),silCircleV1:k.create(),silCircleV2:k.create(),altitudeFade:0,innerScale:0,undergroundFadeAlpha:0};this._texture=null;this._fadeVaoCount=0;this._readyResolver=g.createResolver();this._readyController=new AbortController;this.texV1=1;this.canRender=!0;this.isOnMars=y.isMars(Q.spatialReference);Q=r.getReferenceEllipsoid(Q.spatialReference);
this.planetRadius=Q.radius;this.outerRimWidth=Q.outerAtmosphereRimWidth;this.innerRimFactor=(this.planetRadius+M)/this.planetRadius;this.middleRimFactor=(this.planetRadius+0)/this.planetRadius;this.outerRimFactor=(this.planetRadius+this.outerRimWidth)/this.planetRadius;this.texV0=0/this.outerRimWidth;this.texVScale=this.texV1-this.texV0}var H=S.prototype;H.destroy=function(){this._readyResolver.reject();this._cameraChangeHandle=d.removeMaybe(this._cameraChangeHandle);this._texture=d.disposeMaybe(this._texture);
this._fadeVao=d.disposeMaybe(this._fadeVao);this._vao=d.disposeMaybe(this._vao);this._readyController=d.abortMaybe(this._readyController)};H.when=function(){return this._readyResolver.promise};H.initializeRenderContext=function(){var Q=a._asyncToGenerator(function*(W){this._shaderTechniqueRepository=W.shaderTechniqueRepository;const V=W.renderContext.rctx;this._cameraChangeHandle=x.init(this.view,"state.camera",()=>W.requestRender(),!0);this._vao=this._createRibbon(V);this._vaoCount=I.vertexCount(this._vao,
"geometry");this._fadeVao=E.createQuadVAO(V);this._fadeVaoCount=I.vertexCount(this._fadeVao,"geometry");const Y=this.isOnMars?t:q,aa=this._readyController.signal;try{const X=yield p.requestImage(Y,{signal:aa});g.throwIfAborted(aa);this._texture=new J.Texture(V,{pixelFormat:G.PixelFormat.RGBA,dataType:G.PixelType.UNSIGNED_BYTE,wrapMode:G.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:G.TextureSamplingMode.LINEAR,flipped:!0},X);W.requestRender();this._readyController=null;this._readyResolver.resolve()}catch(X){g.isAbortError(X)||
K.error("Unable to initialize simple atmosphere: image request failed",X),this._readyResolver.reject(X)}});return function(W){return Q.apply(this,arguments)}}();H.render=function(Q){this._update(Q.camera);const W=Q.rctx;if(1>this._renderData.undergroundFadeAlpha){var V=W.useTechnique(this.coneTechnique);V.setUniformMatrix4fv("proj",Q.camera.projectionMatrix);V.setUniformMatrix4fv("view",Q.camera.viewMatrix);V.setUniform3fv("silCircleCenter",this._renderData.silCircleCenter);V.setUniform3fv("silCircleV1",
this._renderData.silCircleV1);V.setUniform3fv("silCircleV2",this._renderData.silCircleV2);V.setUniform2fv("texV",this._renderData.texV);V.bindTexture(this._texture,"tex");Q.scenelightingData.setLightDirectionUniform(V);V.setUniform1f("altitudeFade",this._renderData.altitudeFade);V.setUniform1f("innerScale",this._renderData.innerScale);W.bindVAO(this._vao);W.drawArrays(G.PrimitiveType.TRIANGLES,0,this._vaoCount)}0<this._renderData.undergroundFadeAlpha&&(V=W.useTechnique(this.undergroundTechnique),
V.setUniform1f("undergroundFadeAlpha",this._renderData.undergroundFadeAlpha),Q.scenelightingData.setLightDirectionUniform(V),V.setUniform3fv("cameraPosition",Q.camera.eye),W.bindVAO(this._fadeVao),W.drawArrays(G.PrimitiveType.TRIANGLE_STRIP,0,this._fadeVaoCount))};H.renderHaze=function(){return!1};H._update=function(Q){var W=k.create();const V=this.planetRadius;var Y=e.length(Q.eye);const aa=Y-V;this._renderData.undergroundFadeAlpha=0>aa?Math.min(-aa/5E3,1):0;var X=V+M,ba=V+Math.max(50,aa);this._renderData.innerScale=
ba*ba/(Math.sqrt(ba*ba-V*V)*Math.sqrt(ba*ba-X*X)+V*X)-1;this._renderData.altitudeFade=h.computeInnerAltitudeFade(aa);e.scale(W,Q.eye,(V+50)/Y);P(W,Q.center,Q.up,V,this._renderData);W=this._computeScreenRimWidth(Q,W,Q.up,this._renderData);Y=U(aa);X=this.texV0+.001953125*this.texVScale;ba=this.texV0+W*Y*this.texVScale;50<aa&&(P(Q.eye,Q.center,Q.up,V,this._renderData),Q=this._computeScreenRimWidth(Q,Q.eye,Q.up,this._renderData),Q=c.clamp((Q-1.5)/(W-1.5),0,1),X=this.texV0+.001953125*Q*this.texVScale,
ba=this.texV0+c.lerp(this.texV1,W*Y,Q)*this.texVScale);n.set(this._renderData.texV,X,ba)};H._createRibbon=function(Q){const W=new Float32Array(1155),V=new Uint32Array(1920);W[0]=0;W[1]=0;W[2]=-1;for(var Y=0;128>Y;Y++){var aa=9*Y+3;W[aa+0]=Y;W[aa+1]=this.innerRimFactor;W[aa+2]=-1;W[aa+3]=Y;W[aa+4]=this.middleRimFactor;W[aa+5]=0;W[aa+6]=Y;W[aa+7]=this.outerRimFactor;W[aa+8]=1;aa=3*Y+1;var X=127===Y?1:aa+3,ba=15*Y;V[ba+0]=aa;V[ba+1]=aa+1;V[ba+2]=X+1;V[ba+3]=X+1;V[ba+4]=X;V[ba+5]=aa;V[ba+6]=aa+1;V[ba+
7]=aa+2;V[ba+8]=X+2;V[ba+9]=X+2;V[ba+10]=X+1;V[ba+11]=aa+1;V[ba+12]=aa;V[ba+13]=X;V[ba+14]=0}Y=T.createBuffer(V.length);aa=Y.position;for(X=0;X<V.length;++X)ba=3*V[X],aa.set(X,0,W[ba]),aa.set(X,1,W[ba+1]),aa.set(X,2,W[ba+2]);return new O.VertexArrayObject(Q,A.Default3D,{geometry:v.glLayout(T)},{geometry:F.BufferObject.createVertex(Q,G.Usage.STATIC_DRAW,Y.buffer)})};H._computeScreenRimWidth=function(Q,W,V,Y){e.add(L,Y.silCircleCenter,Y.silCircleV2);e.scale(N,L,this.outerRimFactor);w.lookAt(R,W,L,V);
C.project(L,R,Q.projectionMatrix,Q.viewport);C.project(N,R,Q.projectionMatrix,Q.viewport);return e.distance(L,N)/Q.height};a._createClass(S,[{key:"coneTechnique",get:function(){if(d.isNone(this._coneTechnique)){const Q=new u.SimpleAtmosphereTechniqueConfiguration;Q.geometry=m.SimpleAtmosphereGeometry.Cone;this._coneTechnique=this._shaderTechniqueRepository.acquire(u.SimpleAtmosphereTechnique,Q)}return this._coneTechnique}},{key:"undergroundTechnique",get:function(){if(d.isNone(this._undergroundTechnique)){const Q=
new u.SimpleAtmosphereTechniqueConfiguration;Q.geometry=m.SimpleAtmosphereGeometry.Underground;this._undergroundTechnique=this._shaderTechniqueRepository.acquire(u.SimpleAtmosphereTechnique,Q)}return this._undergroundTechnique}}]);return S}();const R=l.create(),L=k.create(),N=k.create(),T=B.newLayout().vec3f(D.VertexAttribute.POSITION);return b})},"esri/views/3d/environment/resources/MarsAtmosphereTexture":function(){define(function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAAE00TaTAAAACXBIWXMAAA7AAAAOwAFq1okJAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAp1JREFUSMd9lcmSEzEQRCtflnqxYZgIThBDAP//kXDQ0pJtuDhqycxWZ5fKERFCERARIAVEyCjCtSFFEjWVa9q7OdJE0oiidIhKhRBROlhloiGVhaYERQHJWFEwMpYKrjUlibI2cqSJIJEpKNmM2c3GkRTOJDnThTMpnMWu0VFszs3Jfbe5bza3w+a229yOIs6zmP3czfn1K2w/for8+EVU15pNmmyqkeJyclinXNJRu1xrUaJmjmdzJiejVNt7zZVBRAIq1RwrsrrWnez+SR7WmQQP/1itKz2q/pmzuJtYnNy2bth9x9z2NLfDcB7FHOcGx6ebOb9/iPzxG/ztg4iorglFiKjzF9HSNphCoRb1OY3RZQJrYgRdT68bmgXGDdBzrTG8qNS7QP/m19ef7tGlcoH7vESYkK70uoPuOLEetz0IqeGoWQW6MlB/j36EnipYGKPWwDRg/RkNhXCNJIzAhMk6PrDePJNII6JHqM5VWqYApCtNFPe0GFFGtOWopWCrEVBSoiQi06KkRRaD08IlxXa/ifz8Jvz2LvjyLnh7F/r8Rei8a8xfjNkIrpmMOQ1C02COrkTEHxGhh+6DQJfXc/eZprXxcIyVIf1LJVgWvKaHvwI/1aQxtv851SQ/nqGXL6MHFVY3nmhLyqKsWO/+qzWif+yS1TpNKq8NezjGPCV69ciZoQj1PwfN6QRpWyCGVMe1D/AAHt3/gefu1Ign3AVpjOiNXkN90JlpL6TUnzFEUU+Jvks0tkp/dY3Fy1TzI24BWwsYJPyg11Q0FqDwK72xIz2kLojbeuxS1FpgtfNWyMX1gFw0j3W7RNeSHTVEe3VaV7SdCzVywFaEt02w7QH7Eeg4AvZDNdJ+Cu1HENsutO+Byi6ilEBZ9BeCNBJceJIjHgAAAABJRU5ErkJggg\x3d\x3d"})},
"esri/views/3d/environment/Stars":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../assets ../../../core/Accessor ../../../core/Error ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4 ../../../chunks/mat4f64 ./StarsTechnique ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/VertexAttribute ../../support/WatchUpdatingTracking ../../webgl/BufferObject ../../webgl/enums ../../webgl/VertexArrayObject".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E,C){const D=w.getLogger("esri.views.3d.environment.Stars");a.Stars=function(P){function K(U){U=P.call(this,U)||this;U._loadDataTask=null;U._numPoints=0;U._renderParameter={camera:null,modelMatrix:m.create()};U._updatingTracking=new B.WatchUpdatingTracking;return U}b._inheritsLoose(K,P);var M=K.prototype;M.initialize=function(){this._loadDataTask=this._createLoadDataTask()};M.destroy=function(){this._loadDataTask=l.abortMaybe(this._loadDataTask);
this._updatingTracking.destroy();this._numPoints=0;this._technique=l.releaseMaybe(this._technique);this._vao=l.disposeMaybe(this._vao)};M.render=function(U){const {rctx:R,camera:L}=U;this._ensureResources(R);l.isNone(this._technique)||l.isNone(this._vao)||(U=R.useTechnique(this._technique),this._renderParameter.camera=L,this._technique.bindPass(this._renderParameter),R.bindVAO(this._vao),U.assertCompatibleVertexAttributeLocations(this._vao),R.drawArrays(E.PrimitiveType.POINTS,0,this._numPoints))};
M._ensureResources=function(U){if(!l.isSome(this._technique)&&!l.isNone(O)){this._technique=new u.StarsTechnique({rctx:U,viewingMode:this.view.state.viewingMode});this._numPoints=O.byteLength/9;var R=new Float32Array(O,0,2*this._numPoints),L=new Uint8Array(O,8*this._numPoints,this._numPoints);this._vao=this._createVertexArrayObject(U,R,L,this._numPoints);this._updatingTracking.add(()=>{var N;return null==(N=this.view)?void 0:N.environment.lighting.date},N=>this._update(N),f.initial)}};M._computeDayDuration=
function(U){const R=new Date(U.getFullYear(),0,1,11,58,56),L=new Date(U.getFullYear()+1,0,1,11,58,55);return(+U-+R)/(+L-+R)};M._update=function(U){if(U){var R=U.getHours()/12,L=U.getMinutes()/60*(2/24),N=U.getSeconds()/60*(2/1440);R=(R+L+N-.9972222)%2;U=2*this._computeDayDuration(U);L=this._renderParameter.modelMatrix;h.copy(L,J);h.rotateZ(L,L,-U*Math.PI);h.multiply(L,G,L);h.rotateZ(L,L,-R*Math.PI);this.requestRender()}};M._hexToRGB=function(U){return[parseInt(U.substring(0,2),16),parseInt(U.substring(2,
4),16),parseInt(U.substring(4,6),16)]};M._unpackUint8Attributes=function(U){return 192<=U?[2.9,U-192]:160<=U?[2.5,U-160]:128<=U?[2,U-128]:96<=U?[1.5,U-96]:64<=U?[1,U-64]:32<=U?[.7,U-32]:[.4,U]};M._createVertexArrayObject=function(U,R,L,N){const T=I.createBuffer(N),S=T.position,H=T.color,Q=T.size;for(let Y=0;Y<N;Y++){var W=R[2*Y],V=R[2*Y+1];S.set(Y,0,-Math.cos(W)*Math.sin(V));S.set(Y,1,-Math.sin(W)*Math.sin(V));S.set(Y,2,-Math.cos(V));W=this._unpackUint8Attributes(L[Y]);V=this._hexToRGB(F[W[1]]);H.set(Y,
0,255*V[0]);H.set(Y,1,255*V[1]);H.set(Y,2,255*V[2]);H.set(Y,3,255);Q.set(Y,W[0])}return new C.VertexArrayObject(U,z.Default3D,{geometry:t.glLayout(I)},{geometry:A.BufferObject.createVertex(U,E.Usage.STATIC_DRAW,T.buffer)})};M._createLoadDataTask=function(){var U=this;if(l.isSome(O))return null;const R=n.createTask(function(){var L=b._asyncToGenerator(function*(N){({data:N}=yield d.fetchAsset("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:N}));U._verifyStarData(N);
O=N});return function(N){return L.apply(this,arguments)}}());R.promise.catch(L=>{n.isAbortError(L)||D.error(L)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))});return R};M._verifyStarData=function(U){if(!U)throw new x("stars:no-data-received","Failed to create stars because star catalogue is missing");U=U.byteLength/9;if(0!==U%1||5E4<U||5E3>U)throw new x("stars:invalid-data","Failed to create stars because star catalogue data is invalid");};b._createClass(K,[{key:"updating",
get:function(){return this._updatingTracking.updating||this.loading}},{key:"loading",get:function(){return l.isSome(this._loadDataTask)&&!this._loadDataTask.finished}}]);return K}(g);c.__decorate([e.property({constructOnly:!0})],a.Stars.prototype,"view",void 0);c.__decorate([e.property({constructOnly:!0})],a.Stars.prototype,"requestRender",void 0);c.__decorate([e.property({readOnly:!0})],a.Stars.prototype,"updating",null);c.__decorate([e.property()],a.Stars.prototype,"_loadDataTask",void 0);c.__decorate([e.property()],
a.Stars.prototype,"_updatingTracking",void 0);a.Stars=c.__decorate([p.subclass("esri.views.3d.environment.Stars")],a.Stars);const F="9bb2ff;9eb5ff;aabfff;bbccff;ccd8ff ;dae2ff;e4e9ff;eeefff;f8f6ff;fff9fb;fff5ef;fff1e5;ffeddb;ffe9d2;ffe6ca;ffe3c3;ffe0bb;ffddb4;ffdaad;ffd6a5;ffd29c;ffcc8f;ffc178;ffa94b;ff7b00".split(";"),G=m.fromValues(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),J=m.fromValues(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,
0,.39778850739794974,.9174771405229186,0,0,0,0,1),I=q.newLayout().vec3f(v.VertexAttribute.POSITION).vec4u8(v.VertexAttribute.COLOR).f32(v.VertexAttribute.SIZE);let O=null;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/StarsTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/Stars.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k){l=function(y){function p(m){var u;return u=y.call(this,m,null,()=>u.destroy())||this}c._inheritsLoose(p,y);var h=p.prototype;h.initializeProgram=function(m){const u=p.shader.get().build();return new f.Program(m.rctx,u,n.Default3D)};h.initializePipeline=function(){return k.makePipelineState({blending:k.separateBlendingParams(e.BlendFactor.SRC_ALPHA,e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA,e.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:e.CompareFunction.LEQUAL},
colorWrite:k.defaultColorWriteParams})};h.bindPass=function(m){const u=this._makeInfiniteProjectionMatrix(m.camera.projectionMatrix,m.camera.near,r);d.multiply(u,u,m.camera.viewMatrix);d.multiply(u,u,m.modelMatrix);this.program.setUniformMatrix4fv("transform",u);this.program.setUniform4fv("viewport",m.camera.fullViewport);this.program.setUniform1f("pixelRatio",m.camera.pixelRatio)};h._makeInfiniteProjectionMatrix=function(m,u,t){d.copy(t,m);t[10]=2.4E-7-1;t[11]=-1;t[14]=(2.4E-7-2)*u;return t};return p}(l.ShaderTechnique);
l.shader=new w.ReloadableShaderModule(x.StarsShader,()=>new Promise((y,p)=>a(["./Stars.glsl"],y,p)));const r=g.create();b.StarsTechnique=l;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/Stars.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/lib/VertexAttribute"],function(a,b,c,d,g){function x(){const l=
new d.ShaderBuilder;l.attributes.add(g.VertexAttribute.POSITION,"vec3");l.attributes.add(g.VertexAttribute.COLOR,"vec4");l.attributes.add(g.VertexAttribute.SIZE,"float");l.varyings.add("vcolor","vec4");l.varyings.add("vsize","float");l.vertex.uniforms.add("transform","mat4").add("viewport","vec4").add("pixelRatio","float");l.include(b.AlignPixel);l.vertex.code.add(c.glsl`void main(void) {
vec4 posProj = transform * vec4(position, 0);
gl_Position = alignToPixelCenter(posProj, viewport.zw);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`);l.fragment.code.add(c.glsl`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
gl_FragColor = vec4(vcolor.xyz, intensity);
}`);return l}const w=Object.freeze({__proto__:null,build:x});a.StarsShader=w;a.build=x})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.AlignPixel=function(c){const d=b.glsl`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`,g=b.glsl`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`;c.vertex.code.add(d);c.vertex.code.add(g);c.fragment.code.add(d);c.fragment.code.add(g)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/sunUtils":function(){define("exports ../../../core/mathUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../ViewingMode ../../../chunks/SunCalc".split(" "),function(a,b,c,d,g,x,w,l){function n(q,z,v,B){const A=h,E=c.identity(p);if(v===w.ViewingMode.Global)l.SunCalc.getPosition(q,0,0,A),
g.set(B,0,0,-1),c.rotateX(E,E,-A.azimuth),c.rotateY(E,E,-A.altitude);else{var C=r.planarDirection;v=C.globalAngles;C=(Math.abs(z[2])-C.localAltitude)/(C.globalAltitude-C.localAltitude);C=b.clamp(C,0,1);1>C?(l.SunCalc.getPosition(q,z[1],z[0],A),A.azimuth=(1-C)*A.azimuth+C*v.azimuth,A.altitude=(1-C)*A.altitude+C*v.altitude):(A.azimuth=v.azimuth,A.altitude=v.altitude);g.set(B,0,-1,0);c.rotateZ(E,E,-A.azimuth);c.rotateX(E,E,-A.altitude)}g.transformMat4(B,B,E)}function f(q){switch(q){case "disabled":case "sunny":return{direct:1,
ambient:1};case "cloudy":return{direct:1,ambient:1};case "rainy":return{direct:.4,ambient:1.2};case "snowy":return{direct:.5,ambient:1.3};case "foggy":return{direct:.2,ambient:1.6}}}function e(q,z){const v=(q[0]+q[1]+q[2])/3;for(let B=0;3>B;B++)q[B]+=(v-q[B])*z;return q}function k(q,z,v,B){const A=[];for(let E=0;E<v.length;E++)A[E]=(B[E]-v[E])*q/z+v[E];return A}const r={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8E5,
ambient:.015,direct:.75},planarDirection:{localAltitude:1E4,globalAltitude:1E6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}},y=x.fromValues(.5773502691896258,-.5773502691896258,.5773502691896258),p=d.create(),h={azimuth:0,altitude:0},m=new Date(0),u=d.create(),t=x.create();a.ColorAndIntensity=function(){this.ambient={color:x.fromValues(1,1,1),intensity:.55};this.direct={color:x.fromValues(1,1,1),intensity:.55,directionToLightSource:x.clone(y)};this.noonFactor=.5;this.globalFactor=0;this.environmentStrength=
this.specularStrength=1};a.computeColorAndIntensity=function(q,z,v,B,A,E,C){g.set(C.ambient.color,1,1,1);C.ambient.intensity=r.global.ambient;g.set(C.direct.color,1,1,1);C.direct.intensity=r.global.direct;var D=b.clamp((Math.abs(z[2])-r.local.altitude)/(r.global.altitude-r.local.altitude),0,1);C.globalFactor=D;var F;"sun"===E&&(F=l.SunCalc.getTimes(q,z[1],z[0]));if(1>D){if("sun"===E){{var G=F;var J=q.valueOf();if(G.polarException===l.SunCalc.PolarException.MIDNIGHT_SUN){var I=J-36E5*(q.getHours()+
48)-6E4*q.getMinutes();var O=I+432E6}else G.polarException===l.SunCalc.PolarException.POLAR_NIGHT?(I=J-2,O=J-1):(I=G.sunrise.valueOf(),O=G.sunset.valueOf());var P=O-I;G=I+P/2;var K=P/4;var M=G-K;K=G+K;var U=.06*P;P=I-U/2;I+=U/2;const L=O-U/2,N=O+U/2;O=r.local;U=[.01,O.ambientAtNight];const T=[.8,.8,1],S=[.01,.01,.01],H=[O.directAtTwilight,O.ambientAtTwilight],Q=[1,.6,.5],W=[.8,.8,1],V=[.9*O.directAtNoon,O.ambientAtNoon],Y=[1,.98,.98],aa=[.98,.98,1],X=[O.directAtNoon,O.ambientAtNoon],ba=[1,1,1],ha=
[1,1,1];O=[0,0];let ka=[0,0,0];var R=[0,0,0];J<P||J>N?(O=U,ka=S,R=T):J<I?(R=I-P,O=k(J-P,R,U,H),ka=k(J-P,R,S,Q),R=k(J-P,R,T,W)):J<M?(R=M-I,O=k(J-I,R,H,V),ka=k(J-I,R,Q,Y),R=k(J-I,R,W,aa)):J<G?(R=G-M,O=k(J-M,R,V,X),ka=k(J-M,R,Y,ba),R=k(J-M,R,aa,ha)):J<K?(R=K-G,O=k(J-G,R,X,V),ka=k(J-G,R,ba,Y),R=k(J-G,R,ha,aa)):J<L?(R=L-K,O=k(J-K,R,V,H),ka=k(J-K,R,Y,Q),R=k(J-K,R,aa,W)):J<N&&(R=N-L,O=k(J-L,R,H,U),ka=k(J-L,R,Q,S),R=k(J-L,R,W,T));J=0;switch(B){case "rainy":case "foggy":J=.9;case "snowy":J=.5}0<J&&(ka=e(ka,
J),R=e(R,J));G=x.fromValues(ka[0],ka[1],ka[2]);M=x.fromValues(R[0],R[1],R[2]);K=f(B);J=O[0]*K.direct;O=O[1]*K.ambient}}else M=f(B),J=r.local.directAtNoon*M.direct,G=x.fromValues(1,1,1),O=r.local.ambientAtNoon*M.ambient,M=x.fromValues(1,1,1);g.lerp(C.ambient.color,M,C.ambient.color,D);C.ambient.intensity=b.lerp(O,C.ambient.intensity,D);g.lerp(C.direct.color,G,C.direct.color,D);C.direct.intensity=b.lerp(J,C.direct.intensity,D);C.specularStrength="rainy"===B||"snowy"===B||"foggy"===B?0:1;C.environmentStrength=
"rainy"===B?.7:"snowy"===B||"foggy"===B?.75:1}"sun"===E?(B=q.valueOf(),F.polarException===l.SunCalc.PolarException.MIDNIGHT_SUN?(D=B-36E5*(q.getHours()+48)-6E4*q.getMinutes(),F=D+432E6):F.polarException===l.SunCalc.PolarException.POLAR_NIGHT?(D=B-2,F=B-1):(D=F.sunrise.valueOf(),F=F.sunset.valueOf()),B=1-b.clamp(Math.abs(B-(D+(F-D)/2))/432E5,0,1)):B=1;C.noonFactor=B;"sun"===E?n(q,z,v,C.direct.directionToLightSource):(q=C.direct.directionToLightSource,v===w.ViewingMode.Global?g.normalize(t,A.eye):g.set(t,
0,0,1),c.fromRotation(u,.35,A.viewRight),g.transformMat4(q,t,u),c.fromRotation(u,-.5,t),g.transformMat4(q,q,u))};a.computeDirectionsOverTime=function(q,z,v,B,A){q=q.getTime();z=z.getTime()-q;z=Math.floor(z/v)+1;const E=Array(z);for(let C=0;C<z;++C)m.setTime(q+v*C),E[C]=x.create(),n(m,B,A,E[C]);return E};a.computeShadowsEnabled=function(q,z){return z===w.ViewingMode.Global?!0:Math.abs(q)<r.planarDirection.localAltitude};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/SunCalc":function(){define(["exports"],
function(a){var b={exports:{}};(function(c){(function(d){d=d();void 0!==d&&(c.exports=d)})(function(){function d(E){return new Date(864E5*(E+.5-2440588))}function g(E,C){return u(y(E)*p(v)-h(C)*y(v),p(E))}function x(E,C){return m(y(C)*p(v)+p(C)*y(v)*y(E))}function w(E,C,D){return u(y(E),p(E)*y(C)-h(D)*p(C))}function l(E,C,D){return m(y(C)*y(D)+p(C)*p(D)*p(E))}function n(E){return q*(1.9148*y(E)+.02*y(2*E)+3E-4*y(3*E))}function f(E,C){E=q*(357.5291+.98560028*E);var D=n(E);E=E+D+102.9372*q+r;C||(C=
{dec:0,ra:0});C.dec=x(E,0);C.ra=g(E,0);return C}function e(E,C,D){return 2451545+E+.0053*y(C)-.0069*y(2*D)}function k(E){var C=q*(134.963+13.064993*E),D=q*(93.272+13.22935*E);E=q*(218.316+13.176396*E)+6.289*q*y(C);D=5.128*q*y(D);C=385001-20905*p(C);return{ra:g(E,D),dec:x(E,D),dist:C}}var r=Math.PI,y=Math.sin,p=Math.cos,h=Math.tan,m=Math.asin,u=Math.atan2,t=Math.acos,q=r/180,z={dec:0,ra:0},v=23.4397*q,B={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(E,C,D,F){D=q*-D;C*=
q;var G=E.valueOf()/864E5-.5+2440588-2451545;E=f(G,z);D=q*(280.16+360.9856235*G)-D-E.ra;F||(F={azimuth:0,altitude:0});F.azimuth=w(D,C,E.dec);F.altitude=l(D,C,E.dec);return F}},A=[[-.83,"sunrise","sunset"]];B.addTime=function(E,C,D){A.push([E,C,D])};B.getTimes=function(E,C,D){function F(N){var T=J,S=K;N=t((y(N)-y(T)*y(S))/(p(T)*p(S)));return e(9E-4+(N+G)/(2*r)+I,O,P)}var G=q*-D,J=q*C,I=Math.round(E.valueOf()/864E5-.5+2440588-2451545-9E-4-G/(2*r));E=9E-4+(0+G)/(2*r)+I;var O=q*(357.5291+.98560028*E);
C=n(O);var P=O+C+102.9372*q+r,K=x(P,0);E=e(E,O,P);C={solarNoon:d(E),nadir:d(E-.5),polarException:B.PolarException.NORMAL};var M;D=0;for(M=A.length;D<M;D+=1){var U=A[D];var R=F(U[0]*q);var L=E-(R-E);C[U[1]]=d(L);C[U[2]]=d(R)}C.polarException=function(N){N=(y(N)-y(J)*y(K))/(p(J)*p(K));return-1>N?B.PolarException.MIDNIGHT_SUN:1<N?B.PolarException.POLAR_NIGHT:B.PolarException.NORMAL}(A[0][0]*q);return C};B.getMoonPosition=function(E,C,D){D=q*-D;C*=q;var F=E.valueOf()/864E5-.5+2440588-2451545;E=k(F);D=
q*(280.16+360.9856235*F)-D-E.ra;F=l(D,C,E.dec);F+=.017*q/h(F+10.26*q/(F+5.1*q));return{azimuth:w(D,C,E.dec),altitude:F,distance:E.dist}};B.getMoonFraction=function(E){var C=E.valueOf()/864E5-.5+2440588-2451545;E=f(C);C=k(C);E=t(y(E.dec)*y(C.dec)+p(E.dec)*p(C.dec)*p(E.ra-C.ra));E=u(149598E3*y(E),C.dist-149598E3*p(E));return(1+p(E))/2};return B})})(b);a.SunCalc=b.exports})},"esri/views/3d/webgl-engine/lighting/Lightsources":function(){define(["exports","../../../../chunks/vec3f64"],function(a,b){a.AmbientLight=
function(c=b.create()){this.intensity=c};a.FillLight=function(c=b.create(),d=b.fromValues(.57735,.57735,.57735)){this.intensity=c;this.direction=d};a.MainLight=function(c=b.create(),d=b.fromValues(.57735,.57735,.57735),g=!0,x=1,w=1){this.intensity=c;this.direction=d;this.castShadows=g;this.specularStrength=x;this.environmentStrength=w};a.SphericalHarmonicsAmbientLight=function(){this.r=[0];this.g=[0];this.b=[0]};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/SceneInputManager":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./handlers/DoubleClickZoom ./handlers/DragRotate ./handlers/DragZoom ./handlers/GamepadNavigation ./handlers/KeyboardNavigation ./handlers/MouseWheelZoom ./handlers/PinchAndPanNavigation ./handlers/PointerDownCancelAnimation ./handlers/SingleKeyResetHeading ./handlers/SingleKeyResetTilt ./handlers/TwoFingerTilt ../../input/BrowserEventSource ../../input/InputManager ../../input/handlers/PreventContextMenu ../../input/recognizers/Drag ../../input/recognizers/ImmediateDoubleClick ../../input/recognizers/PointerClickHoldAndDrag ../../input/recognizers/SingleAndDoubleClick ../../input/recognizers/VerticalTwoFingerDrag ../state/controllers/RotateController".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E,C,D,F,G,J){c=function(O){function P(){var M=O.apply(this,arguments)||this;M._handles=new d;return M}a._inheritsLoose(P,O);var K=P.prototype;K.destroy=function(){this._handles&&(this._handles.removeAll(),this._handles=null);this.disconnect()};K.disconnect=function(){this.view.viewEvents.disconnect();this._inputManager&&(this._inputManager.destroy(),this._inputManager=null);this._source&&(this._source.destroy(),this._source=null)};K.connect=
function(){const M=this.view;this._source=new v.BrowserEventSource(this.view.surface,M.input);var U=[new C.ImmediateDoubleClick,new D.PointerClickHoldAndDrag,new F.SingleAndDoubleClick,new E.Drag(this.view.navigation),new G.VerticalTwoFingerDrag];this._inputManager=U=new B.InputManager({eventSource:this._source,recognizers:U});U.installHandlers("prevent-context-menu",[new A.PreventContextMenu],B.ViewEventPriorities.INTERNAL);this._modeDragPan=new m.PinchAndPanNavigation(M,"primary");this._modeDragRotate=
new k.DragRotate(M,"secondary",J.PivotPoint.CENTER);this._modeDragZoom=new r.DragZoom(M,"tertiary");U.installHandlers("navigation",[new u.PointerDownCancelAnimation(M),new e.DoubleClickZoom(M),new y.GamepadNavigation(M),new p.KeyboardNavigation(M,{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"}),new h.MouseWheelZoom(M),new q.SingleKeyResetTilt(M,"p"),new t.SingleKeyResetHeading(M,
"n"),new k.DragRotate(M,"primary",J.PivotPoint.EYE,["b"]),new k.DragRotate(M,"secondary",J.PivotPoint.CENTER,["b"]),new m.PinchAndPanNavigation(M,"tertiary",["b"]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new z.TwoFingerTilt(M)],B.ViewEventPriorities.INTERNAL);this.view.viewEvents.connect(U);this._updateMode();g.init(this.view.navigation,"browserTouchPanEnabled",R=>{this._source.browserTouchPanningEnabled=!R})};K._updateMode=function(){var M=this.primaryDragAction;M=I.get(this.mode).get(M);
this._modeDragPan&&(this._modeDragPan.pointerAction=M.pan);this._modeDragRotate&&(this._modeDragRotate.pointerAction=M.rotate);this._modeDragZoom&&(this._modeDragZoom.pointerAction=M.zoom)};a._createClass(P,[{key:"primaryDragAction",get:function(){return this._get("primaryDragAction")},set:function(M){"pan"!==M&&"rotate"!==M||M===this._get("primaryDragAction")||(this._set("primaryDragAction",M),this._updateMode())}},{key:"mode",get:function(){return this._get("mode")},set:function(M){"default"!==
M&&"pro"!==M||M===this._get("mode")||(this._set("mode",M),this._updateMode())}},{key:"test",get:function(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}}]);return P}(c);b.__decorate([x.property()],c.prototype,"view",void 0);b.__decorate([x.property({value:"pan"})],c.prototype,"primaryDragAction",null);b.__decorate([x.property({value:"default"})],c.prototype,"mode",null);b.__decorate([x.property({readOnly:!0,
aliasOf:"_inputManager.hasPendingInputs"})],c.prototype,"hasPendingInputs",void 0);b.__decorate([x.property({readOnly:!0,aliasOf:"_inputManager.latestPointerType"})],c.prototype,"latestPointerType",void 0);b.__decorate([x.property()],c.prototype,"_inputManager",void 0);c=b.__decorate([f.subclass("esri.views.3d.input.SceneInputManager")],c);const I=new Map;b=new Map;x=new Map;b.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"});b.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"});
x.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"});x.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"});I.set("default",b);I.set("pro",x);return c})},"esri/views/3d/input/handlers/DoubleClickZoom":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(a,
b,c,d,g,x,w){x=function(l){function n(f,e){var k=l.call(this,!0)||this;k.view=f;k.registerIncoming("double-click",e,r=>k._handleDoubleClick(r));return k}b._inheritsLoose(n,l);n.prototype._handleDoubleClick=function(f){const e=f.data;if(w.eventMatchesPointerAction(e,"primary")){const k=this.view.state.isGlobal?new d.ZoomStepController({view:this.view,mode:"animation"}):new g.ZoomStepController({view:this.view,mode:"animation"});this.view.state.switchCameraController(k);k.zoomStep(Math.log(.5)/Math.log(.6),
c.createScreenPointArray(e.x,e.y));f.stopPropagation()}};return n}(x.InputHandler);a.DoubleClickZoom=x;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/global/ZoomStepController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/time ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/set ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/projectionEllipsoid ../../../../../chunks/sphere ../../../camera/constraintUtils ../../../camera/constraintUtils/common ../PointToPointAnimationController ../../utils/navigationUtils ../../../support/geometryUtils/ray ../../../support/geometryUtils/sphere ../../../webgl-engine/lib/Camera ../../../webgl-engine/lib/Intersector ../../../../animation/easing ../../../camera/constraintUtils/surfaceCollision".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A){a.ZoomStepController=function(C){function D(){var G=C.apply(this,arguments)||this;G.zoomLocation=k.create();G.tmpCamera=new z.default;G.tmpViewDir=k.create();G.tmpRayDir={origin:k.create(),direction:k.create()};G.targetOnSphere=k.create();G.tmpCenter=k.create();G.constraintOptions={selection:h.ConstraintTypes.ALL_EXCEPT_COLLISION,interactionType:h.InteractionType.ZOOM,interactionFactor:null,interactionStartCamera:new z.default,interactionDirection:null,
tiltMode:h.TiltMode.TUMBLE};G.sphere=y.create();return G}b._inheritsLoose(D,C);var F=D.prototype;F.initialize=function(){this.intersector=v.newIntersector(this.view.state.viewingMode)};F.zoomStep=function(G,J){if(this.active){var I=this.view.state,{interactionStartCamera:O}=this.constraintOptions;this.animation.finished?O.copyFrom(I.camera):this.animation.cameraAt(1,O);var P=O=!1;this.intersectionHelper.intersectScreen(J,this.zoomLocation)&&(O=0<G?!0:!1,P=!0);this.tmpCamera.copyFrom(I.camera);O?this.intersectionHelper.intersectRay(this.tmpCamera.ray,
this.intersector,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter):this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:e.copy(this.zoomLocation,this.tmpCamera.center);this._updateCamera(this.tmpCamera,G,this.zoomLocation,J,P);this.begin(this.tmpCamera)}};F.animationSettings=function(){return{apex:null,duration:d.Milliseconds(600),easing:B.outExpo}};F._updateCamera=function(G,J,I,O,P){var K=r.getReferenceEllipsoid(this.view.spatialReference);
if(u.decideNavigationMode(G,O,P,K)===u.NavigationMode.Horizontal){J=.6**J;this.sphere[3]=e.length(I);e.subtract(this.tmpViewDir,G.center,G.eye);P=e.length(this.tmpViewDir);K=P*J;1>=J&&4>K&&(K=4,J=K/P);if(1E-6>Math.abs(P-K))return;P=e.length(G.center);this.sphere[3]!==P&&(G.center=e.scale(E,G.center,(this.sphere[3]+J*(P-this.sphere[3]))/P));e.scale(this.tmpViewDir,this.tmpViewDir,-J);G.eye=e.add(E,G.center,this.tmpViewDir);p.applyAll(this.view,G,this.constraintOptions);1E-12<e.squaredDistance(I,G.center)&&
q.intersectScreen(this.sphere,G,O,this.targetOnSphere)&&u.panToPosition(this.sphere,G,I,this.targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{P=.6**Math.abs(J);K=0<J?1:-1;t.fromScreenAtEye(G,O,this.tmpRayDir);e.normalize(this.tmpRayDir.direction,this.tmpRayDir.direction);var M;this.view.camera.position.hasZ&&(M=Math.abs(this.view.camera.position.z));M=Math.max(12*M,20);O=this.view._stage.renderView.getMinimalDepthForArea(null,O[0],O[1],this.view.state.camera,60);M=M>O?O:M;e.scale(this.tmpRayDir.direction,
this.tmpRayDir.direction,M);e.add(I,this.tmpRayDir.origin,this.tmpRayDir.direction);I=M*P;O=Math.max(4,1.01*G.nearFar[0]);0<J&&I<O&&(I=O,P=I/M);if(1E-6>Math.abs(M-I))return;e.scale(this.tmpRayDir.direction,this.tmpRayDir.direction,K*(1-P));G.eye=e.add(E,G.eye,this.tmpRayDir.direction);G.center=e.add(E,G.center,this.tmpRayDir.direction)}A.applySurfaceCollisionConstraint(this.view,G)};return D}(m.PointToPointAnimationController);a.ZoomStepController=c.__decorate([f.subclass("esri.views.3d.state.controllers.global.ZoomStepController")],
a.ZoomStepController);const E=k.create();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/camera/constraintUtils":function(){define("exports ../../../chunks/vec2 ./constraintUtils/altitude ./constraintUtils/common ./constraintUtils/distance ./constraintUtils/surfaceCollision ./constraintUtils/tilt ../../animation/easing".split(" "),function(a,b,c,d,g,x,w,l){const n=[{type:d.ConstraintTypes.TILT,error:function(e,k,r){return w.getTiltConstraintError(e,k,r)*k.distance},apply:w.applyTiltConstraint},
{type:d.ConstraintTypes.ALTITUDE,error:c.getAltitudeConstraintError,apply:c.applyAltitudeConstraint},{type:d.ConstraintTypes.DISTANCE,error:g.getDistanceConstraintError,apply:g.applyDistanceConstraint}],f={selection:d.ConstraintTypes.ALL,interactionType:d.InteractionType.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:d.TiltMode.TUMBLE};a.applyAltitudeConstraint=c.applyAltitudeConstraint;a.getAltitudeConstraintError=c.getAltitudeConstraintError;Object.defineProperty(a,
"ConstraintTypes",{enumerable:!0,get:()=>d.ConstraintTypes});Object.defineProperty(a,"InteractionType",{enumerable:!0,get:()=>d.InteractionType});a.applyDistanceConstraint=g.applyDistanceConstraint;a.getDistanceConstraintError=g.getDistanceConstraintError;Object.defineProperty(a,"ApplyCollisionMode",{enumerable:!0,get:()=>x.Mode});a.applySurfaceCollisionConstraint=x.applySurfaceCollisionConstraint;a.applyTiltConstraint=w.applyTiltConstraint;a.getTiltConstraintError=w.getTiltConstraintError;a.applyAll=
function(e,k,r=f,y=k){let p=!1;y!==k&&y.copyFrom(k);y.computeUp(e.state.viewingMode);for(k=0;5>k;k++){let m=0;for(var h of n)if(d.hasConstraintType(r.selection,h.type)){const u=Math.abs(h.error(e,y,r));h.apply(e,y,r)&&(p=!0,m+=u)}if(0===m)break}h=d.hasConstraintType(r.selection,d.ConstraintTypes.COLLISION);a:switch(r.interactionType){case d.InteractionType.PAN:r=x.Mode.EYE_AND_CENTER;break a;case d.InteractionType.ASCEND:r=e.state.isGlobal?x.Mode.EYE_AND_CENTER_SCALE:x.Mode.EYE_AND_CENTER;break a;
default:r=x.Mode.EYE}h&&x.applySurfaceCollisionConstraint(e,y,r)&&(p=!0);p&&y.computeUp(e.state.viewingMode);return p};a.pixelDistanceToInteractionFactor=function(e,k){e="number"===typeof e?e:b.distance(e,k);return l.inOutCubic(Math.min(1,e/150))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/camera/constraintUtils/altitude":function(){define("exports ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/ray ./common ../../support/intersectionUtils".split(" "),
function(a,b,c,d,g,x,w,l){function n(h,m,u=w.defaultApplyOptions){var t=h.state.constraints.altitude;t=h.state.isGlobal&&t?u.interactionType===w.InteractionType.TUMBLE&&w.hasConstraintType(u.selection,w.ConstraintTypes.TILT)?!1:!0:!1;if(!t)return 0;var q=h.state.constraints.altitude;t=e;t.min=q.min;t.max=q.max;q=u.interactionType;if(q!==w.InteractionType.NONE){var {min:z,max:v}=t,{interactionStartCamera:B,interactionFactor:A}=u;u=q===w.InteractionType.TUMBLE||q===w.InteractionType.ZOOM;q=n(h,B);var E=
0===q?0:h.renderCoordsHelper.getAltitude(B.eye);t.min=z;t.max=v;w.adjustRangeForInteraction(q,E,u,A,.05*E,t)}h=h.renderCoordsHelper.getAltitude(m.eye);h=b.clamp(h,t.min,t.max)-h;return 1E-6>=Math.abs(h)?0:h}function f(h,m,u,t){h.renderCoordsHelper.worldUpAtPosition(m.eye,t);d.scale(t,t,u);return t}const e={min:0,max:0},k=g.create(),r=g.create(),y=g.create(),p=g.create();a.applyAltitudeConstraint=function(h,m,u=w.defaultApplyOptions){const t=n(h,m,u);if(0===t)return!1;const q=h.renderCoordsHelper,
z=q.getAltitude(m.eye)+t;u=w.interactionDirectionTowardsConstraintMinimization(m,u.interactionDirection,f(h,m,Math.sign(t),r),k);h=d.copy(y,m.viewForward);u=q.intersectInfiniteManifold(x.wrap(m.eye,u),z,p);m.eye=c.isSome(u)?u:q.setAltitude(p,z,m.eye);m.center=l.closestPointOnRay(p,m.eye,h,m.center);return!0};a.getAltitudeConstraintError=n;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/camera/constraintUtils/common":function(){define(["exports","../../../../chunks/vec3"],function(a,
b){a.InteractionType=void 0;(function(d){d[d.NONE=0]="NONE";d[d.ZOOM=1]="ZOOM";d[d.TUMBLE=2]="TUMBLE";d[d.LOOK_AROUND=3]="LOOK_AROUND";d[d.PAN=4]="PAN";d[d.ASCEND=5]="ASCEND"})(a.InteractionType||(a.InteractionType={}));a.ConstraintTypes=void 0;(function(d){d[d.NONE=0]="NONE";d[d.TILT=1]="TILT";d[d.ALTITUDE=2]="ALTITUDE";d[d.DISTANCE=4]="DISTANCE";d[d.COLLISION=8]="COLLISION";d[d.ALL=15]="ALL";d[d.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"})(a.ConstraintTypes||(a.ConstraintTypes={}));a.TiltMode=
void 0;(function(d){d[d.TUMBLE=0]="TUMBLE";d[d.LOOK_AROUND=1]="LOOK_AROUND"})(a.TiltMode||(a.TiltMode={}));const c={selection:a.ConstraintTypes.NONE,interactionType:a.InteractionType.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:a.TiltMode.TUMBLE};a.adjustRangeForInteraction=function(d,g,x,w,l,n){0!==d&&(x?(n.min=Math.min(n.min,g),n.max=Math.max(n.max,g)):null!=w?(n.min-=Math.max(0,(g-n.min)*(1-w)),n.max+=Math.max(0,(g-n.max)*(1-w))):l&&(n.min-=Math.max(0,
g-n.min-l),n.max+=Math.max(0,g-n.max-l)))};a.defaultApplyOptions=c;a.hasConstraintType=function(d,g){return 0!==(d&g)};a.interactionDirectionTowardsConstraintMinimization=function(d,g,x,w){g=g||d.viewForward;b.copy(w,g);b.scale(w,w,Math.sign(b.dot(g,x)));return w};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/intersectionUtils":function(){define(["exports","../../../chunks/vec2f64","../../../chunks/vec3","../../../chunks/vec3f64","../../../geometry/support/plane"],function(a,
b,c,d,g){function x(n,f,e,k){const r=l;n?(e&&k&&(r.len=c.distance(f,e)),c.copy(r.dir,n)):k?(r.len=c.distance(f,e),c.subtract(r.dir,e,f),c.scale(r.dir,r.dir,1/r.len)):(c.subtract(r.dir,e,f),c.normalize(r.dir,r.dir));return r}function w(n,f,e,k){k.clip[0]=0;k.clip[1]=e?k.len:Number.MAX_VALUE;for(e=0;e<n.length;e++){{var r=n[e],y=f;var p=k;const h=c.dot(g.normal(r),p.dir);r=-g.signedDistance(r,y);0>r&&0<=h?p=!1:-1E-6<h&&1E-6>h?p=0<r:!(0>r||0>h)||0>r&&0>h?(r/=h,0<h?r<p.clip[1]&&(p.clip[1]=r):r>p.clip[0]&&
(p.clip[0]=r),p=p.clip[0]<=p.clip[1]):p=!0}if(!p)return!1}return!0}const l={dir:d.create(),len:0,clip:b.create()};a.closestPointOnRay=function(n,f,e,k){k=c.dot(e,c.subtract(n,k,f));return c.add(n,f,c.scale(n,e,k))};a.frustumLineSegment=function(n,f,e,k){k=x(k,f,e,!0);return w(n,f,e,k)};a.frustumPoint=function(n,f){for(let e=0;6>e;e++)if(0<g.signedDistance(n[e],f))return!1;return!0};a.frustumRay=function(n,f,e,k){e=x(k,f,e,!1);return w(n,f,null,e)};a.frustumSphere=function(n,f,e){const k=f[0],r=f[1];
f=f[2];return n[0][0]*k+n[0][1]*r+n[0][2]*f+n[0][3]>e||n[1][0]*k+n[1][1]*r+n[1][2]*f+n[1][3]>e||n[2][0]*k+n[2][1]*r+n[2][2]*f+n[2][3]>e||n[3][0]*k+n[3][1]*r+n[3][2]*f+n[3][3]>e||n[4][0]*k+n[4][1]*r+n[4][2]*f+n[4][3]>e||n[5][0]*k+n[5][1]*r+n[5][2]*f+n[5][3]>e?!1:!0};a.planeSphere=function(n,f,e){return n[0]*f[0]+n[1]*f[1]+n[2]*f[2]+n[3]<e};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/camera/constraintUtils/distance":function(){define("exports ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/ray ../../../../chunks/sphere ./common".split(" "),
function(a,b,c,d,g,x,w){function l(p,h,m=w.defaultApplyOptions){if(!p.state.isLocal)return 0;var u=p.state.constraints.distance;if(!p.pointsOfInterest.surfaceOrigin.renderLocation||Infinity===u)return 0;n.min=0;n.max=u;u=n;var t=m.interactionType;if(t!==w.InteractionType.NONE){var {min:q,max:z}=u,{interactionStartCamera:v,interactionFactor:B}=m;m=t===w.InteractionType.ZOOM||t===w.InteractionType.PAN;t=l(p,v);var A=0===t?0:c.distance(v.eye,p.pointsOfInterest.surfaceOrigin.renderLocation);u.min=q;u.max=
z;w.adjustRangeForInteraction(t,A,m,B,.05*A,u)}p=c.distance(h.eye,p.pointsOfInterest.surfaceOrigin.renderLocation);p=n.max-p;return-1E-6<=p?0:p}const n={min:0,max:0},f=d.create(),e=d.create(),k=d.create(),r=d.create(),y=d.create();a.applyDistanceConstraint=function(p,h,m=w.defaultApplyOptions){var u=l(p,h,m);if(0===u)return!1;var t=p.pointsOfInterest.surfaceOrigin;u=c.distance(h.eye,p.pointsOfInterest.surfaceOrigin.renderLocation)+u;const q=c.copy(f,h.eye);m=w.interactionDirectionTowardsConstraintMinimization(h,
m.interactionDirection,c.direction(r,h.eye,p.pointsOfInterest.surfaceOrigin.renderLocation),k);if(!x.intersectRay(x.fromCenterAndRadius(t.renderLocation,u),g.wrap(h.eye,m),y))return!1;h.eye=y;t=c.subtract(e,h.eye,q);h.center=c.add(y,h.center,t);t=p.renderCoordsHelper.getAltitude(h.center);p=p.renderCoordsHelper.intersectInfiniteManifold(h.ray,t,y);b.isSome(p)&&(h.center=p);return!0};a.getDistanceConstraintError=l;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/camera/constraintUtils/surfaceCollision":function(){define(["exports",
"../../../../chunks/vec3","../../../../chunks/vec3f64","../intersectionUtils"],function(a,b,c,d){a.Mode=void 0;(function(w){w[w.EYE=0]="EYE";w[w.EYE_AND_CENTER=1]="EYE_AND_CENTER";w[w.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(a.Mode||(a.Mode={}));const g=c.create(),x=c.create();a.applySurfaceCollisionConstraint=function(w,l,n=a.Mode.EYE){var f=w.state.constraints;if(!f.collision.enabled)return!1;var e=d.surfaceElevationBelowRenderLocation(w,l.eye);const k=w.renderCoordsHelper.getAltitude(l.eye);
f=e+f.collision.elevationMargin;if(k>=f)return!1;e=b.length(l.eye);b.subtract(g,l.center,l.eye);l.eye=w.renderCoordsHelper.setAltitude(x,f,l.eye);n===a.Mode.EYE_AND_CENTER?l.center=b.add(g,l.eye,g):n===a.Mode.EYE_AND_CENTER_SCALE&&(l.center=b.scale(g,l.center,(e-k+f)/e));return!0};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/camera/constraintUtils/tilt":function(){define("exports ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projectionEllipsoid ../../../../chunks/sphere ./common ../../state/utils/viewUtils".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k){function r(A,E,C=e.defaultApplyOptions,D=!0){B.eyeCenterDistance=0;B.requiresTwoSteps=!1;const F=y(A,E,C,void 0,B);if(0===F)return!1;g.fromRotation(u,-F,E.viewRight);switch(C.tiltMode){case e.TiltMode.LOOK_AROUND:w.transformMat4(m,E.viewForward,u);w.scale(m,m,B.eyeCenterDistance);E.center=w.add(t,E.eye,m);break;case e.TiltMode.TUMBLE:w.subtract(m,E.center,E.eye);w.transformMat4(m,m,u);E.eye=w.subtract(t,E.center,m);break;default:b.neverReached(C.tiltMode)}E.up=w.transformMat4(t,
E.up,u);return B.requiresTwoSteps&&D?r(A,E,C,!1):!0}function y(A,E,C=e.defaultApplyOptions,D=e.defaultApplyOptions,F){if(!A.state.constraints.tilt)return 0;var G=A.state.constraints.tilt(E.distance,z);if(C.interactionType!==e.InteractionType.NONE){var {interactionStartCamera:J,interactionFactor:I}=C,{min:O,max:P}=G,K=y(A,J,e.defaultApplyOptions,C),M=0===K?0:k.viewAngle(A.renderCoordsHelper,J.center,J.eye);G.min=O;G.max=P;C.interactionType===e.InteractionType.TUMBLE?(e.hasConstraintType(C.selection,
e.ConstraintTypes.ALTITUDE)&&h(A,J,G),e.adjustRangeForInteraction(K,M,!0,I,q,G)):e.adjustRangeForInteraction(K,M,!1,I,q,G)}D.interactionType===e.InteractionType.TUMBLE&&e.hasConstraintType(D.selection,e.ConstraintTypes.ALTITUDE)&&h(A,D.interactionStartCamera,G);if(C.tiltMode===e.TiltMode.LOOK_AROUND||D.tiltMode===e.TiltMode.LOOK_AROUND){a:switch(F&&(F.requiresTwoSteps=!1),A.viewingMode){case "global":C=v;K=A.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;D=K+n.getReferenceEllipsoid(A.spatialReference).radius;
K=A.renderCoordsHelper.intersectManifold(E.ray,K,t);C.eyeCenterDistance=E.distance;C.centerIsOnSurface=!1;d.isSome(K)?(C.eyeCenterDistance=w.distance(E.eye,K),C.tiltAtCenter=k.viewAngle(A.renderCoordsHelper,K,E.eye),C.centerIsOnSurface=!0):A.state.isLocal?C.tiltAtCenter=k.viewAngle(A.renderCoordsHelper,E.center,E.eye):(f.closestPointOnSilhouette(f.fromRadius(D),E.ray,t),C.eyeCenterDistance=w.distance(E.eye,t),C.tiltAtCenter=c.acosClamped(-w.dot(E.viewForward,w.normalize(t,t))));C.radius=D;C.eyeRadius=
w.length(E.eye);C.constraints=A.state.constraints;E=c.clamp(C.tiltAtCenter,G.min,G.max);if(1E-9<Math.abs(C.tiltAtCenter-E)){if(C.centerIsOnSurface){{const {constraints:U,eyeCenterDistance:R,tiltAtCenter:L}=C;E=L;A=U.clampTilt(R,L);G=p(C,A);if(U.clampTilt(G,L)!==A)for(G=0;10>G&&1E-9<Math.abs(A-E);)D=(E+A)/2,K=p(C,D),K=U.clampTilt(K,D),1E-9<Math.abs(K-D)?E=D:A=D,G++;E=A}G=E;A=c.asinClamped(C.radius/C.eyeRadius*Math.sin(C.tiltAtCenter));G=c.asinClamped(C.radius/C.eyeRadius*Math.sin(G));A=C.eyeRadius>
C.radius?A-G:G-A}else E=C.constraints.clampTilt(C.eyeCenterDistance,C.tiltAtCenter),F&&E<Math.PI/2&&(F.requiresTwoSteps=!0,E=Math.PI/2-1E-5),A=C.tiltAtCenter-Math.PI/2-(E-Math.PI/2);F&&(F.eyeCenterDistance=p(C,E));F=A}else F=0;break a;case "local":D=k.viewAngle(A.renderCoordsHelper,E.center,E.eye);C=c.clamp(D,G.min,G.max);G=D-C;1E-9<Math.abs(G)?(F&&(D=A.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,A=A.renderCoordsHelper.getAltitude(E.eye)-D,C=Math.cos(C),F.eyeCenterDistance=1E-4<
Math.abs(C)?A/C:E.distance),F=G):F=0;break a;default:b.neverReached(A.viewingMode),F=void 0}return F}F=k.viewAngle(A.renderCoordsHelper,E.center,E.eye);C=c.clamp(F,G.min,G.max);F-=C;F=1E-9<Math.abs(F)?F:0;return F}function p(A,E){if(!A.centerIsOnSurface)return A.eyeCenterDistance;E=Math.PI-c.clamp(E,0,Math.PI);const C=c.asinClamped(A.radius/A.eyeRadius*Math.sin(E)),D=Math.sin(Math.PI-E-C)/Math.sin(E);return A.eyeRadius<A.radius&&1<D?Math.sin(Math.PI-E-(Math.PI-C))/Math.sin(E)*A.eyeRadius:D*A.eyeRadius}
function h(A,E,C){if(!A.state.isLocal){var D=A.state.constraints;if(D.altitude){var F=w.squaredLength(E.center),G=Math.sqrt(F);E=E.distance;var J=n.getReferenceEllipsoid(A.spatialReference).radius;A=D.altitude.min+J;D=D.altitude.max+J;A=(A*A-E*E-F)/(-2*G*E);C.min=Math.max(C.min,Math.min(Math.PI-c.acosClamped((D*D-E*E-F)/(-2*G*E)),C.max));C.max=Math.min(C.max,Math.PI-c.acosClamped(A))}}}const m=l.create(),u=x.create(),t=l.create(),q=c.deg2rad(5),z={min:0,max:0},v={constraints:null,radius:0,eyeRadius:0,
centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},B={eyeCenterDistance:0,requiresTwoSteps:!1};a.applyTiltConstraint=r;a.getTiltConstraintError=y;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/utils/viewUtils":function(){define(["exports","../../../../core/mathUtils","../../../../chunks/vec3","../../../../chunks/vec3f64"],function(a,b,c,d){const g=d.create(),x=d.create();a.viewAngle=function(w,l,n){w.worldUpAtPosition(l,g);c.subtract(x,n,l);w=c.length(x);return 0===
w?0:b.acosClamped(c.dot(x,g)/w)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/animation/easing":function(){define(["exports"],function(a){function b(L){return L}function c(L){const N=2*(L-Math.sqrt((L-1)*L)),T=N/2/L;return S=>S<T?L*S*S:N*S-N+1}function d(L,N){return(T,S)=>T<N?N*L(T/N,S):1-L((1-T)/(1-N),S)*(1-N)}const g=L=>L*L,x=L=>1-g(1-L),w=L=>.5>L?g(2*L)/2:(1-g(1-2*(L-.5))+1)/2,l=L=>L*L*L,n=L=>1-l(1-L),f=L=>.5>L?l(2*L)/2:(1-l(1-2*(L-.5))+1)/2,e=L=>L*L*L*L,k=L=>1-e(1-L),r=L=>.5>
L?e(2*L)/2:(1-e(1-2*(L-.5))+1)/2,y=L=>L*L*L*L*L,p=L=>1-y(1-L),h=L=>.5>L?y(2*L)/2:(1-y(1-2*(L-.5))+1)/2,m=L=>-Math.cos(L*Math.PI/2)+1,u=L=>1-m(1-L),t=L=>.5>L?m(2*L)/2:(1-m(1-2*(L-.5))+1)/2,q=L=>2**(10*(L-1)),z=L=>1-2**(10*(1-L-1)),v=L=>.5>L?2**(10*(2*L-1))/2:(1-2**(10*(1-2*(L-.5)-1))+1)/2,B=L=>-(Math.sqrt(1-L*L)-1),A=L=>1-B(1-L),E=L=>.5>L?B(2*L)/2:(1-B(1-2*(L-.5))+1)/2,C=d(c(1),1),D=d(c(1),0),F=d(c(1),.5),G=d(c(2),1),J=d(c(2),0),I=d(c(2),.5),O=d(c(3),1),P=d(c(3),0),K=d(c(3),.5),M=d(c(4),1),U=d(c(4),
0),R=d(c(4),.5);a.EasingFunctions={linear:b,"in-quad":g,"out-quad":x,"in-out-quad":w,"in-coast-quad":C,"out-coast-quad":D,"in-out-coast-quad":F,"in-cubic":l,"out-cubic":n,"in-out-cubic":f,"in-coast-cubic":G,"out-coast-cubic":J,"in-out-coast-cubic":I,"in-quart":e,"out-quart":k,"in-out-quart":r,"in-coast-quart":O,"out-coast-quart":P,"in-out-coast-quart":K,"in-quint":y,"out-quint":p,"in-out-quint":h,"in-coast-quint":M,"out-coast-quint":U,"in-out-coast-quint":R,"in-sine":m,"out-sine":u,"in-out-sine":t,
"in-expo":q,"out-expo":z,"in-out-expo":v,"in-circ":B,"out-circ":A,"in-out-circ":E};a.inCirc=B;a.inCoastCubic=G;a.inCoastQuad=C;a.inCoastQuart=O;a.inCoastQuint=M;a.inCubic=l;a.inExpo=q;a.inOutCirc=E;a.inOutCoastCubic=I;a.inOutCoastQuad=F;a.inOutCoastQuart=K;a.inOutCoastQuint=R;a.inOutCubic=f;a.inOutExpo=v;a.inOutQuad=w;a.inOutQuart=r;a.inOutQuint=h;a.inOutSine=t;a.inQuad=g;a.inQuart=e;a.inQuint=y;a.inSine=m;a.linear=b;a.outCirc=A;a.outCoastCubic=J;a.outCoastQuad=D;a.outCoastQuart=P;a.outCoastQuint=
U;a.outCubic=n;a.outExpo=z;a.outQuad=x;a.outQuart=k;a.outQuint=p;a.outSine=u;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/PointToPointAnimationController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3f64 ../../../ViewAnimation ../../animation/pointToPoint/Animation ./AnimationController ../../webgl-engine/lib/Camera ../../webgl-engine/lib/Intersector ../../../animation/easing".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p){a.PointToPointAnimationController=function(u){function t(z){z=u.call(this,z)||this;z.view=null;z.mode="interaction";z.hasTarget=!1;return z}b._inheritsLoose(t,u);var q=t.prototype;q.initialize=function(){this.animation=new e.Animation(this.view.state.viewingMode);this.viewAnimation="interaction"===this.mode?null:new f};q.begin=function(z,v){this.hasTarget=!0;v=this.animationSettings(v);h.copyFrom(this.view.state.camera);const B=y.newIntersector(this.view.state.viewingMode);
this.intersectionHelper.intersectRay(h.ray,B,m)&&(h.center=m);this.animation.update(h,z,v);this.animation.finished&&this.finish()};q.finish=function(){this.animation.currentTime=this.animation.time;u.prototype.finish.call(this)};q.stepController=function(z,v){this.hasTarget&&this.animation.step(z,v)};q.onControllerEnd=function(z){this.hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,z),this.animation.currentTime=this.animation.time);u.prototype.onControllerEnd.call(this,
z)};q.animationSettings=function(z={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(Infinity)/6,ascensionFactor:void 0,descensionFactor:void 0},...z,easing:"string"===typeof z.easing?p.EasingFunctions[z.easing]:z.easing}};b._createClass(t,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}},{key:"isInteractive",get:function(){return"interaction"===this.mode}},{key:"steppingFinished",get:function(){return this.hasTarget&&this.animation.finished}}]);
return t}(k.AnimationController);c.__decorate([d.property({constructOnly:!0})],a.PointToPointAnimationController.prototype,"view",void 0);c.__decorate([d.property({constructOnly:!0})],a.PointToPointAnimationController.prototype,"mode",void 0);a.PointToPointAnimationController=c.__decorate([l.subclass("esri.views.3d.state.controllers.PointToPointAnimationController")],a.PointToPointAnimationController);const h=new r.default,m=n.create();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/animation/pointToPoint/Animation":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/time ../../../../chunks/vec3 ../../../../chunks/vec3f64 ./Camera ../../webgl-engine/lib/Camera ../../../animation/pointToPoint/Animation".split(" "),
function(a,b,c,d,g,x,w,l){const n=g.create();g=function(){function f(k){this.currentTime=c.Milliseconds(0);this._animation=new l.Animation(()=>new x(k));this._current=new x(k)}var e=f.prototype;e.update=function(k,r,y){const p=this._animation.definition.source,h=this._animation.definition.target,m=d.subtract(n,r.center,k.center),u=d.length(m);1E-5<=u?(m[0]/=u,m[1]/=u,m[2]/=u):(m[0]=0,m[1]=1,m[0]=0);d.copy(p.lookAtDirection,m);d.copy(h.lookAtDirection,m);p.copyFromRenderCamera(k);h.copyFromRenderCamera(r);
this._current.copyFrom(p);this._animation.update(p,h,y);this.currentTime=c.Milliseconds(0);k.almostEquals(r)&&(this.currentTime=this._animation.time)};e.cameraAt=function(k,r){this._animation.cameraAt(k,this._current);r=r||new w.default;this._current.copyToRenderCamera(r);return r};e.step=function(k,r){this.finished||(this.currentTime=c.Milliseconds(this.currentTime+c.millisecondsFromSeconds(k)),this.currentTime>=this.time&&(this.currentTime=this.time));return this.cameraAt(this.currentTime/this.time,
r)};b._createClass(f,[{key:"finished",get:function(){return this.currentTime>=this._animation.time}},{key:"time",get:function(){return this._animation.time}}]);return f}();a.Animation=g;a.default=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/animation/pointToPoint/Camera":function(){define("../../../../core/mathUtils ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../ViewingMode ../../support/mathUtils".split(" "),
function(a,b,c,d,g,x,w){const l=g.create(),n=g.create(),f=g.create(),e=g.create(),k=g.create(),r=g.create();var y=g.fromValues(0,0,1),p=g.fromValues(0,1,0),h=g.fromValues(1,0,0);const m=c.create();return function(){function u(q=x.ViewingMode.Global){this.viewingMode=q;this.center=g.create();this.distance=this.yaw=this.pitch=0;this.lookAtDirection=g.clone(p)}var t=u.prototype;t.pixelsPerPanAtZoom=function(q){return this.size/2/(this._zoomToPanScale*q)};t.zoomAtPixelsPerPan=function(q){return this.size/
2/(this._zoomToPanScale*q)};t.pixelsPerRotateAtZoom=function(){return this.size/2/Math.max(Math.cos(Math.abs(this.pitch)),.5)};t.compareTo=function(q,z){z||(z={pan:0,rotate:0,sourceZoom:0,targetZoom:0});if(this.viewingMode===x.ViewingMode.Global){var v=d.length(this.center);const B=d.length(q.center);v=(v+B)/2;z.pan=w.angle(this.center,q.center)*v}else z.pan=d.distance(this.center,q.center);v=Math.abs(q.yaw-this.yaw);v>=Math.PI&&(v=2*Math.PI-v);z.rotate=Math.max(v,Math.abs(q.pitch-this.pitch));z.sourceZoom=
this.distance;z.targetZoom=q.distance;return z};t.interpolate=function(q,z,v){this.viewingMode===x.ViewingMode.Global?w.slerp(q.center,z.center,v.pan,this.center):d.lerp(this.center,q.center,z.center,v.pan);this.distance=a.lerp(q.distance,z.distance,v.zoom);this.pitch=a.lerp(q.pitch,z.pitch,v.rotate);q=q.yaw;z=z.yaw;Math.abs(z-q)>=Math.PI&&(q+=2*(q<z?1:-1)*Math.PI);this.yaw=a.lerp(q,z,v.rotate)};t.copyFrom=function(q){d.copy(this.center,q.center);this.pitch=q.pitch;this.yaw=q.yaw;this.distance=q.distance;
d.copy(this.lookAtDirection,q.lookAtDirection);this.size=q.size;this.copyFromCommon(q);this.viewingMode=q.viewingMode};t.copyFromRenderCamera=function(q){const z=this._lookAtOrientation(q.center,m);d.copy(this.center,q.center);d.subtract(e,q.center,q.eye);d.transformMat3(e,e,z);d.transformMat3(k,q.up,z);this.distance=d.length(e);e[0]/=this.distance;e[1]/=this.distance;e[2]/=this.distance;this.pitch=this._eyeUpToPitch(e);this.yaw=this._eyeUpToYaw(e,k);this.size=Math.sqrt(q.width*q.width+q.height*q.height);
this.copyFromCommon(q)};t.copyFromCommon=function(q){this.fov=q.fov;this._zoomToPanScale=Math.atan(.5*this.fov)};t.copyToRenderCamera=function(q){const z=this._lookAtOrientation(this.center,m);b.transpose(z,z);this._axisAngleVec3(h,this.pitch-Math.PI/2,p,e);this._axisAngleVec3(y,this.yaw,e);this._axisAngleVec3(h,this.pitch-Math.PI/2,y,k);this._axisAngleVec3(y,this.yaw,k);d.scale(e,e,this.distance);d.transformMat3(e,e,z);d.transformMat3(k,k,z);q.center=this.center;q.eye=d.subtract(e,this.center,e);
q.up=k};t._axisAngleVec3=function(q,z,v,B=v){const A=Math.cos(z);z=Math.sin(z);d.scale(l,v,A);d.cross(n,q,v);d.scale(n,n,z);d.scale(f,q,(1-A)*d.dot(q,v));return d.add(B,d.add(B,l,n),f)};t._lookAtOrientation=function(q,z=c.create()){this._upAtLookAt(q,f);d.cross(l,this.lookAtDirection,f);d.normalize(l,l);0===l[0]&&0===l[1]&&0===l[2]&&d.copy(l,h);d.cross(n,f,l);d.normalize(n,n);z[0]=l[0];z[1]=n[0];z[2]=f[0];z[3]=l[1];z[4]=n[1];z[5]=f[1];z[6]=l[2];z[7]=n[2];z[8]=f[2];return z};t._upAtLookAt=function(q,
z){return this.viewingMode===x.ViewingMode.Local?d.copy(z,y):d.normalize(z,q)};t._eyeUpToPitch=function(q){return Math.PI-w.angle(y,q)};t._eyeUpToYaw=function(q,z){.5>Math.abs(z[2])?(d.copy(r,z),0<q[2]&&d.scale(r,r,-1)):d.copy(r,q);d.cross(n,r,y);d.normalize(n,n);return w.angle(h,n,y)};return u}()})},"esri/views/3d/webgl-engine/lib/Camera":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/support/frustum ../../../../geometry/support/ray ../../../../geometry/support/vector ../../../ViewingMode ./Util".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t){const q=c.getLogger("esri.views.3d.webgl-engine.lib.Camera");c=function(){function C(F=null,G=null,J=null){this._viewUp=k.create();this._viewForward=k.create();this._viewRight=k.create();this._ray=h.create();this._viewport=y.fromValues(0,0,1,1);this._padding=y.fromValues(0,0,0,0);this._fov=55/180*Math.PI;this._nearFar=f.fromValues(1,1E3);this._viewDirty=!0;this._viewMatrix=l.create();this._projectionDirty=!0;this._projectionMatrix=l.create();this._viewProjectionDirty=
!0;this._viewProjectionMatrix=l.create();this._viewInverseTransposeMatrixDirty=!0;this._viewInverseTransposeMatrix=l.create();this._frustumDirty=!0;this._frustum=p.create();this._fullViewport=y.create();this.pixelRatio=1;this.relativeElevation=0;g.isSome(F)&&e.copy(this._ray.origin,F);this._center=g.isSome(G)?k.clone(G):k.create();this._up=g.isSome(J)?k.clone(J):k.fromValues(0,0,1)}var D=C.prototype;D.depthNDCToWorld=function(F){return 2*this.near*this.far/(this.far+this.near-(2*F-1)*(this.far-this.near))};
D.copyFrom=function(F){e.copy(this._ray.origin,F.eye);e.copy(this._center,F.center);e.copy(this._up,F.up);r.copy(this._viewport,F.viewport);r.copy(this._padding,F.padding);n.copy(this._nearFar,F.nearFar);this._fov=F.fov;this.relativeElevation=F.relativeElevation;this._viewDirty=F._viewDirty;this._viewDirty||(w.copy(this._viewMatrix,F.viewMatrix),e.copy(this._viewRight,F.viewRight),e.copy(this._viewUp,F.viewUp),e.copy(this._viewForward,F.viewForward));F._projectionDirty?this._projectionDirty=!0:(w.copy(this._projectionMatrix,
F.projectionMatrix),this._projectionDirty=!1);this._viewProjectionDirty=!0;this._frustumDirty=F._frustumDirty;this._frustumDirty||(p.copy(this._frustum,F.frustum),this._frustumDirty=!1);F._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(w.copy(this._viewInverseTransposeMatrix,F.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1);r.copy(this._fullViewport,F.fullViewport);this.pixelRatio=F.pixelRatio;return this};D.copyViewFrom=function(F){this.eye=F.eye;
this.center=F.center;this.up=F.up};D.clone=function(){return(new C).copyFrom(this)};D.equals=function(F){return e.exactEquals(this.eye,F.eye)&&e.exactEquals(this._center,F.center)&&e.exactEquals(this._up,F.up)&&r.exactEquals(this._viewport,F.viewport)&&r.exactEquals(this._padding,F.padding)&&n.exactEquals(this._nearFar,F.nearFar)&&this._fov===F.fov&&this.pixelRatio===F.pixelRatio&&this.relativeElevation===F.relativeElevation};D.almostEquals=function(F){if(this.pixelRatio!==F.pixelRatio||.001<=Math.abs(F.fov-
this._fov))return!1;const G=1-1E-10;e.sub(B,F.eye,F.center);e.sub(A,this.eye,this._center);const J=e.dot(B,A),I=e.sqrLen(B),O=e.sqrLen(A);return J*J>=G*I*O&&e.sqrDist(F.eye,this.eye)<2.5E-7*Math.max(I,O)&&.5>r.squaredDistance(F.padding,this._padding)&&.5>r.squaredDistance(F.viewport,this._viewport)};D.computeRenderPixelSizeAt=function(F){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(F))};D.computeRenderPixelSizeAtDist=function(F){return F*this.perRenderPixelRatio};D.computeScreenPixelSizeAt=
function(F){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(F))};D._viewDirectionDistance=function(F){return Math.abs(m.projectPointSignedLength(this.viewForward,e.subtract(B,F,this.eye)))};D.computeScreenPixelSizeAtDist=function(F){return F*this.perScreenPixelRatio};D.computeDistanceFromRadius=function(F,G){return F/Math.tan(Math.min(this.fovX,this.fovY)/(2*(G||1)))};D.getScreenCenter=function(F=x.createScreenPointArray()){F[0]=(this.padding[a.PaddingSide.LEFT]+this.width/2)/
this.pixelRatio;F[1]=(this.padding[a.PaddingSide.TOP]+this.height/2)/this.pixelRatio;return F};D.getRenderCenter=function(F,G=.5,J=.5){F[0]=this.padding[a.PaddingSide.LEFT]+this.width*G;F[1]=this.padding[a.PaddingSide.BOTTOM]+this.height*J;F[2]=.5;return F};D.setGLViewport=function(F){const G=this.viewport,J=this.padding;F.setViewport(G[0]-J[3],G[1]-J[2],G[2]+J[1]+J[3],G[3]+J[0]+J[2])};D.applyProjection=function(F,G,J=!1){F!==z&&e.copy(z,F);z[3]=1;J&&(G[2]=-z[2]);r.transformMat4(z,z,this.projectionMatrix);
e.scale(z,z,1/Math.abs(z[3]));F=this.fullViewport;G[0]=d.lerp(0,F[0]+F[2],.5+.5*z[0]);G[1]=d.lerp(0,F[1]+F[3],.5+.5*z[1]);J||(G[2]=.5*(z[2]+1));return G};D.projectToScreen=function(F,G){this.projectToRenderScreen(F,E);this.renderToScreen(E,G)};D.projectToRenderScreen=function(F,G){z[0]=F[0];z[1]=F[1];z[2]=F[2];z[3]=1;r.transformMat4(z,z,this.viewProjectionMatrix);if(0===z[3])return null;e.scale(z,z,1/Math.abs(z[3]));F=this.fullViewport;"x"in G?(G.x=d.lerp(0,F[0]+F[2],.5+.5*z[0]),G.y=d.lerp(0,F[1]+
F[3],.5+.5*z[1])):(G[0]=d.lerp(0,F[0]+F[2],.5+.5*z[0]),G[1]=d.lerp(0,F[1]+F[3],.5+.5*z[1]),2<G.length&&(G[2]=.5*(z[2]+1)));return G};D.unprojectFromScreen=function(F,G){return this.unprojectFromRenderScreen(this.screenToRender(F,E),G)};D.unprojectFromRenderScreen=function(F,G){w.multiply(v,this.projectionMatrix,this.viewMatrix);if(!w.invert(v,v))return null;const J=this.fullViewport;z[0]=2*(F[0]-J[0])/J[2]-1;z[1]=2*(F[1]-J[1])/J[3]-1;z[2]=2*F[2]-1;z[3]=1;r.transformMat4(z,z,v);if(0===z[3])return null;
G[0]=z[0]/z[3];G[1]=z[1]/z[3];G[2]=z[2]/z[3];return G};D.constrainWindowSize=function(F,G,J,I=J){F*=this.pixelRatio;G*=this.pixelRatio;return[Math.max(F-J/2,0),Math.max(this.fullHeight-G-I/2,0),J- -Math.min(F-J/2,0)- -Math.min(this.fullWidth-F-J/2,0),I- -Math.min(this.fullHeight-G-I/2,0)- -Math.min(G-I/2,0)]};D.computeUp=function(F){F===u.ViewingMode.Global?this._computeUpGlobal():this._computeUpLocal()};D.screenToRender=function(F,G){const J=this.fullHeight-F[1]*this.pixelRatio;G[0]=F[0]*this.pixelRatio;
G[1]=J;return G};D.renderToScreen=function(F,G){const J=(this.fullHeight-F[1])/this.pixelRatio;G[0]=F[0]/this.pixelRatio;G[1]=J};D._computeUpGlobal=function(){e.subtract(B,this.center,this.eye);const F=e.length(this.center);1>F?(e.set(this._up,0,0,1),this._markViewDirty()):Math.abs(e.dot(B,this.center))>.9999*e.length(B)*F||(e.cross(this._up,B,this.center),e.cross(this._up,this._up,B),e.normalize(this._up,this._up),this._markViewDirty())};D._computeUpLocal=function(){e.direction(B,this.eye,this.center);
.9999>=Math.abs(B[2])&&(e.scale(B,B,B[2]),e.set(this._up,-B[0],-B[1],1-B[2]),e.normalize(this._up,this._up),this._markViewDirty())};D._compareAndSetView=function(F,G){"number"===typeof F[0]&&isFinite(F[0])&&"number"===typeof F[1]&&isFinite(F[1])&&"number"===typeof F[2]&&isFinite(F[2])?e.exactEquals(F,G)||(e.copy(G,F),this._markViewDirty()):q.warn("Camera vector contains invalid number, ignoring value")};D._markViewDirty=function(){this._viewProjectionDirty=this._frustumDirty=this._viewDirty=!0};D._recomputeFrustum=
function(){this._frustumDirty&&(p.fromMatrix(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)};D._ensureViewClean=function(){this._viewDirty&&(w.lookAt(this._viewMatrix,this.eye,this._center,this._up),e.set(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),e.set(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),e.set(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=
!0)};b._createClass(C,[{key:"eye",get:function(){return this._ray.origin},set:function(F){this._compareAndSetView(F,this._ray.origin)}},{key:"center",get:function(){return this._center},set:function(F){this._compareAndSetView(F,this._center)}},{key:"ray",get:function(){e.subtract(this._ray.direction,this.center,this.eye);return this._ray}},{key:"up",get:function(){return this._up},set:function(F){this._compareAndSetView(F,this._up)}},{key:"viewMatrix",get:function(){this._ensureViewClean();return this._viewMatrix},
set:function(F){w.copy(this._viewMatrix,F);this._viewDirty=!1;this._frustumDirty=this._viewProjectionDirty=this._viewInverseTransposeMatrixDirty=!0}},{key:"viewForward",get:function(){this._ensureViewClean();return this._viewForward}},{key:"viewUp",get:function(){this._ensureViewClean();return this._viewUp}},{key:"viewRight",get:function(){this._ensureViewClean();return this._viewRight}},{key:"nearFar",get:function(){return this._nearFar}},{key:"near",get:function(){return this._nearFar[0]},set:function(F){this._nearFar[0]!==
F&&(this._nearFar[0]=F,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)}},{key:"far",get:function(){return this._nearFar[1]},set:function(F){this._nearFar[1]!==F&&(this._nearFar[1]=F,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)}},{key:"viewport",get:function(){return this._viewport},set:function(F){this.x=F[0];this.y=F[1];this.width=F[2];this.height=F[3]}},{key:"x",get:function(){return this._viewport[0]},set:function(F){F+=this._padding[a.PaddingSide.LEFT];
this._viewport[0]!==F&&(this._viewport[0]=F,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)}},{key:"y",get:function(){return this._viewport[1]},set:function(F){F+=this._padding[a.PaddingSide.BOTTOM];this._viewport[1]!==F&&(this._viewport[1]=F,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)}},{key:"width",get:function(){return this._viewport[2]},set:function(F){this._viewport[2]!==F&&(this._viewport[2]=F,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=
!0)}},{key:"height",get:function(){return this._viewport[3]},set:function(F){this._viewport[3]!==F&&(this._viewport[3]=F,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)}},{key:"fullWidth",get:function(){return this._viewport[2]+this._padding[a.PaddingSide.RIGHT]+this._padding[a.PaddingSide.LEFT]},set:function(F){this.width=F-(this._padding[a.PaddingSide.RIGHT]+this._padding[a.PaddingSide.LEFT])}},{key:"fullHeight",get:function(){return this._viewport[3]+this._padding[a.PaddingSide.TOP]+
this._padding[a.PaddingSide.BOTTOM]},set:function(F){this.height=F-(this._padding[a.PaddingSide.TOP]+this._padding[a.PaddingSide.BOTTOM])}},{key:"fullViewport",get:function(){this._fullViewport[0]=this._viewport[0]-this._padding[a.PaddingSide.LEFT];this._fullViewport[1]=this._viewport[1]-this._padding[a.PaddingSide.BOTTOM];this._fullViewport[2]=this.fullWidth;this._fullViewport[3]=this.fullHeight;return this._fullViewport}},{key:"aspect",get:function(){return this.width/this.height}},{key:"padding",
get:function(){return this._padding},set:function(F){if(this._padding[a.PaddingSide.TOP]!==F[a.PaddingSide.TOP]||this._padding[a.PaddingSide.RIGHT]!==F[a.PaddingSide.RIGHT]||this._padding[a.PaddingSide.BOTTOM]!==F[a.PaddingSide.BOTTOM]||this._padding[a.PaddingSide.LEFT]!==F[a.PaddingSide.LEFT])this._viewport[0]+=F[a.PaddingSide.LEFT]-this._padding[a.PaddingSide.LEFT],this._viewport[1]+=F[a.PaddingSide.BOTTOM]-this._padding[a.PaddingSide.BOTTOM],this._viewport[2]-=F[a.PaddingSide.RIGHT]+F[a.PaddingSide.LEFT]-
(this._padding[a.PaddingSide.RIGHT]+this._padding[a.PaddingSide.LEFT]),this._viewport[3]-=F[a.PaddingSide.TOP]+F[a.PaddingSide.BOTTOM]-(this._padding[a.PaddingSide.TOP]+this._padding[a.PaddingSide.BOTTOM]),r.copy(this._padding,F),this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0}},{key:"viewProjectionMatrix",get:function(){this._viewProjectionDirty&&(w.multiply(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1);return this._viewProjectionMatrix}},
{key:"projectionMatrix",get:function(){if(this._projectionDirty){const F=this.width,G=this.height,J=this.near*Math.tan(this.fovY/2),I=J*this.aspect;w.frustum(this._projectionMatrix,-I*(1+2*this._padding[a.PaddingSide.LEFT]/F),I*(1+2*this._padding[a.PaddingSide.RIGHT]/F),-J*(1+2*this._padding[a.PaddingSide.BOTTOM]/G),J*(1+2*this._padding[a.PaddingSide.TOP]/G),this.near,this.far);this._projectionDirty=!1}return this._projectionMatrix},set:function(F){w.copy(this._projectionMatrix,F);this._projectionDirty=
!1;this._frustumDirty=this._viewProjectionDirty=!0}},{key:"fov",get:function(){return this._fov},set:function(F){this._fov=F;this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0}},{key:"fovX",get:function(){return t.fovd2fovx(this._fov,this.width,this.height)},set:function(F){this._fov=t.fovx2fovd(F,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0}},{key:"fovY",get:function(){return t.fovd2fovy(this._fov,this.width,this.height)},set:function(F){this._fov=
t.fovy2fovd(F,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0}},{key:"distance",get:function(){return e.distance(this._center,this.eye)}},{key:"frustum",get:function(){this._recomputeFrustum();return this._frustum}},{key:"viewInverseTransposeMatrix",get:function(){if(this._viewInverseTransposeMatrixDirty||this._viewDirty)w.invert(this._viewInverseTransposeMatrix,this.viewMatrix),w.transpose(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),
this._viewInverseTransposeMatrixDirty=!1;return this._viewInverseTransposeMatrix}},{key:"perRenderPixelRatio",get:function(){return Math.tan(this.fovX/2)/(this.width/2)}},{key:"perScreenPixelRatio",get:function(){return this.perRenderPixelRatio*this.pixelRatio}},{key:"aboveGround",get:function(){return this.relativeElevation&&0<=this.relativeElevation}}]);return C}();const z=y.create(),v=l.create(),B=k.create(),A=k.create(),E=x.createRenderScreenPointArray3();a.PaddingSide=void 0;(function(C){C[C.TOP=
0]="TOP";C[C.RIGHT=1]="RIGHT";C[C.BOTTOM=2]="BOTTOM";C[C.LEFT=3]="LEFT"})(a.PaddingSide||(a.PaddingSide={}));a.default=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/animation/pointToPoint/Animation":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/time ../easing ./Definition ./Settings ./apex/Path".split(" "),function(a,b,c,d,g,x,w){const l={zoom:0,pan:0,rotate:0};let n=function(){function f(k){this.createCamera=k;this._time=c.Milliseconds(0);
this.definition=new g.Definition(k);this.path=new w.Path}var e=f.prototype;e.update=function(k,r,y){this.definition.update(k,r,y);this.path.update(this.definition,y);this._time=this._applyTimeSettings(c.millisecondsFromSeconds(this.path.time),y);this._easing=y.easing?y.easing:1E3<=this._time?d.inOutCoastQuad:d.outExpo};e.cameraAt=function(k,r){r=r||this.createCamera();k=Math.min(Math.max(0,k),1);k=this._normalizedEasing(k);k=this.path.interpolateComponentsAt(k,l);r.interpolate(this.definition.source,
this.definition.target,k);return r};e._normalizedEasing=function(k){const r=this._easing(0,this._time),y=this._easing(1,this._time);return(this._easing(k,this._time)-r)/(y-r)};e._applyTimeSettings=function(k,r){const y=null!=r.speedFactor?r.speedFactor:1;null!=r.duration?k=r.duration:null!=r.speedFactor&&(k=c.Milliseconds(k/y));return c.Milliseconds(Math.min(Math.max(null!=r.minDuration?r.minDuration:x.defaultSettings.minDuration/y,k),null!=r.maxDuration?r.maxDuration:x.defaultSettings.maxDuration/
y))};b._createClass(f,[{key:"time",get:function(){return this._time}}]);return f}();a.Animation=n;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/animation/pointToPoint/Definition":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","./Settings"],function(a,b,c){let d=function(){function g(w){this.createCamera=w;this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0};this.settings={desiredScreenFlow:c.defaultSettings.desiredScreenFlow};this.source=w();this.target=
w()}var x=g.prototype;x.clone=function(){const w=new g(this.createCamera);w.copyFrom(this);return w};x.copyFrom=function(w){this.update(w.source,w.target,w.settings)};x.update=function(w,l,n){this.source!==w&&this.source.copyFrom(w);this.target!==l&&this.target.copyFrom(l);this.compared=this.source.compareTo(this.target,this.compared);this.settings.desiredScreenFlow=null!=n.desiredScreenFlow?n.desiredScreenFlow:c.defaultSettings.desiredScreenFlow;this.desiredPixelFlow=this.settings.desiredScreenFlow*
this.target.size;this.halfWindowSize=this.target.size/2};x.halfWindowPanAtZoom=function(w){w=this.target.pixelsPerPanAtZoom(w);return this.halfWindowSize/w};b._createClass(g,[{key:"hasZoom",get:function(){return 1E-5<Math.abs(this.compared.sourceZoom-this.compared.targetZoom)}},{key:"hasPan",get:function(){return 1E-9<this.compared.pan}},{key:"hasRotate",get:function(){return 1E-9<this.compared.rotate}}]);return g}();a.Definition=d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/animation/pointToPoint/Settings":function(){define(["exports",
"../../../core/time"],function(a,b){b={desiredScreenFlow:2,minDuration:b.Milliseconds(500),maxDuration:b.Milliseconds(8E3)};a.defaultSettings=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/animation/pointToPoint/apex/Path":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../easing ../Path ../Segment ./planning".split(" "),function(a,b,c,d,g,x){d=function(w){function l(f,e){var k=w.call(this)||this;k._preallocSegments=[new g.Segment,new g.Segment,new g.Segment];
k.update(f,e);return k}b._inheritsLoose(l,w);var n=l.prototype;n.update=function(f,e){if(f){this.definition?this.definition.copyFrom(f):this.definition=f.clone();var k=null;e&&e.apex&&(k=x.optimalDistance(f,e.apex));this.segments.length=0;this._descensionSegment=this._ascensionSegment=null;null==k?this._updateWithoutApex():this._updateWithApex(k,e.apex)}};n.segmentInterpolateComponentsAt=function(f,e,k){k=f.interpolateComponentsAt(e,k);f===this._ascensionSegment?k.zoom=c.outQuad(k.zoom):f===this._descensionSegment&&
(k.zoom=c.inQuad(k.zoom));return k};n._updateWithApex=function(f,e){const [k,r,y]=this._preallocSegments,p=null!=e.ascensionFactor?e.ascensionFactor:.5;e=Math.min(1-p,null!=e.ascensionFactor?e.descensionFactor:.5);const h=1-p-e;k.definition?k.definition.copyFrom(this.definition):k.definition=this.definition.clone();k.definition.compared.targetZoom=f;k.definition.compared.pan=this.definition.compared.pan*p;k.definition.compared.rotate=this.definition.compared.rotate*p;k.update();this._ascensionSegment=
k;this.segments.push(k);0<h&&(r.definition?r.definition.copyFrom(this.definition):r.definition=this.definition.clone(),r.definition.copyFrom(this.definition),r.definition.compared.sourceZoom=f,r.definition.compared.targetZoom=f,r.definition.compared.pan=this.definition.compared.pan*h,r.definition.compared.rotate=this.definition.compared.rotate*h,r.update(),this.segments.push(r));y.definition?y.definition.copyFrom(this.definition):y.definition=this.definition.clone();y.definition.compared.sourceZoom=
f;y.definition.compared.pan=this.definition.compared.pan*e;y.definition.compared.rotate=this.definition.compared.rotate*e;y.update();this._descensionSegment=y;this.segments.push(y)};n._updateWithoutApex=function(){const [f]=this._preallocSegments;f.update(this.definition);this.segments.push(f)};return l}(d.Path);a.Path=d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/animation/pointToPoint/Path":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/time"],
function(a,b,c){let d=function(){function g(){this.segments=[]}var x=g.prototype;x.interpolateComponentsAt=function(w,l){w=Math.min(Math.max(w,0),1);w*=this.time;var n=0,f=0;const e=this.definition;for(let k=0;k<this.segments.length;k++){const r=this.segments[k],y=r.definition;if(w<=r.time||k===this.segments.length-1)return l=this.segmentInterpolateComponentsAt(r,w/r.time,l),l.pan=e.hasPan?(n+y.compared.pan*l.pan)/e.compared.pan:1,l.rotate=e.hasRotate?(f+y.compared.rotate*l.rotate)/e.compared.rotate:
1,w=l.zoom*(y.compared.targetZoom-y.compared.sourceZoom)+y.compared.sourceZoom,n=this.segments[0].definition.compared.sourceZoom,f=this.segments[this.segments.length-1].definition.compared.targetZoom,l.zoom=e.hasZoom?(w-n)/(f-n):1,l;w-=r.time;n+=y.compared.pan;f+=y.compared.rotate}};x.segmentInterpolateComponentsAt=function(w,l,n){return w.interpolateComponentsAt(l,n)};b._createClass(g,[{key:"time",get:function(){return this.segments.reduce((w,l)=>c.Seconds(w+l.time),c.Seconds(0))}}]);return g}();
a.Path=d;a.default=d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/animation/pointToPoint/Segment":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/time"],function(a,b,c){let d=function(){function g(w){w&&this.update(w)}var x=g.prototype;x.update=function(w){w&&(this.definition?this.definition.copyFrom(w):this.definition=w.clone());this._updatePrecomputedVariables();this._updatePixelFlow()};x._updatePrecomputedVariables=function(){var w=this.definition;
const l=w.compared,n=l.sourceZoom,f=l.targetZoom;this._zoomSign=n>f?1:-1;this._panPixelsAtSource=l.pan*w.source.pixelsPerPanAtZoom(n);w=(w.source.pixelsPerRotateAtZoom(n)+w.target.pixelsPerRotateAtZoom(f))/2;this._rotatePixels=l.rotate*w};x._updatePixelFlow=function(){var w=this.definition.compared.sourceZoom,l=this.definition.compared.targetZoom;const {hasZoom:n,hasPan:f,hasRotate:e}=this.definition;var k=0,r=0;n&&(f&&(k=(l/w-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),
e&&(r=Math.log(w/l)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/this._rotatePixels));this._rotatePixelFlow=this._panPixelFlow=this._zoomPixelFlow=0;w=this.definition.desiredPixelFlow;n&&f&&e?(l=k+r+k*r,this._zoomPixelFlow=k*r/l*w,this._panPixelFlow=r/l*w,this._rotatePixelFlow=k/l*w):n&&f?(r=1+k,this._zoomPixelFlow=k/r*w,this._panPixelFlow=1/r*w):n&&e?(k=1+r,this._zoomPixelFlow=r/k*w,this._rotatePixelFlow=1/k*w):f&&e?(k=this._panPixelsAtSource/this._rotatePixels,r=1+k,this._panPixelFlow=
k/r*w,this._rotatePixelFlow=1/r*w):f?this._panPixelFlow=w:n?this._zoomPixelFlow=w:e&&(this._rotatePixelFlow=w);this._time=e?this.rotateTime:n?this.zoomTime:f?this.panTime:c.Seconds(0)};x._interpolateComponentsZoom=function(w){if(0===w||1===w)return w;if(this.definition.hasZoom){const l=this.definition.compared.sourceZoom,n=this.definition.compared.targetZoom;return(l*(l/n)**-w-l)/(n-l)}return w};x._interpolateComponentsPan=function(w){if(0===w||1===w)return w;if(this.definition.hasPan&&this.definition.hasZoom){const l=
-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*this._panPixelFlow*(2**(l*w*this._time)-1)/(l*Math.LN2)}return w};x._interpolateComponentsRotate=function(w){return w};x.interpolateComponentsAt=function(w,l){w=Math.min(Math.max(w,0),1);const n=this._interpolateComponentsZoom(w),f=this._interpolateComponentsPan(w);w=this._interpolateComponentsRotate(w);l?(l.zoom=n,l.pan=f,l.rotate=w):l={zoom:n,pan:f,rotate:w};return l};b._createClass(g,[{key:"time",
get:function(){return this._time}},{key:"rotateTime",get:function(){return this.definition.hasRotate?c.Seconds(this._rotatePixels/this._rotatePixelFlow):c.Seconds(0)}},{key:"zoomTime",get:function(){return this.definition.hasZoom?c.Seconds(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/this._zoomPixelFlow):c.Seconds(0)}},{key:"panTime",get:function(){if(this.definition.hasPan){if(this.definition.hasZoom){const w=
-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2;return c.Seconds(Math.log(this._zoomPixelFlow/this._panPixelFlow*this._panPixelsAtSource*w+1)/(w*this._zoomPixelFlow))}return c.Seconds(this._panPixelsAtSource/this._panPixelFlow)}return c.Seconds(0)}}]);return g}();a.Segment=d;a.default=d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/animation/pointToPoint/apex/planning":function(){define(["exports","./functions"],function(a,b){function c(d,g){const x=Math.max(d.compared.sourceZoom,
d.compared.targetZoom);d=d.source.zoomAtPixelsPerPan(d.desiredPixelFlow/d.compared.pan)/2;return d<x?null!=g.maximumDistance?x+(g.maximumDistance-x)/2:1.5*x:g.maximumDistance?Math.min(g.maximumDistance,d):d}a.optimalDistance=function(d,g){let x=c(d,g);const w={ascensionFactor:null!=g.ascensionFactor?g.ascensionFactor:.5,descensionFactor:null!=g.descensionFactor?g.descensionFactor:.5};var l=0===w.ascensionFactor,n=0===w.descensionFactor;const f=l?b.tAscensionZoomOnly:b.tAscensionZoomPan,e=l?b.dtAscensionZoomOnly:
b.dtAscensionZoomPan,k=l?b.ddtAscensionZoomOnly:b.ddtAscensionZoomPan,r=n?b.tDescensionZoomOnly:b.tDescensionZoomPan,y=n?b.dtDescensionZoomOnly:b.dtDescensionZoomPan,p=n?b.ddtDescensionZoomOnly:b.ddtDescensionZoomPan;l=v=>f(d,v,w)+b.tPanion(d,v,w)+r(d,v,w);n=v=>e(d,v,w)+b.dtPanion(d,v,w)+y(d,v,w);const h=v=>k(d,v,w)+b.ddtPanion(d,v,w)+p(d,v,w);let m=l(x);const u=b.tBaseLine(d),t=g.maximumIterations||20,q=null!=g.maximumDistance?g.maximumDistance:Infinity;for(g=0;g<t;g++){var z=(n(x)+1E-6)/h(x);if(isNaN(z)||
x>=q&&0>z){if(!isFinite(q))return null;x=q;m=l(x);break}x-=z;if(x<d.compared.sourceZoom||x<d.compared.targetZoom)return null;z=l(x);if(.005>=Math.abs(z-m)/m)break;m=z}return m>.7*u||x<d.compared.sourceZoom||x<d.compared.targetZoom?null:x};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/animation/pointToPoint/apex/functions":function(){define(["exports"],function(a){a.ddtAscensionZoomOnly=function(b,c){return-b.halfWindowSize/(c*c*b.desiredPixelFlow*Math.LN2)};a.ddtAscensionZoomPan=
function(b,c,d){const g=c-b.compared.sourceZoom,x=1/g,w=1/c,l=Math.log(b.compared.sourceZoom*w);d=(d.ascensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(g))/b.halfWindowPanAtZoom(1);return b.halfWindowSize*x*(-2*x*w*d+2*x*l+2*w-2*l*d/(g*g)-d/(c*c))/(b.desiredPixelFlow*Math.LN2)};a.ddtDescensionZoomOnly=function(b,c){return-b.halfWindowSize/(c*c*b.desiredPixelFlow*Math.LN2)};a.ddtDescensionZoomPan=function(b,c,d){const g=c-b.compared.targetZoom,x=1/g,w=1/c,l=Math.log(c/b.compared.targetZoom);
d=(b.halfWindowPanAtZoom(c)+d.descensionFactor*Math.LN2*b.compared.pan-b.halfWindowPanAtZoom(b.compared.targetZoom))/b.halfWindowPanAtZoom(1);return b.halfWindowSize*x*(-2*x*w*d-2*x*l+2*w+2*l*d/(g*g)-d/(c*c))/(b.desiredPixelFlow*Math.LN2)};a.ddtPanion=function(b,c,d){return-2*b.compared.pan*b.halfWindowSize*(d.ascensionFactor+d.descensionFactor-1)/(b.desiredPixelFlow*b.halfWindowPanAtZoom(c*c*c))};a.dtAscensionZoomOnly=function(b,c){return b.halfWindowSize/(c*b.desiredPixelFlow*Math.LN2)};a.dtAscensionZoomPan=
function(b,c,d){const g=1/c,x=Math.log(b.compared.sourceZoom*g),w=1/b.desiredPixelFlow,l=1/Math.LN2;c-=b.compared.sourceZoom;const n=1/c;d=(d.ascensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(c))/b.halfWindowPanAtZoom(1);return b.halfWindowSize*g*w*l*n*d-b.halfWindowSize*x*w*l*n+b.halfWindowSize*x*w*l*d/(c*c)};a.dtDescensionZoomOnly=function(b,c){return b.halfWindowSize/(c*b.desiredPixelFlow*Math.LN2)};a.dtDescensionZoomPan=function(b,c,d){const g=Math.log(c/b.compared.targetZoom),x=1/
b.desiredPixelFlow,w=1/Math.LN2,l=-c+b.compared.targetZoom,n=1/l;d=(-b.halfWindowPanAtZoom(c)-d.descensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(b.compared.targetZoom))/b.halfWindowPanAtZoom(1);return-b.halfWindowSize*g*x*w*n+b.halfWindowSize*g*x*w*d/(l*l)+b.halfWindowSize*x*w*n*d/c};a.dtPanion=function(b,c,d){return b.compared.pan*b.halfWindowSize*(d.ascensionFactor+d.descensionFactor-1)/(b.desiredPixelFlow*b.halfWindowPanAtZoom(c*c))};a.tAscensionZoomOnly=function(b,c){return-b.halfWindowSize*
Math.log(b.compared.sourceZoom/c)/(b.desiredPixelFlow*Math.LN2)};a.tAscensionZoomPan=function(b,c,d){const g=b.halfWindowPanAtZoom(c-b.compared.sourceZoom);return-b.halfWindowSize*(d.ascensionFactor*Math.LN2*b.compared.pan+g)*Math.log(b.compared.sourceZoom/c)/(b.desiredPixelFlow*Math.LN2*g)};a.tBaseLine=function(b){const c=Math.LN2*b.compared.pan,d=b.halfWindowPanAtZoom(b.compared.sourceZoom-b.compared.targetZoom),g=b.halfWindowSize*Math.log(b.compared.sourceZoom/b.compared.targetZoom)/(b.desiredPixelFlow*
Math.LN2*d);return b.compared.sourceZoom<=b.compared.targetZoom?g*(c-d):g*(c+d)};a.tDescensionZoomOnly=function(b,c){return b.halfWindowSize*Math.log(c/b.compared.targetZoom)/(b.desiredPixelFlow*Math.LN2)};a.tDescensionZoomPan=function(b,c,d){return b.halfWindowSize*(-b.halfWindowPanAtZoom(c)-d.descensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(b.compared.targetZoom))*Math.log(c/b.compared.targetZoom)/(b.desiredPixelFlow*Math.LN2*b.halfWindowPanAtZoom(-c+b.compared.targetZoom))};a.tPanion=
function(b,c,d){return-b.compared.pan*b.halfWindowSize*(d.ascensionFactor+d.descensionFactor-1)/(b.desiredPixelFlow*b.halfWindowPanAtZoom(c))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/AnimationController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/set ../../../../core/accessorSupport/decorators/subclass ../../../ViewAnimation ./CameraController".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r){a.AnimationController=function(y){function p(){return y.apply(this,arguments)||this}b._inheritsLoose(p,y);var h=p.prototype;h.onControllerStart=function(){this.state=r.State.Running;d.isSome(this.viewAnimation)&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())};h.updateStateFromViewAnimation=function(){!d.isSome(this.viewAnimation)||this.state!==r.State.Ready&&this.state!==r.State.Running||(this.viewAnimation.state===
k.State.FINISHED?this.finish():this.viewAnimation.state===k.State.STOPPED&&(this.state=r.State.Stopped))};h.onControllerEnd=function(){d.isSome(this.viewAnimation)&&!this.viewAnimation.done&&(this.state===r.State.Finished?this.viewAnimation.finish():this.state===r.State.Stopped&&this.viewAnimation.stop());this._asyncResult&&(this.state===r.State.Finished?this._asyncResult.resolve():this._asyncResult.reject(g.createAbortError()))};h.finish=function(){this.finishController()};b._createClass(p,[{key:"canStop",
get:function(){return!0}},{key:"asyncResult",get:function(){return this._asyncResult},set:function(m){this._asyncResult&&(this._asyncResult.reject(g.createAbortError()),this._asyncResult=null);this.state===r.State.Finished||this.state===r.State.Stopped?this.state===r.State.Finished?m.resolve():m.reject(g.createAbortError()):this._asyncResult=m}}]);return p}(r.CameraController);a.AnimationController=c.__decorate([e.subclass("esri.views.3d.state.controllers.AnimationController")],a.AnimationController);
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/CameraController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,d,g,x,w,l,n){a.State=void 0;(function(f){f.Ready=
"ready";f.Rejected="rejected";f.Running="running";f.Stopped="stopped";f.Finished="finished"})(a.State||(a.State={}));a.CameraController=function(f){function e(){var r=f.apply(this,arguments)||this;r.state=a.State.Ready;return r}b._inheritsLoose(e,f);var k=e.prototype;k.stopController=function(){return this.canStop?(this.state=a.State.Stopped,!0):!1};k.finishController=function(){this.state=a.State.Finished};b._createClass(e,[{key:"active",get:function(){return this.state===a.State.Running}},{key:"isInteractive",
get:function(){return!1}},{key:"canStop",get:function(){return!1}},{key:"steppingFinished",get:function(){return!1}}]);return e}(d);c.__decorate([g.property({readOnly:!0})],a.CameraController.prototype,"active",null);c.__decorate([g.property()],a.CameraController.prototype,"state",void 0);a.CameraController=c.__decorate([n.subclass("esri.views.3d.state.controllers.CameraController")],a.CameraController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/utils/navigationUtils":function(){define("exports ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/axisAngle ../../../../geometry/support/coordinateSystem ../../../../geometry/support/plane ../../../../chunks/sphere ../../../../geometry/support/vector ../../../../geometry/support/vectorStacks ../../support/mathUtils ../../support/geometryUtils/ray ../../support/geometryUtils/sphere ../../webgl-engine/lib/Camera".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q){function z(pa,wa,na){na=g.fromRotation(h.sm4d.get(),na[3],e.axis(na));n.subtract(ja,pa.eye,wa);n.transformMat4(ja,ja,na);pa.eye=n.add(ja,ja,wa);n.subtract(ja,pa.center,wa);n.transformMat4(ja,ja,na);pa.center=n.add(ja,ja,wa);pa.up=n.transformMat4(ja,pa.up,na)}function v(pa,wa){n.set(wa,0,0,0);for(const na of pa)n.add(wa,wa,na);n.scale(wa,wa,1/pa.length)}function B(pa,wa,na,qa){return Math.sin(pa/n.length(wa))*(na+qa.radius)}function A(pa,wa,na,qa){na=
u.fromScreenAtEye(wa,na,ya);if(c.isNone(na))return!1;y.closestPointOnSilhouette(pa,na,N);return y.intersectRay(pa,na,qa)?n.squaredDistance(N,na.origin)<n.squaredDistance(qa,na.origin)?(n.copy(qa,N),!1):!0:(n.subtract(T,wa.eye,wa.center),n.normalize(T,T),r.fromNormalAndOffset(T,-n.dot(n.normalize(T,T),N),S),r.intersectRay(S,na,qa),!1)}function E(pa,wa,na,qa,ta,Fa){n.cross(ra,pa,wa);n.subtract(la,pa,wa);n.length(pa)<=ta||!qa.aboveGround?(n.cross(na,la,qa.eye),pa=n.dot(pa,wa)/(n.length(pa)*n.length(wa)),
Fa=Math.cos(b.clamp(m.cyclicalPI.normalize(b.deg2rad(Fa)),0,R)),wa=-b.acosClamped(pa)-Math.max(0,n.length(wa)-ta)/(Fa*ta)):(n.subtract(H,qa.eye,qa.center),n.cross(na,la,H),wa=-n.length(la)/ta);n.normalize(na,na);n.scale(na,na,n.length(ra));return wa}function C(pa,wa,na,qa){qa=Math.cos(b.clamp(m.cyclicalPI.normalize(b.deg2rad(qa)),0,R));wa=wa>na?-(wa-na)/(qa*na):wa<-na?Math.PI-(wa+na)/(qa*na):b.acosClamped(wa/na);return((pa>na?-(pa-na)/(qa*na):pa<-na?Math.PI-(pa+na)/(qa*na):b.acosClamped(pa/na))-wa)*
na}function D(pa,wa,na,qa,ta,Fa,Ha,Ka,La,Ra){La=C(pa[2],wa[2],Ha[3],La);wa=Ra?C(pa[0],wa[0],Ha[3],180):wa[0]-pa[0];pa=Math.sin(Ka)*wa-Math.cos(Ka)*La;Ka=Math.cos(Ka)*wa+Math.sin(Ka)*La;n.normalize(ja,ta);ta=Ra?pa/Math.sqrt(Math.abs(Ha[3]**2-n.dot(na,ja)**2)):pa/Ha[3];na=Ka/Math.sqrt(Math.abs(Ha[3]**2-n.dot(na,qa)**2));w.set(Fa,ta,na)}function F(pa,wa,na,qa,ta,Fa,Ha,Ka,La,Ra){n.cross(ra,pa,wa);k.coordinateSystemFromOneAxisAndNormalVector(Fa.up,Fa.eye,Y,aa,X);k.coordinateSystemFromOneAxisAndNormalVector([0,
0,1],Fa.eye,Q,W,V);n.copy(na,W);n.copy(qa,Q);n.normalize(na,na);n.scale(na,na,n.length(ra));k.vectorCoordinates(pa,n.normalize(aa,aa),n.normalize(X,X),n.normalize(Y,Y),ba);k.vectorCoordinates(wa,aa,X,Y,ha);D(ba,ha,pa,Q,W,ta,Ha,Ka,La,Ra)}function G(pa,wa,na,qa,ta,Fa,Ha){g.fromRotation(ea,ta,qa);g.fromRotation(ca,Ha,Fa);g.multiply(Z,ea,ca);n.subtract(wa,pa,na);n.transformMat4(wa,wa,Z);n.add(wa,wa,na)}function J(pa,wa,na,qa,ta,Fa){g.fromRotation(ea,qa,na);g.fromRotation(ca,Fa,ta);g.multiply(Z,ea,ca);
n.subtract(ja,pa.eye,wa);n.transformMat4(ja,ja,Z);pa.eye=n.add(ja,ja,wa);n.subtract(ja,pa.center,wa);n.transformMat4(ja,ja,Z);pa.center=n.add(ja,ja,wa);n.subtract(ja,pa.up,wa);n.transformMat4(ja,ja,Z);pa.up=n.add(ja,ja,wa)}function I(pa,wa,na,qa,ta,Fa,Ha=U.Pole,Ka=U.Angle){pa=Math.abs(pa[2])<na*Ha||Math.abs(wa)>na;return(Math.abs(qa)>Math.PI-Ka||Math.abs(qa)<Ka)&&pa&&Fa.aboveGround&&ta<U.Tilt?!0:!1}function O(pa,wa,na,qa,ta,Fa){Fa?(e.fromPoints(na,qa,ia),z(wa,pa,ia)):(na=E(na,qa,va,wa,pa[3],ta),z(wa,
pa,e.wrapAxisAngle(va,na)))}function P(pa,wa,na,qa,ta,Fa,Ha){const Ka=Ha?20:1;n.copy(fa,qa);ma.copyFrom(wa);let La;for(let Ra=0;Ra<Ka&&1E-12<n.squaredDistance(na,fa);Ra++)if(qa=n.squaredDistance(na,fa),F(na,fa,W,Q,ka,ma,pa,ta,Fa,Ha),J(ma,pa,Q,ka[1],W,ka[0]),G(fa,fa,pa,Q,ka[1],W,ka[0]),La=n.squaredDistance(na,fa),La<qa||0===Ra)wa.copyFrom(ma);else break}const K=d.createScreenPointArray();a.NavigationMode=void 0;(function(pa){pa[pa.Vertical=0]="Vertical";pa[pa.Horizontal=1]="Horizontal"})(a.NavigationMode||
(a.NavigationMode={}));const M={Elevation:3E4,Angle:b.deg2rad(6)},U={Pole:.95,Angle:b.deg2rad(18),Tilt:45},R=b.deg2rad(80),L=f.create(),N=f.create(),T=f.create(),S=r.create(),H=f.create(),Q=f.create(),W=f.create(),V=f.create(),Y=f.create(),aa=f.create(),X=f.create(),ba=f.create(),ha=f.create(),ka=l.create(),ia=e.create(),ea=x.create(),ca=x.create(),Z=x.create(),fa=f.create(),ja=f.create(),la=f.create(),ma=new q.default,ra=f.create(),va=f.create(),ya={origin:f.create(),direction:f.create()},za={origin:f.create(),
direction:f.create()};a.DISTANCE_CLAMP_VALUES=[1,3E8];a.PIVOT_DISTANCE_MODIFIER=30;a.PreservingHeadingThreshold=U;a.SCREEN_PIXEL_AREA=70;a.TiltThresholdPanningSpeed=R;a.VerticalPanTresholds=M;a.applyPanPlanar=function(pa,wa,na){n.subtract(L,na,wa);pa.eye=n.subtract(ja,pa.eye,L);pa.center=n.subtract(ja,pa.center,L)};a.applyPanSphericalDirectRotation=O;a.applyPanSphericalPreserveHeading=P;a.applyRotation=z;a.applyRotationWithTwoAxes=J;a.applyZoomOnSphere=function(pa,wa,na){wa.getScreenCenter(K);t.intersectScreen(pa,
wa,K,ja)&&(wa.center=ja);pa=wa.distance;na*=pa;1E-6>Math.abs(pa-na)||(na=n.scale(h.sv3d.get(),wa.viewForward,na),wa.eye=n.subtract(ja,wa.center,na))};a.applyZoomToPoint=function(pa,wa,na,qa){const ta=h.sv3d.get();na=1-na;n.subtract(ta,wa,pa.eye);const Fa=n.length(ta);let Ha=Fa*(1-na);0<=na&&Ha<qa&&(Ha=qa,na=-(Ha-Fa)/Fa);1E-6>Math.abs(Fa-Ha)||(n.scale(ta,ta,na),pa.eye=n.add(ja,pa.eye,ta),pa.center=n.lerp(ja,pa.center,wa,na))};a.centroid=v;a.centroidOnSphere=function(pa,wa,na){v(wa,na);n.normalize(na,
na);n.scale(na,na,pa)};a.decideNavigationMode=function(pa,wa,na,qa){if(n.length(pa.eye)-qa.radius>M.Elevation)return a.NavigationMode.Horizontal;if(!na)return a.NavigationMode.Vertical;u.fromScreenAtEye(pa,wa,za);return-Math.sign(pa.relativeElevation)*(.5*Math.PI+p.angle(pa.eye,za.direction))<M.Angle?a.NavigationMode.Vertical:a.NavigationMode.Horizontal};a.intersectPlaneFromScreenPoint=function(pa,wa,na,qa){return r.intersectRay(pa,u.fromScreen(wa,na,ya),qa)};a.intersectPlaneFromScreenPointAtEye=
function(pa,wa,na,qa){return r.intersectRay(pa,u.fromScreenAtEye(wa,na,ya),qa)};a.lengthFromPoints=C;a.normalizeCoordinate=function(pa,wa,na){na[0]=wa[0]/(pa.fullWidth/pa.pixelRatio);na[1]=wa[1]/(pa.fullHeight/pa.pixelRatio);return na};a.normalizeRotationDelta=function(pa){for(;pa>Math.PI;)pa-=2*Math.PI;for(;pa<-Math.PI;)pa+=2*Math.PI;return pa};a.offSurfaceTiltToEyeTiltGlobal=function(pa,wa,na,qa){return B(Math.PI/2,wa,na,qa)+(pa-Math.PI/2)};a.onSurfaceTiltToEyeTiltGlobal=B;a.panMotionToRotationMatrix=
function(pa,wa,na,qa,ta,Fa,Ha,Ka,La){if(I(pa.center,n.dot(pa.up,pa.center),n.length(pa.center),-m.cyclicalPI.normalize(b.deg2rad(Fa)),Ha,wa))switch(pa=-m.cyclicalPI.normalize(b.deg2rad(ta)),{eye:ta}=wa,k.coordinateSystemFromOneAxisAndNormalVector([0,0,1],ta,Q,W,V),ta=na.translation[0]*qa.pan,Fa="zoom"===La.mode?0:na.translation[1]*qa.pan,wa=Math.max(Math.sqrt(Math.abs(1-n.dot(wa.center,Q)**2/n.length(wa.center)**2)),.5),Ha=-Math.cos(pa)*Fa+Math.sin(pa)*ta,g.rotate(Ka.pan.matrix,Ka.pan.matrix,(Math.sin(pa)*
Fa+Math.cos(pa)*ta)/wa,Q),Ka.pan.enabled=!0,La.mode){case "pan":g.rotate(Ka.pan.matrix,Ka.pan.matrix,Ha,W);Ka.pan.enabled=!0;break;case "zoom":Ka.zoom=-na.translation[1]*qa.zoom}else{{const {eye:Ra,viewRight:ab}=wa;wa=n.cross(h.sv3d.get(),ab,Ra);pa=na.translation[0]*qa.pan;0!==pa&&(g.rotate(Ka.pan.matrix,Ka.pan.matrix,-pa,wa),Ka.pan.enabled=!0);switch(La.mode){case "pan":na=na.translation[1]*qa.pan;0!==na&&(g.rotate(Ka.pan.matrix,Ka.pan.matrix,na,ab),Ka.pan.enabled=!0);break;case "zoom":Ka.zoom=-na.translation[1]*
qa.zoom}}}};a.panToPosition=function(pa,wa,na,qa,ta,Fa,Ha){I(na,n.dot(wa.up,na),pa[3],-m.cyclicalPI.normalize(b.deg2rad(ta)),Fa,wa,U.Pole,U.Angle)?P(pa,wa,na,qa,-m.cyclicalPI.normalize(b.deg2rad(ta)),Fa,Ha):O(pa,wa,na,qa,Fa,Ha)};a.pickPointAndInitSphere=function(pa,wa,na,qa,ta){const Fa=f.create(),Ha=y.create();let Ka=!0,La=!0;pa.intersectScreen(na,Fa)?Ha[3]=n.length(Fa):(La=!1,Ha[3]=wa.aboveGround?Math.max(n.length(wa.center),.9*ta.radius):n.length(wa.eye)-wa.relativeElevation,qa?A(Ha,wa,na,Fa):
Ka=t.intersectScreen(Ha,wa,na,Fa));return{sphere:Ha,scenePickPoint:Ka?Fa:null,hasGeometryIntersection:La}};a.preserveHeadingThreshold=I;a.rotatePointAroundTwoAxes=G;a.rotationAngleAndAxisDirectRotation=E;a.rotationAnglesAndAxesHeadingPreserving=F;a.rotationAnglesHeadingPreserving=D;a.rotationFromPointsAroundAxis=function(pa,wa,na){const qa=h.sv3d.get(),ta=h.sv3d.get(),Fa=h.sv3d.get();n.copy(ta,pa);n.copy(Fa,wa);pa=n.dot(ta,na);wa=n.dot(Fa,na);n.scale(qa,na,pa);n.subtract(ta,ta,qa);n.normalize(ta,
ta);n.scale(qa,na,wa);n.subtract(Fa,Fa,qa);n.normalize(Fa,Fa);pa=n.dot(ta,Fa);n.cross(qa,na,ta);na=n.dot(Fa,qa);return Math.atan2(na,pa)};a.sphereOrPlanePointFromScreenPoint=A;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/geometryUtils/ray":function(){define("exports ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../geometry/support/vectorStacks".split(" "),function(a,b,c,d,g,x){function w(n,f,e){const k=c.castRenderScreenPointArray3(d.copy(x.sv3d.get(),
f));k[2]=0;if(!n.unprojectFromRenderScreen(k,e.origin))return null;f=c.castRenderScreenPointArray3(d.copy(x.sv3d.get(),f));f[2]=1;n=n.unprojectFromRenderScreen(f,x.sv3d.get());if(b.isNone(n))return null;g.subtract(e.direction,n,e.origin);return e}function l(n,f,e){g.copy(e.origin,n.eye);f=g.set(x.sv3d.get(),f[0],f[1],1);n=n.unprojectFromRenderScreen(f,x.sv3d.get());if(b.isNone(n))return null;g.subtract(e.direction,n,e.origin);return e}a.fromRender=w;a.fromRenderAtEye=l;a.fromScreen=function(n,f,e){return w(n,
n.screenToRender(f,c.castRenderScreenPointArray3(x.sv3d.get())),e)};a.fromScreenAtEye=function(n,f,e){return l(n,n.screenToRender(f,c.castRenderScreenPointArray3(x.sv3d.get())),e)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/geometryUtils/sphere":function(){define(["exports","../../../../geometry/support/ray","../../../../chunks/sphere","./ray"],function(a,b,c,d){const g=b.create();a.intersectScreen=function(x,w,l,n){w=d.fromScreenAtEye(w,l,g);return c.intersectRay(x,
w,n)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/local/ZoomStepController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/time ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/set ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../camera/constraintUtils ../../../camera/constraintUtils/common ../PointToPointAnimationController ../../../webgl-engine/lib/Camera ../../../webgl-engine/lib/Intersector ../../../../animation/easing".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u){a.ZoomStepController=function(q){function z(){var B=q.apply(this,arguments)||this;B.zoomLocation=k.create();B.tmpCamera=new h.default;B.tmpRayDir=k.create();B.tmpCenter=k.create();B.constraintOptions={selection:y.ConstraintTypes.ALL,interactionType:y.InteractionType.ZOOM,interactionFactor:null,interactionStartCamera:new h.default,interactionDirection:null,tiltMode:y.TiltMode.TUMBLE};return B}b._inheritsLoose(z,q);var v=z.prototype;v.zoomStep=function(B,
A){if(this.active){var E=this.view.state,{interactionStartCamera:C}=this.constraintOptions;this.animation.finished?C.copyFrom(E.camera):this.animation.cameraAt(1,C);this.tmpCamera.copyFrom(E.camera);E=m.newIntersector(this.view.state.viewingMode);0<B?(this.intersectionHelper.intersectScreenFreePointFallback(A,this.zoomLocation),this.intersectionHelper.intersectRay(this.tmpCamera.ray,E,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter)):this.intersectionHelper.intersectRay(this.tmpCamera.ray,
E,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:e.copy(this.zoomLocation,this.tmpCamera.center);B=.6**B;A=this.view._stage.renderView.getMinimalDepthForArea(this.view.getVoxelWasmPerSceneView(),A[0],A[1],this.view.state.camera,60);E=Math.max(14*Math.abs(this.view.camera.position.z),20);if(A=A?Math.min(A,E):E)E=k.create(),e.subtract(E,this.zoomLocation,this.tmpCamera.eye),A<e.length(E)&&(e.normalize(E,E),e.add(this.zoomLocation,this.tmpCamera.eye,e.scale(E,E,A)));this._updateCamera(this.tmpCamera,
B,this.zoomLocation);this.begin(this.tmpCamera)}};v.animationSettings=function(){return{apex:null,duration:d.Milliseconds(600),easing:u.outExpo}};v._updateCamera=function(B,A,E){e.subtract(this.tmpRayDir,E,B.eye);const C=e.length(this.tmpRayDir);let D=C*A;const F=Math.max(4,1.01*B.nearFar[0]);1>=A&&D<F&&(D=F,A=D/C);1E-6>Math.abs(C-D)||(e.scale(this.tmpRayDir,this.tmpRayDir,A),B.eye=e.subtract(t,E,this.tmpRayDir),B.center=e.lerp(t,B.center,E,1-A),r.applyAll(this.view,B,this.constraintOptions))};return z}(p.PointToPointAnimationController);
a.ZoomStepController=c.__decorate([f.subclass("esri.views.3d.state.controllers.local.ZoomStepController")],a.ZoomStepController);const t=k.create();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/input/handlers/support":function(){define(["exports"],function(a){a.eventMatchesMousePointerAction=function(b,c){if("touch"===b.pointerType)return!1;switch(c){case "primary":return 0===b.button;case "secondary":return 2===b.button;case "tertiary":return 1===b.button}};a.eventMatchesPointerAction=
function(b,c){switch(c){case "primary":return"touch"===b.pointerType||0===b.button;case "secondary":return"touch"!==b.pointerType&&2===b.button;case "tertiary":return"touch"!==b.pointerType&&1===b.button}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/DragRotate":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../state/controllers/RotateController ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(a,b,c,d,g,x){g=function(w){function l(n,f,e,k){var r=w.call(this,!0)||this;r.view=n;r.pointerAction=f;r.pivot=e;r.registerIncoming("drag",k,y=>r._handleDrag(y));return r}b._inheritsLoose(l,w);l.prototype._handleDrag=function(n){const f=n.data;if(!(1<f.pointers.size)&&x.eventMatchesMousePointerAction(n.data,this.pointerAction)){var e=c.createScreenPointArray(f.center.x,f.center.y);switch(f.action){case "start":this.cameraController&&(this.cameraController.end(),this.cameraController=null);
this.cameraController=new d.RotateController({view:this.view,pivot:this.pivot});this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(e);break;case "update":this.cameraController&&this.cameraController.update(e);break;case "end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}n.stopPropagation()}};return l}(g.InputHandler);Object.defineProperty(a,"PivotPoint",{enumerable:!0,get:()=>d.PivotPoint});a.DragRotate=g;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/state/controllers/RotateController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projectionEllipsoid ../../camera/constraintUtils ../../camera/constraintUtils/common ../Constraints ./InteractiveController ../utils/navigationUtils".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v){a.PivotPoint=void 0;(function(A){A[A.CENTER=0]="CENTER";A[A.EYE=1]="EYE"})(a.PivotPoint||(a.PivotPoint={}));a.RotateController=function(A){function E(D){D=A.call(this,D)||this;D.view=null;D.pivot=a.PivotPoint.CENTER;D.lastPoint=y.create();D.tmpWorldUp=h.create();D.tmpViewDir=h.create();D.tmpRotCurPoint=y.create();D.tmpTransf=k.create();D.tmpAxis=h.create();D.tmpPivotPoint=h.create();D.pivotPos=h.create();D.constraintOptions={selection:t.ConstraintTypes.ALL,
interactionType:t.InteractionType.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:t.TiltMode.TUMBLE};return D}b._inheritsLoose(E,A);var C=E.prototype;C.initialize=function(){this.rotScale=this.pivot===a.PivotPoint.CENTER?3:1.5};C.begin=function(D){if(this.active){switch(this.pivot){case a.PivotPoint.EYE:p.copy(this.pivotPos,this.startCamera.eye);this.constraintOptions.interactionType=t.InteractionType.LOOK_AROUND;this.constraintOptions.tiltMode=t.TiltMode.LOOK_AROUND;
this.constraintOptions.selection=t.ConstraintTypes.NONE;break;case a.PivotPoint.CENTER:this.intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this.pivotPos)||p.copy(this.pivotPos,this.startCamera.center),this._constrainPivotPoint(D),this.startCamera.center=this.pivotPos,this.constraintOptions.interactionType=t.InteractionType.TUMBLE,this.constraintOptions.tiltMode=t.TiltMode.TUMBLE,this.constraintOptions.selection=t.ConstraintTypes.ALL&~t.ConstraintTypes.DISTANCE}this.constraintOptions.interactionStartCamera=
this.startCamera;v.normalizeCoordinate(this.startCamera,D,this.lastPoint)}};C._constrainPivotPoint=function(D){const F=this.startCamera,G=h.create();p.subtract(G,this.pivotPos,F.eye);let J=p.length(G);this.view.camera.position.hasZ&&(J=Math.min(J,7*Math.abs(this.view.camera.position.z)));var I=m.getReferenceEllipsoid(this.view.spatialReference),O=g.createScreenPointArray(F.width/F.pixelRatio*.5,F.height/F.pixelRatio*.5);I=v.decideNavigationMode(this.startCamera,O,!0,I);O=this.view._stage.renderView.getMinimalDepthForArea(this.view.getVoxelWasmPerSceneView(),
F.fullWidth/F.pixelRatio*.5,F.fullHeight/F.pixelRatio*.5,F,225,90);D=this.view._stage.renderView.getMinimalDepthForArea(this.view.getVoxelWasmPerSceneView(),D[0],D[1],F,90);if(void 0!==O||void 0!==D)O=void 0===O?D:O,D=void 0===D||I===v.NavigationMode.Horizontal?O:D,J=O>D?D:O;p.normalize(G,G);p.copy(this.pivotPos,p.add(this.tmpPivotPoint,F.eye,p.scale(this.tmpPivotPoint,G,J)))};C.update=function(D){if(this.active){switch(this.pivot){case a.PivotPoint.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,
D,this.currentCamera.center,this.pivotPos);break;case a.PivotPoint.CENTER:this.currentCamera.center=this.pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,D,this.currentCamera.eye,this.pivotPos)}u.applyAll(this.view,this.currentCamera,this.constraintOptions)}};C.end=function(){this.active&&this.finishController()};C._applyRotation=function(D,F,G,J){this.view.renderCoordsHelper.worldUpAtPosition(J,this.tmpWorldUp);v.normalizeCoordinate(D,F,this.tmpRotCurPoint);F=(this.lastPoint[1]-
this.tmpRotCurPoint[1])*this.rotScale;let I=(this.tmpRotCurPoint[0]-this.lastPoint[0])*this.rotScale;p.subtract(this.tmpViewDir,G,J);G=p.length(this.tmpViewDir);G=d.acosClamped(p.dot(this.tmpViewDir,this.tmpWorldUp)/G);if(this.pivot===a.PivotPoint.EYE){const O=.5*Math.PI-G,P=.495*Math.PI;F=O-Math.max(-P,Math.min(P,O+-.5*F))}F=d.clamp(F+G,q.TiltDefault.min,q.TiltDefault.max)-G;p.cross(this.tmpAxis,D.up,this.tmpViewDir);this.pivot===a.PivotPoint.CENTER&&(I=-I);e.fromRotation(this.tmpTransf,I,this.tmpWorldUp);
e.rotate(this.tmpTransf,this.tmpTransf,F,this.tmpAxis);p.transformMat4(this.tmpViewDir,this.tmpViewDir,this.tmpTransf);D.up=p.transformMat4(B,D.up,this.tmpTransf);p.add(B,J,this.tmpViewDir);r.copy(this.lastPoint,this.tmpRotCurPoint);return B};b._createClass(E,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return E}(z.InteractiveController);c.__decorate([x.property({constructOnly:!0})],a.RotateController.prototype,"view",void 0);c.__decorate([x.property()],a.RotateController.prototype,
"pivot",void 0);a.RotateController=c.__decorate([f.subclass("esri.views.3d.state.controllers.RotateController")],a.RotateController);const B=h.create();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/InteractiveController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/set ../../../../core/accessorSupport/decorators/subclass ./CameraController ../../webgl-engine/lib/Camera".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e){a.InteractiveController=function(k){function r(){var p=k.apply(this,arguments)||this;p.startCamera=new e.default;p.currentCamera=new e.default;return p}b._inheritsLoose(r,k);var y=r.prototype;y.stepController=function(p,h){h.copyViewFrom(this.currentCamera);this.currentCamera.copyFrom(h)};y.onControllerStart=function(p){this.state=f.State.Running;this.startCamera.copyFrom(p);this.currentCamera.copyFrom(p)};y.onControllerEnd=function(p){p.copyViewFrom(this.currentCamera)};
b._createClass(r,[{key:"isInteractive",get:function(){return!0}}]);return r}(f.CameraController);a.InteractiveController=c.__decorate([n.subclass("esri.views.3d.state.controllers.InteractiveController")],a.InteractiveController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/DragZoom":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../state/controllers/global/ZoomController ../../state/controllers/local/ZoomController ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(a,b,c,d,g,x,w){x=function(l){function n(f,e,k){var r=l.call(this,!0)||this;r.view=f;r.pointerAction=e;r.registerIncoming("drag",k,y=>r._handleDrag(y));return r}b._inheritsLoose(n,l);n.prototype._handleDrag=function(f){const e=f.data;if(!(1<e.pointers.size)&&w.eventMatchesMousePointerAction(f.data,this.pointerAction)){var k=c.createScreenPointArray(e.center.x,e.center.y);switch(e.action){case "start":this.cameraController&&(this.cameraController.end(),this.cameraController=null);this.cameraController=
this.view.state.isGlobal?new d.ZoomController({view:this.view}):new g.ZoomController({view:this.view});this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(k);break;case "update":this.cameraController&&this.cameraController.update(k);break;case "end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}f.stopPropagation()}};return n}(x.InputHandler);a.DragZoom=x;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/global/ZoomController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec2 ../../../../../chunks/vec2f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/projectionEllipsoid ../../../../../geometry/support/axisAngle ../../../../../chunks/sphere ../../../camera/constraintUtils ../../../camera/constraintUtils/common ../InteractiveController ../../utils/navigationUtils ../../../support/geometryUtils/ray ../../../camera/constraintUtils/surfaceCollision".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B){a.ZoomController=function(E){function C(F){F=E.call(this,F)||this;F.view=null;F.pickPoint=y.create();F.tmpP0=k.create();F.panAxisAngle=h.create();F.tmpRayDir=y.create();F.targetOnSphere=y.create();F.tmpRay={origin:y.create(),direction:y.create()};F.dragBeginPoint=g.createScreenPointArray();F.normalizedAnchorPoint=k.create();F.constraintOptions={selection:t.ConstraintTypes.ALL_EXCEPT_COLLISION,interactionType:t.InteractionType.ZOOM,interactionFactor:0,
interactionStartCamera:null,interactionDirection:null,tiltMode:t.TiltMode.TUMBLE};F.sphere=m.create();F.hasPickPoint=!1;return F}b._inheritsLoose(C,E);var D=C.prototype;D.begin=function(F){if(this.active){e.copy(this.dragBeginPoint,F);z.normalizeCoordinate(this.startCamera,F,this.normalizedAnchorPoint);var G=p.getReferenceEllipsoid(this.view.spatialReference),J=z.pickPointAndInitSphere(this.intersectionHelper,this.startCamera,F,!1,G);this.navMode=z.decideNavigationMode(this.startCamera,F,J.hasGeometryIntersection,
G);if(this.navMode===z.NavigationMode.Horizontal)this.hasPickPoint=!!J.scenePickPoint,this.pickPoint=J.scenePickPoint,this.sphere=J.sphere;else{v.fromScreenAtEye(this.startCamera,F,this.tmpRay);r.normalize(this.tmpRay.direction,this.tmpRay.direction);let I;this.view.camera.position.hasZ&&(I=Math.abs(this.view.camera.position.z));G=d.clamp(z.PIVOT_DISTANCE_MODIFIER*I,z.DISTANCE_CLAMP_VALUES[0],z.DISTANCE_CLAMP_VALUES[1]);F=this.view._stage.renderView.getMinimalDepthForArea(null,F[0],F[1],this.view.state.camera,
z.SCREEN_PIXEL_AREA);G=G>F?F:G;this.hasPickPoint=!0;r.scale(this.tmpRay.direction,this.tmpRay.direction,G);r.add(this.pickPoint,this.tmpRay.origin,this.tmpRay.direction)}this.constraintOptions.interactionStartCamera=this.startCamera}};D.update=function(F){if(this.active){this.currentCamera.eye=this.startCamera.eye;this.currentCamera.center=this.startCamera.center;this.currentCamera.up=this.startCamera.up;if(this.navMode===z.NavigationMode.Horizontal){r.subtract(this.tmpRayDir,this.currentCamera.center,
this.currentCamera.eye);var G=r.length(this.tmpRayDir);z.normalizeCoordinate(this.currentCamera,F,this.tmpP0);var J=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]),I=G*2**J;const O=this.view.state.constraints.minimumPoiDistance;0>J&&I<O&&(I=O);if(1E-6>Math.abs(G-I))return;this.hasPickPoint&&I<G&&(J=1-(1-I/G)*(1-this.sphere[3]/r.length(this.currentCamera.center)),this.currentCamera.center=r.scale(A,this.currentCamera.center,J));r.scale(this.tmpRayDir,this.tmpRayDir,-I/G);this.currentCamera.eye=r.add(A,
this.currentCamera.center,this.tmpRayDir);this.constraintOptions.interactionFactor=u.pixelDistanceToInteractionFactor(this.dragBeginPoint,F);u.applyAll(this.view,this.currentCamera,this.constraintOptions);this.hasPickPoint&&(z.sphereOrPlanePointFromScreenPoint(this.sphere,this.currentCamera,this.dragBeginPoint,this.targetOnSphere),h.fromPoints(this.pickPoint,this.targetOnSphere,this.panAxisAngle),z.applyRotation(this.currentCamera,this.sphere,this.panAxisAngle))}else{G=r.length(this.tmpRay.direction);
z.normalizeCoordinate(this.currentCamera,F,this.tmpP0);F=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]);I=G*2**F;J=this.view.state.constraints.minimumPoiDistance;0>F&&I<J&&(I=J);if(1E-6>Math.abs(G-I))return;r.scale(this.tmpRayDir,this.tmpRay.direction,1-I/G);this.currentCamera.eye=r.add(A,this.currentCamera.eye,this.tmpRayDir);this.currentCamera.center=r.add(A,this.currentCamera.center,this.tmpRayDir)}B.applySurfaceCollisionConstraint(this.view,this.currentCamera)}};D.end=function(){this.active&&
this.finishController()};b._createClass(C,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return C}(q.InteractiveController);c.__decorate([x.property({constructOnly:!0})],a.ZoomController.prototype,"view",void 0);a.ZoomController=c.__decorate([f.subclass("esri.views.3d.state.controllers.global.ZoomController")],a.ZoomController);const A=y.create();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/local/ZoomController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec2 ../../../../../chunks/vec2f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/plane ../../../camera/constraintUtils ../../../camera/constraintUtils/common ../InteractiveController ../../utils/navigationUtils".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t){a.ZoomController=function(z){function v(A){A=z.call(this,A)||this;A.view=null;A.tmpP=y.create();A.tmpDir=y.create();A.tmpN=y.create();A.tmpP0=k.create();A.tmpPoi=y.create();A.tmpRayDir=y.create();A.dragBeginPoint=g.createScreenPointArray();A.normalizedAnchorPoint=k.create();A.constraintOptions={selection:m.ConstraintTypes.ALL,interactionType:m.InteractionType.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:y.create(),tiltMode:m.TiltMode.TUMBLE};
A.plane=p.create();return A}b._inheritsLoose(v,z);var B=v.prototype;B.begin=function(A){if(this.active){e.copy(this.dragBeginPoint,A);t.normalizeCoordinate(this.startCamera,A,this.normalizedAnchorPoint);this.intersectionHelper.intersectScreenFreePointFallback(A,this.tmpP);r.subtract(this.tmpDir,this.tmpP,this.startCamera.eye);r.normalize(this.tmpDir,this.tmpDir);var E;this.view.camera.position.hasZ&&(E=Math.abs(this.view.camera.position.z));E=d.clamp(t.PIVOT_DISTANCE_MODIFIER*E,t.DISTANCE_CLAMP_VALUES[0],
t.DISTANCE_CLAMP_VALUES[1]);A=this.view._stage.renderView.getMinimalDepthForArea(this.view.getVoxelWasmPerSceneView(),A[0],A[1],this.view.state.camera,t.SCREEN_PIXEL_AREA);r.scale(this.tmpDir,this.tmpDir,E>A?A:E);r.add(this.tmpP,this.startCamera.eye,this.tmpDir);r.subtract(this.tmpN,this.startCamera.eye,this.startCamera.center);r.normalize(this.tmpN,this.tmpN);0>this.tmpN[1]&&r.negate(this.tmpN,this.tmpN);p.fromPositionAndNormal(this.tmpP,this.tmpN,this.plane);this.constraintOptions.interactionStartCamera=
this.startCamera}};B.update=function(A){if(this.active){t.intersectPlaneFromScreenPoint(this.plane,this.currentCamera,this.dragBeginPoint,this.tmpPoi)||r.copy(this.tmpPoi,this.currentCamera.center);t.normalizeCoordinate(this.currentCamera,A,this.tmpP0);var E=4*(this.tmpP0[1]-this.normalizedAnchorPoint[1]);e.copy(this.normalizedAnchorPoint,this.tmpP0);r.subtract(this.tmpRayDir,this.tmpPoi,this.currentCamera.eye);var C=r.length(this.tmpRayDir),D=C*(1-E);r.copy(this.constraintOptions.interactionDirection,
this.tmpRayDir);r.scale(this.constraintOptions.interactionDirection,this.constraintOptions.interactionDirection,Math.sign(E)/C);var F=this.view.state.constraints.minimumPoiDistance;0<=E&&D<F&&(D=F,E=-(D-C)/C);1E-6>Math.abs(C-D)||(r.scale(this.tmpRayDir,this.tmpRayDir,E),this.currentCamera.eye=r.add(q,this.currentCamera.eye,this.tmpRayDir),r.lerp(q,this.currentCamera.center,this.tmpPoi,E),q[2]=this.tmpPoi[2]>this.startCamera.center[2]?Math.max(this.startCamera.center[2],q[2]):Math.min(this.startCamera.center[2],
q[2]),this.currentCamera.center=q,this.constraintOptions.interactionFactor=h.pixelDistanceToInteractionFactor(this.dragBeginPoint,A),h.applyAll(this.view,this.currentCamera,this.constraintOptions))}};B.end=function(){this.active&&this.finishController()};b._createClass(v,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return v}(u.InteractiveController);c.__decorate([x.property({constructOnly:!0})],a.ZoomController.prototype,"view",void 0);a.ZoomController=c.__decorate([f.subclass("esri.views.3d.state.controllers.local.ZoomController")],
a.ZoomController);const q=y.create();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/GamepadNavigation":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Handles ../../../../core/watchUtils ../../state/controllers/GamepadKeyboardController ../../../input/InputHandler".split(" "),function(a,b,c,d,g,x){x=function(w){function l(f){var e=w.call(this,!0)||this;e.view=f;e.watchHandles=new c;e.handle=e.registerIncoming("gamepad",k=>
e._handleEventGamepad(k));e.handle.pause();return e}b._inheritsLoose(l,w);var n=l.prototype;n.onInstall=function(f){w.prototype.onInstall.call(this,f);this.watchHandles.add([d.init(this.view.navigation.gamepad,"enabled",e=>{e?this.handle.resume():(this.handle.pause(),this.cameraControllerGamepad&&(this.cameraControllerGamepad.finishController(),this.cameraControllerGamepad=null))}),this.view.navigation.gamepad.watch("device",e=>{this.cameraControllerGamepad&&e&&this.cameraControllerGamepad.gamepadDevice!==
e&&(this.cameraControllerGamepad.finishController(),this.cameraControllerGamepad=null)})])};n.onUninstall=function(){this.watchHandles.removeAll();w.prototype.onUninstall.call(this)};n._handleEventGamepad=function(f){var e=this.view.navigation.gamepad.device;if(!e||f.data.device===e)if((e=this.cameraControllerGamepad&&this.cameraControllerGamepad.active)||g.GamepadKeyboardController.activatesFor(this.view,f.data))e||(e=new g.GamepadKeyboardController({view:this.view,gamepadDevice:f.data.device}),
this.view.state.switchCameraController(e)&&(this.cameraControllerGamepad=e)),this.cameraControllerGamepad&&this.cameraControllerGamepad.active&&this.cameraControllerGamepad.gamepadDevice===f.data.device&&this.cameraControllerGamepad.handleEventGamepad(f.data)};return l}(x.InputHandler);a.GamepadNavigation=x;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/GamepadKeyboardController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projectionEllipsoid ../../../../geometry/support/ray ../../../../chunks/sphere ../../../../geometry/support/vectorStacks ../../camera/constraintUtils ../../camera/constraintUtils/common ../Constraints ./InteractiveController ../utils/navigationUtils ../utils/viewUtils ../../support/cameraUtils ../../support/cameraUtilsInternal ../../webgl-engine/lib/Camera ../../../navigation/gamepadAndKeyboardUtils".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E,C,D,F,G){a.GamepadKeyboardController=function(L){function N(S){S=L.call(this,S)||this;S.transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0};S.keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0];S.tmpCamera=new F.default;S.constraintOptions={selection:z.ConstraintTypes.ALL,interactionType:z.InteractionType.NONE,interactionStartCamera:new F.default,interactionFactor:0,interactionDirection:null,tiltMode:z.TiltMode.LOOK_AROUND};return S}b._inheritsLoose(N,
L);var T=N.prototype;T.handleEventGamepad=function(S){const H=G.extractTransformation(S,this.view.navigation.gamepad,this.transformation);("end"===S.action||G.isZeroTransformation(H))&&this.finishController()};T.activateDirection=function(S){this.keysButtonState[S]=1;G.extractTransformationKeyboard(this.keysButtonState,this.transformation)};T.deactivateDirection=function(S){this.keysButtonState[S]=0;S=G.extractTransformationKeyboard(this.keysButtonState,this.transformation);G.isZeroTransformation(S)&&
this.finishController()};T.onControllerStart=function(S){this.filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z;this.headingStart=this.view.camera.heading;L.prototype.onControllerStart.call(this,S)};T._updateFilteredSurfaceElevation=function(S){this.filteredSurfaceElevation+=(this.view.pointsOfInterest.cameraOnSurface.location.z-this.filteredSurfaceElevation)*S};T.stepController=function(S,H){this._updateStartHeading();this._updateFilteredSurfaceElevation(S);this.currentCamera.copyViewFrom(H);
this._updateCameraCenter();this.constraintOptions.interactionStartCamera.copyFrom(this.currentCamera);this._calculateControlTransformation(S,this.currentCamera,K);this._applyDisabledMovementTypes(K);this._applyPan(K.pan);this._applyRotate(K.rotate);this._applyZoom(K.zoom);this._applyAscend(K.ascend);this.constraintOptions.interactionType=z.InteractionType.NONE;this.constraintOptions.selection=z.ConstraintTypes.COLLISION;q.applyAll(this.view,this.currentCamera,this.constraintOptions);L.prototype.stepController.call(this,
S,H)};T._updateStartHeading=function(){0!==this.transformation.heading&&(this.headingStart=this.view.camera.heading)};T._applyRotate=function(S){if(S.enabled){var H=this.currentCamera;y.subtract(M,H.center,H.eye);y.transformMat4(M,M,S.matrix);H.center=y.add(M,M,H.eye);H.up=y.transformMat4(M,H.up,S.matrix);this.constraintOptions.interactionType=z.InteractionType.LOOK_AROUND;this.constraintOptions.selection=z.ConstraintTypes.ALL_EXCEPT_COLLISION;q.applyAll(this.view,H,this.constraintOptions)}};T._applyPan=
function(S,H=this.currentCamera){S.enabled&&(H.eye=y.transformMat4(M,H.eye,S.matrix),H.center=y.transformMat4(M,H.center,S.matrix),this.view.state.isGlobal&&(H.up=y.transformMat4(M,H.up,S.matrix)),this.constraintOptions.interactionType=z.InteractionType.PAN,this.constraintOptions.selection=z.ConstraintTypes.ALL,q.applyAll(this.view,H,this.constraintOptions))};T._applyZoom=function(S){if(S){var H=this.currentCamera.viewForward;this.currentCamera.eye=y.add(M,this.currentCamera.eye,y.scale(t.sv3d.get(),
H,S));y.copy(U,H);y.negate(U,U);this.constraintOptions.interactionDirection=U;this.constraintOptions.interactionType=z.InteractionType.ZOOM;this.constraintOptions.selection=z.ConstraintTypes.ALL_EXCEPT_COLLISION;q.applyAll(this.view,this.currentCamera,this.constraintOptions);this.constraintOptions.interactionDirection=null}};T._applyAscend=function(S){if(S){var H=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,t.sv3d.get());this.constraintOptions.interactionDirection=y.copy(U,
H);this.view.state.isGlobal?(H=y.length(this.currentCamera.eye),S=(H+S)/H,this.currentCamera.eye=y.scale(M,this.currentCamera.eye,S),this.currentCamera.center=y.scale(M,this.currentCamera.center,S)):(S=y.scale(t.sv3d.get(),H,S),this.currentCamera.eye=y.add(M,this.currentCamera.eye,S),this.currentCamera.center=y.add(M,this.currentCamera.center,S));this._updateCameraCenter();this.constraintOptions.interactionType=z.InteractionType.ASCEND;this.constraintOptions.selection=z.ConstraintTypes.COLLISION;
q.applyAll(this.view,this.currentCamera,this.constraintOptions)&&this._updateCameraCenter();this.constraintOptions.selection=z.ConstraintTypes.ALL_EXCEPT_COLLISION;q.applyAll(this.view,this.currentCamera,this.constraintOptions);this.constraintOptions.interactionDirection=null}};T._calculateControlTransformation=function(S,H,Q){Q.zoom=0;Q.ascend=0;Q.pan.enabled=!1;k.identity(Q.pan.matrix);Q.rotate.enabled=!1;k.identity(Q.rotate.matrix);S=this._computeVelocities(S);this.view.state.isLocal?this._calculateControlTransformationLocal(S,
H,Q):this._calculateControlTransformationGlobal(S,H,Q)};T._updateCameraCenter=function(){this.currentCamera.center=this.view.renderCoordsHelper.intersectManifoldClosestSilhouette(this.currentCamera.ray,this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,M)};T._calculateControlTransformationLocal=function(S,H,Q){const {viewRight:W,viewForward:V}=H,Y=this.transformation;var aa=this.view.navigation.gamepad,X=y.set(t.sv3d.get(),V[0],V[1],0);y.normalize(X,X);var ba=Y.translation[0]*
S.pan;0!==ba&&(ba=y.scale(t.sv3d.get(),W,ba),k.translate(Q.pan.matrix,Q.pan.matrix,ba),Q.pan.enabled=!0);switch(aa.mode){case "pan":aa=-Y.translation[1]*S.pan;0!==aa&&(X=y.scale(t.sv3d.get(),X,aa),k.translate(Q.pan.matrix,Q.pan.matrix,X),Q.pan.enabled=!0);Q.zoom=Y.zoom*S.zoom;break;case "zoom":Q.zoom=(-Y.translation[1]+Y.zoom)*S.zoom;break;default:d.neverReached(aa.mode)}Q.ascend=Y.translation[2]*S.ascend;X=-Y.heading*S.rotate;0!==X&&(k.rotate(Q.rotate.matrix,Q.rotate.matrix,X,this.view.renderCoordsHelper.worldUpAtPosition(H.eye,
t.sv3d.get())),Q.rotate.enabled=!0);S=Y.tilt*S.rotate;H=E.viewAngle(this.view.renderCoordsHelper,H.center,H.eye);if(H=g.clamp(H+S,v.TiltDefault.min,v.TiltDefault.max)-H)k.rotate(Q.rotate.matrix,Q.rotate.matrix,H,W),Q.rotate.enabled=!0};T._calculateControlTransformationGlobal=function(S,H,Q){const {eye:W,viewRight:V}=H,Y=this.transformation;var aa=this.view.navigation.gamepad,X=y.cross(t.sv3d.get(),V,W);y.normalize(X,X);y.negate(X,X);A.panMotionToRotationMatrix(this.startCamera,H,Y,S,this.view.camera.heading,
this.headingStart,this.view.camera.tilt,Q,aa);this.tmpCamera.copyFrom(this.currentCamera);this._applyPan(K.pan,this.tmpCamera);aa=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;Q.ascend=Y.translation[2]*S.ascend;X=-Y.heading*S.rotate;0!==X&&(k.rotate(Q.rotate.matrix,Q.rotate.matrix,X,this.tmpCamera.eye),Q.rotate.enabled=!0);H=this._clampTiltDeltaGlobalToValidRange(Y.tilt*S.rotate,H.ray,aa);0!==H&&(k.rotate(Q.rotate.matrix,Q.rotate.matrix,H,this.tmpCamera.viewRight),Q.rotate.enabled=
!0);Q.zoom+=Y.zoom*S.zoom};T._clampTiltDeltaGlobalToValidRange=function(S,H,Q){const W=h.getReferenceEllipsoid(this.view.spatialReference),V=A.onSurfaceTiltToEyeTiltGlobal(v.TiltDefault.min,H.origin,Q,W);var Y=0;let aa=0;Y=t.sv3d.get();this.view.renderCoordsHelper.intersectManifold(H,Q,Y)?(Y=E.viewAngle(this.view.renderCoordsHelper,Y,H.origin),Y=A.onSurfaceTiltToEyeTiltGlobal(Y,H.origin,Q,W),aa=A.onSurfaceTiltToEyeTiltGlobal(v.TiltDefault.max,H.origin,Q,W)):(u.closestPointOnSilhouette(u.fromRadius(Q+
W.radius),H,Y),Y=g.acosClamped(-y.dot(H.direction,y.normalize(Y,Y))),Y=A.offSurfaceTiltToEyeTiltGlobal(Y,H.origin,Q,W),aa=A.offSurfaceTiltToEyeTiltGlobal(v.TiltDefault.max,H.origin,Q,W));return g.clamp(Y+S,V,aa)-Y};T._getPointAbsoluteSurfaceElevation=function(S,H,Q){const {renderCoordsHelper:W}=this.view,V=W.getAltitude(S);H+=Math.abs(V-H);W.setAltitude(Q,H,S);return H};T._clampedDistanceToSurface=function(S,H){const {renderCoordsHelper:Q}=this.view,{camera:W}=this.view.state;var {direction:V}=C.headingTiltToDirectionUp(this.view,
H,0,80,R);V=Q.intersectManifoldClosestSilhouette(m.wrap(H,V),S,t.sv3d.get());V=y.distance(H,V);S=Q.intersectManifoldClosestSilhouette(m.wrap(H,y.direction(t.sv3d.get(),H,W.center)),S,t.sv3d.get());H=y.distance(H,S);return Math.min(V,H)};T._computeHeadingRotateRadius=function(S){const {renderCoordsHelper:H,state:Q}=this.view,{camera:W,isGlobal:V}=Q;var Y=H.intersectManifoldClosestSilhouette(W.ray,this.filteredSurfaceElevation,t.sv3d.get());if(V){const aa=y.subtract(t.sv3d.get(),S,Y);Y=y.length(aa);
y.scale(aa,aa,1/Y);S=y.normalize(t.sv3d.get(),S);S=g.acosClamped(y.dot(S,aa));return Y*Math.sin(Math.min(I,S))}S=y.copy(t.sv3d.get(),S);H.setAltitude(S,this.filteredSurfaceElevation);return y.distance(Y,S)};T._minimumAscendVelocity=function(){return this.view.state.constraints.collision.enabled?0:5};T._computeVelocities=function(S){var H=this.filteredSurfaceElevation,Q=H+h.getReferenceEllipsoid(this.view.spatialReference).radius;const {camera:W,isGlobal:V}=this.view.state;var Y=t.sv3d.get();const aa=
this._getPointAbsoluteSurfaceElevation(W.eye,H,Y);var X=this._clampedDistanceToSurface(H,Y);const ba=W.width/2,ha=.75*W.width,ka=.75*W.width;var ia=X*Math.tan(.5*W.fovX)/ba;Q=ia/Q;Y=ia/this._computeHeadingRotateRadius(Y);ia=(V?Q:ia)*ha*S;H=aa-H;H=Math.max(this._minimumAscendVelocity()*S,2**(ha*S/ba)*H-H);X=2**(ha*S/ba)*X-X;S*=g.clamp(Y*ka,O,P);return{pan:ia,ascend:H,zoom:X,rotate:S}};T._applyDisabledMovementTypes=function(S){!x.isSome(this.disableMovements)||void 0!==this.disableMovements.mode&&this.view.state.viewingMode!==
this.disableMovements.mode||(S.zoom=this.disableMovements.zoom?0:S.zoom,S.ascend=this.disableMovements.ascend?0:S.ascend,S.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&k.identity(S.pan.matrix),S.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&k.identity(S.rotate.matrix))};N.activatesFor=function(S,H){S=G.extractTransformation(H,S.navigation.gamepad,J);return!("end"===H.action||G.isZeroTransformation(S))};return N}(B.InteractiveController);c.__decorate([w.property({constructOnly:!0})],
a.GamepadKeyboardController.prototype,"view",void 0);c.__decorate([w.property({constructOnly:!0})],a.GamepadKeyboardController.prototype,"gamepadDevice",void 0);c.__decorate([w.property({constructOnly:!0})],a.GamepadKeyboardController.prototype,"disableMovements",void 0);a.GamepadKeyboardController=c.__decorate([e.subclass("esri.views.3d.state.controllers.GamepadKeyboardController")],a.GamepadKeyboardController);const J={translation:[0,0,0],heading:0,tilt:0,zoom:0},I=g.deg2rad(80),O=g.deg2rad(30),
P=g.deg2rad(80),K={zoom:0,ascend:0,pan:{enabled:!1,matrix:r.create()},rotate:{enabled:!1,matrix:r.create()}},M=p.create(),U=p.create(),R=D.createDirectionUp();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/navigation/gamepadAndKeyboardUtils":function(){define(["exports","../../chunks/vec3"],function(a,b){function c(d){let g=d*d;0>d&&(g*=-1);return g}a.extractTransformation=function(d,g,x){const w=d.state;d=d.device;g="forward-down"===g.tiltDirection?1:-1;"standard"===d.deviceType?
(x.translation[0]=c(w.axes[0]),x.translation[1]=c(w.axes[1]),x.translation[2]=c(w.buttons[7])-c(w.buttons[6]),x.heading=c(w.axes[2]),x.tilt=c(w.axes[3])):"spacemouse"===d.deviceType&&(x.translation[0]=1.2*c(w.axes[0]),x.translation[1]=1.2*c(w.axes[1]),x.translation[2]=2*-c(w.axes[2]),x.heading=1.2*c(w.axes[5]),x.tilt=1.2*c(w.axes[3]));x.tilt*=g;b.scale(x.translation,x.translation,1);return x};a.extractTransformationKeyboard=function(d,g){g.translation[0]=d[1]-d[0];g.translation[1]=d[3]-d[2];g.translation[2]=
d[4]-d[5];g.heading=d[7]-d[6];g.tilt=d[8]-d[9];g.zoom=d[10]-d[11];return g};a.isZeroTransformation=function(d){return 0===d.translation[0]&&0===d.translation[1]&&0===d.translation[2]&&0===d.heading&&0===d.tilt&&0===d.zoom};a.quadraticAccentuation=c;a.resetTransformation=function(d){d.translation[0]=0;d.translation[1]=0;d.translation[2]=0;d.heading=0;d.tilt=0;return d};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/KeyboardNavigation":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../ViewingMode","../../state/controllers/GamepadKeyboardController","../../../input/InputHandler"],function(a,b,c,d,g){var x;(function(w){w[w.LEFT=0]="LEFT";w[w.RIGHT=1]="RIGHT";w[w.FORWARD=2]="FORWARD";w[w.BACKWARD=3]="BACKWARD";w[w.UP=4]="UP";w[w.DOWN=5]="DOWN";w[w.HEADINGLEFT=6]="HEADINGLEFT";w[w.HEADINGRIGHT=7]="HEADINGRIGHT";w[w.TILTUP=8]="TILTUP";w[w.TILTDOWN=9]="TILTDOWN";w[w.ZOOMIN=10]="ZOOMIN";w[w.ZOOMOUT=11]="ZOOMOUT"})(x||(x={}));g=
function(w){function l(f,e){var k=w.call(this,!0)||this;k.view=f;k.disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:c.ViewingMode.Local};k.keyToNumber={[e.left]:x.LEFT,[e.right]:x.RIGHT,[e.forward]:x.FORWARD,[e.backward]:x.BACKWARD,[e.up]:x.UP,[e.down]:x.DOWN,[e.headingLeft]:x.HEADINGLEFT,[e.headingRight]:x.HEADINGRIGHT,[e.tiltUp]:x.TILTUP,[e.tiltDown]:x.TILTDOWN,[e.zoomIn]:x.ZOOMIN,[e.zoomOut]:x.ZOOMOUT};k.registerIncoming("key-down",null,r=>k._handleKeyDown(r));k.registerIncoming("key-up",
null,r=>k._handleKeyUp(r));k.registerIncoming("blur",null,()=>k._handleBlur());return k}b._inheritsLoose(l,w);var n=l.prototype;n._handleKeyDown=function(f){if(!f.data.native.ctrlKey&&!f.data.native.metaKey){var e=this.keyToNumber[f.data.key];null!=e&&(this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active||(this.cameraControllerKeyboard=new d.GamepadKeyboardController({view:this.view,disableMovements:this.disableMovements}),this.view.state.switchCameraController(this.cameraControllerKeyboard)),
this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.activateDirection(e),f.stopPropagation()))}};n._handleBlur=function(){this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.finishController(),this.cameraControllerKeyboard=null)};n._handleKeyUp=function(f){if(!f.data.native.ctrlKey&&!f.data.native.metaKey){var e=this.keyToNumber[f.data.key];null!=e&&this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.deactivateDirection(e),
f.stopPropagation())}};return l}(g.InputHandler);a.KeyboardNavigation=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/MouseWheelZoom":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../../input/InputHandler".split(" "),function(a,b,c,d,g,x){x=function(w){function l(n,f){var e=w.call(this,!0)||this;e.view=n;e.registerIncoming("mouse-wheel",
f,k=>e._handleMouseWheel(k));return e}b._inheritsLoose(l,w);l.prototype._handleMouseWheel=function(n){if(this.view.navigation.mouseWheelZoomEnabled){var f=n.data;this.cameraController&&this.cameraController.active||(this.cameraController=this.view.state.isGlobal?new d.ZoomStepController({view:this.view,mode:"interaction"}):new g.ZoomStepController({view:this.view,mode:"interaction"}),this.view.state.switchCameraController(this.cameraController));this.cameraController.zoomStep(-1/60*f.deltaY,c.createScreenPointArray(f.x,
f.y));n.preventDefault();n.stopPropagation()}};return l}(x.InputHandler);a.MouseWheelZoom=x;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/PinchAndPanNavigation":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../state/controllers/global/PinchAndPanController ../../state/controllers/local/PinchAndPanController ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(a,b,c,d,g,x){g=function(w){function l(f,e,k){var r=
w.call(this,!0)||this;r.view=f;r.pointerAction=e;r.lastEndTimestamp=0;r.lastTimestamp=0;r.registerIncoming("drag",k,y=>r._handleDrag(y));return r}b._inheritsLoose(l,w);var n=l.prototype;n._handleDrag=function(f){if("mouse"!==f.data.pointerType||x.eventMatchesMousePointerAction(f.data,this.pointerAction)){var e=f.timestamp-this.lastEndTimestamp;e=this.momentum&&this.momentum.active&&40>e;switch(f.data.action){case "start":case "update":if(e)break;this.controller&&this.controller.active?2<f.data.timestamp-
this.lastTimestamp&&(this.controller.update(f.data),this.lastTimestamp=f.timestamp):this._startController(f);break;case "end":case "removed":this._endController(f,!0);break;case "added":this._endController(f,!1),this._startController(f)}f.stopPropagation()}};n._endController=function(f,e){this.controller&&this.controller.active&&(this.lastEndTimestamp=f.timestamp,f=this.controller.end(f.data),e&&f&&(this.momentum=f,this.view.state.switchCameraController(this.momentum)));this.controller=null};n._startController=
function(f){this.controller=this._createController();this.view.state.switchCameraController(this.controller);this.controller.begin(f.data);this.lastTimestamp=f.timestamp};n._createController=function(){return this.view.state.isGlobal?new c.PinchAndPanController({view:this.view}):new d.PinchAndPanController({view:this.view})};return l}(g.InputHandler);a.PinchAndPanNavigation=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/global/PinchAndPanController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec2 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/projectionEllipsoid ../../../../../geometry/support/axisAngle ../../../../../geometry/support/plane ../../../../../chunks/sphere ../../../camera/constraintUtils ../../../camera/constraintUtils/common ../../../input/util ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/PanSphericalMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../momentum/ZoomSphericalMomentumController ../../utils/navigationUtils ../../../support/mathUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/PanSphericalMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E,C,D,F,G,J,I,O,P){a.PinchAndPanController=function(K){function M(R){R=K.call(this,R)||this;R.view=null;R.smoothRotation=new q.ExponentialFalloff(.05);R.rotationAxis=r.create();R.panningPlane=h.create();R.smoothScaling=new q.ExponentialFalloff(.05);R.zoomCenterScreen=g.createScreenPointArray();R.zoomMomentumEstimator=new P.ZoomMomentumEstimator;R.rotationMomentumEstimator=new O.RotationMomentumEstimator;R.panSphericalMomentumEstimator=new I.PanSphericalMomentumEstimator;
R.panPlanarMomentumEstimator=new J.PanPlanarMomentumEstimator;R.adjustedSphere=m.create();R.tmp3d=r.create();R.tmpScreenPointArray=g.createScreenPointArray();R.beginScreenPoint=g.createScreenPointArray();R.beginScenePoint=r.create();R.screenPickPoint=g.createScreenPointArray();R.navMode=D.NavigationMode.Horizontal;R.tmpInteractionDirection=r.create();R.constraintOptions={selection:t.ConstraintTypes.ALL,interactionType:t.InteractionType.NONE,interactionFactor:0,interactionStartCamera:new G.default,
interactionDirection:null,tiltMode:t.TiltMode.TUMBLE};return R}b._inheritsLoose(M,K);var U=M.prototype;U.begin=function(R){if(this.active){var L=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=L;this.rotationMomentumEstimator.enabled=L;this.panPlanarMomentumEstimator.enabled=L;this.panSphericalMomentumEstimator.enabled=L;this.beginHeading=-F.cyclicalPI.normalize(d.deg2rad(this.view.camera.heading));this.beginRadius=R.radius;this.pointerCount=R.pointers.size;this.beginAngle=
R.angle;this.smoothRotation.reset();g.screenPointObjectToArray(R.center,this.screenPickPoint);e.copy(this.beginScreenPoint,this.screenPickPoint);L=y.getReferenceEllipsoid(this.view.spatialReference);var N=D.pickPointAndInitSphere(this.intersectionHelper,this.startCamera,this.screenPickPoint,!0,L);this.scenePickPoint=N.scenePickPoint;this.sphere=N.sphere;k.copy(this.beginScenePoint,this.scenePickPoint);this.navMode=D.decideNavigationMode(this.startCamera,this.screenPickPoint,N.hasGeometryIntersection,
L);this.navMode===D.NavigationMode.Vertical&&this._preparePlanarPanMode(R);this.constraintOptions.interactionStartCamera.copyFrom(this.startCamera)}};U._preparePlanarPanMode=function(R){var L=k.negate(this.tmp3d,this.startCamera.viewForward);h.fromPositionAndNormal(this.scenePickPoint,L,this.panningPlane);var N=g.createScreenPointArray(this.screenPickPoint[0],0);L=r.create();var T=k.length(this.startCamera.eye);this.adjustedSphere[3]=T<this.sphere[3]?T-100:this.sphere[3];D.sphereOrPlanePointFromScreenPoint(this.adjustedSphere,
this.startCamera,N,L);N=g.createRenderScreenPointArray3();this.startCamera.projectToRenderScreen(L,N);this.screenPickPoint[1]=Math.min(this.screenPickPoint[1],.9*N[1]);this.intersectionHelper.intersectScreen(this.screenPickPoint,this.scenePickPoint)&&h.fromPositionAndNormal(this.scenePickPoint,h.normal(this.panningPlane),this.panningPlane);L=r.create();N=r.create();T=r.create();k.subtract(L,this.scenePickPoint,this.currentCamera.eye);k.normalize(L,L);var S=5*Math.max(Math.abs(this.view.camera.position.z),
50);const H=this.view._stage.renderView.getMinimalDepthForArea(null,this.screenPickPoint[0],this.screenPickPoint[1],this.view.state.camera,80);S=H?Math.min(H,S):S;k.copy(T,k.add(N,this.currentCamera.eye,k.scale(N,L,S)));this.panningPlane[3]=-k.dot(this.panningPlane,T);this.startCamera.center=k.add(N,this.startCamera.eye,k.scale(N,this.startCamera.viewForward,S));R=g.screenPointObjectToArray(R.center,this.tmpScreenPointArray);D.intersectPlaneFromScreenPointAtEye(this.panningPlane,this.startCamera,
R,this.beginScenePoint)};U.update=function(R){if(this.active){this.currentCamera.copyFrom(this.startCamera);var L=1<R.pointers.size;this.navMode===D.NavigationMode.Horizontal?(L&&this._zoomSpherical(R),this._panningSpherical(R),L&&this._rotateSpherical(R)):(L&&this._zoomPlanar(R),this._panningPlanar(R),L&&this._rotatePlanar(R))}};U.end=function(R){R.pointers.size===this.pointerCount&&this.update(R);this.finishController();if(R=this.zoomMomentumEstimator.evaluateMomentum())return this.navMode===D.NavigationMode.Horizontal?
new C.ZoomSphericalMomentumController({view:this.view,momentum:R,screenCenter:this.zoomCenterScreen,sceneCenter:this.beginScenePoint,radius:this.sphere[3]}):new E.ZoomPlanarMomentumController({view:this.view,momentum:R,zoomCenter:this.beginScenePoint});if(R=this.rotationMomentumEstimator.evaluateMomentum())return new A.RotationMomentumController({view:this.view,momentum:R,center:this.sphere,axis:this.rotationAxis});if(this.navMode===D.NavigationMode.Horizontal){if(R=this.panSphericalMomentumEstimator.evaluateMomentum())return new B.PanSphericalMomentumController({view:this.view,
momentum:R})}else if(R=this.panPlanarMomentumEstimator.evaluateMomentum())return new v.PanPlanarMomentumController({view:this.view,momentum:R});return null};U._zoomSpherical=function(R){const L=this.beginRadius/R.radius;this.smoothScaling.gain=.001875*Math.min(Math.max(R.radius,40),120);this.smoothScaling.update(L);D.applyZoomOnSphere(this.sphere,this.currentCamera,this.smoothScaling.value);g.screenPointObjectToArray(R.center,this.zoomCenterScreen);this.zoomMomentumEstimator.add(this.smoothScaling.value,
.001*R.timestamp);this.constraintOptions.interactionType=t.InteractionType.ZOOM;this.constraintOptions.interactionFactor=u.pixelDistanceToInteractionFactor(R.radius-this.beginRadius);u.applyAll(this.view,this.currentCamera,this.constraintOptions)};U._panningSpherical=function(R){const L=g.screenPointObjectToArray(R.center,this.tmpScreenPointArray);D.sphereOrPlanePointFromScreenPoint(this.sphere,this.currentCamera,L,this.tmp3d);D.preserveHeadingThreshold(this.beginScenePoint,k.dot(this.currentCamera.up,
this.beginScenePoint),this.sphere[3],this.beginHeading,this.view.camera.tilt,this.startCamera)?(D.applyPanSphericalPreserveHeading(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.beginHeading,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumPreserveHeading(L,this.tmp3d,.001*R.timestamp,this.startCamera,this.sphere,this.beginHeading,this.view.camera.tilt)):(D.applyPanSphericalDirectRotation(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.view.camera.tilt,
!1),this.panSphericalMomentumEstimator.addMomentumDirectRotation(L,this.tmp3d,.001*R.timestamp,this.startCamera,this.sphere[3],this.view.camera.tilt));this.constraintOptions.interactionType=t.InteractionType.PAN;this.constraintOptions.interactionFactor=u.pixelDistanceToInteractionFactor(this.screenPickPoint,L);u.applyAll(this.view,this.currentCamera,this.constraintOptions)};U._rotateSpherical=function(R){k.normalize(this.rotationAxis,this.scenePickPoint);this.currentCamera.aboveGround||k.negate(this.rotationAxis,
this.rotationAxis);var L=this.smoothRotation.value,N=D.normalizeRotationDelta(R.angle-L);L+=N;this.smoothRotation.gain=.00125*Math.min(Math.max(R.radius,40),120);this.smoothRotation.update(L);N=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(N,.001*R.timestamp);D.applyRotation(this.currentCamera,this.sphere,p.wrapAxisAngle(this.rotationAxis,N));this.constraintOptions.interactionType=t.InteractionType.TUMBLE;this.constraintOptions.interactionFactor=u.pixelDistanceToInteractionFactor(R.radius*
L);u.applyAll(this.view,this.currentCamera,this.constraintOptions)};U._panningPlanar=function(R){const L=g.screenPointObjectToArray(R.center,this.tmpScreenPointArray);D.intersectPlaneFromScreenPointAtEye(this.panningPlane,this.currentCamera,L,this.tmp3d)&&(D.applyPanPlanar(this.currentCamera,this.beginScenePoint,this.tmp3d),this.panPlanarMomentumEstimator.add(L,this.tmp3d,.001*R.timestamp),this.constraintOptions.interactionType=t.InteractionType.PAN,this.constraintOptions.interactionFactor=u.pixelDistanceToInteractionFactor(this.beginScreenPoint,
L),this.constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this.tmpInteractionDirection),u.applyAll(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null)};U._zoomPlanar=function(R){const L=this.beginRadius/R.radius;this.smoothScaling.gain=.001875*Math.min(Math.max(R.radius,40),120);this.smoothScaling.update(L);this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*R.timestamp);D.applyZoomToPoint(this.currentCamera,
this.beginScenePoint,this.smoothScaling.value,this.view.state.constraints.minimumPoiDistance);this.constraintOptions.interactionType=t.InteractionType.ZOOM;this.constraintOptions.interactionFactor=u.pixelDistanceToInteractionFactor(R.radius-this.beginRadius);u.applyAll(this.view,this.currentCamera,this.constraintOptions)};U._rotatePlanar=function(R){k.copy(this.rotationAxis,this.beginScenePoint);this.currentCamera.aboveGround||k.negate(this.rotationAxis,this.rotationAxis);var L=this.smoothRotation.value;
let N=R.angle-L;N=D.normalizeRotationDelta(N);this.smoothRotation.gain=.00125*Math.min(Math.max(R.radius,40),120);this.smoothRotation.update(L+N);L=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(L,.001*R.timestamp);D.applyRotation(this.currentCamera,this.sphere,p.wrapAxisAngle(this.rotationAxis,L));this.constraintOptions.interactionType=t.InteractionType.TUMBLE;this.constraintOptions.interactionFactor=u.pixelDistanceToInteractionFactor(R.radius*L);u.applyAll(this.view,
this.currentCamera,this.constraintOptions)};b._createClass(M,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return M}(z.InteractiveController);c.__decorate([x.property({constructOnly:!0})],a.PinchAndPanController.prototype,"view",void 0);a.PinchAndPanController=c.__decorate([f.subclass("esri.views.3d.state.controllers.global.PinchAndPanController")],a.PinchAndPanController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/util":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function d(x){this._gain=x}var g=d.prototype;g.reset=function(x){this._value=x};g.update=function(x){this._value=void 0===this._value?x:this._gain*x+(1-this._gain)*this._value};b._createClass(d,[{key:"gain",set:function(x){this._gain=x}},{key:"value",get:function(){return void 0===this._value?0:this._value}}]);return d}();a.ExponentialFalloff=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/momentum/PanPlanarMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ./MomentumController ../../../camera/constraintUtils/common".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k){a.PanPlanarMomentumController=function(y){function p(h){h=y.call(this,h)||this;h.interactionType=k.InteractionType.PAN;h.tmpPan=f.create();return h}b._inheritsLoose(p,y);p.prototype.momentumStep=function(h,m){h=this.momentum.value(h);n.scale(this.tmpPan,this.momentum.direction,h);m.eye=n.subtract(r,m.eye,this.tmpPan);m.center=n.subtract(r,m.center,this.tmpPan);this.constraintOptions.interactionDirection=this.tmpPan};return p}(e.MomentumController);c.__decorate([d.property({constructOnly:!0})],
a.PanPlanarMomentumController.prototype,"momentum",void 0);a.PanPlanarMomentumController=c.__decorate([l.subclass("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],a.PanPlanarMomentumController);const r=f.create();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/momentum/MomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../ViewAnimation ../../../camera/constraintUtils ../../../camera/constraintUtils/common ../AnimationController ../../../webgl-engine/lib/Camera".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r){a.MomentumController=function(y){function p(m){m=y.call(this,m)||this;m.view=null;m.beginCamera=new r.default;m.elapsedTimeSec=0;m.constraintOptions={selection:e.ConstraintTypes.ALL,interactionType:e.InteractionType.PAN,interactionFactor:0,interactionStartCamera:new r.default,interactionDirection:null,tiltMode:e.TiltMode.TUMBLE};return m}b._inheritsLoose(p,y);var h=p.prototype;h.initialize=function(){this.constraintOptions.interactionType=this.interactionType;this.viewAnimation=
new n};h.onControllerStart=function(m){this.beginCamera.copyFrom(m);this.constraintOptions.interactionStartCamera=this.beginCamera;y.prototype.onControllerStart.call(this,m)};h.stepController=function(m,u){u.copyViewFrom(this.beginCamera);this.elapsedTimeSec+=m;this.momentumStep(this.elapsedTimeSec,u);f.applyAll(this.view,u,this.constraintOptions)};b._createClass(p,[{key:"steppingFinished",get:function(){return this.momentum.isFinished(this.elapsedTimeSec)}}]);return p}(k.AnimationController);c.__decorate([d.property({constructOnly:!0})],
a.MomentumController.prototype,"view",void 0);a.MomentumController=c.__decorate([l.subclass("esri.views.3d.state.controllers.momentum.MomentumController")],a.MomentumController);Object.defineProperty(a,"InteractionType",{enumerable:!0,get:()=>e.InteractionType});Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/momentum/PanSphericalMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ./MomentumController ../../utils/navigationUtils ../../../camera/constraintUtils/common".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r){const y=f.create(),p=f.create();a.PanSphericalMomentumController=function(h){function m(u){u=h.call(this,u)||this;u.interactionType=r.InteractionType.PAN;return u}b._inheritsLoose(m,h);m.prototype.momentumStep=function(u,t){const q=this.momentum.value1(u);u=this.momentum.value2(u);n.copy(p,t.eye);n.normalize(p,p);n.cross(this.momentum.axis2,p,this.momentum.axis1);k.applyRotationWithTwoAxes(t,y,this.momentum.axis1,q,this.momentum.axis2,u)};return m}(e.MomentumController);
c.__decorate([d.property({constructOnly:!0})],a.PanSphericalMomentumController.prototype,"momentum",void 0);a.PanSphericalMomentumController=c.__decorate([l.subclass("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],a.PanSphericalMomentumController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/momentum/RotationMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3f64 ../../../../../geometry/support/axisAngle ./MomentumController ../../utils/navigationUtils ../../../camera/constraintUtils/common".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r){a.RotationMomentumController=function(y){function p(h){h=y.call(this,h)||this;h.interactionType=r.InteractionType.TUMBLE;return h}b._inheritsLoose(p,y);p.prototype.momentumStep=function(h,m){h=this.momentum.value(h);k.applyRotation(m,this.center,f.wrapAxisAngle(this.axis,h))};b._createClass(p,[{key:"center",set:function(h){this._set("center",n.clone(h))}},{key:"axis",set:function(h){this._set("axis",n.clone(h))}}]);return p}(e.MomentumController);c.__decorate([d.property({constructOnly:!0})],
a.RotationMomentumController.prototype,"momentum",void 0);c.__decorate([d.property({constructOnly:!0})],a.RotationMomentumController.prototype,"center",null);c.__decorate([d.property({constructOnly:!0})],a.RotationMomentumController.prototype,"axis",null);a.RotationMomentumController=c.__decorate([l.subclass("esri.views.3d.state.controllers.momentum.MomentumController")],a.RotationMomentumController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/momentum/ZoomPlanarMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ./MomentumController ../../utils/navigationUtils ../../../camera/constraintUtils/common".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r){a.ZoomPlanarMomentumController=function(y){function p(h){h=y.call(this,h)||this;h.interactionType=r.InteractionType.ZOOM;h.constraintOptions.interactionDirection=f.create();return h}b._inheritsLoose(p,y);p.prototype.momentumStep=function(h,m){n.copy(this.constraintOptions.interactionDirection,m.eye);h=this.momentum.valueDelta(0,h);k.applyZoomToPoint(m,this.zoomCenter,h,this.view.state.constraints.minimumPoiDistance);this.constraintOptions.interactionDirection=n.direction(this.constraintOptions.interactionDirection,
m.eye,this.constraintOptions.interactionDirection)};b._createClass(p,[{key:"zoomCenter",set:function(h){this._set("zoomCenter",f.clone(h))}}]);return p}(e.MomentumController);c.__decorate([d.property({constructOnly:!0})],a.ZoomPlanarMomentumController.prototype,"momentum",void 0);c.__decorate([d.property({constructOnly:!0})],a.ZoomPlanarMomentumController.prototype,"zoomCenter",null);a.ZoomPlanarMomentumController=c.__decorate([l.subclass("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],
a.ZoomPlanarMomentumController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/momentum/ZoomSphericalMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3f64 ../../../../../geometry/support/axisAngle ../../../../../chunks/sphere ../../../camera/constraintUtils ./MomentumController ../../utils/navigationUtils ../../../camera/constraintUtils/common".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h){a.ZoomSphericalMomentumController=function(m){function u(q){q=m.call(this,q)||this;q.interactionType=h.InteractionType.ZOOM;q.radius=0;q.tmpSceneCenter=f.create();q.tmpZoomAxisAngle=e.create();q.sphere=k.create();return q}b._inheritsLoose(u,m);var t=u.prototype;t.initialize=function(){this.sphere[3]=this.radius};t.momentumStep=function(q,z){q=this.momentum.valueDelta(0,q);p.applyZoomOnSphere(this.sphere,z,q);this.constraintOptions.interactionType=h.InteractionType.ZOOM;
r.applyAll(this.view,z,this.constraintOptions);p.sphereOrPlanePointFromScreenPoint(this.sphere,z,this.screenCenter,this.tmpSceneCenter);e.fromPoints(this.sceneCenter,this.tmpSceneCenter,this.tmpZoomAxisAngle);p.applyRotation(z,this.sphere,this.tmpZoomAxisAngle);this.constraintOptions.interactionType=h.InteractionType.PAN};b._createClass(u,[{key:"screenCenter",set:function(q){this._set("screenCenter",d.createScreenPointArray(q[0],q[1]))}},{key:"sceneCenter",set:function(q){this._set("sceneCenter",
f.clone(q))}}]);return u}(y.MomentumController);c.__decorate([g.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"momentum",void 0);c.__decorate([g.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"screenCenter",null);c.__decorate([g.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"sceneCenter",null);c.__decorate([g.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"radius",void 0);a.ZoomSphericalMomentumController=
c.__decorate([n.subclass("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],a.ZoomSphericalMomentumController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/navigation/PanPlanarMomentumEstimator":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/vec3 ../../chunks/vec3f64 ./FilteredFiniteDifference ./Momentum".split(" "),function(a,b,c,d,g,x){let w=function(l){function n(f,e,k,r,y){f=l.call(this,f,e,k)||this;f.sceneVelocity=r;
f.direction=y;return f}b._inheritsLoose(n,l);n.prototype.value=function(f){return l.prototype.valueFromInitialVelocity.call(this,this.sceneVelocity,f)};return n}(x.Momentum);x=function(){function l(f=300,e=12,k=.84){this.minimumInitialVelocity=f;this.stopVelocity=e;this.friction=k;this.enabled=!0;this.time=new g.FilteredFiniteDifference(.6);this.screen=[new g.FilteredFiniteDifference(.4),new g.FilteredFiniteDifference(.4)];this.scene=[new g.FilteredFiniteDifference(.6),new g.FilteredFiniteDifference(.6),
new g.FilteredFiniteDifference(.6)];this.tmpDirection=d.create()}var n=l.prototype;n.add=function(f,e,k){!this.enabled||this.time.hasLastValue&&.015>this.time.computeDelta(k)||(this.screen[0].update(f[0]),this.screen[1].update(f[1]),this.scene[0].update(e[0]),this.scene[1].update(e[1]),this.scene[2].update(e[2]),this.time.update(k))};n.reset=function(){this.screen[0].reset();this.screen[1].reset();this.scene[0].reset();this.scene[1].reset();this.scene[2].reset();this.time.reset()};n.evaluateMomentum=
function(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;var f=this.screen[0].filteredDelta;const e=this.screen[1].filteredDelta;f=Math.sqrt(f*f+e*e)/this.time.filteredDelta;return Math.abs(f)<this.minimumInitialVelocity?null:this.createMomentum(f,this.stopVelocity,this.friction)};n.createMomentum=function(f,e,k){c.set(this.tmpDirection,this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta);const r=c.length(this.tmpDirection);0<r&&c.scale(this.tmpDirection,
this.tmpDirection,1/r);return new w(f,e,k,r/this.time.filteredDelta,this.tmpDirection)};return l}();a.PanPlanarMomentum=w;a.PanPlanarMomentumEstimator=x;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/navigation/FilteredFiniteDifference":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function d(x){this.gain=x}var g=d.prototype;g.update=function(x){if(this.hasLastValue){const w=this.computeDelta(x);this._updateDelta(w)}this.lastValue=
x};g.reset=function(){this.filteredDelta=this.lastValue=void 0};g.computeDelta=function(x){return x-this.lastValue};g._updateDelta=function(x){this.filteredDelta=this.hasFilteredDelta?(1-this.gain)*this.filteredDelta+this.gain*x:x};b._createClass(d,[{key:"hasLastValue",get:function(){return void 0!==this.lastValue}},{key:"hasFilteredDelta",get:function(){return void 0!==this.filteredDelta}}]);return d}();a.FilteredFiniteDifference=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/navigation/Momentum":function(){define(["exports",
"../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function d(x,w,l){this._initialVelocity=x;this._stopVelocity=w;this._friction=l;this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}var g=d.prototype;g.isFinished=function(x){return x>this.duration};g.value=function(x){return this.valueFromInitialVelocity(this._initialVelocity,x)};g.valueDelta=function(x,w){const l=this.value(x);return this.value(x+w)-l};g.valueFromInitialVelocity=
function(x,w){w=Math.min(w,this.duration);const l=1-this.friction;return x*(l**w-1)/Math.log(l)};b._createClass(d,[{key:"duration",get:function(){return this._duration}},{key:"friction",get:function(){return this._friction}}]);return d}();a.Momentum=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/navigation/PanSphericalMomentumEstimator":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/vec2f64 ../../chunks/vec3 ../../chunks/vec3f64 ../3d/state/utils/navigationUtils ./FilteredFiniteDifference ./FilteredValue ./Momentum".split(" "),
function(a,b,c,d,g,x,w,l,n){let f=function(e){function k(y,p,h,m,u,t=0,q){y=e.call(this,y,p,h)||this;y.angularVelocity1=m;y.axis1=u;y.angularVelocity2=t;y.axis2=q;return y}b._inheritsLoose(k,e);var r=k.prototype;r.value1=function(y){return e.prototype.valueFromInitialVelocity.call(this,this.angularVelocity1,y)};r.value2=function(y){return e.prototype.valueFromInitialVelocity.call(this,this.angularVelocity2,y)};return k}(n.Momentum);n=function(){function e(r=300,y=12,p=.84){this.minimumInitialVelocity=
r;this.stopVelocity=y;this.friction=p;this.enabled=!0;this.tmpAxis1=g.create();this.tmpAxis2=g.create();this.tmpAngles=c.create();this.time=new w.FilteredFiniteDifference(.3);this.screen=[new w.FilteredFiniteDifference(.4),new w.FilteredFiniteDifference(.4)];this.angle1=new l.FilteredValue(.6);this.angle2=new l.FilteredValue(.6);this.axis1=g.create();this.axis2=g.create();this.lastScene=g.create()}var k=e.prototype;k.addMomentumDirectRotation=function(r,y,p,h,m,u){if(this.enabled){if(this.time.hasLastValue){if(.01>
this.time.computeDelta(p))return;h=x.rotationAngleAndAxisDirectRotation(this.lastScene,y,this.tmpAxis2,h,m,u);this.angle2.update(0);1E-5>d.squaredLength(this.tmpAxis2)?h=0:d.normalize(this.axis1,this.tmpAxis2);this.angle1.update(h);d.copy(this.lastScene,y)}this.screen[0].update(r[0]);this.screen[1].update(r[1]);this.time.update(p)}};k.addMomentumPreserveHeading=function(r,y,p,h,m,u,t){if(this.enabled){if(this.time.hasLastValue){if(.01>this.time.computeDelta(p))return;x.rotationAnglesAndAxesHeadingPreserving(this.lastScene,
y,this.tmpAxis2,this.tmpAxis1,this.tmpAngles,h,m,u,t,!1);1E-5>d.squaredLength(this.tmpAxis2)?(this.angle1.update(0),this.angle2.update(0)):(this.angle1.update(this.tmpAngles[1]),this.angle2.update(this.tmpAngles[0]),d.normalize(this.axis1,this.tmpAxis1),d.normalize(this.axis2,this.tmpAxis2));d.copy(this.lastScene,y)}this.screen[0].update(r[0]);this.screen[1].update(r[1]);this.time.update(p)}};k.reset=function(){this.screen[0].reset();this.screen[1].reset();this.angle1.reset();this.angle2.reset();
this.time.reset()};k.evaluateMomentum=function(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;var r=this.screen[0].filteredDelta;const y=this.screen[1].filteredDelta;r=Math.sqrt(r*r+y*y)/this.time.filteredDelta;return Math.abs(r)<this.minimumInitialVelocity?null:this.createMomentum(r,this.stopVelocity,this.friction)};k.createMomentum=function(r,y,p){return new f(r,y,p,this.angle1.filteredValue/this.time.filteredDelta,this.axis1,this.angle2.filteredValue/this.time.filteredDelta,this.axis2)};
return e}();a.PanSphericalMomentum=f;a.PanSphericalMomentumEstimator=n;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/navigation/FilteredValue":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function d(x){this.gain=x}var g=d.prototype;g.update=function(x){this.filteredValue=this.hasFilteredValue?(1-this.gain)*this.filteredValue+this.gain*x:x};g.reset=function(){this.filteredValue=void 0};b._createClass(d,[{key:"hasFilteredValue",
get:function(){return void 0!==this.filteredValue}}]);return d}();a.FilteredValue=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/navigation/RotationMomentumEstimator":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","./MomentumEstimator"],function(a,b,c){c=function(d){function g(x=3,w=.01,l=.95,n=12){return d.call(this,x,w,l,n)||this}b._inheritsLoose(g,d);g.prototype.add=function(x,w){if(this.value.hasLastValue){const l=this.value.lastValue;for(x-=l;x>Math.PI;)x-=
2*Math.PI;for(;x<-Math.PI;)x+=2*Math.PI;x=l+x}d.prototype.add.call(this,x,w)};return g}(c.MomentumEstimator);a.RotationMomentumEstimator=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/navigation/MomentumEstimator":function(){define(["exports","../../core/mathUtils","./FilteredFiniteDifference","./Momentum"],function(a,b,c,d){let g=function(){function x(l=2.5,n=.01,f=.95,e=12){this.minimumInitialVelocity=l;this.stopVelocity=n;this.friction=f;this.maxVelocity=e;this.enabled=!0;this.value=
new c.FilteredFiniteDifference(.8);this.time=new c.FilteredFiniteDifference(.3)}var w=x.prototype;w.add=function(l,n){if(this.enabled){if(this.time.hasLastValue){if(.01>this.time.computeDelta(n))return;if(this.value.hasFilteredDelta){const f=this.value.computeDelta(l);0>this.value.filteredDelta*f&&this.value.reset()}}this.time.update(n);this.value.update(l)}};w.reset=function(){this.value.reset();this.time.reset()};w.evaluateMomentum=function(){if(!this.enabled||!this.value.hasFilteredDelta)return null;
let l=this.value.filteredDelta/this.time.filteredDelta;l=b.clamp(l,-this.maxVelocity,this.maxVelocity);return Math.abs(l)<this.minimumInitialVelocity?null:this.createMomentum(l,this.stopVelocity,this.friction)};w.createMomentum=function(l,n,f){return new d.Momentum(l,n,f)};return x}();a.MomentumEstimator=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/navigation/ZoomMomentumEstimator":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","./Momentum","./MomentumEstimator"],
function(a,b,c,d){let g=function(x){function w(n,f,e){return x.call(this,n,f,e)||this}b._inheritsLoose(w,x);var l=w.prototype;l.value=function(n){n=x.prototype.value.call(this,n);return Math.exp(n)};l.valueDelta=function(n,f){const e=x.prototype.value.call(this,n);n=x.prototype.value.call(this,n+f);return Math.exp(n-e)};return w}(c.Momentum);c=function(x){function w(n=2.5,f=.01,e=.95,k=12){return x.call(this,n,f,e,k)||this}b._inheritsLoose(w,x);var l=w.prototype;l.add=function(n,f){x.prototype.add.call(this,
Math.log(n),f)};l.createMomentum=function(n,f,e){return new g(n,f,e)};return w}(d.MomentumEstimator);a.ZoomMomentum=g;a.ZoomMomentumEstimator=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/local/PinchAndPanController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/axisAngle ../../../../../geometry/support/plane ../../../camera/constraintUtils ../../../camera/constraintUtils/common ../../../input/util ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E,C){const D=k.fromValues(0,0,1);var F=16/180*Math.PI;a.PinchAndPanController=function(G){function J(O){O=G.call(this,O)||this;O.view=null;O.rotationValueSmooth=new m.ExponentialFalloff(.05);O.scalingValueSmooth=new m.ExponentialFalloff(.05);O.planeHorizontal=y.create();O.planeVertical=y.create();O.rotationMomentumEstimator=new E.RotationMomentumEstimator;O.panMomentumEstimator=new A.PanPlanarMomentumEstimator(300,12,.9);O.zoomMomentumEstimator=
new C.ZoomMomentumEstimator;O.beginCenter=k.create();O.tmpPoints=[];O.beginCenterScreen=g.createScreenPointArray();O.tmpCentroid3d=k.create();O.tmpCentroid2d=g.createScreenPointArray();O.tmp2d=g.createScreenPointArray();O.constraintOptions={selection:h.ConstraintTypes.ALL,interactionType:h.InteractionType.NONE,interactionFactor:0,interactionStartCamera:new B.default,interactionDirection:null,tiltMode:h.TiltMode.TUMBLE};return O}b._inheritsLoose(J,G);var I=J.prototype;I.begin=function(O){if(this.active){var P=
this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=P;this.rotationMomentumEstimator.enabled=P;this.panMomentumEstimator.enabled=P;this.beginRadius=O.radius;this.pointerCount=O.pointers.size;this.beginAngle=O.angle;this.rotationValueSmooth.reset();this.scalingValueSmooth.reset();g.screenPointObjectToArray(O.center,this.beginCenterScreen);y.fromNormalAndOffset(D,0,this.planeHorizontal);P=k.create();this.intersectionHelper.intersectScreenFreePointFallback(this.beginCenterScreen,
P);var K=k.create();e.negate(K,this.startCamera.viewForward);var M=k.create();e.copy(M,D);var U=e.dot(K,M);this.panMode=d.asinClamped(0>U?-U:U)>=F?v.NavigationMode.Horizontal:v.NavigationMode.Vertical;y.setOffsetFromPoint(this.planeHorizontal,this.planeHorizontal,P);this.startCamera.aboveGround||y.negate(this.planeHorizontal,this.planeHorizontal);if(this.panMode===v.NavigationMode.Vertical){e.scale(M,M,U);e.subtract(this.planeVertical,K,M);e.normalize(this.planeVertical,this.planeVertical);y.setOffsetFromPoint(this.planeVertical,
this.planeVertical,P);K=k.create();M=k.create();U=k.create();e.subtract(K,P,this.currentCamera.eye);e.normalize(K,K);P=5*Math.max(Math.abs(this.view.camera.position.z),50);const R=this.view._stage.renderView.getMinimalDepthForArea(this.view.getVoxelWasmPerSceneView(),this.beginCenterScreen[0],this.beginCenterScreen[1],this.view.state.camera,80);e.copy(U,e.add(M,this.currentCamera.eye,e.scale(M,K,R?Math.min(R,P):P)));this.planeVertical[3]=-e.dot(this.planeVertical,U);this.computePlanePoints(O.pointers,
this.planeVertical,this.startCamera,this.tmpPoints)}else this.computePlanePoints(O.pointers,this.planeHorizontal,this.startCamera,this.tmpPoints);v.centroid(this.tmpPoints,this.beginCenter);this.constraintOptions.interactionStartCamera.copyFrom(this.startCamera)}};I.update=function(O){if(this.active){this.currentCamera.copyFrom(this.startCamera);var P=1<O.pointers.size,K=this.panMode===v.NavigationMode.Horizontal?this.planeHorizontal:this.planeVertical,M=this.beginCenter;if(P){var U=this.beginRadius/
O.radius;this.scalingValueSmooth.gain=.001875*Math.min(Math.max(O.radius,40),120);this.scalingValueSmooth.update(U);v.applyZoomToPoint(this.currentCamera,M,this.scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance);this.zoomMomentumEstimator.add(this.scalingValueSmooth.value,.001*O.timestamp);this.constraintOptions.interactionType=h.InteractionType.ZOOM;this.constraintOptions.interactionFactor=p.pixelDistanceToInteractionFactor(Math.abs(O.radius-this.beginRadius));p.applyAll(this.view,
this.currentCamera,this.constraintOptions)}this.computePlanePoints(O.pointers,K,this.currentCamera,this.tmpPoints);v.centroid(this.tmpPoints,this.tmpCentroid3d);g.screenPointObjectToArray(O.center,this.tmpCentroid2d);v.applyPanPlanar(this.currentCamera,M,this.tmpCentroid3d);this.panMomentumEstimator.add(this.tmpCentroid2d,this.tmpCentroid3d,.001*O.timestamp);this.constraintOptions.interactionType=h.InteractionType.PAN;this.constraintOptions.interactionFactor=p.pixelDistanceToInteractionFactor(this.beginCenterScreen,
this.tmpCentroid2d);p.applyAll(this.view,this.currentCamera,this.constraintOptions);P&&(P=this.planeHorizontal,K=this.rotationValueSmooth.value,U=v.normalizeRotationDelta(O.angle-K),K+=U,this.rotationValueSmooth.gain=.00125*Math.min(Math.max(O.radius,40),120),this.rotationValueSmooth.update(K),K=this.rotationValueSmooth.value-this.beginAngle,this.rotationMomentumEstimator.add(K,.001*O.timestamp),v.applyRotation(this.currentCamera,M,r.wrapAxisAngle(P,K)),this.constraintOptions.interactionType=h.InteractionType.TUMBLE,
this.constraintOptions.interactionFactor=p.pixelDistanceToInteractionFactor(Math.abs(O.radius*K)),p.applyAll(this.view,this.currentCamera,this.constraintOptions))}};I.end=function(O){O.pointers.size===this.pointerCount&&this.update(O);this.finishController();return(O=this.zoomMomentumEstimator.evaluateMomentum())?new z.ZoomPlanarMomentumController({view:this.view,momentum:O,zoomCenter:this.beginCenter}):(O=this.rotationMomentumEstimator.evaluateMomentum())?new q.RotationMomentumController({view:this.view,
momentum:O,center:this.beginCenter,axis:y.normal(this.planeHorizontal)}):(O=this.panMomentumEstimator.evaluateMomentum())?new t.PanPlanarMomentumController({view:this.view,momentum:O}):null};I.computePlanePoints=function(O,P,K,M){M.length=O.size;const U=this.tmp2d;let R=0;O.forEach(L=>{U[0]=L.x;U[1]=L.y;void 0===M[R]&&(M[R]=k.create());v.intersectPlaneFromScreenPointAtEye(P,K,U,M[R]);R+=1});return M};b._createClass(J,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);
return J}(u.InteractiveController);c.__decorate([x.property({constructOnly:!0})],a.PinchAndPanController.prototype,"view",void 0);a.PinchAndPanController=c.__decorate([f.subclass("esri.views.3d.state.controllers.local.PinchAndPanController")],a.PinchAndPanController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/PointerDownCancelAnimation":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../input/InputHandler"],function(a,b,c){c=
function(d){function g(x,w){var l=d.call(this,!0)||this;l.view=x;l.registerIncoming("pointer-down",w,()=>l.view.state.stopActiveCameraController());return l}b._inheritsLoose(g,d);return g}(c.InputHandler);a.PointerDownCancelAnimation=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/SingleKeyResetHeading":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./SingleKey"],function(a,b,c){c=function(d){function g(x,w,l){w=d.call(this,w,l)||this;
w.view=x;return w}b._inheritsLoose(g,d);g.prototype.activate=function(){this.view.goTo({heading:0}).catch(()=>{})};return g}(c.SingleKey);a.SingleKeyResetHeading=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/SingleKey":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../input/InputHandler"],function(a,b,c){c=function(d){function g(x,w){var l=d.call(this,!0)||this;l.key=x;l.registerIncoming("key-down",w,n=>l._handleKeyDown(n));
return l}b._inheritsLoose(g,d);g.prototype._handleKeyDown=function(x){x.data.key===this.key&&(this.activate(),x.stopPropagation())};return g}(c.InputHandler);a.SingleKey=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/SingleKeyResetTilt":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./SingleKey"],function(a,b,c){c=function(d){function g(x,w,l){w=d.call(this,w,l)||this;w.view=x;return w}b._inheritsLoose(g,d);g.prototype.activate=function(){this.view.goTo({tilt:0}).catch(()=>
{})};return g}(c.SingleKey);a.SingleKeyResetTilt=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/TwoFingerTilt":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/screenUtils","../../state/controllers/RotateController","../../../input/InputHandler"],function(a,b,c,d,g){g=function(x){function w(l,n=!1){var f=x.call(this,!0)||this;f.view=l;f.invert=n;f.registerIncoming("vertical-two-finger-drag",e=>f._handleTwoFinger(e));
return f}b._inheritsLoose(w,x);w.prototype._handleTwoFinger=function(l){var n,f,e;const k=c.createScreenPointArray(0,l.data.delta*(this.invert?-1:1));switch(l.data.action){case "begin":null==(n=this.cameraController)?void 0:n.end();this.cameraController=new d.RotateController({view:this.view,pivot:d.PivotPoint.CENTER});this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(k);break;case "update":null==(f=this.cameraController)?void 0:f.update(k);break;case "end":null==
(e=this.cameraController)?void 0:e.end(),this.cameraController=null}};return w}(g.InputHandler);a.TwoFingerTilt=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/input/BrowserEventSource":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/has ./keys ./gamepad/GamepadSource ../support/screenUtils".split(" "),function(a,b,c,d,g,x){const w=c("trident"),l=c("edge"),n=c("chrome"),f=c("ff"),e=c("safari");c=function(){function r(p,h){this.input=h;this._active={};
this._activePointerCaptures=new Set;this._keyDownState=new Set;this._eventId=1;this._browserTouchPanningEnabled=!1;this._element=p;p.getAttribute("tabindex")||p.setAttribute("tabindex","0");this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,
"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost};this._updateTouchAction();this._element.addEventListener("keydown",this._preventAltKeyDefault);this._gamepadSource=new g.GamepadSource(p,this.input);this._gamepadSource.onEvent=m=>this._callback("gamepad",m)}var y=r.prototype;y.destroy=function(){this.activeEvents=this._callback=null;this._activePointerCaptures.forEach(p=>{this._releasePointerCaptureSafe(p)});this._gamepadSource&&(this._gamepadSource.destroy(),
this._gamepadSource=null);this._activePointerCaptures=null;this._removeTouchAction();this._element.removeEventListener("keydown",this._preventAltKeyDefault)};y.setPointerCapture=function(p,h){h?(this._element.setPointerCapture(p.pointerId),this._activePointerCaptures.add(p.pointerId)):(this._releasePointerCaptureSafe(p.pointerId),this._activePointerCaptures.delete(p.pointerId))};y._updateTouchAction=function(){this._element.classList.remove(this._browserTouchPanningEnabled?"esri-view-surface--touch-none":
"esri-view-surface--touch-pan");this._element.classList.add(this._browserTouchPanningEnabled?"esri-view-surface--touch-pan":"esri-view-surface--touch-none")};y._updateTouchEventHandling=function(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)};y._removeTouchAction=function(){this._element.classList.remove("esri-view-surface--touch-none");this._element.classList.remove("esri-view-surface--touch-pan");
this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)};y._releasePointerCaptureSafe=function(p){try{this._element.hasPointerCapture&&!this._element.hasPointerCapture(p)||this._element.releasePointerCapture(p)}catch(h){}};y._updateNormalizedPointerLikeEvent=function(p,h){p=x.createScreenPointFromNativeEvent(this._element,p);r.test.disableSubpixelCoordinates&&(p.x=Math.round(p.x),p.y=Math.round(p.y));h.x=p.x;h.y=p.y;return h};y._handleKey=function(p,h){const m=d.eventKey(h);
m&&"key-up"===p&&this._keyDownState.delete(m);h={native:h,key:m,repeat:m&&this._keyDownState.has(m)};m&&"key-down"===p&&this._keyDownState.add(h.key);this._callback(p,h)};y._handlePointer=function(p,h){h=this._updateNormalizedPointerLikeEvent(h,{native:h,x:0,y:0,pointerType:h.pointerType,button:h.button,buttons:h.buttons,eventId:this._eventId++});this._callback(p,h)};y._handlePointerPreventDefault=function(p,h){const m=this._updateNormalizedPointerLikeEvent(h,{native:h,x:0,y:0,pointerType:h.pointerType,
button:h.button,buttons:h.buttons,eventId:this._eventId++});h.preventDefault();this._callback(p,m)};y._handleMouseWheel=function(p,h){let m=h.deltaY;switch(h.deltaMode){case 0:if(w||l)m=m/document.documentElement.clientHeight*600;break;case 1:m*=30;break;case 2:m*=900}w||l?m*=.7:n||e?m*=.6:f&&(m*=1.375);const u=Math.abs(m);100<u&&(m=m/u*200/(1+Math.exp(-.02*(u-100))));h=this._updateNormalizedPointerLikeEvent(h,{native:h,x:0,y:0,deltaY:m});this._callback(p,h)};y._handlePointerCaptureLost=function(p,
h){this._activePointerCaptures.delete(h.pointerId);this._handleDefault(p,h)};y._handleDefault=function(p,h){const m={native:h};h.preventDefault();this._callback(p,m)};y._preventAltKeyDefault=function(p){"Alt"===p.key&&p.preventDefault()};y._preventMultiTouchPanning=function(p){1<p.touches.length&&p.preventDefault()};b._createClass(r,[{key:"browserTouchPanningEnabled",get:function(){return this._browserTouchPanningEnabled},set:function(p){this._browserTouchPanningEnabled=p;this._updateTouchAction();
this._updateTouchEventHandling()}},{key:"onEventReceived",set:function(p){this._callback=p}},{key:"activeEvents",set:function(p){for(const h in this._active)p&&p.has(h)||(this._element.removeEventListener(k[h],this._active[h]),delete this._active[h]);p&&p.forEach(h=>{if(!this._active[h]&&k[h]){const m=(this._eventHandlers[h]||this._handleDefault).bind(this,h);this._element.addEventListener(k[h],m);this._active[h]=m}});this._gamepadSource.hasEventListeners=p&&p.has("gamepad")}}]);return r}();c.test=
{disableSubpixelCoordinates:!1};const k={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};a.BrowserEventSource=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/input/gamepad/GamepadSource":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers","../../../core/scheduling","./GamepadInputDevice","./GamepadState"],function(a,b,c,d,g){let x=function(){function w(n,f){this.element=n;this.input=f;this._hasEventListeners=!1;this._onConnectGamepad=e=>{this._connectGamepad(e.gamepad)};this._onDisconnectGamepad=e=>{e=e.gamepad;const k=e.index,r=this.inputDevices[k];r&&(this._emitGamepadEvent(e,g.extractState(r),!1),this.inputDevices.splice(k,1),this.latestUpdate.splice(k,1),this.input.gamepad.devices.remove(r),
this.ensurePollingState())};this.frameTask=null;this.latestUpdate=[];this.inputDevices=[];this.callback=null;n=window.isSecureContext;if(this.supported="getGamepads"in window.navigator&&n)this._forEachGamepad(e=>this._connectGamepad(e)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState()}var l=w.prototype;l.destroy=function(){this.hasEventListeners=!1;this.supported&&(window.removeEventListener("gamepadconnected",
this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))};l._connectGamepad=function(n){const f=new d(n);"unknown"!==f.deviceType&&(this.inputDevices[n.index]=f,this.input.gamepad.devices.add(f));this.ensurePollingState()};l.ensurePollingState=function(){this.eventsEnabled?this._startPolling():this._stopPolling()};l._startPolling=function(){null==this.frameTask&&(this.frameTask=c.addFrameTask({update:()=>this._readGamepadState()}))};l._stopPolling=function(){null!=
this.frameTask&&(this.frameTask.remove(),this.frameTask=null,this.latestUpdate=[])};l._readGamepadState=function(){const n=document.hasFocus(),f=this.element.contains(document.activeElement),e="document"===this.input.gamepad.enabledFocusMode&&!n||"view"===this.input.gamepad.enabledFocusMode&&!f;this._forEachGamepad(k=>{var r=this.inputDevices[k.index];if(r){var y=this.latestUpdate[k.index];r=g.extractState(r);var p=e||g.stateIdle(r);y&&(y.timestamp===k.timestamp||!y.active&&p||g.stateEqual(y.state,
r))||this._emitGamepadEvent(k,r,!p)}})};l._forEachGamepad=function(n){const f=window.navigator.getGamepads();for(let e=0;e<f.length;e++){const k=f[e];this._validate(k)&&n(k)}};l._emitGamepadEvent=function(n,f,e){var k=this.latestUpdate[n.index];if((k=k&&k.active)||e)this.latestUpdate[n.index]={timestamp:n.timestamp,state:f,active:e},this.callback&&this.callback({device:this.inputDevices[n.index],state:f,action:!k&&e?"start":k&&e?"update":"end"})};l._validate=function(n){if(!n||!n.connected)return!1;
for(let f=0;f<n.axes.length;f++)if(isNaN(n.axes[f]))return!1;return!0};b._createClass(w,[{key:"hasEventListeners",set:function(n){this._hasEventListeners!==n&&(this._hasEventListeners=n,this.ensurePollingState())}},{key:"eventsEnabled",get:function(){return this.supported&&0<this.inputDevices.length&&this._hasEventListeners}},{key:"onEvent",set:function(n){this.callback=n}}]);return w}();a.GamepadSource=x;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/input/gamepad/GamepadState":function(){define(["exports"],
function(a){a.extractState=function(b){const c=b.native;return c?{buttons:c.buttons.map(d=>d.pressed?d.value?d.value:1:0),axes:c.axes.map(d=>{{var g=b.axisThreshold;const x=Math.abs(d);d=x<g?0:Math.sign(d)*(x-g)/(1-g)}return d})}:{buttons:[],axes:[]}};a.stateEqual=function(b,c){if(b.axes.length!==c.axes.length||b.buttons.length!==c.buttons.length)return!1;for(var d=0;d<b.axes.length;d++)if(b.axes[d]!==c.axes[d])return!1;for(d=0;d<b.buttons.length;d++)if(b.buttons[d]!==c.buttons[d])return!1;return!0};
a.stateIdle=function(b){for(var c=0;c<b.axes.length;c++)if(0!==b.axes[c])return!1;for(c=0;c<b.buttons.length;c++)if(0!==b.buttons[c])return!1;return!0};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/input/handlers/PreventContextMenu":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../InputHandler"],function(a,b,c){c=function(d){function g(){var x=d.call(this,!0)||this;x.registerIncoming("context-menu",w=>{w.data.native.preventDefault()});return x}b._inheritsLoose(g,
d);return g}(c.InputHandler);a.PreventContextMenu=c;a.default=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/input/recognizers/Drag":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/screenUtils ../../../core/time ../InputHandler ./support".split(" "),function(a,b,c,d,g,x){function w(e){const k=[];e.forEach(r=>{k.push(c.createScreenPoint(r.event.x,r.event.y))});return x.fitCircleLSQ(k)}function l(e){const k=w(e);let r=0;e.forEach(y=>{var p=f(y,k);
for(p-=y.lastAngle;p>Math.PI;)p-=2*Math.PI;for(;p<-Math.PI;)p+=2*Math.PI;p=y.lastAngle+p;y.lastAngle=p;r+=p-y.initialAngle});r/=e.size||1;return{angle:r,radius:k.radius,center:k.center}}function n(e){const k=new Map;e.forEach((r,y)=>k.set(y,r.event));return k}function f(e,k){e=e.event;return Math.atan2(e.y-k.center.y,e.x-k.center.x)}g=function(e){function k(y){var p=e.call(this,!1)||this;p.navigationTouch=y;p.startStateModifiers=new Set;p.activePointerMap=new Map;p.isDragging=!1;p.isCurrentDragSuppressed=
!1;p.drag=p.registerOutgoing("drag");p.registerIncoming("pointer-drag",p._handlePointerDrag.bind(b._assertThisInitialized(p)));p.registerIncoming("pointer-up",p._handlePointerUpAndPointerLost.bind(b._assertThisInitialized(p)));p.registerIncoming("pointer-capture-lost",p._handlePointerUpAndPointerLost.bind(b._assertThisInitialized(p)));p.registerIncoming("pointer-cancel",p._handlePointerUpAndPointerLost.bind(b._assertThisInitialized(p)));return p}b._inheritsLoose(k,e);var r=k.prototype;r._createPayload=
function(y,p,h,m){return{action:y,pointerType:this.pointerType,button:this.mouseButton,buttons:p.buttons,timestamp:m,pointers:n(this.activePointerMap),pointer:p,angle:h.angle,radius:h.radius,center:h.center}};r._addPointer=function(y){var p=y.native.pointerId;const h=l(this.activePointerMap).angle;y={event:y,initialAngle:0,lastAngle:0};this.activePointerMap.set(p,y);p=f(y,w(this.activePointerMap));y.initialAngle=p;y.lastAngle=p;this._updatePointerAngles(h)};r._updatePointer=function(y){if(!y||null!=
y.x||null!=y.y){var p=this.activePointerMap.get(y.native.pointerId);p?p.event=y:this._addPointer(y)}};r._removePointer=function(y){const p=l(this.activePointerMap).angle;this.activePointerMap.delete(y);this._updatePointerAngles(p)};r._updatePointerAngles=function(y){const p=l(this.activePointerMap);this.activePointerMap.forEach(h=>{h.initialAngle=f(h,p)-y;h.lastAngle=f(h,p)-y})};r._emitEvent=function(y,p,h){const m=l(this.activePointerMap);this.drag.emit(this._createPayload(y,p,m,h),void 0,this.startStateModifiers)};
r._handlePointerUpAndPointerLost=function(y){const p=y.data.native.pointerId,h=d.Milliseconds(y.timestamp);this.activePointerMap.get(p)&&(1===this.activePointerMap.size?(this._updatePointer(y.data),!this.isCurrentDragSuppressed&&this._emitEvent("end",y.data,h),this.isCurrentDragSuppressed=this.isDragging=!1,this._removePointer(p)):(this._removePointer(p),this._emitEvent("removed",y.data,d.Milliseconds(y.timestamp))))};r._handlePointerDrag=function(y){const p=y.data,h=p.currentEvent,m=d.Milliseconds(y.timestamp);
switch(p.action){case "start":case "update":this.isDragging?this.activePointerMap.has(h.native.pointerId)?(this._updatePointer(h),!this.isCurrentDragSuppressed&&this._emitEvent("update",h,m)):(this._addPointer(h),this._emitEvent("added",h,m),this.isCurrentDragSuppressed=this.isSuppressed):(this._updatePointer(h),this.pointerType=y.data.startEvent.pointerType,this.mouseButton=y.data.startEvent.button,this.startStateModifiers=y.modifiers,this.isDragging=!0,this.isCurrentDragSuppressed=this.isSuppressed,
!this.isCurrentDragSuppressed&&this._emitEvent("start",h,m))}};b._createClass(k,[{key:"isSuppressed",get:function(){return this.navigationTouch&&!this.navigationTouch.browserTouchPanEnabled&&"touch"===this.pointerType&&1===this.activePointerMap.size}}]);return k}(g.InputHandler);a.Button=void 0;(function(e){e[e.Left=0]="Left";e[e.Middle=1]="Middle";e[e.Right=2]="Right";e[e.Back=3]="Back";e[e.Forward=4]="Forward";e[e.Undefined=-1]="Undefined"})(a.Button||(a.Button={}));a.Drag=g;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/input/recognizers/support":function(){define(["exports","../../../core/screenUtils"],function(a,b){a.euclideanDistance=function(c,d){const g=d.x-c.x;c=d.y-c.y;return Math.sqrt(g*g+c*c)};a.fitCircleLSQ=function(c,d){d?(d.radius=0,d.center.x=0,d.center.y=0):d={radius:0,center:b.createScreenPoint()};if(0===c.length)return d;if(1===c.length)return d.center.x=c[0].x,d.center.y=c[0].y,d;if(2===c.length){const [h,m]=c,[u,t]=[m.x-h.x,m.y-h.y];d.radius=Math.sqrt(u*u+
t*t)/2;d.center.x=(h.x+m.x)/2;d.center.y=(h.y+m.y)/2;return d}let g=0,x=0;for(d=0;d<c.length;d++)g+=c[d].x,x+=c[d].y;g/=c.length;x/=c.length;var w=c.map(h=>h.x-g),l=c.map(h=>h.y-x);let n=d=0;var f=0,e=0,k=0,r=0,y=0;for(var p=0;p<w.length;p++){const h=w[p],m=l[p],u=h*h,t=m*m;d+=u;n+=t;f+=h*m;e+=u*h;k+=t*m;r+=h*t;y+=m*u}w=d;l=f;p=n;e=.5*(e+r);k=.5*(k+y);y=w*p-f*l;r=(e*p-k*l)/y;k=(w*k-f*e)/y;y=b.createScreenPoint(r+g,k+x);return{radius:Math.sqrt(r*r+k*k+(d+n)/c.length),center:y}};a.manhattanDistance=
function(c,d){return Math.abs(d.x-c.x)+Math.abs(d.y-c.y)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/input/recognizers/ImmediateDoubleClick":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/clock ../InputHandler ./SingleAndDoubleClick ./support".split(" "),function(a,b,c,d,g,x){d=function(w){function l(f=g.DefaultParameters.maximumDoubleClickDelay,e=g.DefaultParameters.maximumDoubleClickDistance,k=g.DefaultParameters.maximumDoubleTouchDelay,r=
g.DefaultParameters.maximumDoubleTouchDistance,y=c.clock){var p=w.call(this,!1)||this;p.maximumDoubleClickDelay=f;p.maximumDoubleClickDistance=e;p.maximumDoubleTouchDelay=k;p.maximumDoubleTouchDistance=r;p._clock=y;p._pointerState=new Map;p._immediateDoubleClick=p.registerOutgoing("immediate-double-click");p.registerIncoming("pointer-down",p._handlePointerDown.bind(b._assertThisInitialized(p)));p.registerIncoming("pointer-up",h=>{p._handlePointerLoss(h,"pointer-up")});p.registerIncoming("pointer-capture-lost",
h=>{p._handlePointerLoss(h,"pointer-capture-lost")});p.registerIncoming("pointer-cancel",h=>{p._handlePointerLoss(h,"pointer-cancel")});return p}b._inheritsLoose(l,w);var n=l.prototype;n.onUninstall=function(){this._pointerState.forEach(f=>{f.immediateDoubleClick&&f.immediateDoubleClick.timeoutHandle.remove()});w.prototype.onUninstall.call(this)};n._handlePointerDown=function(f){f=f.data;const e=this._pointerId(f);this._pointerState.has(e)||(this._pointerState.set(e,{downButton:f.native.button,immediateDoubleClick:null}),
this.startCapturingPointer(f.native))};n._handlePointerLoss=function(f,e){const k=f.data;var r=this._pointerId(k);if((r=this._pointerState.get(r))&&"pointer-up"===e&&r.downButton===k.native.button)if(e=r.immediateDoubleClick){e.timeoutHandle.remove();const y="touch"===f.data.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;x.manhattanDistance(e,f.data)>y?this._startImmediateDoubleClick(f,r):(this._immediateDoubleClick.emit(f.data,void 0,e.modifiers),this._removeState(k))}else this._startImmediateDoubleClick(f,
r)};n._startImmediateDoubleClick=function(f,e){e.immediateDoubleClick={x:f.data.x,y:f.data.y,modifiers:f.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(f.data),"touch"===f.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay)}};n._pointerId=function(f){f=f.native;return"mouse"===f.pointerType?`${f.pointerId}:${f.button}`:`${f.pointerType}`};n._removeState=function(f){const e=this._pointerId(f);this._pointerState.delete(e);this.stopCapturingPointer(f.native);
this.refreshHasPendingInputs()};return l}(d.InputHandler);a.ImmediateDoubleClick=d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/input/recognizers/SingleAndDoubleClick":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/clock ../../../core/MapUtils ../../../core/maybe ../InputHandler ./support".split(" "),function(a,b,c,d,g,x,w){const l={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};
x=function(n){function f(k=l.maximumDoubleClickDelay,r=l.maximumDoubleClickDistance,y=l.maximumDoubleTouchDelay,p=l.maximumDoubleTouchDistance,h=c.clock){var m=n.call(this,!1)||this;m.maximumDoubleClickDelay=k;m.maximumDoubleClickDistance=r;m.maximumDoubleTouchDelay=y;m.maximumDoubleTouchDistance=p;m._clock=h;m._pointerState=new Map;m._click=m.registerOutgoing("click");m._doubleClick=m.registerOutgoing("double-click");m.registerIncoming("immediate-click",m._handleImmediateClick.bind(b._assertThisInitialized(m)));
m.registerIncoming("pointer-drag",m._handlePointerDrag.bind(b._assertThisInitialized(m)));m.registerIncoming("drag",m._handleDrag.bind(b._assertThisInitialized(m)));return m}b._inheritsLoose(f,n);var e=f.prototype;e.onUninstall=function(){this._pointerState.forEach(k=>k.doubleClickTimeout=g.removeMaybe(k.doubleClickTimeout))};e._pointerId=function(k){k=k.native;return"mouse"===k.pointerType?`${k.pointerId}:${k.button}`:`${k.pointerType}`};e._handleImmediateClick=function(k){const r=k.data,y=this._pointerId(r),
p=this._pointerState.get(y);if(p){const h="touch"===r.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;w.manhattanDistance(p.event.data,r)>h?(this._clearDoubleClickTimeout(y,!0),this._startClick(k)):(this._clearDoubleClickTimeout(y,!1),this._doubleClick.emit(p.event.data,void 0,p.event.modifiers))}else this._startClick(k)};e._startClick=function(k){const r=this._pointerId(k.data);this._pointerState.set(r,{event:k,doubleClickTimeout:this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(r),
"touch"===k.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay)});this.refreshHasPendingInputs()};e._handlePointerDrag=function(k){k=this._pointerId(k.data.currentEvent);this._clearDoubleClickTimeout(k,!0)};e._handleDrag=function(k){k=this._pointerId(k.data.pointer);this._clearDoubleClickTimeout(k,!0)};e._clearDoubleClickTimeout=function(k,r){const y=this._pointerState.get(k);y&&(y.doubleClickTimeout.remove(),y.doubleClickTimeout=null,r&&this._doubleClickTimeoutExceeded(k),
this._pointerState.delete(k),this.refreshHasPendingInputs())};e._doubleClickTimeoutExceeded=function(k){const r=this._pointerState.get(k);this._click.emit(r.event.data,void 0,r.event.modifiers);r.doubleClickTimeout=null;this._pointerState.delete(k);this.refreshHasPendingInputs()};b._createClass(f,[{key:"hasPendingInputs",get:function(){return d.someMap(this._pointerState,k=>null!=k.doubleClickTimeout)}}]);return f}(x.InputHandler);a.DefaultParameters=l;a.SingleAndDoubleClick=x;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/input/recognizers/PointerClickHoldAndDrag":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/clock","../InputHandler","./support"],function(a,b,c,d,g){const x={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};d=function(w){function l(f=x.maximumClickDelay,e=x.movementUntilMouseDrag,k=x.movementUntilPenDrag,r=x.movementUntilTouchDrag,y=x.holdDelay,p=c.clock){var h=
w.call(this,!1)||this;h.maximumClickDelay=f;h.movementUntilMouseDrag=e;h.movementUntilPenDrag=k;h.movementUntilTouchDrag=r;h.holdDelay=y;h._clock=p;h._pointerState=new Map;h._pointerDrag=h.registerOutgoing("pointer-drag");h._immediateClick=h.registerOutgoing("immediate-click");h._pointerHold=h.registerOutgoing("hold");h.registerIncoming("pointer-down",h._handlePointerDown.bind(b._assertThisInitialized(h)));h.registerIncoming("pointer-up",m=>{h._handlePointerLoss(m,"pointer-up")});h.registerIncoming("pointer-capture-lost",
m=>{h._handlePointerLoss(m,"pointer-capture-lost")});h.registerIncoming("pointer-cancel",m=>{h._handlePointerLoss(m,"pointer-cancel")});h._moveHandle=h.registerIncoming("pointer-move",h._handlePointerMove.bind(b._assertThisInitialized(h)));h._moveHandle.pause();return h}b._inheritsLoose(l,w);var n=l.prototype;n.onUninstall=function(){this._pointerState.forEach(f=>{null!=f.holdTimeout&&(f.holdTimeout.remove(),f.holdTimeout=null)});w.prototype.onUninstall.call(this)};n._handlePointerDown=function(f){const e=
f.data,k=e.native.pointerId;var r=null;0===this._pointerState.size&&(r=this._clock.setTimeout(()=>{const y=this._pointerState.get(k);y&&(y.isDragging||(this._pointerHold.emit(y.previousEvent,void 0,f.modifiers),y.holdEmitted=!0),y.holdTimeout=null)},this.holdDelay));r={startEvent:e,previousEvent:e,startTimestamp:f.timestamp,isDragging:!1,downButton:e.native.button,holdTimeout:r,modifiers:new Set};this._pointerState.set(k,r);this.startCapturingPointer(e.native);this._moveHandle.resume();1<this._pointerState.size&&
this._startDragging(f)};n._createPointerDragData=function(f,e,k){return{action:f,startEvent:e.startEvent,previousEvent:e.previousEvent,currentEvent:k}};n._handlePointerMove=function(f){const e=f.data,k=this._pointerState.get(e.native.pointerId);if(k){if(k.isDragging)this._pointerDrag.emit(this._createPointerDragData("update",k,e),void 0,k.modifiers);else{const r=g.euclideanDistance(e,k.startEvent),y=this._getDragThreshold(e.native.pointerType);r>y&&this._startDragging(f)}k.previousEvent=e}};n._getDragThreshold=
function(f){switch(f){case "touch":return this.movementUntilTouchDrag;case "pen":return this.movementUntilPenDrag;default:return this.movementUntilMouseDrag}};n._startDragging=function(f){const e=f.data,k=e.native.pointerId;this._pointerState.forEach(r=>{null!=r.holdTimeout&&(r.holdTimeout.remove(),r.holdTimeout=null);r.isDragging||(r.modifiers=f.modifiers,r.isDragging=!0,k===r.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",r,e)):this._pointerDrag.emit(this._createPointerDragData("start",
r,r.previousEvent),f.timestamp))})};n._handlePointerLoss=function(f,e){const k=f.data,r=k.native.pointerId,y=this._pointerState.get(r);y&&(null!=y.holdTimeout&&(y.holdTimeout.remove(),y.holdTimeout=null),y.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",y,"pointer-up"===e?k:y.previousEvent),void 0,y.modifiers):"pointer-up"===e&&y.downButton===k.native.button&&f.timestamp-y.startTimestamp<=this.maximumClickDelay&&!y.holdEmitted&&this._immediateClick.emit(k),this._pointerState.delete(r),
this.stopCapturingPointer(k.native),0===this._pointerState.size&&this._moveHandle.pause())};return l}(d.InputHandler);a.DefaultParameters=x;a.PointerClickHoldAndDrag=d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/input/recognizers/VerticalTwoFingerDrag":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../DragEventSeparator","../InputHandler"],function(a,b,c,d){d=function(g){function x(l=20,n=40){var f=g.call(this,!1)||this;f._threshold=l;f._maxDelta=n;f.state=
"ready";f.emittedArtificalEnd2=!1;f._vertical=f.registerOutgoing("vertical-two-finger-drag");f._artificalDrag=f.registerOutgoing("drag");f.dragEventSeparator=new c.DragEventSeparator({start:(e,k)=>f._observeStart(e,k),update:(e,k,r)=>f._observeUpdate(e,k,r),end:(e,k)=>f._observeEnd(k)});f.registerIncoming("drag",e=>f.dragEventSeparator.handle(e));return f}b._inheritsLoose(x,g);var w=x.prototype;w._observeStart=function(l,n){1===l&&this.emittedArtificalEnd2&&(this.emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",
button:n.data.button,buttons:n.data.buttons,pointerType:n.data.pointerType,timestamp:n.data.timestamp,pointers:n.data.pointers,pointer:n.data.pointer,angle:n.data.angle,radius:n.data.radius,center:n.data.center}),n.stopPropagation());this.state=2===l?"ready":"failed"};w._observeUpdate=function(l,n,f){"failed"!==this.state&&2===l&&("active"===this.state?(this._vertical.emit({delta:n.data.center.y-this._thresholdReachedCenter.y,action:"update"}),n.stopPropagation()):this._checkMovementWithinLimits(n.data,
f.data)?this._checkVerticalThresholdReached(n.data,f.data)&&(this.state="active",this.emittedArtificalEnd2=!0,this._thresholdReachedCenter=n.data.center,this._artificalDrag.emit({action:"end",button:n.data.button,buttons:n.data.buttons,pointerType:n.data.pointerType,timestamp:n.data.timestamp,pointers:n.data.pointers,pointer:n.data.pointer,angle:n.data.angle,radius:n.data.radius,center:n.data.center}),this._vertical.emit({delta:n.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),n.stopPropagation()):
this.state="failed")};w._observeEnd=function(l){"active"===this.state&&(this._vertical.emit({delta:l.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this.state="ready",l.stopPropagation())};w._checkMovementWithinLimits=function(l,n){let f=-Infinity,e=Infinity,k=-Infinity,r=Infinity;n.pointers.forEach(u=>{f=Math.max(f,u.x);e=Math.min(e,u.x);k=Math.max(k,u.y);r=Math.min(r,u.y)});let y=-Infinity,p=Infinity,h=-Infinity,m=Infinity;l.pointers.forEach(u=>{y=Math.max(y,u.x);p=Math.min(p,u.x);
h=Math.max(h,u.y);m=Math.min(m,u.y)});return Math.abs(l.center.x-n.center.x)<this._threshold&&Math.abs(y-p-(f-e))<=this._maxDelta&&Math.abs(h-m-(k-r))<=this._maxDelta};w._checkVerticalThresholdReached=function(l,n){let f=Math.abs(l.center.y-n.center.y);l.pointers.forEach((e,k)=>{k=n.pointers.get(k);f=Math.min(f,Math.abs(e.y-k.y))});return f>=this._threshold};b._createClass(x,[{key:"failed",get:function(){return"failed"===this.state}}]);return x}(d.InputHandler);a.VerticalTwoFingerDrag=d;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/input/DragEventSeparator":function(){define(["exports"],function(a){let b=function(){function c(g){this.callbacks=g;this.currentCount=0;this.callbacks.condition||(this.callbacks.condition=()=>!0)}var d=c.prototype;d.handle=function(g){const x=g.data,w=x.pointers.size;switch(x.action){case "start":this.currentCount=w;this._emitStart(g);break;case "added":this._emitEnd(this.previousEvent);this.currentCount=w;this._emitStart(g);break;case "update":this._emitUpdate(g);
break;case "removed":this.startEvent&&this._emitEnd(this.previousEvent);this.currentCount=w;this._emitStart(g);break;case "end":this._emitEnd(g),this.currentCount=0}this.previousEvent=g};d._emitStart=function(g){this.startEvent=g;this.callbacks.condition(this.currentCount,g)&&this.callbacks.start(this.currentCount,g,this.startEvent)};d._emitUpdate=function(g){this.callbacks.condition(this.currentCount,g)&&this.callbacks.update(this.currentCount,g,this.startEvent)};d._emitEnd=function(g){this.callbacks.condition(this.currentCount,
g)&&this.callbacks.end(this.currentCount,g,this.startEvent);this.startEvent=null};return c}();a.DragEventSeparator=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/GraphicsDeconflictor":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Handles ../../../../core/MapUtils ../../../../core/maybe ../../../../core/watchUtils ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/set ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/boundedPlane ./Deconflictor ./enums ./LabelDeconflictor ../../../support/Scheduler".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u){function t(z){z=z.layer;return!(!z||!z.featureReduction||"selection"!==z.featureReduction.type)}function q(z){(z=z.graphics3DGraphics)&&z.forEach(v=>v.clearVisibilityFlag(h.VisibilityFlag.DECONFLICTION))}a.GraphicsDeconflictor=function(z){function v(){var A=z.apply(this,arguments)||this;A._handles=new d;A._contexts=new Map;A._viewState=new p.DeconflictorViewState;A.visibilityGroup=h.VisibilityGroup.GRAPHIC;A._iconMarginFactor=-.1;return A}b._inheritsLoose(v,
z);var B=v.prototype;B.initialize=function(){this._handles.add([this.view.watch("state.camera",()=>{this._updateViewState();this.setDirty()}),this.view.watch("map.ground.opacity",(A,E)=>{1!==A&&1!==E||this.setDirty()}),w.init(this.view,"slicePlane",()=>{this._updateSlicePlane();this._slicePlaneChanged()})]);this._frameTask=this.view.resourceController.scheduler.registerTask(u.TaskPriority.GRAPHICS_DECONFLICTOR,this);this._labels=new m.LabelDeconflictor({view:this.view,parent:this})};B.destroy=function(){this._labels.destroy();
this._labels=null;this._handles.destroy();this._handles=null;this._frameTask&&(this._frameTask.remove(),this._frameTask=null)};B.setDirty=function(){0<this._contexts.size&&(z.prototype.setDirty.call(this),this._labels.setDirty())};B.runTask=function(A){z.prototype.runTask.call(this,A);this.running||this._labels.setDirty()};B.setInitialIconVisibilityFlag=function(A,E){A=!(this._graphicSupportsDeconfliction(E)&&t(A));E.setVisibilityFlag(h.VisibilityFlag.DECONFLICTION,A,h.VisibilityGroup.GRAPHIC)};B._updateViewState=
function(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())};B._updateSlicePlane=function(){const A=this.view?this.view.slicePlane:null;x.isSome(A)&&y.transform(A,this._viewState.camera.viewMatrix,this._viewState.slicePlane);this._viewState.slicePlaneEnabled=x.isSome(A)};B._slicePlaneChanged=function(){g.someMap(this._contexts,(A,E)=>E.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()};B.addGraphicsOwner=function(A){let E=this._contexts.get(A);
null==E&&(E=new Map,this._contexts.set(A,E),this.setDirty());return{addGraphic:C=>this._addGraphic(A,E,C),removeGraphic:C=>this._removeGraphic(E,C),labelingInfoChange:()=>this._labels.enabledChanged(A,E),featureReductionChange:()=>this.enabledChanged(A,E),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(A,E),clear:()=>E.forEach(C=>this._removeGraphic(E,C.graphics3DGraphic))}};B.removeGraphicsOwner=function(A){const E=this._contexts.get(A);E&&(E.forEach(C=>this._removeGraphic(E,C.graphics3DGraphic)),
this._contexts.delete(A),this.setDirty())};B._addGraphic=function(A,E,C){const D=C.graphic.uid;C=new p.DeconflictorGraphic(C,A.symbolCreationContext.slicePlaneEnabled);E.set(D,C);t(A)&&this.addToActiveGraphics(C);A.labelsEnabled&&this._labels.addToActiveGraphics(C)};B._removeGraphic=function(A,E){E=E.graphic.uid;const C=A.get(E);C&&(this.removeFromActiveGraphics(C),this._labels.removeFromActiveGraphics(C),A.delete(E),this.setDirty())};B.enabledChanged=function(A,E){const C=t(A);C||q(A);this.modifyGraphics(E,
C)};B._slicePlaneEnabledChanged=function(A,E){const C=A.symbolCreationContext.slicePlaneEnabled;E.forEach(D=>D.slicePlaneEnabled=C);this.setDirty()};B.getGraphicsLayers=function(A){return A.graphics};B._graphicSupportsDeconfliction=function(A){if(A.isDraped)return!1;A=A.graphics;if(!A||!A.length)return!1;for(const E of A)if(this.layerSupportsDeconfliction(E))return!0;return!1};b._createClass(v,[{key:"labels",get:function(){return this._labels}},{key:"viewState",get:function(){return this._viewState}},
{key:"iconMarginFactor",get:function(){return this._iconMarginFactor},set:function(A){this._iconMarginFactor=A;this.setDirty()}}]);return v}(p.Deconflictor);a.GraphicsDeconflictor=c.__decorate([r.subclass("esri.views.3d.layers.graphics.GraphicsDeconflictor")],a.GraphicsDeconflictor);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Deconflictor":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/mathUtils ../../../../core/maybe ../../../../core/PooledArray ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/projectionEllipsoid ../../../../geometry/support/aaBoundingRect ../../../../chunks/boundedPlane ../../../../geometry/support/ray ../../../../chunks/sphere ./deconflictorDebug ./enums ../../support/debugFlags ../../webgl-engine/lib/Camera ../../webgl-engine/lib/screenSizePerspectiveUtils ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/HUDMaterial".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E,C,D,F,G,J,I){function*O(ha){if(Map.prototype.entries){ha=ha.entries();for(let ka=ha.next();!ka.done;ka=ha.next())yield ka.value[1]}else yield*ha.values()}function*P(ha,ka,ia){ka.clear();ha.forEach((ca,Z)=>{const fa=ka.pushNew();fa.id=Z;fa.prio=ca.info?-ca.info[ia].distance:Number.MAX_VALUE});yield;const ea=ka.iterableSort((ca,Z)=>Z.prio-ca.prio);for(let ca=ea.next();!ca.done;ca=ea.next())yield;ka.forAll(ca=>{const Z=ha.get(ca.id);Z&&(ha.delete(ca.id),
ha.set(ca.id,Z))});ka.clear()}const K=m.create(),M=t.create(),U=t.create(),R=m.create(),L=y.create(),N=A.create(),T=B.create(),S=m.create(),H=z.create();let Q=function(){this.aabr=z.create();this.distance=0;this.visible=this.culled=!1},W=function(){function ha(){this.active=new Map;this.visible=new Map}ha.prototype.clear=function(){this.active.clear();this.visible.clear()};return ha}(),V=function(){},Y=function(){this.sortArray=new w({allocator:ha=>ha||new V})};a.State=void 0;(function(ha){ha[ha.Idle=
0]="Idle";ha[ha.Process=1]="Process";ha[ha.Sort=2]="Sort";ha[ha.Deconflict=3]="Deconflict";ha[ha.NumStates=4]="NumStates"})(a.State||(a.State={}));let aa=function(){function ha(){this.camera=new F.default;this.slicePlane=v.create();this.slicePlaneEnabled=!1}ha.prototype.copyFrom=function(ka){this.camera.copyFrom(ka.camera);v.copy(ka.slicePlane,this.slicePlane);this.slicePlaneEnabled=ka.slicePlaneEnabled};return ha}();a.Deconflictor=function(ha){function ka(){var ea=ha.apply(this,arguments)||this;
ea._dirty=!1;ea._runningViewState=new aa;ea._state=a.State.Idle;ea.graphics=new W;ea.iterators=new Y;ea.accBinsNumX=15;ea.accBinsNumY=20;ea.accBinsSizeX=0;ea.accBinsSizeY=0;ea.accBins=null;ea.accNumTests=0;return ea}b._inheritsLoose(ka,ha);var ia=ka.prototype;ia.destroy=function(){this.graphics.clear();this.iterators=null};ia.setDirty=function(){!this._dirty&&0<this.graphics.active.size&&(this._dirty=!0,this.notifyChange("updating"))};ia.runTask=function(ea){switch(this._state){case a.State.Idle:this._startUpdate(),
ea.madeProgress();case a.State.Process:if(this._state=a.State.Process,!this._processActiveGraphics(ea))break;case a.State.Sort:if(this._state=a.State.Sort,!this._sortVisibleGraphics(ea))break;case a.State.Deconflict:if(this._state=a.State.Deconflict,!this._deconflictVisibleGraphics(ea))break;default:E.drawAccelerationStruct(this,this.graphics.visible),this._state=a.State.Idle,this.notifyChange("updating")}};ia.modifyGraphics=function(ea,ca){ca?ea.forEach(Z=>this.addToActiveGraphics(Z)):ea.forEach(Z=>
this.removeFromActiveGraphics(Z));this.setDirty()};ia.layerSupportsDeconfliction=function(ea){if(x.isNone(ea)||"object3d"!==ea.type)return!1;ea=ea.stageObject;return 1===(ea?ea.geometryRecords.length:0)&&ea.geometryRecords[0].material instanceof I.HUDMaterial?!0:!1};ia._startUpdate=function(){E.prepare(this.view);this._dirty=!1;this._runningViewState.copyFrom(this.viewState);const {fullWidth:ea,fullHeight:ca}=this._runningViewState.camera;this._initBins(ea,ca);this._resetIterators()};ia.addToActiveGraphics=
function(ea){ea.info[this.visibilityGroup]=new Q;this.graphics.active.set(ea.graphics3DGraphic.graphic.uid,ea);this.setDirty()};ia.removeFromActiveGraphics=function(ea){this._removeFromVisibleGraphics(ea);{const ca=ea.graphics3DGraphic;ca.destroyed||ca.clearVisibilityFlag(C.VisibilityFlag.DECONFLICTION,this.visibilityGroup)}delete ea.info[this.visibilityGroup];this.graphics.active.delete(ea.graphics3DGraphic.graphic.uid);this.setDirty()};ia._addToVisibleGraphics=function(ea){this.graphics.visible.set(ea.graphics3DGraphic.graphic.uid,
ea)};ia._removeFromVisibleGraphics=function(ea){this.graphics.visible.delete(ea.graphics3DGraphic.graphic.uid)};ia._processActiveGraphics=function(ea){const ca=this._ensureActiveGraphicsIterator(),Z=r.invert(L,this._runningViewState.camera.projectionMatrix),fa="global"===this.view.viewingMode&&1===this.view.map.ground.opacity&&0<this._runningViewState.camera.relativeElevation?N:null;let ja=0;x.isSome(fa)&&(h.transformMat4(fa,m.ZEROS,this._runningViewState.camera.viewMatrix),fa[3]=q.getReferenceEllipsoid(this.view.spatialReference).radius,
ja=A.distanceToSilhouette(fa,m.ZEROS));for(;!ea.done;){ea.madeProgress();var la=ca.next();if(!0===la.done)return this._resetActiveGraphicsIterator(),!0;const ma=(la=la.value)&&la.info[this.visibilityGroup];ma&&(this._collectGraphics3DGraphics(la,Z,fa,ja),ma.culled?this._removeFromVisibleGraphics(la):this._addToVisibleGraphics(la))}return!1};ia._sortVisibleGraphics=function(ea){const ca=this._ensureSortGraphicsIterator();for(;!ea.done;){const Z=ca.next();ea.madeProgress();if(!0===Z.done)return this._resetSortGraphicsIterator(),
!0}return!1};ia._deconflictVisibleGraphics=function(ea){const ca=this._ensureVisibleGraphicsIterator(),Z=this.visibilityGroup===C.VisibilityGroup.LABEL;for(;!ea.done;){ea.madeProgress();var fa=ca.next();if(!0===fa.done)return this._resetVisibleGraphicsIterator(),!0;fa=fa.value;const la=fa.info[this.visibilityGroup];if(la&&!la.culled){var ja=fa.graphics3DGraphic;(ja=(!Z||ja.isVisible())&&!this._isConflicted(fa))&&this._addToBins(fa);la.visible=ja;this._setGraphicVisibility(fa,ja);E.drawPoly(la,ja)}}return!1};
ia._resetIterators=function(){this.iterators.active=null;this.iterators.visible=null;this.iterators.sort=null};ia._ensureActiveGraphicsIterator=function(){this.iterators.active||(this.iterators.active=O(this.graphics.active));return this.iterators.active};ia._resetActiveGraphicsIterator=function(){this.iterators.active=null};ia._ensureVisibleGraphicsIterator=function(){this.iterators.visible||(this.iterators.visible=O(this.graphics.visible));return this.iterators.visible};ia._resetVisibleGraphicsIterator=
function(){this.iterators.visible=null};ia._ensureSortGraphicsIterator=function(){this.iterators.sort||(this.iterators.sort=P(this.graphics.visible,this.iterators.sortArray,this.visibilityGroup));return this.iterators.sort};ia._resetSortGraphicsIterator=function(){this.iterators.sort=null};ia._collectGraphics3DGraphics=function(ea,ca,Z,fa){var ja=ea.graphics3DGraphic;if(!ja.destroyed){var la=ea.info[this.visibilityGroup];if(ja.isVisible(C.VisibilityGroup.GRAPHIC,C.VisibilityFlag.DECONFLICTION)){var ma=
this.getGraphicsLayers(ja);z.empty(la.aabr);ja=null;for(const ra of ma)if(this.layerSupportsDeconfliction(ra)){ma=ra.stageObject.geometryRecords[0].material;if(x.isNone(ja)){ja=this._getProjectionInfo(ra,ca,ba);if(ja.isOutsideScreen||this._isCulledBySlice(ea,K)||x.isSome(Z)&&this._isCulledByHorizon(ja,Z,fa)){la.culled=!0;return}!D.TESTS_DISABLE_OPTIMIZATIONS&&la.visible&&(ja.distance*=.7)}this._expandBoundingRect(la,ra,ma,ja)}x.isNone(ja)?la.culled=!0:(la.distance=ja.distance,la.culled=!1)}else la.culled=
!0}};ia._getProjectionInfo=function(ea,ca,Z){const fa=this._runningViewState.camera;ea=ea.stageObject;var ja=ea.geometryRecords[0];const la=ja.material;var ma=A.getCenter(ea.boundingVolumeWorldSpace.bounds);h.transformMat4(K,ma,fa.viewMatrix);ma=ja.geometry.vertexAttributes;ja=ma.get(J.VertexAttribute.NORMAL).data;ma=ma.get(J.VertexAttribute.AUXPOS1).data;la.applyShaderOffsetsView(K,ja,ea.transformation,ma,fa,Z.scaleInfo,K);u.set(M,K[0],K[1],K[2],1);u.transformMat4(U,M,fa.projectionMatrix);h.scale(Z.positionNDC,
U,1/U[3]);la.applyShaderOffsetsNDC(Z.positionNDC,ma,fa,Z.positionNDC,R);Z.distanceWithoutPolygonOffset=fa.depthNDCToWorld(R[2]);Z.distance=R[2]===Z.positionNDC[2]?Z.distanceWithoutPolygonOffset:fa.depthNDCToWorld(Z.positionNDC[2]);u.set(U,Z.positionNDC[0],Z.positionNDC[1],Z.positionNDC[2],1);u.transformMat4(M,U,ca);u.scale(M,M,1/M[3]);h.set(Z.positionView,K[0],K[1],K[2]);return Z};ia._isCulledByHorizon=function(ea,ca,Z){h.copy(T.direction,ea.positionView);h.set(T.origin,0,0,0);return A.intersectRay(ca,
T,S)?ea.distanceWithoutPolygonOffset>Z:!1};ia._isCulledBySlice=function(ea,ca){return ea.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&v.extrusionContainsPoint(this._runningViewState.slicePlane,ca)};ia._expandBoundingRect=function(ea,ca,Z,{positionNDC:fa,scaleInfo:ja}){const la=this._runningViewState.camera;ca=ca.getScreenSize(X);G.applyPrecomputedScaleFactor(ca,ja.factor,ca);ca[0]*=la.pixelRatio;ca[1]*=la.pixelRatio;Z=z.offset(Z.calculateRelativeScreenBounds(ca,ja.factorAlignment.scale,
H),g.lerp(0,la.fullWidth,.5+.5*fa[0]),g.lerp(0,la.fullHeight,.5+.5*fa[1]));fa=this.iconMarginFactor;0!==fa&&(fa*=Math.min(z.width(Z),z.height(Z)),Z[0]-=fa,Z[1]-=fa,Z[2]+=fa,Z[3]+=fa);z.expand(ea.aabr,Z,ea.aabr)};ia._isConflicted=function(ea){const ca=ea.graphics3DGraphic.graphic.uid;ea=ea.info[this.visibilityGroup];for(let Z=Math.floor(ea.aabr[0]/this.accBinsSizeX);Z<=Math.floor(ea.aabr[2]/this.accBinsSizeX);Z++)if(!(0>Z||Z>=this.accBinsNumX))for(let fa=Math.floor(ea.aabr[1]/this.accBinsSizeY);fa<=
Math.floor(ea.aabr[3]/this.accBinsSizeY);fa++){if(0>fa||fa>=this.accBinsNumY)continue;const ja=this.accBins[Z][fa];for(let la=0;la<ja.length;la++){const ma=ja.data[la],ra=ma.info[this.visibilityGroup];if(ra&&ra.visible&&ma.graphics3DGraphic.graphic.uid!==ca&&(this.accNumTests++,z.intersects(ra.aabr,ea.aabr)))return!0}}return!1};ia._initBins=function(ea,ca){if(null==this.accBins){this.accBins=[];for(var Z=0;Z<this.accBinsNumX;Z++){this.accBins.push([]);var fa=this.accBins[this.accBins.length-1];for(let ja=
0;ja<this.accBinsNumY;ja++)fa.push(new w)}}else for(Z=0;Z<this.accBinsNumX;Z++)for(fa=0;fa<this.accBinsNumY;fa++)this.accBins[Z][fa].clear();this.accBinsSizeX=ea/this.accBinsNumX;this.accBinsSizeY=ca/this.accBinsNumY;this.accNumTests=0};ia._addToBins=function(ea){var ca=ea.info[this.visibilityGroup],Z=Math.floor(ca.aabr[0]/this.accBinsSizeX);const fa=Math.floor(ca.aabr[2]/this.accBinsSizeX),ja=Math.floor(ca.aabr[1]/this.accBinsSizeY);for(ca=Math.floor(ca.aabr[3]/this.accBinsSizeY);Z<=fa;Z++)if(!(0>
Z||Z>=this.accBinsNumX))for(let la=ja;la<=ca;la++)0>la||la>=this.accBinsNumY||this.accBins[Z][la].push(ea)};ia._setGraphicVisibility=function(ea,ca){ea=ea.graphics3DGraphic;ea.destroyed||(ea.setVisibilityFlag(C.VisibilityFlag.DECONFLICTION,ca,this.visibilityGroup),this.visibilityGroup===C.VisibilityGroup.LABEL&&this.view.labeler.setLabelGraphicVisibility(ea,ca))};b._createClass(ka,[{key:"dirty",get:function(){return this._dirty}},{key:"state",get:function(){return this._state}},{key:"updating",get:function(){return this._state!==
a.State.Idle||this._dirty}},{key:"updatingProgress",get:function(){if(!this.updating)return 1;const ea=this._state/a.State.NumStates;return this._dirty?.5*ea:ea}},{key:"running",get:function(){return this.view.ready&&null!=this.view.state&&this.updating}}]);return ka}(d);c.__decorate([l.property({constructOnly:!0})],a.Deconflictor.prototype,"view",void 0);c.__decorate([l.property({type:Boolean,readOnly:!0})],a.Deconflictor.prototype,"updating",null);a.Deconflictor=c.__decorate([k.subclass("esri.views.3d.layers.graphics.Deconflictor")],
a.Deconflictor);const X=p.create(),ba=new (function(){function ha(){this.positionView=m.create();this.positionNDC=m.create();this.distanceWithoutPolygonOffset=this.distance=0;this.scaleInfo={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}}}b._createClass(ha,[{key:"isOutsideScreen",get:function(){const ka=this.positionNDC;return-1>ka[0]||-1>ka[1]||-1>ka[2]||1<=ka[0]||1<=ka[1]}}]);return ha}());a.DeconflictorGraphic=function(ha,
ka,ia={}){this.graphics3DGraphic=ha;this.slicePlaneEnabled=ka;this.info=ia};a.DeconflictorViewState=aa;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/deconflictorDebug":function(){define(["exports","../../support/debugFlags"],function(a,b){function c(e,k,r,y,p){l&&(l(),l=null);const h=n.height,m=f;m.beginPath();m.lineWidth=1;m.strokeStyle=p;m.moveTo(e,h-r);m.lineTo(k,h-r);m.stroke();m.lineTo(k,h-y);m.stroke();m.lineTo(k,h-r);m.stroke();m.lineTo(e,h-r);m.stroke();
m.lineTo(e,h-r);m.stroke();m.closePath()}let d=!1,g=!1,x=!1,w=!1,l=null,n,f;a.drawAccelerationStruct=function(e,k){if(g&&f){l&&(l(),l=null);var r=f,y=0;for(let p=0;p<e.accBinsNumX;p++)for(let h=0;h<e.accBinsNumY;h++){const m=e.accBins[p][e.accBinsNumY-1-h];y+=m.length;const u=p*e.accBinsSizeX,t=(p+1)*e.accBinsSizeX,q=h*e.accBinsSizeY,z=(h+1)*e.accBinsSizeY;r.fillText(m.length.toFixed(),u+5,q+15);c(u,t,q,z,"blue")}r.fillText("total totalShownLabels: "+y,70,40);r.fillText("total visible labels: "+k.size,
70,50);r.fillText("total numTests: "+e.accNumTests,70,30)}};a.drawPoly=function(e,k){d&&(k&&x||!k&&w)&&c(e.aabr[0],e.aabr[2],e.aabr[1],e.aabr[3],k?"green":"red")};a.prepare=function(e){x=b.DECONFLICTOR_SHOW_VISIBLE;w=b.DECONFLICTOR_SHOW_INVISIBLE;d=x||w;g=b.DECONFLICTOR_SHOW_GRID;l=null;d||g?l=()=>{{null==n&&(n=document.createElement("canvas"),n.setAttribute("id","canvas2d"),e.surface.parentElement.style.position="relative",e.surface.parentElement.appendChild(n));const k=e.height*e.pixelRatio;n.setAttribute("width",
`${e.width*e.pixelRatio}px`);n.setAttribute("height",`${k}px`);n.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${e.width}px;height:${e.height}px`);f=n.getContext("2d");f.clearRect(0,0,e.width,e.height);f.font="12px Arial"}}:n&&(n.parentElement.removeChild(n),n=null)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/debugFlags":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,d,g,x,w,l){c=function(n){function f(){var e=n.apply(this,arguments)||this;e.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1;e.SCENEVIEW_LOCKING_LOG=!1;e.HIGHLIGHTS_GRID_OPTIMIZATION_ENABLED=!0;e.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1;e.DECONFLICTOR_SHOW_VISIBLE=!1;e.DECONFLICTOR_SHOW_INVISIBLE=!1;e.DECONFLICTOR_SHOW_GRID=!1;e.LABELS_SHOW_BORDER=!1;e.TEXT_SHOW_BASELINE=!1;e.TEXT_SHOW_BORDER=!1;e.OVERLAY_DRAW_DEBUG_TEXTURE=!1;e.OVERLAY_SHOW_CENTER=!1;e.SHOW_POI=!1;e.TESTS_DISABLE_OPTIMIZATIONS=!1;
e.TESTS_DISABLE_FAST_UPDATES=!1;e.DRAW_MESH_GEOMETRY_NORMALS=!1;e.FEATURE_TILE_FETCH_SHOW_TILES=!1;e.FEATURE_TILE_TREE_SHOW_TILES=!1;e.TERRAIN_TILE_TREE_SHOW_TILES=!1;e.I3S_TREE_SHOW_TILES=!1;e.I3S_SHOW_MODIFICATIONS=!1;e.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1;e.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1;e.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1;e.LINE_WIREFRAMES=!1;return e}a._inheritsLoose(f,n);return f}(c);b.__decorate([d.property()],c.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0);
b.__decorate([d.property()],c.prototype,"SCENEVIEW_LOCKING_LOG",void 0);b.__decorate([d.property()],c.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_ENABLED",void 0);b.__decorate([d.property()],c.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0);b.__decorate([d.property()],c.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0);b.__decorate([d.property()],c.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0);b.__decorate([d.property()],c.prototype,"DECONFLICTOR_SHOW_GRID",void 0);b.__decorate([d.property()],c.prototype,
"LABELS_SHOW_BORDER",void 0);b.__decorate([d.property()],c.prototype,"TEXT_SHOW_BASELINE",void 0);b.__decorate([d.property()],c.prototype,"TEXT_SHOW_BORDER",void 0);b.__decorate([d.property()],c.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0);b.__decorate([d.property()],c.prototype,"OVERLAY_SHOW_CENTER",void 0);b.__decorate([d.property()],c.prototype,"SHOW_POI",void 0);b.__decorate([d.property()],c.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0);b.__decorate([d.property()],c.prototype,"TESTS_DISABLE_FAST_UPDATES",
void 0);b.__decorate([d.property()],c.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0);b.__decorate([d.property()],c.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0);b.__decorate([d.property()],c.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0);b.__decorate([d.property()],c.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0);b.__decorate([d.property()],c.prototype,"I3S_TREE_SHOW_TILES",void 0);b.__decorate([d.property()],c.prototype,"I3S_SHOW_MODIFICATIONS",void 0);b.__decorate([d.property()],c.prototype,
"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0);b.__decorate([d.property()],c.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0);b.__decorate([d.property()],c.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0);b.__decorate([d.property()],c.prototype,"LINE_WIREFRAMES",void 0);c=b.__decorate([l.subclass("esri.views.3d.support.DebugFlags")],c);return new c})},"esri/views/3d/layers/graphics/enums":function(){define(["exports"],function(a){a.VisibilityGroup=void 0;(function(b){b[b.GRAPHIC=
0]="GRAPHIC";b[b.LABEL=1]="LABEL";b[b._COUNT=2]="_COUNT"})(a.VisibilityGroup||(a.VisibilityGroup={}));a.VisibilityFlag=void 0;(function(b){b[b.USER_SETTING=0]="USER_SETTING";b[b.SCALE_RANGE=1]="SCALE_RANGE";b[b.FILTER=2]="FILTER";b[b.DECONFLICTION=3]="DECONFLICTION";b[b._COUNT=4]="_COUNT"})(a.VisibilityFlag||(a.VisibilityFlag={}));Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/screenSizePerspectiveUtils":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers",
"../../../../core/mathUtils","../../../ViewingMode"],function(a,b,c,d){function g(k,r,y){const p=y.parameters;y=y.paddingPixelsOverride;f.scale=Math.min(p.divisor/(r-p.offset),1);f.factor=Math.abs(k*k*k);f.minPixelSize=p.minPixelSize;f.paddingPixels=y;return f}function x(k,r){return 0===k?r.minPixelSize:r.minPixelSize*(1+2*r.paddingPixels/k)}function w(k,r){return Math.max(c.lerp(k*r.scale,k,r.factor),x(k,r))}let l=function(){function k(y,p,h,m={camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,
paddingPixels:0},u){this.viewingMode=y;this.description=p;this.ellipsoidRadius=h;this.parameters=m;this._paddingPixelsOverride=u;this.viewingMode===d.ViewingMode.Local?(this.coverageCompensation=this._surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this._surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}var r=k.prototype;
r.update=function(y){if(this.parameters&&this.parameters.camera.fovY===y.fovY&&this.parameters.camera.distance===y.distance)return!1;this._calculateParameters(y,this.ellipsoidRadius,this.parameters);return!0};r.overridePadding=function(y){return y!==this.paddingPixelsOverride?new k(this.viewingMode,this.description,this.ellipsoidRadius,this.parameters,y):this};r._calculateParameters=function(y,p,h){const {scaleStart:m,scaleFallOffRange:u,minPixelSize:t}=this.description,{fovY:q,distance:z}=y;var v=
this.calculateCurvatureDependentParameters(y,p);p=this.coverageCompensation(y,p,v);const {tiltAngle:B,scaleFallOffFactor:A}=v,E=Math.sin(B)*z,C=.5*Math.PI-B-q*(.5-m*p);v=E/Math.cos(C);p=(v-E/Math.cos(C+q*u*p)*A)/(1-A);h.camera.fovY=y.fovY;h.camera.distance=y.distance;h.offset=p;h.divisor=v-p;h.minPixelSize=t;return h};r._calculateCurvatureDependentParametersLocal=function(y,p,h=e){h.tiltAngle=this.description.curvatureDependent.min.tiltAngle;h.scaleFallOffFactor=this.description.curvatureDependent.min.scaleFallOffFactor;
return h};r._calculateCurvatureDependentParametersGlobal=function(y,p,h=e){const m=this.description.curvatureDependent;y=1+y.distance/p;y=Math.sqrt(y*y-1);const [u,t]=[m.min.curvature,m.max.curvature];y=c.clamp((y-u)/(t-u),0,1);const [q,z]=[m.min,m.max];h.tiltAngle=c.lerp(q.tiltAngle,z.tiltAngle,y);h.scaleFallOffFactor=c.lerp(q.scaleFallOffFactor,z.scaleFallOffFactor,y);return h};r._surfaceCoverageCompensationLocal=function(y,p,h){return(y.fovY-h.tiltAngle)/y.fovY};r._surfaceCoverageCompensationGlobal=
function(y,p,h){const m=p*p;h=h.tiltAngle+.5*Math.PI;const {fovY:u,distance:t}=y;y=t*t+m-2*Math.cos(h)*t*p;const q=Math.sqrt(y);return(Math.acos(Math.sqrt(y-m)/q)-Math.asin(p/(q/Math.sin(h)))+.5*u)/u};b._createClass(k,[{key:"paddingPixelsOverride",get:function(){return this._paddingPixelsOverride||this.parameters.paddingPixels}}]);return k}();const n={curvatureDependent:{min:{curvature:c.deg2rad(10),tiltAngle:c.deg2rad(12),scaleFallOffFactor:.5},max:{curvature:c.deg2rad(70),tiltAngle:c.deg2rad(40),
scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},f={scale:0,factor:0,minPixelSize:0,paddingPixels:0},e={tiltAngle:0,scaleFallOffFactor:0};a.applyPrecomputedScaleFactor=function(k,r,y=[0,0]){r=Math.min(Math.max(r.scale,x(k[1],r)/Math.max(1E-5,k[1])),1);y[0]=k[0]*r;y[1]=k[1]*r;return y};a.applyScaleFactor=w;a.getLabelSettings=function(k,r){const {curvatureDependent:y,scaleStart:p,scaleFallOffRange:h}=n;return new l(k,{curvatureDependent:{min:{curvature:y.min.curvature,tiltAngle:y.min.tiltAngle,
scaleFallOffFactor:.7},max:{curvature:y.max.curvature,tiltAngle:y.max.tiltAngle,scaleFallOffFactor:.95}},scaleStart:p,scaleFallOffRange:h,minPixelSize:14},r)};a.getSettings=function(k,r){return new l(k,n,r)};a.precomputeScaleFactor=function(k,r,y,p){k=g(k,r,y);k.minPixelSize=0;k.paddingPixels=0;k=w(1,k);p.scale=k;p.factor=0;p.minPixelSize=y.parameters.minPixelSize;p.paddingPixels=y.paddingPixelsOverride};a.scale=function(k,r,y,p){return w(k,g(r,y,p))};Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/webgl-engine/materials/HUDMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../core/libs/gl-matrix-2/types/mat4 ../../../../geometry/support/aaBoundingRect ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/hud/HUD.glsl ../lib/geometryDataUtils ../lib/GLMaterialTexture ../lib/Material ../lib/RenderSlot ../lib/screenSizePerspectiveUtils ../lib/Util ../lib/VertexAttribute ./internal/bufferWriterUtils ./internal/MaterialUtil ./renderers/utils ../../../../chunks/HUDMaterial.glsl ../shaders/HUDMaterialTechnique".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E,C,D,F,G,J){function I(ca,Z,fa,ja=R){f.copy(ja,ca.anchorPos);ja[0]*=-Z[0];ja[1]*=-Z[1];ja[0]+=ca.screenOffset[0]*fa;ja[1]+=ca.screenOffset[1]*fa;return ja}function O(ca,Z,fa,ja,la,ma,ra,va){Z=Z-la-(0<va[0]?ja[0]*va[0]:0);let ya=Z+ja[0]+2*la;fa=fa-la-(0<va[1]?ja[1]*va[1]:0);la=fa+ja[1]+2*la;ra.textureIsSignedDistanceField&&(ra=ra.distanceFieldBoundingBox,Z+=ja[0]*ra[0],fa+=ja[1]*ra[1],ya-=ja[0]*(1-ra[2]),la-=ja[1]*(1-ra[3]),Z-=ma,ya+=ma,fa-=
ma,la+=ma);return ca[0]>Z&&ca[0]<ya&&ca[1]>fa&&ca[1]<la}let P=function(ca){function Z(ja){ja=ca.call(this,ja,ka)||this;ja.techniqueConfig=new J.HUDMaterialTechniqueConfiguration;return ja}b._inheritsLoose(Z,ca);var fa=Z.prototype;fa.getTechniqueConfig=function(ja,la){this.techniqueConfig.output=ja;this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled;this.techniqueConfig.verticalOffset=!!this.parameters.verticalOffset;this.techniqueConfig.screenSizePerspective=!!this.parameters.screenSizePerspective;
this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits?u.HUDSpace.Screen:u.HUDSpace.World;this.techniqueConfig.polygonOffsetEnabled=this.parameters.polygonOffset;this.techniqueConfig.isDraped=this.parameters.isDraped;this.techniqueConfig.occlusionTestEnabled=this.parameters.occlusionTest;this.techniqueConfig.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled;this.techniqueConfig.sdf=this.parameters.textureIsSignedDistanceField;this.techniqueConfig.vvSize=
!!this.parameters.vvSizeEnabled;this.techniqueConfig.vvColor=!!this.parameters.vvColorEnabled;ja===m.ShaderOutput.Color&&(this.techniqueConfig.debugDrawLabelBorder=!!this.parameters.debugDrawLabelBorder);ja===m.ShaderOutput.Highlight&&(this.techniqueConfig.binaryHighlightOcclusion=this.parameters.binaryHighlightOcclusion);this.techniqueConfig.depthEnabled=this.parameters.depthEnabled;this.techniqueConfig.transparencyPassType=la.transparencyPassType;this.techniqueConfig.multipassGeometryEnabled=la.multipassGeometryEnabled;
this.techniqueConfig.multipassTerrainEnabled=la.multipassTerrainEnabled;this.techniqueConfig.cullAboveGround=la.cullAboveGround;return this.techniqueConfig};fa.intersect=function(ja,la,ma,ra,va,ya,za,pa,wa){d.isSome(wa)?this._intersectDrapedHudGeometry(ja,ya,za,pa,wa):this._intersectHudGeometry(ja,la,ma,ra,za,pa)};fa._intersectDrapedHudGeometry=function(ja,la,ma,ra,va){const ya=ja.vertexAttributes.get(E.VertexAttribute.POSITION),za=ja.vertexAttributes.get(E.VertexAttribute.SIZE),pa=this.parameters,
wa=G.calculateAnchorPosForRendering(pa);let na=1;var qa=1;d.isSome(ra)&&(qa=ra(X),na=qa[0],qa=qa[5]);na*=ja.screenToWorldRatio;qa*=ja.screenToWorldRatio;ra=2*ja.screenToWorldRatio;for(let Fa=0;Fa<ya.data.length/ya.size;Fa++){var ta=Fa*ya.size;const Ha=ya.data[ta];ta=ya.data[ta+1];const Ka=Fa*za.size;ba[0]=za.data[Ka]*na;ba[1]=za.data[Ka+1]*qa;let La;pa.textureIsSignedDistanceField&&(La=pa.outlineSize*ja.screenToWorldRatio/2);O(la,Ha,ta,ba,ra,La,pa,wa)&&ma(va.dist,va.normal,-1,!0)}};fa._intersectHudGeometry=
function(ja,la,ma,ra,va,ya){if(ra.options.selectionMode&&ra.options.hud&&!F.isInstanceHidden(la)){la=this.parameters;var za=1,pa=1;x.fromMat4(Q,ma);if(d.isSome(ya)){pa=ya(X);za=pa[0];pa=pa[5];{ya=Q;var wa=ya[0],na=ya[1],qa=ya[2],ta=ya[3],Fa=ya[4],Ha=ya[5],Ka=ya[6],La=ya[7],Ra=ya[8],ab=1/Math.sqrt(wa*wa+na*na+qa*qa);const Za=1/Math.sqrt(ta*ta+Fa*Fa+Ha*Ha),Pa=1/Math.sqrt(Ka*Ka+La*La+Ra*Ra);ya[0]=wa*ab;ya[1]=na*ab;ya[2]=qa*ab;ya[3]=ta*Za;ya[4]=Fa*Za;ya[5]=Ha*Za;ya[6]=Ka*Pa;ya[7]=La*Pa;ya[8]=Ra*Pa}}ya=
ja.vertexAttributes.get(E.VertexAttribute.POSITION);wa=ja.vertexAttributes.get(E.VertexAttribute.SIZE);na=ja.vertexAttributes.get(E.VertexAttribute.NORMAL);ja=ja.vertexAttributes.get(E.VertexAttribute.AUXPOS1);A.assert(3<=ya.size);qa=ra.point;ta=ra.camera;Fa=G.calculateAnchorPosForRendering(la);za*=ta.pixelRatio;pa*=ta.pixelRatio;Ha="screen"===this.parameters.centerOffsetUnits;for(Ka=0;Ka<ya.data.length/ya.size;Ka++)if(La=Ka*ya.size,k.set(L,ya.data[La],ya.data[La+1],ya.data[La+2]),k.transformMat4(L,
L,ma),La=Ka*wa.size,ba[0]=wa.data[La]*za,ba[1]=wa.data[La+1]*pa,k.transformMat4(L,L,ta.viewMatrix),La=Ka*ja.size,k.set(Y,ja.data[La+0],ja.data[La+1],ja.data[La+2]),Ha||(L[0]+=Y[0],L[1]+=Y[1],0!==Y[2]&&(La=Y[2],k.normalize(Y,L),k.subtract(L,L,k.scale(Y,Y,La)))),La=Ka*na.size,k.set(N,na.data[La],na.data[La+1],na.data[La+2]),this._normalAndViewAngle(N,Q,ta,aa),this._applyVerticalOffsetTransformationView(L,aa,ta,U),ta.applyProjection(L,T),-1<T[0]){La=Math.floor(T[0])+this.parameters.screenOffset[0];Ra=
Math.floor(T[1])+this.parameters.screenOffset[1];Ha&&(La+=Y[0],0!==Y[1]&&(Ra+=B.applyScaleFactor(Y[1],U.factorAlignment)));B.applyPrecomputedScaleFactor(ba,U.factor,ba);ab=1*ta.pixelRatio;let Za;la.textureIsSignedDistanceField&&(Za=la.outlineSize*ta.pixelRatio/2);O(qa,La,Ra,ba,ab,Za,la,Fa)&&(Ra=ra.ray,k.transformMat4(H,L,l.invert(V,ta.viewMatrix)),T[0]=qa[0],T[1]=qa[1],ta.unprojectFromRenderScreen(T,L)&&(La=r.create(),k.copy(La,Ra.direction),ab=1/k.length(La),k.scale(La,La,ab),Ra=k.distance(Ra.origin,
L)*ab,va(Ra,La,-1,!0,1,H)))}}};fa.computeAttachmentOrigin=function(ja,la){var ma=ja.vertexAttributes;if(!ma)return!1;ma=ma.get(E.VertexAttribute.POSITION);ja=ja.indices.get(E.VertexAttribute.POSITION);return t.computeAttachmentOriginPoints(ma,ja,la)};fa.createBufferWriter=function(){return new ea(this)};fa._normalAndViewAngle=function(ja,la,ma,ra){y.isMat4(la)&&(la=x.fromMat4(W,la));k.transformMat3(ra.normal,ja,la);k.transformMat4(ra.normal,ra.normal,ma.viewInverseTransposeMatrix);ra.cosAngle=k.dot(S,
ha);return ra};fa._updateScaleInfo=function(ja,la,ma){const ra=this.parameters;ra.screenSizePerspective?B.precomputeScaleFactor(ma,la,ra.screenSizePerspective,ja.factor):(ja.factor.scale=1,ja.factor.factor=0,ja.factor.minPixelSize=0,ja.factor.paddingPixels=0);ra.screenSizePerspectiveAlignment?B.precomputeScaleFactor(ma,la,ra.screenSizePerspectiveAlignment,ja.factorAlignment):(ja.factorAlignment.factor=ja.factor.factor,ja.factorAlignment.scale=ja.factor.scale,ja.factorAlignment.minPixelSize=ja.factor.minPixelSize,
ja.factorAlignment.paddingPixels=ja.factor.paddingPixels)};fa.applyShaderOffsetsView=function(ja,la,ma,ra,va,ya,za){la=this._normalAndViewAngle(la,ma,va,aa);this._applyVerticalGroundOffsetView(ja,la,va,za);this._applyVerticalOffsetTransformationView(za,la,va,ya);this._applyPolygonOffsetView(za,la,ra[3],va,za);this._applyCenterOffsetView(za,ra,za);return za};fa.applyShaderOffsetsNDC=function(ja,la,ma,ra,va){this._applyCenterOffsetNDC(ja,la,ma,ra);d.isSome(va)&&k.copy(va,ra);this._applyPolygonOffsetNDC(ra,
la,ma,ra);return ra};fa._applyPolygonOffsetView=function(ja,la,ma,ra,va){var ya=ra.aboveGround?1:-1;ma=Math.sign(ma);0===ma&&(ma=ya);ya*=ma;if(0>=this.parameters.shaderPolygonOffset)return k.copy(va,ja);la=c.clamp(Math.abs(la.cosAngle),.01,1);ra=1-Math.sqrt(1-la*la)/la/ra.viewport[2];0<ya?k.scale(va,ja,ra):k.scale(va,ja,1/ra);return va};fa._applyVerticalGroundOffsetView=function(ja,la,ma,ra){const va=k.length(ja),ya=ma.aboveGround?1:-1;ma=.5*ma.computeRenderPixelSizeAtDist(va);la=k.scale(L,la.normal,
ya*ma);k.add(ra,ja,la);return ra};fa._applyVerticalOffsetTransformationView=function(ja,la,ma,ra){const va=this.parameters;if(!va.verticalOffset||!va.verticalOffset.screenLength){if(va.screenSizePerspective||va.screenSizePerspectiveAlignment){var ya=k.length(ja);this._updateScaleInfo(ra,ya,la.cosAngle)}else ra.factor.scale=1,ra.factorAlignment.scale=1;return ja}ya=k.length(ja);ma=D.verticalOffsetAtDistance(ma,ya,va.verticalOffset,la.cosAngle,va.screenSizePerspectiveAlignment||va.screenSizePerspective);
this._updateScaleInfo(ra,ya,la.cosAngle);k.scale(la.normal,la.normal,ma);return k.add(ja,ja,la.normal)};fa._applyCenterOffsetView=function(ja,la,ma){const ra="screen"!==this.parameters.centerOffsetUnits;ma!==ja&&k.copy(ma,ja);ra&&(ma[0]+=la[0],ma[1]+=la[1],la[2]&&(k.normalize(N,ma),k.add(ma,ma,k.scale(N,N,la[2]))));return ma};fa._applyCenterOffsetNDC=function(ja,la,ma,ra){const va="screen"!==this.parameters.centerOffsetUnits;ra!==ja&&k.copy(ra,ja);va||(ra[0]+=la[0]/ma.fullWidth*2,ra[1]+=la[1]/ma.fullHeight*
2);return ra};fa._applyPolygonOffsetNDC=function(ja,la,ma,ra){const va=this.parameters.shaderPolygonOffset;ja!==ra&&k.copy(ra,ja);va&&(ja=ma.aboveGround?1:-1,ra[2]-=(ja*Math.sign(la[3])||ja)*va);return ra};fa.requiresSlot=function(ja){if(ja===v.RenderSlot.DRAPED_MATERIAL)return!0;const {drawInSecondSlot:la,occlusionTest:ma}=this.parameters;return ja===(la?v.RenderSlot.LABEL_MATERIAL:v.RenderSlot.HUD_MATERIAL)||ma&&ja===v.RenderSlot.OCCLUSION_PIXELS};fa.createGLMaterial=function(ja){return ja.output===
m.ShaderOutput.Color||ja.output===m.ShaderOutput.Alpha?new M(ja):ja.output===m.ShaderOutput.Highlight?new K(ja):null};fa.calculateRelativeScreenBounds=function(ja,la,ma=p.create()){I(this.parameters,ja,la,ma);ma[2]=ma[0]+ja[0];ma[3]=ma[1]+ja[1];return ma};return Z}(z.Material),K=function(ca){function Z(ja){return ca.call(this,{...ja,...ja.material.parameters})||this}b._inheritsLoose(Z,ca);var fa=Z.prototype;fa.updateParameters=function(ja){this.updateTexture(this._material.parameters.textureId);return this.selectProgram(ja)};
fa.selectProgram=function(ja){return this.ensureTechnique(J.HUDMaterialTechnique,ja)};fa.beginSlot=function(ja){return this.updateParameters(ja)};fa.bind=function(ja,la){this.bindTextures(la.program);this.bindTextureScale(la.program);la.bindPass(this._material.parameters,ja)};return Z}(q),M=function(ca){function Z(){return ca.apply(this,arguments)||this}b._inheritsLoose(Z,ca);var fa=Z.prototype;fa._isOcclusionSlot=function(ja){return ja.slot===v.RenderSlot.OCCLUSION_PIXELS&&this._material.parameters.occlusionTest&&
(this._output===m.ShaderOutput.Color||this._output===m.ShaderOutput.Alpha)};fa.selectProgram=function(ja){return this.ensureTechnique(J.HUDMaterialTechnique,ja,this._isOcclusionSlot(ja)?m.ShaderOutput.Occlusion:this._output)};fa.bind=function(ja,la){this._isOcclusionSlot(ja)||(this.bindTextures(la.program),this.bindTextureScale(la.program));la.bindPass(this._material.parameters,ja)};return Z}(K);const U={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,
paddingPixels:0}},R=e.create(),L=r.create(),N=r.create(),T=g.createRenderScreenPointArray3(),S=r.create(),H=r.create(),Q=w.create(),W=w.create(),V=n.create(),Y=r.create(),aa={normal:S,cosAngle:0},X=n.create(),ba=[0,0],ha=r.fromValues(0,0,1),ka={texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,
100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,slicePlaneEnabled:!1,anchorPos:e.fromValues(.5,.5),shaderPolygonOffset:1E-5,polygonOffset:!1,textureId:null,centerOffsetUnits:"world",depthEnabled:!0,pixelSnappingEnabled:!0,debugDrawLabelBorder:!1,isDraped:!1,...z.DefaultMaterialParameters},
ia=h.newLayout().vec3f(E.VertexAttribute.POSITION).vec3f(E.VertexAttribute.NORMAL).vec2f(E.VertexAttribute.UV0).vec4u8(E.VertexAttribute.COLOR).vec2f(E.VertexAttribute.SIZE).vec4f(E.VertexAttribute.AUXPOS1).vec4f(E.VertexAttribute.AUXPOS2);let ea=function(){function ca(fa){this.material=fa;this.vertexBufferLayout=ia}var Z=ca.prototype;Z.allocate=function(fa){return this.vertexBufferLayout.createBuffer(fa)};Z.elementCount=function(fa){return 6*fa.indices.get(E.VertexAttribute.POSITION).length};Z.write=
function(fa,ja,la,ma){C.writePosition(ja.indices.get(E.VertexAttribute.POSITION),ja.vertexAttributes.get(E.VertexAttribute.POSITION).data,fa.transformation,la.position,ma,6);C.writeNormal(ja.indices.get(E.VertexAttribute.NORMAL),ja.vertexAttributes.get(E.VertexAttribute.NORMAL).data,fa.invTranspTransformation,la.normal,ma,6);var ra=ja.vertexAttributes.get(E.VertexAttribute.UV0).data;if(null==ra||4>ra.length){ra=this.material.parameters;var va=fa=0;var ya=ra.texCoordScale[0];ra=ra.texCoordScale[1]}else fa=
ra[0],va=ra[1],ya=ra[2],ra=ra[3];ya=Math.min(1.99999,ya+1);ra=Math.min(1.99999,ra+1);var za=ja.indices.get(E.VertexAttribute.POSITION).length,pa=la.uv0,wa=ma;for(var na=0;na<za;++na)pa.set(wa,0,fa),pa.set(wa,1,va),wa+=1,pa.set(wa,0,ya),pa.set(wa,1,va),wa+=1,pa.set(wa,0,ya),pa.set(wa,1,ra),wa+=1,pa.set(wa,0,ya),pa.set(wa,1,ra),wa+=1,pa.set(wa,0,fa),pa.set(wa,1,ra),wa+=1,pa.set(wa,0,fa),pa.set(wa,1,va),wa+=1;C.writeColor(ja.indices.get(E.VertexAttribute.COLOR),ja.vertexAttributes.get(E.VertexAttribute.COLOR).data,
4,la.color,ma,6);fa=ja.indices.get(E.VertexAttribute.SIZE);va=ja.vertexAttributes.get(E.VertexAttribute.SIZE).data;ya=fa.length;ra=la.size;za=ma;for(pa=0;pa<ya;++pa){wa=va[2*fa[pa]];na=va[2*fa[pa]+1];for(let qa=0;6>qa;++qa)ra.set(za,0,wa),ra.set(za,1,na),za+=1}ja.indices.get(E.VertexAttribute.AUXPOS1)&&ja.vertexAttributes.get(E.VertexAttribute.AUXPOS1)&&C.writeBufferVec4(ja.indices.get(E.VertexAttribute.AUXPOS1),ja.vertexAttributes.get(E.VertexAttribute.AUXPOS1).data,la.auxpos1,ma,6);ja.indices.get(E.VertexAttribute.AUXPOS2)&&
ja.vertexAttributes.get(E.VertexAttribute.AUXPOS2)&&C.writeBufferVec4(ja.indices.get(E.VertexAttribute.AUXPOS2),ja.vertexAttributes.get(E.VertexAttribute.AUXPOS2).data,la.auxpos2,ma,6)};return ca}();a.HUDMaterial=P;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/libs/gl-matrix-2/types/mat4":function(){define(["exports"],function(a){function b(d){return d instanceof Float32Array&&16<=d.length}function c(d){return Array.isArray(d)&&16<=d.length}a.isMat4=function(d){return b(d)||c(d)};
a.isMat4f32=b;a.isMat4f64=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions":function(){define(["exports"],function(a){a.ShaderOutput=void 0;var b=a.ShaderOutput||(a.ShaderOutput={});b[b.Color=0]="Color";b[b.Depth=1]="Depth";b[b.Normal=2]="Normal";b[b.Shadow=3]="Shadow";b[b.Highlight=4]="Highlight";b[b.Draped=5]="Draped";b[b.Occlusion=6]="Occlusion";b[b.Alpha=7]="Alpha";b[b.COUNT=8]="COUNT";Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl":function(){define(["exports","./HUDUniforms","../util/ScreenSizePerspective.glsl","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,c,d,g){a.HUDSpace=void 0;(function(x){x[x.World=0]="World";x[x.Screen=1]="Screen";x[x.COUNT=2]="COUNT"})(a.HUDSpace||(a.HUDSpace={}));a.HUD=function(x,w){x.include(c.ScreenSizePerspective);x.attributes.add(g.VertexAttribute.POSITION,"vec3");x.attributes.add(g.VertexAttribute.NORMAL,
"vec3");x.attributes.add(g.VertexAttribute.AUXPOS1,"vec4");x.vertex.uniforms.add("proj","mat4");x.vertex.uniforms.add("view","mat4");x.vertex.uniforms.add("viewNormal","mat4");x.vertex.uniforms.add("viewport","vec4");x.vertex.uniforms.add("cameraPosition","vec3");x.vertex.uniforms.add("polygonOffset","float");x.vertex.uniforms.add("cameraGroundRelative","float");x.vertex.uniforms.add("pixelRatio","float");x.vertex.uniforms.add("perDistancePixelRatio","float");x.vertex.uniforms.add("renderTransparentlyOccludedHUD",
"float");w.verticalOffsetEnabled&&x.vertex.uniforms.add("verticalOffset","vec4");w.screenSizePerspectiveEnabled&&x.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4");x.vertex.uniforms.add("hudVisibilityTexture","sampler2D");x.vertex.constants.add("smallOffsetAngle","float",.984807753012208);x.vertex.code.add(d.glsl`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`);x.vertex.code.add(d.glsl`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`);w.isDraped||x.vertex.code.add(d.glsl`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`);x.vertex.code.add(d.glsl`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${w.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${w.screenSizePerspectiveEnabled?w.verticalOffsetEnabled||w.screenCenterOffsetUnitsEnabled===a.HUDSpace.Screen?"vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":"":""}

      ${w.verticalOffsetEnabled?w.screenSizePerspectiveEnabled?"float verticalOffsetScreenHeight \x3d applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight \x3d verticalOffset.x;":""}

      ${w.verticalOffsetEnabled?d.glsl`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${w.screenCenterOffsetUnitsEnabled!==a.HUDSpace.Screen?d.glsl`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${w.screenCenterOffsetUnitsEnabled===a.HUDSpace.Screen?w.screenSizePerspectiveEnabled?"float centerOffsetY \x3d applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY \x3d centerOffset.y;":""}

      ${w.screenCenterOffsetUnitsEnabled===a.HUDSpace.Screen?"posProj.xy +\x3d vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `);x.vertex.code.add(d.glsl`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)};a.bindHUDUniforms=function(x,w){x.setUniform1f("renderTransparentlyOccludedHUD",w.renderTransparentlyOccludedHUD===b.HUDTransparentRenderStyle.OCCLUDED?1:w.renderTransparentlyOccludedHUD===b.HUDTransparentRenderStyle.NOTOCCLUDED?0:.75)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUDUniforms":function(){define(["exports"],function(a){a.HUDTransparentRenderStyle=void 0;var b=a.HUDTransparentRenderStyle||(a.HUDTransparentRenderStyle={});
b[b.OCCLUDED=0]="OCCLUDED";b[b.NOTOCCLUDED=1]="NOTOCCLUDED";b[b.BOTH=2]="BOTH";b[b.COUNT=3]="COUNT";Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl":function(){define(["exports","../../shaderModules/interfaces","../../../materials/internal/MaterialUtil"],function(a,b,c){a.ScreenSizePerspective=function(d){d.vertex.code.add(b.glsl`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`);d.vertex.code.add(b.glsl`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`);d.vertex.code.add(b.glsl`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`);d.vertex.code.add(b.glsl`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`);d.vertex.code.add(b.glsl`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`);d.vertex.code.add(b.glsl`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / max(1e-5, size.y), 1.0), size, factor.y);
}`);d.vertex.code.add(b.glsl`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)};a.bindScreenSizePerspectiveUniforms=function(d,g){g.screenSizePerspective&&(c.bindScreenSizePerspective(g.screenSizePerspective,d,"screenSizePerspective"),c.bindScreenSizePerspective(g.screenSizePerspectiveAlignment||g.screenSizePerspective,d,"screenSizePerspectiveAlignment"))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/internal/MaterialUtil":function(){define("exports ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/aaBoundingBox ../../lib/basicInterfaces ../../lib/screenSizePerspectiveUtils ../../lib/Util ../../lib/VertexAttribute ../renderers/utils".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e){function k(E,C,D,F,G,J){if(!c.isNone(E)){var I=p(C,D,z);x.setMin(q,E.getBBMin());x.setMax(q,E.getBBMax());c.isSome(G)&&G.applyToAabb(q);if(h(q,C,I,F)){const {primitiveIndices:O,indices:P,position:K}=E;I=O?O.length:P.length/3;if(1E3<I&&(E=E.getChildren(),void 0!==E)){for(I=0;8>I;++I)void 0!==E[I]&&k(E[I],C,D,F,G,J);return}r(C,D,0,I,P,K,O,G,J)}}}function r(E,C,D,F,G,J,I,O,P){if(I){var K=J.data;J=J.stride||J.size;var M=E[0],U=E[1];E=E[2];var R=C[0]-M,L=C[1]-U;for(C=C[2]-
E;D<F;++D){var N=I[D],T=3*N,S=J*G[T++],H=K[S++],Q=K[S++],W=K[S];S=J*G[T++];var V=K[S++],Y=K[S++],aa=K[S];S=J*G[T];T=K[S++];var X=K[S++];S=K[S];c.isSome(O)&&([H,Q,W]=O.applyToVertex(H,Q,W,D),[V,Y,aa]=O.applyToVertex(V,Y,aa,D),[T,X,S]=O.applyToVertex(T,X,S,D));V-=H;Y-=Q;aa-=W;T-=H;X-=Q;S-=W;var ba=L*S-X*C,ha=C*T-S*R;const ia=R*X-T*L;var ka=V*ba+Y*ha+aa*ia;if(!(Math.abs(ka)<=Number.EPSILON)){H=M-H;Q=U-Q;W=E-W;ba=H*ba+Q*ha+W*ia;if(0<ka){if(0>ba||ba>ka)continue}else if(0<ba||ba<ka)continue;ha=Q*aa-Y*W;
W=W*V-aa*H;Q=H*Y-V*Q;H=R*ha+L*W+C*Q;if(0<ka){if(0>H||ba+H>ka)continue}else if(0<H||ba+H<ka)continue;W=(T*ha+X*W+S*Q)/ka;0<=W&&(V=y(V,Y,aa,T,X,S,v),P(W,V,N,!1))}}}else{I=J.data;K=J.stride||J.size;J=E[0];M=E[1];U=E[2];E=C[0]-J;R=C[1]-M;L=C[2]-U;for(let ia=D,ea=3*D;ia<F;++ia)if(T=K*G[ea++],Q=I[T++],W=I[T++],aa=I[T],T=K*G[ea++],C=I[T++],D=I[T++],N=I[T],T=K*G[ea++],V=I[T++],Y=I[T++],T=I[T],c.isSome(O)&&([Q,W,aa]=O.applyToVertex(Q,W,aa,ia),[C,D,N]=O.applyToVertex(C,D,N,ia),[V,Y,T]=O.applyToVertex(V,Y,T,
ia)),C-=Q,D-=W,N-=aa,V-=Q,Y-=W,T-=aa,S=R*T-Y*L,H=L*V-T*E,ka=E*Y-V*R,X=C*S+D*H+N*ka,!(Math.abs(X)<=Number.EPSILON)){Q=J-Q;W=M-W;aa=U-aa;S=Q*S+W*H+aa*ka;if(0<X){if(0>S||S>X)continue}else if(0<S||S<X)continue;H=W*N-D*aa;aa=aa*C-N*Q;W=Q*D-C*W;Q=E*H+R*aa+L*W;if(0<X){if(0>Q||S+Q>X)continue}else if(0<Q||S+Q<X)continue;aa=(V*H+Y*aa+T*W)/X;0<=aa&&(C=y(C,D,N,V,Y,T,v),P(aa,C,ia,!1))}}}function y(E,C,D,F,G,J,I){d.set(B,E,C,D);d.set(A,F,G,J);d.cross(I,B,A);d.normalize(I,I);return I}function p(E,C,D){return d.set(D,
1/(C[0]-E[0]),1/(C[1]-E[1]),1/(C[2]-E[2]))}function h(E,C,D,F){return m(E,C,D,F,Infinity)}function m(E,C,D,F,G){var J=(E[0]-F-C[0])*D[0],I=(E[3]+F-C[0])*D[0];let O=Math.min(J,I);J=Math.max(J,I);I=(E[1]-F-C[1])*D[1];const P=(E[4]+F-C[1])*D[1];J=Math.min(J,Math.max(I,P));if(0>J)return!1;O=Math.max(O,Math.min(I,P));if(O>J)return!1;I=(E[2]-F-C[2])*D[2];E=(E[5]+F-C[2])*D[2];J=Math.min(J,Math.max(I,E));if(0>J)return!1;O=Math.max(O,Math.min(I,E));return O>J?!1:O<G}function u(E,C){C=C?u(C):{};for(const D in E){let F=
E[D];F&&F.forEach&&(F=t(F));null==F&&D in C||(C[D]=F)}return C}function t(E){const C=[];E.forEach(D=>C.push(D));return C}const q=x.create(),z=g.create(),v=g.create(),B=g.create(),A=g.create();a.bindScreenSizePerspective=function(E,C,D){if(E){var F=E.parameters;C.setUniform4f(D,F.divisor,F.offset,F.minPixelSize,E.paddingPixelsOverride)}};a.colorMixModes={multiply:1,ignore:2,replace:3,tint:4};a.computeInvDir=p;a.computeNormal=y;a.copyParameters=u;a.intersectAabbInvDir=h;a.intersectAabbInvDirBefore=
m;a.intersectDrapedRenderLineGeometry=function(E,C,D,F,G,J){if(C.options.selectionMode){C=E.vertexAttributes.get(f.VertexAttribute.POSITION).data;var I=E.vertexAttributes.get(f.VertexAttribute.SIZE),O=F[0];F=F[1];E=(((I&&I.data[0])+G)/2+4)*E.screenToWorldRatio;G=Number.MAX_VALUE;I=0;for(let R=0;R<C.length-5;R+=3){var P=C[R],K=C[R+1],M=O-P,U=F-K;P=C[R+3]-P;K=C[R+4]-K;const L=b.clamp((P*M+K*U)/(P*P+K*K),0,1);M=P*L-M;U=K*L-U;U=M*M+U*U;U<G&&(G=U,I=R/3)}G<E*E&&J(D.dist,D.normal,I,!1)}};a.intersectTriangleGeometry=
function(E,C,D,F,G,J,I){e.isInstanceHidden(C)||(E.boundingInfo?(n.assert(E.primitiveType===w.PrimitiveType.Triangle),k(E.boundingInfo,F,G,D.tolerance,J,I)):(C=E.indices.get(f.VertexAttribute.POSITION),E=E.vertexAttributes.get(f.VertexAttribute.POSITION),r(F,G,0,C.length/3,C,E,void 0,J,I)))};a.intersectTriangles=r;a.updateParameters=function(E,C){let D=!1;for(const F in C){const G=C[F];void 0!==G&&(D=!0,Array.isArray(G)?E[F]=G.slice():E[F]=G)}return D};a.verticalOffsetAtDistance=function(E,C,D,F,G){let J=
(D.screenLength||0)*E.pixelRatio;G&&(J=l.scale(J,F,C,G));return b.clamp(J*Math.tan(.5*E.fovY)/(.5*E.fullHeight)*C,D.minWorldLength||0,null!=D.maxWorldLength?D.maxWorldLength:Infinity)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/GLMaterialTexture":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/promiseUtils","./basicInterfaces","./GLMaterial"],function(a,b,c,d,g){return function(x){function w(n){var f=
x.call(this,n)||this;f._numLoading=0;f._disposed=!1;f._textureRepository=n.textureRep;f._textureId=n.textureId;f._acquire(n.textureId,e=>f._texture=e);f._acquire(n.normalTextureId,e=>f._textureNormal=e);f._acquire(n.emissiveTextureId,e=>f._textureEmissive=e);f._acquire(n.occlusionTextureId,e=>f._textureOcclusion=e);f._acquire(n.metallicRoughnessTextureId,e=>f._textureMetallicRoughness=e);return f}a._inheritsLoose(w,x);var l=w.prototype;l.dispose=function(){this._texture=b.releaseMaybe(this._texture);
this._textureNormal=b.releaseMaybe(this._textureNormal);this._textureEmissive=b.releaseMaybe(this._textureEmissive);this._textureOcclusion=b.releaseMaybe(this._textureOcclusion);this._textureMetallicRoughness=b.releaseMaybe(this._textureMetallicRoughness);this._disposed=!0};l.ensureResources=function(n){return 0===this._numLoading?d.ResourceState.LOADED:d.ResourceState.LOADING};l.updateTexture=function(n){if(b.isNone(this._texture)||n!==this._texture.id)this._texture=b.releaseMaybe(this._texture),
this._textureId=n,this._acquire(this._textureId,f=>this._texture=f)};l.bindTextures=function(n){b.isSome(this._texture)&&n.bindTexture(this._texture.glTexture,"tex");b.isSome(this._textureNormal)&&n.bindTexture(this._textureNormal.glTexture,"normalTexture");b.isSome(this._textureEmissive)&&n.bindTexture(this._textureEmissive.glTexture,"texEmission");b.isSome(this._textureOcclusion)&&n.bindTexture(this._textureOcclusion.glTexture,"texOcclusion");b.isSome(this._textureMetallicRoughness)&&n.bindTexture(this._textureMetallicRoughness.glTexture,
"texMetallicRoughness")};l.bindTextureScale=function(n){const f=b.isSome(this._texture)?this._texture.glTexture:null;b.isSome(f)&&f.descriptor.textureCoordinateScaleFactor?n.setUniform2fv("textureCoordinateScaleFactor",f.descriptor.textureCoordinateScaleFactor):n.setUniform2f("textureCoordinateScaleFactor",1,1)};l._acquire=function(n,f){b.isNone(n)?f(null):(n=this._textureRepository.acquire(n),c.isPromiseLike(n)?(++this._numLoading,n.then(e=>{this._disposed?(b.releaseMaybe(e),f(null)):f(e)}).finally(()=>
--this._numLoading)):f(n))};return w}(g)})},"esri/views/3d/webgl-engine/lib/GLMaterial":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","./basicInterfaces"],function(a,b){return function(){function c(g){this._material=g.material;this._techniqueRep=g.techniqueRep;this._output=g.output}var d=c.prototype;d.dispose=function(){this._techniqueRep.release(this._technique)};d.ensureTechnique=function(g,x,w=this._output){return this._technique=this._techniqueRep.releaseAndAcquire(g,this._material.getTechniqueConfig(w,
x),this._technique)};d.ensureResources=function(g){return b.ResourceState.LOADED};a._createClass(c,[{key:"technique",get:function(){return this._technique}}]);return c}()})},"esri/views/3d/webgl-engine/lib/Material":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ./ContentObject ./ContentObjectType ./DefaultVertexAttributeLocations ../materials/internal/MaterialUtil".split(" "),function(a,b,c,d,g,x,w){d=function(l){function n(e,k){var r=l.call(this)||
this;r.type=g.ContentObjectType.Material;r.supportsEdges=!1;r._visible=!0;r._renderPriority=0;r._insertOrder=0;r._vertexAttributeLocations=x.Default3D;r._parameters=w.copyParameters(e,k);r.validateParameters(r._parameters);return r}b._inheritsLoose(n,l);var f=n.prototype;f.dispose=function(){};f.update=function(e){return!1};f.setParameters=function(e){w.updateParameters(this._parameters,e)&&(this.validateParameters(this._parameters),this.parametersChanged())};f.validateParameters=function(e){};f.shouldRender=
function(e){return this.isVisible()&&this.isVisibleInPass(e.pass)&&0!==(this.renderOccluded&e.renderOccludedMask)};f.isVisibleInPass=function(e){return!0};f.isVisible=function(){return this._visible};f.parametersChanged=function(){c.isSome(this.repository)&&this.repository.materialChanged(this)};b._createClass(n,[{key:"parameters",get:function(){return this._parameters}},{key:"visible",get:function(){return this._visible},set:function(e){e!==this._visible&&(this._visible=e,this.parametersChanged())}},
{key:"renderOccluded",get:function(){return this.parameters.renderOccluded}},{key:"renderPriority",get:function(){return this._renderPriority},set:function(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())}},{key:"insertOrder",get:function(){return this._insertOrder},set:function(e){e!==this._insertOrder&&(this._insertOrder=e,this.parametersChanged())}},{key:"vertexAttributeLocations",get:function(){return this._vertexAttributeLocations}}]);return n}(d.ContentObject);
a.RenderOccludedFlag=void 0;(function(l){l[l.Occlude=1]="Occlude";l[l.Transparent=2]="Transparent";l[l.OccludeAndTransparent=4]="OccludeAndTransparent";l[l.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil";l[l.Opaque=16]="Opaque"})(a.RenderOccludedFlag||(a.RenderOccludedFlag={}));a.DefaultMaterialParameters={renderOccluded:a.RenderOccludedFlag.Occlude};a.Material=d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/internal/bufferWriterUtils":function(){define(["exports",
"../../../../../chunks/mat4","../../../../../geometry/support/buffer/BufferView","../../lib/Util","../../lib/VertexAttribute"],function(a,b,c,d,g){function x(r,y,p,h){const m=p.typedBuffer;p=p.typedBufferStride;const u=r.length;h*=p;for(let t=0;t<u;++t){const q=2*r[t];m[h]=y[q];m[h+1]=y[q+1];h+=p}}function w(r,y,p,h,m){const u=p.typedBuffer;p=p.typedBufferStride;const t=r.length;h*=p;if(null==m||1===m)for(m=0;m<t;++m){var q=3*r[m];u[h]=y[q];u[h+1]=y[q+1];u[h+2]=y[q+2];h+=p}else for(q=0;q<t;++q){const z=
3*r[q];for(let v=0;v<m;++v)u[h]=y[z],u[h+1]=y[z+1],u[h+2]=y[z+2],h+=p}}function l(r,y,p,h,m=1){const u=p.typedBuffer;p=p.typedBufferStride;const t=r.length;h*=p;if(1===m)for(m=0;m<t;++m){var q=4*r[m];u[h]=y[q];u[h+1]=y[q+1];u[h+2]=y[q+2];u[h+3]=y[q+3];h+=p}else for(q=0;q<t;++q){const z=4*r[q];for(let v=0;v<m;++v)u[h]=y[z],u[h+1]=y[z+1],u[h+2]=y[z+2],u[h+3]=y[z+3],h+=p}}function n(r,y,p,h,m,u=1){if(p){var t=h.typedBuffer;h=h.typedBufferStride;var q=r.length,z=p[0],v=p[1],B=p[2],A=p[4],E=p[5],C=p[6],
D=p[8],F=p[9],G=p[10],J=p[12],I=p[13];p=p[14];m*=h;if(1===u)for(u=0;u<q;++u){var O=3*r[u],P=y[O],K=y[O+1];O=y[O+2];t[m]=z*P+A*K+D*O+J;t[m+1]=v*P+E*K+F*O+I;t[m+2]=B*P+C*K+G*O+p;m+=h}else for(P=0;P<q;++P){K=3*r[P];var M=y[K],U=y[K+1];const R=y[K+2];K=z*M+A*U+D*R+J;O=v*M+E*U+F*R+I;M=B*M+C*U+G*R+p;for(U=0;U<u;++U)t[m]=K,t[m+1]=O,t[m+2]=M,m+=h}}else w(r,y,h,m,u)}function f(r,y,p,h,m,u=1){if(p){var t=h.typedBuffer;h=h.typedBufferStride;var q=r.length,z=p[0],v=p[1],B=p[2],A=p[4],E=p[5],C=p[6],D=p[8],F=p[9],
G=p[10];p=!b.isOrthoNormal(p);m*=h;if(1===u)for(u=0;u<q;++u){var J=3*r[u],I=y[J],O=y[J+1],P=y[J+2];J=z*I+A*O+D*P;var K=v*I+E*O+F*P;I=B*I+C*O+G*P;p&&(O=J*J+K*K+I*I,.999999>O&&1E-6<O&&(O=1/Math.sqrt(O),J*=O,K*=O,I*=O));t[m+0]=J;t[m+1]=K;t[m+2]=I;m+=h}else for(J=0;J<q;++J){K=3*r[J];O=y[K];P=y[K+1];const M=y[K+2];K=z*O+A*P+D*M;I=v*O+E*P+F*M;O=B*O+C*P+G*M;p&&(P=K*K+I*I+O*O,.999999>P&&1E-6<P&&(P=1/Math.sqrt(P),K*=P,I*=P,O*=P));for(P=0;P<u;++P)t[m+0]=K,t[m+1]=I,t[m+2]=O,m+=h}}else w(r,y,h,m,u)}function e(r,
y,p,h,m,u=1){if(p){var t=h.typedBuffer;h=h.typedBufferStride;var q=r.length,z=p[0],v=p[1],B=p[2],A=p[4],E=p[5],C=p[6],D=p[8],F=p[9],G=p[10];p=!b.isOrthoNormal(p);m*=h;if(1===u)for(u=0;u<q;++u){var J=4*r[u],I=y[J],O=y[J+1],P=y[J+2];J=y[J+3];var K=z*I+A*O+D*P,M=v*I+E*O+F*P;I=B*I+C*O+G*P;p&&(O=K*K+M*M+I*I,.999999>O&&1E-6<O&&(O=1/Math.sqrt(O),K*=O,M*=O,I*=O));t[m+0]=K;t[m+1]=M;t[m+2]=I;t[m+3]=J;m+=h}else for(J=0;J<q;++J){K=4*r[J];O=y[K];P=y[K+1];const U=y[K+2];K=y[K+3];M=z*O+A*P+D*U;I=v*O+E*P+F*U;O=B*
O+C*P+G*U;p&&(P=M*M+I*I+O*O,.999999>P&&1E-6<P&&(P=1/Math.sqrt(P),M*=P,I*=P,O*=P));for(P=0;P<u;++P)t[m+0]=M,t[m+1]=I,t[m+2]=O,t[m+3]=K,m+=h}}else l(r,y,h,m,u)}function k(r,y,p,h,m,u=1){const t=h.typedBuffer;h=h.typedBufferStride;const q=r.length;m*=h;if(1===u)if(4===p)for(u=0;u<q;++u)p=4*r[u],t[m]=y[p],t[m+1]=y[p+1],t[m+2]=y[p+2],t[m+3]=y[p+3],m+=h;else{if(3===p)for(u=0;u<q;++u)p=3*r[u],t[m]=y[p],t[m+1]=y[p+1],t[m+2]=y[p+2],t[m+3]=255,m+=h}else if(4===p)for(p=0;p<q;++p){var z=4*r[p];for(var v=0;v<
u;++v)t[m]=y[z],t[m+1]=y[z+1],t[m+2]=y[z+2],t[m+3]=y[z+3],m+=h}else if(3===p)for(p=0;p<q;++p)for(z=3*r[p],v=0;v<u;++v)t[m]=y[z],t[m+1]=y[z+1],t[m+2]=y[z+2],t[m+3]=255,m+=h}a.writeBufferFloat=function(r,y,p,h,m=1){const u=p.typedBuffer;p=p.typedBufferStride;const t=r.length;h*=p;if(1===m)for(m=0;m<t;++m)u[h]=y[r[m]],h+=p;else for(let q=0;q<t;++q){const z=y[r[q]];for(let v=0;v<m;v++)u[h]=z,h+=p}};a.writeBufferMat3f=function(r,y,p,h){const m=p.typedBuffer;p=p.typedBufferStride;const u=r.length;h*=p;
for(let t=0;t<u;++t){const q=9*r[t];for(let z=0;9>z;++z)m[h+z]=y[q+z];h+=p}};a.writeBufferMat4f=function(r,y,p,h){const m=p.typedBuffer;p=p.typedBufferStride;const u=r.length;h*=p;for(let t=0;t<u;++t){const q=16*r[t];for(let z=0;16>z;++z)m[h+z]=y[q+z];h+=p}};a.writeBufferVec2=x;a.writeBufferVec3=w;a.writeBufferVec4=l;a.writeColor=k;a.writeDefaultAttributes=function(r,y,p,h,m,u){for(const q of y.fieldNames){y=r.vertexAttributes.get(q);const z=r.indices.get(q);if(y&&z)switch(q){case g.VertexAttribute.POSITION:d.assert(3===
y.size);var t=m.getField(q,c.BufferViewVec3f);t&&n(z,y.data,p,t,u);break;case g.VertexAttribute.NORMAL:d.assert(3===y.size);(t=m.getField(q,c.BufferViewVec3f))&&f(z,y.data,h,t,u);break;case g.VertexAttribute.UV0:d.assert(2===y.size);(t=m.getField(q,c.BufferViewVec2f))&&x(z,y.data,t,u);break;case g.VertexAttribute.COLOR:d.assert(3===y.size||4===y.size);(t=m.getField(q,c.BufferViewVec4u8))&&k(z,y.data,y.size,t,u);break;case g.VertexAttribute.SYMBOLCOLOR:d.assert(3===y.size||4===y.size);(t=m.getField(q,
c.BufferViewVec4u8))&&k(z,y.data,y.size,t,u);break;case g.VertexAttribute.TANGENT:d.assert(4===y.size),(t=m.getField(q,c.BufferViewVec4f))&&e(z,y.data,h,t,u)}}};a.writeNormal=f;a.writePosition=n;a.writeTangent=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/HUDMaterial.glsl":function(){define("exports ./vec2 ./vec2f64 ./vec4f64 ../views/3d/layers/graphics/sdfPrimitives ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUDOcclusionPass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t){function q(A){const E=new u.ShaderBuilder;var C=A.signedDistanceFieldEnabled;E.include(l.AlignPixel);E.include(n.HUD,A);E.include(w.Slice,A);if(A.output===x.ShaderOutput.Occlusion)return E.include(f.HUDOcclusionPass,A),E;E.include(h.ScreenSizePerspective);E.fragment.include(p.RgbaFloatEncoding);E.fragment.include(y.ColorConversion);E.include(k.VisualVariables,A);E.varyings.add("vcolor","vec4");E.varyings.add("vtc","vec2");E.varyings.add("vsize","vec2");
A.binaryHighlightOcclusionEnabled&&E.varyings.add("voccluded","float");E.vertex.uniforms.add("screenOffset","vec2").add("anchorPos","vec2").add("textureCoordinateScaleFactor","vec2").add("materialColor","vec4");C&&E.vertex.uniforms.add("outlineColor","vec4");A.screenSizePerspectiveEnabled&&E.vertex.uniforms.add("screenSizePerspective","vec4");(A.debugDrawLabelBorder||A.binaryHighlightOcclusionEnabled)&&E.varyings.add("debugBorderCoords","vec4");E.attributes.add(t.VertexAttribute.UV0,"vec2");E.attributes.add(t.VertexAttribute.COLOR,
"vec4");E.attributes.add(t.VertexAttribute.SIZE,"vec2");E.attributes.add(t.VertexAttribute.AUXPOS2,"vec4");E.vertex.code.add(m.glsl`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${A.screenSizePerspectiveEnabled?m.glsl`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:m.glsl`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${A.vvSize?"inputSize *\x3d vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${A.occlusionTestEnabled||A.binaryHighlightOcclusionEnabled?"bool visible \x3d testVisibilityHUD(posProj);":""}

      ${A.binaryHighlightOcclusionEnabled?"voccluded \x3d visible ? 0.0 : 1.0;":""}
    `);var D=m.glsl`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`;const F=A.pixelSnappingEnabled?C?m.glsl`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:m.glsl`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:m.glsl`posProj += quadOffset;`;E.vertex.code.add(m.glsl`
      ${A.occlusionTestEnabled?"if (visible) {":""}
      ${D}
      ${A.vvColor?"vcolor \x3d vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor \x3d color / 255.0 * materialColor;"}

      bool alphaDiscard = vcolor.a < ${m.glsl.float(r.symbolAlphaCutoff)};
      ${C?`alphaDiscard = alphaDiscard && outlineColor.a < ${m.glsl.float(r.symbolAlphaCutoff)};`:""}
      if (alphaDiscard) {
        // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      } else {
        ${F}
        gl_Position = posProj;
      }

      vtc = uv * textureCoordinateScaleFactor;

      ${A.debugDrawLabelBorder?"debugBorderCoords \x3d vec4(uv01, 1.5 / combinedSize);":""}
      vsize = inputSize;
      ${A.occlusionTestEnabled?m.glsl`} else { vtc = vec2(0.0);
        ${A.debugDrawLabelBorder?"debugBorderCoords \x3d vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
    }
    `);E.fragment.uniforms.add("tex","sampler2D");C&&(E.fragment.uniforms.add("outlineColor","vec4"),E.fragment.uniforms.add("outlineSize","float"));D=A.debugDrawLabelBorder?m.glsl`(isBorder > 0.0 ? 0.0 : ${m.glsl.float(r.defaultMaskAlphaCutoff)})`:m.glsl.float(r.defaultMaskAlphaCutoff);C=m.glsl`
    ${A.debugDrawLabelBorder?m.glsl`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${C?m.glsl`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = ${m.glsl.float(g.DEFAULT_TEX_SIZE)};
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${D} ||
          fillPixelColor.a + outlinePixelColor.a < ${m.glsl.float(r.symbolAlphaCutoff)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        gl_FragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${D}) {
          discard;
        }

        gl_FragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:m.glsl`
          vec4 texColor = texture2D(tex, vtc, -0.5);
          if (texColor.a < ${D}) {
            discard;
          }
          gl_FragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${A.debugDrawLabelBorder?m.glsl`gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;A.output===x.ShaderOutput.Alpha&&E.fragment.code.add(m.glsl`
      void main() {
        ${C}
        gl_FragColor = vec4(gl_FragColor.a);
      }
      `);A.output===x.ShaderOutput.Color&&E.fragment.code.add(m.glsl`
    void main() {
      ${C}
      ${A.frontFacePass?"gl_FragColor.rgb /\x3d gl_FragColor.a;":""}
    }
    `);A.output===x.ShaderOutput.Highlight&&(E.include(e.OutputHighlight),E.fragment.code.add(m.glsl`
    void main() {
      ${C}
      ${A.binaryHighlightOcclusionEnabled?m.glsl`
          if (voccluded == 1.0) {
            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `));return E}function z(A,E,C){A.setUniform4fv("materialColor",E.color);E.textureIsSignedDistanceField&&(0>=E.outlineColor[3]||0>=E.outlineSize?(A.setUniform4fv("outlineColor",d.ZEROS),A.setUniform1f("outlineSize",0)):(A.setUniform4fv("outlineColor",E.outlineColor),A.setUniform1f("outlineSize",E.outlineSize)));A.setUniform2f("screenOffset",2*E.screenOffset[0]*C,2*E.screenOffset[1]*C);A.setUniform2fv("anchorPos",v(E))}function v(A,E=B){if(A.textureIsSignedDistanceField){var C=A.anchorPos;A=A.distanceFieldBoundingBox;
E[0]=C[0]*(A[2]-A[0])+A[0];E[1]=C[1]*(A[3]-A[1])+A[1]}else b.copy(E,A.anchorPos);return E}const B=c.create();c=Object.freeze({__proto__:null,build:q,bindHUDMaterialUniforms:z,calculateAnchorPosForRendering:v});a.HUDMaterialShader=c;a.bindHUDMaterialUniforms=z;a.build=q;a.calculateAnchorPosForRendering=v})},"esri/views/3d/layers/graphics/sdfPrimitives":function(){define(["exports","../../../../core/has","../../../../core/floatRGBA","../../webgl-engine/lib/Texture","../../../webgl/enums"],function(a,
b,c,d,g){function x(t,q=128,z=.5*q,v=0){switch(t){case "circle":return w(q,z);case "square":return l(q,z);case "cross":return f(q,z,v);case "x":return e(q,z,v);case "kite":return n(q,z);case "triangle":return k(q,z);case "arrow":return r(q,z);default:return w(q,z)}}function w(t,q){const z=t/2-.5;return u(t,h(z,z,q/2))}function l(t,q){return y(t,q,!1)}function n(t,q){return y(t,q,!0)}function f(t,q,z=0){return p(t,q,!1,z)}function e(t,q,z=0){return p(t,q,!0,z)}function k(t,q){return u(t,m(t/2,q,q/
2))}function r(t,q){const z=q/2,v=t/2,B=.8*q,A=h(v,(t-q)/2-B,Math.sqrt(B*B+z*z)),E=m(v,q,z);return u(t,(C,D)=>Math.max(E(C,D),-A(C,D)))}function y(t,q,z){z&&(q/=Math.SQRT2);return u(t,(v,B)=>{v=v-.5*t+.25;B=-B+.5*t-.75;if(z){const A=(v+B)/Math.SQRT2;B=(B-v)/Math.SQRT2;v=A}return Math.max(Math.abs(v),Math.abs(B))-.5*q})}function p(t,q,z,v=0){q-=v;z&&(q*=Math.SQRT2);const B=.5*q;return u(t,(A,E)=>{A-=.5*t;E=-E+.5*t-1;if(z){const C=(A+E)/Math.SQRT2;E=(E-A)/Math.SQRT2;A=C}A=Math.abs(A);E=Math.abs(E);
A=A>E?A>B?Math.sqrt((A-B)*(A-B)+E*E):E:E>B?Math.sqrt(A*A+(E-B)*(E-B)):A;return A-=v/2})}function h(t,q,z){return(v,B)=>{v-=t;B-=q;return Math.sqrt(v*v+B*B)-z}}function m(t,q,z){const v=Math.sqrt(q*q+z*z);return(B,A)=>{A=A-t+q/2+.75;return Math.max((q*(Math.abs(B-t)-z)+z*A)/v,-A)}}function u(t,q){const z=new Uint8Array(4*t*t);for(let v=0;v<t;v++)for(let B=0;B<t;B++){const A=B+t*v;let E=q(B,v);E=E/t+.5;c.packFloatRGBA(E,z,4*A)}return z}a.DEFAULT_SYMBOL_SIZE_RATIO=.5;a.DEFAULT_TEX_SIZE=128;a.createArrow=
r;a.createCircle=w;a.createCross=f;a.createKite=n;a.createPrimitive=x;a.createSquare=l;a.createTexture=function(t,q=128,z=.5*q,v=0){t=x(t,q,z,v);return new d.Texture(t,{mipmap:!1,wrap:{s:g.TextureWrapMode.CLAMP_TO_EDGE,t:g.TextureWrapMode.CLAMP_TO_EDGE},width:q,height:q,components:4,noUnpackFlip:!0})};a.createTriangle=k;a.createX=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/floatRGBA":function(){define(["exports","./mathUtils"],function(a,b){function c(l,n=0){let f=0;for(let e=
0;4>e;e++)f+=l[n+e]*x[e];return f}function d(l){return l-Math.floor(l)}const g=[1,256,65536,16777216],x=[1/256,1/65536,1/16777216,1/4294967296],w=c(new Uint8ClampedArray([255,255,255,255]));a.packFloatRGBA=function(l,n,f=0){l=b.clamp(l,0,w);for(let e=0;4>e;e++)n[f+e]=Math.floor(256*d(l*g[e]))};a.unpackFloatRGBA=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Texture":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/compilerUtils ../../../../core/Error ../../../../core/Evented ../../../../core/mathUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/typedArrayUtil ../../../../core/urlUtils ../../../../support/requestImageUtils ../../../../support/requestUtils ./basicInterfaces ./BasisUtil ./ContentObject ./ContentObjectType ./DDSUtil ./glUtil3D ./Util ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util ../../../webgl/capabilities/isWebGL2Context".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A){p=function(C){function D(G,J){var I=C.call(this)||this;I.data=G;I.type=h.ContentObjectType.Texture;I._glTexture=null;I._powerOfTwoStretchInfo=null;I._loadingPromise=null;I._loadingController=null;I.events=new g;I.params=J||{};I.params.mipmap=!1!==I.params.mipmap;I.params.noUnpackFlip=I.params.noUnpackFlip||!1;I.params.preMultiplyAlpha=I.params.preMultiplyAlpha||!1;I.params.wrap=I.params.wrap||{s:q.TextureWrapMode.REPEAT,t:q.TextureWrapMode.REPEAT};
I.params.powerOfTwoResizeMode=I.params.powerOfTwoResizeMode||r.PowerOfTwoResizeMode.STRETCH;I.estimatedTexMemRequired=D._estimateTexMemRequired(I.data,I.params);I._startPreload();return I}b._inheritsLoose(D,C);var F=D.prototype;F._startPreload=function(){const G=this.data;w.isNone(G)||(G instanceof HTMLVideoElement?this._startPreloadVideoElement(G):G instanceof HTMLImageElement&&this._startPreloadImageElement(G))};F._startPreloadVideoElement=function(G){f.isBlobProtocol(G.src)||"auto"===G.preload&&
G.crossOrigin||(G.preload="auto",G.crossOrigin="anonymous",G.src=G.src)};F._startPreloadImageElement=function(G){f.isDataProtocol(G.src)||f.isBlobProtocol(G.src)||G.crossOrigin||(G.crossOrigin="anonymous",G.src=G.src)};D._getDataDimensions=function(G){return G instanceof HTMLVideoElement?{width:G.videoWidth,height:G.videoHeight}:G};D._estimateTexMemRequired=function(G,J){if(w.isNone(G))return 0;if(n.isArrayBuffer(G)||n.isUint8Array(G))return J.encoding===D.KTX2_ENCODING?y.estimateMemoryKTX2(G,J.mipmap):
J.encoding===D.BASIS_ENCODING?y.estimateMemoryBasis(G,J.mipmap):G.byteLength;const {width:I,height:O}=G instanceof Image||G instanceof ImageData||G instanceof HTMLCanvasElement||G instanceof HTMLVideoElement?D._getDataDimensions(G):J;return(J.mipmap?4/3:1)*I*O*(J.components||4)||0};F.dispose=function(){this.data=void 0};F._createDescriptor=function(G){var J;return{target:q.TextureType.TEXTURE_2D,pixelFormat:q.PixelFormat.RGBA,dataType:q.PixelType.UNSIGNED_BYTE,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,
samplingMode:this.params.mipmap?q.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:q.TextureSamplingMode.LINEAR,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:null!=(J=this.params.maxAnisotropy)?J:this.params.mipmap?G.parameters.maxMaxAnisotropy:1}};F.load=function(G,J){if(w.isSome(this._glTexture))return this._glTexture;if(w.isSome(this._loadingPromise))return this._loadingPromise;const I=this.data;return w.isNone(I)?this._glTexture=new v.Texture(G,this._createDescriptor(G),
null):"string"===typeof I?this._loadFromURL(G,J,I):I instanceof Image?this._loadFromImageElement(G,J,I):I instanceof HTMLVideoElement?this._loadFromVideoElement(G,J,I):I instanceof ImageData||I instanceof HTMLCanvasElement?this._loadFromImage(G,I,J):(n.isArrayBuffer(I)||n.isUint8Array(I))&&this.params.encoding===D.DDS_ENCODING?(this.data=void 0,this._loadFromDDSData(G,I)):(n.isArrayBuffer(I)||n.isUint8Array(I))&&this.params.encoding===D.KTX2_ENCODING?(this.data=void 0,this._loadFromKTX2(G,I)):(n.isArrayBuffer(I)||
n.isUint8Array(I))&&this.params.encoding===D.BASIS_ENCODING?(this.data=void 0,this._loadFromBasis(G,I)):n.isUint8Array(I)?this._loadFromPixelData(G,I):n.isArrayBuffer(I)?this._loadFromPixelData(G,new Uint8Array(I)):null};F.frameUpdate=function(G,J,I){if(!(this.data instanceof HTMLVideoElement)||w.isNone(this._glTexture)||this.data.readyState<E.HAVE_CURRENT_DATA||I===this.data.currentTime)return I;if(w.isSome(this._powerOfTwoStretchInfo)){const {framebuffer:O,vao:P,sourceTexture:K}=this._powerOfTwoStretchInfo;
K.setData(this.data);this._drawStretchedTexture(G,J,O,P,K,this._glTexture)}else{const {width:O,height:P}=this.data,{width:K,height:M}=this._glTexture.descriptor;O!==K||P!==M?this._glTexture.updateData(0,0,0,Math.min(O,K),Math.min(P,M),this.data):this._glTexture.setData(this.data)}this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap();return this.data.currentTime};F._loadFromDDSData=function(G,J){return this._glTexture=m.createDDSTexture(G,this._createDescriptor(G),J)};F._loadFromKTX2=
function(G,J){return this._loadAsync(()=>y.createTextureKTX2(G,this._createDescriptor(G),J).then(I=>this._glTexture=I))};F._loadFromBasis=function(G,J){return this._loadAsync(()=>y.createTextureBasis(G,this._createDescriptor(G),J).then(I=>this._glTexture=I))};F._loadFromPixelData=function(G,J){t.assert(0<this.params.width&&0<this.params.height);const I=this._createDescriptor(G);I.pixelFormat=1===this.params.components?q.PixelFormat.LUMINANCE:3===this.params.components?q.PixelFormat.RGB:q.PixelFormat.RGBA;
I.width=this.params.width;I.height=this.params.height;return this._glTexture=new v.Texture(G,I,J)};F._loadFromURL=function(G,J,I){var O=this;return this._loadAsync(function(){var P=b._asyncToGenerator(function*(K){const M=yield e.requestImage(I,{signal:K});l.throwIfAborted(K);return O._loadFromImage(G,M,J)});return function(K){return P.apply(this,arguments)}}())};F._loadFromImageElement=function(G,J,I){var O=this;return I.complete?this._loadFromImage(G,I,J):this._loadAsync(function(){var P=b._asyncToGenerator(function*(K){const M=
yield k.loadImageAsync(I,I.src,!1,K);l.throwIfAborted(K);return O._loadFromImage(G,M,J)});return function(K){return P.apply(this,arguments)}}())};F._loadFromVideoElement=function(G,J,I){return I.readyState>=E.HAVE_CURRENT_DATA?this._loadFromImage(G,I,J):this._loadFromVideoElementAsync(G,J,I)};F._loadFromVideoElementAsync=function(G,J,I){return this._loadAsync(O=>new Promise((P,K)=>{const M=()=>{I.removeEventListener("loadeddata",U);I.removeEventListener("error",R);w.removeMaybe(L)},U=()=>{I.readyState>=
E.HAVE_CURRENT_DATA&&(M(),P(this._loadFromImage(G,I,J)))},R=N=>{M();K(N||new d("Failed to load video"))};I.addEventListener("loadeddata",U);I.addEventListener("error",R);const L=l.onAbort(O,()=>R(l.createAbortError()))}))};F._loadFromImage=function(G,J,I){const O=D._getDataDimensions(J);this.params.width=O.width;this.params.height=O.height;const P=this._createDescriptor(G);P.pixelFormat=3===this.params.components?q.PixelFormat.RGB:q.PixelFormat.RGBA;if(this._requiresPowerOfTwo(G,P)&&(!x.isPowerOfTwo(O.width)||
!x.isPowerOfTwo(O.height)))return this._glTexture=this._makePowerOfTwoTexture(G,J,O,P,I);P.width=O.width;P.height=O.height;return this._glTexture=new v.Texture(G,P,J)};F._loadAsync=function(G){const J=new AbortController;this._loadingController=J;const I=G(J.signal);this._loadingPromise=I;G=()=>{this._loadingController===J&&(this._loadingController=null);this._loadingPromise===I&&(this._loadingPromise=null)};I.then(G,G);return I};F._requiresPowerOfTwo=function(G,J){var I=q.TextureWrapMode.CLAMP_TO_EDGE;
I="number"===typeof J.wrapMode?J.wrapMode===I:J.wrapMode.s===I&&J.wrapMode.t===I;return!A(G.gl)&&(J.hasMipmap||!I)};F._makePowerOfTwoTexture=function(G,J,I,O,P){const {width:K,height:M}=I;I=x.nextHighestPowerOfTwo(K);const U=x.nextHighestPowerOfTwo(M);O.width=I;O.height=U;let R;switch(this.params.powerOfTwoResizeMode){case r.PowerOfTwoResizeMode.PAD:O.textureCoordinateScaleFactor=[K/I,M/U];R=new v.Texture(G,O);R.updateData(0,0,0,K,M,J);break;case r.PowerOfTwoResizeMode.STRETCH:case null:case void 0:R=
this._stretchToPowerOfTwo(G,J,O,P());break;default:c.neverReached(this.params.powerOfTwoResizeMode)}O.hasMipmap&&R.generateMipmap();return R};F._stretchToPowerOfTwo=function(G,J,I,O){const P=new v.Texture(G,I),K=new z.FramebufferObject(G,{colorTarget:q.TargetType.TEXTURE,depthStencilTarget:q.DepthStencilTargetType.NONE},P);J=new v.Texture(G,{target:q.TextureType.TEXTURE_2D,pixelFormat:I.pixelFormat,dataType:q.PixelType.UNSIGNED_BYTE,wrapMode:q.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:q.TextureSamplingMode.LINEAR,
flipped:!!I.flipped,maxAnisotropy:8,preMultiplyAlpha:I.preMultiplyAlpha},J);I=u.createQuadVAO(G);const M=G.getBoundFramebufferObject();this._drawStretchedTexture(G,O,K,I,J,P);this.requiresFrameUpdates?this._powerOfTwoStretchInfo={vao:I,sourceTexture:J,framebuffer:K}:(I.dispose(!0),J.dispose(),K.detachColorTexture(),K.dispose());G.bindFramebuffer(M);return P};F._drawStretchedTexture=function(G,J,I,O,P,K){G.bindFramebuffer(I);I=G.getViewport();G.setViewport(0,0,K.descriptor.width,K.descriptor.height);
J=G.useTechnique(J);J.setUniform4f("uColor",1,1,1,1);J.bindTexture(P,"tex");G.bindVAO(O);G.drawArrays(q.PrimitiveType.TRIANGLE_STRIP,0,B.vertexCount(O,"geometry"));G.bindFramebuffer(null);G.setViewport(I.x,I.y,I.width,I.height)};F.unload=function(){if(w.isSome(this._powerOfTwoStretchInfo)){const {framebuffer:G,vao:J,sourceTexture:I}=this._powerOfTwoStretchInfo;J.dispose(!0);I.dispose();G.dispose();this._powerOfTwoStretchInfo=this._glTexture=null}w.isSome(this._glTexture)&&(this._glTexture.dispose(),
this._glTexture=null);if(w.isSome(this._loadingController)){const G=this._loadingController;this._loadingPromise=this._loadingController=null;G.abort()}this.events.emit("unloaded")};b._createClass(D,[{key:"width",get:function(){return this.params.width}},{key:"height",get:function(){return this.params.height}},{key:"glTexture",get:function(){return this._glTexture}},{key:"requiresFrameUpdates",get:function(){return this.data instanceof HTMLVideoElement}}]);return D}(p.ContentObject);p.DDS_ENCODING=
"image/vnd-ms.dds";p.KTX2_ENCODING="image/ktx2";p.BASIS_ENCODING="image/x.basis";var E;(function(C){C[C.HAVE_NOTHING=0]="HAVE_NOTHING";C[C.HAVE_METADATA=1]="HAVE_METADATA";C[C.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA";C[C.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA";C[C.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"})(E||(E={}));a.Texture=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/BasisUtil":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../libs/basisu/BasisU ../../../../libs/basisu/TextureFormat ../../../webgl/enums ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(a,b,c,d,g,x,w,l){function n(){return f.apply(this,arguments)}function f(){f=b._asyncToGenerator(function*(){c.isNone(u)&&(u=d.getBasisTranscoder(),m=yield u);return u});return f.apply(this,arguments)}function e(t,q,z,v,B){q=l.getBytesPerElementFormat(q?x.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC:x.CompressedTextureFormat.COMPRESSED_RGB8_ETC2);return Math.ceil(z*v*q*(B&&1<t?(4**t-1)/(3*4**(t-1)):1))}function k(t){return 1<=t.getNumImages()&&!t.isUASTC()}function r(t){return 1<=t.getFaces()&&
t.isETC1S()}function y(){y=b._asyncToGenerator(function*(t,q,z){c.isNone(m)&&(m=yield n());const v=new m.BasisFile(new Uint8Array(z));if(!k(v))return null;v.startTranscoding();t=h(t,q,v.getNumLevels(0),v.getHasAlpha(),v.getImageWidth(0,0),v.getImageHeight(0,0),(B,A)=>v.getImageTranscodedSizeInBytes(0,B,A),(B,A,E)=>v.transcodeImage(E,0,B,A,0,0));v.close();v.delete();return t});return y.apply(this,arguments)}function p(){p=b._asyncToGenerator(function*(t,q,z){c.isNone(m)&&(m=yield n());const v=new m.KTX2File(new Uint8Array(z));
if(!r(v))return null;v.startTranscoding();t=h(t,q,v.getLevels(),v.getHasAlpha(),v.getWidth(),v.getHeight(),(B,A)=>v.getImageTranscodedSizeInBytes(B,0,0,A),(B,A,E)=>v.transcodeImage(E,B,0,0,A,0,-1,-1));v.close();v.delete();return t});return p.apply(this,arguments)}function h(t,q,z,v,B,A,E,C){const {compressedTextureETC:D,compressedTextureS3TC:F}=t.capabilities,[G,J]=D?v?[g.TextureFormat.ETC2_RGBA,x.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC]:[g.TextureFormat.ETC1_RGB,x.CompressedTextureFormat.COMPRESSED_RGB8_ETC2]:
F?v?[g.TextureFormat.BC3_RGBA,x.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[g.TextureFormat.BC1_RGB,x.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT]:[g.TextureFormat.RGBA32,x.PixelFormat.RGBA];v=q.hasMipmap?z:Math.min(1,z);z=[];for(let I=0;I<v;I++)z.push(new Uint8Array(E(I,G))),C(I,G,z[I]);E=1<z.length;return new w.Texture(t,{...q,samplingMode:E?x.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:x.TextureSamplingMode.LINEAR,hasMipmap:E,internalFormat:J,width:B,height:A},{type:"compressed",
levels:z})}let m=null,u=null;a.createTextureBasis=function(t,q,z){return y.apply(this,arguments)};a.createTextureKTX2=function(t,q,z){return p.apply(this,arguments)};a.estimateMemoryBasis=function(t,q){if(c.isNone(m))return t.byteLength;t=new m.BasisFile(new Uint8Array(t));q=k(t)?e(t.getNumLevels(0),t.getHasAlpha(),t.getImageWidth(0,0),t.getImageHeight(0,0),q):0;t.close();t.delete();return q};a.estimateMemoryKTX2=function(t,q){if(c.isNone(m))return t.byteLength;t=new m.KTX2File(new Uint8Array(t));
q=r(t)?e(t.getLevels(),t.getHasAlpha(),t.getWidth(),t.getHeight(),q):0;t.close();t.delete();return q};a.loadBasis=n;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/libs/basisu/BasisU":function(){define(["require","exports","../../assets","../../core/maybe"],function(a,b,c,d){let g;b.getBasisTranscoder=function(){if(d.isNone(g)){const x=w=>c.getAssetUrl(`esri/libs/basisu/${w}`);g=(new Promise((w,l)=>a(["../../chunks/basis_transcoder"],w,l))).then(w=>w.basis_transcoder).then(({default:w})=>
w({locateFile:x}).then(l=>{l.initializeBasis();delete l.then;return l}))}return g};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/libs/basisu/TextureFormat":function(){define(["exports"],function(a){a.TextureFormat=void 0;var b=a.TextureFormat||(a.TextureFormat={});b[b.ETC1_RGB=0]="ETC1_RGB";b[b.ETC2_RGBA=1]="ETC2_RGBA";b[b.BC1_RGB=2]="BC1_RGB";b[b.BC3_RGBA=3]="BC3_RGBA";b[b.BC4_R=4]="BC4_R";b[b.BC5_RG=5]="BC5_RG";b[b.BC7_M6_RGB=6]="BC7_M6_RGB";b[b.BC7_M5_RGBA=7]="BC7_M5_RGBA";b[b.PVRTC1_4_RGB=
8]="PVRTC1_4_RGB";b[b.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA";b[b.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA";b[b.ATC_RGB=11]="ATC_RGB";b[b.ATC_RGBA=12]="ATC_RGBA";b[b.FXT1_RGB=17]="FXT1_RGB";b[b.PVRTC2_4_RGB=18]="PVRTC2_4_RGB";b[b.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA";b[b.ETC2_EAC_R11=20]="ETC2_EAC_R11";b[b.ETC2_EAC_RG11=21]="ETC2_EAC_RG11";b[b.RGBA32=13]="RGBA32";b[b.RGB565=14]="RGB565";b[b.BGR565=15]="BGR565";b[b.RGBA4444=16]="RGBA4444";Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/DDSUtil":function(){define(["exports",
"../../../../core/Logger","../../../../core/mathUtils","../../../webgl/enums","../../../webgl/Texture"],function(a,b,c,d,g){function x(k){return k.charCodeAt(0)+(k.charCodeAt(1)<<8)+(k.charCodeAt(2)<<16)+(k.charCodeAt(3)<<24)}function w(k,r){var y=new Int32Array(k,0,31);if(542327876!==y[0])return l.error("Invalid magic number in DDS header"),null;if(!(y[20]&4))return l.error("Unsupported format, must contain a FourCC code"),null;var p=y[21];let h;switch(p){case n:p=8;h=d.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT;
break;case f:p=16;h=d.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case e:p=16;h=d.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return l.error("Unsupported FourCC code:",String.fromCharCode(p&255,p>>8&255,p>>16&255,p>>24&255)),null}let m=1,u=y[4],t=y[3];if(0!==(u&3)||0!==(t&3))l.warn("Rounding up compressed texture size to nearest multiple of 4."),u=u+3&-4,t=t+3&-4;const q=u,z=t;y[2]&131072&&!1!==r&&(m=Math.max(1,y[7]));1===m||c.isPowerOfTwo(u)&&c.isPowerOfTwo(t)||
(l.warn("Ignoring mipmaps of non power of two sized compressed texture."),m=1);let v=y[1]+4;const B=[];for(let A=0;A<m;++A)y=(u+3>>2)*(t+3>>2)*p,r=new Uint8Array(k,v,y),B.push(r),v+=y,u=Math.max(1,u>>1),t=Math.max(1,t>>1);return{textureData:{type:"compressed",levels:B},internalFormat:h,width:q,height:z}}const l=b.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),n=x("DXT1"),f=x("DXT3"),e=x("DXT5");a.createDDSTexture=function(k,r,y){const {textureData:p,internalFormat:h,width:m,height:u}=w(y,r.hasMipmap);
r.samplingMode=1<p.levels.length?d.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:d.TextureSamplingMode.LINEAR;r.hasMipmap=1<p.levels.length;r.internalFormat=h;r.width=m;r.height=u;return new g.Texture(k,r,p)};a.createDDSTextureData=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/Slice.glsl":function(){define("exports ../../../../../core/maybe ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../shaderModules/interfaces".split(" "),
function(a,b,c,d,g,x,w){function l(r,y,p,h){y.slicePlaneEnabled&&(b.isSome(p)?(g.copy(n,p.origin),g.copy(f,p.basis1),g.copy(e,p.basis2),b.isSome(h)&&b.isSome(h.origin)&&g.subtract(n,p.origin,h.origin),b.isSome(h)&&b.isSome(h.view)&&(y=b.isSome(h.origin)?c.translate(k,h.view,h.origin):h.view,g.add(f,f,n),g.add(e,e,n),g.transformMat4(n,n,y),g.transformMat4(f,f,y),g.transformMat4(e,e,y),g.subtract(f,f,n),g.subtract(e,e,n)),r.setUniform3fv("slicePlaneOrigin",n),r.setUniform3fv("slicePlaneBasis1",f),r.setUniform3fv("slicePlaneBasis2",
e)):(r.setUniform3fv("slicePlaneBasis1",x.ZEROS),r.setUniform3fv("slicePlaneBasis2",x.ZEROS),r.setUniform3fv("slicePlaneOrigin",x.ZEROS)))}const n=x.create(),f=x.create(),e=x.create(),k=d.create();a.Slice=function(r,y){if(y.slicePlaneEnabled){r.extensions.add("GL_OES_standard_derivatives");y.sliceEnabledForVertexPrograms&&(r.vertex.uniforms.add("slicePlaneOrigin","vec3"),r.vertex.uniforms.add("slicePlaneBasis1","vec3"),r.vertex.uniforms.add("slicePlaneBasis2","vec3"));r.fragment.uniforms.add("slicePlaneOrigin",
"vec3");r.fragment.uniforms.add("slicePlaneBasis1","vec3");r.fragment.uniforms.add("slicePlaneBasis2","vec3");var p=w.glsl`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,h=w.glsl`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`;h=y.sliceHighlightDisabled?w.glsl`#define highlightSlice(_color_, _pos_) (_color_)`:w.glsl`
        ${h}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `;y.sliceEnabledForVertexPrograms&&r.vertex.code.add(p);r.fragment.code.add(p);r.fragment.code.add(h)}else p=w.glsl`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`,y.sliceEnabledForVertexPrograms&&r.vertex.code.add(p),r.fragment.code.add(p)};a.bindSliceUniforms=l;a.bindSliceUniformsWithOrigin=function(r,y,p){l(r,y,p.slicePlane,{origin:p.origin})};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUDOcclusionPass.glsl":function(){define(["exports","../output/ReadLinearDepth.glsl","../shading/MultipassGeometryTest.glsl","../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],
function(a,b,c,d,g){a.HUDOcclusionPass=function(x,w){w.multipassGeometryEnabled&&x.vertex.include(c.multipassGeometryTest);w.multipassTerrainEnabled&&x.varyings.add("depth","float");x.vertex.code.add(g.glsl`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${w.multipassGeometryEnabled?g.glsl`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${w.multipassTerrainEnabled?"depth \x3d projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `);w.multipassTerrainEnabled&&x.fragment.include(b.ReadLinearDepth);x.fragment.uniforms.add("terrainDepthTexture","sampler2D");x.fragment.uniforms.add("nearFar","vec2");x.fragment.uniforms.add("inverseViewport","vec2");x.fragment.include(d.RgbaFloatEncoding);x.fragment.code.add(g.glsl`
  void main() {
    gl_FragColor = vec4(1, 1, 1, 1);
    ${w.multipassTerrainEnabled?g.glsl`

          vec2 uv = gl_FragCoord.xy * inverseViewport;

          //Read the rgba data from the texture linear depth
          vec4 terrainDepthData = texture2D(terrainDepthTexture, uv);

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);

          //If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          //Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            gl_FragColor.g = 0.5;
          }`:""}
  }
  `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MultipassGeometryTest.glsl":function(){define(["exports","../output/ReadLinearDepth.glsl","../../shaderModules/interfaces"],function(a,b,c){a.bindMultipassGeometryTexture=function(d,g){g.multipassGeometryEnabled&&g.geometryLinearDepthTexture&&d.bindTexture(g.geometryLinearDepthTexture,"geometryDepthTexture")};a.multipassGeometryTest=function(d){d.include(b.ReadLinearDepth);d.uniforms.add("geometryDepthTexture",
"sampler2D");d.uniforms.add("nearFar","vec2");d.code.add(c.glsl`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl":function(){define(["exports","../../../../../../chunks/vec4f64","../../shaderModules/interfaces"],function(a,b,c){const d=b.fromValues(1,1,0,1),g=b.fromValues(1,0,1,1);a.OutputHighlight=function(x){x.fragment.uniforms.add("depthTex","sampler2D");x.fragment.uniforms.add("highlightViewportPixelSz","vec4");x.fragment.constants.add("occludedHighlightFlag","vec4",d).add("unoccludedHighlightFlag",
"vec4",g);x.fragment.code.add(c.glsl`void outputHighlight() {
vec4 fragCoord = gl_FragCoord;
float sceneDepth = texture2D(depthTex, (fragCoord.xy - highlightViewportPixelSz.xy) * highlightViewportPixelSz.zw).r;
if (fragCoord.z > sceneDepth + 5e-7) {
gl_FragColor = occludedHighlightFlag;
}
else {
gl_FragColor = unoccludedHighlightFlag;
}
}`)};a.bindOutputHighlight=function(x,w){x.bindTexture(w.highlightDepthTexture,"depthTex");x.setUniform4f("highlightViewportPixelSz",0,0,w.inverseViewport[0],w.inverseViewport[1])};a.occludedHighlightFlag=d;a.unoccludedHighlightFlag=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl":function(){define(["exports","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,c){function d(g,x){x.vvSizeEnabled&&
(g.setUniform3fv("vvSizeMinSize",x.vvSizeMinSize),g.setUniform3fv("vvSizeMaxSize",x.vvSizeMaxSize),g.setUniform3fv("vvSizeOffset",x.vvSizeOffset),g.setUniform3fv("vvSizeFactor",x.vvSizeFactor));x.vvColorEnabled&&(g.setUniform1fv("vvColorValues",x.vvColorValues),g.setUniform4fv("vvColorColors",x.vvColorColors))}a.VisualVariables=function(g,x){x.vvInstancingEnabled&&(x.vvSize||x.vvColor)&&g.attributes.add(c.VertexAttribute.INSTANCEFEATUREATTRIBUTE,"vec4");x.vvSize?(g.vertex.uniforms.add("vvSizeMinSize",
"vec3"),g.vertex.uniforms.add("vvSizeMaxSize","vec3"),g.vertex.uniforms.add("vvSizeOffset","vec3"),g.vertex.uniforms.add("vvSizeFactor","vec3"),g.vertex.uniforms.add("vvSymbolRotationMatrix","mat3"),g.vertex.uniforms.add("vvSymbolAnchor","vec3"),g.vertex.code.add(b.glsl`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),g.vertex.code.add(b.glsl`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${x.vvInstancingEnabled?b.glsl`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):g.vertex.code.add(b.glsl`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`);x.vvColor?(g.vertex.constants.add("vvColorNumber","int",8),g.vertex.code.add(b.glsl`
      uniform float vvColorValues[vvColorNumber];
      uniform vec4 vvColorColors[vvColorNumber];

      vec4 vvGetColor(vec4 featureAttribute, float values[vvColorNumber], vec4 colors[vvColorNumber]) {
        float value = featureAttribute.y;
        if (value <= values[0]) {
          return colors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (values[i] >= value) {
            float f = (value - values[i-1]) / (values[i] - values[i-1]);
            return mix(colors[i-1], colors[i], f);
          }
        }
        return colors[vvColorNumber - 1];
      }

      ${x.vvInstancingEnabled?b.glsl`
      vec4 vvColor() {
        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);
      }`:""}
    `)):g.vertex.code.add(b.glsl`vec4 vvColor() { return vec4(1.0); }`)};a.bindVisualVariablesUniforms=d;a.bindVisualVariablesUniformsForSymbols=function(g,x){d(g,x);x.vvSizeEnabled&&(g.setUniform3fv("vvSymbolAnchor",x.vvSymbolAnchor),g.setUniformMatrix3fv("vvSymbolRotationMatrix",x.vvSymbolRotationMatrix))};a.bindVisualVariablesUniformsWithOpacity=function(g,x){d(g,x);x.vvOpacityEnabled&&(g.setUniform1fv("vvOpacityValues",x.vvOpacityValues),g.setUniform1fv("vvOpacityOpacities",x.vvOpacityOpacities))};
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl":function(){define(["exports","../../shaderModules/interfaces","../../../lib/basicInterfaces"],function(a,b,c){a.DiscardOrAdjustAlpha=function(d,g){const x=d.fragment;switch(g.alphaDiscardMode){case c.AlphaDiscardMode.Blend:x.code.add(b.glsl`
        #define discardOrAdjustAlpha(color) { if (color.a < ${b.glsl.float(.001)}) { discard; } }
      `);break;case c.AlphaDiscardMode.Opaque:x.code.add(b.glsl`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case c.AlphaDiscardMode.Mask:x.uniforms.add("textureAlphaCutoff","float");x.code.add(b.glsl`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case c.AlphaDiscardMode.MaskBlend:d.fragment.uniforms.add("textureAlphaCutoff","float"),d.fragment.code.add(b.glsl`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}};a.defaultMaskAlphaCutoff=.1;a.symbolAlphaCutoff=.001;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/HUDMaterialTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/attributes/VerticalOffset.glsl ../core/shaderLibrary/hud/HUD.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/MultipassGeometryTest.glsl ../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../core/shaderLibrary/shading/VisualVariables.glsl ../core/shaderLibrary/util/ScreenSizePerspective.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../../../../chunks/HUDMaterial.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A){h=function(D){function F(){return D.apply(this,arguments)||this}c._inheritsLoose(F,D);var G=F.prototype;G.initializeProgram=function(J){var I=F.shader.get();const O=this.configuration;I=I.build({output:O.output,frontFacePass:O.transparencyPassType===u.TransparencyPassType.FrontFace,viewingMode:J.viewingMode,occlusionTestEnabled:O.occlusionTestEnabled,signedDistanceFieldEnabled:O.sdf,slicePlaneEnabled:O.slicePlaneEnabled,sliceHighlightDisabled:!1,
sliceEnabledForVertexPrograms:!0,debugDrawLabelBorder:O.debugDrawLabelBorder,binaryHighlightOcclusionEnabled:O.binaryHighlightOcclusion,screenCenterOffsetUnitsEnabled:O.screenCenterOffsetUnitsEnabled,screenSizePerspectiveEnabled:O.screenSizePerspective,verticalOffsetEnabled:O.verticalOffset,pixelSnappingEnabled:O.pixelSnappingEnabled,vvSize:O.vvSize,vvColor:O.vvColor,vvInstancingEnabled:!1,isDraped:O.isDraped,multipassGeometryEnabled:O.multipassGeometryEnabled,multipassTerrainEnabled:O.multipassTerrainEnabled,
cullAboveGround:O.cullAboveGround});return new z.Program(J.rctx,I,t.Default3D)};G.bindPass=function(J,I){y.bindProjectionMatrix(this.program,I.camera.projectionMatrix);this.program.setUniform1f("cameraGroundRelative",I.camera.aboveGround?1:-1);this.program.setUniform1f("perDistancePixelRatio",Math.tan(I.camera.fovY/2)/(I.camera.fullViewport[2]/2));this.program.setUniformMatrix4fv("viewNormal",I.camera.viewInverseTransposeMatrix);this.program.setUniform1f("polygonOffset",J.shaderPolygonOffset);w.bindVerticalOffsetUniforms(this.program,
J,I);r.bindScreenSizePerspectiveUniforms(this.program,J);this.program.setUniform1f("pixelRatio",I.camera.pixelRatio||1);y.bindViewport(this.program,I);this.configuration.output===g.ShaderOutput.Occlusion?(this.program.setUniform2fv("nearFar",I.camera.nearFar),this.program.setUniform2fv("inverseViewport",I.inverseViewport),f.bindMultipassGeometryTexture(this.program,I),e.bindMultipassTerrainTexture(this.program,I)):(l.bindHUDUniforms(this.program,I),v.bindHUDMaterialUniforms(this.program,J,I.camera.pixelRatio||
1),k.bindVisualVariablesUniforms(this.program,J),this.configuration.occlusionTestEnabled&&this.program.bindTexture(I.hudVisibilityTexture,"hudVisibilityTexture"));this.configuration.output===g.ShaderOutput.Highlight&&n.bindOutputHighlight(this.program,I)};G.bindDraw=function(J){y.bindView(this.program,J);y.bindCameraPosition(this.program,J.origin,J.camera.viewInverseTransposeMatrix);x.bindSliceUniformsWithOrigin(this.program,this.configuration,J);this.program.rebindTextures()};G._setPipelineState=
function(J){const I=this.configuration,O=J===u.TransparencyPassType.NONE;var P=J===u.TransparencyPassType.FrontFace;const K=B.CompareFunction.LEQUAL,M=this.configuration.polygonOffsetEnabled&&E;P=(O||P)&&I.output!==g.ShaderOutput.Highlight?(I.depthEnabled||I.output===g.ShaderOutput.Occlusion)&&A.defaultDepthWriteParams:null;return A.makePipelineState({blending:I.output===g.ShaderOutput.Color||I.output===g.ShaderOutput.Alpha||I.output===g.ShaderOutput.Highlight?O?C:q.oitBlending(J):null,depthTest:{func:K},
depthWrite:P,colorWrite:A.defaultColorWriteParams,polygonOffset:M})};G.initializePipeline=function(){return this._setPipelineState(this.configuration.transparencyPassType)};c._createClass(F,[{key:"primitiveType",get:function(){return this.configuration.output===g.ShaderOutput.Occlusion?B.PrimitiveType.POINTS:B.PrimitiveType.TRIANGLES}}]);return F}(h.ShaderTechnique);h.shader=new p.ReloadableShaderModule(v.HUDMaterialShader,()=>new Promise((D,F)=>a(["./HUDMaterial.glsl"],D,F)));const E={factor:0,units:-4},
C=A.simpleBlendingParams(B.BlendFactor.ONE,B.BlendFactor.ONE_MINUS_SRC_ALPHA);p=function(D){function F(){var G=D.apply(this,arguments)||this;G.output=g.ShaderOutput.Color;G.occlusionTestEnabled=!0;G.sdf=!1;G.vvSize=!1;G.vvColor=!1;G.verticalOffset=!1;G.screenSizePerspective=!1;G.screenCenterOffsetUnitsEnabled=l.HUDSpace.World;G.debugDrawLabelBorder=!1;G.binaryHighlightOcclusion=!0;G.slicePlaneEnabled=!1;G.polygonOffsetEnabled=!1;G.depthEnabled=!0;G.transparencyPassType=u.TransparencyPassType.NONE;
G.pixelSnappingEnabled=!0;G.isDraped=!1;G.multipassGeometryEnabled=!1;G.multipassTerrainEnabled=!1;G.cullAboveGround=!1;return G}c._inheritsLoose(F,D);return F}(m.ShaderTechniqueConfiguration);d.__decorate([m.parameter({count:g.ShaderOutput.COUNT})],p.prototype,"output",void 0);d.__decorate([m.parameter()],p.prototype,"occlusionTestEnabled",void 0);d.__decorate([m.parameter()],p.prototype,"sdf",void 0);d.__decorate([m.parameter()],p.prototype,"vvSize",void 0);d.__decorate([m.parameter()],p.prototype,
"vvColor",void 0);d.__decorate([m.parameter()],p.prototype,"verticalOffset",void 0);d.__decorate([m.parameter()],p.prototype,"screenSizePerspective",void 0);d.__decorate([m.parameter({count:l.HUDSpace.COUNT})],p.prototype,"screenCenterOffsetUnitsEnabled",void 0);d.__decorate([m.parameter()],p.prototype,"debugDrawLabelBorder",void 0);d.__decorate([m.parameter()],p.prototype,"binaryHighlightOcclusion",void 0);d.__decorate([m.parameter()],p.prototype,"slicePlaneEnabled",void 0);d.__decorate([m.parameter()],
p.prototype,"polygonOffsetEnabled",void 0);d.__decorate([m.parameter()],p.prototype,"depthEnabled",void 0);d.__decorate([m.parameter({count:u.TransparencyPassType.COUNT})],p.prototype,"transparencyPassType",void 0);d.__decorate([m.parameter()],p.prototype,"pixelSnappingEnabled",void 0);d.__decorate([m.parameter()],p.prototype,"isDraped",void 0);d.__decorate([m.parameter()],p.prototype,"multipassGeometryEnabled",void 0);d.__decorate([m.parameter()],p.prototype,"multipassTerrainEnabled",void 0);d.__decorate([m.parameter()],
p.prototype,"cullAboveGround",void 0);b.HUDMaterialTechnique=h;b.HUDMaterialTechniqueConfiguration=p;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl":function(){define(["exports","../../../../../ViewingMode","../util/ScreenSizePerspective.glsl","../../shaderModules/interfaces"],function(a,b,c,d){function g(w,l,n,f=x){f.screenLength=w.screenLength;f.perDistance=Math.tan(.5*l)/(.5*n);f.minWorldLength=w.minWorldLength;
f.maxWorldLength=w.maxWorldLength;return f}const x={screenLength:0,perDistance:0,minWorldLength:0,maxWorldLength:0};a.VerticalOffset=function(w,l){const n=w.vertex.code;l.verticalOffsetEnabled?(w.vertex.uniforms.add("verticalOffset","vec4"),l.screenSizePerspectiveEnabled&&(w.include(c.ScreenSizePerspective),w.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4")),n.add(d.glsl`
    vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
      float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
      ${l.viewingMode===b.ViewingMode.Global?d.glsl`vec3 worldNormal = normalize(worldPos + localOrigin);`:d.glsl`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
      ${l.screenSizePerspectiveEnabled?d.glsl`
          float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
          float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:d.glsl`
          float verticalOffsetScreenHeight = verticalOffset.x;`}
      // Screen sized offset in world space, used for example for line callouts
      float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
      return worldNormal * worldOffset;
    }

    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
      return worldPos + calculateVerticalOffset(worldPos, localOrigin);
    }
    `)):n.add(d.glsl`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)};a.bindVerticalOffsetUniforms=function(w,l,n){l.verticalOffset&&(l=g(l.verticalOffset,n.camera.fovY,n.camera.fullViewport[3]),w.setUniform4f("verticalOffset",l.screenLength*(n.camera.pixelRatio||1),l.perDistance,l.minWorldLength,l.maxWorldLength))};a.calculateVerticalOffsetFactors=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl":function(){define(["exports",
"../../shaderModules/interfaces"],function(a,b){a.bindMultipassTerrainTexture=function(c,d){d.multipassTerrainEnabled&&d.terrainLinearDepthTexture&&c.bindTexture(d.terrainLinearDepthTexture,"terrainDepthTexture")};a.multipassTerrainTest=function(c,d){c.fragment.uniforms.add("terrainDepthTexture","sampler2D");c.fragment.uniforms.add("nearFar","vec2");c.fragment.uniforms.add("inverseViewport","vec2");c.fragment.code.add(b.glsl`
    // Compare the linearized depths of fragment and terrain. Discard fragments on the wrong side of the terrain.
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){

      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, nearFar);
      if(fragmentDepth ${d.cullAboveGround?"\x3e":"\x3c\x3d"} terrainDepth){
        discard;
      }
    }
  `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/OrderIndependentTransparency":function(){define(["exports","./basicInterfaces","../../../webgl/enums","../../../webgl/renderState"],function(a,b,c,d){const g=d.separateBlendingParams(c.BlendFactor.SRC_ALPHA,c.BlendFactor.ONE,c.BlendFactor.ONE_MINUS_SRC_ALPHA,c.BlendFactor.ONE_MINUS_SRC_ALPHA),x=d.simpleBlendingParams(c.BlendFactor.ONE,c.BlendFactor.ONE),w=d.simpleBlendingParams(c.BlendFactor.ZERO,c.BlendFactor.ONE_MINUS_SRC_ALPHA),
l={factor:-1,units:-2};a.OITPolygonOffset=l;a.OITPolygonOffsetLimit=5E5;a.blendingAlpha=w;a.blendingColor=x;a.blendingDefault=g;a.getOITPolygonOffset=function(n){return n?l:null};a.oitBlending=function(n){return n===b.TransparencyPassType.FrontFace?null:n===b.TransparencyPassType.Alpha?w:x};a.oitDepthTest=function(n,f=c.CompareFunction.LESS){return n===b.TransparencyPassType.NONE||n===b.TransparencyPassType.FrontFace?f:c.CompareFunction.LEQUAL};a.oitDepthWrite=function(n){return n===b.TransparencyPassType.FrontFace?
d.defaultDepthWriteParams:null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/LabelDeconflictor":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ./Deconflictor ./enums ../../../support/Scheduler".split(" "),function(a,
b,c,d,g,x,w,l,n,f,e){a.LabelDeconflictor=function(k){function r(){var p=k.apply(this,arguments)||this;p.visibilityGroup=f.VisibilityGroup.LABEL;p.iconMarginFactor=0;p._lastDeconfliction=0;return p}b._inheritsLoose(r,k);var y=r.prototype;y.runTask=function(p){if(!this.parent.running){var h=performance.now();if(p.state===e.State.IDLE||2E3<h-this._lastDeconfliction)k.prototype.runTask.call(this,p),this.state===n.State.Idle&&(this._lastDeconfliction=h)}};y.enabledChanged=function(p,h){this.modifyGraphics(h,
p.labelsEnabled)};y.getGraphicsLayers=function(p){return p.labelGraphics};b._createClass(r,[{key:"viewState",get:function(){return this.parent.viewState}}]);return r}(n.Deconflictor);c.__decorate([d.property({constructOnly:!0})],a.LabelDeconflictor.prototype,"parent",void 0);a.LabelDeconflictor=c.__decorate([l.subclass("esri.views.3d.layers.graphics.LabelDeconflictor")],a.LabelDeconflictor);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Labeler":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/asyncUtils ../../../../core/Handles ../../../../core/Logger ../../../../core/MapUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../layers/graphics/hydratedFeatures ../../../../layers/support/labelFormatUtils ../../../../layers/support/layerUtils ../../../../symbols/callouts/calloutUtils ./enums ./Graphics3DCalloutSymbolLayerFactory ./Graphics3DGraphicCreationContext ./graphicSymbolUtils ./labelPlacement ./placementUtils ../../support/debugFlags ../../webgl-engine/lib/MaterialCollection ../../webgl-engine/lib/TextRenderer ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTextureAtlas ../../webgl-engine/lib/WebGLLayer ../../../support/Scheduler".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E,C,D,F,G,J,I,O){const P=w.getLogger("esri.views.3d.layers.graphics.Labeler");a.Labeler=function(M){function U(){var L=M.apply(this,arguments)||this;L._dirty=!1;L._labels=new Map;L._labelsToAdd=new Map;L._labelsToRemove=new Map;L._labelingContexts=[];return L}b._inheritsLoose(U,M);var R=U.prototype;R.setup=function(){this.dispose();this._handles=new x;this._handles.add([this.view.watch("state.camera",()=>this.setDirty()),this.view.watch("pixelRatio",
()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(O.TaskPriority.LABELER,this)]);this._textTextureAtlas=new J.default({view:this.view});this._hudMaterialCollection=new D.MaterialCollection(this.view._stage);this._calloutMaterialCollection=new D.MaterialCollection(this.view._stage)};R.dispose=function(){this._handles=n.destroyMaybe(this._handles);this._textTextureAtlas=n.disposeMaybe(this._textTextureAtlas);this._hudMaterialCollection=n.disposeMaybe(this._hudMaterialCollection);
this._calloutMaterialCollection=n.disposeMaybe(this._calloutMaterialCollection);this._labelingContexts.length=0;this._labels.clear();this._labelsToAdd.clear();this._labelsToRemove.clear()};R._activateLabelingContext=function(L){L.labels.forEach((N,T)=>{this._labels.set(T,N);N.graphics3DGraphic.setVisibilityFlag(q.VisibilityFlag.USER_SETTING,!0,q.VisibilityGroup.LABEL)});L.active=!0};R._deactivateLabelingContext=function(L){L.labels.forEach((N,T)=>{N.graphics3DGraphic.setVisibilityFlag(q.VisibilityFlag.USER_SETTING,
!1,q.VisibilityGroup.LABEL);this.setLabelGraphicVisibility(N.graphics3DGraphic,!1);this._labels.delete(T)});L.active=!1};R._addLabelTextureToAtlas=function(L){for(const N of L.graphics3DGraphic.labelGraphics){if(!N._labelClass)continue;const T=L.textTextureResources.textRenderers[N._labelIndex];n.isSome(T)&&this._textTextureAtlas.addTextTexture(T,N.stageObject)}L.rendered=!0};R._removeLabelTextureFromAtlas=function(L){for(const N of L.graphics3DGraphic.labelGraphics){if(!N._labelClass)continue;const T=
L.textTextureResources.textRenderers[N._labelIndex];n.isSome(T)&&this._textTextureAtlas.removeTextTexture(T,N.stageObject)}L.rendered=!1};R.runTask=function(L){this._updateLabels(L);!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(L)};R._updateLabels=function(L){if(this._dirty){this._dirty=!1;for(const N of this._labelingContexts)if(N.active&&u.areLabelsVisible(N.layer)){if(!N.labelClassContexts||!N.labelClassContexts.length){if(null===N.labelClassContexts){this._deactivateLabelingContext(N);
continue}this._createLabelClassContext(N);if(N.labelClassPromise&&N.labelClassAbortController){this._dirty=!0;continue}if(!N.labelClassContexts||!N.labelClassContexts.length)continue}l.someMap(N.labelsToInitialize,(T,S)=>{this._ensureGraphics3DResources(T)&&(this._labels.set(S,T),this.deconflictor.setDirty(),L.madeProgress());if(T.visible&&T.textTextureResources.initialized||!T.visible&&T.hasGraphics3DResources)N.labelsToInitialize.delete(S),L.madeProgress();return L.done})&&(this._dirty=!0)}this._labelsToRemove.forEach(N=>
this._removeLabelTextureFromAtlas(N));this._labelsToAdd.forEach(N=>this._addLabelTextureToAtlas(N));this._labelsToRemove.clear();this._labelsToAdd.clear();this._dirty||this.notifyChange("updating")}};R._createLabelClassContextAsync=function(){var L=b._asyncToGenerator(function*(N){var T=this;const S=N.labelClassAbortController.signal;yield N.layer.when();f.throwIfAborted(S);N.scaleVisibility&&N.scaleVisibility.updateScaleRangeActive();const H=N.graphics3DCore;var Q=H.layer;if((Q=Q.labelingInfo&&Q.labelingInfo.filter(Y=>
!!Y.symbol))&&0!==Q.length){var W=Array(Q.length),V=!1;yield g.forEach(Q,function(){var Y=b._asyncToGenerator(function*(aa,X){var ba=aa.symbol;const ha=B.getGraphics3DSymbol(H.getOrCreateGraphics3DSymbol(ba));if(n.isNone(ha))P.error("Failed to create Graphics3DSymbol for label");else{yield ha.load();f.throwIfAborted(S);var ka=null;t.hasCalloutSupport(ba)&&ba.hasVisibleCallout()&&(ka=z.make(ba,H.symbolCreationContext),yield ka.load(),f.throwIfAborted(S));ba=yield g.result(m.createLabelFunction(aa,
N.layer.fieldsIndex,T.view.spatialReference));f.throwIfAborted(S);if(!0===ba.ok){const ia=yield T._createTextRenderParameters(ha.symbol);f.throwIfAborted(S);W[X]={labelClass:aa,labelFunction:ba.value,graphics3DSymbol:ha,graphics3DCalloutSymbolLayer:ka,calloutSymbolLayerIndex:0,textRenderParameters:ia}}else P.error(`Label expression failed to evaluate: ${ba.error}`),V=!0}});return function(aa,X){return Y.apply(this,arguments)}}());f.throwIfAborted(S);V||(N.labelClassContexts=W)}});return function(N){return L.apply(this,
arguments)}}();R._createLabelClassContext=function(){var L=b._asyncToGenerator(function*(N){N.labelClassPromise||(N.labelClassPromise=this._createLabelClassContextAsync(N).catch(T=>{if(f.isAbortError(T))throw T;N.labelClassContexts=null}).then(()=>{N.labelClassAbortController=null;this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating"));return N.labelClassPromise});return function(N){return L.apply(this,arguments)}}();R._createTextRenderParameters=function(){var L=b._asyncToGenerator(function*(N){return(N=
N.symbolLayers.getItemAt(0))&&"text"===N.type?G.TextRenderParameters.fromSymbol(N,this.view.pixelRatio):null});return function(N){return L.apply(this,arguments)}}();R._destroyLabelClassContext=function(L){for(var N of L.labelClassContexts)--N.graphics3DSymbol.referenced,N.graphics3DSymbol=null;N=L.labelClassAbortController;L.labelClassAbortController=new AbortController;N&&N.abort();L.labelClassContexts=[];L.labelClassPromise=null;this.notifyChange("updating")};R._createTextSymbolGraphic=function(L,
N,T,S,H){L={text:L.text,centerOffset:T.centerOffset,translation:T.translation,elevationOffset:T.elevationOffset,screenOffset:T.screenOffset,centerOffsetUnits:T.centerOffsetUnits,horizontalPlacement:E.horizontalPlacementFromAnchor(T.anchor),verticalPlacement:E.verticalPlacementFromAnchor(T.anchor),verticalOffset:T.verticalOffset,debugDrawLabelBorder:C.LABELS_SHOW_BORDER,displayWidth:L.displayWidth,displayHeight:L.displayHeight};K.graphic=N;K.renderingInfo=null;K.layer=S;return H.createLabel(K,L,this._hudMaterialCollection,
this._textTextureAtlas)};R._createLineCalloutGraphic=function(L,N,T,S,H){N={symbol:N,translation:S.translation,elevationOffset:S.elevationOffset,screenOffset:S.screenOffset,centerOffset:S.centerOffset,centerOffsetUnits:S.centerOffsetUnits,materialCollection:this._calloutMaterialCollection};K.graphic=L;K.renderingInfo=N;K.layer=H;return T.createGraphics3DGraphic(K)};R._ensureGraphics3DResources=function(L){if(L.hasGraphics3DResources)return!1;const N=L.graphics3DGraphic;if(N.destroyed)return!1;this._ensureTextTextureResources(L);
const {textTextureResources:T}=L,S=L.labelingContext,H=S.labelClassContexts;if(!H||0===H.length||!S.emptySymbolLabelSupported&&0===N.graphics.length)return!1;var Q=!1,W=N.graphic;const V=S.layer;var Y=u.areLabelsVisible(S.layer);const aa=this.view._stage;for(let ba=0;ba<H.length;ba++){const ha=T.textRenderers[ba],ka=T.labelPlacements[ba];if(n.isNone(ha)||n.isNone(ka))continue;const ia=H[ba];var X=ia.graphics3DSymbol;const ea=X.symbol&&"label-3d"===X.symbol.type?X.symbol:null;if(X=X.symbolLayers[0]){X.setElevationInfoOverride(S.elevationInfoOverride);
Q=this._createTextSymbolGraphic(ha,W,ka,V,X);if(!Q)return!1;Q._labelClass=ia.labelClass;Q._labelIndex=ba;N.addLabelGraphic(Q,aa,S.stageLayer);N.setVisibilityFlag(q.VisibilityFlag.USER_SETTING,Y,q.VisibilityGroup.LABEL);N.clearVisibilityFlag(q.VisibilityFlag.SCALE_RANGE,q.VisibilityGroup.LABEL);N.setVisibilityFlag(q.VisibilityFlag.DECONFLICTION,!1,q.VisibilityGroup.LABEL);Q=!0;(Y=ia.graphics3DCalloutSymbolLayer)&&ka.hasLabelVerticalOffset&&(Y.setElevationInfoOverride(S.elevationInfoOverride),W=this._createLineCalloutGraphic(W,
ea,Y,ka,V),n.isSome(W)&&(ia.calloutSymbolLayerIndex=N.labelGraphics.length,N.addLabelGraphic(W,aa,S.stageLayer)));break}}S.scaleVisibility&&Q&&S.scaleVisibility.updateGraphicLabelScaleVisibility(N);return L.hasGraphics3DResources=!0};R._destroyGraphics3DResources=function(L){const N=L.labelingContext.labelClassContexts;for(const T of L.graphics3DGraphic.labelGraphics){if(null==T._labelClass)continue;const S=N[T._labelIndex].graphics3DSymbol.symbolLayers[0];if(null!=S)S.onRemoveGraphic(T)}L.graphics3DGraphic.clearLabelGraphics();
L.hasGraphics3DResources=!1};R._ensureTextTextureResources=function(L){const {textTextureResources:N}=L;if(!N.initialized){var T=L.labelingContext,S=T.labelClassContexts;if(S&&0!==S.length){var H=L.graphics3DGraphic.graphic;for(let V=0;V<S.length;V++){const Y=S[V];N.textRenderers[V]=null;N.labelPlacements[V]=null;if(!Y.textRenderParameters)continue;var Q=Y.labelFunction;let aa;if("arcade"===Q.type)try{const X=Q.needsHydrationToEvaluate()?h.hydrateGraphic(H,T.layer):H;aa=Q.evaluate(X)}catch(X){aa=
null}else aa=Q.evaluate(H);if(!n.isNone(aa)&&""!==aa&&!/^\s+$/.test(aa)&&(Q=Y.graphics3DSymbol,Q.symbolLayers[0]&&(Q=A.get({graphics3DGraphic:L.graphics3DGraphic,labelSymbol:Q.symbol&&"label-3d"===Q.symbol.type?Q.symbol:null,labelClass:Y.labelClass,disablePlacement:T.disablePlacement}),!n.isNone(Q)))){var W=E.horizontalPlacementFromAnchor(Q.anchor);W=E.textRenderAlignmentFromHorizontalPlacement(W);N.textRenderers[V]=new F.TextRenderer(aa,W,Y.textRenderParameters);N.labelPlacements[V]=Q}}N.initialized=
!0}}};R._destroyTextTextureResources=function(L){({textTextureResources:L}=L);L.initialized=!1;L.textRenderers=[];L.labelPlacements=[]};R._addGraphic=function(L,N){const T={hasGraphics3DResources:!1,visible:!1,rendered:!1,labelingContext:L,graphics3DGraphic:N,textTextureResources:{initialized:!1,textRenderers:[],labelPlacements:[]}};N=N.graphic.uid;L.labels.set(N,T);L.labelsToInitialize.set(N,T);this.setDirty();this.deconflictor.setDirty()};R._removeGraphic=function(L,N){N=N.graphic.uid;const T=L.labels.get(N);
T&&(this._destroyGraphic(T,N),L.labels.delete(N),L.labelsToInitialize.delete(N),this.setDirty(),this.deconflictor.setDirty())};R._destroyGraphic=function(L,N){this._labels.has(N)&&(this._labels.delete(N),this._labelsToAdd.delete(N),this._labelsToRemove.delete(N));L.textTextureResources.initialized&&(this._removeLabelTextureFromAtlas(L),this._destroyTextTextureResources(L));L.hasGraphics3DResources&&this._destroyGraphics3DResources(L)};R._labelingInfoChange=function(){var L=b._asyncToGenerator(function*(N,
T){if(T)for(const S of T){if(T=N.labels.get(S))this._removeGraphic(N,T.graphics3DGraphic),this._addGraphic(N,T.graphics3DGraphic)}else return this._visibilityInfoChange(N),this._resetLabels(N),this._createLabelClassContext(N)});return function(N,T){return L.apply(this,arguments)}}();R._globalPropertyChanged=function(L,N){for(const T of N.labelClassContexts){const S=new Map;N.labels.forEach(H=>{H=H.graphics3DGraphic;S.set(H.graphic.uid,H)});n.unwrap(T.graphics3DSymbol.symbolLayers[0]).globalPropertyChanged(L,
S,H=>H.labelGraphics[0]);T.graphics3DCalloutSymbolLayer&&T.graphics3DCalloutSymbolLayer.globalPropertyChanged(L,S,H=>H.labelGraphics[T.calloutSymbolLayerIndex])}};R._visibilityInfoChange=function(L){const N=L.layer.labelsVisible;N&&!L.active&&this._activateLabelingContext(L);!N&&L.active&&this._deactivateLabelingContext(L);this.setDirty()};R._resetAllLabels=function(){for(const L of this._labelingContexts)this._resetLabels(L)};R._resetLabels=function(L){L.labels.forEach((N,T)=>{this._destroyGraphic(N,
T);N.visible=!1;N.rendered=!1;L.labelsToInitialize.set(T,N)});this._destroyLabelClassContext(L);this.setDirty();this.deconflictor.setDirty()};R._findLabelingContext=function(L){for(const N of this._labelingContexts)if(N.graphics3DCore===L)return N;return null};R.addGraphicsOwner=function(L,N,T){const S=T&&T.emptySymbolLabelSupported||!1,H=T&&T.elevationInfoOverride||null;T=T&&T.disablePlacement||null;if(!this._findLabelingContext(L)){var Q=L.layer,W={graphics3DCore:L,layer:Q,scaleVisibility:N,emptySymbolLabelSupported:S,
elevationInfoOverride:H,disablePlacement:T,active:Q.labelsVisible,labelClassPromise:null,labelClassAbortController:new AbortController,labelClassContexts:[],labels:new Map,labelsToInitialize:new Map,stageLayer:new I.WebGLLayer({isPickable:!0},Q.uid)};this.view._stage.add(W.stageLayer);this._labelingContexts.push(W);this.setDirty();return{addGraphic:V=>this._addGraphic(W,V),removeGraphic:V=>this._removeGraphic(W,V),featureReductionChange:()=>{},layerLabelsEnabled:()=>u.areLabelsVisible(W.layer),labelingInfoChange:V=>
this._labelingInfoChange(W,V),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",W),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",W),visibilityInfoChange:()=>this._visibilityInfoChange(W),reset:()=>this._resetLabels(W),clear:()=>{}}}};R.removeGraphicsOwner=function(L){const N=this._findLabelingContext(L);N&&(L=this._labelingContexts.indexOf(N),this._labelingContexts.splice(L,1),N.labels.forEach(T=>this._removeGraphic(N,T.graphics3DGraphic)),this.view._stage.remove(N.stageLayer),
N.stageLayer=null,this.setDirty())};R.setLabelGraphicVisibility=function(L,N){L=L.graphic.uid;const T=this._labels.get(L);T&&T.visible!==N&&(N&&!T.rendered?(this._labelsToAdd.set(L,T),this._labelsToRemove.delete(L),T.textTextureResources.initialized||T.labelingContext.labelsToInitialize.set(L,T)):!N&&T.rendered&&(this._labelsToRemove.set(L,T),this._labelsToAdd.delete(L)),T.visible=N,this.setDirty())};R.setDirty=function(){!this._dirty&&0<this._labelingContexts.length&&(this._dirty=!0,this.notifyChange("updating"))};
b._createClass(U,[{key:"running",get:function(){var L;return this.view.ready&&(this._dirty||(null==(L=this._textTextureAtlas)?void 0:L.updating)||this.deconflictor.running)}},{key:"updating",get:function(){var L;return this._dirty||(null==(L=this._textTextureAtlas)?void 0:L.updating)||this.deconflictor.updating||this._labelingContexts.some(N=>N.labelClassPromise&&!!N.labelClassAbortController)}},{key:"updatingProgress",get:function(){if(!this.updating||!this._textTextureAtlas)return 1;const L=0<this._labelingContexts.length?
this._labelingContexts.reduce((N,T)=>N+(T.labelClassPromise&&T.labelClassAbortController?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*L+.5*this.deconflictor.updatingProgress}},{key:"test",get:function(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}}]);return U}(d);c.__decorate([e.property({constructOnly:!0})],a.Labeler.prototype,"view",void 0);c.__decorate([e.property({constructOnly:!0})],a.Labeler.prototype,
"deconflictor",void 0);c.__decorate([e.property()],a.Labeler.prototype,"_textTextureAtlas",void 0);c.__decorate([e.property({type:Boolean,readOnly:!0})],a.Labeler.prototype,"updating",null);a.Labeler=c.__decorate([p.subclass("esri.views.3d.layers.graphics.Labeler")],a.Labeler);const K=new v(null,null,null);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/graphics/hydratedFeatures":function(){define("exports ../../Graphic ../../core/has ../../core/lang ../../core/maybe ../../core/typedArrayUtil ../../geometry/support/jsonUtils ./dehydratedFeatures".split(" "),
function(a,b,c,d,g,x,w,l){function n(u){return"declaredClass"in u}function f(u){return"declaredClass"in u}function e(u){return"declaredClass"in u}function k(u){return g.isNone(u)?null:n(u)?u:w.fromJSON(r(u))}function r(u){const t=u.spatialReference.toJSON();switch(u.type){case "point":{const {x:q,y:z,z:v,m:B}=u;return{x:q,y:z,z:v,m:B,spatialReference:t}}case "polygon":{const {rings:q,hasZ:z,hasM:v}=u;return{rings:y(q),hasZ:z,hasM:v,spatialReference:t}}case "polyline":{const {paths:q,hasZ:z,hasM:v}=
u;return{paths:y(q),hasZ:z,hasM:v,spatialReference:t}}case "extent":{const {xmin:q,xmax:z,ymin:v,ymax:B,zmin:A,zmax:E,mmin:C,mmax:D,hasZ:F,hasM:G}=u;return{xmin:q,xmax:z,ymin:v,ymax:B,zmin:A,zmax:E,mmin:C,mmax:D,hasZ:F,hasM:G,spatialReference:t}}case "multipoint":{const {points:q,hasZ:z,hasM:v}=u;return{points:m(q)?p(q):q,hasZ:z,hasM:v,spatialReference:t}}}}function y(u){return h(u)?u.map(t=>p(t)):u}function p(u){return u.map(t=>x.toArray(t))}function h(u){for(const t of u)if(0!==t.length)return m(t);
return!1}function m(u){return u.length&&(x.isFloat32Array(u[0])||x.isFloat64Array(u[0]))}a.clonePoint=function(u,t){if(!u)return null;if(f(u)){if(null==t)return u.clone();if(f(t))return t.copy(u)}null!=t?(t.x=u.x,t.y=u.y,t.spatialReference=u.spatialReference,u.hasZ?(t.z=u.z,t.hasZ=u.hasZ):(t.z=null,t.hasZ=!1),u.hasM?(t.m=u.m,t.hasM=!0):(t.m=null,t.hasM=!1)):(t=l.makeDehydratedPoint(u.x,u.y,u.z,u.spatialReference),u.hasM&&(t.m=u.m,t.hasM=!0));return t};a.hydrateGeometry=k;a.hydrateGraphic=function(u,
t){if(!u)return null;if(e(u))return u;t=new b({layer:t,sourceLayer:t});t.visible=u.visible;t.symbol=d.clone(u.symbol);t.attributes=d.clone(u.attributes);t.geometry=k(u.geometry);return t};a.isHydratedGeometry=n;a.isHydratedGraphic=e;a.isHydratedPoint=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/graphics/dehydratedFeatures":function(){define("exports ../../core/byteSizeEstimations ../../core/has ../../core/maybe ../../core/typedArrayUtil ../../core/uid ../../geometry/SpatialReference ../../geometry/support/aaBoundingBox ../../geometry/support/aaBoundingRect ../../geometry/support/quantizationUtils ../../geometry/support/typeUtils ../support/Field ./dehydratedFeatureComparison".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r){function y(q,z,v){if(d.isNone(q))return null;switch(z){case "point":return{x:q.x,y:q.y,z:q.z,m:q.m,hasZ:null!=q.z,hasM:null!=q.m,type:"point",spatialReference:v};case "polyline":return{paths:q.paths,hasZ:!!q.hasZ,hasM:!!q.hasM,type:"polyline",spatialReference:v};case "polygon":return{rings:q.rings,hasZ:!!q.hasZ,hasM:!!q.hasM,type:"polygon",spatialReference:v};case "multipoint":return{points:q.points,hasZ:!!q.hasZ,hasM:!!q.hasM,type:"multipoint",spatialReference:v}}}
function p(q){if(d.isNone(q))return 0;let z=32;switch(q.type){case "point":z+=42;break;case "polyline":case "polygon":{var v=0;const B=2+(q.hasZ?1:0)+(q.hasM?1:0);q="polyline"===q.type?q.paths:q.rings;for(const A of q)v+=A.length;z+=8*v*B+64;z+=128*v;z=z+34+32*(q.length+1);break}case "multipoint":v=q.points.length;z+=8*v*(2+(q.hasZ?1:0)+(q.hasM?1:0))+64;z+=128*v;z=z+34+32;break;case "extent":z+=98;q.hasM&&(z+=32);q.hasZ&&(z+=32);break;case "mesh":z+=g.estimateSize(q.vertexAttributes.position),z+=
g.estimateSize(q.vertexAttributes.normal),z+=g.estimateSize(q.vertexAttributes.uv),z+=g.estimateSize(q.vertexAttributes.tangent)}return z}function h(q,z){l.empty(z);"mesh"===q.type&&(q=q.extent);switch(q.type){case "point":z[0]=z[3]=q.x;z[1]=z[4]=q.y;q.hasZ&&(z[2]=z[5]=q.z);break;case "polyline":for(var v=0;v<q.paths.length;v++)l.expandWithNestedArray(z,q.paths[v],q.hasZ);break;case "polygon":for(v=0;v<q.rings.length;v++)l.expandWithNestedArray(z,q.rings[v],q.hasZ);break;case "multipoint":l.expandWithNestedArray(z,
q.points,q.hasZ);break;case "extent":z[0]=q.xmin,z[1]=q.ymin,z[3]=q.xmax,z[4]=q.ymax,null!=q.zmin&&(z[2]=q.zmin),null!=q.zmax&&(z[5]=q.zmax)}}function m(q,z){n.empty(z);"mesh"===q.type&&(q=q.extent);switch(q.type){case "point":z[0]=z[2]=q.x;z[1]=z[3]=q.y;break;case "polyline":for(var v=0;v<q.paths.length;v++)n.expandWithNestedArray(z,q.paths[v]);break;case "polygon":for(v=0;v<q.rings.length;v++)n.expandWithNestedArray(z,q.rings[v]);break;case "multipoint":n.expandWithNestedArray(z,q.points);break;
case "extent":z[0]=q.xmin,z[1]=q.ymin,z[2]=q.xmax,z[3]=q.ymax}}const u=l.create(),t=n.create();a.equals=r.equals;a.DehydratedFeatureClass=function(q,z,v){this.uid=q;this.geometry=z;this.attributes=v;this.visible=!0;this.centroid=this.objectId=null};a.DehydratedFeatureSetClass=function(){this.exceededTransferLimit=!1;this.features=[];this.fields=[];this.hasZ=this.hasM=!1;this.transform=this.spatialReference=this.geohashFieldName=this.geometryProperties=this.globalIdFieldName=this.objectIdFieldName=
this.geometryType=null};a.computeAABB=h;a.computeAABR=m;a.estimateGeometryObjectSize=p;a.estimateSize=function(q){let z;z=32+b.estimateAttributesObjectSize(q.attributes);return z=z+3+(8+p(q.geometry))};a.expandAABB=function(q,z){h(q,u);l.expandWithAABB(z,u)};a.expandAABR=function(q,z){d.isSome(q)&&(m(q,t),n.expand(z,t,z))};a.fromFeatureSetJSON=function(q){const z=e.featureGeometryTypeKebabDictionary.fromJSON(q.geometryType),v=w.fromJSON(q.spatialReference),B=q.transform,A=q.features.map(E=>{var C=
q.objectIdFieldName;E={uid:x.generateUID(),objectId:C&&E.attributes?E.attributes[C]:null,attributes:E.attributes,geometry:y(E.geometry,z,v),visible:!0};C=E.geometry;if(d.isSome(C)&&B)switch(C.type){case "point":E.geometry=f.unquantizePoint(B,C,C,C.hasZ,C.hasM);break;case "multipoint":E.geometry=f.unquantizeMultipoint(B,C,C,C.hasZ,C.hasM);break;case "polygon":E.geometry=f.unquantizePolygon(B,C,C,C.hasZ,C.hasM);break;case "polyline":E.geometry=f.unquantizePolyline(B,C,C,C.hasZ,C.hasM);break;case "extent":E.geometry=
C;break;case "mesh":E.geometry=C}return E});return{geometryType:z,features:A,spatialReference:v,fields:q.fields?q.fields.map(E=>k.fromJSON(E)):null,objectIdFieldName:q.objectIdFieldName,globalIdFieldName:q.globalIdFieldName,geohashFieldName:q.geohashFieldName,geometryProperties:q.geometryProperties,hasZ:q.hasZ,hasM:q.hasM,exceededTransferLimit:q.exceededTransferLimit,transform:null}};a.fromJSONGeometry=y;a.getObjectId=function(q,z){return null!=q.objectId?q.objectId:q.attributes&&z?q.attributes[z]:
null};a.hasGeometry=function(q){return d.isSome(q.geometry)};a.hasVertices=function(q){if(d.isNone(q))return!1;switch(q.type){case "extent":case "point":return!0;case "polyline":for(const z of q.paths)if(0<z.length)return!0;return!1;case "polygon":for(const z of q.rings)if(0<z.length)return!0;return!1;case "multipoint":return 0<q.points.length;case "mesh":return!q.loaded||0<q.vertexAttributes.position.length}};a.isFeatureGeometry=function(q){return e.isFeatureGeometryType(q.type)};a.makeDehydratedPoint=
function(q,z,v,B){return{x:q,y:z,z:v,hasZ:null!=v,hasM:!1,spatialReference:B,type:"point"}};a.numVertices=function(q){if(d.isNone(q))return 0;switch(q.type){case "point":return 1;case "polyline":var z=0;for(var v of q.paths)z+=v.length;return z;case "polygon":v=0;for(z of q.rings)v+=z.length;return v;case "multipoint":return q.points.length;case "extent":return 2;case "mesh":return(q=q.vertexAttributes&&q.vertexAttributes.position)?q.length/3:0}};Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/geometry/support/quantizationUtils":function(){define(["exports","../../core/maybe","./jsonUtils"],function(a,b,c){function d({scale:D,translate:F},G){return Math.round((G-F[0])/D[0])}function g({scale:D,translate:F},G){return Math.round((F[1]-G)/D[1])}function x(D,F,G){const J=[];let I,O,P,K;for(let M=0;M<G.length;M++){const U=G[M];if(0<M){if(P=d(D,U[0]),K=g(D,U[1]),P!==I||K!==O)J.push(F(U,P-I,K-O)),I=P,O=K}else I=d(D,U[0]),O=g(D,U[1]),J.push(F(U,I,O))}return 0<J.length?J:null}function w(D,
F,G,J){return x(D,G?J?C:E:J?E:A,F)}function l(D,F,G,J){const I=[];G=G?J?C:E:J?E:A;for(J=0;J<F.length;J++){const O=x(D,G,F[J]);O&&3<=O.length&&I.push(O)}return I.length?I:null}function n(D,F,G,J){const I=[];G=G?J?C:E:J?E:A;for(J=0;J<F.length;J++){const O=x(D,G,F[J]);O&&2<=O.length&&I.push(O)}return I.length?I:null}function f({scale:D,translate:F},G){return G*D[0]+F[0]}function e({scale:D,translate:F},G){return F[1]-G*D[1]}function k(D,F,G){const J=Array(G.length);if(!G.length)return J;const [I,O]=
D.scale;let P=f(D,G[0][0]);D=e(D,G[0][1]);J[0]=F(G[0],P,D);for(let K=1;K<G.length;K++){const M=G[K];P+=M[0]*I;D-=M[1]*O;J[K]=F(M,P,D)}return J}function r(D,F,G){const J=Array(G.length);for(let I=0;I<G.length;I++)J[I]=k(D,F,G[I]);return J}function y(D,F,G,J){return k(D,G?J?C:E:J?E:A,F)}function p(D,F,G,J){return r(D,G?J?C:E:J?E:A,F)}function h(D,F,G,J){return r(D,G?J?C:E:J?E:A,F)}function m(D,F,G){let [J,I]=G[0],O=Math.min(J,F[0]),P=Math.min(I,F[1]),K=Math.max(J,F[2]);F=Math.max(I,F[3]);for(let M=
1;M<G.length;M++){const [U,R]=G[M];J+=U;I+=R;0>U&&(O=Math.min(O,J));0<U&&(K=Math.max(K,J));0>R?P=Math.min(P,I):0<R&&(F=Math.max(F,I))}D[0]=O;D[1]=P;D[2]=K;D[3]=F;return D}function u(D,F){if(!F.length)return null;D[0]=D[1]=Number.POSITIVE_INFINITY;D[2]=D[3]=Number.NEGATIVE_INFINITY;for(let G=0;G<F.length;G++)m(D,D,F[G]);return D}function t(D,F,G,J,I){F.xmin=d(D,G.xmin);F.ymin=g(D,G.ymin);F.xmax=d(D,G.xmax);F.ymax=g(D,G.ymax);F!==G&&(J&&(F.zmin=G.zmin,F.zmax=G.zmax),I&&(F.mmin=G.mmin,F.mmax=G.mmax));
return F}function q(D,F,G,J,I){F.points=w(D,G.points,J,I);return F}function z(D,F,G,J,I){F.x=d(D,G.x);F.y=g(D,G.y);F!==G&&(J&&(F.z=G.z),I&&(F.m=G.m));return F}function v(D,F,G,J,I){D=l(D,G.rings,J,I);if(!D)return null;F.rings=D;return F}function B(D,F,G,J,I){D=n(D,G.paths,J,I);if(!D)return null;F.paths=D;return F}const A=(D,F,G)=>[F,G],E=(D,F,G)=>[F,G,D[2]],C=(D,F,G)=>[F,G,D[2],D[3]];a.equals=function(D,F){if(D===F||null==D&&null==F)return!0;if(null==D||null==F)return!1;let G,J,I,O;D&&"upperLeft"===
D.originPosition?(G=D.translate[0],J=D.translate[1],D=D.scale[0]):(G=b.isSome(D.extent)?D.extent.xmin:0,J=b.isSome(D.extent)?D.extent.ymax:0,D=D.tolerance);F&&"upperLeft"===F.originPosition?(I=F.translate[0],O=F.translate[1],F=F.scale[0]):(I=b.isSome(F.extent)?F.extent.xmin:0,O=b.isSome(F.extent)?F.extent.ymax:0,F=F.tolerance);return G===I&&J===O&&D===F};a.getQuantizedBoundsCoordsArray=m;a.getQuantizedBoundsCoordsArrayArray=u;a.getQuantizedBoundsPaths=function(D){return u([0,0,0,0],D)};a.getQuantizedBoundsPoints=
function(D){const F=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];return m(F,F,D)};a.getQuantizedBoundsRings=function(D){return u([0,0,0,0],D)};a.quantizeBounds=function(D,F,G){F[0]=d(D,G[0]);F[3]=g(D,G[1]);F[2]=d(D,G[2]);F[1]=g(D,G[3]);return F};a.quantizeExtent=t;a.quantizeGeometry=function(D,F){return D&&F?c.isPoint(F)?z(D,{},F,!1,!1):c.isPolyline(F)?B(D,{},F,!1,!1):c.isPolygon(F)?v(D,{},F,!1,!1):c.isMultipoint(F)?q(D,{},F,!1,!1):c.isExtent(F)?
t(D,{},F,!1,!1):null:null};a.quantizeMultipoint=q;a.quantizePaths=n;a.quantizePoint=z;a.quantizePoints=w;a.quantizePolygon=v;a.quantizePolyline=B;a.quantizeRings=l;a.quantizeX=d;a.quantizeY=g;a.toQuantizationTransform=function(D){return D?{originPosition:"upper-left"===D.originPosition?"upperLeft":"lower-left"===D.originPosition?"lowerLeft":D.originPosition,scale:D.tolerance?[D.tolerance,D.tolerance]:[1,1],translate:b.isSome(D.extent)?[D.extent.xmin,D.extent.ymax]:[0,0]}:null};a.unquantizeBounds=
function(D,F,G){return G?(F[0]=f(D,G[0]),F[1]=e(D,G[3]),F[2]=f(D,G[2]),F[3]=e(D,G[1]),F):[f(D,F[0]),e(D,F[3]),f(D,F[2]),e(D,F[1])]};a.unquantizeCoordsArray=k;a.unquantizeCoordsArrayArray=r;a.unquantizeExtent=function(D,F,G,J,I){F.xmin=f(D,G.xmin);F.ymin=e(D,G.ymin);F.xmax=f(D,G.xmax);F.ymax=e(D,G.ymax);F!==G&&(J&&(F.zmin=G.zmin,F.zmax=G.zmax),I&&(F.mmin=G.mmin,F.mmax=G.mmax));return F};a.unquantizeMultipoint=function(D,F,G,J,I){b.isSome(G)&&(F.points=y(D,G.points,J,I));return F};a.unquantizePaths=
p;a.unquantizePoint=function(D,F,G,J,I){if(b.isNone(G))return F;F.x=f(D,G.x);F.y=e(D,G.y);F!==G&&(J&&(F.z=G.z),I&&(F.m=G.m));return F};a.unquantizePoints=y;a.unquantizePolygon=function(D,F,G,J,I){b.isSome(G)&&(F.rings=h(D,G.rings,J,I));return F};a.unquantizePolyline=function(D,F,G,J,I){b.isSome(G)&&(F.paths=p(D,G.paths,J,I));return F};a.unquantizeRings=h;a.unquantizeX=f;a.unquantizeY=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/graphics/dehydratedFeatureComparison":function(){define(["exports",
"../../core/has","../../core/maybe"],function(a,b,c){function d(f,e){if(f===e)return!0;if(null==f||null==e||f.length!==e.length)return!1;for(let k=0;k<f.length;k++){const r=f[k],y=e[k];if(r.length!==y.length)return!1;for(let p=0;p<r.length;p++)if(r[p]!==y[p])return!1}return!0}function g(f,e){if(f===e)return!0;if(null==f||null==e||f.length!==e.length)return!1;for(let k=0;k<f.length;k++)if(!d(f[k],e[k]))return!1;return!0}function x(f,e){return w(f.spatialReference,e.spatialReference)?f.x===e.x&&f.y===
e.y&&f.z===e.z&&f.m===e.m:!1}function w(f,e){return f===e||f&&e&&f.equals(e)}function l(f,e){if(f===e)return!0;if(c.isNone(f)||c.isNone(e)||f.type!==e.type)return!1;switch(f.type){case "point":return x(f,e);case "extent":return f=f.hasZ!==e.hasZ||f.hasM!==e.hasM?!1:w(f.spatialReference,e.spatialReference)?f.xmin===e.xmin&&f.ymin===e.ymin&&f.zmin===e.zmin&&f.xmax===e.xmax&&f.ymax===e.ymax&&f.zmax===e.zmax:!1,f;case "polyline":return f=f.hasZ!==e.hasZ||f.hasM!==e.hasM?!1:w(f.spatialReference,e.spatialReference)?
g(f.paths,e.paths):!1,f;case "polygon":return f=f.hasZ!==e.hasZ||f.hasM!==e.hasM?!1:w(f.spatialReference,e.spatialReference)?g(f.rings,e.rings):!1,f;case "multipoint":return f=f.hasZ!==e.hasZ||f.hasM!==e.hasM?!1:w(f.spatialReference,e.spatialReference)?d(f.points,e.points):!1,f;case "mesh":return!1}}function n(f,e){if(f===e)return!0;if(!f||!e)return!1;const k=Object.keys(f),r=Object.keys(e);if(k.length!==r.length)return!1;for(const y of k)if(f[y]!==e[y])return!1;return!0}a.equals=function(f,e){return f===
e?!0:null!=f&&null!=e&&f.objectId===e.objectId&&l(f.geometry,e.geometry)&&n(f.attributes,e.attributes)?!0:!1};a.pointEquals=x;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/support/labelFormatUtils":function(){define("require exports ../../chunks/_rollupPluginBabelHelpers ../../core/Error ../../core/Logger ../../intl/date ../../intl/number ./fieldUtils ./labelUtils ../../support/arcadeOnDemand".split(" "),function(a,b,c,d,g,x,w,l,n,f){function e(){e=c._asyncToGenerator(function*(h,
m,u){if(!h||!h.symbol)return y;const t=h.where,q=n.getLabelExpression(h);h=t?yield new Promise((z,v)=>a(["../../core/sql/WhereClause"],z,v)):null;if("arcade"===q.type){const z=yield f.createLabelExpression(q.expression,u,m);u={type:"arcade",evaluate(v){try{const B=z.evaluate({$feature:"attributes"in v?z.repurposeFeature(v):v});if(null!=B)return B.toString()}catch(B){r.error(new d("bad-arcade-expression","Encountered an error when evaluating label expression for feature",{feature:v,expression:q}))}return null},
needsHydrationToEvaluate(){return null==n.getSingleFieldArcadeExpression(q.expression)}}}else u={type:"simple",evaluate(z){return q.expression.replace(/{[^}]*}/g,v=>{var B=v.slice(1,-1);B=m.get(B);if(!B)return v;v=null;"attributes"in z?z&&z.attributes&&(v=z.attributes[B.name]):v=z.field(B.name);return null==v?"":k(v,B)})}};if(t){let z;try{z=h.WhereClause.create(t,m)}catch(B){return y}const v=u.evaluate;u.evaluate=B=>z.testFeature(B,"attributes"in B?void 0:p)?v(B):null}return u});return e.apply(this,
arguments)}function k(h,m){if(null==h)return"";const u=m.domain;if(u)if("codedValue"===u.type||"coded-value"===u.type)for(var t of u.codedValues){if(t.code===h)return t.name}else if("range"===u.type){t=+h;const q="range"in u?u.range[1]:u.maxValue;if(("range"in u?u.range[0]:u.minValue)<=t&&t<=q)return u.name}"date"===m.type||"esriFieldTypeDate"===m.type?h=x.formatDate(h,x.convertDateFormatToIntlOptions("short-date")):l.isNumericField(m)&&(h=w.formatNumber(+h));return h?h:""}const r=g.getLogger("esri.layers.support.labelFormatUtils"),
y={type:"simple",evaluate(){return null}},p={getAttribute(h,m){return h.field(m)}};b.createLabelFunction=function(h,m,u){return e.apply(this,arguments)};b.formatField=k;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DCalloutSymbolLayerFactory":function(){define(["exports","../../../../core/Logger","../../../../symbols/callouts/calloutUtils","./Graphics3DLineCalloutSymbolLayer"],function(a,b,c,d){const g=b.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory"),
x={line:d.Graphics3DLineCalloutSymbolLayer};a.make=function(w,l){if(!c.hasCalloutSupport(w))return g.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${w.type}' does not support callouts`),null;if(!w.callout)return null;const n=x[w.callout.type];return n?new n(w,l):(g.error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${w.callout.type}`),null)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DLineCalloutSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/maybe ../../../../core/screenUtils ../../../../symbols/callouts/calloutUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./pointUtils ./symbolComplexity ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Material ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/LineCalloutMaterial".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t){e=function(A){function E(D,F){D=A.call(this,D,null,F,B)||this;D._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};D.ensureDrapedStatus(!1);return D}b._inheritsLoose(E,A);var C=E.prototype;C.doLoad=function(){var D=b._asyncToGenerator(function*(){this._material=new t.LineCalloutMaterial(this.materialParameters);this._context.stage.add(this._material)});return function(){return D.apply(this,arguments)}}();C.destroy=function(){A.prototype.destroy.call(this);
this._context.stage.remove(this._material);this._material=null};C._perInstanceMaterialParameters=function(D){const F=this.materialParameters;F.screenOffset=D.screenOffset||[0,0];F.centerOffsetUnits=D.centerOffsetUnits||"world";return F};C._defaultElevationInfoNoZ=function(){return v};C.createGraphics3DGraphic=function(D){const F=D.renderingInfo;D=D.graphic;const G=this.setGraphicElevationContext(D,new n.ElevationContext,F.elevationOffset||0);var J=F.symbol;const I="on-the-ground"===this._elevationContext.mode&&
("cim"===J.type||!J.symbolLayers.some(O=>"object"===O.type||"text"===O.type));if("label-3d"!==J.type&&I||"point-3d"===J.type&&J.symbolLayers.every(O=>"text"===O.type&&!x.textSymbolLayerSupportsVerticalOffset(O)))return null;J=k.computeCentroid(D.geometry);return d.isNone(J)?null:this._createAs3DShape(J,G,F,D.uid)};C.layerOpacityChanged=function(){if(d.isNone(this._material))return!0;this._material.setParameters(this.materialParameters);return!0};C.layerElevationInfoChanged=function(D,F,G){G=l.elevationModeChangeUpdateType(E.elevationModeChangeTypes,
G,this._elevationContext.mode);if(G!==l.SymbolUpdateType.UPDATE)return G;D.forEach(J=>{const I=F(J);d.isSome(I)&&this.updateGraphicElevationContext(J.graphic,I)});return G};C.slicePlaneEnabledChanged=function(){if(d.isNone(this._material))return!0;this._material.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};C.physicalBasedRenderingChanged=function(){return!0};C.pixelRatioChanged=function(){return!0};C.setGraphicElevationContext=function(D,F,G=0){D=A.prototype.setGraphicElevationContext.call(this,
D,F);D.addOffsetRenderUnits(G);return D};C.updateGraphicElevationContext=function(D,F){this.setGraphicElevationContext(D,F.elevationContext,F.metadata.elevationOffset);F.needsElevationUpdates=l.needsElevationUpdates2D(F.elevationContext.mode)};C.computeComplexity=function(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:y.emptySymbolComplexity.memory}};C._createVertexData=function(D){const {translation:F,centerOffset:G}=D;return[[u.VertexAttribute.POSITION,
F?{size:3,data:[F[0],F[1],F[2]],exclusive:!0}:{size:3,data:[0,0,0],exclusive:!0}],[u.VertexAttribute.NORMAL,{size:3,data:[0,0,1],exclusive:!0}],[u.VertexAttribute.AUXPOS1,G?{size:4,data:[G[0],G[1],G[2],G[3]],exclusive:!0}:{size:4,data:[0,0,0,1],exclusive:!0}]]};C._getOrCreateMaterial=function(D){const F=this._perInstanceMaterialParameters(D),G=t.LineCalloutMaterial.uniqueMaterialIdentifier(F);if(d.isSome(this._material)&&G===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};
if(D.materialCollection){let J=D.materialCollection.get(G);d.isNone(J)&&(J=new t.LineCalloutMaterial(F),D.materialCollection.add(G,J));return{material:J,isUnique:!1}}return{material:new t.LineCalloutMaterial(F),isUnique:!0}};C._createAs3DShape=function(D,F,G,J){var I=[new h.Geometry(this._createVertexData(G),z,p.PrimitiveType.Point)];const O=this._getOrCreateMaterial(G);J=r.createStageObjectForHUD(this._context,D,I,[O.material],F,this._context.layer.uid,J);if(null===J)return null;I=new f.Graphics3DObject3DGraphicLayer(this,
J.object,I,O.isUnique?[O.material]:null,null,w.perObjectElevationAligner,F);I.metadata={elevationOffset:G.elevationOffset||0};I.alignedSampledElevation=J.sampledElevation;I.needsElevationUpdates=l.needsElevationUpdates2D(F.mode);r.extendPointGraphicElevationContext(I,D,this._context.elevationProvider);return I};b._createClass(E,[{key:"materialParameters",get:function(){const D=this.symbol;var F=D.callout;const G=d.isSome(F.color)?c.toUnitRGBA(F.color):[0,0,0,0];G[3]*=this._getLayerOpacity();const J=
g.pt2px(F.size||0);let I=null;if(D.verticalOffset){const {screenLength:P,minWorldLength:K,maxWorldLength:M}=D.verticalOffset;I={screenLength:g.pt2px(P),minWorldLength:K||0,maxWorldLength:null!=M?M:Infinity}}F=d.isSome(F.border)&&d.isSome(F.border.color)?c.toUnitRGBA(F.border.color):null;const O="object"===D.symbolLayers.getItemAt(0).type;return{color:G,size:J,verticalOffset:I,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:
null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:F,occlusionTest:!O,shaderPolygonOffset:O?0:void 0,depthHUDAlignStart:"label-3d"===D.type,slicePlaneEnabled:this._context.slicePlaneEnabled,renderOccluded:m.DefaultMaterialParameters.renderOccluded}}}]);return E}(e.Graphics3DSymbolLayer);e.elevationModeChangeTypes={definedChanged:l.SymbolUpdateType.UPDATE,staysOnTheGround:l.SymbolUpdateType.UPDATE,onTheGroundChanged:l.SymbolUpdateType.RECREATE};const q=new Uint16Array([0]),z=[[u.VertexAttribute.POSITION,
q],[u.VertexAttribute.NORMAL,q],[u.VertexAttribute.AUXPOS1,q]],v={mode:"relative-to-ground",offset:0},B={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};a.Graphics3DLineCalloutSymbolLayer=e;a.default=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/ElevationAligners":function(){define("exports ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ./elevationAlignmentUtils ./graphicUtils ../../support/debugFlags ../../support/ElevationProvider ../../webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k){function r(z,v,B,A){let E=!1;const C=B.spatialReference;var D=z.geometry,F=z.getShaderTransformation();z=v.requiresSampledElevationInfo;h[0]=F[12];h[1]=F[13];h[2]=F[14];D.invalidateBoundingInfo();var G=D.getMutableAttribute(k.VertexAttribute.POSITION);F=G.data;var J=D.vertexAttributes.get(k.VertexAttribute.MAPPOS).data;D=G.size;G=F.length/D;J=new e.SamplePosition(J,C);let I=0,O=0;for(let P=0;P<G;P++){m[0]=F[I];m[1]=F[I+1];m[2]=F[I+2];l.evaluateElevationInfoAtPoint(J,
B,v,A,q);z&&(O+=q.sampledElevation);if(f.TESTS_DISABLE_OPTIMIZATIONS)F[I]=J.array[J.offset],F[I+1]=J.array[J.offset+1],F[I+2]=q.z,w.projectBuffer(F,C,I,F,A.spatialReference,I,1),F[I]-=h[0],F[I+1]-=h[1],F[I+2]-=h[2],E=!0;else{p[0]=F[I]+h[0];p[1]=F[I+1]+h[1];p[2]=F[I+2]+h[2];A.setAltitude(p,q.z);F[I]=p[0]-h[0];F[I+1]=p[1]-h[1];F[I+2]=p[2]-h[2];const K=.01/A.unitInMeters;if(Math.abs(m[0]-F[I])>=K||Math.abs(m[1]-F[I+1])>=K||Math.abs(m[2]-F[I+2])>=K)E=!0}I+=D;J.offset+=3}return{update:E,averageGeometrySampledElevation:O/
G}}const y=d.create(),p=x.create(),h=x.create(),m=x.create(),u=d.create(),t=x.create(),q=new l.SampleElevationInfo;a.perLodInstanceElevationAligner=function(z,v,B,A){var E=z.graphics3DSymbolLayer.lodRenderer;if(b.isNone(E))return 0;const C=v.centerPointInElevationSR;l.evaluateElevationInfoAtPoint(C,B,v,A,q);v="absolute-height"!==v.mode?q.sampledElevation:0;E=E.instanceData;z=z.instanceIndex;E.getGlobalTransform(z,u);B=g.set(t,u[12],u[13],u[14]);f.TESTS_DISABLE_OPTIMIZATIONS?(p[0]=C.x,p[1]=C.y,p[2]=
q.z,w.computeTranslationToOriginAndRotation(C.spatialReference,p,u,A.spatialReference)&&E.setGlobalTransform(z,u)):A.setAltitudeOfTransformation(q.z,u);A=.01/A.unitInMeters;(f.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(u[12]-B[0])>=A||Math.abs(u[13]-B[1])>=A||Math.abs(u[14]-B[2])>=A)&&E.setGlobalTransform(z,u);return v};a.perObjectElevationAligner=function(z,v,B,A){z=z.stageObject;const E=v.centerPointInElevationSR;let C=0;z.metadata.usesVerticalDistanceToGround?(l.evaluateElevationInfoAtPoint(E,B,v,A,
q),n.updateVertexAttributeAuxpos1w(z,q.verticalDistanceToGround),C=q.sampledElevation):(l.evaluateElevationInfoAtPoint(E,B,v,A,q),"absolute-height"!==v.mode&&(C=q.sampledElevation));v=c.copy(y,z.transformation);B=g.set(t,v[12],v[13],v[14]);f.TESTS_DISABLE_OPTIMIZATIONS?(p[0]=E.x,p[1]=E.y,p[2]=q.z,w.computeTranslationToOriginAndRotation(E.spatialReference,p,v,A.spatialReference)&&(z.transformation=v)):A.setAltitudeOfTransformation(q.z,v);A=.01/A.unitInMeters;if(Math.abs(v[12]-B[0])>=A||Math.abs(v[13]-
B[1])>=A||Math.abs(v[14]-B[2])>=A)z.transformation=v;return C};a.perVertexElevationAligner=function(z,v,B,A){z=z.stageObject;const E=z.geometryRecords;let C=0;for(const D of E){const {update:F,averageGeometrySampledElevation:G}=r(D,v,B,A);C+=G;F&&z.geometryVertexAttrsUpdated(D)}return C/E.length};a.sharedGeometryElevationAligner=function(z,v,B,A){z=z.stageObject;const E=z.geometryRecords;if(0===E.length)return 0;let C=0,D=null,F=0,G=!1;for(const J of E){const I=J.geometry.vertexAttributes.get(k.VertexAttribute.POSITION);
if(I!==D){const {update:O,averageGeometrySampledElevation:P}=r(J,v,B,A);F=P;D=I;G=O}G&&z.geometryVertexAttrsUpdated(J);C+=F}return C/E.length};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/elevationAlignmentUtils":function(){define("exports ../../../../core/compilerUtils ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../layers/graphics/dehydratedFeatureUtils ./graphicUtils ../../support/ElevationProvider".split(" "),
function(a,b,c,d,g,x,w,l,n,f){function e(m,u,t,q,z){const v=(l.isDehydratedPoint(m)?m.z:f.isSamplePosition(m)?m.array[m.offset+2]:m[2])||0;switch(t.mode){case "on-the-ground":t=c.unwrapOr(f.getElevationAtPoint(u,m,"ground"),0);z.verticalDistanceToGround=0;z.sampledElevation=t;z.z=t;break;case "relative-to-ground":m=c.unwrapOr(f.getElevationAtPoint(u,m,"ground"),0);t=t.geometryZWithOffset(v,q);z.verticalDistanceToGround=t;z.sampledElevation=m;z.z=t+m;break;case "relative-to-scene":m=c.unwrapOr(f.getElevationAtPoint(u,
m,"scene"),0);t=t.geometryZWithOffset(v,q);z.verticalDistanceToGround=t;z.sampledElevation=m;z.z=t+m;break;case "absolute-height":t=t.geometryZWithOffset(v,q);q=c.unwrapOr(f.getElevationAtPoint(u,m,"ground"),0);z.verticalDistanceToGround=t-q;z.sampledElevation=q;z.z=t;break;default:b.neverReached(t.mode),z.z=0}}let k=function(){this.z=this.sampledElevation=this.verticalDistanceToGround=0};a.SymbolUpdateType=void 0;(function(m){m[m.NONE=0]="NONE";m[m.UPDATE=1]="UPDATE";m[m.RECREATE=2]="RECREATE"})(a.SymbolUpdateType||
(a.SymbolUpdateType={}));const r={"absolute-height":{applyElevationAlignmentBuffer:function(m,u,t,q,z,v,B,A){v=A.calculateOffsetRenderUnits(B);A=A.featureExpressionInfoContext;u*=3;q*=3;for(B=0;B<z;++B){const E=m[u+1],C=m[u+2];t[q+0]=m[u+0];t[q+1]=E;t[q+2]=null==A?C+v:v;u+=3;q+=3}return 0},requiresAlignment:function(m){const u=m.featureExpressionInfoContext;return 0!==m.meterUnitOffset||null!=u}},"on-the-ground":{applyElevationAlignmentBuffer:function(m,u,t,q,z,v){let B=0;const A=v.spatialReference;
u*=3;q*=3;for(let E=0;E<z;++E){const C=m[u+0],D=m[u+1],F=c.unwrapOr(v.getElevation(C,D,m[u+2],A,"ground"),0);B+=F;t[q+0]=C;t[q+1]=D;t[q+2]=F;u+=3;q+=3}return B/z},requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:function(m,u,t,q,z,v,B,A){let E=0;B=A.calculateOffsetRenderUnits(B);A=A.featureExpressionInfoContext;const C=v.spatialReference;u*=3;q*=3;for(let D=0;D<z;++D){const F=m[u+0],G=m[u+1],J=m[u+2],I=c.unwrapOr(v.getElevation(F,G,J,C,"ground"),0);E+=I;t[q+0]=F;t[q+1]=
G;t[q+2]=null==A?J+I+B:I+B;u+=3;q+=3}return E/z},requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:function(m,u,t,q,z,v,B,A){let E=0;B=A.calculateOffsetRenderUnits(B);A=A.featureExpressionInfoContext;const C=v.spatialReference;u*=3;q*=3;for(let D=0;D<z;++D){const F=m[u+0],G=m[u+1],J=m[u+2],I=c.unwrapOr(v.getElevation(F,G,J,C,"scene"),0);E+=I;t[q+0]=F;t[q+1]=G;t[q+2]=null==A?J+I+B:I+B;u+=3;q+=3}return E/z},requiresAlignment:()=>!0}},y=g.create(),p=new k,h=x.create();a.SampleElevationInfo=
k;a.applyElevationAlignmentForHUD=function(m,u,t,q,z){e(u,t,z,q,p);n.updateVertexAttributeAuxpos1w(m,p.verticalDistanceToGround);t=p.sampledElevation;z=d.copy(y,m.transformation);h[0]=u.x;h[1]=u.y;h[2]=p.z;w.computeTranslationToOriginAndRotation(u.spatialReference,h,z,q.spatialReference)?m.transformation=z:console.warn("Could not locate symbol object properly, it might be misplaced");return t};a.applyPerVertexElevationAlignment=function(m,u,t,q,z,v,B,A,E,C,D){const F=r[D.mode];let G=0;if(w.projectBuffer(m,
u,t,q,E.spatialReference,z,A)&&(F.requiresAlignment(D)?(G=F.applyElevationAlignmentBuffer(q,z,v,B,A,E,C,D),m=v,z=B):m=q,w.projectBuffer(m,E.spatialReference,z,v,C.spatialReference,B,A)))return G};a.elevationModeChangeUpdateType=function(m,u,t){return null==u||null==t?m.definedChanged:"on-the-ground"===u&&"on-the-ground"===t?m.staysOnTheGround:u===t||"on-the-ground"!==u&&"on-the-ground"!==t?a.SymbolUpdateType.UPDATE:m.onTheGroundChanged};a.evaluateElevationAlignmentAtPoint=function(m,u,t,q){e(m,u,
t,q,p);return p.z};a.evaluateElevationInfoAtPoint=e;a.needsElevationUpdates2D=function(m){return"relative-to-ground"===m||"relative-to-scene"===m};a.needsElevationUpdates3D=function(m){return"absolute-height"!==m};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/graphicUtils":function(){define("exports ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/centroid ../../../../geometry/support/coordsUtils ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/hydratedFeatures ../../webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p){function h(t){var q=t.paths[0];if(!q||0===q.length)return null;q=k.getPointOnPath(q,k.getPathLength(q)/2);return r.makeDehydratedPoint(q[0],q[1],q[2],t.spatialReference)}function m(t,q,z){z=z?t:y.clonePoint(t);return q&&t?l.projectPoint(t,z,q)?z:null:z}function u(t){if(Array.isArray(t)){for(const q of t)if(!u(q))return!1;return!0}return null==t||0<=t}a.computeCentroid=function(t,q){if("point"===t.type)return m(t,q,!1);if(y.isHydratedGeometry(t))switch(t.type){case "extent":return m(t.center,
q,!1);case "polygon":return m(t.centroid,q,!1);case "polyline":return m(h(t),q,!0);case "mesh":return m(t.origin,q,!1)}else switch(t.type){case "extent":var z=isFinite(t.zmin);t=r.makeDehydratedPoint(.5*(t.xmax+t.xmin),.5*(t.ymax+t.ymin),z?.5*(t.zmax+t.zmin):void 0,t.spatialReference);return m(t,q,!0);case "polygon":return(z=t.rings[0])&&0!==z.length?(z=e.ringsCentroid(t.rings,t.hasZ),t=r.makeDehydratedPoint(z[0],z[1],z[2],t.spatialReference)):t=null,m(t,q,!0);case "polyline":return m(h(t),q,!0)}};
a.computeObjectRotation=function(t,q,z,v=d.create()){t=t||0;q=q||0;z=z||0;0!==t&&c.rotateZ(v,v,-t/180*Math.PI);0!==q&&c.rotateX(v,v,q/180*Math.PI);0!==z&&c.rotateY(v,v,z/180*Math.PI);return v};a.computeObjectScale=function(t=g.ONES,q,z,v=1){const B=Array(3);if(b.isNone(q)||b.isNone(z))B[0]=1,B[1]=1,B[2]=1;else{let E=0;for(let C=2;0<=C;C--){const D=t[C];let F;const G=null!=D,J=0===C&&!A&&!G,I=z[C];"symbol-value"===D||J?F=0!==I?q[C]/I:1:G&&"proportional"!==D&&isFinite(D)&&(F=0!==I?D/I:1);if(null!=F){var A=
B[C]=F;E=Math.max(E,Math.abs(F))}}for(t=2;0<=t;t--)null==B[t]?B[t]=A:0===B[t]&&(B[t]=.001*E)}for(A=2;0<=A;A--)B[A]/=v;return g.fromArray(B)};a.demResolutionForBoundingBox=function(t,q){return null!=q.minDemResolution?q.minDemResolution:n.isPoint(t)?q.minDemResolutionForPoints:.01*n.maximumDimension(t)};a.enlargeExtent=function(t,q,z,v=0){if(t){q||(q=f.create());let B=.5*t.width*(z-1);z=.5*t.height*(z-1);t.width<1E-7*t.height?B+=z/20:t.height<1E-7*t.width&&(z+=B/20);x.set(q,t.xmin-B-v,t.ymin-z-v,t.xmax+
B+v,t.ymax+z+v);return q}return null};a.isValidSize=u;a.mixinColorAndOpacity=function(t,q){const z=w.clone(w.ONES);b.isSome(t)&&(z[0]=t[0],z[1]=t[1],z[2]=t[2]);b.isSome(q)?z[3]=q:b.isSome(t)&&3<t.length&&(z[3]=t[3]);return z};a.overrideColor=function(t,q,z,v,B,A=[0,0,0,0]){for(let E=0;3>E;++E)b.isSome(t)&&null!=t[E]?A[E]=t[E]:b.isSome(z)&&null!=z[E]?A[E]=z[E]:A[E]=B[E];b.isSome(q)?A[3]=q:b.isSome(v)?A[3]=v:A[3]=B[3];return A};a.updateVertexAttributeAuxpos1w=function(t,q){for(let z=0;z<t.geometries.length;++z){const v=
t.geometries[z].getMutableAttribute(p.VertexAttribute.AUXPOS1);v&&v.data[3]!==q&&(v.data[3]=q,t.geometryVertexAttrsUpdated(t.geometryRecords[z]))}};a.validateSymbolLayerSize=function(t){null!=t.isPrimitive&&(t=[t.width,t.depth,t.height]);return u(t)?null:"Symbol sizes may not be negative values"};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/ElevationContext":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../symbols/support/unitConversionUtils",
"./featureExpressionInfoUtils"],function(a,b,c,d,g){let x=function(){function w(){this._renderUnitOffset=this._meterUnitOffset=0;this._unit="meters";this._metersPerElevationInfoUnit=1;this.mode=this.centerPointInElevationSR=this._featureExpressionInfoContext=null}var l=w.prototype;l.reset=function(){this.mode=null;this._renderUnitOffset=this._meterUnitOffset=0;this._featureExpressionInfoContext=null;this.unit="meters"};l.addOffsetRenderUnits=function(n){this._renderUnitOffset+=n};l.geometryZWithOffset=
function(n,f){f=this.calculateOffsetRenderUnits(f);return null!=this.featureExpressionInfoContext?f:n+f};l.calculateOffsetRenderUnits=function(n){let f=this._meterUnitOffset;const e=this.featureExpressionInfoContext;null!=e&&(f+=g.execute(e)*this._metersPerElevationInfoUnit);return f/n.unitInMeters+this._renderUnitOffset};l.setFromElevationInfo=function(n){this.mode=n.mode;this.unit=d.supportsUnit(n.unit)?n.unit:"meters";this.offsetElevationInfoUnits=c.unwrapOr(n.offset,0)};l.updateFeatureExpressionInfoContext=
function(n,f,e){if(c.isNone(n))this._featureExpressionInfoContext=null;else{var k=n&&n.arcade;k&&c.isSome(f)&&c.isSome(e)?(this._featureExpressionInfoContext=g.clone(n),g.setContextFeature(this._featureExpressionInfoContext,g.createFeature(k.modules,f,e))):this._featureExpressionInfoContext=n}};w.fromElevationInfo=function(n){const f=new w;c.isSome(n)&&f.setFromElevationInfo(n);return f};b._createClass(w,[{key:"featureExpressionInfoContext",get:function(){return this._featureExpressionInfoContext}},
{key:"meterUnitOffset",get:function(){return this._meterUnitOffset}},{key:"unit",get:function(){return this._unit},set:function(n){this._unit=n;this._metersPerElevationInfoUnit=d.getMetersPerUnit(n)}},{key:"requiresSampledElevationInfo",get:function(){return"absolute-height"!==this.mode}},{key:"offsetMeters",set:function(n){this._meterUnitOffset=n;this._renderUnitOffset=0}},{key:"offsetElevationInfoUnits",set:function(n){this._meterUnitOffset=n*this._metersPerElevationInfoUnit;this._renderUnitOffset=
0}}]);return w}();a.ElevationContext=x;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/featureExpressionInfoUtils":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/Logger","../../../../layers/graphics/hydratedFeatures","../../../../support/arcadeOnDemand"],function(a,b,c,d,g){function x(){x=b._asyncToGenerator(function*(l,n,f){l=l&&l.expression;if("string"!==typeof l)return null;var e="0"===l?0:null;if(null!=e)return{cachedResult:e};
e=yield g.loadArcade();const k=e.arcadeUtils;l=k.createSyntaxTree(l);return k.dependsOnView(l)?(null!=f&&f.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:k.createFunction(l),context:k.createExecContext(null,{sr:n}),modules:e}}});return x.apply(this,arguments)}const w=c.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");a.clone=function(l){return{cachedResult:l.cachedResult,arcade:l.arcade?{func:l.arcade.func,context:l.arcade.modules.arcadeUtils.createExecContext(null,
{sr:l.arcade.context.spatialReference}),modules:l.arcade.modules}:null}};a.createContext=function(l,n,f){return x.apply(this,arguments)};a.createContextWithoutExpressionSupport=function(l){l=l&&l.expression;return"string"===typeof l&&(l="0"===l?0:null,null!=l)?{cachedResult:l}:null};a.createFeature=function(l,n,f){return l.arcadeUtils.createFeature(n.attributes,n.geometry,f)};a.execute=function(l){if(null!=l){if(null!=l.cachedResult)return l.cachedResult;var n=l.arcade;n=l.arcade.modules.arcadeUtils.executeFunction(n.func,
n.context);"number"!==typeof n&&(n=l.cachedResult=0);return n}return 0};a.extractExpressionInfo=function(l,n=!1){const f=(l=l&&l.featureExpressionInfo)&&l.expression;n||"0"===f||(l=null);return l};a.setContextFeature=function(l,n){null!=l&&null==l.cachedResult&&(n&&l.arcade?(n._geometry&&(n._geometry=d.hydrateGeometry(n._geometry)),l.arcade.modules.arcadeUtils.updateExecContext(l.arcade.context,n)):w.errorOncePerTick("Arcade support required but not provided"))};a.zeroContext={cachedResult:0};Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DObject3DGraphicLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../chunks/sphere ./featureExpressionInfoUtils ./graphicUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/edgeRendering/interfaces".split(" "),function(a,b,c,d,g,x,w,l,n,f,e){function k(u){return u.isVisible?
u.parameters.transparent?e.Transparency.TRANSPARENT:e.Transparency.OPAQUE:e.Transparency.INVISIBLE}let r=function(){function u(q,z,v,B,A,E,C,D=null){this.graphics3DSymbolLayer=q;this.stageObject=z;this._uniqueGeometries=v;this._uniqueMaterials=B;this._sharedResource=A;this.elevationAligner=E;this.elevationContext=C;this._edgeState=D;this.type="object3d";this._stage=this._stageLayer=null;this._addedToStage=this._visible=!1;this.alignedSampledElevation=0;this.useObjectOriginAsAttachmentOrigin=this.needsElevationUpdates=
!1;this.graphics3DSymbolLayer=q;this.stageObject=z}var t=u.prototype;t.initialize=function(q,z){this._stageLayer=z;this._stage=q;q.addMany(this._uniqueMaterials);q.addMany(this._uniqueGeometries);q.add(this.stageObject)};t.destroy=function(){var q=this._stage;this._stageLayer&&(q.removeMany(this._uniqueMaterials),q.removeMany(this._uniqueGeometries));q.remove(this.stageObject);this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);q=this._stage.renderView.ensureEdgeView();
q.hasObject(this.stageObject)&&q.removeObject(this.stageObject);this.stageObject.dispose();c.isSome(this._sharedResource)&&this._sharedResource.release();this._visible=!1;this._stage=this._stageLayer=null};t.layerOpacityChanged=function(q,z){if(!c.isNone(this._edgeState)){var v=k(this._edgeState.baseMaterial),B=!1;for(const A of this._edgeState.edgeMaterials)A.objectTransparency!==v&&(A.objectTransparency=v,B=!0);B&&this._resetEdgeObject(z);this._stage.renderView.ensureEdgeView().updateAllComponentOpacities(this.stageObject,
[q])}};t.slicePlaneEnabledChanged=function(q,z){c.isNone(this._edgeState)||(this._stage.renderView.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{slicePlaneEnabled:q},!z),this._edgeState.properties.slicePlaneEnabled=q)};t.setVisibility=function(q){if(null!=this._stage&&this._visible!==q&&((this._visible=q)?this._addedToStage?this.stageObject.setVisible(!0):(this._stageLayer.add(this.stageObject),this._addedToStage=!0):this.stageObject.setVisible(!1),c.isSome(this._edgeState))){const z=
this._stage.renderView.ensureEdgeView();z.hasObject(this.stageObject)?z.updateObjectVisibility(this.stageObject,q):q&&this._addOrUpdateEdgeObject(z,!1)}};t.alignWithElevation=function(q,z,v,B){null!=this.elevationAligner&&(c.isSome(v)&&l.setContextFeature(this.elevationContext.featureExpressionInfoContext,v),this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,q,z),this._resetEdgeObject(B))};t.getCenterObjectSpace=function(q=g.create()){return d.copy(q,w.getCenter(this.stageObject.boundingVolumeObjectSpace.bounds))};
t.getBoundingBoxObjectSpace=function(q=x.create()){const z=this.stageObject.boundingVolumeObjectSpace;x.setMin(q,z.min);x.setMax(q,z.max);return q};t.computeAttachmentOrigin=function(q){if(this.useObjectOriginAsAttachmentOrigin){var z=this.stageObject.transformation;q.render.origin[0]+=z[12];q.render.origin[1]+=z[13];q.render.origin[2]+=z[14];q.render.num++}else for(z of this.stageObject.geometryRecords)z.computeAttachmentOrigin(h)&&(d.transformMat4(h,h,this.stageObject.transformation),d.add(q.render.origin,
q.render.origin,h),q.render.num++)};t.getProjectedBoundingBox=function(){var q=b._asyncToGenerator(function*(z,v,B,A,E){E=this.getBoundingBoxObjectSpace(E);var C=m,D=x.isPoint(E)?1:C.length;for(var F=0;F<D;F++){const G=C[F];p[0]=E[G[0]];p[1]=E[G[1]];p[2]=E[G[2]];d.transformMat4(p,p,this.stageObject.transformation);y[3*F]=p[0];y[3*F+1]=p[1];y[3*F+2]=p[2]}if(!z(y,0,D))return null;x.empty(E);z=null;this.calculateRelativeScreenBounds&&(z=this.calculateRelativeScreenBounds());for(C=0;C<3*D;C+=3){for(F=
0;3>F;F++)E[F]=Math.min(E[F],y[C+F]),E[F+3]=Math.max(E[F+3],y[C+F]);z&&B.push({location:y.slice(C,C+3),screenSpaceBoundingRect:z})}if(v&&v.service&&"absolute-height"!==this.elevationContext.mode){x.center(E,h);B="relative-to-scene"===this.elevationContext.mode?"scene":"ground";D=0;if(v.useViewElevation)D=c.unwrapOr(v.service.getElevation(h[0],h[1],B),0);else try{const G=n.demResolutionForBoundingBox(E,v);D=c.unwrapOr(yield v.service.queryElevation(h[0],h[1],A,G,B),0)}catch(G){}x.offset(E,0,0,-this.alignedSampledElevation+
D)}return E});return function(z,v,B,A,E){return q.apply(this,arguments)}}();t.addObjectState=function(q,z){q===f.Object3DState.Highlight&&z.addObject(this.stageObject,this.stageObject.highlight());q===f.Object3DState.MaskOccludee&&z.addObject(this.stageObject,this.stageObject.maskOccludee())};t.removeObjectState=function(q){q.removeObject(this.stageObject)};t._resetEdgeObject=function(q){if(!c.isNone(this._edgeState)){var z=this._stage.renderView.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(z,
q):z.removeObject(this.stageObject)}};t._addOrUpdateEdgeObject=function(q,z){const v=this._edgeState;if(!c.isNone(v)){var B=k(v.baseMaterial);for(const A of v.edgeMaterials)A.objectTransparency=B;q.addOrUpdateObject3D(this.stageObject,v.edgeMaterials,v.properties,!z).then(()=>{var A;return null==(A=this._stageLayer)?void 0:A.sync()})}};b._createClass(u,[{key:"isElevationSource",get:function(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)}},{key:"visible",get:function(){return this._visible}}]);
return u}();const y=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],p=g.create(),h=g.create(),m=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];a.Graphics3DObject3DGraphicLayer=r;a.default=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/interfaces":function(){define(["exports"],function(a){a.Transparency=void 0;var b=a.Transparency||(a.Transparency={});b[b.INVISIBLE=0]="INVISIBLE";b[b.TRANSPARENT=1]="TRANSPARENT";b[b.OPAQUE=2]=
"OPAQUE";Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/has ../../../../core/Logger ../../../../core/maybe ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ./elevationAlignmentUtils ./ElevationContext ./featureExpressionInfoUtils ./graphicUtils ./interfaces ./Loadable ./symbolComplexity".split(" "),function(a,b,c,d,g,x,w,l,n,f,e,
k,r,y,p){function h(v,B){v=null!=v?B.attributes[v]:0;return null!=v&&isFinite(v)?v:0}function m(v){const B={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};v&&"visualVariables"in v&&v.visualVariables&&v.visualVariables.forEach(A=>{switch(A.type){case "color":B.color=!0;if(A.stops)for(let E=0;E<A.stops.length;E++){const C=A.stops[E].color;C&&(B.opacity=!0,1>C.a&&(B.opacityAlwaysOpaque=!1))}break;case "opacity":B.opacity=!0;B.opacityAlwaysOpaque=!1;break;case "size":B.size=!0}});return B}const u=
g.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");d=function(v){function B(E,C,D,F){var G=v.call(this,D.schedule)||this;G._context=D;G._elevationInfoOverride=null;G._ignoreDrivers=!1;G._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};G.complexity=null;G.logger=u;G._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};G.symbol=E;G.symbolLayer=C;G._renderPriority=F.renderPriority;G._renderPriorityStep=F.renderPriorityStep;G._elevationContext=new f.ElevationContext;
G.complexity=G.computeComplexity();G._ignoreDrivers=F.ignoreDrivers;G._ignoreDrivers||(G._drivenProperties=m(G._context.renderer));G._updateElevationContext();return G}b._inheritsLoose(B,v);var A=B.prototype;A.getCachedSize=function(){return null};A._drivenPropertiesChanged=function(E){if(this._ignoreDrivers)return!1;const C=this._drivenProperties;E=m(E);return E.color!==C.color||E.opacity!==C.opacity||E.opacityAlwaysOpaque!==C.opacityAlwaysOpaque||E.size!==C.size};A._logGeometryCreationWarnings=
function(E,C,D,F){const G="polygons"in E?E.polygons:null;F=`${F} geometry failed to be created`;let J=null;E.projectionSuccess?!C.length||1===C.length&&!C[0].length?J=`${F} (no ${D} were defined)`:Array.isArray(C)&&Array.isArray(C[0])?G&&0===G.length&&"rings"===D&&0<C.length&&2<C[0].length&&(J=`${F} (filled rings should use clockwise winding - try reversing the order of vertices)`):J=`${F} (${D} should be defined as a 2D array)`:J=`${F} (failed to project geometry to view spatial reference)`;J&&u.warnOncePerTick(J)};
A._validateGeometry=function(E,C=null,D=null){return x.isSome(C)&&!C.includes(E.type)?(this.logger.warn("unsupported geometry type for "+D+` symbol: ${E.type}`),!1):"point"!==E.type||isFinite(E.x)&&isFinite(E.y)?!0:(u.warn("point coordinate is not a valid number, graphic skipped"),!1)};A._defaultElevationInfoNoZ=function(){return t};A._defaultElevationInfoZ=function(){return q};A._updateElevationContext=function(){x.isSome(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),
this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()};A.getDefaultElevationInfo=function(E){return E.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()};A.getGeometryElevationMode=function(E,C=this.getDefaultElevationInfo(E)){return this._elevationContext.mode||
C.mode};A.setElevationInfoOverride=function(E){this._elevationInfoOverride=E;this._updateElevationContext()};A.setGraphicElevationContext=function(E,C){var D=x.unwrap(E.geometry);const F=this.getDefaultElevationInfo(D);C.unit=null!=this._elevationContext.unit?this._elevationContext.unit:F.unit;C.mode=this.getGeometryElevationMode(D,F);C.offsetMeters=x.unwrapOr(this._elevationContext.meterUnitOffset,x.unwrapOr(F.offset,0));if(D=!this._elevationOptions.supportsOnTheGround&&"on-the-ground"===C.mode)C.mode=
"relative-to-ground",C.offsetMeters=0;C.updateFeatureExpressionInfoContext(D?e.zeroContext:this._elevationContext.featureExpressionInfoContext,E,this._context.layer);return C};A.prepareSymbolLayerPatch=function(E){};A.updateGeometry=function(E,C){return!1};A.onRemoveGraphic=function(E){};A._getLayerOpacity=function(){if(this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner)return this._context.graphicsCoreOwner.fullOpacity;const E=this._context.layer.opacity;return null==
E?1:E};A._getCombinedOpacity=function(E,C=z){let D=1;this.draped||(D*=this._getLayerOpacity());if(this._drivenProperties.opacity)return D;x.isSome(E)?D*=E.a:C.hasIntrinsicColor||(D=0);return D};A._getCombinedOpacityAndColor=function(E,C=z){C=this._getCombinedOpacity(E,C);if(this._drivenProperties.color)return k.mixinColorAndOpacity(null,C);E=x.isSome(E)?c.toUnitRGB(E):w.ONES;return k.mixinColorAndOpacity(E,C)};A._getVertexOpacityAndColor=function(E,C=null){E=k.mixinColorAndOpacity(this._drivenProperties.color?
E.color:null,this._drivenProperties.opacity?E.opacity:null);x.isSome(C)&&(E[0]*=C,E[1]*=C,E[2]*=C,E[3]*=C);return E};A.isFastUpdatesEnabled=function(){return this._fastUpdates&&this._fastUpdates.enabled};A.computeComplexity=function(){return p.defaultSymbolLayerComplexity(this.symbol,this.symbolLayer)};A.globalPropertyChanged=function(E,C,D){switch(E){case "opacity":return this.layerOpacityChanged(C,D);case "elevationInfo":return E=this._elevationContext.mode,this._updateElevationContext(),this.layerElevationInfoChanged(C,
D,E)===n.SymbolUpdateType.RECREATE?!1:!0;case "slicePlaneEnabled":return this.slicePlaneEnabledChanged(C,D);case "physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case "pixelRatio":return this.pixelRatioChanged();default:return!1}};A.updateGraphics3DGraphicElevationInfo=function(E,C,D){let F=n.SymbolUpdateType.UPDATE;E.forEach(G=>{const J=C(G);x.isSome(J)?(this.setGraphicElevationContext(G.graphic,J.elevationContext),J.needsElevationUpdates=D(J.elevationContext.mode)):F=
n.SymbolUpdateType.RECREATE});return F};A.applyRendererDiff=function(E,C){return r.ApplyRendererDiffResult.Recreate_Symbol};A.getFastUpdateAttrValues=function(E){if(!this._fastUpdates.enabled)return null;const C=this._fastUpdates.visualVariables,D=C.size?h(C.size.field,E):0,F=C.color?h(C.color.field,E):0;E=C.opacity?h(C.opacity.field,E):0;return l.fromValues(D,F,E,0)};A.ensureDrapedStatus=function(E){if(null==this._draped)return this._draped=E,!0;E!==this.draped&&u.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary.");
return!1};b._createClass(B,[{key:"extentPadding",get:function(){return 0}},{key:"needsDrivenTransparentPass",get:function(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}},{key:"draped",get:function(){return this._draped}}]);return B}(y.Loadable);const t={mode:"on-the-ground",offset:0,unit:"meters"},q={mode:"absolute-height",offset:0,unit:"meters"},z={hasIntrinsicColor:!1};a.Graphics3DSymbolLayer=d;a.default=d;a.getAttributeValue=h;Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/views/3d/layers/graphics/interfaces":function(){define(["exports"],function(a){a.ApplyRendererDiffResult=void 0;var b=a.ApplyRendererDiffResult||(a.ApplyRendererDiffResult={});b[b.Recreate_Symbol=0]="Recreate_Symbol";b[b.Recreate_Graphics=1]="Recreate_Graphics";b[b.Fast_Update=2]="Fast_Update";Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Loadable":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe",
"../../../../core/promiseUtils"],function(a,b,c,d){let g=function(){function x(l){this.schedule=l;this._loadStatus=a.LoadStatus.LOADING;this.logger=null}var w=x.prototype;w.destroy=function(){this.abortLoad()};w.load=function(l,n){if(this._loadStatus===a.LoadStatus.LOADED)return l&&l(),c.unwrap(this._loader);if(this._loadStatus===a.LoadStatus.FAILED)return n&&n(this._loadError),c.unwrap(this._loader);c.isNone(this._loader)&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>
{this._abortController=null;this._loadStatus=a.LoadStatus.LOADED},f=>{this._loadError=f;this._abortController=null;this._loadStatus=a.LoadStatus.FAILED;!d.isAbortError(f)&&this.logger&&f.message&&this.logger.warn(f.message);throw f;}));this._loader.then(l,n).catch(()=>{});return this._loader};w.abortLoad=function(){c.isSome(this._abortController)?this._abortController=c.abortMaybe(this._abortController):this._loadStatus===a.LoadStatus.LOADING&&(this._loadStatus=a.LoadStatus.FAILED);this._loader=null};
b._createClass(x,[{key:"loadStatus",get:function(){return this._loadStatus}}]);return x}();a.LoadStatus=void 0;(function(x){x[x.LOADING=0]="LOADING";x[x.LOADED=1]="LOADED";x[x.FAILED=2]="FAILED"})(a.LoadStatus||(a.LoadStatus={}));a.Loadable=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/symbolComplexity":function(){define("exports ../../../../core/compilerUtils ../../../../core/maybe ../../../../symbols/support/ObjectSymbol3DLayerResource ./primitiveObjectSymbolUtils ../support/edgeUtils ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/lib/lodRendering/LodResources".split(" "),
function(a,b,c,d,g,x,w,l){function n(h){let m=0,u=0,t=0,q=!1,z=0;const v={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const B of h)c.isNone(B)||(m+=B.primitivesPerFeature,u+=B.primitivesPerCoordinate,t+=B.drawCallsPerFeature,v.bytesPerFeature+=B.memory.bytesPerFeature,v.bytesPerFeatureLabel+=B.memory.bytesPerFeatureLabel,v.bytesPerCoordinate+=B.memory.bytesPerCoordinate,v.draped.bytesPerFeature+=B.memory.bytesPerFeature,
v.draped.bytesPerFeatureLabel+=B.memory.bytesPerFeatureLabel,v.draped.bytesPerCoordinate+=B.memory.bytesPerCoordinate,q=q||B.estimated,++z);return{primitivesPerFeature:m,primitivesPerCoordinate:u,drawCallsPerFeature:t,estimated:q,memory:v,numComplexities:z}}function f(h,m){const u=e(h,m);var t=x.hasEdges(m)?2:0;switch(m.type){case "extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:t,estimated:!1,memory:u};case "fill":return"mesh-3d"===h.type?{primitivesPerFeature:0,
primitivesPerCoordinate:0,drawCallsPerFeature:t,estimated:!1,memory:u}:c.isSome(m.outline)&&0<m.outline.size?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:u}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:u};case "water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:u};case "line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,drawCallsPerFeature:0,
estimated:!1,memory:u};case "object":return m.resource&&m.resource.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:u}:{...k(m.resource&&m.resource.primitive||d.defaultPrimitive),memory:u};case "path":{var q=h=0;switch(m.profile){case "circle":h=10;break;case "quad":h=4;break;default:b.neverReached(m.profile);return}switch(m.join){case "round":q=3;break;case "miter":case "bevel":q=1;break;default:b.neverReached(m.join);return}t=2*h;q=h*q*2;let z=-2*
q-t;switch(m.cap){case "none":break;case "butt":case "square":z+=2*(h-1);break;case "round":z+=2*(4*h+h);break;default:return}return{primitivesPerFeature:z,primitivesPerCoordinate:q+t,drawCallsPerFeature:0,estimated:!1,memory:u}}case "text":case "icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:u}}}function e(h,m){h="point-3d"===h.type;switch(m.type){case "extrude":return m.edges&&0<m.edges.size?p.EXTRUDE_EDGES:p.EXTRUDE;case "fill":return c.isSome(m.outline)&&
0<m.outline.size?p.FILL_OUTLINE:p.FILL;case "water":return p.FILL;case "line":return"round"===m.join?p.LINE_ROUND:p.LINE_MITER;case "path":switch(m.join){case "round":switch(m.profile){case "circle":return p.PATH_ROUND_CIRCLE;case "quad":return p.PATH_ROUND_QUAD;default:b.neverReached(m.profile);return}case "miter":case "bevel":switch(m.profile){case "circle":return p.PATH_MITER_CIRCLE;case "quad":return p.PATH_MITER_QUAD;default:b.neverReached(m.profile);return}default:b.neverReached(m.join);return}case "object":return h?
p.OBJECT_POINT:p.OBJECT_POLYGON;case "icon":case "text":return h?p.ICON_POINT:p.ICON_POLYGON}}function k(h){var m=y[h];if(m)return m;m=g.primitiveLodResources(h,null);m={primitivesPerFeature:l.geometriesFromLodLevelResources(m.levels[0]).reduce((u,t)=>u+t.indices.get(w.VertexAttribute.POSITION).length/3,0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1};return y[h]=m}const r={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,
bytesPerCoordinate:0,bytesPerFeatureLabel:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}},y={},p={ICON_POINT:{bytesPerFeature:7127.413186968842,bytesPerFeatureLabel:4826.302896296296,bytesPerCoordinate:0,draped:{bytesPerFeature:3929.4396628895197,bytesPerFeatureLabel:3550.1332222222227,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:9329.452613976147,bytesPerFeatureLabel:3675.3372604938268,bytesPerCoordinate:60.177252982212096,draped:{bytesPerFeature:6190.247450139383,
bytesPerFeatureLabel:3744.074358024691,bytesPerCoordinate:59.488211068026104}},OBJECT_POINT:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0,draped:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506,draped:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506}},
LINE_MITER:{bytesPerFeature:7321.028181375921,bytesPerFeatureLabel:4048.0226716049388,bytesPerCoordinate:186.55621386363578,draped:{bytesPerFeature:4246.856619435009,bytesPerFeatureLabel:3852.3737679012347,bytesPerCoordinate:163.47884002621583}},LINE_ROUND:{bytesPerFeature:7482.205842738954,bytesPerFeatureLabel:4045.886987654321,bytesPerCoordinate:191.5452524171851,draped:{bytesPerFeature:4473.481387957992,bytesPerFeatureLabel:3842.1112395061728,bytesPerCoordinate:167.27703460226945}},PATH_MITER_CIRCLE:{bytesPerFeature:9010.489006415351,
bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275,draped:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275}},PATH_ROUND_CIRCLE:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957,draped:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957}},PATH_MITER_QUAD:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203,
draped:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203}},PATH_ROUND_QUAD:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826,draped:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826}},FILL:{bytesPerFeature:9478.244183633637,bytesPerFeatureLabel:3713.816824691358,bytesPerCoordinate:95.9343604185578,draped:{bytesPerFeature:6287.911108168086,
bytesPerFeatureLabel:3790.785032098766,bytesPerCoordinate:83.08783220478168}},FILL_OUTLINE:{bytesPerFeature:13085.871870349445,bytesPerFeatureLabel:3392.613241975309,bytesPerCoordinate:118.63968023169875,draped:{bytesPerFeature:8437.199992480122,bytesPerFeatureLabel:3973.5431172839503,bytesPerCoordinate:106.33556817014312}},EXTRUDE:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477,draped:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,
bytesPerCoordinate:372.6819978900477}},EXTRUDE_EDGES:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312,draped:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312}}};a.averageSymbolComplexities=function(h){h=n(h);0<h.numComplexities&&(h.primitivesPerFeature/=h.numComplexities,h.primitivesPerCoordinate/=h.numComplexities,h.drawCallsPerFeature/=h.numComplexities,h.memory.bytesPerFeature/=
h.numComplexities,h.memory.bytesPerFeatureLabel/=h.numComplexities,h.memory.bytesPerCoordinate/=h.numComplexities,h.memory.draped.bytesPerFeature/=h.numComplexities,h.memory.draped.bytesPerFeatureLabel/=h.numComplexities,h.memory.draped.bytesPerCoordinate/=h.numComplexities);return h};a.defaultSymbolComplexity=function(h){if("web-style"===h.type)return r;const m=h.symbolLayers.toArray().map(u=>f(h,u));return n(m)};a.defaultSymbolLayerComplexity=f;a.defaultSymbolLayerMemoryComplexity=e;a.emptySymbolComplexity=
r;a.memoryEstimators=p;a.totalSymbolComplexities=n;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/primitiveObjectSymbolUtils":function(){define(["exports","../../../../core/has","../../webgl-engine/lib/GeometryUtil"],function(a,b,c){const d=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];a.isValidPrimitive=function(g){switch(g){case "sphere":case "cube":case "diamond":case "cylinder":case "cone":case "inverted-cone":case "tetrahedron":return!0}return!1};
a.primitiveLodResources=function(g,x){const w=(l,n,f=!1)=>({levels:l.map(e=>{const k=n(e.tesselation);f&&c.cgToGIS(k);return{components:[{geometry:k,material:x}],faceCount:k.indexCount/3,minScreenSpaceRadius:e.minScreenSpaceRadius}})});switch(g){case "sphere":return w([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],l=>c.createPolySphereGeometry(.5,
l,!0));case "cube":return w([{tesselation:0,minScreenSpaceRadius:0}],()=>c.createBoxGeometry(1));case "cone":return w(d,l=>c.createConeGeometry(1,.5,l,!1),!0);case "inverted-cone":return w(d,l=>c.createConeGeometry(1,.5,l,!0),!0);case "cylinder":return w(d,l=>c.createCylinderGeometry(1,.5,l,[0,0,1],[0,0,.5]));case "tetrahedron":return w([{tesselation:0,minScreenSpaceRadius:0}],()=>c.createTetrahedronGeometry(1),!0);case "diamond":return w([{tesselation:0,minScreenSpaceRadius:0}],()=>c.createDiamondGeometry(1),
!0)}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/edgeUtils":function(){define("exports ../../../../Color ../../../../core/has ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec4f64 ./layerUtils ../../webgl-engine/lib/edgeRendering/interfaces".split(" "),function(a,b,c,d,g,x,w,l){function n(r,y){if(d.isNone(r))return null;const p=d.isSome(r.color)?x.fromArray(b.toUnitRGBA(r.color)):x.fromValues(0,0,0,0),h=g.pt2px(r.size),m=g.pt2px(r.extensionLength);
switch(r.type){case "solid":return f({color:p,size:h,extensionLength:m,...y});case "sketch":return{...k,color:p,size:h,extensionLength:m,...y,type:"sketch"}}}function f(r){return{...e,...r,type:"solid"}}const e={color:x.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:l.Transparency.OPAQUE},k={color:x.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:l.Transparency.OPAQUE};a.createMaterial=function(r,y){return n(r&&r.enabled&&r.edges||null,y)};a.createMaterialFromEdges=
n;a.createSolidEdgeMaterial=f;a.hasEdges=function(r){return r&&r.enabled&&(w.isExtrudeSymbol3DLayer(r)||w.isFillSymbol3DLayer(r))&&d.isSome(r.edges)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/layerUtils":function(){define(["exports"],function(a){a.isExtrudeSymbol3DLayer=function(b){return"extrude"===b.type};a.isFillSymbol3DLayer=function(b){return"fill"===b.type};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodResources":function(){define(["exports",
"../../../../../core/arrayUtils"],function(a,b){function c(d){const g=[];d.components.forEach(x=>{g.push(x.geometry)});return b.unique(g)}a.computeFaceCount=function(d){return c(d).reduce((g,x)=>g+x.indexCount/3,0)};a.geometriesFromLodLevelResources=c;a.geometriesFromLodResources=function(d){const g=[];d.levels.forEach(x=>{x.components.forEach(w=>{g.push(w.geometry)})});return b.unique(g)};a.materialsFromLodResources=function(d){const g=[];d.levels.forEach(x=>{x.components.forEach(w=>{g.push(w.material)})});
return b.unique(g)};a.texturesFromLodResources=function(d){const g=[];d.levels.forEach(x=>{x.components.forEach(w=>{w.textures&&g.push(...w.textures)})});return b.unique(g)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/pointUtils":function(){define("exports ../../../../core/maybe ../../../../chunks/mat4f64 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/coordsUtils ../../../../layers/graphics/dehydratedFeatures ./elevationAlignmentUtils ./graphicUtils ../../webgl-engine/lib/Object3D".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e){const k=d.create();a.createStageObjectForHUD=function(r,y,p,h,m,u,t,q){const z=p?p.length:0;var v=r.clippingExtent;g.projectPointToVector(y,k,r.elevationProvider.spatialReference);if(b.isSome(v)&&!x.containsPoint(v,k))return null;g.projectPointToVector(y,k,r.renderCoordsHelper.spatialReference);v=r.localOriginFactory.getOrigin(k);u=new e.Object3D({castShadow:!1,metadata:{layerUid:u,graphicUid:t,usesVerticalDistanceToGround:!0}});for(t=0;t<z;t++)u.addGeometry(p[t],h[t],
c.IDENTITY,v,q);r=n.applyElevationAlignmentForHUD(u,y,r.elevationProvider,r.renderCoordsHelper,m);return{object:u,sampledElevation:r}};a.extendPointGraphicElevationContext=function(r,y,p){r=r.elevationContext;p=p.spatialReference;g.projectPointToVector(y,k,p);r.centerPointInElevationSR=l.makeDehydratedPoint(k[0],k[1],y.hasZ?k[2]:0,p)};a.geometryToRenderInfo=function(r,y,p,h,m){const u=new Float64Array(3*r.length),t=new Float64Array(u.length);r.forEach((q,z)=>{u[3*z]=q[0];u[3*z+1]=q[1];u[3*z+2]=2<
q.length?q[2]:0});y=n.applyPerVertexElevationAlignment(u,y,0,t,0,u,0,u.length/3,p,h,m);return{numVertices:r.length,position:u,mapPosition:t,projectionSuccess:null!=y,sampledElevation:y}};a.placePointOnGeometry=function(r){switch(r.type){case "point":return r;case "polygon":case "extent":return f.computeCentroid(r);case "polyline":var y=r.paths[0];if(!y||0===y.length)break;y=w.getPointOnPath(y,w.getPathLength(y)/2);return l.makeDehydratedPoint(y[0],y[1],y[2],r.spatialReference);case "mesh":return r.origin}return null};
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Object3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/sphere ../../support/mathUtils ./basicInterfaces ./ContentObject ./ContentObjectType ./GeometryRecord ./Object3DStateID ./Util ../materials/renderers/utils".split(" "),function(a,b,c,d,g,x,w,
l,n,f,e,k,r,y,p,h){e=function(t){function q(v={}){var B=t.call(this)||this;B.type=k.ContentObjectType.Object;B._geometryRecords=[];B._geometries=[];B._objectTransformation=g.create();B._bvObjectSpace=new u;B._bvWorldSpace=new u;B._bvDirty=!0;B._hasVolatileTransformation=!1;B._visible=!0;B.castShadow=null!=v.castShadow?v.castShadow:!0;B.metadata=v.metadata;B.metadata&&B.metadata.isElevationSource&&(B.metadata.lastValidElevationBB=new m);B.transformation=g.create();const {geometries:A,materials:E,transformations:C,
origins:D}=v;if(!Array.isArray(A))return b._assertThisInitialized(B);p.assert(E.length===A.length,"Object3D: materials don't match geometries");p.assert(C.length===A.length,"Object3D: transformations don't match geometries");B._geometryRecords.length=A.length;B._geometries.length=A.length;for(v=0;v<A.length;v++)B._geometries[v]=A[v],B._geometryRecords[v]=r.GeometryRecord.pool.acquire(A[v],E[v],g.clone(C[v]),{highlights:null,occludees:null,visible:B._visible},D&&D[v]);return B}b._inheritsLoose(q,t);
var z=q.prototype;z.dispose=function(){this._geometryRecords.length=0;this._geometries.length=0};z.addGeometry=function(v,B,A,E,C){A=A?A:g.IDENTITY;this._geometries.push(v);v=r.GeometryRecord.pool.acquire(v,B,A,{highlights:null,occludees:null,visible:this._visible},E,C);this._geometryRecords.push(v);this._hasVolatileTransformation=this._hasVolatileTransformation||c.isSome(v.shaderTransformation);this._emit("objectGeometryAdded",{object:this,record:v});this._invalidateBoundingVolume();return v};z.removeGeometry=
function(v){const B=this._geometryRecords.splice(v,1)[0];this._hasVolatileTransformation=c.isSome(B.shaderTransformation)?this._geometryRecords.some(A=>c.isSome(A.shaderTransformation)):this._hasVolatileTransformation;B.dispose();this._geometries.splice(v,1);this._emit("objectGeometryRemoved",{object:this,record:B});this._invalidateBoundingVolume();return B};z.removeAllGeometries=function(){for(;0<this.geometryRecords.length;)this.removeGeometry(0)};z.geometryVertexAttrsUpdated=function(v){this._emit("vertexAttrsUpdated",
{object:this,record:v});this._invalidateBoundingVolume()};z.setVisible=function(v){if(this._visible!==v){this._visible=v;for(const B of this._geometryRecords)B.instanceParameters.visible=this._visible;this._emit("visibilityChanged",this)}};z.maskOccludee=function(){const v=new y.Object3DStateID(f.Object3DState.MaskOccludee);for(const B of this._geometryRecords)B.instanceParameters.occludees=h.addObject3DStateID(B.instanceParameters.occludees,v);this._emit("occlusionChanged",this);return v};z.removeOcclude=
function(v){for(const B of this._geometryRecords)B.instanceParameters.occludees=h.removeObject3DStateID(B.instanceParameters.occludees,v);this._emit("occlusionChanged",this)};z.highlight=function(){const v=new y.Object3DStateID(f.Object3DState.Highlight);for(const B of this._geometryRecords)B.instanceParameters.highlights=h.addObject3DStateID(B.instanceParameters.highlights,v);this._emit("highlightChanged",this);return v};z.removeHighlight=function(v){for(const B of this._geometryRecords)B.instanceParameters.highlights=
h.removeObject3DStateID(B.instanceParameters.highlights,v);this._emit("highlightChanged",this)};z.getCombinedStaticTransformation=function(v,B){return d.multiply(c.unwrapOr(B,g.create()),this.transformation,v.getStaticTransformation())};z._getCombinedShaderTransformation=function(v,B){B=B||g.create();d.multiply(B,this.transformation,v.getShaderTransformation());return B};z.hasVolativeTransformation=function(){return this._hasVolatileTransformation};z._validateBoundingVolume=function(){if(this._bvDirty||
this._hasVolatileTransformation){this._bvObjectSpace.init();this._bvWorldSpace.init();for(var v=0;v<this._geometryRecords.length;++v){var B=this._geometryRecords[v],A=this._geometries[v].boundingInfo;c.isSome(A)&&(this._calculateTransformedBoundingVolume(A,this._bvObjectSpace,B.getShaderTransformation()),this._calculateTransformedBoundingVolume(A,this._bvWorldSpace,this._getCombinedShaderTransformation(B)))}x.lerp(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5);x.lerp(this._bvWorldSpace.bounds,
this._bvWorldSpace.min,this._bvWorldSpace.max,.5);v=w.create();B=w.create();A=n.maxScale(this.transformation);for(let F=0;F<this._geometryRecords.length;++F){var E=this._geometries[F].boundingInfo;if(!c.isNone(E)){var C=this._geometryRecords[F].getShaderTransformation(),D=n.maxScale(C);x.transformMat4(v,E.getCenter(),C);C=x.distance(v,this._bvObjectSpace.bounds);E=E.getBSRadius()*D;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],C+E);x.transformMat4(B,v,this.transformation);D=
x.distance(B,this._bvWorldSpace.bounds);this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],D+E*A)}}this._bvDirty=!1}};z._calculateTransformedBoundingVolume=function(v,B,A){const E=v.getBBMin();v=v.getBBMax();const C=w.clone(E),D=w.clone(v);x.transformMat4(C,C,A);x.transformMat4(D,D,A);for(var F=0;3>F;++F)B.min[F]=Math.min(B.min[F],C[F],D[F]),B.max[F]=Math.max(B.max[F],C[F],D[F]);for(F=0;3>F;++F){x.copy(C,E);x.copy(D,v);C[F]=v[F];D[F]=E[F];x.transformMat4(C,C,A);x.transformMat4(D,D,
A);for(let G=0;3>G;++G)B.min[G]=Math.min(B.min[G],C[G],D[G]),B.max[G]=Math.max(B.max[G],C[G],D[G])}};z._invalidateBoundingVolume=function(){this._bvDirty=!0;c.isSome(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)};z._emit=function(v,B){c.isSome(this._parentLayer)&&this._parentLayer.events.emit(v,B)};b._createClass(q,[{key:"geometryRecords",get:function(){return this._geometryRecords}},{key:"geometries",get:function(){return this._geometries}},{key:"transformation",
get:function(){return this._objectTransformation},set:function(v){d.copy(this._objectTransformation,v);this._invalidateBoundingVolume();this._emit("objectTransformation",this)}},{key:"parentLayer",get:function(){return this._parentLayer},set:function(v){p.assert(null==this._parentLayer||null==v,"Object3D can only be added to a single Layer");this._parentLayer=v}},{key:"isVisible",get:function(){return this._visible}},{key:"boundingVolumeWorldSpace",get:function(){this._validateBoundingVolume();return this._bvWorldSpace}},
{key:"boundingVolumeObjectSpace",get:function(){this._validateBoundingVolume();return this._bvObjectSpace}},{key:"test",get:function(){const v=this;return{hasGeometry:B=>-1<v._geometries.indexOf(B),getGeometryIndex:B=>v._geometries.indexOf(B)}}}]);return q}(e.ContentObject);let m=function(){function t(){this.min=w.fromValues(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this.max=w.fromValues(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}t.prototype.isEmpty=function(){return this.max[0]<
this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]};return t}(),u=function(t){function q(){var z=t.apply(this,arguments)||this;z.bounds=l.create();return z}b._inheritsLoose(q,t);q.prototype.init=function(){x.set(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);x.set(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);l.clear(this.bounds)};return q}(m);a.Object3D=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/GeometryRecord":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/ObjectPool ../../../../core/uid ../../../../chunks/vec3".split(" "),
function(a,b,c,d,g,x){let w=function(){function l(){this._disposed=!1}var n=l.prototype;n.acquire=function(f,e,k,r,y,p){this.id=g.generateUID();this.geometry=f;this.material=e;this.transformation=k;this.instanceParameters=r;this.origin=y;this._shaderTransformation=p;this._disposed=!1};n.release=function(){this._disposed=!1};n.dispose=function(){this._disposed=!0};n.getStaticTransformation=function(){return this.transformation};n.getShaderTransformation=function(){return c.isSome(this._shaderTransformation)?
this._shaderTransformation(this.transformation):this.transformation};n.computeAttachmentOrigin=function(f){return(this.material.computeAttachmentOrigin?this.material.computeAttachmentOrigin(this.geometry,f):this.geometry.computeAttachmentOrigin(f))?(x.transformMat4(f,f,this.getStaticTransformation()),!0):!1};b._createClass(l,[{key:"disposed",get:function(){return this._disposed}},{key:"shaderTransformation",get:function(){return this._shaderTransformation}}]);return l}();w.pool=new d(w);a.GeometryRecord=
w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Object3DStateID":function(){define(["exports","../../../../core/uid"],function(a,b){a.Object3DStateID=function(c){this.channel=c;this.id=b.generateUID()};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/LineCalloutMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec2f32 ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/hud/HUD.glsl ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/VertexAttribute ./internal/bufferWriterUtils ../shaders/LineCalloutTechnique".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k){let r=function(t){function q(v){v=t.call(this,v,p)||this;v.techniqueConfig=new k.LineCalloutTechniqueConfiguration;v._uniqueMaterialIdentifier=q.uniqueMaterialIdentifier(v.parameters);return v}b._inheritsLoose(q,t);var z=q.prototype;z.getPassParameters=function(){return this.parameters};z.getTechniqueConfig=function(v,B){v=(null==B?void 0:B.slot)!==n.RenderSlot.LINE_CALLOUTS;this.techniqueConfig.occlusionTestEnabled=this.parameters.occlusionTest;this.techniqueConfig.verticalOffset=
!!this.parameters.verticalOffset;this.techniqueConfig.screenSizePerspective=!!this.parameters.screenSizePerspective;this.techniqueConfig.depthHudEnabled=v;this.techniqueConfig.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart;this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits?x.HUDSpace.Screen:x.HUDSpace.World;this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled;this.techniqueConfig.multipassGeometryEnabled=B?B.multipassGeometryEnabled:
!1;return this.techniqueConfig};z.intersect=function(){};z.requiresSlot=function(v){switch(v){case n.RenderSlot.LINE_CALLOUTS:case n.RenderSlot.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1};z.createGLMaterial=function(v){return v.output===g.ShaderOutput.Color?new y(v):null};z.createBufferWriter=function(){return new u};z.validateParameters=function(v){v=q.uniqueMaterialIdentifier(v);v!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=v)};q.uniqueMaterialIdentifier=function(v){return JSON.stringify({screenOffset:v.screenOffset||
[0,0],centerOffsetUnits:v.centerOffsetUnits||"world"})};b._createClass(q,[{key:"uniqueMaterialIdentifier",get:function(){return this._uniqueMaterialIdentifier}}]);return q}(l.Material),y=function(t){function q(){return t.apply(this,arguments)||this}b._inheritsLoose(q,t);var z=q.prototype;z.updateParameters=function(v){return this.ensureTechnique(k.LineCalloutTechnique,v)};z.beginSlot=function(v){return this.updateParameters(v)};z.bind=function(v,B){B.bindPass(this._material.getPassParameters(),v)};
return q}(w);const p={verticalOffset:null,screenSizePerspective:null,screenOffset:[0,0],color:[0,0,0,1],size:1,borderColor:null,occlusionTest:!1,shaderPolygonOffset:1E-5,depthHUDAlignStart:!1,centerOffsetUnits:"world",slicePlaneEnabled:!1,...l.DefaultMaterialParameters},h=d.newLayout().vec3f(f.VertexAttribute.POSITION).vec3f(f.VertexAttribute.NORMAL).vec2f(f.VertexAttribute.UV0).vec4f(f.VertexAttribute.AUXPOS1),m=[c.fromValues(0,0),c.fromValues(1,0),c.fromValues(0,1),c.fromValues(1,0),c.fromValues(1,
1),c.fromValues(0,1)];let u=function(){function t(){this.vertexBufferLayout=h}var q=t.prototype;q.allocate=function(z){return this.vertexBufferLayout.createBuffer(z)};q.elementCount=function(z){return 6*z.indices.get(f.VertexAttribute.POSITION).length};q.write=function(z,v,B,A){e.writePosition(v.indices.get(f.VertexAttribute.POSITION),v.vertexAttributes.get(f.VertexAttribute.POSITION).data,z.transformation,B.position,A,6);e.writeNormal(v.indices.get(f.VertexAttribute.NORMAL),v.vertexAttributes.get(f.VertexAttribute.NORMAL).data,
z.invTranspTransformation,B.normal,A,6);e.writeBufferVec4(v.indices.get(f.VertexAttribute.AUXPOS1),v.vertexAttributes.get(f.VertexAttribute.AUXPOS1).data,B.auxpos1,A,6);for(z=0;z<m.length;++z)B.uv0.setVec(A+z,m[z])};return t}();a.LineCalloutMaterial=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/vec2f32":function(){define(["exports"],function(a){function b(){return new Float32Array(2)}function c(p){const h=new Float32Array(2);h[0]=p[0];h[1]=p[1];return h}function d(p,h){const m=
new Float32Array(2);m[0]=p;m[1]=h;return m}function g(p,h){return new Float32Array(p,h,2)}function x(){return b()}function w(){return d(1,1)}function l(){return d(1,0)}function n(){return d(0,1)}const f=b(),e=w(),k=l(),r=n(),y=Object.freeze({__proto__:null,create:b,clone:c,fromValues:d,createView:g,zeros:x,ones:w,unitX:l,unitY:n,ZEROS:f,ONES:e,UNIT_X:k,UNIT_Y:r});a.ONES=e;a.UNIT_X=k;a.UNIT_Y=r;a.ZEROS=f;a.clone=c;a.create=b;a.createView=g;a.fromValues=d;a.ones=w;a.unitX=l;a.unitY=n;a.vec2f32=y;a.zeros=
x})},"esri/views/3d/webgl-engine/shaders/LineCalloutTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/attributes/VerticalOffset.glsl ../core/shaderLibrary/hud/HUD.glsl ../core/shaderLibrary/shading/MultipassGeometryTest.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/Program ../materials/internal/MaterialUtil ../../../../chunks/LineCallout.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u){e=function(t){function q(){return t.apply(this,arguments)||this}c._inheritsLoose(q,t);var z=q.prototype;z.initializeProgram=function(v){var B=q.shader.get();const A=this.configuration;B=B.build({occlusionTestEnabled:A.occlusionTestEnabled,verticalOffsetEnabled:A.verticalOffset,screenSizePerspectiveEnabled:A.screenSizePerspective,depthHudEnabled:A.depthHudEnabled,depthHudAlignStartEnabled:A.depthHudAlignStartEnabled,screenCenterOffsetUnitsEnabled:A.screenCenterOffsetUnitsEnabled,
slicePlaneEnabled:A.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,viewingMode:v.viewingMode,isDraped:!1,multipassGeometryEnabled:A.multipassGeometryEnabled});return new y.Program(v.rctx,B,r.Default3D)};z.bindPass=function(v,B){n.bindProjectionMatrix(this.program,B.camera.projectionMatrix);h.bindLineCalloutUniforms(this.program,v,B.camera.pixelRatio||1);x.bindVerticalOffsetUniforms(this.program,v,B);w.bindHUDUniforms(this.program,B);this.program.setUniform2fv("nearFar",
B.camera.nearFar);this.program.setUniform2fv("inverseViewport",B.inverseViewport);l.bindMultipassGeometryTexture(this.program,B);this.program.bindTexture(B.hudVisibilityTexture,"hudVisibilityTexture");this.program.setUniform1f("cameraGroundRelative",B.camera.aboveGround?1:-1);this.program.setUniform1f("polygonOffset",v.shaderPolygonOffset);n.bindViewport(this.program,B);this.program.setUniform1f("perDistancePixelRatio",Math.tan(B.camera.fovY/2)/(B.camera.fullViewport[2]/2));this.program.setUniformMatrix4fv("viewNormal",
B.camera.viewInverseTransposeMatrix);this.program.setUniform2f("pixelToNDC",2/B.camera.fullViewport[2],2/B.camera.fullViewport[3]);this.program.setUniform1f("lineSize",Math.ceil(v.size)*(B.camera.pixelRatio||1));p.bindScreenSizePerspective(v.screenSizePerspective,this.program,"screenSizePerspectiveAlignment")};z.bindDraw=function(v){n.bindView(this.program,v);n.bindCameraPosition(this.program,v.origin,v.camera.viewInverseTransposeMatrix);g.bindSliceUniformsWithOrigin(this.program,this.configuration,
v);this.program.rebindTextures()};z.setPipelineState=function(v){v=v?m.CompareFunction.ALWAYS:m.CompareFunction.LESS;return this.configuration.depthHudEnabled?u.makePipelineState({depthTest:{func:v},depthWrite:u.defaultDepthWriteParams}):u.makePipelineState({blending:u.separateBlendingParams(m.BlendFactor.ONE,m.BlendFactor.SRC_ALPHA,m.BlendFactor.ONE_MINUS_SRC_ALPHA,m.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:v},colorWrite:u.defaultColorWriteParams})};z.initializePipeline=function(){return this.setPipelineState(this.configuration.multipassGeometryEnabled)};
return q}(e.ShaderTechnique);e.shader=new f.ReloadableShaderModule(h.LineCalloutShader,()=>new Promise((t,q)=>a(["./LineCallout.glsl"],t,q)));f=function(t){function q(){var z=t.apply(this,arguments)||this;z.occlusionTestEnabled=!0;z.verticalOffset=!1;z.screenSizePerspective=!1;z.depthHudEnabled=!1;z.depthHudAlignStartEnabled=!1;z.screenCenterOffsetUnitsEnabled=w.HUDSpace.World;z.slicePlaneEnabled=!1;z.multipassGeometryEnabled=!1;return z}c._inheritsLoose(q,t);return q}(k.ShaderTechniqueConfiguration);
d.__decorate([k.parameter()],f.prototype,"occlusionTestEnabled",void 0);d.__decorate([k.parameter()],f.prototype,"verticalOffset",void 0);d.__decorate([k.parameter()],f.prototype,"screenSizePerspective",void 0);d.__decorate([k.parameter()],f.prototype,"depthHudEnabled",void 0);d.__decorate([k.parameter()],f.prototype,"depthHudAlignStartEnabled",void 0);d.__decorate([k.parameter({count:w.HUDSpace.COUNT})],f.prototype,"screenCenterOffsetUnitsEnabled",void 0);d.__decorate([k.parameter()],f.prototype,
"slicePlaneEnabled",void 0);d.__decorate([k.parameter()],f.prototype,"multipassGeometryEnabled",void 0);b.LineCalloutTechnique=e;b.LineCalloutTechniqueConfiguration=f;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/LineCallout.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassGeometryTest.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,d,g,x,w,l){function n(r){const y=new w.ShaderBuilder;y.include(c.AlignPixel);y.include(d.HUD,r);y.include(b.Slice,r);y.attributes.add(l.VertexAttribute.UV0,"vec2");y.vertex.uniforms.add("lineSize","float").add("pixelToNDC","vec2").add("borderSize","float").add("screenOffset","vec2");y.varyings.add("coverageSampling","vec4");y.varyings.add("lineSizes","vec2");r.multipassGeometryEnabled&&y.varyings.add("depth","float");y.vertex.code.add(x.glsl`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${r.occlusionTestEnabled?x.glsl`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${r.screenSizePerspectiveEnabled?x.glsl`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:x.glsl`
      vec2 screenOffsetScaled = screenOffset;
        `}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly
      // used to get the correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${r.multipassGeometryEnabled?"depth \x3d posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${r.depthHudEnabled?r.depthHudAlignStartEnabled?x.glsl`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:x.glsl`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${r.screenSizePerspectiveEnabled?x.glsl`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:x.glsl`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;
      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned
      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,
      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel
      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).
      float halfWholePixelSize = floor(lineSizeScaled) * 0.5;
      float halfPixelSizeInt = floor(halfWholePixelSize);

      // Sub-pixel offset if we need to grow sub-pixels to the left
      float subpixelOffset = -fract(lineSizeScaled) * float(halfWholePixelSize > 0.0);

      // Pixel offset aligning to whole pixels and adding subpixel offset if needed
      float pixelOffset = -halfPixelSizeInt + subpixelOffset;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `);y.fragment.uniforms.add("uColor","vec4");y.fragment.uniforms.add("borderColor","vec4");r.multipassGeometryEnabled&&(y.fragment.include(g.multipassGeometryTest,r),y.fragment.uniforms.add("inverseViewport","vec2"));y.fragment.code.add(x.glsl`
    void main() {
      ${r.multipassGeometryEnabled?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line
      // blends on top of the border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage
      // and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${r.depthHudEnabled?x.glsl`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:x.glsl`
      // Compute the finalRgb, but keep it pre-multiplied (for unpre-multiplied you
      // need to divide by finalAlpha). We avoid the division here by setting the
      // appropriate blending function in the material.
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      gl_FragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `);return y}function f(r,y,p){e(r,"uColor",y.color);r.setUniform1f("pixelRatio",p);r.setUniform2f("screenOffset",y.screenOffset[0]*p,y.screenOffset[1]*p);null!==y.borderColor?(e(r,"borderColor",y.borderColor),r.setUniform1f("borderSize",p)):(r.setUniform4f("borderColor",0,0,0,0),r.setUniform1f("borderSize",0))}function e(r,y,p){3===p.length?r.setUniform4f(y,p[0],p[1],p[2],1):r.setUniform4fv(y,p)}const k=Object.freeze({__proto__:null,build:n,bindLineCalloutUniforms:f});a.LineCalloutShader=k;a.bindLineCalloutUniforms=
f;a.build=n})},"esri/views/3d/layers/graphics/Graphics3DGraphicCreationContext":function(){define(function(){return function(a,b,c){this.graphic=a;this.renderingInfo=b;this.layer=c}})},"esri/views/3d/layers/graphics/graphicSymbolUtils":function(){define(["exports","./Graphics3DSymbol","./Graphics3DWebStyleSymbol"],function(a,b,c){a.getGraphics3DSymbol=function(d){return d instanceof c?d.graphics3DSymbol:d instanceof b?d:null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DSymbol":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/asyncUtils ../../../../core/maybe ../../../../core/promiseUtils ./Graphics3DGraphic ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayerFactory ./interfaces ./Loadable ./symbolComplexity".split(" "),
function(a,b,c,d,g,x,w,l,n,f){const e={renderPriority:0,renderPriorityStep:1,ignoreDrivers:!1};return function(k){function r(p,h,m){var u=k.call(this,h.schedule)||this;u._symbol=p;u._context=h;u._backgroundLayers=m;u._destroyed=!1;u.symbolLayers=[];u.referenced=0;u._extentPadding=0;return u}a._inheritsLoose(r,k);var y=r.prototype;y.doLoad=function(){var p=a._asyncToGenerator(function*(h){var m=this;let u=this._symbol.symbolLayers;this._extentPadding=0;this._backgroundLayers&&(u=this._backgroundLayers.concat(u));
const t=u.length;for(;this.symbolLayers.length<u.length;)this.symbolLayers.push(null);this.symbolLayers.length=u.length;const q=[];for(let z=0;z<t;z++){const v=u.getItemAt(z);if(!1===v.enabled)continue;e.renderPriority=1-(1+z)/t;e.renderPriorityStep=1/t;e.ignoreDrivers=v._ignoreDrivers;const B=w.make(this.symbol,v,this._context,e);q.push(d.onAbortOrThrow(h,()=>{this.symbolLayers[z]=null;B.destroy()}));this.symbolLayers[z]=B}yield b.forEach(this.symbolLayers,function(){var z=a._asyncToGenerator(function*(v,
B){if(c.isSome(v))try{yield v.load(),m._extentPadding+=Math.max(m._extentPadding,v.extentPadding)}catch{m.symbolLayers[B]=null}});return function(v,B){return z.apply(this,arguments)}}());for(const z of q)null==z?void 0:z.remove();q.length=0;d.throwIfAborted(h);if(this.symbolLayers.length&&!this.symbolLayers.some(z=>!!z))throw Error();});return function(h){return p.apply(this,arguments)}}();y.getSymbolLayerSize=function(p){p=this.symbolLayers[p];return c.isSome(p)?p.getCachedSize():null};y.createGraphics3DGraphic=
function(p,h){const m=p.graphic,u=Array(this.symbolLayers.length);for(let t=0;t<this.symbolLayers.length;t++){const q=this.symbolLayers[t];u[t]=c.isSome(q)?q.createGraphics3DGraphic(p):null}return new g(m,h||this,u,p.layer,this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null)};y.globalPropertyChanged=function(p,h){const m=this.symbolLayers.length;for(let u=0;u<m;u++){const t=
this.symbolLayers[u],q=z=>{z=z.graphics[u];return z instanceof x.Graphics3DObject3DGraphicLayer?z:null};if(c.isSome(t)&&!t.globalPropertyChanged(p,h,q))return!1}return!0};y.applyRendererDiff=function(p,h){return this.loadStatus!==n.LoadStatus.LOADED?l.ApplyRendererDiffResult.Recreate_Symbol:this.symbolLayers.reduce((m,u)=>m!==l.ApplyRendererDiffResult.Recreate_Symbol&&c.isSome(u)?Math.min(m,u.applyRendererDiff(p,h)):m,l.ApplyRendererDiffResult.Fast_Update)};y.prepareSymbolPatch=function(p){if(this.loadStatus!==
n.LoadStatus.FAILED&&"partial"===p.diff.type){var h=p.diff.diff;if(h.symbolLayers&&"partial"===h.symbolLayers.type){var m=h.symbolLayers.diff;this.symbolLayers.forEach((u,t)=>{if(!c.isNone(u)){var q=m[t];if(q){const z={diff:q,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};u.prepareSymbolLayerPatch(z);p.symbolStatePatches.push(...z.symbolLayerStatePatches);z.graphics3DGraphicPatches.length&&p.graphics3DGraphicPatches.push((v,B)=>{const A=v.graphics[t];c.isSome(A)&&z.graphics3DGraphicPatches.forEach(E=>
E(A,B))})}}})}}};y.updateGeometry=function(p,h){for(let m=0;m<this.symbolLayers.length;m++){const u=this.symbolLayers[m];if(c.isNone(u))continue;const t=p.graphics[m];if(c.isNone(t)||!u.updateGeometry(t,h))return!1}return!0};y.onRemoveGraphic=function(p){for(let h=0;h<this.symbolLayers.length;h++){const m=this.symbolLayers[h];if(c.isNone(m))continue;const u=p.graphics[h];if(c.isSome(u))m.onRemoveGraphic(u)}};y.getFastUpdateStatus=function(){let p=0,h=0,m=0;this.symbolLayers.forEach(u=>{c.isNone(u)||
(u.loadStatus===n.LoadStatus.LOADING?p++:u.isFastUpdatesEnabled()?m++:h++)});return{loading:p,slow:h,fast:m}};y.destroy=function(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{k.prototype.destroy.call(this);for(const p of this.symbolLayers)c.isSome(p)&&p.destroy();this.symbolLayers.length=0;this._destroyed=!0}};a._createClass(r,[{key:"symbol",get:function(){return this._symbol},set:function(p){this._symbol=p;for(let h=0;h<p.symbolLayers.length;h++){const m=
this.symbolLayers[h];c.isNone(m)||(m.symbol=p,m.symbolLayer=p.symbolLayers.items[h])}}},{key:"extentPadding",get:function(){return this._extentPadding}},{key:"complexity",get:function(){return f.totalSymbolComplexities(this.symbolLayers.map(p=>c.get(p,"complexity")))}},{key:"destroyed",get:function(){return this._destroyed}}]);return r}(n.Loadable)})},"esri/views/3d/layers/graphics/Graphics3DGraphic":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/asyncUtils ../../../../core/byteSizeEstimations ../../../../core/maybe ../../../../core/ObjectPool ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/Polygon ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/featureConversionUtils ./enums ./featureExpressionInfoUtils".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m){const u=new g(Array,q=>k.set(q,k.ZERO),null,10,5),t=r.create();return function(){function q(v,B,A,E,C){this.graphic=v;this.graphics3DSymbol=B;this.graphics=A;this._labelGraphics=[];this._auxiliaryGraphics=[];{var D=h.VisibilityFlag._COUNT;const F=Array(h.VisibilityGroup._COUNT);for(let G=0;G<F.length;G++)F[G]=Array(D);D=F}this._visibilityFlags=D;this._featureExpressionFeature=null;this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1};this._extent=null;
this.isElevationSource=!1;++B.referenced;this._featureExpressionFeature=C?m.createFeature(C,v,E):null;for(const F of A)d.isSome(F)&&(this.isElevationSource=this.isElevationSource||F.isElevationSource)}var z=q.prototype;z.initialize=function(v,B,A){this._layer=B;this._stage=v;this._forEachSymbolLayerGraphic(E=>{E.initialize(v,B,A);E.setVisibility(this.isVisible())})};z.destroy=function(){this._forEachSymbolLayerGraphic(v=>v.destroy());this._auxiliaryGraphics=this.graphics=null;--this.graphics3DSymbol.referenced;
this.graphics3DSymbol=null};z.clearLabelGraphics=function(){this._forEachLabelGraphic(v=>v.destroy());this._labelGraphics.length=0};z.addLabelGraphic=function(v,B,A){this._labelGraphics.push(v);v.initialize(B,A);v.setVisibility(this.isVisible(h.VisibilityGroup.LABEL))};z.addAuxiliaryGraphic=function(v){this._auxiliaryGraphics.push(v);this._layer&&(v.initialize(this._stage,this._layer),v.setVisibility(this.isVisible()))};z.isVisible=function(v=h.VisibilityGroup.GRAPHIC,B){for(let A=0;A<=v;A++){const E=
this._visibilityFlags[A];for(let C=0;C<E.length;++C)if(!1===E[C]&&C!==B)return!1}return!0};z.hasVisibilityFlag=function(v,B){return null!=this._visibilityFlags[B][v]};z.setVisibilityFlag=function(v,B,A){const E=this.isVisible(A);this._visibilityFlags[A][v]=B;const C=this.isVisible(A);if(E===C)return!1;if(A===h.VisibilityGroup.LABEL)this._forEachLabelGraphic(D=>D.setVisibility(C));else{this._forEachSymbolLayerGraphic(F=>F.setVisibility(C));const D=this.isVisible(h.VisibilityGroup.LABEL);this._forEachLabelGraphic(F=>
F.setVisibility(D))}return!0};z.clearVisibilityFlag=function(v,B=h.VisibilityGroup.GRAPHIC){return this.setVisibilityFlag(v,void 0,B)};z.computeExtent=function(v){if(!this._extent){var B=this.graphic.geometry;if(d.isNone(B))return!1;this._extent=r.create();y.computeAABR(B,this._extent);B=B.spatialReference;if(!B.equals(v)&&!e.projectBoundingRect(this._extent,B,this._extent,v))return this._extent=null,!1}return!0};z.getAsOptimizedGeometry=function(v,B){if(d.isSome(this._optimizedGeometry.geometry)&&
this._optimizedGeometry.hasZ===v&&this._optimizedGeometry.hasM===B)return this._optimizedGeometry.geometry;this._optimizedGeometry.geometry=this._convertGraphicToOptimizedGeometry(this.graphic,v,B);this._optimizedGeometry.hasZ=v;this._optimizedGeometry.hasM=B;return this._optimizedGeometry.geometry};z._convertGraphicToOptimizedGeometry=function(v,B,A){v=v.geometry;if("mesh"===v.type||"extent"===v.type)v=f.fromExtent("mesh"===v.type?v.extent:v);return p.convertFromGeometry(v,B,A)};z.computeAttachmentOrigin=
function(){const v={render:{origin:n.create(),num:0},draped:{origin:w.create(),num:0}};for(const B of this.graphics)d.isNone(B)||B.computeAttachmentOrigin(v);v.render.num&&l.scale(v.render.origin,v.render.origin,1/v.render.num);v.draped.num&&x.scale(v.draped.origin,v.draped.origin,1/v.draped.num);return v};z.getProjectedBoundingBox=function(){var v=a._asyncToGenerator(function*(B,A,E,C,D){D||(D={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]});D.boundingBox?k.empty(D.boundingBox):
D.boundingBox=k.empty();D.requiresDrapedElevation=!1;yield b.forEach(this.graphics,function(){var F=a._asyncToGenerator(function*(G){if(!d.isNone(G)){var J="draped"===G.type?A:B,I=u.acquire();G=yield G.getProjectedBoundingBox(J,E,D.screenSpaceObjects,C,I);isFinite(G[2])&&isFinite(G[5])||(D.requiresDrapedElevation=!0);G&&k.expandWithAABB(D.boundingBox,I);u.release(I)}});return function(G){return F.apply(this,arguments)}}());return k.allFinite(D.boundingBox)||r.allFinite(k.toRect(D.boundingBox,t))?
D:null});return function(B,A,E,C,D){return v.apply(this,arguments)}}();z.needsElevationUpdates=function(){for(const v of this.graphics)if(d.isSome(v)&&("object3d"===v.type||"lod-instance"===v.type)&&v.needsElevationUpdates)return!0;for(const v of this._labelGraphics)if(v&&v.needsElevationUpdates)return!0;return!1};z.alignWithElevation=function(v,B,A){this._forEachRenderedGraphic(E=>{"object3d"!==E.type&&"lod-instance"!==E.type||E.alignWithElevation(v,B,this._featureExpressionFeature,A)})};z.addObjectStateSet=
function(v,B){this._forEachSymbolLayerGraphic(A=>A.addObjectState(v,B))};z.removeObjectState=function(v){this._forEachSymbolLayerGraphic(B=>B.removeObjectState(v))};z._forEachGraphicList=function(v,B){v.forEach(A=>A&&B(A))};z._forEachSymbolLayerGraphic=function(v){this._forEachGraphicList(this.graphics,v);this._forEachGraphicList(this._auxiliaryGraphics,v)};z._forEachLabelGraphic=function(v){this._forEachGraphicList(this._labelGraphics,v)};z._forEachRenderedGraphic=function(v){this._forEachSymbolLayerGraphic(v);
this._forEachLabelGraphic(v)};a._createClass(q,[{key:"labelGraphics",get:function(){return this._labelGraphics}},{key:"extent",get:function(){return this._extent}},{key:"destroyed",get:function(){return null==this.graphics}},{key:"isDraped",get:function(){let v=!1;this._forEachSymbolLayerGraphic(B=>{"draped"===B.type&&(v=!0)});return v}},{key:"usedMemory",get:function(){let v=c.estimateAttributesObjectSize(this.graphic.attributes);this._forEachSymbolLayerGraphic(B=>{const A=B.graphics3DSymbolLayer.complexity;
d.isNone(A)||(B="draped"===B.type?A.memory.draped:A.memory,v+=B.bytesPerFeature,B.bytesPerCoordinate&&(v+=y.numVertices(this.graphic.geometry)*B.bytesPerCoordinate))});return v}}]);return q}()})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayerFactory":function(){define("exports ../../../../core/Logger ./Graphics3DExtrudeSymbolLayer ./Graphics3DIconSymbolLayer ./Graphics3DLineSymbolLayer ./Graphics3DMeshFillSymbolLayer ./Graphics3DObjectSymbolLayer ./Graphics3DPathSymbolLayer ./Graphics3DPolygonFillSymbolLayer ./Graphics3DTextSymbolLayer ./Graphics3DWaterSymbolLayer".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e){const k=b.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory"),r={icon:d.Graphics3DIconSymbolLayer,object:w.Graphics3DObjectSymbolLayer,line:g.Graphics3DLineSymbolLayer,path:l.Graphics3DPathSymbolLayer,fill:n.Graphics3DPolygonFillSymbolLayer,extrude:c.Graphics3DExtrudeSymbolLayer,text:f.Graphics3DTextSymbolLayer,water:e.Graphics3DWaterSymbolLayer},y={"mesh-3d":{fill:x.Graphics3DMeshFillSymbolLayer}};a.make=function(p,h,m,u){const t=y[p.type]&&y[p.type][h.type]||
r[h.type];return t?new t(p,h,m,u):(k.error("GraphicsLayerFactory#make",`unknown symbol type ${h.type}`),null)};a.setSymbolClass=function(p,h){r[p]=h};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DExtrudeSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Error ../../../../core/maybe ../../../../chunks/earcut ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/buffer/BufferView ../../../../chunks/vec32 ../../../../renderers/support/renderingInfoUtils ../../../ViewingMode ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ./polygonUtils ../support/edgeUtils ../../support/debugFlags ../../support/ElevationProvider ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E,C,D,F,G,J,I,O){function P(ka,ia,ea,ca){var Z=new Uint32Array(ka.length);ca=[[I.VertexAttribute.POSITION,{size:3,data:ea.positions,exclusive:!0}],[I.VertexAttribute.NORMAL,{size:3,data:ea.normals,exclusive:!0}],[I.VertexAttribute.COLOR,{size:4,data:ca,exclusive:!0}],[I.VertexAttribute.SIZE,{size:1,data:ea.heights,exclusive:!0}]];Z=[[I.VertexAttribute.POSITION,ka],[I.VertexAttribute.NORMAL,ka],[I.VertexAttribute.COLOR,Z]];ea.elevation&&(ca.push([I.VertexAttribute.MAPPOS,
{size:3,data:ea.elevation}]),Z.push([I.VertexAttribute.MAPPOS,ka]));return new G.Geometry(ca,Z,F.PrimitiveType.Triangle,ia)}function K(ka,ia,ea,ca,Z,fa,ja,la,ma,ra,va,ya,za,pa){let wa=0;var na=2*ca.count;{var qa=ca.index,ta=ca.count,Fa=ea.length/3,Ha=ma;f.copy(aa,za);const Ka=0<ya?1:-1;qa*=3;let La=Ha;za=3*La;let Ra=Ha+ta;Ha=3*Ra;for(let ab=0;ab<ta;++ab)pa&&(aa[0]=ka[qa+0],aa[1]=ka[qa+1],aa[2]=ka[qa+2],f.normalize(aa,aa)),Z[za+0]=ka[qa+0],Z[za+1]=ka[qa+1],Z[za+2]=ka[qa+2],fa[za+0]=ia[qa+0],fa[za+
1]=ia[qa+1],fa[za+2]=ia[qa+2],ja[za+0]=-Ka*aa[0],ja[za+1]=-Ka*aa[1],ja[za+2]=-Ka*aa[2],la[La]=0,Z[Ha+0]=ka[qa+0]+ya*aa[0],Z[Ha+1]=ka[qa+1]+ya*aa[1],Z[Ha+2]=ka[qa+2]+ya*aa[2],fa[Ha+0]=ia[qa+0],fa[Ha+1]=ia[qa+1],fa[Ha+2]=ia[qa+2],ja[Ha+0]=Ka*aa[0],ja[Ha+1]=Ka*aa[1],ja[Ha+2]=Ka*aa[2],la[Ra]=ya,za+=3,Ha+=3,qa+=3,La+=1,Ra+=1;za=qa=0;Ha=3*na;ka=0>ya?ha:ba;ia=0>ya?ba:ha;for(pa=0;pa<Fa;++pa)va[za+0]=ea[qa+ka[0]],va[za+1]=ea[qa+ka[1]],va[za+2]=ea[qa+ka[2]],ra[Ha+0]=ea[qa+ia[0]]+ta,ra[Ha+1]=ea[qa+ia[1]]+ta,
ra[Ha+2]=ea[qa+ia[2]]+ta,za+=3,Ha+=3,qa+=3}ma+=2*ca.count;na=0;U(Z,fa,la,ja,wa,ca.pathLengths[0],ca.count,ma,ra,na,ya);ma+=4*ca.pathLengths[0];na+=2*ca.pathLengths[0];wa+=ca.pathLengths[0];for(ea=1;ea<ca.pathLengths.length;++ea)U(Z,fa,la,ja,wa,ca.pathLengths[ea],ca.count,ma,ra,na,ya),ma+=4*ca.pathLengths[ea],na+=2*ca.pathLengths[ea],wa+=ca.pathLengths[ea]}function M(ka,ia,ea,ca,Z,fa,ja){ca[fa]=ca[ja];ja*=3;fa*=3;ka[fa+0]=ka[ja+0];ka[fa+1]=ka[ja+1];ka[fa+2]=ka[ja+2];ia[fa+0]=ia[ja+0];ia[fa+1]=ia[ja+
1];ia[fa+2]=ia[ja+2];ea[fa+0]=Z[0];ea[fa+1]=Z[1];ea[fa+2]=Z[2]}function U(ka,ia,ea,ca,Z,fa,ja,la,ma,ra,va){let ya=Z,za=Z+1,pa=Z+ja,wa=Z+ja+1,na=la,qa=la+1,ta=la+2*fa;la=la+2*fa+1;0>va&&(ya=Z+ja+1,wa=Z);ra*=3;for(let ab=0;ab<fa;++ab){ab===fa-1&&(0<va?(za=Z,wa=Z+ja):(za=Z,ya=Z+ja));var Fa=ka,Ha=ya,Ka=za,La=pa,Ra=N;Ha*=3;Ka*=3;La*=3;f.set(T,Fa[Ha++],Fa[Ha++],Fa[Ha++]);f.set(S,Fa[Ka++],Fa[Ka++],Fa[Ka++]);f.set(H,Fa[La++],Fa[La++],Fa[La++]);f.subtract(Q,S,T);f.subtract(W,H,T);f.cross(Ra,W,Q);f.normalize(Ra,
Ra);M(ka,ia,ca,ea,N,na,ya);M(ka,ia,ca,ea,N,qa,za);M(ka,ia,ca,ea,N,ta,pa);M(ka,ia,ca,ea,N,la,wa);ma[ra++]=na;ma[ra++]=ta;ma[ra++]=la;ma[ra++]=na;ma[ra++]=la;ma[ra++]=qa;ya++;za++;pa++;wa++;na+=2;qa+=2;ta+=2;la+=2}}function R(ka,ia,ea,ca){ka=ka.stageObject;const Z=ka.geometryRecords,fa=Z.length,ja="absolute-height"!==ia.mode;let la=0;const ma=ka.transformation,ra=l.invert(n.create(),ma);for(let ya=0;ya<fa;ya+=2){const za=Z[ya].geometry,pa=za.getMutableAttribute(I.VertexAttribute.POSITION).data,wa=za.vertexAttributes.get(I.VertexAttribute.SIZE).data;
var va=za.vertexAttributes.get(I.VertexAttribute.MAPPOS).data;va=new D.SamplePosition(va);const na=pa.length/3;let qa=0,ta=!1,Fa=0;const Ha=ea.spatialReference;for(let Ka=0;Ka<na;Ka++){V[0]=pa[qa];V[1]=pa[qa+1];V[2]=pa[qa+2];u.evaluateElevationInfoAtPoint(va,ea,ia,ca,X);ja&&(Fa+=X.sampledElevation);C.TESTS_DISABLE_OPTIMIZATIONS?(f.set(Y,va.array[va.offset+0],va.array[va.offset+1],X.z+wa[qa/3]),ca.toRenderCoords(Y,Ha,Y)):(f.set(Y,pa[qa+0],pa[qa+1],pa[qa+2]),f.transformMat4(Y,Y,ma),ca.setAltitude(Y,
X.z+wa[qa/3]));f.transformMat4(Y,Y,ra);pa[qa]=Y[0];pa[qa+1]=Y[1];pa[qa+2]=Y[2];const La=.01/ca.unitInMeters;if(Math.abs(V[0]-pa[qa])>=La||Math.abs(V[1]-pa[qa+1])>=La||Math.abs(V[2]-pa[qa+2])>=La)ta=!0;va.offset+=3;qa+=3}ta&&(za.invalidateBoundingInfo(),ka.geometryVertexAttrsUpdated(Z[ya]),Z[ya+1].geometry.invalidateBoundingInfo(),ka.geometryVertexAttrsUpdated(Z[ya+1]));la+=Fa/na}return la/fa}const L=["polygon","extent"];z=function(ka){function ia(ca,Z,fa,ja){ca=ka.call(this,ca,Z,fa,ja)||this;ca.ensureDrapedStatus(!1);
return ca}b._inheritsLoose(ia,ka);var ea=ia.prototype;ea.doLoad=function(){var ca=b._asyncToGenerator(function*(){if(!this._drivenProperties.size){var Z=v.validateSymbolLayerSize(this._getSymbolSize());if(Z)throw new c("graphics3dextrudesymbollayer:invalid-size",Z);}Z=d.get(this.symbolLayer,"material","color");var fa=this._getCombinedOpacityAndColor(Z);Z=e.fromArray(fa);fa=fa[3];const ja=1>fa||this.needsDrivenTransparentPass;Z={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:Z,
ambient:Z,opacity:fa,transparent:ja,cullFace:ja?F.CullFaceOptions.None:F.CullFaceOptions.Back,vertexColors:!0,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0};this._material=new O.DefaultMaterial(Z);this._bottomMaterial=new O.DefaultMaterial({...Z,cullFace:F.CullFaceOptions.Back});this._context.stage.add(this._material);this._context.stage.add(this._bottomMaterial)});return function(){return ca.apply(this,arguments)}}();ea.destroy=
function(){ka.prototype.destroy.call(this);this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))};ea.createGraphics3DGraphic=function(ca){const Z=ca.graphic;if(!this._validateGeometry(Z.geometry,L,this.symbolLayer.type))return null;const fa=this._getVertexOpacityAndColor(ca.renderingInfo,255),ja=this.setGraphicElevationContext(Z,new t.ElevationContext);return this._createAs3DShape(Z,ca.renderingInfo,fa,ja,Z.uid)};ea.layerOpacityChanged=function(ca,
Z){var fa=d.get(this.symbolLayer,"material","color");fa=this._getCombinedOpacity(fa);const ja=1>fa||this.needsDrivenTransparentPass;this._material.setParameters({opacity:fa,transparent:ja});this._bottomMaterial.setParameters({opacity:fa,transparent:ja});const la=this._getLayerOpacity();ca.forEach(ma=>{ma=Z(ma);d.isSome(ma)&&ma.layerOpacityChanged(la,this._context.isAsync)});return!0};ea.layerElevationInfoChanged=function(ca,Z){return this.updateGraphics3DGraphicElevationInfo(ca,Z,u.needsElevationUpdates3D)};
ea.slicePlaneEnabledChanged=function(ca,Z){this._material.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled});this._bottomMaterial.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled});ca.forEach(fa=>{fa=Z(fa);d.isSome(fa)&&fa.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)});return!0};ea.physicalBasedRenderingChanged=function(){this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});this._bottomMaterial.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,
isSchematic:!0});return!0};ea.pixelRatioChanged=function(){return!0};ea._getExtrusionSize=function(ca){if(ca.size&&this._drivenProperties.size){var Z;ca=null!=(Z=h.getDriverAxisSizeValue(ca.size,2))?Z:0}else ca=this._getSymbolSize();return ca/=this._context.renderCoordsHelper.unitInMeters};ea.applyRendererDiff=function(ca,Z){return this._drivenPropertiesChanged(Z)?B.ApplyRendererDiffResult.Recreate_Symbol:B.ApplyRendererDiffResult.Recreate_Graphics};ea._getSymbolSize=function(){var ca;return null!=
(ca=this.symbolLayer.size)?ca:1};ea._createAs3DShape=function(ca,Z,fa,ja,la){var ma=A.geometryAsPolygon(ca.geometry);if(d.isNone(ma))return null;ca=A.geometryToRenderInfo(ma,this._context.elevationProvider,this._context.renderCoordsHelper,ja);this._logGeometryCreationWarnings(ca,ma.rings,"rings","ExtrudeSymbol3DLayer");if(0===ma.rings.length||!ma.rings.some(Sa=>0<Sa.length))return null;var ra=v.computeCentroid(ma);if(d.isNone(ra))return null;var va=[];const ya=[],za=[],pa=r.create(),wa=n.create(),
na=e.create(),qa=this._context.renderCoordsHelper.viewingMode===m.ViewingMode.Global;qa||this._context.renderCoordsHelper.worldUpAtPosition(null,na);k.computeTranslationToOriginAndRotation(ma.spatialReference,[ra.x,ra.y,0],wa,this._context.renderCoordsHelper.spatialReference);ma=n.create();l.invert(ma,wa);ra=w.create();x.normalFromMat4(ra,ma);const {polygons:ta,mapPosition:Fa,position:Ha}=ca;var Ka=Ha.length/3;const La=new Float64Array(18*Ka),Ra=new Float64Array(18*Ka),ab=new Float64Array(18*Ka);
Ka=new Float64Array(6*Ka);let Za=0;for(let Sa=0;Sa<ta.length;++Sa){var Pa=ta[Sa];const Ua=Pa.count;if(this._context.clippingExtent&&(r.empty(pa),r.expandWithBuffer(pa,Pa.mapPosition),!r.intersectsClippingArea(pa,this._context.clippingExtent)))continue;const Ya=g.earcut(Pa.mapPosition,Pa.holeIndices,3);if(0===Ya.length)continue;const $a=new Uint32Array(6*Ua+Ya.length);var ua=new Uint32Array(Ya.length),Aa=6*Ua,Ia=3*La.BYTES_PER_ELEMENT;Ia=new y.BufferViewVec3f64(La.buffer,Za*Ia,Ia,(Za+Aa)*Ia);var Na=
3*Ra.BYTES_PER_ELEMENT;Na=new y.BufferViewVec3f64(Ra.buffer,Za*Na,Na,(Za+Aa)*Na);const sa=new Float64Array(ab.buffer,3*Za*ab.BYTES_PER_ELEMENT,3*Aa);Aa=new Float64Array(Ka.buffer,1*Za*Ka.BYTES_PER_ELEMENT,1*Aa);const Ca=this._getExtrusionSize(Z);K(Ha,Fa,Ya,Pa,Ia.typedBuffer,sa,Na.typedBuffer,Aa,0,$a,ua,Ca,na,qa);p.transformMat4(Ia,Ia,ma);p.transformMat3(Na,Na,ra);Za+=6*Ua;Pa=P($a,$a.length-ua.length,{positions:Ia.typedBuffer,elevation:sa,normals:Na.typedBuffer,heights:Aa},fa);va.push(Pa);ya.push(this._material);
za.push(n.IDENTITY);ua=P(ua,0,{positions:Ia.typedBuffer,elevation:sa,normals:Na.typedBuffer,heights:Aa},fa);va.push(ua);ya.push(this._bottomMaterial);za.push(n.IDENTITY)}if(0===va.length)return null;Z=new J.Object3D({geometries:va,materials:ya,transformations:za,metadata:{layerUid:this._context.layer.uid,graphicUid:la,isElevationSource:!0}});Z.transformation=wa;fa=E.createMaterial(this.symbolLayer,{opacity:this._getLayerOpacity()});fa=d.isSome(fa)?{baseMaterial:this._material,edgeMaterials:[fa],properties:{mergeGeometries:!0,
slicePlaneEnabled:this._context.slicePlaneEnabled}}:null;va=new q.Graphics3DObject3DGraphicLayer(this,Z,va,null,null,R,ja,fa);va.alignedSampledElevation=ca.sampledElevation;va.needsElevationUpdates=u.needsElevationUpdates3D(ja.mode);return va};return ia}(z.Graphics3DSymbolLayer);const N=e.create(),T=e.create(),S=e.create(),H=e.create(),Q=e.create(),W=e.create(),V=e.create(),Y=e.create(),aa=e.create(),X=new u.SampleElevationInfo,ba=[0,2,1],ha=[0,1,2];a.Graphics3DExtrudeSymbolLayer=z;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/chunks/earcut":function(){define(["exports"],function(a){var b={exports:{}};(function(c){(function(d){d=d();void 0!==d&&(c.exports=d)})(function(){function d(C,D,F){F=F||2;var G=D&&D.length,J=G?D[0]*F:C.length,I=g(C,0,J,F,!0),O=[];if(!I||I.next===I.prev)return O;var P;if(G){var K=I;var M=F;I=[];var U;G=0;for(U=D.length;G<U;G++){var R=D[G]*M;var L=G<U-1?D[G+1]*M:C.length;R=g(C,R,L,M,!1);R===R.next&&(R.steiner=!0);I.push(r(R))}I.sort(n);for(G=0;G<I.length;G++)M=I[G],
D=K,(K=e(M,D))?(U=z(K,M),M=x(K,K.next),U=f(U),x(U,U.next),M=f(M),K=f(D===K?M:D)):K=D,K=x(K,K.next);I=K}if(C.length>80*F){var N=P=C[0];var T=G=C[1];for(M=F;M<J;M+=F)D=C[M],K=C[M+1],D<N&&(N=D),K<T&&(T=K),D>P&&(P=D),K>G&&(G=K);P=Math.max(P-N,G-T);P=0!==P?1/P:0}w(I,O,F,N,T,P);return O}function g(C,D,F,G,J){if(J===0<E(C,D,F,G))for(J=D;J<F;J+=G)var I=v(J,C[J],C[J+1],I);else for(J=F-G;J>=D;J-=G)I=v(J,C[J],C[J+1],I);I&&h(I,I.next)&&(C=I.next,B(I),I=C);return I}function x(C,D){if(!C)return C;D||(D=C);do{var F=
!1;if(C.steiner||!h(C,C.next)&&0!==p(C.prev,C,C.next))C=C.next;else{D=C.prev;B(C);C=D;if(C===C.next)break;F=!0}}while(F||C!==D);return D}function w(C,D,F,G,J,I,O){if(C){if(!O&&I){var P=C,K=P;do null===K.z&&(K.z=k(K.x,K.y,G,J,I)),K.prevZ=K.prev,K=K.nextZ=K.next;while(K!==P);K.prevZ.nextZ=null;K.prevZ=null;P=K;var M,U,R,L,N=1;do{K=P;var T=P=null;for(U=0;K;){U++;var S=K;for(M=R=0;M<N&&(R++,S=S.nextZ,S);M++);for(L=N;0<R||0<L&&S;)0!==R&&(0===L||!S||K.z<=S.z)?(M=K,K=K.nextZ,R--):(M=S,S=S.nextZ,L--),T?T.nextZ=
M:P=M,M.prevZ=T,T=M;K=S}T.nextZ=null;N*=2}while(1<U)}for(P=C;C.prev!==C.next;){K=C.prev;S=C.next;if(I)T=l(C,G,J,I);else a:if(T=C,U=T.prev,R=T,N=T.next,0<=p(U,R,N))T=!1;else{for(M=T.next.next;M!==T.prev;){if(y(U.x,U.y,R.x,R.y,N.x,N.y,M.x,M.y)&&0<=p(M.prev,M,M.next)){T=!1;break a}M=M.next}T=!0}if(T)D.push(K.i/F),D.push(C.i/F),D.push(S.i/F),B(C),P=C=S.next;else if(C=S,C===P){if(!O)w(x(C),D,F,G,J,I,1);else if(1===O){C=x(C);O=D;P=F;K=C;do S=K.prev,T=K.next.next,!h(S,T)&&m(S,K,K.next,T)&&q(S,T)&&q(T,S)&&
(O.push(S.i/P),O.push(K.i/P),O.push(T.i/P),B(K),B(K.next),K=C=T),K=K.next;while(K!==C);C=x(K);w(C,D,F,G,J,I,2)}else if(2===O)a:{O=C;do{for(P=O.next.next;P!==O.prev;){if(K=O.i!==P.i){T=T=T=T=void 0;K=O;S=P;if(T=K.next.i!==S.i&&K.prev.i!==S.i){b:{T=K;do{if(T.i!==K.i&&T.next.i!==K.i&&T.i!==S.i&&T.next.i!==S.i&&m(T,T.next,K,S)){T=!0;break b}T=T.next}while(T!==K);T=!1}T=!T}if(T){if(T=q(K,S)&&q(S,K)){T=K;U=!1;R=(K.x+S.x)/2;N=(K.y+S.y)/2;do T.y>N!==T.next.y>N&&T.next.y!==T.y&&R<(T.next.x-T.x)*(N-T.y)/(T.next.y-
T.y)+T.x&&(U=!U),T=T.next;while(T!==K);T=U}T=T&&(p(K.prev,K,S.prev)||p(K,S.prev,S))||h(K,S)&&0<p(K.prev,K,K.next)&&0<p(S.prev,S,S.next)}K=T}if(K){C=z(O,P);O=x(O,O.next);C=x(C,C.next);w(O,D,F,G,J,I);w(C,D,F,G,J,I);break a}P=P.next}O=O.next}while(O!==C)}break}}}}function l(C,D,F,G){var J=C.prev,I=C.next;if(0<=p(J,C,I))return!1;var O=J.x>C.x?J.x>I.x?J.x:I.x:C.x>I.x?C.x:I.x,P=J.y>C.y?J.y>I.y?J.y:I.y:C.y>I.y?C.y:I.y,K=k(J.x<C.x?J.x<I.x?J.x:I.x:C.x<I.x?C.x:I.x,J.y<C.y?J.y<I.y?J.y:I.y:C.y<I.y?C.y:I.y,D,
F,G);D=k(O,P,D,F,G);F=C.prevZ;for(G=C.nextZ;F&&F.z>=K&&G&&G.z<=D;){if(F!==C.prev&&F!==C.next&&y(J.x,J.y,C.x,C.y,I.x,I.y,F.x,F.y)&&0<=p(F.prev,F,F.next))return!1;F=F.prevZ;if(G!==C.prev&&G!==C.next&&y(J.x,J.y,C.x,C.y,I.x,I.y,G.x,G.y)&&0<=p(G.prev,G,G.next))return!1;G=G.nextZ}for(;F&&F.z>=K;){if(F!==C.prev&&F!==C.next&&y(J.x,J.y,C.x,C.y,I.x,I.y,F.x,F.y)&&0<=p(F.prev,F,F.next))return!1;F=F.prevZ}for(;G&&G.z<=D;){if(G!==C.prev&&G!==C.next&&y(J.x,J.y,C.x,C.y,I.x,I.y,G.x,G.y)&&0<=p(G.prev,G,G.next))return!1;
G=G.nextZ}return!0}function n(C,D){return C.x-D.x}function f(C){if(C.next.prev===C)return C;let D=C;do{const F=D.next;if(F.prev===D||F===D||F===C)break;D=F}while(1);return D}function e(C,D){var F=D,G=C.x,J=C.y,I=-Infinity;do{if(J<=F.y&&J>=F.next.y&&F.next.y!==F.y){var O=F.x+(J-F.y)*(F.next.x-F.x)/(F.next.y-F.y);if(O<=G&&O>I){I=O;if(O===G){if(J===F.y)return F;if(J===F.next.y)return F.next}var P=F.x<F.next.x?F:F.next}}F=F.next}while(F!==D);if(!P)return null;if(G===I)return P;D=P;O=P.x;var K=P.y,M=Infinity;
F=P;do{if(G>=F.x&&F.x>=O&&G!==F.x&&y(J<K?G:I,J,O,K,J<K?I:G,J,F.x,F.y)){var U=Math.abs(J-F.y)/(G-F.x);var R;if((R=q(F,C))&&!(R=U<M)&&(R=U===M)&&!(R=F.x>P.x)&&(R=F.x===P.x)){R=P;var L=F;R=0>p(R.prev,R,L.prev)&&0>p(L.next,R,R.next)}R&&(P=F,M=U)}F=F.next}while(F!==D);return P}function k(C,D,F,G,J){C=32767*(C-F)*J;D=32767*(D-G)*J;C=(C|C<<8)&16711935;C=(C|C<<4)&252645135;C=(C|C<<2)&858993459;D=(D|D<<8)&16711935;D=(D|D<<4)&252645135;D=(D|D<<2)&858993459;return(C|C<<1)&1431655765|((D|D<<1)&1431655765)<<1}
function r(C){var D=C,F=C;do{if(D.x<F.x||D.x===F.x&&D.y<F.y)F=D;D=D.next}while(D!==C);return F}function y(C,D,F,G,J,I,O,P){return 0<=(J-O)*(D-P)-(C-O)*(I-P)&&0<=(C-O)*(G-P)-(F-O)*(D-P)&&0<=(F-O)*(I-P)-(J-O)*(G-P)}function p(C,D,F){return(D.y-C.y)*(F.x-D.x)-(D.x-C.x)*(F.y-D.y)}function h(C,D){return C.x===D.x&&C.y===D.y}function m(C,D,F,G){var J=t(p(C,D,F)),I=t(p(C,D,G)),O=t(p(F,G,C)),P=t(p(F,G,D));return J!==I&&O!==P||0===J&&u(C,F,D)||0===I&&u(C,G,D)||0===O&&u(F,C,G)||0===P&&u(F,D,G)?!0:!1}function u(C,
D,F){return D.x<=Math.max(C.x,F.x)&&D.x>=Math.min(C.x,F.x)&&D.y<=Math.max(C.y,F.y)&&D.y>=Math.min(C.y,F.y)}function t(C){return 0<C?1:0>C?-1:0}function q(C,D){return 0>p(C.prev,C,C.next)?0<=p(C,D,C.next)&&0<=p(C,C.prev,D):0>p(C,D,C.prev)||0>p(C,C.next,D)}function z(C,D){var F=new A(C.i,C.x,C.y),G=new A(D.i,D.x,D.y),J=C.next,I=D.prev;C.next=D;D.prev=C;F.next=J;J.prev=F;G.next=F;F.prev=G;I.next=G;G.prev=I;return G}function v(C,D,F,G){C=new A(C,D,F);G?(C.next=G.next,C.prev=G,G.next.prev=C,G.next=C):
(C.prev=C,C.next=C);return C}function B(C){C.next.prev=C.prev;C.prev.next=C.next;C.prevZ&&(C.prevZ.nextZ=C.nextZ);C.nextZ&&(C.nextZ.prevZ=C.prevZ)}function A(C,D,F){this.i=C;this.x=D;this.y=F;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}function E(C,D,F,G){for(var J=0,I=F-G;D<F;D+=G)J+=(C[I]-C[D])*(C[D+1]+C[I+1]),I=D;return J}d.deviation=function(C,D,F,G){var J=D&&D.length,I=Math.abs(E(C,0,J?D[0]*F:C.length,F));if(J){J=0;for(var O=D.length;J<O;J++)I-=Math.abs(E(C,D[J]*F,J<
O-1?D[J+1]*F:C.length,F))}for(J=D=0;J<G.length;J+=3){O=G[J]*F;var P=G[J+1]*F,K=G[J+2]*F;D+=Math.abs((C[O]-C[K])*(C[P+1]-C[O+1])-(C[O]-C[P])*(C[K+1]-C[O+1]))}return 0===I&&0===D?0:Math.abs((D-I)/I)};d.flatten=function(C){for(var D=C[0][0].length,F={vertices:[],holes:[],dimensions:D},G=0,J=0;J<C.length;J++){for(var I=0;I<C[J].length;I++)for(var O=0;O<D;O++)F.vertices.push(C[J][I][O]);0<J&&(G+=C[J-1].length,F.holes.push(G))}return F};return d})})(b);a.earcut=b.exports})},"esri/chunks/vec32":function(){define(["exports",
"../geometry/support/buffer/math/common"],function(a,b){function c(n,f,e){if(n.count!==f.count)b.mathLogger.error("source and destination buffers need to have the same number of elements");else{var k=n.count,r=e[0],y=e[1],p=e[2],h=e[4],m=e[5],u=e[6],t=e[8],q=e[9],z=e[10],v=e[12],B=e[13];e=e[14];var A=n.typedBuffer;n=n.typedBufferStride;var E=f.typedBuffer;f=f.typedBufferStride;for(let D=0;D<k;D++){const F=D*n;var C=D*f;const G=E[C],J=E[C+1];C=E[C+2];A[F]=r*G+h*J+t*C+v;A[F+1]=y*G+m*J+q*C+B;A[F+2]=
p*G+u*J+z*C+e}}}function d(n,f,e){if(n.count!==f.count)b.mathLogger.error("source and destination buffers need to have the same number of elements");else{var k=n.count,r=e[0],y=e[1],p=e[2],h=e[3],m=e[4],u=e[5],t=e[6],q=e[7];e=e[8];var z=n.typedBuffer;n=n.typedBufferStride;var v=f.typedBuffer;f=f.typedBufferStride;for(let A=0;A<k;A++){const E=A*n;var B=A*f;const C=v[B],D=v[B+1];B=v[B+2];z[E]=r*C+h*D+t*B;z[E+1]=y*C+m*D+q*B;z[E+2]=p*C+u*D+e*B}}}function g(n,f,e){const k=Math.min(n.count,f.count),r=n.typedBuffer;
n=n.typedBufferStride;const y=f.typedBuffer;f=f.typedBufferStride;for(let p=0;p<k;p++){const h=p*n,m=p*f;r[h]=e*y[m];r[h+1]=e*y[m+1];r[h+2]=e*y[m+2]}}function x(n,f){const e=Math.min(n.count,f.count),k=n.typedBuffer;n=n.typedBufferStride;const r=f.typedBuffer;f=f.typedBufferStride;for(let h=0;h<e;h++){const m=h*n;var y=h*f;const u=r[y],t=r[y+1];y=r[y+2];var p=Math.sqrt(u*u+t*t+y*y);0<p&&(p=1/p,k[m]=p*u,k[m+1]=p*t,k[m+2]=p*y)}}function w(n,f,e){const k=Math.min(n.count,f.count),r=n.typedBuffer;n=n.typedBufferStride;
const y=f.typedBuffer;f=f.typedBufferStride;for(let p=0;p<k;p++){const h=p*n,m=p*f;r[h]=y[m]>>e;r[h+1]=y[m+1]>>e;r[h+2]=y[m+2]>>e}}const l=Object.freeze({__proto__:null,transformMat4:c,transformMat3:d,scale:g,normalize:x,shiftRight:w});a.normalize=x;a.scale=g;a.shiftRight=w;a.transformMat3=d;a.transformMat4=c;a.vec3=l})},"esri/geometry/support/buffer/math/common":function(){define(["exports","../../../../core/Logger"],function(a,b){b=b.getLogger("esri.views.3d.support.buffer.math");a.mathLogger=b;
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/renderers/support/renderingInfoUtils":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../Color","../../core/maybe","../visualVariables/support/visualVariableUtils"],function(a,b,c,d,g){function x(f,e){if(!f||f.symbol)return null;e=e&&e.renderer;return f&&d.isSome(e)&&e.getObservationRenderer?e.getObservationRenderer(f):e}function w(f,e){return l.apply(this,arguments)}function l(){l=b._asyncToGenerator(function*(f,
e){if(d.isSome(f.symbol))return f.symbol;const k=x(f,e);return d.isSome(k)&&k.getSymbolAsync(f,{...e,abortOptions:{signal:e.signal}})});return l.apply(this,arguments)}function n(){n=b._asyncToGenerator(function*(f,e){var k=x(f,e),r=yield w(f,e);if(!r)return null;r={renderer:k,symbol:r};if(!(k&&"visualVariables"in k&&k.visualVariables))return r;e=g.getVisualVariableValues(k,f,e);f=["proportional","proportional","proportional"];for(const {variable:y,value:p}of e)"color"===y.type?r.color=c.toUnitRGBA(p):
"size"===y.type?"outline"===y.target?r.outlineSize=p:(e=y.axis,k=y.useSymbolValue?"symbol-value":p,"width"===e?f[0]=k:"depth"===e?f[1]=k:"height"===e?f[2]=k:f[0]="width-and-depth"===e?f[1]=k:f[1]=f[2]=k):"opacity"===y.type?r.opacity=p:"rotation"===y.type&&"tilt"===y.axis?r.tilt=p:"rotation"===y.type&&"roll"===y.axis?r.roll=p:"rotation"===y.type&&(r.heading=p);if(isFinite(f[0])||isFinite(f[1])||isFinite(f[2]))r.size=f;return r});return n.apply(this,arguments)}a.getDriverAxisSizeValue=function(f,e=
0){f=f[e];return"number"===typeof f&&isFinite(f)?f:null};a.getDriverAxisSizeValueAny=function(f){for(let e=0;3>e;e++){const k=f[e];if("number"===typeof k)return isFinite(k)?k:0}return 0};a.getRenderer=x;a.getRenderingInfo=function(f,e){const k=x(f,e);if(d.isSome(f.symbol))var r=f.symbol;else r=x(f,e),r=d.isSome(r)&&"dot-density"!==r.type?r.getSymbol(f,e):null;if(d.isNone(r))return null;r={renderer:k,symbol:r};if(d.isNone(k)||!("visualVariables"in k)||!k.visualVariables)return r;e=g.getVisualVariableValues(k,
f,e);f=["proportional","proportional","proportional"];for(const {variable:y,value:p}of e)switch(y.type){case "color":r.color=p.toRgba();break;case "size":if("outline"===y.target)r.outlineSize=p;else switch(e=y.useSymbolValue?"symbol-value":p,y.axis){case "width":f[0]=e;break;case "depth":f[1]=e;break;case "height":f[2]=e;break;case "width-and-depth":f[0]=f[1]=e;break;default:f[0]=f[1]=f[2]=e}break;case "opacity":r.opacity=p;break;case "rotation":switch(y.axis){case "tilt":r.tilt=p;break;case "roll":r.roll=
p;break;default:r.heading=p}}if("proportional"!==f[0]||"proportional"!==f[1]||"proportional"!==f[2])r.size=f;return r};a.getRenderingInfoAsync=function(f,e){return n.apply(this,arguments)};a.getSymbolAsync=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/polygonUtils":function(){define("exports ../../../../geometry ../../../../core/maybe ../../../../geometry/projection ../../../../geometry/support/triangulationUtils ./elevationAlignmentUtils ../../terrain/OverlayRenderer ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/VertexAttribute ../../../../geometry/Extent ../../../../geometry/Polygon".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e){function k(y,p,h){const m=[];for(const {index:u,count:t}of y){if(1>=t)continue;y=3*u;const q=y+3*t;m.push({index:u,count:t,position:p.subarray(y,q),mapPosition:h?h.subarray(y,q):void 0})}return m}function r(y,p,h){const m=[];for(const {index:u,count:t,holeIndices:q,pathLengths:z}of y){if(1>=t)continue;y=3*u;const v=y+3*t,B=q.map(A=>A-u);m.push({index:u,count:t,holeIndices:B,pathLengths:z,position:p.subarray(y,v),mapPosition:h?h.subarray(y,v):void 0})}return m}a.createColorGeometry=
function(y){const p=[[n.VertexAttribute.POSITION,y.indices]],h=[[n.VertexAttribute.POSITION,{size:3,data:y.attributeData.position,exclusive:!0}]];c.isSome(y.attributeData.color)&&(h.push([n.VertexAttribute.COLOR,{size:4,data:y.attributeData.color,exclusive:!0}]),p.push([n.VertexAttribute.COLOR,new Uint32Array(y.indices.length)]));c.isSome(y.attributeData.uvMapSpace)&&(h.push([n.VertexAttribute.UVMAPSPACE,{size:4,data:y.attributeData.uvMapSpace,exclusive:!0}]),p.push([n.VertexAttribute.UVMAPSPACE,
y.indices]));c.isSome(y.attributeData.boundingRect)&&(h.push([n.VertexAttribute.BOUNDINGRECT,{size:9,data:y.attributeData.boundingRect,exclusive:!0}]),p.push([n.VertexAttribute.BOUNDINGRECT,y.indices]));c.isSome(y.attributeData.mapPosition)&&(h.push([n.VertexAttribute.MAPPOS,{size:3,data:y.attributeData.mapPosition,exclusive:!0}]),p.push([n.VertexAttribute.MAPPOS,y.indices]));return new l.Geometry(h,p)};a.createWaterGeometry=function(y){const p=[[n.VertexAttribute.POSITION,y.indices],[n.VertexAttribute.UV0,
y.indices]],h=[[n.VertexAttribute.POSITION,{size:3,data:y.attributeData.position,exclusive:!0}],[n.VertexAttribute.UV0,{size:2,data:y.attributeData.uv0,exclusive:!0}]];c.isSome(y.attributeData.mapPosition)&&(h.push([n.VertexAttribute.MAPPOS,{size:3,data:y.attributeData.mapPosition,exclusive:!0}]),p.push([n.VertexAttribute.MAPPOS,y.indices]));return new l.Geometry(h,p)};a.geometryAsPolygon=function(y){switch(y.type){case "extent":if(y instanceof f)return e.fromExtent(y);break;case "polygon":return y}return null};
a.geometryToRenderInfo=function(y,p,h,m){const u=g.pathsToTriangulationInfo(y.rings,y.hasZ,g.CounterClockwiseMode.CCW_IS_HOLE),t=new Float64Array(u.position.length);y=x.applyPerVertexElevationAlignment(u.position,y.spatialReference,0,t,0,u.position,0,u.position.length/3,p,h,m);p=null!=y;return{position:u.position,mapPosition:t,polygons:r(u.polygons,u.position,t),outlines:k(u.outlines,u.position,t),projectionSuccess:p,sampledElevation:y}};a.geometryToRenderInfoDraped=function(y,p){const h=g.pathsToTriangulationInfo(y.rings,
!1,g.CounterClockwiseMode.CCW_IS_HOLE);y=d.projectBuffer(h.position,y.spatialReference,0,h.position,p,0,h.position.length/3);for(p=2;p<h.position.length;p+=3)h.position[p]=w.DRAPED_Z;return{position:h.position,polygons:r(h.polygons,h.position),outlines:k(h.outlines,h.position),projectionSuccess:y}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/triangulationUtils":function(){define(["exports","../../chunks/earcut","./coordsUtils","./meshUtils/deduplicate"],function(a,b,
c,d){function g(l,n,f){if(1===l.length)return l[0];n=new Float64Array(n);f=new Uint32Array(f);let e=0,k=0,r=0;for(const y of l){for(l=0;l<y.position.length;l++)n[e++]=y.position[l];for(l=0;l<y.faces.length;l++)f[k++]=y.faces[l]+r;r=e/3}return{position:n,faces:f}}function x(l,n,f){const e=l.length,k=Array(e),r=Array(e),y=Array(e);let p=0,h=0,m=0;var u=0;for(var t=0;t<e;++t)u+=l[t].length;u=new Float64Array(3*u);t=0;for(let B=e-1;0<=B;B--){var q=l[B],z=f===a.CounterClockwiseMode.CCW_IS_HOLE?!c.isClockwise(q,
!1,!1):!1;if(z&&1!==e)k[p++]=q;else{var v=q.length;for(let A=0;A<p;++A)v+=k[A].length;v={index:t,pathLengths:Array(p+1),count:v,holeIndices:Array(p)};v.pathLengths[0]=q.length;0<q.length&&(y[m++]={index:t,count:q.length});t=z?w(q,q.length-1,-1,u,t,q.length,n):w(q,0,1,u,t,q.length,n);for(q=0;q<p;++q)z=k[q],v.holeIndices[q]=t,v.pathLengths[q+1]=z.length,0<z.length&&(y[m++]={index:t,count:z.length}),t=w(z,0,1,u,t,z.length,n);p=0;0<v.count&&(r[h++]=v)}}for(l=0;l<p;++l)f=k[l],0<f.length&&(y[m++]={index:t,
count:f.length}),t=w(f,0,1,u,t,f.length,n);h<e&&(r.length=h);m<e&&(y.length=m);return{position:u,polygons:r,outlines:y}}function w(l,n,f,e,k,r,y){k*=3;for(let p=0;p<r;++p){const h=l[n];e[k++]=h[0];e[k++]=h[1];e[k++]=y?h[2]:0;n+=f}return k/3}a.CounterClockwiseMode=void 0;(function(l){l[l.NONE=0]="NONE";l[l.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(a.CounterClockwiseMode||(a.CounterClockwiseMode={}));a.pathsToTriangulationInfo=x;a.triangulate=function(l){l=x(l.rings,l.hasZ,a.CounterClockwiseMode.CCW_IS_HOLE);
const n=[];let f=0,e=0;for(var k of l.polygons){const y=k.index,p=new Float64Array(l.position.buffer,3*y*l.position.BYTES_PER_ELEMENT,3*k.count);var r=k.holeIndices.map(h=>h-y);r=new Uint32Array(b.earcut(p,r,3));n.push({position:p,faces:r});f+=p.length;e+=r.length}k=g(n,f,e);l=d.deduplicate(k.position.buffer,6,{originalIndices:k.faces});k.position=new Float64Array(l.buffer);k.faces=l.indices;return k};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/meshUtils/deduplicate":function(){define(["exports",
"../../../core/mathUtils"],function(a,b){let c=null;a.deduplicate=function(d,g,x){var w,l=d.byteLength/(4*g),n=new Uint32Array(d,0,l*g);d=new Uint32Array(l);var f=null!=(w=null==x?void 0:x.minReduction)?w:0;const e=(w=(null==x?void 0:x.originalIndices)||null)?w.length:0;var k=(null==x?void 0:x.componentOffsets)||null;x=0;if(k)for(var r=0;r<k.length-1;r++){var y=k[r+1]-k[r];y>x&&(x=y)}else x=l;var p=Math.floor(1.1*x)+1;if(null==c||c.length<2*p)c=new Uint32Array(b.nextHighestPowerOfTwo(2*p));for(x=
0;x<2*p;x++)c[x]=0;x=0;y=(r=!!k&&!!w)?e:l;var h=r?new Uint32Array(e):null,m=0!==f?Math.ceil(7.84*1.96/(f*f)*f*(1-f)):y,u=1,t=k?k[1]:y;for(var q=0;q<y;q++){if(q===m){var z=1-x/q;if(z+1.96*Math.sqrt(z*(1-z)/q)<f)return null;m*=2}if(q===t){for(t=0;t<2*p;t++)c[t]=0;if(w)for(t=k[u-1];t<k[u];t++)h[t]=d[w[t]];t=k[++u]}z=r?w[q]:q;const E=z*g;var v=0;for(var B=0;B<g;B++)v=n[E+B]+v|0,v=v+(v<<11)+(v>>>2)|0;v>>>=0;B=v%p;let C=x;for(;0!==c[2*B+1];){if(c[2*B]===v){const D=c[2*B+1]-1;var A=D*g;a:{for(let F=0;F<
g;F++)if(n[E+F]!==n[A+F]){A=!1;break a}A=!0}if(A){C=d[D];break}}B++;B>=p&&(B-=p)}C===x&&(c[2*B]=v,c[2*B+1]=z+1,x++);d[z]=C}if(0!==f&&1-x/l<f)return null;if(r){for(l=k[u-1];l<h.length;l++)h[l]=d[w[l]];d=h}l=new Uint32Array(g*x);x=0;for(u=0;u<y;u++)if(d[u]===x){f=n;k=(r?w[u]:u)*g;p=l;h=x*g;m=g;for(q=0;q<m;q++)p[h+q]=f[k+q];x++}if(w&&!r){g=new Uint32Array(e);for(n=0;n<g.length;n++)g[n]=d[w[n]];d=g}return{buffer:l.buffer,indices:d,uniqueCount:x}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/OverlayRenderer":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Evented ../../../core/Handles ../../../core/Logger ../../../core/MapUtils ../../../core/maybe ../../../core/PooledArray ../../../core/SetUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4 ../../../chunks/vec2f64 ../../../chunks/vec3f64 ../../../chunks/mat4f64 ../../ViewingMode ../layers/interfaces ../support/debugFlags ./interfaces ./Overlay ./OverlayFramebufferObject ./OverlayRenderTarget ../webgl-engine/core/shaderTechnique/ShaderTechniqueRepository ../webgl-engine/lib/AutoDisposable ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/Camera ../webgl-engine/lib/DrapedHeatmapRenderer ../webgl-engine/lib/GLMaterialRepository ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/GridLocalOriginFactory ../webgl-engine/lib/Intersector ../webgl-engine/lib/IntersectorInterfaces ../webgl-engine/lib/Material ../webgl-engine/lib/ModelDirtyTypes ../webgl-engine/lib/RenderContext ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/SortedRenderGeometryRenderer ../webgl-engine/lib/TextureTechnique ../webgl-engine/lighting/Lightsources ../webgl-engine/lighting/SceneLighting ../webgl-engine/materials/StippleTextureRepository ../../../chunks/Compositing.glsl ../webgl-engine/shaders/CompositingTechnique ../../support/Scheduler ../../webgl/enums ../../webgl/Texture ../../webgl/Util".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E,C,D,F,G,J,I,O,P,K,M,U,R,L,N,T,S,H,Q,W,V,Y,aa,X,ba,ha,ka,ia,ea,ca){function Z(za,pa,wa,na,qa,ta,Fa){const Ha={layerUid:ta,graphicUid:Fa,triangleNr:pa};pa=Ka=>{Ka.set(L.IntersectorType.OVERLAY,Ha,za.dist,za.normal,za.transformation,wa,na)};(null==qa.results.min.drapedLayerOrder||wa>=qa.results.min.drapedLayerOrder)&&(null==qa.results.min.dist||qa.results.ground.dist<=qa.results.min.dist)&&pa(qa.results.min);qa.options.store!==L.StoreResults.MIN&&
(null==qa.results.max.drapedLayerOrder||wa<qa.results.max.drapedLayerOrder)&&(null==qa.results.max.dist||qa.results.ground.dist>qa.results.max.dist)&&pa(qa.results.max);qa.options.store===L.StoreResults.ALL&&(ta=R.newIntersectorResult(qa.ray),pa(ta),qa.results.all.push(ta))}const fa=w.getLogger("esri.views.3d.webgl-engine.lib.OverlayRenderer");a.OverlayRenderer=function(za){function pa(na){na=za.call(this,na)||this;na._overlays=null;na._overlayRenderTarget=null;na._hasHighlights=!1;na._rendersOccluded=
!1;na._hasWater=!1;na._lighting=new aa.SceneLighting;na._handles=new x;na._frameTask=ka.ImmediateTask;na._layerRenderers=new Map;na._sortedLayerRenderersDirty=!1;na._sortedLayerRenderers=new f;na._geometries=new Map;na.worldToPCSRatio=1;na.events=new g;na.longitudeCyclical=null;return na}b._inheritsLoose(pa,za);var wa=pa.prototype;wa.initialize=function(){const na=this.view._stage.renderView;this._rctx=na.renderingContext;this._renderContext=new S.OverlayRenderContext(this._rctx);const qa=na.waterTextureRepository;
this._stippleTextureRepository=new X.StippleTextureRepository(na.renderingContext);this._shaderTechniqueRepository=new G.ShaderTechniqueRepository({rctx:this._rctx,viewingMode:v.ViewingMode.Local,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:qa});this._handles.add([k.init(qa,"loadingState",()=>this.events.emit("content-changed")),k.init(this,"spatialReference",ta=>this._localOrigins=new U.GridLocalOriginFactory(ta))]);this._materialRepository=new K.GLMaterialRepository(na.textureRepository,
this._shaderTechniqueRepository,ta=>{0<(ta.renderOccluded&ya)!==this._rendersOccluded&&this._updateRendersOccluded();this.events.emit("content-changed");this.notifyChange("updating")},()=>this.events.emit("content-changed"));this._lighting.groundLightingFactor=1;this._lighting.globalFactor=0;this._lighting.set([new Y.AmbientLight(q.fromValues(1,1,1))]);this._bindParameters={slot:Q.RenderSlot.DRAPED_MATERIAL,highlightDepthTexture:M.createEmptyDepthTexture(this._rctx),camera:ma,inverseViewport:t.create(),
origin:null,screenToWorldRatio:null,screenToPCSRatio:null,shadowMappingEnabled:!1,slicePlane:null,ssaoEnabled:!1,hasOccludees:!1,linearDepthTexture:null,lastFrameColorTexture:null,reprojectionMatrix:z.IDENTITY,ssrEnabled:!1,lighting:this._lighting,transparencyPassType:I.TransparencyPassType.NONE,terrainLinearDepthTexture:null,geometryLinearDepthTexture:null,multipassTerrainEnabled:!1,cullAboveGround:!1,multipassGeometryEnabled:!1,highlightColorTexture:null,cloudsCompositionParams:null,hasFillLights:!0};
this._frameTask=this.view.resourceController.scheduler.registerTask(ka.TaskPriority.STAGE,this);this._handles.add(this._frameTask)};wa.dispose=function(){this._handles.destroy();this._layerRenderers.forEach(na=>na.destroy());this._layerRenderers.clear();this._debugTextureTechnique=n.releaseMaybe(this._debugTextureTechnique);this._debugPatternTexture=n.disposeMaybe(this._debugPatternTexture);this._bindParameters.highlightDepthTexture=n.disposeMaybe(this._bindParameters.highlightDepthTexture);this._shaderTechniqueRepository=
n.disposeMaybe(this._shaderTechniqueRepository);this._temporaryFBO=n.disposeMaybe(this._temporaryFBO);this._quadVAO=n.disposeMaybe(this._quadVAO);this.disposeOverlays()};wa.collectUnusedRenderTargetMemory=function(na){let qa=!1;if(n.isSome(this._overlayRenderTarget))for(const ta of this._overlayRenderTarget.renderTargets)qa=this._overlayRenderTarget.validateUsageForTarget(this.overlays[0].validTargets[ta.type]||!this.overlays[1].validTargets[ta.type],ta,na)||qa;return qa};wa.ensureDrapeTargets=function(na){n.isSome(this._overlays)&&
this._overlays.forEach(qa=>{qa.hasTargetWithoutRasterImage=e.someSet(na,ta=>ta.drapeTargetType===B.DrapeTargetType.WithoutRasterImage)})};wa.ensureDrapeSources=function(na){n.isSome(this._overlays)&&this._overlays.forEach(qa=>{qa.hasDrapedFeatureSource=l.someMap(na,(ta,Fa)=>Fa.drapeSourceType===B.DrapeSourceType.Features);qa.hasDrapedRasterSource=l.someMap(na,(ta,Fa)=>Fa.drapeSourceType===B.DrapeSourceType.RasterImage)})};wa.ensureOverlays=function(na,qa){n.isNone(this._overlays)&&(this._overlayRenderTarget=
new F.OverlayRenderTarget(this._rctx),this._overlays=[new C.Overlay(E.OverlayIndex.INNER,this._overlayRenderTarget),new C.Overlay(E.OverlayIndex.OUTER,this._overlayRenderTarget)]);this.ensureDrapeTargets(na);this.ensureDrapeSources(qa)};wa.disposeOverlays=function(){this._overlays=null;this._overlayRenderTarget=n.disposeMaybe(this._overlayRenderTarget);this.events.emit("textures-disposed")};wa.runTask=function(na,qa=()=>!0){this._frameTask.processQueue(na);na.done||this._processLayers(na,qa)};wa._processLayers=
function(na,qa){let ta=!1;for(const [Fa,Ha]of this._layerRenderers){if(na.done)break;if(Fa.destroyed||qa(Fa))Ha.commitChanges()&&(ta=!0,na.madeProgress()),Ha.isEmpty&&(this._sortedLayerRenderersDirty=ta=!0,this._layerRenderers.delete(Fa),this._handles.remove(Fa),Ha.destroy())}this._updateSortedLayerRenderers();ta&&(n.isSome(this._overlays)&&0===this._layerRenderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),
this._updateHasWater())};wa.processSyncLayers=function(){this._processLayers(ka.noBudget,na=>na.updatePolicy===I.UpdatePolicy.SYNC)};wa.addGeometries=function(na,qa,ta,Fa=!1){for(const Ha of na)n.isNone(Ha.origin)&&(Ha.origin=this._localOrigins.getOrigin(Ha.boundingSphere)),this._geometries.set(Ha.id,Ha);this._ensureLayerRenderer(qa,Fa).add(na);ta===T.ModelDirty.Geometry.UPDATE&&this._notifyGraphicGeometryChanged(na,qa)};wa.removeGeometries=function(na,qa,ta){for(var Fa of na)this._geometries.delete(n.unwrap(Fa.id));
if(Fa=this._layerRenderers.get(qa))Fa.remove(na),ta===T.ModelDirty.Geometry.UPDATE&&this._notifyGraphicGeometryChanged(na,qa)};wa.updateGeometries=function(na,qa,ta){const Fa=this._layerRenderers.get(qa);if(Fa)switch(Fa.modify(na,ta),ta){case T.ModelDirty.State.TRANSFORMATION:case T.ModelDirty.State.VERTEXATTRS:return this._notifyGraphicGeometryChanged(na,qa);case T.ModelDirty.State.VISIBILITIES:return this._notifyGraphicVisibilityChanged(na,qa)}else fa.warn("Attempted to update geometry for nonexistent layer")};
wa._notifyGraphicGeometryChanged=function(na,qa){if(!n.isNone(qa.notifyGraphicGeometryChanged))for(const Fa of na)if(na=Fa.graphicUid,n.isSome(na)&&na!==ta){qa.notifyGraphicGeometryChanged(na);var ta=na}};wa._notifyGraphicVisibilityChanged=function(na,qa){if(!n.isNone(qa.notifyGraphicVisibilityChanged))for(const Fa of na)if(na=Fa.graphicUid,n.isSome(na)&&na!==ta){qa.notifyGraphicVisibilityChanged(na);var ta=na}};wa.updateHighlights=function(na,qa){(qa=this._layerRenderers.get(qa))?qa.modify(na,T.ModelDirty.State.HIGHLIGHTS):
fa.warn("Attempted to update highlights for nonexistent layer")};wa.isEmpty=function(){return 0===this._geometries.size&&!A.OVERLAY_DRAW_DEBUG_TEXTURE};wa.updateAnimation=function(na){let qa=!1;this._layerRenderers.forEach(ta=>qa=ta.updateAnimation(na)||qa);return qa};wa.updateLayerOrder=function(){this._sortedLayerRenderersDirty=!0};wa.drawTarget=function(na,qa,ta){const Fa=na.canvasGeometries;if(0===Fa.numViews)return!1;this._screenToWorldRatio=ta*na.mapUnitsPerPixel;const Ha=qa.renderPass;if(this.isEmpty()||
Ha===H.RenderPass.MATERIAL_HIGHLIGHT&&!this.hasHighlights||Ha===H.RenderPass.MATERIAL_NORMAL&&!this.hasWater||!na.hasSomeSizedView())return!1;const Ka=qa.fbo;if(!Ka.isValid())return!1;const La=2*na.resolution,Ra=na.resolution;Ka.resize(La,Ra);const ab=this._rctx;ma.pixelRatio=na.pixelRatio*ta;this._renderContext.pass=Ha;this._bindParameters.screenToWorldRatio=this._screenToWorldRatio;this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio;this._bindParameters.slot=Ha===
H.RenderPass.MATERIAL_NORMAL?Q.RenderSlot.DRAPED_WATER:Q.RenderSlot.DRAPED_MATERIAL;na.applyViewport(this._rctx);Ka.bind(ab);na.index===E.OverlayIndex.INNER&&(ab.setClearColor(0,0,0,0),ab.clearSafe(ia.ClearBufferBit.COLOR_BUFFER_BIT));const Za=qa.type===E.RenderTargetType.ColorNoRasterImage?a.DrawPassOption.ExcludeRasterImage:qa.type===E.RenderTargetType.Occluded?a.DrawPassOption.OccludedOnly:a.DrawPassOption.Normal;Za===a.DrawPassOption.OccludedOnly&&(this._renderContext.renderOccludedMask=ya);if(A.OVERLAY_DRAW_DEBUG_TEXTURE&&
Za!==a.DrawPassOption.OccludedOnly)for(qa=0;qa<Fa.numViews;qa++)this._setViewParameters(Fa.extents[qa],na,ma),this._drawDebugTexture(na.resolution,la[na.index]);0<this._layerRenderers.size&&this._sortedLayerRenderers.forAll(({overlayLayer:Pa,renderer:ua})=>{if(Za!==a.DrawPassOption.ExcludeRasterImage||Pa.drapeSourceType!==B.DrapeSourceType.RasterImage){({fullOpacity:Pa}=Pa);var Aa=n.isSome(Pa)&&1>Pa&&Ha===H.RenderPass.MATERIAL;Aa&&(this.bindTemporaryFramebuffer(this._rctx,La,Ra),ab.clearSafe(ia.ClearBufferBit.COLOR_BUFFER_BIT));
for(let Ia=0;Ia<Fa.numViews;Ia++)this._setViewParameters(Fa.extents[Ia],na,ma),ua.render(this._renderContext,this._bindParameters);Aa&&n.isSome(this._temporaryFBO)&&(Ka.bind(ab),this.view._stage.renderView.compositingHelper.composite(this._temporaryFBO.getTexture(),ha.AlphaMode.PremultipliedAlpha,Pa,ba.CompositingFunction.OverlayWithTransparency,na.index))}});ab.bindFramebuffer(null);Ka.generateMipMap();this._renderContext.resetRenderOccludedMask();return!0};wa.bindTemporaryFramebuffer=function(na,
qa,ta){n.isNone(this._temporaryFBO)&&(this._temporaryFBO=new D.OverlayFramebufferObject(na,!1));this._temporaryFBO.resize(qa,ta);this._temporaryFBO.bind(na)};wa.reloadShaders=function(){var na=b._asyncToGenerator(function*(){yield this._shaderTechniqueRepository.reloadAll()});return function(){return na.apply(this,arguments)}}();wa.intersect=function(na,qa,ta,Fa){let Ha=0;this._geometries.forEach(Ka=>{if(!Fa||Fa(Ka)){this._intersectRenderGeometry(Ka,ta,qa,0,na,Ha);var La=this.longitudeCyclical;La&&
(Ka.boundingSphere[0]-Ka.boundingSphere[3]<La.min&&this._intersectRenderGeometry(Ka,ta,qa,La.range,na,Ha),Ka.boundingSphere[0]+Ka.boundingSphere[3]>La.max&&this._intersectRenderGeometry(Ka,ta,qa,-La.range,na,Ha));Ha++}})};wa._intersectRenderGeometry=function(na,qa,ta,Fa,Ha,Ka){if(na.instanceParameters.visible){var La=0;n.isSome(na.transformation)&&(Fa+=na.transformation[12],La=na.transformation[13]);ra[0]=ta[0]-Fa;ra[1]=ta[1]-La;ra[2]=1;va[0]=ta[0]-Fa;va[1]=ta[1]-La;va[2]=0;na.screenToWorldRatio=
this._screenToWorldRatio;na.material.intersect(na,null,na.getShaderTransformation(),Ha,ra,va,(Ra,ab,Za)=>{Z(qa,Za,na.material.renderPriority,Ka,Ha,na.layerUid,na.graphicUid)},na.calculateShaderTransformation,qa)}};wa._ensureLayerRenderer=function(na,qa){let ta=this._layerRenderers.get(na);ta&&qa===ta instanceof P.DrapedHeatmapRenderer||(ta=qa?new P.DrapedHeatmapRenderer({rctx:this._rctx,materialRepository:this._materialRepository}):new W.SortedRenderGeometryRenderer({rctx:this._rctx,materialRepository:this._materialRepository}),
this._layerRenderers.set(na,ta),this._sortedLayerRenderersDirty=!0,"fullOpacity"in na&&this._handles.add(na.watch("fullOpacity",()=>this.events.emit("content-changed")),na),this._handles.add(k.init(ta,"updating",()=>this.notifyChange("updating")),na));return ta};wa._updateSortedLayerRenderers=function(){if(this._sortedLayerRenderersDirty&&(this._sortedLayerRenderersDirty=!1,this._sortedLayerRenderers.clear(),0!==this._layerRenderers.size)){var na=this.view.map.allLayers;this._layerRenderers.forEach((qa,
ta)=>{const Fa=na.indexOf(ta.layer);this._sortedLayerRenderers.push(new ja(ta,qa,0>Fa?Infinity:Fa))});this._sortedLayerRenderers.sort((qa,ta)=>qa.index-ta.index)}};wa._setViewParameters=function(na,qa,ta){ta.viewport[0]=ta.viewport[1]=0;ta.viewport[2]=ta.viewport[3]=qa.resolution;u.ortho(ta.projectionMatrix,0,na[2]-na[0],0,na[3]-na[1],ta.near,ta.far);u.fromTranslation(ta.viewMatrix,[-na[0],-na[1],0]);this._renderContext.camera=ta;this._bindParameters.camera=ta;this._bindParameters.inverseViewport[0]=
1/ta.fullViewport[2];this._bindParameters.inverseViewport[1]=1/ta.fullViewport[3]};wa._updateHasWater=function(){const na=l.someMap(this._layerRenderers,qa=>qa.hasWater);na!==this._hasWater&&(this._hasWater=na,this.events.emit("has-water",na))};wa._updateHasHighlights=function(){const na=l.someMap(this._layerRenderers,qa=>qa.hasHighlights);na!==this._hasHighlights&&(this._hasHighlights=na,this.events.emit("has-highlights",na))};wa._updateRendersOccluded=function(){const na=l.someMap(this._layerRenderers,
qa=>qa.rendersOccluded);na!==this._rendersOccluded&&(this._rendersOccluded=na,this.events.emit("renders-occluded",na))};wa._drawDebugTexture=function(na,qa){this._ensureDebugPatternResources(na,na);na=this._rctx;const ta=na.useTechnique(this._debugTextureTechnique);ta.setUniform4f("uColor",qa[0],qa[1],qa[2],1);ta.bindTexture(this._debugPatternTexture,"tex");na.bindVAO(this._quadVAO);na.drawArrays(ia.PrimitiveType.TRIANGLE_STRIP,0,ca.vertexCount(this._quadVAO,"geometry"))};wa._ensureDebugPatternResources=
function(na,qa){if(!this._debugPatternTexture){var ta=new Uint8Array(na*qa*4),Fa=0;for(let Ha=0;Ha<qa;Ha++)for(let Ka=0;Ka<na;Ka++){const La=Math.floor(Ka/10),Ra=Math.floor(Ha/10);2>La||2>Ra||10*La>na-20||10*Ra>qa-20?(ta[Fa++]=255,ta[Fa++]=255,ta[Fa++]=255,ta[Fa++]=255):(ta[Fa++]=255,ta[Fa++]=255,ta[Fa++]=255,La&1&&Ra&1?ta[Fa++]=Ka&1^Ha&1?0:255:ta[Fa++]=La&1^Ra&1?0:128)}this._debugPatternTexture=new ea.Texture(this._rctx,{target:ia.TextureType.TEXTURE_2D,pixelFormat:ia.PixelFormat.RGBA,dataType:ia.PixelType.UNSIGNED_BYTE,
samplingMode:ia.TextureSamplingMode.NEAREST,width:na,height:qa},ta);na=new V.TextureTechniqueConfiguration;na.hasAlpha=!0;this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(V.TextureTechnique,na);this._quadVAO=M.createQuadVAO(this._rctx)}};b._createClass(pa,[{key:"updating",get:function(){return this._sortedLayerRenderersDirty||this._frameTask.updating||l.someMap(this._layerRenderers,na=>na.updating)}},{key:"hasOverlays",get:function(){return n.isSome(this._overlays)&&n.isSome(this._overlayRenderTarget)}},
{key:"gpuMemoryUsage",get:function(){return n.isSome(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}},{key:"overlays",get:function(){return n.unwrapOr(this._overlays,[])}},{key:"running",get:function(){return this.updating}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasWater",get:function(){return this._hasWater}},{key:"rendersOccluded",get:function(){return this._rendersOccluded}},{key:"test",get:function(){return{layerRenderers:this._layerRenderers}}}]);
return pa}(J.AutoDisposableMixin(d));c.__decorate([r.property()],a.OverlayRenderer.prototype,"_frameTask",void 0);c.__decorate([r.property()],a.OverlayRenderer.prototype,"_sortedLayerRenderersDirty",void 0);c.__decorate([J.autoDispose()],a.OverlayRenderer.prototype,"_shaderTechniqueRepository",void 0);c.__decorate([J.autoDispose()],a.OverlayRenderer.prototype,"_stippleTextureRepository",void 0);c.__decorate([r.property({constructOnly:!0})],a.OverlayRenderer.prototype,"view",void 0);c.__decorate([r.property()],
a.OverlayRenderer.prototype,"worldToPCSRatio",void 0);c.__decorate([r.property()],a.OverlayRenderer.prototype,"spatialReference",void 0);c.__decorate([r.property({type:Boolean,readOnly:!0})],a.OverlayRenderer.prototype,"updating",null);a.OverlayRenderer=c.__decorate([m.subclass("esri.views.3d.terrain.OverlayRenderer")],a.OverlayRenderer);a.DrawPassOption=void 0;(function(za){za[za.Normal=0]="Normal";za[za.OccludedOnly=1]="OccludedOnly";za[za.ExcludeRasterImage=2]="ExcludeRasterImage"})(a.DrawPassOption||
(a.DrawPassOption={}));let ja=function(za,pa,wa){this.overlayLayer=za;this.renderer=pa;this.index=wa};const la=[[1,.5,.5],[.5,.5,1]],ma=new O.default;ma.near=1;ma.far=1E4;ma.relativeElevation=null;const ra=q.create(),va=q.create(),ya=N.RenderOccludedFlag.OccludeAndTransparent;a.DRAPED_Z=-2;a.overlayRenderOccludedFlag=ya;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/interfaces":function(){define(["exports"],function(a){a.DrapeSourceType=void 0;(function(b){b[b.RasterImage=
0]="RasterImage";b[b.Features=1]="Features"})(a.DrapeSourceType||(a.DrapeSourceType={}));a.DrapeTargetType=void 0;(function(b){b[b.WithRasterImage=0]="WithRasterImage";b[b.WithoutRasterImage=1]="WithoutRasterImage"})(a.DrapeTargetType||(a.DrapeTargetType={}));a.DrapeSourceRegistration=void 0;(function(b){b[b.LAYER_VIEW=0]="LAYER_VIEW";b[b.EXTERNAL=1]="EXTERNAL"})(a.DrapeSourceRegistration||(a.DrapeSourceRegistration={}));Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/interfaces":function(){define(["exports"],
function(a){a.OverlayIndex=void 0;(function(b){b[b.INNER=0]="INNER";b[b.OUTER=1]="OUTER"})(a.OverlayIndex||(a.OverlayIndex={}));a.PatchType=void 0;(function(b){b[b.REGULAR=0]="REGULAR";b[b.HAS_NORTH_POLE=1]="HAS_NORTH_POLE";b[b.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE";b[b.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"})(a.PatchType||(a.PatchType={}));a.LODSnapping=void 0;(function(b){b[b.OFF=0]="OFF";b[b.ON=1]="ON"})(a.LODSnapping||(a.LODSnapping={}));a.RenderTargetType=void 0;(function(b){b[b.Color=0]="Color";b[b.ColorNoRasterImage=
1]="ColorNoRasterImage";b[b.Highlight=2]="Highlight";b[b.Water=3]="Water";b[b.Occluded=4]="Occluded"})(a.RenderTargetType||(a.RenderTargetType={}));a.TextureUpdate=void 0;(function(b){b[b.FADING=0]="FADING";b[b.IMMEDIATE=1]="IMMEDIATE";b[b.UNFADED=2]="UNFADED"})(a.TextureUpdate||(a.TextureUpdate={}));Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/Overlay":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../geometry/support/aaBoundingRect ./interfaces ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/LocalOriginFactory".split(" "),
function(a,b,c,d,g,x,w){a.OverlaySource=void 0;(function(f){f[f.None=0]="None";f[f.ColorAndWater=1]="ColorAndWater";f[f.Highlight=2]="Highlight";f[f.Occluded=3]="Occluded"})(a.OverlaySource||(a.OverlaySource={}));let l=function(){function f(k,r){this.index=k;this.renderTargets=r;this.extent=d.create();this.resolution=0;this.renderLocalOrigin=w.fromValues(0,0,0,"O");this.mapUnitsPerPixel=this.pixelRatio=1;this.canvasGeometries=new n;this.validTargets=null;this.hasTargetWithoutRasterImage=this.hasDrapedRasterSource=
this.hasDrapedFeatureSource=!1;this.index=k;this.validTargets=Array(r.renderTargets.length).fill(!1)}var e=f.prototype;e.getValidTarget=function(k){return this.validTargets[k]?this.renderTargets.getTarget(k):null};e.getColorTexture=function(k){return(k=k===a.OverlaySource.ColorAndWater?this.renderTargets.getTarget(g.RenderTargetType.Color):k===a.OverlaySource.Highlight?this.renderTargets.getTarget(g.RenderTargetType.Highlight):this.renderTargets.getTarget(g.RenderTargetType.Occluded))?k.getTexture():
null};e.getNormalTexture=function(k){return(k=k===a.OverlaySource.ColorAndWater?this.renderTargets.getTarget(g.RenderTargetType.Water):null)?k.getTexture():null};e.draw=function(k,r){const y=this.computeRenderTargetValidityBitfield(),p=this.needsColorWithoutRasterImage;for(const h of this.renderTargets.renderTargets)this.validTargets[h.type]=h.type===g.RenderTargetType.ColorNoRasterImage&&!1===p?!1:k.drawTarget(this,h,r);k=this.computeRenderTargetValidityBitfield();return y^k?x.ValidationState.CHANGED:
x.ValidationState.UNCHANGED};e.computeRenderTargetValidityBitfield=function(){const k=this.validTargets;return+k[g.RenderTargetType.Color]|+k[g.RenderTargetType.ColorNoRasterImage]<<1|+k[g.RenderTargetType.Highlight]<<2|+k[g.RenderTargetType.Water]<<3|+k[g.RenderTargetType.Occluded]<<4};e.setupGeometryViewsCyclical=function(k){this.setupGeometryViewsDirect();var r=.001*k.range;if(this.extent[0]-r<=k.min){const y=this.canvasGeometries.extents[this.canvasGeometries.numViews++];d.offset(this.extent,
k.range,0,y)}this.extent[2]+r>=k.max&&(r=this.canvasGeometries.extents[this.canvasGeometries.numViews++],d.offset(this.extent,-k.range,0,r))};e.setupGeometryViewsDirect=function(){this.canvasGeometries.numViews=1;d.copy(this.canvasGeometries.extents[0],this.extent)};e.hasSomeSizedView=function(){for(let k=0;k<this.canvasGeometries.numViews;k++){const r=this.canvasGeometries.extents[k];if(r[0]!==r[2]&&r[1]!==r[3])return!0}return!1};e.applyViewport=function(k){k.setViewport(this.index===g.OverlayIndex.INNER?
0:this.resolution,0,this.resolution,this.resolution)};b._createClass(f,[{key:"needsColorWithoutRasterImage",get:function(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}}]);return f}(),n=function(){this.extents=[d.create(),d.create(),d.create()];this.numViews=0};a.Overlay=l;a.computeOverlayResolution=function(f,e,k){return Math.min(c.nextHighestPowerOfTwo(Math.max(f,e)+256),k)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/LocalOriginFactory":function(){define(["exports",
"../../../../chunks/vec3f64"],function(a,b){let c=function(d,g){this.vec3=d;this.id=g};a.LocalOrigin=c;a.fromValues=function(d,g,x,w){return new c(b.fromValues(d,g,x),w)};a.fromVector=function(d,g){return new c(b.clone(d),g)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/OverlayFramebufferObject":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../chunks/vec2f32 ../../webgl/enums ../../webgl/FramebufferObject".split(" "),function(a,
b,c,d,g,x){let w=function(){function l(f,e){this.size=d.create();this._fbo=null;this._fbo=new x.FramebufferObject(f,{colorTarget:g.TargetType.TEXTURE,depthStencilTarget:g.DepthStencilTargetType.NONE},{target:g.TextureType.TEXTURE_2D,pixelFormat:g.PixelFormat.RGBA,dataType:g.PixelType.UNSIGNED_BYTE,wrapMode:g.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:g.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,hasMipmap:e,maxAnisotropy:8,width:0,height:0})}var n=l.prototype;n.dispose=function(){this._fbo=c.disposeMaybe(this._fbo)};
n.getTexture=function(){return this._fbo?this._fbo.colorTexture:null};n.isValid=function(){return null!==this._fbo};n.resize=function(f,e){this.size[0]=f;this.size[1]=e;this._fbo.resize(this.size[0],this.size[1])};n.bind=function(f){f.bindFramebuffer(this._fbo)};n.generateMipMap=function(){this._fbo.colorTexture.descriptor.hasMipmap&&this._fbo.colorTexture.generateMipmap()};n.disposeRenderTargetMemory=function(){var f;null==(f=this._fbo)?void 0:f.resize(0,0)};b._createClass(l,[{key:"gpuMemoryUsage",
get:function(){var f,e;return null!=(f=null==(e=this._fbo)?void 0:e.gpuMemoryUsage)?f:0}}]);return l}();a.OverlayFramebufferObject=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/OverlayRenderTarget":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","./interfaces","./OverlayFramebufferObject","../webgl-engine/lib/RenderPass"],function(a,b,c,d,g){let x=function(){function w(n){const f=(e,k,r=!0)=>({type:k,fbo:new d.OverlayFramebufferObject(n,r),renderPass:e,
valid:!1,lastUsed:Infinity});this.renderTargets=[f(g.RenderPass.MATERIAL,c.RenderTargetType.Color),f(g.RenderPass.MATERIAL,c.RenderTargetType.ColorNoRasterImage),f(g.RenderPass.MATERIAL_HIGHLIGHT,c.RenderTargetType.Highlight,!1),f(g.RenderPass.MATERIAL_NORMAL,c.RenderTargetType.Water),f(g.RenderPass.MATERIAL,c.RenderTargetType.Occluded)]}var l=w.prototype;l.getTarget=function(n){return this.renderTargets[n].fbo};l.dispose=function(){for(const n of this.renderTargets)n.fbo.dispose()};l.disposeRenderTargetMemory=
function(){for(const n of this.renderTargets)n.fbo.disposeRenderTargetMemory()};l.validateUsageForTarget=function(n,f,e){if(n)f.lastUsed=e;else if(1E3<e-f.lastUsed)f.fbo.disposeRenderTargetMemory(),f.lastUsed=Infinity;else if(Infinity>f.lastUsed)return!0;return!1};b._createClass(w,[{key:"gpuMemoryUsage",get:function(){return this.renderTargets.reduce((n,f)=>n+f.fbo.gpuMemoryUsage,0)}}]);return w}();a.OverlayRenderTarget=x;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueRepository":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../../../../../core/NestedMap"],function(a,b,c,d){let g=function(w){this.technique=w;this.refZeroFrame=this.refCount=0},x=function(){function w(n){this._context=n;this._perConstructorInstances=new d.NestedMap;this._frameCounter=0;this._keepAliveFrameCount=-1}var l=w.prototype;l.dispose=function(){this._perConstructorInstances.forEach(n=>n.forEach(f=>f.technique.destroy()));this._perConstructorInstances.clear()};l.acquire=
function(n,f){const e=f.key;let k=this._perConstructorInstances.get(n,e);if(c.isNone(k)){const r=new n(this._context,f,()=>this.release(r));k=new g(r);this._perConstructorInstances.set(n,e,k)}++k.refCount;return k.technique};l.releaseAndAcquire=function(n,f,e){if(c.isSome(e)){if(f.key===e.key)return e;this.release(e)}return this.acquire(n,f)};l.release=function(n){c.isNone(n)||this._perConstructorInstances.empty||(n=this._perConstructorInstances.get(n.constructor,n.key),c.isNone(n)||(--n.refCount,
0===n.refCount&&(n.refZeroFrame=this._frameCounter)))};l.frameUpdate=function(){this._frameCounter++;-1!==this._keepAliveFrameCount&&this._perConstructorInstances.forEach((n,f)=>{n.forEach((e,k)=>{0===e.refCount&&e.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(e.technique.destroy(),this._perConstructorInstances.delete(f,k))})})};l.reloadAll=function(){var n=b._asyncToGenerator(function*(){var f=this;const e=[];this._perConstructorInstances.forEach((k,r)=>{const y=function(){var p=b._asyncToGenerator(function*(h,
m){if(m=m.shader)yield m.reload(),h.forEach(u=>{u.technique.reload(f._context)})});return function(h,m){return p.apply(this,arguments)}}();e.push(y(k,r))});yield Promise.all(e)});return function(){return n.apply(this,arguments)}}();b._createClass(w,[{key:"viewingMode",get:function(){return this._context.viewingMode}},{key:"constructionContext",get:function(){return this._context}}]);return w}();a.ShaderTechniqueRepository=x;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/NestedMap":function(){define(["exports",
"../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function d(){this._outer=new Map}var g=d.prototype;g.clear=function(){this._outer.clear()};g.get=function(x,w){var l;return null==(l=this._outer.get(x))?void 0:l.get(w)};g.set=function(x,w,l){const n=this._outer.get(x);n?n.set(w,l):this._outer.set(x,new Map([[w,l]]))};g.delete=function(x,w){const l=this._outer.get(x);l&&(l.delete(w),0===l.size&&this._outer.delete(x))};g.forEach=function(x){this._outer.forEach((w,l)=>x(w,l))};b._createClass(d,
[{key:"empty",get:function(){return 0===this._outer.size}}]);return d}();a.NestedMap=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/AutoDisposable":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){const c=g=>function(x){function w(){var l=x.apply(this,arguments)||this;l._isDisposed=!1;return l}b._inheritsLoose(w,x);w.prototype.dispose=function(){for(const n of null!=(l=this._managedDisposables)?l:[]){var l;l=this[n];
this[n]=null;l&&"function"===typeof l.dispose&&l.dispose()}this._isDisposed=!0};b._createClass(w,[{key:"isDisposed",get:function(){return this._isDisposed}}]);return w}(g);let d=function(g){function x(){return g.apply(this,arguments)||this}b._inheritsLoose(x,g);return x}(c(function(){return function(){}}()));a.AutoDisposable=d;a.AutoDisposableMixin=c;a.autoDispose=function(){return(g,x)=>{if(!g.hasOwnProperty("_managedDisposables")){var w,l;g._managedDisposables=null!=(w=null==(l=g._managedDisposables)?
void 0:l.slice())?w:[]}g._managedDisposables.unshift(x)}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/DrapedHeatmapRenderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/set ../../../../core/accessorSupport/decorators/subclass ../../../ViewingMode ./glUtil3D ./SortedRenderGeometryRenderer ../materials/HeatmapDensityMaterial ../shaders/HeatmapTechnique ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t){function q(z){return y.isHeatMapDensityMaterial(z.material)}a.DrapedHeatmapRenderer=function(z){function v(){var A=z.apply(this,arguments)||this;A.type="draped-heatmap";return A}b._inheritsLoose(v,z);var B=v.prototype;B.initialize=function(){z.prototype.initialize.call(this);var A={colorTarget:h.TargetType.TEXTURE,depthStencilTarget:h.DepthStencilTargetType.NONE,width:0,height:0},{capabilities:E}=this.rctx,{R32F:C}=E.colorBufferFloat;({textureFloatLinear:E}=
E.textureFloat);C=null!=C;this._densityMap=new m.FramebufferObject(this.rctx,A,{target:h.TextureType.TEXTURE_2D,pixelFormat:C?h.PixelFormat.RED:h.PixelFormat.RGBA,internalFormat:C?h.SizedPixelFormat.R32F:h.PixelFormat.RGBA,dataType:h.PixelType.FLOAT,samplingMode:E?h.TextureSamplingMode.LINEAR:h.TextureSamplingMode.NEAREST,wrapMode:h.TextureWrapMode.CLAMP_TO_EDGE,width:0,height:0});this._quad=k.createQuadVAO(this.rctx);this._colorRamp=A=new u.Texture(this.rctx,{target:h.TextureType.TEXTURE_2D,pixelFormat:h.PixelFormat.RGBA,
dataType:h.PixelType.UNSIGNED_BYTE,samplingMode:h.TextureSamplingMode.LINEAR,wrapMode:h.TextureWrapMode.CLAMP_TO_EDGE,width:1,height:1},new Uint8ClampedArray(4));this._technique=new p.HeatmapTechnique({rctx:this.rctx,viewingMode:e.ViewingMode.Local},new p.HeatmapTechniqueConfiguration);this._heatmapParameters={colorRamp:A,densityMap:this._densityMap.colorTexture,searchRadius:1,minDensity:0,maxDensity:100,fieldTotal:0}};B.destroy=function(){this._technique=d.releaseMaybe(this._technique);this._densityMap=
d.disposeMaybe(this._densityMap);this._quad=d.disposeMaybe(this._quad);this._colorRamp=d.disposeMaybe(this._colorRamp)};B.add=function(A){z.prototype.add.call(this,A)};B.remove=function(A){z.prototype.remove.call(this,A)};B.render=function(A,E){var C=this._heatmapDensityMaterialRenderers,D=C.length;if(!(1>D)){var F=this.rctx.getBoundFramebufferObject(),G=this.rctx.getViewport(),J=C[0].material.parameters,{pixelRatio:I}=J,O=Math.ceil(G.width*I);I=Math.ceil(G.height*I);this._densityMap.resize(O,I);
this.rctx.bindFramebuffer(this._densityMap);this.rctx.setViewport(0,0,O,I);this.rctx.clear(h.ClearBufferBit.COLOR_BUFFER_BIT);O=!1;for(I=0;I<D;I++){const L=C[I];L.material.shouldRender(A)&&(O=O||L.materialRenderer.render(E.slot,A.pass,E))}this.rctx.bindFramebuffer(F);this.rctx.setViewport(G.x,G.y,G.width,G.height);if(O){var {searchRadius:P,minDensity:K,maxDensity:M,fieldTotal:U,colorRampData:R}=J;A=this._heatmapParameters;A.searchRadius=P;A.fieldTotal=U;A.searchRadius=P;A.minDensity=K;A.maxDensity=
M;d.isSome(R)&&R!==this._colorRampData&&({colorRamp:C}=A,D=R.length/4,D!==C.descriptor.width&&C.resize(D,1),C.setData(R),this._colorRampData=R);this.rctx.bindVAO(this._quad);this.rctx.useProgram(this._technique.program);this._technique.bindPipelineState(this.rctx);this._technique.bindPass(A,E);this.rctx.drawArrays(this._technique.primitiveType,0,t.vertexCount(this._quad,"geometry"))}}};b._createClass(v,[{key:"hasHighlights",get:function(){return!1}},{key:"hasWater",get:function(){return!1}},{key:"rendersOccluded",
get:function(){return!1}},{key:"_heatmapDensityMaterialRenderers",get:function(){return this._sortedMaterialRenderers.filter(q)}}]);return v}(r.SortedRenderGeometryRenderer);a.DrapedHeatmapRenderer=c.__decorate([f.subclass("esri.views.3d.webgl-engine.lib.DrapedHeatmapRenderer")],a.DrapedHeatmapRenderer);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/SortedRenderGeometryRenderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/MapUtils ../../../../core/PooledArray ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ./ChangeSet ./rendererUtils ../materials/renderers/MergedRenderer".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y){a.SortedRenderGeometryRenderer=function(h){function m(){var t=h.apply(this,arguments)||this;t._pending=new p;t._changes=new k.ChangeSet;t._materialRenderers=new Map;t._sortedMaterialRenderers=new x;t._hasHighlights=!1;t._hasWater=!1;return t}b._inheritsLoose(m,h);var u=m.prototype;u.destroy=function(){this._changes.prune();this._materialRenderers.forEach(t=>t.dispose());this._materialRenderers.clear();this._sortedMaterialRenderers.clear()};u.commitChanges=function(){if(!this.updating)return!1;
this._processAddsRemoves();let t=!1,q=!1,z=!1;r.splitRenderGeometryChangeSetByMaterial(this._changes).forEach((v,B)=>{let A=this._materialRenderers.get(B);!A&&0<v.adds.length&&(A=new y.MergedRenderer(this.rctx,this.materialRepository,B),this._materialRenderers.set(B,A),z=q=t=!0);if(A){var E=q||A.hasHighlights,C=z||A.hasWater;A.modify(v);q=q||E!==A.hasHighlights;z=z||C!==A.hasWater;A.isEmpty&&(this._materialRenderers.delete(B),A.dispose(),t=!0)}});this._changes.clear();t&&this._updateSortedMaterialRenderers();
q&&(this._hasHighlights=g.someMap(this._materialRenderers,v=>v.hasHighlights));z&&(this._hasWater=g.someMap(this._materialRenderers,v=>v.hasWater));this.notifyChange("updating");return!0};u.add=function(t){if(0!==t.length){var q=this._pending.empty;for(const z of t)this._pending.adds.add(z);q&&this.notifyChange("updating")}};u.remove=function(t){const q=this._pending.empty;for(const z of t)this._pending.adds.has(z)?(this._pending.removed.add(z),this._pending.adds.delete(z)):this._pending.removed.has(z)||
this._pending.removes.add(z);q&&!this._pending.empty&&this.notifyChange("updating")};u.modify=function(t,q){const z=0===this._changes.updates.length;for(const v of t)t=this._changes.updates.pushNew(),t.renderGeometry=v,t.updateType=q;z&&0<this._changes.updates.length&&this.notifyChange("updating")};u.updateAnimation=function(t){let q=!1;this._sortedMaterialRenderers.forAll(({materialRenderer:z})=>q=z.updateAnimation(t)||q);return q};u.render=function(t,q){for(let z=0;z<this._sortedMaterialRenderers.length;z++){const v=
this._sortedMaterialRenderers.data[z];v.material.shouldRender(t)&&v.materialRenderer.render(q.slot,t.pass,q)}};u._updateSortedMaterialRenderers=function(){this._sortedMaterialRenderers.clear();let t=0;this._materialRenderers.forEach((q,z)=>{z.insertOrder=t++;this._sortedMaterialRenderers.push({material:z,materialRenderer:q})});this._sortedMaterialRenderers.sort((q,z)=>{const v=z.material.renderPriority-q.material.renderPriority;return 0!==v?v:q.material.insertOrder-z.material.insertOrder})};u._processAddsRemoves=
function(){this._changes.adds.clear();this._changes.removes.clear();this._changes.adds.pushArray(Array.from(this._pending.adds));this._changes.removes.pushArray(Array.from(this._pending.removes));for(let t=0;t<this._changes.updates.length;)this._pending.has(this._changes.updates.data[t].renderGeometry)?this._changes.updates.removeUnorderedIndex(t):t++;this._pending.clear()};b._createClass(m,[{key:"updating",get:function(){return!this._pending.empty||0<this._changes.updates.length}},{key:"hasHighlights",
get:function(){return this._hasHighlights}},{key:"hasWater",get:function(){return this._hasWater}},{key:"rendersOccluded",get:function(){return g.someMap(this._materialRenderers,t=>t.rendersOccluded)}},{key:"isEmpty",get:function(){return!this.updating&&0===this._materialRenderers.size}},{key:"test",get:function(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}}]);return m}(d);c.__decorate([w.property()],a.SortedRenderGeometryRenderer.prototype,"rctx",void 0);c.__decorate([w.property()],
a.SortedRenderGeometryRenderer.prototype,"materialRepository",void 0);c.__decorate([w.property()],a.SortedRenderGeometryRenderer.prototype,"updating",null);a.SortedRenderGeometryRenderer=c.__decorate([e.subclass("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],a.SortedRenderGeometryRenderer);let p=function(){function h(){this.adds=new Set;this.removes=new Set;this.removed=new Set}var m=h.prototype;m.has=function(u){return this.adds.has(u)||this.removes.has(u)||this.removed.has(u)};
m.clear=function(){this.adds.clear();this.removes.clear();this.removed.clear()};b._createClass(h,[{key:"empty",get:function(){return 0===this.adds.size&&0===this.removes.size&&0===this.removed.size}}]);return h}();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/ChangeSet":function(){define(["exports","../../../../core/PooledArray"],function(a,b){let c=function(){function g(){this.adds=new b;this.removes=new b;this.updates=new b({allocator:w=>w||new d,deallocator:w=>
{w.renderGeometry=null;return w}})}var x=g.prototype;x.clear=function(){this.adds.clear();this.removes.clear();this.updates.clear()};x.prune=function(){this.adds.prune();this.removes.prune();this.updates.prune()};return g}(),d=function(){};a.ChangeSet=c;a.MaterialChangeSet=function(){this.adds=[];this.removes=[];this.updates=[]};a.RenderGeometryUpdate=d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/rendererUtils":function(){define(["exports","./ChangeSet"],function(a,
b){a.splitRenderGeometryChangeSetByMaterial=function(c){const d=new Map,g=x=>{let w=d.get(x);w||(w=new b.MaterialChangeSet,d.set(x,w));return w};c.removes.forAll(x=>{1<=x.data.indexCount&&g(x.material).removes.push(x)});c.adds.forAll(x=>{1<=x.data.indexCount&&g(x.material).adds.push(x)});c.updates.forAll(x=>{1<=x.renderGeometry.data.indexCount&&g(x.renderGeometry.material).updates.push(x)});return d};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/renderers/MergedRenderer":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/MapUtils ../../../../../core/maybe ../../../../../core/PooledArray ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../../support/buffer/glUtil ../../lib/GLMaterials ../../lib/Material ../../lib/ModelDirtyTypes ../../lib/RenderPass ../../lib/Util ../WaterMaterial ./Instance ./MergedGeometryBuffer ./MergedGeometryBufferPool ./utils".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u){function t(I,O){const P=new Map;for(const K of I)q(P,K,!0);for(const K of O)q(P,K,!1);return P}function q(I,O,P){const K=O.origin;if(!d.isNone(K)){var M=I.get(K.id);null==M&&(M=new A(K.vec3),I.set(K.id,M));P?M.toAdd.push(O):M.toRemove.push(O)}}function z(I,O){let P;if(!I.some(M=>{if(M.to-M.from<O)return!1;P=M;return!0}))return null;const K=P.from;P.from+=O;P.from>=P.to&&I.removeUnordered(P);return K}function v(I){const O=new Map;I.forAll(K=>O.set(K.from,
K));let P=!0;for(;P;)P=!1,I.forEach(K=>{const M=O.get(K.to);M&&(K.to=M.to,O.delete(M.from),I.removeUnordered(M),P=!0)})}let B=function(){function I(P,K,M){this._rctx=P;this._materialRepository=K;this._material=M;this.type="MergedRenderer";this._dataByOrigin=new Map;this._renderCommandData=new g;this._hasOccludees=this._hasHighlights=!1;this._glMaterials=new n.GLMaterials(this._material,this._materialRepository);this._bufferWriter=M.createBufferWriter();this._bufferPool=new m.MergedGeometryBufferPool(P,
M.vertexAttributeLocations,l.glLayout(this._bufferWriter.vertexBufferLayout))}var O=I.prototype;O.dispose=function(){this._glMaterials.destroy();this._dataByOrigin.forEach(P=>P.buffer.dispose());this._dataByOrigin.clear();this._bufferPool.dispose()};O.modify=function(P){this._updateGeometries(P.updates);this._addAndRemoveGeometries(P.adds,P.removes);this._updateRenderCommands()};O._addAndRemoveGeometries=function(P,K){const M=this._bufferWriter,U=M.vertexBufferLayout.stride/4,R=this._dataByOrigin,
L=t(P,K);L.forEach((N,T)=>{L.delete(T);var S=N.toAdd.reduce((V,Y)=>V+M.elementCount(Y.data),0);let H=R.get(T);if(null==H)r.assert(0===N.toRemove.length),H=new E(N.origin,new h.MergedGeometryBuffer(this._bufferPool,S*U)),R.set(T,H);else if(0===N.toAdd.length&&H.instances.size===N.toRemove.length){H.buffer.dispose();R.delete(T);return}let Q=0;H.instances.forEach(V=>Q+=V.to-V.from);T=N.toRemove.reduce((V,Y)=>V+M.elementCount(Y.data),0);T=(Q+S-T)*U;S=D;T<H.buffer.size/2?this._removeAndRebuild(H,N.toRemove,
U,T,S):0<N.toRemove.length&&this._remove(H,N.toRemove,U,S);0<N.toAdd.length&&(T=F,r.setMatrixTranslation3(T,-N.origin[0],-N.origin[1],-N.origin[2]),this._add(H,N.toAdd,U,T,S));const W=H.buffer.vao.vertexBuffers.geometry;v(S);S.forAll(({from:V,to:Y})=>{V<Y&&(V*=4,W.setSubData(H.buffer.array,V,V,4*Y))});S.clear();H.drawCommandsDirty=!0})};O._updateGeometries=function(P){const K=this._bufferWriter,M=K.vertexBufferLayout.stride/4;for(const U of P){P=U.renderGeometry;const R=this._dataByOrigin.get(P.origin.id),
L=R&&R.instances.get(P.id);if(!L)break;const N=U.updateType;N&e.ModelDirty.State.VISIBILITIES&&(L.isVisible=P.instanceParameters.visible);if(N&(e.ModelDirty.State.HIGHLIGHTS|e.ModelDirty.State.VISIBILITIES)){const T=P.instanceParameters.visible;L.hasHighlights=!!P.instanceParameters.highlights&&T}N&e.ModelDirty.State.OCCLUDEES&&(L.hasOccludees=!!P.instanceParameters.occludees);if(N&(e.ModelDirty.State.VERTEXATTRS|e.ModelDirty.State.TRANSFORMATION)){const {array:T,vao:S}=R.buffer;u.calculateTransformRelativeToOrigin(P,
G,J);K.write({transformation:G,invTranspTransformation:J},P.data,K.vertexBufferLayout.createView(T.buffer),L.from);r.assert(L.from+K.elementCount(P.data)===L.to,"material VBO layout has changed");S.vertexBuffers.geometry.setSubData(T,L.from*M*4,L.from*M*4,L.to*M*4)}R.drawCommandsDirty=!0}};O._updateRenderCommands=function(){this._hasOccludees=this._hasHighlights=!1;this._dataByOrigin.forEach(K=>{K.hasHiddenInstances=!1;K.hasHighlights=!1;K.hasOccludees=!1;c.someMap(K.instances,M=>{M.isVisible?(M.hasHighlights&&
(this._hasHighlights=!0,K.hasHighlights=!0),M.hasOccludees&&(this._hasOccludees=!0,K.hasOccludees=!0)):K.hasHiddenInstances=!0;return K.hasHiddenInstances&&K.hasHighlights&&K.hasOccludees})});const P=K=>{K.drawCommandsDefault=null;K.drawCommandsHighlight=null;K.drawCommandsOccludees=null;K.drawCommandsShadowHighlightRest=null;if(0!==K.instances.size)if(K.hasOccludees||K.hasHighlights||K.hasHiddenInstances){var M=p.sortInstancesByRange(K.instances);K.drawCommandsDefault=[];K.drawCommandsHighlight=
[];K.drawCommandsOccludees=[];K.drawCommandsShadowHighlightRest=[];for(const U of M)U.isVisible&&(U.hasOccludees?p.addOrMerge(K.drawCommandsOccludees,U):p.addOrMerge(K.drawCommandsDefault,U),U.hasHighlights?p.addOrMerge(K.drawCommandsHighlight,U):p.addOrMerge(K.drawCommandsShadowHighlightRest,U))}else K.drawCommandsDefault=[{first:0,count:4*K.buffer.size/this._bufferWriter.vertexBufferLayout.stride}]};this._dataByOrigin.forEach(K=>{K.drawCommandsDirty&&(P(K),K.drawCommandsDirty=!1)})};O.updateAnimation=
function(P){return this._material.update(P)};O.requiresSlot=function(P,K){return null==P||this._material.requiresSlot(P,K)};O.render=function(P,K,M){if(!this.requiresSlot(P,K))return!1;const U=K===k.RenderPass.MATERIAL_HIGHLIGHT||K===k.RenderPass.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT;if(U&&!this._hasHighlights)return!1;const R=K===k.RenderPass.MATERIAL_DEPTH_SHADOWMAP_DEFAULT,L=!(U||R);this._dataByOrigin.forEach(S=>{if(!U||S.hasHighlights){var H=(U?S.drawCommandsHighlight:R&&(S.hasOccludees||S.hasHighlights||
S.hasHiddenInstances)?S.drawCommandsShadowHighlightRest:S.drawCommandsDefault)||null,Q=L&&S.drawCommandsOccludees||null;(d.isSome(H)||d.isSome(Q))&&this._renderCommandData.push(new C(S.origin,S.buffer,H,Q))}});if(0===this._renderCommandData.length)return!1;const N=this._rctx;K=this._glMaterials.load(N,K);if(d.isNone(K))return this._renderCommandData.clear(),!1;const T=K.beginSlot(M);N.useTechnique(T,P,!1);K.bind(M,T);this._renderCommandData.forAll(({origin:S,buffer:H,renderCommands:Q,occludeeCommands:W})=>
{M.origin=S;T.bindDraw(M);T.ensureAttributeLocations(H.vao);N.bindVAO(H.vao);S=T.primitiveType;d.isSome(Q)&&this._renderCommands(N,S,Q);d.isSome(W)&&(T.bindPipelineState(N,P,!0),this._renderCommands(N,S,W),T.bindPipelineState(N,P,!1))});this._renderCommandData.clear();return!0};O._renderCommands=function(P,K,M){for(let U=0;U<M.length;U++)P.drawArrays(K,M[U].first,M[U].count)};O._removeAndRebuild=function(P,K,M,U,R){for(var L of K)P.instances.delete(L.id);var N=p.sortInstancesByRange(P.instances);
P.instances.clear();K=P.buffer.size;U=P.buffer.alloc(U);L=0;for(const T of N){N=T.from*M;const S=T.to*M;U.copy(L,N,S);T.from=L/M;L+=S-N;T.to=L/M;P.instances.set(T.id,T)}R.push(new p.BufferRange(0,U.hasNewBuffer?P.buffer.array.length:K));U.dispose();P.buffer.erase(L,R.back().to);P.holes.clear()};O._remove=function(P,K,M,U){for(const R of K){K=R.id;const L=P.instances.get(K),N=L.from*M,T=L.to*M;P.buffer.erase(N,T);P.holes.push(new p.BufferRange(L.from,L.to));P.instances.delete(K);U.push(new p.BufferRange(N,
T))}v(P.holes)};O._add=function(P,K,M,U,R){if(0!==K.length){var L=this._bufferWriter,N=L.vertexBufferLayout.createView(P.buffer.array.buffer),T=0<P.holes.length,S=Number.MAX_SAFE_INTEGER,H=Number.MIN_SAFE_INTEGER;for(const W of K){var Q=d.isSome(W.transformation)?x.multiply(G,U,W.transformation):U;x.invert(J,Q);const V=x.transpose(J,J);K=L.elementCount(W.data);const Y=K*M;let aa=z(P.holes,K);d.isNone(aa)&&(aa=P.buffer.size/M,P.buffer.grow(Y),N=L.vertexBufferLayout.createView(P.buffer.array.buffer));
L.write({transformation:Q,invTranspTransformation:V},W.data,N,aa);Q=W.instanceParameters.visible;K=new p.Instance(W.id,aa,aa+K,Q,!!W.instanceParameters.highlights&&Q,!!W.instanceParameters.occludees);r.assert(null==P.instances.get(W.id));P.instances.set(W.id,K);T?R.push(new p.BufferRange(K.from*M,K.to*M)):(S=Math.min(K.from,S),H=Math.max(K.to,H))}T||R.push(new p.BufferRange(S*M,H*M))}};b._createClass(I,[{key:"isEmpty",get:function(){return 0===this._dataByOrigin.size}},{key:"hasHighlights",get:function(){return this._hasHighlights}},
{key:"hasOccludees",get:function(){return this._hasOccludees}},{key:"hasWater",get:function(){return!this.isEmpty&&this._material instanceof y.WaterMaterial}},{key:"rendersOccluded",get:function(){return!this.isEmpty&&this._material.renderOccluded!==f.RenderOccludedFlag.Occlude}},{key:"test",get:function(){return{material:this._material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}}]);return I}(),A=function(I){this.origin=I;this.toAdd=[];this.toRemove=[]},E=function(I,O){this.origin=
I;this.buffer=O;this.instances=new Map;this.holes=new g({deallocator:null});this.drawCommandsDirty=this.hasOccludees=this.hasHighlights=this.hasHiddenInstances=!1},C=function(I,O,P,K){this.origin=I;this.buffer=O;this.renderCommands=P;this.occludeeCommands=K};const D=new g({deallocator:null}),F=w.create(),G=w.create(),J=w.create();a.MergedRenderer=B;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/GLMaterials":function(){define(["exports","../../../../core/maybe",
"../core/shaderLibrary/ShaderOutputOptions","./basicInterfaces","./RenderPass"],function(a,b,c,d,g){function x(l){switch(l){default:case g.RenderPass.MATERIAL:return c.ShaderOutput.Color;case g.RenderPass.MATERIAL_ALPHA:return c.ShaderOutput.Alpha;case g.RenderPass.MATERIAL_DEPTH_SHADOWMAP_ALL:return c.ShaderOutput.Shadow;case g.RenderPass.MATERIAL_NORMAL:return c.ShaderOutput.Normal;case g.RenderPass.MATERIAL_DEPTH:return c.ShaderOutput.Depth;case g.RenderPass.MATERIAL_HIGHLIGHT:return c.ShaderOutput.Highlight;
case g.RenderPass.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT:return c.ShaderOutput.Shadow;case g.RenderPass.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return c.ShaderOutput.Shadow}}let w=function(){function l(f,e){this._material=f;this._repository=e;this._map=new Map}var n=l.prototype;n.destroy=function(){this._map.forEach((f,e)=>{b.isSome(f)&&this._repository.release(this._material,x(e))})};n.load=function(f,e){this._map.has(e)||this._map.set(e,this._repository.acquire(this._material,x(e)));e=this._map.get(e);if(b.isSome(e)){if(e.ensureResources(f)===
d.ResourceState.LOADED)return e;this._repository.requestRender()}return null};return l}();a.GLMaterials=w;a.outputFromPass=x;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/ModelDirtyTypes":function(){define(["exports"],function(a){a.ModelDirty=void 0;(function(b){(function(c){c[c.ADD=1]="ADD";c[c.UPDATE=2]="UPDATE";c[c.REMOVE=4]="REMOVE"})(b.Geometry||(b.Geometry={}));(function(c){c[c.VISIBILITIES=1]="VISIBILITIES";c[c.VERTEXATTRS=2]="VERTEXATTRS";c[c.TRANSFORMATION=
4]="TRANSFORMATION";c[c.HIGHLIGHTS=8]="HIGHLIGHTS";c[c.OCCLUDEES=16]="OCCLUDEES"})(b.State||(b.State={}))})(a.ModelDirty||(a.ModelDirty={}));Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/WaterMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderLibrary/ShaderOutputOptions ../lib/AnimationTimer ../lib/GLMaterials ../lib/Material ../lib/OrderIndependentTransparency ../lib/RenderSlot ./WaterGLMaterial ./WaterTechnique ./internal/DefaultBufferWriter ./internal/MaterialUtil ./internal/waterMaterialUtils".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r){x=function(y){function p(m){m=y.call(this,m,r.defaultWaterMaterialParameters)||this;m._techniqueConfig=new f.WaterTechniqueConfiguration;m.animation=new d.AnimationTimer;return m}b._inheritsLoose(p,y);var h=p.prototype;h.getTechniqueConfig=function(m,u){this._techniqueConfig.output=m;this._techniqueConfig.writeDepth=this.parameters.writeDepth;this._techniqueConfig.receiveShadows=this.parameters.receiveShadows;this._techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled;
this._techniqueConfig.transparent=this.parameters.transparent;this._techniqueConfig.useSSR=this.parameters.ssrEnabled;this._techniqueConfig.isDraped=this.parameters.isDraped;this._techniqueConfig.transparencyPassType=u.transparencyPassType;this._techniqueConfig.enableOffset=u.camera.relativeElevation<w.OITPolygonOffsetLimit;this._techniqueConfig.multipassTerrainEnabled=u.multipassTerrainEnabled;this._techniqueConfig.cullAboveGround=u.cullAboveGround;return this._techniqueConfig};h.update=function(m){this.animation.enabled=
35E3>Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*Math.min(m.camera.relativeElevation,m.camera.distance);m=this.animation.advance(m);return this.animation.enabled&&m};h.intersect=function(m,u,t,q,z,v,B){k.intersectTriangleGeometry(m,u,q,z,v,void 0,B)};h.requiresSlot=function(m,u){switch(g.outputFromPass(u)){case c.ShaderOutput.Normal:return m===l.RenderSlot.DRAPED_WATER;case c.ShaderOutput.Color:if(this.parameters.isDraped)return m===l.RenderSlot.DRAPED_MATERIAL;break;
case c.ShaderOutput.Highlight:return m===l.RenderSlot.OPAQUE_MATERIAL||m===l.RenderSlot.DRAPED_MATERIAL}u=l.RenderSlot.OPAQUE_MATERIAL;this.parameters.transparent&&(u=this.parameters.writeDepth?l.RenderSlot.TRANSPARENT_MATERIAL:l.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL);return m===u};h.createGLMaterial=function(m){if(m.output===c.ShaderOutput.Color&&this.parameters.isDraped)return m.output=c.ShaderOutput.Draped,new n.WaterGLMaterial(m);switch(m.output){case c.ShaderOutput.Color:case c.ShaderOutput.Normal:case c.ShaderOutput.Highlight:case c.ShaderOutput.Alpha:return new n.WaterGLMaterial(m)}return null};
h.createBufferWriter=function(){return new e.DefaultBufferWriter(e.PositionUVLayout)};return p}(x.Material);a.WaterMaterial=x;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/WaterGLMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderLibrary/ShaderOutputOptions ../lib/basicInterfaces ../lib/GLMaterial ./WaterTechnique".split(" "),function(a,b,c,d,g,x){g=function(w){function l(){return w.apply(this,arguments)||this}
b._inheritsLoose(l,w);var n=l.prototype;n.updateParameters=function(f){return this.ensureTechnique(x.WaterTechnique,f)};n.setElapsedTimeUniform=function(f){f.setUniform1f("timeElapsed",.001*this._material.animation.time*this._material.parameters.animationSpeed)};n._updateShadowState=function(f){f.shadowMappingEnabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:f.shadowMappingEnabled})};n._updateSSRState=function(f){f.ssrEnabled!==this._material.parameters.ssrEnabled&&
this._material.setParameters({ssrEnabled:f.ssrEnabled})};n.ensureResources=function(f){const e=this._techniqueRep.constructionContext.waterTextureRepository;e.ready||e.updating||e.loadTextures(f);return e.ready?d.ResourceState.LOADED:d.ResourceState.LOADING};n.beginSlot=function(f){this._output===c.ShaderOutput.Color&&(this._updateShadowState(f),this._updateSSRState(f));return this.updateParameters(f)};n.bind=function(f,e){e.bindPass(this._material.parameters,f);this._output!==c.ShaderOutput.Normal&&
this._output!==c.ShaderOutput.Color||this.setElapsedTimeUniform(e.program)};return l}(g);a.WaterGLMaterial=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/WaterTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../environment/CloudsComposition ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderLibrary/shading/ReadShadowMap.glsl ../core/shaderLibrary/shading/ScreenSpaceReflections.glsl ../core/shaderLibrary/shading/WaterDistortion.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../../../../chunks/WaterSurface.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E){u=function(C){function D(G,J,I){J=C.call(this,G,J,I)||this;J._textureRepository=G.waterTextureRepository;return J}c._inheritsLoose(D,C);var F=D.prototype;F.initializeProgram=function(G){var J=D.shader.get();const I=this.configuration;J=J.build({oitEnabled:I.transparencyPassType===q.TransparencyPassType.Color,output:I.output,viewingMode:G.viewingMode,slicePlaneEnabled:I.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,
receiveShadows:I.receiveShadows,pbrMode:k.PBRMode.Water,useCustomDTRExponentForWater:!0,ssrEnabled:I.useSSR,cloudsReflectionsEnabled:g("enable-feature:clouds-reflections"),highStepCount:!0,multipassTerrainEnabled:I.multipassTerrainEnabled,cullAboveGround:I.cullAboveGround});return new B.Program(G.rctx,J,z.Default3D)};F.bindPass=function(G,J){h.bindProjectionMatrix(this.program,J.camera.projectionMatrix);J.multipassTerrainEnabled&&(this.program.setUniform2fv("nearFar",J.camera.nearFar),this.program.setUniform2fv("inverseViewport",
J.inverseViewport),e.bindMultipassTerrainTexture(this.program,J));this.configuration.output===l.ShaderOutput.Color&&(J.lighting.setUniforms(this.program,!1,!1),y.bindSSRUniforms(this.program,J),g("enable-feature:clouds-reflections")&&x.isSome(J.cloudsCompositionParams)&&w.bindCloudsComposition(this.program,J.camera,J.cloudsCompositionParams));if(this.configuration.output===l.ShaderOutput.Color||this.configuration.output===l.ShaderOutput.Normal)p.bindWaterDistortionUniforms(this.program,G),this._textureRepository.bind(this.program);
this.program.setUniform4fv("waterColor",G.color);this.configuration.output===l.ShaderOutput.Highlight&&f.bindOutputHighlight(this.program,J)};F.bindDraw=function(G){h.bindView(this.program,G);this.program.rebindTextures();this.configuration.output!==l.ShaderOutput.Color&&this.configuration.output!==l.ShaderOutput.Alpha||h.bindCameraPosition(this.program,G.origin,G.camera.viewInverseTransposeMatrix);this.configuration.output===l.ShaderOutput.Color&&r.bindReadShadowMapUniforms(this.program,G);this.configuration.output!==
l.ShaderOutput.Color&&this.configuration.output!==l.ShaderOutput.Alpha&&this.configuration.output!==l.ShaderOutput.Highlight||n.bindSliceUniformsWithOrigin(this.program,this.configuration,G)};F._setPipelineState=function(G){const J=this.configuration,I=G===q.TransparencyPassType.NONE,O=G===q.TransparencyPassType.FrontFace;return E.makePipelineState({blending:J.output!==l.ShaderOutput.Normal&&J.output!==l.ShaderOutput.Highlight&&J.transparent?I?v.blendingDefault:v.oitBlending(G):null,depthTest:{func:v.oitDepthTest(G)},
depthWrite:I?J.writeDepth&&E.defaultDepthWriteParams:v.oitDepthWrite(G),colorWrite:E.defaultColorWriteParams,polygonOffset:I||O?null:v.getOITPolygonOffset(J.enableOffset)})};F.initializePipeline=function(){return this._setPipelineState(this.configuration.transparencyPassType)};return D}(u.ShaderTechnique);u.shader=new m.ReloadableShaderModule(A.WaterSurface,()=>new Promise((C,D)=>a(["../shaders/WaterSurface.glsl"],C,D)));m=function(C){function D(){var F=C.apply(this,arguments)||this;F.output=l.ShaderOutput.Color;
F.receiveShadows=!1;F.slicePlaneEnabled=!1;F.transparent=!1;F.enableOffset=!0;F.writeDepth=!1;F.useSSR=!1;F.isDraped=!1;F.transparencyPassType=q.TransparencyPassType.NONE;F.multipassTerrainEnabled=!1;F.cullAboveGround=!1;return F}c._inheritsLoose(D,C);return D}(t.ShaderTechniqueConfiguration);d.__decorate([t.parameter({count:l.ShaderOutput.COUNT})],m.prototype,"output",void 0);d.__decorate([t.parameter()],m.prototype,"receiveShadows",void 0);d.__decorate([t.parameter()],m.prototype,"slicePlaneEnabled",
void 0);d.__decorate([t.parameter()],m.prototype,"transparent",void 0);d.__decorate([t.parameter()],m.prototype,"enableOffset",void 0);d.__decorate([t.parameter()],m.prototype,"writeDepth",void 0);d.__decorate([t.parameter()],m.prototype,"useSSR",void 0);d.__decorate([t.parameter()],m.prototype,"isDraped",void 0);d.__decorate([t.parameter({count:q.TransparencyPassType.COUNT})],m.prototype,"transparencyPassType",void 0);d.__decorate([t.parameter()],m.prototype,"multipassTerrainEnabled",void 0);d.__decorate([t.parameter()],
m.prototype,"cullAboveGround",void 0);b.WaterTechnique=u;b.WaterTechniqueConfiguration=m;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl":function(){define(["exports","../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(a,b,c){a.ReadShadowMap=function(d){d.fragment.include(b.RgbaFloatEncoding);d.fragment.uniforms.add("shadowMapTex","sampler2D");d.fragment.uniforms.add("numCascades","int");d.fragment.uniforms.add("cascadeDistances",
"vec4");d.fragment.uniforms.add("shadowMapMatrix","mat4",4);d.fragment.uniforms.add("depthHalfPixelSz","float");d.fragment.code.add(c.glsl`int chooseCascade(float _linearDepth, out mat4 mat) {
vec4 distance = cascadeDistances;
float depth = _linearDepth;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, vec3 lvpos) {
return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;
}
float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
return rgba2float(texture2D(_depthTex, uv));
}
float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, float halfPixelSize, sampler2D _depthTex) {
float texSize = 0.5 / halfPixelSize;
vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);
float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0) { return 0.0; }
if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
vec2 uv = cascadeCoordinates(i, lvpos);
return filterShadow(uv, lvpos, depthHalfPixelSz, shadowMapTex);
}`)};a.bindReadShadowMapUniforms=function(d,g){g.shadowMappingEnabled&&(g.shadowMap.bind(d),g.shadowMap.bindView(d,g.origin))};a.bindReadShadowMapView=function(d,g){g.shadowMappingEnabled&&g.shadowMap.bindView(d,g.origin)};a.bindReadShadowMapViewCustomOrigin=function(d,g,x){g.shadowMappingEnabled&&g.shadowMap.bindView(d,x)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ScreenSpaceReflections.glsl":function(){define(["exports","../output/ReadLinearDepth.glsl",
"./Reprojection.glsl","../../shaderModules/interfaces"],function(a,b,c,d){a.ScreenSpaceReflections=function(g,x){g.fragment.uniforms.add("nearFar","vec2");g.fragment.uniforms.add("depthMapView","sampler2D");g.fragment.uniforms.add("view","mat4");g.fragment.uniforms.add("invResolutionHeight","float");g.fragment.include(b.ReadLinearDepth);g.include(c.Reprojection);g.fragment.code.add(d.glsl`
  const int maxSteps = ${x.highStepCount?"150;":"75;"}

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMapView, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
          return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)};a.bindSSRUniforms=function(g,x){x.ssrEnabled&&(g.bindTexture(x.linearDepthTexture,"depthMapView"),g.setUniform2fv("nearFar",x.camera.nearFar),g.setUniformMatrix4fv("view",x.camera.viewMatrix),g.setUniform1f("invResolutionHeight",1/x.camera.height),c.bindReprojectionUniforms(g,x))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Reprojection.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.Reprojection=
function(c){c.fragment.uniforms.add("lastFrameColorMap","sampler2D");c.fragment.uniforms.add("reprojectionMatrix","mat4");c.fragment.uniforms.add("proj","mat4");c.fragment.code.add(b.glsl`vec2 reprojectionCoordinate(vec3 projectionCoordinate)
{
vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
reprojectedCoord.xy /= reprojectedCoord.w;
return reprojectedCoord.xy * 0.5 + 0.5;
}`)};a.bindReprojectionUniforms=function(c,d){c.bindTexture(d.lastFrameColorTexture,"lastFrameColorMap");c.setUniformMatrix4fv("reprojectionMatrix",d.reprojectionMatrix);c.setUniformMatrix4fv("proj",d.camera.projectionMatrix)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/WaterDistortion.glsl":function(){define(["exports","./FoamRendering.glsl","../../shaderModules/interfaces"],function(a,b,c){a.WaterDistortion=function(d){d.fragment.uniforms.add("texWaveNormal",
"sampler2D");d.fragment.uniforms.add("texWavePerturbation","sampler2D");d.fragment.uniforms.add("waveParams","vec4");d.fragment.uniforms.add("waveDirection","vec2");d.include(b.FoamIntensity);d.fragment.code.add(c.glsl`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture2D(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)};a.bindWaterDistortionUniforms=function(d,g){d.setUniform4f("waveParams",g.waveStrength,g.waveTextureRepeat,g.flowStrength,g.flowOffset);d.setUniform2f("waveDirection",g.waveDirection[0]*g.waveVelocity,g.waveDirection[1]*g.waveVelocity)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/FoamRendering.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.FoamColor=function(c){c.fragment.code.add(b.glsl`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)};a.FoamIntensity=function(c){c.fragment.code.add(b.glsl`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/WaterSurface.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateMainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Water.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/WaterDistortion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q){function z(B){const A=new t.ShaderBuilder;A.include(g.Transform,{linearDepth:!1});A.attributes.add(q.VertexAttribute.POSITION,"vec3");A.attributes.add(q.VertexAttribute.UV0,"vec2");A.vertex.uniforms.add("proj","mat4").add("view","mat4").add("localOrigin","vec3");A.vertex.uniforms.add("waterColor","vec4");if(B.output===c.ShaderOutput.Color||B.output===c.ShaderOutput.Alpha)A.include(e.NormalUtils,B),A.include(b.ForwardLinearDepth,B),A.varyings.add("vuv",
"vec2"),A.varyings.add("vpos","vec3"),A.varyings.add("vnormal","vec3"),A.varyings.add("vtbnMatrix","mat3"),A.fragment.uniforms.add("localOrigin","vec3"),B.multipassTerrainEnabled&&A.varyings.add("depth","float"),A.vertex.code.add(u.glsl`
      void main(void) {
        if (waterColor.a < ${u.glsl.float(h.symbolAlphaCutoff)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${B.multipassTerrainEnabled?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${B.output===c.ShaderOutput.Color?"forwardLinearDepth();":""}
      }
    `);B.multipassTerrainEnabled&&(A.fragment.include(w.ReadLinearDepth),A.include(f.multipassTerrainTest,B));B.output===c.ShaderOutput.Alpha&&(A.include(d.Slice,B),A.fragment.uniforms.add("waterColor","vec4"),A.fragment.code.add(u.glsl`
        void main() {
          discardBySlice(vpos);
          ${B.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}

          gl_FragColor = vec4(waterColor.a);
        }
      `));B.output===c.ShaderOutput.Color&&(A.include(n.EvaluateMainLighting),A.include(l.EvaluateAmbientLighting,{pbrMode:k.PBRMode.Disabled,lightingSphericalHarmonicsOrder:2}),A.include(p.WaterDistortion,B),A.include(d.Slice,B),B.receiveShadows&&A.include(r.ReadShadowMap,B),A.include(y.Water,B),A.fragment.uniforms.add("waterColor","vec4").add("lightingMainDirection","vec3").add("lightingMainIntensity","vec3").add("lightingSpecularStrength","float").add("lightingEnvironmentStrength","float").add("cameraPosition",
"vec3").add("timeElapsed","float").add("view","mat4"),A.fragment.include(m.ColorConversion),A.fragment.code.add(u.glsl`
      void main() {
        discardBySlice(vpos);
        ${B.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${B.receiveShadows?u.glsl`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view*vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, lightingMainDirection, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        gl_FragColor = delinearizeGamma(final);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${B.oitEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
      }
    `));B.output===c.ShaderOutput.Normal&&(A.include(e.NormalUtils,B),A.include(p.WaterDistortion,B),A.include(d.Slice,B),A.varyings.add("vpos","vec3"),A.varyings.add("vuv","vec2"),A.vertex.code.add(u.glsl`
        void main(void) {
          if (waterColor.a < ${u.glsl.float(h.symbolAlphaCutoff)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),A.fragment.uniforms.add("timeElapsed","float"),A.fragment.code.add(u.glsl`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`));B.output===c.ShaderOutput.Draped&&(A.varyings.add("vpos","vec3"),A.vertex.code.add(u.glsl`
        void main(void) {
          if (waterColor.a < ${u.glsl.float(h.symbolAlphaCutoff)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),A.fragment.uniforms.add("waterColor","vec4"),A.fragment.code.add(u.glsl`void main() {
gl_FragColor = waterColor;
}`));B.output===c.ShaderOutput.Highlight&&(A.include(x.OutputHighlight),A.varyings.add("vpos","vec3"),A.vertex.code.add(u.glsl`
      void main(void) {
        if (waterColor.a < ${u.glsl.float(h.symbolAlphaCutoff)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),A.include(d.Slice,B),A.fragment.code.add(u.glsl`void main() {
discardBySlice(vpos);
outputHighlight();
}`));return A}const v=Object.freeze({__proto__:null,build:z});a.WaterSurface=v;a.build=z})},"esri/views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl":function(){define(["exports","./ShaderOutputOptions","../shaderModules/interfaces"],function(a,b,c){a.ForwardLinearDepth=function(d,g){g.output===b.ShaderOutput.Color&&g.receiveShadows?(d.varyings.add("linearDepth","float"),d.vertex.code.add(c.glsl`void forwardLinearDepth() { linearDepth = gl_Position.w; }`)):g.output===b.ShaderOutput.Depth||
g.output===b.ShaderOutput.Shadow?(d.varyings.add("linearDepth","float"),d.vertex.uniforms.add("nearFar","vec2"),d.vertex.code.add(c.glsl`void forwardLinearDepth() {
linearDepth = (-position_view().z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)):d.vertex.code.add(c.glsl`void forwardLinearDepth() {}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl":function(){define(["exports","../../../../../ViewingMode","../../shaderModules/interfaces"],function(a,b,c){a.NormalUtils=function(d,g){g.viewingMode===b.ViewingMode.Global?d.vertex.code.add(c.glsl`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):d.vertex.code.add(c.glsl`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`);g.viewingMode===b.ViewingMode.Global?d.vertex.code.add(c.glsl`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):d.vertex.code.add(c.glsl`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Water.glsl":function(){define("exports ./FoamRendering.glsl ./Gamma.glsl ./PhysicallyBasedRendering.glsl ./ScreenSpaceReflections.glsl ../util/CloudsParallaxShading.glsl ../../shaderModules/interfaces".split(" "),function(a,b,c,d,g,x,w){a.Water=function(l,n){l.include(d.PhysicallyBasedRendering,n);l.include(c.Gamma);l.include(b.FoamColor);n.cloudsReflectionsEnabled&&l.include(x.CloudsParallaxShading);
n.ssrEnabled&&l.include(g.ScreenSpaceReflections,n);l.fragment.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3E5).add("ssrHeightFadeEnd","float",5E5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",
[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]);l.fragment.code.add(w.glsl`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`);l.fragment.code.add(w.glsl`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 positionView, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`);n.cloudsReflectionsEnabled&&l.fragment.code.add(w.glsl`vec4 cloudsColor = crossFade == 0 ? renderCloud(reflectedWorld, position) : renderCloudCrossFade(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y*cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * (1.0 - totalFadeInOut);`);n.ssrEnabled?l.fragment.code.add(w.glsl`vec4 viewPosition = vec4(positionView.xyz, 1.0);
vec3 viewDir = normalize(viewPosition.xyz);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view *vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection( normalize(reflected), viewPosition.xyz, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -positionView.z);
reflectionHit = clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod*0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor + reflSea * seaColorMod + specular  + foam);`):l.fragment.code.add(w.glsl`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`);n.cloudsReflectionsEnabled?n.ssrEnabled?l.fragment.code.add(w.glsl`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):l.fragment.code.add(w.glsl`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):l.fragment.code.add(w.glsl`return waterRenderedColor;
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl":function(){define(["exports","./AnalyticalSkyModel.glsl","./PhysicallyBasedRenderingParameters.glsl","./PiUtils.glsl","../../shaderModules/interfaces"],function(a,b,c,d,g){a.PhysicallyBasedRendering=function(x,w){const l=x.fragment.code;x.include(d.PiUtils);if(w.pbrMode===c.PBRMode.Water||w.pbrMode===c.PBRMode.WaterOnIntegratedMesh)l.add(g.glsl`
    struct PBRShadingWater
    {
        float NdotL;   // cos angle between normal and light direction
        float NdotV;   // cos angle between normal and view direction
        float NdotH;   // cos angle between normal and half vector
        float VdotH;   // cos angle between view direction and half vector
        float LdotH;   // cos angle between light direction and half vector
        float VdotN;   // cos angle between view direction and normal vector
    };

    float dtrExponent = ${w.useCustomDTRExponentForWater?"2.2":"2.0"};
    `),l.add(g.glsl`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),l.add(g.glsl`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),l.add(g.glsl`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),l.add(g.glsl`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`);else if(w.pbrMode===c.PBRMode.Normal||w.pbrMode===c.PBRMode.Schematic)x.include(b.AnalyticalSkyModel),l.add(g.glsl`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),l.add(g.glsl`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),l.add(g.glsl`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`),l.add(g.glsl`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),l.add(g.glsl`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),l.add(g.glsl`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/AnalyticalSkyModel.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.AnalyticalSkyModel=function(c){c=c.fragment.code;c.add(b.glsl`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`);c.add(b.glsl`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`);c.add(b.glsl`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/internal/DefaultBufferWriter":function(){define(["exports","../../../support/buffer/InterleavedLayout","../../lib/VertexAttribute","./bufferWriterUtils"],function(a,b,c,d){const g=b.newLayout().vec3f(c.VertexAttribute.POSITION),x=b.newLayout().vec3f(c.VertexAttribute.POSITION).vec2f(c.VertexAttribute.UV0);b=b.newLayout().vec3f(c.VertexAttribute.POSITION).vec4u8(c.VertexAttribute.COLOR);let w=function(){function l(f){this.vertexBufferLayout=
f}var n=l.prototype;n.allocate=function(f){return this.vertexBufferLayout.createBuffer(f)};n.elementCount=function(f){return f.indices.get(c.VertexAttribute.POSITION).length};n.write=function(f,e,k,r){d.writeDefaultAttributes(e,this.vertexBufferLayout,f.transformation,f.invTranspTransformation,k,r)};return l}();a.DefaultBufferWriter=w;a.PositionColorLayout=b;a.PositionLayout=g;a.PositionUVLayout=x;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/internal/waterMaterialUtils":function(){define(["exports",
"../../../../../chunks/vec2f64","../../lib/Material"],function(a,b,c){b={waveStrength:.06,waveTextureRepeat:32,waveDirection:b.fromValues(1,0),waveVelocity:.05,flowStrength:.015,flowOffset:-.5,animationSpeed:.35,color:[0,0,0,0],transparent:!0,writeDepth:!0,slicePlaneEnabled:!1,isDraped:!1,receiveShadows:!0,ssrEnabled:!1,...c.DefaultMaterialParameters};a.defaultWaterMaterialParameters=b;a.wavePresets={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,
perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,
waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}};Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/renderers/Instance":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){function c(w,l){return w.from===l.from?w.to-l.to:w.from-l.from}let d=function(w){this.first=w.from;this.count=w.to-w.from},g=function(w=0,l=0){this.from=w;this.to=l},x=function(w){function l(n,f,e,k,r,y){f=w.call(this,f,e)||this;f.id=n;f.isVisible=k;f.hasHighlights=r;f.hasOccludees=y;return f}b._inheritsLoose(l,w);return l}(g);
a.BufferRange=g;a.DrawCommand=d;a.Instance=x;a.addOrMerge=function(w,l){if(0===w.length)w.push(new d(l));else{var n=w[w.length-1];n.first+n.count>=l.from?n.count=l.from-n.first+l.to-l.from:w.push(new d(l))}};a.sortInstancesByRange=function(w){return Array.from(w.values()).sort(c)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/renderers/MergedGeometryBuffer":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){function c(g,
x,w){return x<=w?g>=w?g:65536*Math.ceil(Math.max(2*g,w)/65536):g<=2*w?g:65536*Math.ceil(w/65536)}let d=function(){function g(w,l){this._pool=w;this._size=0;this._buffer=w.newBuffer(65536*Math.ceil(l/65536))}var x=g.prototype;x.dispose=function(){this._buffer=this._pool.deleteBuffer(this._buffer);this._size=0};x.release=function(){this.erase(0,this._size);this.dispose()};x.grow=function(w){this._resize(this._size+w,!0).dispose()};x.alloc=function(w){return this._resize(w,!1)};x._resize=function(w,
l){let n;const f=c(this._buffer.length,this._size,w);if(this._buffer.length!==f){const k=this._pool.newBuffer(f);l&&(k.array.set(this._buffer.array.subarray(0,Math.min(this._size,f))),k.vao.vertexBuffers.geometry.setSubData(k.array,0,0,k.array.byteLength));n=this._buffer;this._buffer=k}const e=this._size;this._size=w;return n?{dispose:()=>{n.array.fill(0,0,e);this._pool.deleteBuffer(n)},copy:(k,r,y)=>this._buffer.array.set(n.array.subarray(r,y),k),hasNewBuffer:!0}:{dispose:()=>{},copy:(k,r,y)=>{k!==
r&&this._buffer.array.copyWithin(k,r,y)},hasNewBuffer:!1}};x.erase=function(w,l){this._buffer.array.fill(0,w,l)};b._createClass(g,[{key:"vao",get:function(){return this._buffer.vao}},{key:"array",get:function(){return this._buffer.array}},{key:"size",get:function(){return this._size}}]);return g}();a.MergedGeometryBuffer=d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/renderers/MergedGeometryBufferPool":function(){define(["exports","../../../../../core/maybe",
"../../../../../core/MemCache","../../../../../core/uid","../../lib/StaticFloat32ArrayObject"],function(a,b,c,d,g){function x(n,f){if(f===c.RemoveMode.ALL)n.forEach(e=>e.dispose());else return f=n.pop(),n=n.length*f.array.byteLength,f.dispose(),n}const w=c.MIN_PRIORITY+1;let l=function(){function n(e,k,r){this._rctx=e;this._locations=k;this._layout=r;this._cache=e.newCache(`MergedRenderer pool ${d.generateUID()}`,x)}var f=n.prototype;f.dispose=function(){this._cache.destroy()};f.newBuffer=function(e){const k=
e.toString(),r=this._cache.pop(k);return b.isSome(r)?(e=r.pop(),0<r.length&&this._cache.put(k,r,e.array.byteLength*r.length,w),e):new g.StaticFloat32ArrayObject(this._rctx,this._locations,this._layout,e)};f.deleteBuffer=function(e){const k=e.array.byteLength,r=e.array.length.toString(),y=this._cache.pop(r);b.isSome(y)?(y.push(e),this._cache.put(r,y,k*y.length,-1)):this._cache.put(r,[e],k,-1);return null};return n}();a.MergedGeometryBufferPool=l;Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/webgl-engine/lib/StaticFloat32ArrayObject":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../webgl/BufferObject","../../../webgl/enums","../../../webgl/VertexArrayObject"],function(a,b,c,d,g){let x=function(){function w(l,n,f,e){this.vao=new g.VertexArrayObject(l,n,{geometry:f},{geometry:c.BufferObject.createVertex(l,d.Usage.STATIC_DRAW)});this.array=new Float32Array(e);this.vao.vertexBuffers.geometry.setSize(this.array.byteLength)}w.prototype.dispose=
function(){this.vao.dispose(!0)};b._createClass(w,[{key:"length",get:function(){return this.array.length}}]);return w}();a.StaticFloat32ArrayObject=x;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/HeatmapDensityMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../support/buffer/InterleavedLayout ../lib/GLMaterial ../lib/Material ../lib/RenderPass ../lib/RenderSlot ../lib/VertexAttribute ./internal/bufferWriterUtils ../shaders/HeatmapDensityTechnique".split(" "),
function(a,b,c,d,g,x,w,l,n,f){const e={searchRadius:128,resolutionForScale:0,colorRampData:null,isAttributeDriven:!1,minDensity:0,maxDensity:100,fieldTotal:0,pixelRatio:1,...g.DefaultMaterialParameters};let k=function(m){function u(q){q=m.call(this,q,e)||this;q._techniqueConfig=new f.HeatmapDensityTechniqueConfiguration;return q}b._inheritsLoose(u,m);var t=u.prototype;t.requiresSlot=function(q,z){return q===w.RenderSlot.DRAPED_MATERIAL&&z===x.RenderPass.MATERIAL};t.getTechniqueConfig=function(){this._techniqueConfig.isAttributeDriven=
this.parameters.isAttributeDriven;return this._techniqueConfig};t.createGLMaterial=function(q){return new r(q)};t.intersect=function(){};t.createBufferWriter=function(){return new y(this.parameters.isAttributeDriven?h:p)};return u}(g.Material),r=function(m){function u(q){return m.call(this,q)||this}b._inheritsLoose(u,m);var t=u.prototype;t.beginSlot=function(q){return this.updateParameters(q)};t.updateParameters=function(q){return this.ensureTechnique(f.HeatmapDensityTechnique,q)};t.bind=function(q,
z){z.bindPass(this._material.parameters,q)};return u}(d),y=function(){function m(t){this.vertexBufferLayout=t}var u=m.prototype;u.allocate=function(t){return this.vertexBufferLayout.createBuffer(t)};u.elementCount=function(t){return 6*t.indices.get(l.VertexAttribute.POSITION).length};u.write=function(t,q,z,v){n.writePosition(q.indices.get(l.VertexAttribute.POSITION),q.vertexAttributes.get(l.VertexAttribute.POSITION).data,t.transformation,z.position,v,6);t=q.indices.get(l.VertexAttribute.POSITION).length;
const B=z.uv0;let A=v;for(let E=0;E<t;++E)B.setValues(A++,-1,-1),B.setValues(A++,1,-1),B.setValues(A++,1,1),B.setValues(A++,1,1),B.setValues(A++,-1,1),B.setValues(A++,-1,-1);(z="featureAttribute"in z?z.featureAttribute:null)&&n.writeBufferFloat(q.indices.get(l.VertexAttribute.FEATUREATTRIBUTE),q.vertexAttributes.get(l.VertexAttribute.FEATUREATTRIBUTE).data,z,v,6)};return m}();const p=c.newLayout().vec3f(l.VertexAttribute.POSITION).vec2f(l.VertexAttribute.UV0),h=p.clone().f32(l.VertexAttribute.FEATUREATTRIBUTE);
Object.defineProperty(a,"RadiusMode",{enumerable:!0,get:()=>f.RadiusMode});a.HeatmapDensityMaterial=k;a.isHeatMapDensityMaterial=function(m){return m instanceof k};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/HeatmapDensityTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../renderers/support/heatmapUtils ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/HeatmapDensity.glsl ../../../webgl/enums ../../../webgl/renderState ../../../webgl/Texture".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h){b.RadiusMode=void 0;(function(m){m[m.Screen=0]="Screen";m[m.World=1]="World"})(b.RadiusMode||(b.RadiusMode={}));n=function(m){function u(q,z,v){z=m.call(this,q,z,v)||this;z._kernelBlurRadius=1;const {R32F:B,textureFloatLinear:A}=q.rctx.capabilities.textureFloat;v=null!=B;z._kernelTextureChannels=v?1:4;z._floatInterpolationDisabled=!A;z._kernel=new h.Texture(q.rctx,{target:y.TextureType.TEXTURE_2D,pixelFormat:v?y.PixelFormat.RED:y.PixelFormat.RGBA,internalFormat:v?
y.SizedPixelFormat.R32F:y.PixelFormat.RGBA,dataType:y.PixelType.FLOAT,samplingMode:y.TextureSamplingMode.NEAREST,wrapMode:y.TextureWrapMode.CLAMP_TO_EDGE,width:1,height:1});return z}c._inheritsLoose(u,m);var t=u.prototype;t.initializeProgram=function(q){const z=u.shader.get().build({isAttributeDriven:this.configuration.isAttributeDriven,mode:this.configuration.mode});return new k.Program(q.rctx,z,e.Default3D)};t.initializePipeline=function(){return p.makePipelineState({blending:p.simpleBlendingParams(y.BlendFactor.ONE,
y.BlendFactor.ONE,y.BlendOperation.ADD),colorWrite:p.defaultColorWriteParams,depthTest:null,depthWrite:null})};t.bindPass=function(q,z){const {camera:v}=z,{mode:B}=this.configuration;w.bindProjectionMatrix(this.program,v.projectionMatrix);switch(B){case r.HeatmapMode.KernelDensity:this._bindKernelDensityPass(q,z);break;case r.HeatmapMode.GaussianBlur:this._bindGaussianBlurPass(q,z)}};t.bindDraw=function(q){w.bindView(this.program,q)};t._bindKernelDensityPass=function({searchRadius:q,resolutionForScale:z},
{camera:v,screenToWorldRatio:B}){0!==z&&(q/=B/z);this.program.setUniform1f("radius",q*v.pixelRatio/v.fullViewport[2])};t._bindGaussianBlurPass=function({searchRadius:q,resolutionForScale:z},{camera:v,screenToWorldRatio:B}){q=Math.round(q);B=3*(0===z?q:q*z/B);0===z||this._floatInterpolationDisabled?this._kernel.setSamplingMode(y.TextureSamplingMode.NEAREST):this._kernel.setSamplingMode(y.TextureSamplingMode.LINEAR);this._kernelBlurRadius!==q&&this._recomputeKernel(q);this.program.setUniform1f("radius",
2*B*v.pixelRatio/v.fullViewport[2]);this.program.bindTexture(this._kernel,"kernel")};t._recomputeKernel=function(q){const z=x.createKernel(q),v=Math.ceil(z.length/2),B=this._kernelTextureChannels,A=new Float32Array(v*B);for(let E=0;E<v;++E){const C=z[v-1-E];for(let D=0;D<B;++D)A[E*B+D]=C}this._kernel.resize(v,1);this._kernel.setData(A);this._kernelBlurRadius=q};t.destroy=function(){this._kernel=g.disposeMaybe(this._kernel);m.prototype.destroy.call(this)};return u}(n.ShaderTechnique);n.shader=new l.ReloadableShaderModule(r.HeatmapDensityShader,
()=>new Promise((m,u)=>a(["./HeatmapDensity.glsl"],m,u)));l=function(m){function u(){var t=m.apply(this,arguments)||this;t.isAttributeDriven=!1;t.mode=r.HeatmapMode.GaussianBlur;return t}c._inheritsLoose(u,m);return u}(f.ShaderTechniqueConfiguration);d.__decorate([f.parameter()],l.prototype,"isAttributeDriven",void 0);d.__decorate([f.parameter()],l.prototype,"mode",void 0);Object.defineProperty(b,"HeatmapMode",{enumerable:!0,get:()=>r.HeatmapMode});b.HeatmapDensityTechnique=n;b.HeatmapDensityTechniqueConfiguration=
l;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/renderers/support/heatmapUtils":function(){define(["exports","../../core/mathUtils"],function(a,b){function c(l,n,f,e,k){l=new Uint32Array(l*l);n="buffer"in n?n:new Float64Array(n);f="buffer"in f?new Uint32Array(f.buffer):new Uint32Array((new Uint8Array(f)).buffer);k=f.length/(k-e);for(let r=0;r<n.length;r++)l[r]=f[b.clamp(Math.floor((n[r]-e)*k),0,f.length-1)];return l.buffer}function d(l){const n=Math.round(3*l),f=2*l*l,e=new Float64Array(2*
n+1);for(let k=0;k<=e.length;k++)e[k]=Math.exp(-((k-n)**2)/f)/Math.sqrt(2*Math.PI)*(l/2);return e}function g(l,n){return"function"===typeof l?l:l?"string"===typeof n?f=>-1*+f[l]:f=>+f[l]+n:()=>1}function x(l,n){return null!=l?"string"===typeof n?f=>-1*+f.readAttribute(l):f=>+f.readAttribute(l)+n:f=>1}const w=(()=>{if(!("document"in globalThis))return()=>null;const l=document.createElement("canvas"),n=l.getContext("2d");l.height=512;l.width=1;return f=>{n.clearRect(0,0,1,l.height);const e=n.createLinearGradient(0,
0,0,l.height);for(const {ratio:k,color:r}of f)e.addColorStop(Math.max(k,.001),`rgba(${r.r}, ${r.g}, ${r.b}, ${r.a})`);n.fillStyle=e;n.fillRect(0,0,1,l.height);return n.getImageData(0,0,1,l.height).data}})();a.calculateHeatmapIntensityInfo=function(l,n,f,e){const {blurRadius:k,fieldOffset:r,field:y}=n;n=new Float64Array(f*e);const p=d(k),h=Math.round(3*k);let m=Number.NEGATIVE_INFINITY;const u=g(y,r);for(const {geometry:q,attributes:z}of l){l=q.x-h;const v=q.y-h,B=Math.max(0,l);var t=Math.max(0,v);
const A=Math.min(e,q.y+h),E=Math.min(f,q.x+h),C=+u(z);for(let D=t;D<A;D++){const F=p[D-v];for(let G=B;G<E;G++)t=n[D*f+G]+=F*p[G-l]*C,t>m&&(m=t)}}return{matrix:n.buffer,max:m}};a.calculateHeatmapIntensityInfoReaders=function(l,n,f,e){const {blurRadius:k,fieldOffset:r,field:y}=n;n=new Float64Array(f*e);const p=d(k),h=Math.round(3*k);let m=Number.NEGATIVE_INFINITY;const u=x(y,r),t=new Set;for(const B of l)for(l=B.getCursor();l.next();){var q=l.getObjectId();if(t.has(q))continue;t.add(q);var z=l.readLegacyPointGeometry();
if(-128>z.x||z.x>=f+128||-128>z.y||z.y>e+128)continue;q=+u(l);const A=Math.round(z.x)-h,E=Math.round(z.y)-h,C=Math.max(0,A);var v=Math.max(0,E);const D=Math.min(e,Math.round(z.y)+h);z=Math.min(f,Math.round(z.x)+h);for(let F=v;F<D;F++){const G=p[F-E];for(let J=C;J<z;J++)v=n[F*f+J]+=G*p[J-A]*q,v>m&&(m=v)}}return{matrix:n.buffer,max:m}};a.createHeatmapImageData=c;a.createKernel=d;a.createValueFunction=g;a.createValueFunctionCursor=x;a.drawHeatmap=function(l,n,f,e,k,r){l.canvas.width=l.canvas.height=
n;l.clearRect(0,0,n,n);const y=l.getImageData(0,0,n,n);f&&e&&y.data.set(new Uint8ClampedArray(c(n,f,e,k,r)));l.putImageData(y,0,0)};a.generateGradient=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/HeatmapDensity.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/lib/VertexAttribute"],function(a,b,c,d){function g(w){const l=new c.ShaderBuilder,{mode:n,
isAttributeDriven:f}=w;l.attributes.add(d.VertexAttribute.POSITION,"vec3");l.attributes.add(d.VertexAttribute.UV0,"vec2");w.isAttributeDriven&&(l.attributes.add(d.VertexAttribute.FEATUREATTRIBUTE,"float"),l.varyings.add("attributeValue","float"));l.varyings.add("unitCirclePos","vec2");l.vertex.uniforms.add("radius","float");l.vertex.uniforms.add("proj","mat4");l.vertex.uniforms.add("view","mat4");l.vertex.code.add(b.glsl`
    void main() {
      unitCirclePos = uv0;

      vec4 posProj = proj * (view * vec4(${d.VertexAttribute.POSITION}, 1.0));
      vec4 quadOffset = vec4(unitCirclePos * radius, 0.0, 0.0);

      ${f?b.glsl`attributeValue = ${d.VertexAttribute.FEATUREATTRIBUTE};`:""}
      gl_Position = posProj + quadOffset;
    }
  `);n===a.HeatmapMode.KernelDensity?l.fragment.code.add(b.glsl`
      void main() {
        float radiusRatioSquared = dot(unitCirclePos, unitCirclePos);
        if (radiusRatioSquared > 1.0) {
          discard;
        }

        float oneMinusRadiusRatioSquared = 1.0 - radiusRatioSquared;
        float density = oneMinusRadiusRatioSquared * oneMinusRadiusRatioSquared ${f?b.glsl` * attributeValue`:""};
        gl_FragColor = vec4(density);
      }
    `):n===a.HeatmapMode.GaussianBlur&&(l.fragment.uniforms.add("kernel","sampler2D"),l.fragment.code.add(b.glsl`
    void main() {
      float radiusRatioSquared = dot(unitCirclePos, unitCirclePos);
      if (radiusRatioSquared > 1.0) {
        discard;
      }

      vec2 uv = abs(unitCirclePos);
      vec2 uvX = vec2(uv.x, 0.5);
      vec2 uvY = vec2(uv.y, 0.5);
      float intensity = texture2D(kernel, uvX).r * texture2D(kernel, uvY).r${f?b.glsl` * attributeValue`:""};
      gl_FragColor = vec4(intensity);
    }
  `));return l}a.HeatmapMode=void 0;(function(w){w[w.GaussianBlur=0]="GaussianBlur";w[w.KernelDensity=1]="KernelDensity"})(a.HeatmapMode||(a.HeatmapMode={}));const x=Object.freeze({__proto__:null,get HeatmapMode(){return a.HeatmapMode},build:g});a.HeatmapDensityShader=x;a.build=g})},"esri/views/3d/webgl-engine/shaders/HeatmapTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../../../../chunks/Heatmap.glsl ../../../webgl/enums ../../../webgl/renderState ../../../../chunks/HeatmapDensity.glsl".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y){x=function(p){function h(u,t){var q;return q=p.call(this,u,t,()=>q.destroy())||this}c._inheritsLoose(h,p);var m=h.prototype;m.initializeProgram=function(u){const t=h.shader.get().build({mode:this.configuration.mode});return new f.Program(u.rctx,t,l.Default3D)};m.initializePipeline=function(u){return r.makePipelineState({blending:n.blendingDefault,colorWrite:r.defaultColorWriteParams,depthTest:null,depthWrite:null})};m.bindPass=function(u,t){const {densityMap:q,
colorRamp:z,maxDensity:v,minDensity:B,searchRadius:A}=u;this.program.bindTexture(q,"densityMap");this.program.bindTexture(z,"tex");this.configuration.mode===y.HeatmapMode.KernelDensity&&this.program.setUniform1f("densityMultiplier",3/(A*A*Math.PI));this.program.setUniform1f("densityNormalizer",1/(v-B));this.program.setUniform1f("minDensity",B)};c._createClass(h,[{key:"primitiveType",get:function(){return k.PrimitiveType.TRIANGLE_STRIP}}]);return h}(x.ShaderTechnique);x.shader=new g.ReloadableShaderModule(e.HeatmapShader,
()=>new Promise((p,h)=>a(["./Heatmap.glsl"],p,h)));g=function(p){function h(){var m=p.apply(this,arguments)||this;m.mode=y.HeatmapMode.GaussianBlur;return m}c._inheritsLoose(h,p);return h}(w.ShaderTechniqueConfiguration);d.__decorate([w.parameter()],g.prototype,"mode",void 0);Object.defineProperty(b,"HeatmapMode",{enumerable:!0,get:()=>y.HeatmapMode});b.HeatmapTechnique=x;b.HeatmapTechniqueConfiguration=g;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/Heatmap.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/basicInterfaces ./HeatmapDensity.glsl".split(" "),
function(a,b,c,d,g,x,w){function l(f){const e=new g.ShaderBuilder;({mode:f}=f);e.include(b.ScreenSpacePass);e.include(c.DiscardOrAdjustAlpha,{alphaDiscardMode:x.AlphaDiscardMode.Blend});e.fragment.uniforms.add("densityMap","sampler2D");e.fragment.uniforms.add("tex","sampler2D");e.fragment.uniforms.add("densityNormalizer","float");e.fragment.uniforms.add("minDensity","float");f===w.HeatmapMode.KernelDensity&&e.fragment.uniforms.add("densityMultiplier","float");e.fragment.code.add(d.glsl`
    void main() {
      float density = texture2D(densityMap, uv).r${f===w.HeatmapMode.KernelDensity?d.glsl` * densityMultiplier`:""};
      float densityRatio = (density - minDensity) * densityNormalizer;

      vec4 color = texture2D(tex, vec2(clamp(densityRatio, 0.0, 1.0), 0.5));

      discardOrAdjustAlpha(color);
      gl_FragColor = color;
    }
  `);return e}const n=Object.freeze({__proto__:null,build:l,get HeatmapMode(){return w.HeatmapMode}});a.HeatmapShader=n;a.build=l})},"esri/views/3d/webgl-engine/lib/GLMaterialRepository":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Logger ../../../../core/maybe ../../../../core/NestedMap ./Util".split(" "),function(a,b,c,d,g,x){const w=c.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository");let l=function(){function n(e){this._glMaterial=e;this.refCnt=
0;this._glMaterial=e}var f=n.prototype;f.incRefCnt=function(){++this.refCnt};f.decRefCnt=function(){--this.refCnt;x.assert(0<=this.refCnt)};f.getRefCnt=function(){return this.refCnt};b._createClass(n,[{key:"glMaterial",get:function(){return this._glMaterial}}]);return n}();c=function(){function n(e,k,r,y){this._textureRepository=e;this._techniqueRepository=k;this.materialChanged=r;this.requestRender=y;this._id2glMaterialRef=new g.NestedMap}var f=n.prototype;f.dispose=function(){this._textureRepository.dispose()};
f.acquire=function(e,k){this._ownMaterial(e);var r=this._id2glMaterialRef.get(k,e.id);d.isNone(r)&&(r=e.createGLMaterial({material:e,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:k}),r=new l(r),this._id2glMaterialRef.set(k,e.id,r));r.incRefCnt();return r.glMaterial};f.release=function(e,k){const r=this._id2glMaterialRef.get(k,e.id);d.isSome(r)&&(r.decRefCnt(),0===r.getRefCnt()&&(d.disposeMaybe(r.glMaterial),this._id2glMaterialRef.delete(k,e.id)))};f._ownMaterial=
function(e){d.isSome(e.repository)&&e.repository!==this&&w.error("Material is already owned by a different material repository");e.repository=this};return n}();a.GLMaterialRepository=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/GridLocalOriginFactory":function(){define("exports ../../../../core/maybe ../../../../core/uid ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ./basicInterfaces ./Geometry ./LocalOriginFactory ./Object3D ./VertexAttribute ./WebGLLayer ../materials/RibbonLineMaterial".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y){function p(t){m=t}let h=function(){function t(z,v=125E4){this._originSR=z;this._gridSize=v;this._origins=new Map;this._objects=new Map;this._rootOriginId="root/"+c.generateUID()}var q=t.prototype;q.getOrigin=function(z){const v=this._origins.get(this._rootOriginId);if(null==v){if(b.isSome(m))return this._origins.set(this._rootOriginId,f.fromValues(m[0],m[1],m[2],this._rootOriginId)),this.getOrigin(z);z=f.fromValues(z[0]+Math.random()-.5,z[1]+Math.random()-.5,
z[2]+Math.random()-.5,this._rootOriginId);this._origins.set(this._rootOriginId,z);return z}var B=this._gridSize;const A=Math.round(z[0]/B),E=Math.round(z[1]/B),C=Math.round(z[2]/B),D=`${A}/${E}/${C}`;let F=this._origins.get(D);const G=.5*B;g.subtract(u,z,v.vec3);u[0]=Math.abs(u[0]);u[1]=Math.abs(u[1]);u[2]=Math.abs(u[2]);if(u[0]<G&&u[1]<G&&u[2]<G)return F&&(B=Math.max(...u),g.subtract(u,z,F.vec3),u[0]=Math.abs(u[0]),u[1]=Math.abs(u[1]),u[2]=Math.abs(u[2]),Math.max(...u)<B)?F:v;F||(F=f.fromValues(A*
B,E*B,C*B,D),this._origins.set(D,F));return F};q._drawOriginBox=function(z,v=[1,1,0,1]){const B=window.view,A=B._stage;var E=v.toString();if(!this._objects.has(E)){this._material=new y.RibbonLineMaterial({width:2,color:v});A.add(this._material);v=new r.WebGLLayer({isPickable:!1});var C=new e.Object3D({castShadow:!1});A.add(C);v.add(C);A.add(v);this._objects.set(E,C)}E=this._objects.get(E);v=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0];C=v.length;const D=Array(3*C),F=new Uint16Array(2*(C-1)),G=.5*this._gridSize;
for(let J=0;J<C;J++)D[3*J]=z[0]+(v[J]&1?G:-G),D[3*J+1]=z[1]+(v[J]&2?G:-G),D[3*J+2]=z[2]+(v[J]&4?G:-G),0<J&&(F[2*J]=J-1,F[2*J+1]=J);w.projectBuffer(D,this._originSR,0,D,B.renderSpatialReference,0,C);z=new n.Geometry([[k.VertexAttribute.POSITION,{size:3,data:D,exclusive:!0}]],[[k.VertexAttribute.POSITION,F]],l.PrimitiveType.Line);A.add(z);E.addGeometry(z,this._material,d.IDENTITY)};return t}(),m=null;const u=x.create();a.GridLocalOriginFactory=h;a.default=p;a.setTestRootOrigin=p;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/WebGLLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Evented ../../../../core/Handles ../../../../core/maybe ../../../../core/PooledArray ./basicInterfaces ./ContentObject ./ContentObjectType ./DirtyEvents ./Octree".split(" "),function(a,b,c,d,g,x,w,l,n,f,e){l=function(k){function r(p,h=""){var m,u,t;var q=k.call(this)||this;q.apiLayerUid=h;q.type=n.ContentObjectType.Layer;q.events=new c;q.isSliceable=
!1;q._objects=new x;q._stageHandles=new d;q.apiLayerUid=h;q.isVisible=null!=(m=null==p?void 0:p.isVisible)?m:!0;q.isPickable=null!=(u=null==p?void 0:p.isPickable)?u:!0;q.updatePolicy=null!=(t=null==p?void 0:p.updatePolicy)?t:w.UpdatePolicy.ASYNC;return q}b._inheritsLoose(r,k);var y=r.prototype;y.destroy=function(){this.detachStage();this._stage=null};y.attachStage=function(p){this.detachStage();this._stage=p;for(const h of f.DirtyEventNames)this._stageHandles.add(this.events.on(h,m=>p.handleEvent(h,
m)))};y.detachStage=function(){this._stageHandles.removeAll();this.invalidateSpatialQueryAccelerator()};y.add=function(p){this._objects.push(p);p.parentLayer=this;this.events.emit("layerObjectAdded",{layer:this,object:p});g.isSome(this._octree)&&this._octree.add([p])};y.remove=function(p){this._objects.removeUnordered(p)&&(p.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:p}),g.isSome(this._octree)&&this._octree.remove([p]))};y.addMany=function(p){this._objects.pushArray(p);
for(const h of p)h.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:p});g.isSome(this._octree)&&this._octree.add(p)};y.removeMany=function(p){const h=[];this._objects.removeUnorderedMany(p,p.length,h);if(0!==h.length){for(const m of h)m.parentLayer=null;this.events.emit("layerObjectsRemoved",{layer:this,objects:h});g.isSome(this._octree)&&this._octree.remove(h)}};y.sync=function(){g.isSome(this._stage)&&this.updatePolicy!==w.UpdatePolicy.SYNC&&this._stage.syncLayer(this.id)};
y.notifyObjectBBChanged=function(p,h){g.isSome(this._octree)&&this._octree.update(p,h)};y.getSpatialQueryAccelerator=function(){g.isNone(this._octree)&&50<this._objects.length&&this._createOctree();return this._octree};y.shaderTransformationChanged=function(){this.invalidateSpatialQueryAccelerator();this.events.emit("shaderTransformationChanged",this)};y.invalidateSpatialQueryAccelerator=function(){this._octree=g.destroyMaybe(this._octree)};y._createOctree=function(){this._octree=new e.default(p=>
p.boundingVolumeWorldSpace.bounds);this._octree.add(this._objects.data,this._objects.length)};b._createClass(r,[{key:"objects",get:function(){return this._objects}}]);return r}(l.ContentObject);a.WebGLLayer=l;a.isWebGLLayer=function(k){return g.isSome(k)&&k.type===n.ContentObjectType.Layer};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/DirtyEvents":function(){define(["exports"],function(a){a.DirtyEventNames="layerObjectAdded layerObjectRemoved layerObjectsAdded layerObjectsRemoved shaderTransformationChanged objectTransformation visibilityChanged occlusionChanged highlightChanged objectGeometryAdded objectGeometryRemoved vertexAttrsUpdated".split(" ");
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Octree":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/ObjectPool ../../../../core/PooledArray ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/frustum ../../../../geometry/support/ray ../../../../chunks/sphere ./Util".split(" "),function(a,b,c,d,g,x,w,l,n,f,e){function k(U,R,L){L[0]=U[0]+R;L[1]=U[1]+R;L[2]=U[2]+R}function r(U,
R,L,N){if(1===R)U=L(U[0]),f.copy(U,N);else{C[0]=Infinity;C[1]=Infinity;C[2]=Infinity;D[0]=-Infinity;D[1]=-Infinity;D[2]=-Infinity;for(let Q=0;Q<R;Q++){var T=L(U[Q]);if(m(T[3])){var S=C,H=T;S[0]=Math.min(S[0],H[0]-H[3]);S[1]=Math.min(S[1],H[1]-H[3]);S[2]=Math.min(S[2],H[2]-H[3]);S=D;S[0]=Math.max(S[0],T[0]+T[3]);S[1]=Math.max(S[1],T[1]+T[3]);S[2]=Math.max(S[2],T[2]+T[3])}}x.lerp(N,C,D,.5);N[3]=Math.max(D[0]-C[0],D[1]-C[1],D[2]-C[2])/2}}function y(U,R,L){if(!K.length)for(var N=0;8>N;++N)K.push({index:0,
distance:0});for(N=0;8>N;++N){const T=q[N];K.data[N].index=N;K.data[N].distance=h(U,R,T)}K.sort((T,S)=>T.distance-S.distance);for(U=0;8>U;++U)L[U]=K.data[U].index}function p(U,R){let L=Infinity,N=null;for(let T=0;8>T;++T){const S=h(U,R,z[T]);S<L&&(L=S,N=z[T])}return N}function h(U,R,L){return R*(U[0]*L[0]+U[1]*L[1]+U[2]*L[2])}function m(U){return!isNaN(U)&&-Infinity!==U&&Infinity!==U&&0<U}let u=function(){function U(L,N){this._objectToBoundingSphere=L;this._maximumObjectsPerNode=10;this._maximumDepth=
20;this._degenerateObjects=new Set;this._root=new t;this._objectCount=0;N&&(void 0!==N.maximumObjectsPerNode&&(this._maximumObjectsPerNode=N.maximumObjectsPerNode),void 0!==N.maximumDepth&&(this._maximumDepth=N.maximumDepth))}var R=U.prototype;R.destroy=function(){this._degenerateObjects.clear();t.clearPool();B[0]=null;F.prune();K.prune()};R.add=function(L,N=L.length){this._objectCount+=N;this._grow(L,N);const T=t.acquire();for(let S=0;S<N;S++){const H=L[S];this._isDegenerate(H)?this._degenerateObjects.add(H):
(T.init(this._root),this._add(H,T))}t.release(T)};R.remove=function(L,N=null){this._objectCount-=L.length;const T=t.acquire();for(const S of L)L=c.isSome(N)?N:f.copy(this._objectToBoundingSphere(S),G),m(L[3])?(T.init(this._root),this._remove(S,L,T)):this._degenerateObjects.delete(S);t.release(T);this._shrink()};R.update=function(L,N){if(m(N[3])||!this._isDegenerate(L))B[0]=L,L=B,this.remove(L,N),this.add(L)};R.forEachAlongRay=function(L,N,T){const S=n.wrap(L,N);this._forEachNode(this._root,H=>{if(!this._intersectsNode(S,
H))return!1;H=H.node;H.terminals.forAll(Q=>{this._intersectsObject(S,Q)&&T(Q)});null!==H.residents&&H.residents.forAll(Q=>{this._intersectsObject(S,Q)&&T(Q)});return!0})};R.forEachAlongRayWithVerticalOffset=function(L,N,T,S){const H=n.wrap(L,N);this._forEachNode(this._root,Q=>{if(!this._intersectsNodeWithOffset(H,Q,S))return!1;Q=Q.node;Q.terminals.forAll(W=>{this._intersectsObjectWithOffset(H,W,S)&&T(W)});null!==Q.residents&&Q.residents.forAll(W=>{this._intersectsObjectWithOffset(H,W,S)&&T(W)});return!0})};
R.forEach=function(L){this._forEachNode(this._root,N=>{N=N.node;N.terminals.forAll(L);null!==N.residents&&N.residents.forAll(L);return!0});this._degenerateObjects.forEach(L)};R.forEachDegenerateObject=function(L){this._degenerateObjects.forEach(L)};R.findClosest=function(L,N,T,S=()=>!0,H=Infinity){let Q=Infinity,W=Infinity,V=null;const Y=p(L,N),aa=X=>{--H;if(S(X)){var ba=this._objectToBoundingSphere(X);if(l.intersectsSphere(T,ba)){var ha=h(L,N,f.getCenter(ba)),ka=ha-ba[3];ba=ha+ba[3];ka<Q&&(Q=ka,
W=ba,V=X)}}};this._forEachNodeDepthOrdered(this._root,X=>{if(0>=H||!l.intersectsSphere(T,X.bounds))return!1;x.scale(E,Y,X.halfSize);x.add(E,E,X.bounds);if(h(L,N,E)>W)return!1;X=X.node;X.terminals.forAll(ba=>aa(ba));null!==X.residents&&X.residents.forAll(ba=>aa(ba));return!0},L,N);return V};R.forEachInDepthRange=function(L,N,T,S,H,Q,W){let V=-Infinity,Y=Infinity;const aa={setRange:ia=>{T===a.DepthOrder.FRONT_TO_BACK?(V=Math.max(V,ia.near),Y=Math.min(Y,ia.far)):(V=Math.max(V,-ia.far),Y=Math.min(Y,-ia.near))}};
aa.setRange(S);const X=h(N,T,L),ba=p(N,T),ha=p(N,-T),ka=ia=>{if(W(ia)){var ea=this._objectToBoundingSphere(ia),ca=f.getCenter(ea);ca=h(N,T,ca)-X;var Z=ca+ea[3];ca-ea[3]>Y||Z<V||!l.intersectsSphere(Q,ea)||H(ia,aa)}};this._forEachNodeDepthOrdered(this._root,ia=>{if(!l.intersectsSphere(Q,ia.bounds))return!1;x.scale(E,ba,ia.halfSize);x.add(E,E,ia.bounds);if(h(N,T,E)-X>Y)return!1;x.scale(E,ha,ia.halfSize);x.add(E,E,ia.bounds);if(h(N,T,E)-X<V)return!1;ia=ia.node;ia.terminals.forAll(ea=>ka(ea));null!==ia.residents&&
ia.residents.forAll(ea=>ka(ea));return!0},N,T)};R.forEachNode=function(L){this._forEachNode(this._root,N=>L(N.node,N.bounds,N.halfSize))};R._intersectsNode=function(L,N){k(N.bounds,2*-N.halfSize,C);k(N.bounds,2*N.halfSize,D);return e.rayBoxTest(L.origin,L.direction,C,D)};R._intersectsNodeWithOffset=function(L,N,T){k(N.bounds,2*-N.halfSize,C);k(N.bounds,2*N.halfSize,D);T.applyToMinMax(C,D);return e.rayBoxTest(L.origin,L.direction,C,D)};R._intersectsObject=function(L,N){N=this._objectToBoundingSphere(N);
return 0<N[3]?f.intersectsRay(N,L):!0};R._intersectsObjectWithOffset=function(L,N,T){N=this._objectToBoundingSphere(N);return 0<N[3]?f.intersectsRay(T.applyToBoundingSphere(N),L):!0};R._forEachNode=function(L,N){L=t.acquire().init(L);const T=[L];for(;0!==T.length;){L=T.pop();if(N(L)&&!L.isLeaf())for(let S=0;S<L.node.children.length;S++)L.node.children[S]&&T.push(t.acquire().init(L).advance(S));t.release(L)}};R._forEachNodeDepthOrdered=function(L,N,T,S=a.DepthOrder.FRONT_TO_BACK){L=t.acquire().init(L);
const H=[L];for(y(T,S,M);0!==H.length;){L=H.pop();if(N(L)&&!L.isLeaf())for(T=7;0<=T;--T)S=M[T],L.node.children[S]&&H.push(t.acquire().init(L).advance(S));t.release(L)}};R._remove=function(L,N,T){F.clear();N=T.advanceTo(N,(S,H)=>{F.push(S.node);F.push(H)})?T.node.terminals:T.node.residents;N.removeUnordered(L);if(0===N.length)for(L=F.length-2;0<=L&&this._purge(F.data[L],F.data[L+1]);L-=2);};R._nodeIsEmpty=function(L){if(0!==L.terminals.length)return!1;if(null!==L.residents)return 0===L.residents.length;
for(let N=0;N<L.children.length;N++)if(L.children[N])return!1;return!0};R._purge=function(L,N){0<=N&&(L.children[N]=null);return this._nodeIsEmpty(L)?(null===L.residents&&(L.residents=new g({shrink:!0})),!0):!1};R._add=function(L,N){N.advanceTo(this._objectToBoundingSphere(L))?N.node.terminals.push(L):(N.node.residents.push(L),N.node.residents.length>this._maximumObjectsPerNode&&N.depth<this._maximumDepth&&this._split(N))};R._split=function(L){const N=L.node.residents;L.node.residents=null;for(let T=
0;T<N.length;T++){const S=t.acquire().init(L);this._add(N.getItemAt(T),S);t.release(S)}};R._grow=function(L,N){0!==N&&(r(L,N,T=>this._objectToBoundingSphere(T),J),m(J[3])&&!this._fitsInsideTree(J)&&(this._nodeIsEmpty(this._root.node)?(f.copy(J,this._root.bounds),this._root.halfSize=1.25*J[3]):(L=this._rootBoundsForRootAsSubNode(J),this._placingRootViolatesMaxDepth(L)?this._rebuildTree(J,L):this._growRootAsSubNode(L),t.release(L))))};R._rebuildTree=function(L,N){x.copy(I,N.bounds);I[3]=N.halfSize;
r([L,I],2,T=>T,O);L=t.acquire().init(this._root);this._root.initFrom(null,O,1.25*O[3]);this._forEachNode(L,T=>{this.add(T.node.terminals.data,T.node.terminals.length);null!==T.node.residents&&this.add(T.node.residents.data,T.node.residents.length);return!0});t.release(L)};R._placingRootViolatesMaxDepth=function(L){const N=Math.log(L.halfSize/this._root.halfSize)*Math.LOG2E;let T=0;this._forEachNode(this._root,S=>{T=Math.max(T,S.depth);return T+N<=this._maximumDepth});return T+N>this._maximumDepth};
R._rootBoundsForRootAsSubNode=function(L){var N=L[3];let T=-Infinity;const S=this._root.bounds,H=this._root.halfSize;for(var Q=0;3>Q;Q++){var W=Math.max(0,Math.ceil((S[Q]-H-(L[Q]-N))/(2*H)));const V=Math.max(0,Math.ceil((L[Q]+N-(S[Q]+H))/(2*H)))+1;T=Math.max(T,2**Math.ceil(Math.log(W+V)*Math.LOG2E));P[Q].min=W;P[Q].max=V}for(L=0;3>L;L++)N=P[L].min,Q=P[L].max,W=(T-(N+Q))/2,N+=Math.ceil(W),Q+=Math.floor(W),A[L]=S[L]-H-N*H*2+(Q+N)*H;A[3]=T*H*v;return t.acquire().initFrom(null,A,T*H,0)};R._growRootAsSubNode=
function(L){const N=this._root.node;x.copy(J,this._root.bounds);J[3]=this._root.halfSize;this._root.init(L);L.advanceTo(J,null,!0);L.node.children=N.children;L.node.residents=N.residents;L.node.terminals=N.terminals};R._shrink=function(){for(;;){const L=this._findShrinkIndex();if(-1===L)break;this._root.advance(L);this._root.depth=0}};R._findShrinkIndex=function(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;let L=null;const N=this._root.node.children;let T=0,S=0;for(;S<N.length&&
null==L;)T=S++,L=N[T];for(;S<N.length;)if(N[S++])return-1;return T};R._isDegenerate=function(L){L=this._objectToBoundingSphere(L)[3];return!m(L)};R._fitsInsideTree=function(L){const N=this._root.bounds,T=this._root.halfSize;return L[3]<=T&&L[0]>=N[0]-T&&L[0]<=N[0]+T&&L[1]>=N[1]-T&&L[1]<=N[1]+T&&L[2]>=N[2]-T&&L[2]<=N[2]+T};b._createClass(U,[{key:"bounds",get:function(){return this._root.bounds}},{key:"halfSize",get:function(){return this._root.halfSize}},{key:"root",get:function(){return this._root.node}},
{key:"maximumObjectsPerNode",get:function(){return this._maximumObjectsPerNode}},{key:"maximumDepth",get:function(){return this._maximumDepth}},{key:"objectCount",get:function(){return this._objectCount}}]);return U}(),t=function(){function U(){this.bounds=f.create();this.halfSize=0;this.initFrom(null,null,0,0)}var R=U.prototype;R.init=function(L){return this.initFrom(L.node,L.bounds,L.halfSize,L.depth)};R.initFrom=function(L,N,T,S=this.depth){this.node=c.isSome(L)?L:U.createEmptyNode();c.isSome(N)&&
f.copy(N,this.bounds);this.halfSize=T;this.depth=S;return this};R.advance=function(L){let N=this.node.children[L];N||(N=U.createEmptyNode(),this.node.children[L]=N);this.node=N;this.halfSize/=2;this.depth++;L=q[L];this.bounds[0]+=L[0]*this.halfSize;this.bounds[1]+=L[1]*this.halfSize;this.bounds[2]+=L[2]*this.halfSize;this.bounds[3]=this.halfSize*v;return this};R.advanceTo=function(L,N,T=!1){for(;;){if(this.isTerminalFor(L))return N&&N(this,-1),!0;if(this.isLeaf()){if(!T)return N&&N(this,-1),!1;this.node.residents=
null}const S=this._childIndex(L);N&&N(this,S);this.advance(S)}};R.isLeaf=function(){return null!=this.node.residents};R.isTerminalFor=function(L){return L[3]>this.halfSize/2};R._childIndex=function(L){const N=this.bounds;return(N[0]<L[0]?1:0)+(N[1]<L[1]?2:0)+(N[2]<L[2]?4:0)};U.createEmptyNode=function(){return{children:[null,null,null,null,null,null,null,null],terminals:new g({shrink:!0}),residents:new g({shrink:!0})}};U.acquire=function(){return U._pool.acquire()};U.release=function(L){U._pool.release(L)};
U.clearPool=function(){U._pool.prune()};return U}();t._pool=new d(t);a.DepthOrder=void 0;(function(U){U[U.FRONT_TO_BACK=1]="FRONT_TO_BACK";U[U.BACK_TO_FRONT=-1]="BACK_TO_FRONT"})(a.DepthOrder||(a.DepthOrder={}));const q=[w.fromValues(-1,-1,-1),w.fromValues(1,-1,-1),w.fromValues(-1,1,-1),w.fromValues(1,1,-1),w.fromValues(-1,-1,1),w.fromValues(1,-1,1),w.fromValues(-1,1,1),w.fromValues(1,1,1)],z=[w.fromValues(-1,-1,-1),w.fromValues(-1,-1,1),w.fromValues(-1,1,-1),w.fromValues(-1,1,1),w.fromValues(1,-1,
-1),w.fromValues(1,-1,1),w.fromValues(1,1,-1),w.fromValues(1,1,1)],v=Math.sqrt(3),B=[null],A=f.create(),E=w.create(),C=w.create(),D=w.create(),F=new g,G=f.create(),J=f.create(),I=f.create(),O=f.create(),P=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],K=new g,M=[0,0,0,0,0,0,0,0];a.default=u;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/RibbonLineMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/frustum ../../../../geometry/support/lineSegment ../../../../geometry/support/plane ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutputOptions ../lib/geometryDataUtils ../lib/GLMaterial ../lib/GLMaterials ../lib/Material ../lib/RenderSlot ../lib/Util ../lib/VertexAttribute ./VisualVariableMaterialParameters ./renderers/utils ../../../../chunks/RibbonLine.glsl ../shaders/RibbonLineTechnique".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E){function C(ea,ca,Z,fa,ja){for(let la=0;la<ja;la++)Z[fa++]=ea[ca++];return fa}function D(ea,ca,Z){ca=ca.get(z.VertexAttribute.POSITION).data;Z=Z?Z.get(z.VertexAttribute.POSITION):null;return ea.isClosed?Z?2<Z.length:6<ca.length:!1}const F=c.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial");var G;(function(ea){ea[ea.LEFT_JOIN_START=-2]="LEFT_JOIN_START";ea[ea.LEFT_JOIN_END=-1]="LEFT_JOIN_END";ea[ea.LEFT_CAP_START=-4]="LEFT_CAP_START";
ea[ea.LEFT_CAP_END=-5]="LEFT_CAP_END";ea[ea.RIGHT_JOIN_START=2]="RIGHT_JOIN_START";ea[ea.RIGHT_JOIN_END=1]="RIGHT_JOIN_END";ea[ea.RIGHT_CAP_START=4]="RIGHT_CAP_START";ea[ea.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(G||(G={}));c=function(ea){function ca(fa){fa=ea.call(this,fa,I)||this;fa._vertexAttributeLocations=E.ribbonVertexAttributeLocations;fa.techniqueConfig=new E.RibbonLineTechniqueConfiguration;fa.layout=fa.createLayout();return fa}b._inheritsLoose(ca,ea);var Z=ca.prototype;Z.isClosed=function(fa,
ja){return this.parameters.isClosed?ja?2<ja.length:6<fa.length:!1};Z.dispose=function(){};Z.getPassParameters=function(){return this.parameters};Z.getTechniqueConfig=function(fa,ja){this.techniqueConfig.output=fa;this.techniqueConfig.draped=ja.slot===t.RenderSlot.DRAPED_MATERIAL;fa=g.isSome(this.parameters.stipplePattern);this.techniqueConfig.stippleEnabled=fa;this.techniqueConfig.stippleOffColorEnabled=fa&&g.isSome(this.parameters.stippleOffColor);this.techniqueConfig.stippleScaleWithLineWidth=fa&&
this.parameters.stippleScaleWithLineWidth;this.techniqueConfig.stipplePreferContinuous=fa&&this.parameters.stipplePreferContinuous;this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled;this.techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees;this.techniqueConfig.roundJoins="round"===this.parameters.join;this.techniqueConfig.capType=this.parameters.cap;this.techniqueConfig.transparent=this.parameters.transparent;this.techniqueConfig.polygonOffset=this.parameters.polygonOffset;
this.techniqueConfig.writeDepth=this.parameters.writeDepth;this.techniqueConfig.vvColor=this.parameters.vvColorEnabled;this.techniqueConfig.vvOpacity=this.parameters.vvOpacityEnabled;this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled;this.techniqueConfig.innerColorEnabled=0<this.parameters.innerWidth&&g.isSome(this.parameters.innerColor);this.techniqueConfig.falloffEnabled=0<this.parameters.falloff;this.techniqueConfig.occluder=this.parameters.renderOccluded===u.RenderOccludedFlag.OccludeAndTransparentStencil;
this.techniqueConfig.transparencyPassType=ja.transparencyPassType;this.techniqueConfig.multipassTerrainEnabled=ja.multipassTerrainEnabled;this.techniqueConfig.cullAboveGround=ja.cullAboveGround;this.techniqueConfig.wireframe=this.parameters.wireframe;return this.techniqueConfig};Z.intersect=function(fa,ja,la,ma,ra,va,ya,za,pa){g.isSome(pa)?this._intersectDrapedLineGeometry(fa,ma,pa,va,ya):this._intersectLineGeometry(fa,ja,la,ma,ya)};Z._intersectDrapedLineGeometry=function(fa,ja,la,ma,ra){if(ja.options.selectionMode){ja=
fa.vertexAttributes.get(z.VertexAttribute.POSITION).data;var va=fa.vertexAttributes.get(z.VertexAttribute.SIZE),ya=this.parameters.width;this.parameters.vvSizeEnabled?(va=fa.vertexAttributes.get(z.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0],ya*=d.clamp(this.parameters.vvSizeOffset[0]+va*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])):va&&(ya*=va.data[0]);va=ma[0];ma=ma[1];fa=(ya/2+4)*fa.screenToWorldRatio;ya=Number.MAX_VALUE;var za=0;for(let ta=
0;ta<ja.length-5;ta+=3){var pa=ja[ta],wa=ja[ta+1],na=va-pa,qa=ma-wa;pa=ja[ta+3]-pa;wa=ja[ta+4]-wa;const Fa=d.clamp((pa*na+wa*qa)/(pa*pa+wa*wa),0,1);na=pa*Fa-na;qa=wa*Fa-qa;qa=na*na+qa*qa;qa<ya&&(ya=qa,za=ta/3)}ya<fa*fa&&ra(la.dist,la.normal,za,!1)}};Z._intersectLineGeometry=function(fa,ja,la,ma,ra){if(ma.options.selectionMode&&!B.isInstanceHidden(ja))if(q.isTranslationMatrix(la)){var va=fa.vertexAttributes,ya=va.get(z.VertexAttribute.POSITION).data;ja=this.parameters.width;if(this.parameters.vvSizeEnabled){var za=
va.get(z.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0];ja*=d.clamp(this.parameters.vvSizeOffset[0]+za*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else va.has(z.VertexAttribute.SIZE)&&(ja*=va.get(z.VertexAttribute.SIZE).data[0]);var pa=ma.camera,wa=R;w.copy(wa,ma.point);za=ja*pa.pixelRatio/2+4*pa.pixelRatio;l.set(aa[0],wa[0]-za,wa[1]+za,0);l.set(aa[1],wa[0]+za,wa[1]+za,0);l.set(aa[2],wa[0]+za,wa[1]-za,0);l.set(aa[3],wa[0]-za,wa[1]-za,0);for(ja=
0;4>ja;ja++)if(!pa.unprojectFromRenderScreen(aa[ja],X[ja]))return;k.fromPoints(pa.eye,X[0],X[1],ba);k.fromPoints(pa.eye,X[1],X[2],ha);k.fromPoints(pa.eye,X[2],X[3],ka);k.fromPoints(pa.eye,X[3],X[0],ia);var na=Number.MAX_VALUE;ja=0;fa=D(this.parameters,va,fa.indices)?ya.length-2:ya.length-5;for(va=0;va<fa;va+=3){P[0]=ya[va]+la[12];P[1]=ya[va+1]+la[13];P[2]=ya[va+2]+la[14];var qa=(va+3)%ya.length;K[0]=ya[qa]+la[12];K[1]=ya[qa+1]+la[13];K[2]=ya[qa+2]+la[14];if(!(0>k.signedDistance(ba,P)&&0>k.signedDistance(ba,
K)||0>k.signedDistance(ha,P)&&0>k.signedDistance(ha,K)||0>k.signedDistance(ka,P)&&0>k.signedDistance(ka,K)||0>k.signedDistance(ia,P)&&0>k.signedDistance(ia,K))){pa.projectToRenderScreen(P,L);pa.projectToRenderScreen(K,N);if(0>L[2]&&0<N[2])l.subtract(M,P,K),qa=pa.frustum,qa=-k.signedDistance(qa[f.PlaneIndex.NEAR],P)/l.dot(M,k.normal(qa[f.PlaneIndex.NEAR])),l.scale(M,M,qa),l.add(P,P,M),pa.projectToRenderScreen(P,L);else if(0<L[2]&&0>N[2])l.subtract(M,K,P),qa=pa.frustum,qa=-k.signedDistance(qa[f.PlaneIndex.NEAR],
K)/l.dot(M,k.normal(qa[f.PlaneIndex.NEAR])),l.scale(M,M,qa),l.add(K,K,M),pa.projectToRenderScreen(K,N);else if(0>L[2]&&0>N[2])continue;L[2]=0;N[2]=0;qa=e.distance2(e.fromPoints(L,N,H),wa);qa<na&&(na=qa,l.copy(T,P),l.copy(S,K),ja=va/3)}}la=ma.rayBegin;ma=ma.rayEnd;na<za*za&&(ya=Number.MAX_VALUE,e.closestLineSegmentPoint(e.fromPoints(T,S,H),e.fromPoints(la,ma,Q),U)&&(l.subtract(U,U,la),ya=l.length(U),l.scale(U,U,1/ya),ya/=l.distance(la,ma)),ra(ya,U,ja,!1))}else F.error("intersection assumes a translation-only matrix")};
Z.computeAttachmentOrigin=function(fa,ja){const la=fa.vertexAttributes;if(!la)return null;fa=fa.indices;const ma=la.get(z.VertexAttribute.POSITION);return p.computeAttachmentOriginLines(ma,fa?fa.get(z.VertexAttribute.POSITION):null,fa&&D(this.parameters,la,fa),ja)};Z.createLayout=function(){const fa=r.newLayout().vec3f(z.VertexAttribute.POSITION).f32(z.VertexAttribute.SUBDIVISIONFACTOR).vec2f(z.VertexAttribute.UV0).vec3f(z.VertexAttribute.AUXPOS1).vec3f(z.VertexAttribute.AUXPOS2);this.parameters.vvSizeEnabled?
fa.f32(z.VertexAttribute.SIZEFEATUREATTRIBUTE):fa.f32(z.VertexAttribute.SIZE);this.parameters.vvColorEnabled?fa.f32(z.VertexAttribute.COLORFEATUREATTRIBUTE):fa.vec4f(z.VertexAttribute.COLOR);this.parameters.vvOpacityEnabled&&fa.f32(z.VertexAttribute.OPACITYFEATUREATTRIBUTE);return fa};Z.createBufferWriter=function(){return new O(this.layout,this.parameters)};Z.requiresSlot=function(fa,ja){if(fa===t.RenderSlot.DRAPED_MATERIAL)return!0;if(this.parameters.renderOccluded===u.RenderOccludedFlag.OccludeAndTransparentStencil)return fa===
t.RenderSlot.OPAQUE_MATERIAL||fa===t.RenderSlot.OCCLUDER_MATERIAL||fa===t.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL;ja=m.outputFromPass(ja);return ja===y.ShaderOutput.Color||ja===y.ShaderOutput.Alpha?fa===(this.parameters.writeDepth?t.RenderSlot.TRANSPARENT_MATERIAL:t.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):fa===t.RenderSlot.OPAQUE_MATERIAL};Z.createGLMaterial=function(fa){return fa.output===y.ShaderOutput.Color||fa.output===y.ShaderOutput.Alpha||fa.output===y.ShaderOutput.Highlight||
fa.output===y.ShaderOutput.Depth?new J(fa):null};Z.validateParameters=function(fa){"miter"!==fa.join&&(fa.miterLimit=0);this._requiresTransparent(fa)&&(fa.transparent=!0)};Z._requiresTransparent=function(fa){return!!(1>(fa.color&&fa.color[3])||0<fa.innerWidth&&this._colorRequiresTransparent(fa.innerColor)||fa.stipplePattern&&this._colorRequiresTransparent(fa.stippleOffColor)||0<fa.falloff)};Z._colorRequiresTransparent=function(fa){return g.isSome(fa)&&1>fa[3]&&0<fa[3]};return ca}(u.Material);let J=
function(ea){function ca(){return ea.apply(this,arguments)||this}b._inheritsLoose(ca,ea);var Z=ca.prototype;Z.updateParameters=function(fa){return this.ensureTechnique(E.RibbonLineTechnique,fa)};Z._updateOccludeeState=function(fa){fa.hasOccludees!==this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:fa.hasOccludees})};Z.beginSlot=function(fa){this._output!==y.ShaderOutput.Color&&this._output!==y.ShaderOutput.Alpha||this._updateOccludeeState(fa);return this.updateParameters(fa)};
Z.bind=function(fa,ja){ja.bindPass(this._material.getPassParameters(),fa)};return ca}(h);const I={width:0,color:[1,1,1,1],join:"miter",cap:A.CapType.BUTT,miterLimit:5,writeDepth:!0,polygonOffset:!1,stipplePattern:null,stippleOffColor:null,stippleScaleWithLineWidth:!1,stipplePreferContinuous:!0,slicePlaneEnabled:!1,vvFastUpdate:!1,transparent:!1,isClosed:!1,falloff:0,innerWidth:0,innerColor:null,sceneHasOcludees:!1,wireframe:!1,...u.DefaultMaterialParameters,...v.VisualVariableDefaultMaterialParameters};
let O=function(){function ea(Z,fa){this.parameters=fa;this.numJoinSubdivisions=0;this.vertexBufferLayout=Z;Z=fa.stipplePattern?1:0;switch(this.parameters.join){case "miter":case "bevel":this.numJoinSubdivisions=Z;break;case "round":this.numJoinSubdivisions=A.NUM_ROUND_JOIN_SUBDIVISIONS+Z}}var ca=ea.prototype;ca._isClosed=function(Z){return D(this.parameters,Z.vertexAttributes,Z.indices)};ca.allocate=function(Z){return this.vertexBufferLayout.createBuffer(Z)};ca.elementCount=function(Z){var fa=Z.indices.get(z.VertexAttribute.POSITION).length/
2+1;Z=this._isClosed(Z);fa=(Z?2:4)+((Z?fa:fa-1)-(Z?0:1))*(2*this.numJoinSubdivisions+4);fa+=2;this.parameters.wireframe&&(fa=2+4*(fa-2));return fa};ca.write=function(Z,fa,ja,la){var ma;const ra=W,va=V,ya=Y,za=fa.vertexAttributes.get(z.VertexAttribute.POSITION).data;var pa=fa.indices&&fa.indices.get(z.VertexAttribute.POSITION);const wa=null==(ma=fa.vertexAttributes.get(z.VertexAttribute.DISTANCETOSTART))?void 0:ma.data;pa&&pa.length!==2*(za.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");
let na=1,qa=0;this.parameters.vvSizeEnabled?qa=fa.vertexAttributes.get(z.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0]:fa.vertexAttributes.has(z.VertexAttribute.SIZE)&&(na=fa.vertexAttributes.get(z.VertexAttribute.SIZE).data[0]);let ta=[1,1,1,1],Fa=0;this.parameters.vvColorEnabled?Fa=fa.vertexAttributes.get(z.VertexAttribute.COLORFEATUREATTRIBUTE).data[0]:fa.vertexAttributes.has(z.VertexAttribute.COLOR)&&(ta=fa.vertexAttributes.get(z.VertexAttribute.COLOR).data);let Ha=0;this.parameters.vvOpacityEnabled&&
(Ha=fa.vertexAttributes.get(z.VertexAttribute.OPACITYFEATUREATTRIBUTE).data[0]);ma=za.length/3;Z=Z.transformation;const Ka=new Float32Array(ja.buffer);pa=this.vertexBufferLayout.stride/4;let La=la*pa;la=La;let Ra=0;const ab=wa?(Ia,Na,Sa)=>Ra=wa[Sa]:(Ia,Na,Sa)=>Ra+=l.distance(Ia,Na),Za=(Ia,Na,Sa,Ua,Ya,$a,sa)=>{Ka[La++]=Na[0];Ka[La++]=Na[1];Ka[La++]=Na[2];Ka[La++]=Ua;Ka[La++]=sa;Ka[La++]=Ya;Ka[La++]=Ia[0];Ka[La++]=Ia[1];Ka[La++]=Ia[2];Ka[La++]=Sa[0];Ka[La++]=Sa[1];Ka[La++]=Sa[2];this.parameters.vvSizeEnabled?
Ka[La++]=qa:Ka[La++]=na;this.parameters.vvColorEnabled?Ka[La++]=Fa:(Ia=Math.min(4*$a,ta.length-4),Ka[La++]=ta[Ia+0],Ka[La++]=ta[Ia+1],Ka[La++]=ta[Ia+2],Ka[La++]=ta[Ia+3]);this.parameters.vvOpacityEnabled&&(Ka[La++]=Ha)};La+=pa;l.set(va,za[0],za[1],za[2]);Z&&l.transformMat4(va,va,Z);if(fa=this._isClosed(fa)){var Pa=za.length-3;l.set(ra,za[Pa],za[Pa+1],za[Pa+2]);Z&&l.transformMat4(ra,ra,Z)}else l.set(ya,za[3],za[4],za[5]),Z&&l.transformMat4(ya,ya,Z),Za(va,va,ya,1,G.LEFT_CAP_START,0,0),Za(va,va,ya,1,
G.RIGHT_CAP_START,0,0),l.copy(ra,va),l.copy(va,ya);Pa=fa?0:1;const ua=fa?ma:ma-1;for(let Ia=Pa;Ia<ua;Ia++){var Aa=(Ia+1)%ma*3;l.set(ya,za[Aa+0],za[Aa+1],za[Aa+2]);Z&&l.transformMat4(ya,ya,Z);ab(ra,va,Ia);Za(ra,va,ya,0,G.LEFT_JOIN_END,Ia,Ra);Za(ra,va,ya,0,G.RIGHT_JOIN_END,Ia,Ra);Aa=this.numJoinSubdivisions;for(let Na=0;Na<Aa;++Na){const Sa=(Na+1)/(Aa+1);Za(ra,va,ya,Sa,G.LEFT_JOIN_END,Ia,Ra);Za(ra,va,ya,Sa,G.RIGHT_JOIN_END,Ia,Ra)}Za(ra,va,ya,1,G.LEFT_JOIN_START,Ia,Ra);Za(ra,va,ya,1,G.RIGHT_JOIN_START,
Ia,Ra);l.copy(ra,va);l.copy(va,ya)}fa?(l.set(ya,za[3],za[4],za[5]),Z&&l.transformMat4(ya,ya,Z),Ra=ab(ra,va,ua),Za(ra,va,ya,0,G.LEFT_JOIN_END,Pa,Ra),Za(ra,va,ya,0,G.RIGHT_JOIN_END,Pa,Ra)):(Ra=ab(ra,va,ua),Za(ra,va,va,0,G.LEFT_CAP_END,ua,Ra),Za(ra,va,va,0,G.RIGHT_CAP_END,ua,Ra));C(Ka,la+pa,Ka,la,pa);La=C(Ka,La-pa,Ka,La,pa);this.parameters.wireframe&&this._addWireframeVertices(ja,la,La,pa)};ca._addWireframeVertices=function(Z,fa,ja,la){const ma=new Float32Array(Z.buffer,ja*Float32Array.BYTES_PER_ELEMENT);
Z=new Float32Array(Z.buffer,fa*Float32Array.BYTES_PER_ELEMENT,ja-fa);fa=0;for(ja=0;ja<Z.length-1;ja+=2*la)fa=C(Z,ja,ma,fa,la),fa=C(Z,ja+2*la,ma,fa,la),fa=C(Z,ja+1*la,ma,fa,la),fa=C(Z,ja+2*la,ma,fa,la),fa=C(Z,ja+1*la,ma,fa,la),fa=C(Z,ja+3*la,ma,fa,la)};return ea}();const P=n.create(),K=n.create(),M=n.create(),U=n.create(),R=n.create(),L=x.createRenderScreenPointArray3(),N=x.createRenderScreenPointArray3(),T=n.create(),S=n.create(),H=e.create(),Q=e.create(),W=n.create(),V=n.create(),Y=n.create(),aa=
[x.createRenderScreenPointArray3(),x.createRenderScreenPointArray3(),x.createRenderScreenPointArray3(),x.createRenderScreenPointArray3()],X=[n.create(),n.create(),n.create(),n.create()],ba=k.create(),ha=k.create(),ka=k.create(),ia=k.create();a.RibbonLineMaterial=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/VisualVariableMaterialParameters":function(){define(["exports","../../../../chunks/mat3f64","../../../../chunks/vec3f32"],function(a,b,c){b={vvSizeEnabled:!1,
vvSizeMinSize:c.fromValues(1,1,1),vvSizeMaxSize:c.fromValues(100,100,100),vvSizeOffset:c.fromValues(0,0,0),vvSizeFactor:c.fromValues(1,1,1),vvSizeValue:c.fromValues(1,1,1),vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvOpacityEnabled:!1,vvOpacityValues:[0,0,0,0,0,0,0,0],vvOpacityOpacities:[1,1,1,1,1,1,1,1],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:b.create()};a.VisualVariableDefaultMaterialParameters=b;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/chunks/RibbonLine.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y){function p(m){const u=new r.ShaderBuilder,t=m.capType!==a.CapType.BUTT,q=m.capType===a.CapType.ROUND,z=m.stippleEnabled&&q,v=m.falloffEnabled||z,B=m.innerColorEnabled||q,A=m.stippleEnabled&&m.stippleScaleWithLineWidth||q,E=m.stippleEnabled&&m.stippleScaleWithLineWidth,C=m.stippleEnabled||q;u.include(n.PiUtils);u.include(d.RibbonVertexPosition,m);u.include(w.LineStipple,{...m,stippleRequiresStretchMeasure:!0});m.output===b.ShaderOutput.Depth&&u.include(g.OutputDepth,
m);u.vertex.uniforms.add("proj","mat4").add("view","mat4").add("nearFar","vec2").add("pixelRatio","float").add("miterLimit","float").add("screenSize","vec2").add("inverseProjectionMatrix","mat4");u.vertex.constants.add("LARGE_HALF_FLOAT","float",65500);u.attributes.add(y.VertexAttribute.POSITION,"vec3");u.attributes.add(y.VertexAttribute.SUBDIVISIONFACTOR,"float");u.attributes.add(y.VertexAttribute.UV0,"vec2");u.attributes.add(y.VertexAttribute.AUXPOS1,"vec3");u.attributes.add(y.VertexAttribute.AUXPOS2,
"vec3");u.varyings.add("vColor","vec4");u.varyings.add("vpos","vec3");u.varyings.add("linearDepth","float");m.multipassTerrainEnabled&&u.varyings.add("depth","float");A&&u.varyings.add("vLineWidth","float");E&&u.varyings.add("vLineSizeInv","float");B&&u.varyings.add("vLineDistance","float");v&&u.varyings.add("vLineDistanceNorm","float");m.falloffEnabled&&u.fragment.uniforms.add("falloff","float");m.innerColorEnabled&&(u.fragment.uniforms.add("innerColor","vec4"),u.fragment.uniforms.add("innerWidth",
"float"));q&&(u.varyings.add("vSegmentSDF","float"),u.varyings.add("vReverseSegmentSDF","float"));u.vertex.code.add(k.glsl`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`);u.vertex.code.add(k.glsl`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= screenSize / posNdc.w;
return posNdc;
}`);u.vertex.code.add(k.glsl`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${m.multipassTerrainEnabled?"depth \x3d pos.z;":""}
      linearDepth = (-pos.z - nearFar[0]) / (nearFar[1] - nearFar[0]);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `);u.vertex.code.add(k.glsl`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${A?k.glsl`vLineWidth = lineWidth;`:""}
      ${E?k.glsl`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);

      clipAndTransform(pos, prev, next, isStartVertex);

      vec2 left = (pos.xy - prev.xy);
      vec2 right = (next.xy - pos.xy);

      float leftLen = length(left);
      float rightLen = length(right);
  `);C&&u.vertex.code.add(k.glsl`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${q?k.glsl`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `);u.vertex.code.add(k.glsl`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`);m.roundJoins?u.vertex.code.add(k.glsl`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${m.stippleEnabled?k.glsl`min(1.0, subdivisionFactor * ${k.glsl.float(1.5)})`:k.glsl`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):u.vertex.code.add(k.glsl`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);u.vertex.code.add(k.glsl`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${t?k.glsl`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `);u.vertex.code.add(k.glsl`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${v||B?k.glsl`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${B?k.glsl`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${v?k.glsl`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `);q&&u.vertex.code.add(k.glsl`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`);m.stippleEnabled&&(m.draped||u.vertex.code.add(k.glsl`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),u.vertex.code.add(k.glsl`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),m.draped?u.vertex.code.add(k.glsl`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):u.vertex.code.add(k.glsl`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),u.vertex.code.add(k.glsl`
      float patternLength = ${m.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;

      // Disable stipple distance limits on caps
      vStippleDistanceLimits = isJoin ?
                                 vStippleDistanceLimits :
                                 isStartVertex ?
                                  vec2(-1e038, vStippleDistanceLimits.y) :
                                  vec2(vStippleDistanceLimits.x, 1e038);
    `));u.vertex.code.add(k.glsl`
      // Convert back into NDC
      pos.xy = (pos.xy / screenSize) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${m.wireframe&&!m.draped?"pos.z -\x3d 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
    }
  }
  `);m.multipassTerrainEnabled&&(u.fragment.include(x.ReadLinearDepth),u.include(l.multipassTerrainTest,m));u.include(c.Slice,m);u.fragment.uniforms.add("intrinsicColor","vec4");u.fragment.include(e.ColorConversion);u.fragment.code.add(k.glsl`
  void main() {
    discardBySlice(vpos);
    ${m.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
  `);m.wireframe?u.fragment.code.add(k.glsl`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(q&&u.fragment.code.add(k.glsl`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${k.glsl.float(f.symbolAlphaCutoff)}) {
        discard;
      }
    `),z?u.fragment.code.add(k.glsl`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${k.glsl.float(f.symbolAlphaCutoff)}, stippleCoverage);
      `):u.fragment.code.add(k.glsl`float stippleAlpha = getStippleAlpha();`),u.fragment.code.add(k.glsl`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);
vec4 color = intrinsicColor * vColor;`),m.innerColorEnabled&&u.fragment.code.add(k.glsl`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`),u.fragment.code.add(k.glsl`vec4 finalColor = blendStipple(color, stippleAlpha);`),m.falloffEnabled&&u.fragment.code.add(k.glsl`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`));u.fragment.code.add(k.glsl`
    if (finalColor.a < ${k.glsl.float(f.symbolAlphaCutoff)}) {
      discard;
    }

    ${m.output===b.ShaderOutput.Alpha?k.glsl`gl_FragColor = vec4(finalColor.a);`:""}
    ${m.output===b.ShaderOutput.Color?k.glsl`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${m.output===b.ShaderOutput.Color&&m.oitEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
    ${m.output===b.ShaderOutput.Highlight?k.glsl`gl_FragColor = vec4(1.0);`:""}
    ${m.output===b.ShaderOutput.Depth?k.glsl`outputDepth(linearDepth);`:""}
  }
  `);return u}a.CapType=void 0;(function(m){m[m.BUTT=0]="BUTT";m[m.SQUARE=1]="SQUARE";m[m.ROUND=2]="ROUND";m[m.COUNT=3]="COUNT"})(a.CapType||(a.CapType={}));const h=Object.freeze({__proto__:null,NUM_ROUND_JOIN_SUBDIVISIONS:1,get CapType(){return a.CapType},build:p});a.NUM_ROUND_JOIN_SUBDIVISIONS=1;a.RibbonLineShader=h;a.build=p})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl":function(){define(["exports","../../shaderModules/interfaces","../../../lib/VertexAttribute"],
function(a,b,c){a.RibbonVertexPosition=function(d,g){d.vertex.uniforms.add("intrinsicWidth","float");g.vvSize?(d.attributes.add(c.VertexAttribute.SIZEFEATUREATTRIBUTE,"float"),d.vertex.uniforms.add("vvSizeMinSize","vec3"),d.vertex.uniforms.add("vvSizeMaxSize","vec3"),d.vertex.uniforms.add("vvSizeOffset","vec3"),d.vertex.uniforms.add("vvSizeFactor","vec3"),d.vertex.code.add(b.glsl`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(d.attributes.add(c.VertexAttribute.SIZE,"float"),d.vertex.code.add(b.glsl`float getSize(){
return intrinsicWidth * size;
}`));g.vvOpacity?(d.attributes.add(c.VertexAttribute.OPACITYFEATUREATTRIBUTE,"float"),d.vertex.constants.add("vvOpacityNumber","int",8),d.vertex.code.add(b.glsl`uniform float vvOpacityValues[vvOpacityNumber];
uniform float vvOpacityOpacities[vvOpacityNumber];
float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):d.vertex.code.add(b.glsl`vec4 applyOpacity( vec4 color ){
return color;
}`);g.vvColor?(d.attributes.add(c.VertexAttribute.COLORFEATUREATTRIBUTE,"float"),d.vertex.constants.add("vvColorNumber","int",8),d.vertex.code.add(b.glsl`uniform float vvColorValues[vvColorNumber];
uniform vec4 vvColorColors[vvColorNumber];
vec4 interpolateColor( float value ) {
if (value <= vvColorValues[0]) {
return vvColorColors[0];
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return mix(vvColorColors[i-1], vvColorColors[i], f);
}
}
return vvColorColors[vvColorNumber - 1];
}
vec4 getColor(){
return applyOpacity(interpolateColor(colorFeatureAttribute));
}`)):(d.attributes.add(c.VertexAttribute.COLOR,"vec4"),d.vertex.code.add(b.glsl`vec4 getColor(){
return applyOpacity(color);
}`))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl":function(){define(["exports","../ShaderOutputOptions","../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(a,b,c,d){a.OutputDepth=function(g,x){g.fragment.include(c.RgbaFloatEncoding);x.output===b.ShaderOutput.Shadow?(g.extensions.add("GL_OES_standard_derivatives"),g.fragment.code.add(d.glsl`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 2.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`)):x.output===b.ShaderOutput.Depth&&g.fragment.code.add(d.glsl`void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_linearDepth);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl":function(){define(["exports","../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(a,b,c){const d=c.glsl.float(.4);a.LineStipple=function(g,x){g.constants.add("stippleAlphaColorDiscard","float",.001);g.constants.add("stippleAlphaHighlightDiscard","float",.5);if(x.stippleEnabled){{const w=!(x.draped&&x.stipplePreferContinuous);g.fragment.include(b.RgbaFloatEncoding);
g.vertex.uniforms.add("stipplePatternPixelSize","float");g.vertex.uniforms.add("pixelRatio","float");x.draped?g.vertex.uniforms.add("worldToScreenRatio","float"):(g.vertex.uniforms.add("worldToScreenPerDistanceRatio","float"),g.vertex.uniforms.add("cameraPosition","vec3"),g.vertex.code.add(c.glsl`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`));g.varyings.add("vStippleDistance","float");x.stippleRequiresClamp&&g.varyings.add("vStippleDistanceLimits","vec2");x.stippleRequiresStretchMeasure&&g.varyings.add("vStipplePatternStretch","float");g.vertex.code.add(c.glsl`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${d};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `);g.vertex.code.add(c.glsl`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`);g.vertex.code.add(c.glsl`
    if (segmentLengthPseudoScreen >= ${w?"patternLength":"1e4"}) {
  `);g.vertex.code.add(c.glsl`
        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${x.stippleRequiresStretchMeasure?c.glsl`
              float stretch = repetitions / flooredRepetitions;

              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.
              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.
              vStipplePatternStretch = max(0.75, stretch);`:""}

        return vec2(0.0, segmentLengthScreenRounded);
      }
      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
    }
  `);g.fragment.uniforms.add("stipplePatternTexture","sampler2D");g.fragment.uniforms.add("stipplePatternSDFNormalizer","float");g.fragment.uniforms.add("stipplePatternTextureSize","float");g.fragment.uniforms.add("stipplePatternPixelSizeInv","float");x.stippleOffColorEnabled&&g.fragment.uniforms.add("stippleOffColor","vec4");g.fragment.code.add(c.glsl`float padTexture(float u) {
return (u * stipplePatternTextureSize + 1.0)/(stipplePatternTextureSize + 2.0);
}`);g.fragment.code.add(c.glsl`
    float getStippleSDF(out bool isClamped) {
      ${x.stippleRequiresClamp?c.glsl`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:c.glsl`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${x.stippleScaleWithLineWidth?c.glsl`u *= vLineSizeInv;`:""}
      u = padTexture(fract(u));

      float encodedSDF = rgba2float(texture2D(stipplePatternTexture, vec2(u, 0.5)));
      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;

      ${x.stippleRequiresStretchMeasure?c.glsl`return (sdf - 0.5) * vStipplePatternStretch + 0.5;`:c.glsl`return sdf;`}
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${x.stippleScaleWithLineWidth?c.glsl`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:c.glsl`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `);x.stippleOffColorEnabled?g.fragment.code.add(c.glsl`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`):g.fragment.code.add(c.glsl`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}}else g.fragment.code.add(c.glsl`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/RibbonLineTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../chunks/mat4 ../../../../geometry/support/vectorStacks ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../core/shaderLibrary/shading/VisualVariables.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/OrderIndependentTransparency ../lib/Program ../lib/RenderSlot ../lib/StencilUtils ../lib/VertexAttribute ../../../../chunks/RibbonLine.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E){const C=new Map([[v.VertexAttribute.POSITION,0],[v.VertexAttribute.SUBDIVISIONFACTOR,1],[v.VertexAttribute.UV0,2],[v.VertexAttribute.AUXPOS1,3],[v.VertexAttribute.AUXPOS2,4],[v.VertexAttribute.SIZE,6],[v.VertexAttribute.SIZEFEATUREATTRIBUTE,6],[v.VertexAttribute.COLOR,5],[v.VertexAttribute.COLORFEATUREATTRIBUTE,5],[v.VertexAttribute.OPACITYFEATUREATTRIBUTE,7]]);p=function(F){function G(I,O,P){O=F.call(this,I,O,P)||this;O.stippleTextureRepository=
I.stippleTextureRepository;return O}c._inheritsLoose(G,F);var J=G.prototype;J.initializeProgram=function(I){var O=G.shader.get();const P=this.configuration;O=O.build({oitEnabled:P.transparencyPassType===m.TransparencyPassType.Color,output:P.output,slicePlaneEnabled:P.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,draped:P.draped,stippleEnabled:this.stippleEnabled,stippleOffColorEnabled:P.stippleOffColorEnabled,stippleRequiresClamp:!0,stippleScaleWithLineWidth:P.stippleScaleWithLineWidth,
stipplePreferContinuous:P.stipplePreferContinuous,capType:P.capType,roundJoins:P.roundJoins,vvColor:P.vvColor,vvSize:P.vvSize,vvInstancingEnabled:!0,vvOpacity:P.vvOpacity,falloffEnabled:P.falloffEnabled,innerColorEnabled:P.innerColorEnabled,multipassTerrainEnabled:P.multipassTerrainEnabled,cullAboveGround:P.cullAboveGround,wireframe:P.wireframe});return new t.Program(I.rctx,O,C)};J.destroy=function(){F.prototype.destroy.call(this);this.stippleTextureRepository.release(this.stipplePattern);this.stippleTextureBind=
this.stipplePattern=null};J.bindPass=function(I,O){r.bindProjectionMatrix(this.program,O.camera.projectionMatrix);this.configuration.output===l.ShaderOutput.Highlight&&f.bindOutputHighlight(this.program,O);O.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",O.inverseViewport),e.bindMultipassTerrainTexture(this.program,O));this.program.setUniform1f("intrinsicWidth",I.width);this.program.setUniform4fv("intrinsicColor",I.color);this.program.setUniform1f("miterLimit","miter"!==I.join?
0:I.miterLimit);this.program.setUniform2fv("nearFar",O.camera.nearFar);this.program.setUniform1f("pixelRatio",O.camera.pixelRatio);this.program.setUniform2f("screenSize",O.camera.fullViewport[2],O.camera.fullViewport[3]);k.bindVisualVariablesUniformsWithOpacity(this.program,I);if(this.stipplePattern!==I.stipplePattern){var P=I.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,P);this.stipplePattern=P}if(this.stippleEnabled){const {pixelSize:K,sdfNormalizer:M,
pixels:U}=g.isSome(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1};this.program.setUniform1f("stipplePatternSDFNormalizer",M);this.program.setUniform1f("stipplePatternTextureSize",U);this.program.setUniform1f("stipplePatternPixelSize",K);this.program.setUniform1f("stipplePatternPixelSizeInv",1/K);this.configuration.draped?this.program.setUniform1f("worldToScreenRatio",1/O.screenToPCSRatio):this.program.setUniform1f("worldToScreenPerDistanceRatio",
1/O.camera.perScreenPixelRatio);this.configuration.stippleOffColorEnabled&&(P=g.unwrap(I.stippleOffColor),this.program.setUniform4f("stippleOffColor",P[0],P[1],P[2],3<P.length?P[3]:1))}this.configuration.falloffEnabled&&this.program.setUniform1f("falloff",I.falloff);this.configuration.innerColorEnabled&&(this.program.setUniform4fv("innerColor",g.unwrapOr(I.innerColor,I.color)),this.program.setUniform1f("innerWidth",I.innerWidth*O.camera.pixelRatio))};J.bindDraw=function(I){r.bindView(this.program,
I);this.stippleEnabled&&!this.configuration.draped&&r.bindCameraPosition(this.program,I.origin,I.camera.viewInverseTransposeMatrix);n.bindSliceUniforms(this.program,this.configuration,I.slicePlane,{origin:I.origin,view:I.camera.viewMatrix});this.program.setUniformMatrix4fv("inverseProjectionMatrix",x.invert(w.sm4d.get(),I.camera.projectionMatrix));this.program.rebindTextures()};J._makePipelineState=function(I,O){const P=this.configuration,K=I===m.TransparencyPassType.NONE,M=I===m.TransparencyPassType.FrontFace;
return E.makePipelineState({blending:P.output===l.ShaderOutput.Color||P.output===l.ShaderOutput.Alpha?K?u.blendingDefault:u.oitBlending(I):null,depthTest:{func:u.oitDepthTest(I)},depthWrite:K?P.writeDepth&&E.defaultDepthWriteParams:u.oitDepthWrite(I),colorWrite:E.defaultColorWriteParams,stencilWrite:P.sceneHasOcludees?z.stencilWriteMaskOn:null,stencilTest:P.sceneHasOcludees?O?z.stencilToolMaskBaseParams:z.stencilBaseAllZerosParams:null,polygonOffset:K||M?P.polygonOffset&&D:u.OITPolygonOffset})};J.initializePipeline=
function(){const I=this.configuration,O=I.polygonOffset&&D;I.occluder&&(this._occluderPipelineTransparent=E.makePipelineState({blending:u.blendingDefault,polygonOffset:O,depthTest:z.depthCompareAlways,depthWrite:null,colorWrite:E.defaultColorWriteParams,stencilWrite:null,stencilTest:z.stencilToolTransparentOccluderParams}),this._occluderPipelineOpaque=E.makePipelineState({blending:u.blendingDefault,polygonOffset:O,depthTest:z.depthCompareAlways,depthWrite:null,colorWrite:E.defaultColorWriteParams,
stencilWrite:z.stencilWriteMaskOff,stencilTest:z.stencilToolMaskOccluderParams}),this._occluderPipelineMaskWrite=E.makePipelineState({blending:null,polygonOffset:O,depthTest:z.depthCompareLess,depthWrite:null,colorWrite:null,stencilWrite:z.stencilWriteMaskOn,stencilTest:z.stencilToolMaskBaseParams}));this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0);return this._makePipelineState(this.configuration.transparencyPassType,!1)};J.getPipelineState=function(I,
O){return O?this._occludeePipelineState:this.configuration.occluder?I===q.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:I===q.RenderSlot.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:F.prototype.getPipelineState.call(this,I,O)};c._createClass(G,[{key:"stippleEnabled",get:function(){return this.configuration.stippleEnabled&&this.configuration.output!==l.ShaderOutput.Highlight}},{key:"primitiveType",get:function(){return this.configuration.wireframe?
A.PrimitiveType.LINES:A.PrimitiveType.TRIANGLE_STRIP}}]);return G}(p.ShaderTechnique);p.shader=new y.ReloadableShaderModule(B.RibbonLineShader,()=>new Promise((F,G)=>a(["./RibbonLine.glsl"],F,G)));const D={factor:0,units:-4};y=function(F){function G(){var J=F.apply(this,arguments)||this;J.output=l.ShaderOutput.Color;J.occluder=!1;J.slicePlaneEnabled=!1;J.transparent=!1;J.polygonOffset=!1;J.writeDepth=!1;J.draped=!1;J.stippleEnabled=!1;J.stippleOffColorEnabled=!1;J.stippleScaleWithLineWidth=!1;J.stipplePreferContinuous=
!0;J.capType=B.CapType.BUTT;J.roundJoins=!1;J.vvSize=!1;J.vvColor=!1;J.vvOpacity=!1;J.falloffEnabled=!1;J.innerColorEnabled=!1;J.sceneHasOcludees=!1;J.transparencyPassType=m.TransparencyPassType.NONE;J.multipassTerrainEnabled=!1;J.cullAboveGround=!1;J.wireframe=!1;return J}c._inheritsLoose(G,F);return G}(h.ShaderTechniqueConfiguration);d.__decorate([h.parameter({count:l.ShaderOutput.COUNT})],y.prototype,"output",void 0);d.__decorate([h.parameter()],y.prototype,"occluder",void 0);d.__decorate([h.parameter()],
y.prototype,"slicePlaneEnabled",void 0);d.__decorate([h.parameter()],y.prototype,"transparent",void 0);d.__decorate([h.parameter()],y.prototype,"polygonOffset",void 0);d.__decorate([h.parameter()],y.prototype,"writeDepth",void 0);d.__decorate([h.parameter()],y.prototype,"draped",void 0);d.__decorate([h.parameter()],y.prototype,"stippleEnabled",void 0);d.__decorate([h.parameter()],y.prototype,"stippleOffColorEnabled",void 0);d.__decorate([h.parameter()],y.prototype,"stippleScaleWithLineWidth",void 0);
d.__decorate([h.parameter()],y.prototype,"stipplePreferContinuous",void 0);d.__decorate([h.parameter({count:B.CapType.COUNT})],y.prototype,"capType",void 0);d.__decorate([h.parameter()],y.prototype,"roundJoins",void 0);d.__decorate([h.parameter()],y.prototype,"vvSize",void 0);d.__decorate([h.parameter()],y.prototype,"vvColor",void 0);d.__decorate([h.parameter()],y.prototype,"vvOpacity",void 0);d.__decorate([h.parameter()],y.prototype,"falloffEnabled",void 0);d.__decorate([h.parameter()],y.prototype,
"innerColorEnabled",void 0);d.__decorate([h.parameter()],y.prototype,"sceneHasOcludees",void 0);d.__decorate([h.parameter({count:m.TransparencyPassType.COUNT})],y.prototype,"transparencyPassType",void 0);d.__decorate([h.parameter()],y.prototype,"multipassTerrainEnabled",void 0);d.__decorate([h.parameter()],y.prototype,"cullAboveGround",void 0);d.__decorate([h.parameter()],y.prototype,"wireframe",void 0);b.RibbonLineTechnique=p;b.RibbonLineTechniqueConfiguration=y;b.ribbonVertexAttributeLocations=
C;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/StencilUtils":function(){define(["exports","./basicInterfaces","../../../webgl/enums"],function(a,b,c){const d={func:c.CompareFunction.LESS},g={function:{func:c.CompareFunction.ALWAYS,ref:b.StencilBits.OutlineVisualElementMask,mask:b.StencilBits.OutlineVisualElementMask},operation:{fail:c.StencilOperation.KEEP,zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.ZERO}},x={function:{func:c.CompareFunction.ALWAYS,
ref:b.StencilBits.OutlineVisualElementMask,mask:b.StencilBits.OutlineVisualElementMask},operation:{fail:c.StencilOperation.KEEP,zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.REPLACE}},w={function:{func:c.CompareFunction.EQUAL,ref:b.StencilBits.OutlineVisualElementMask,mask:b.StencilBits.OutlineVisualElementMask},operation:{fail:c.StencilOperation.KEEP,zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.KEEP}};b={function:{func:c.CompareFunction.NOTEQUAL,ref:b.StencilBits.OutlineVisualElementMask,
mask:b.StencilBits.OutlineVisualElementMask},operation:{fail:c.StencilOperation.KEEP,zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.KEEP}};a.depthCompareAlways={func:c.CompareFunction.ALWAYS};a.depthCompareLess=d;a.renderWhenBitIsNotSet=l=>({function:{func:c.CompareFunction.NOTEQUAL,ref:l,mask:l},operation:{fail:c.StencilOperation.KEEP,zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.KEEP}});a.replaceBitWhenDepthTestPasses=l=>({function:{func:c.CompareFunction.ALWAYS,ref:l,mask:l},operation:{fail:c.StencilOperation.KEEP,
zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.REPLACE}});a.stencilBaseAllZerosParams=g;a.stencilToolMaskBaseParams=x;a.stencilToolMaskOccluderParams=w;a.stencilToolTransparentOccluderParams=b;a.stencilWriteMaskOff={mask:0};a.stencilWriteMaskOn={mask:255};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/RenderContext":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ./Camera ./Material ./RenderPass ./RenderSlot".split(" "),function(a,
b,c,d,g,x){let w=function(){function f(e){this.rctx=e;this.camera=null;this.lastFrameCamera=new c.default;this.pass=g.RenderPass.MATERIAL;this.slot=x.RenderSlot.OPAQUE_MATERIAL;this.highlightDepthTexture=null;this.renderOccludedMask=n;this.hasOccludees=!1;this.hasFillLights=!0}f.prototype.resetRenderOccludedMask=function(){this.renderOccludedMask=n};b._createClass(f,[{key:"isHighlightPass",get:function(){return this.pass===g.RenderPass.MATERIAL_HIGHLIGHT}}]);return f}(),l=function(f){function e(k,
r,y,p,h,m){k=f.call(this,k)||this;k.offscreenRenderingHelper=r;k.scenelightingData=y;k.shadowMap=p;k.ssaoHelper=h;k.sliceHelper=m;return k}b._inheritsLoose(e,f);return e}(w);const n=d.RenderOccludedFlag.Occlude|d.RenderOccludedFlag.OccludeAndTransparent|d.RenderOccludedFlag.OccludeAndTransparentStencil;a.OverlayRenderContext=w;a.RenderContext=l;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextureTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../chunks/TextureOnly.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ./DefaultVertexAttributeLocations ./Program ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k){w=function(r){function y(){return r.apply(this,arguments)||this}c._inheritsLoose(y,r);var p=y.prototype;p.initializeProgram=function(h){const m=y.shader.get().build();return new f.Program(h.rctx,m,n.Default3D)};p.initializePipeline=function(){return this.configuration.hasAlpha?k.makePipelineState({blending:k.separateBlendingParams(e.BlendFactor.SRC_ALPHA,e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA,e.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:k.defaultColorWriteParams}):
k.makePipelineState({colorWrite:k.defaultColorWriteParams})};return y}(w.ShaderTechnique);w.shader=new x.ReloadableShaderModule(g.TextureOnlyShader,()=>new Promise((r,y)=>a(["../core/shaderLibrary/util/TextureOnly.glsl"],r,y)));g=function(r){function y(){var p=r.apply(this,arguments)||this;p.hasAlpha=!1;return p}c._inheritsLoose(y,r);return y}(l.ShaderTechniqueConfiguration);d.__decorate([l.parameter()],g.prototype,"hasAlpha",void 0);b.TextureTechnique=w;b.TextureTechniqueConfiguration=g;Object.defineProperty(b,
"__esModule",{value:!0})})},"esri/chunks/TextureOnly.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder"],function(a,b,c,d){function g(){const w=new d.ShaderBuilder;w.include(b.ScreenSpacePass);w.fragment.uniforms.add("tex","sampler2D");w.fragment.uniforms.add("uColor","vec4");w.fragment.code.add(c.glsl`void main() {
vec4 texColor = texture2D(tex, uv);
gl_FragColor = texColor * uColor;
}`);return w}const x=Object.freeze({__proto__:null,build:g});a.TextureOnlyShader=x;a.build=g})},"esri/views/3d/webgl-engine/lighting/SceneLighting":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec3 ../../../../chunks/vec3f64 ./Lightsources ./SphericalHarmonics".split(" "),function(a,b,c,d,g,x){let w=function(){function n(){this._shOrder=2;this._ambientBoost=.4;this._oldSunlight={direction:d.create(),ambient:{color:d.create(),intensity:1},diffuse:{color:d.create(),
intensity:1}};this.groundLightingFactor=this.globalFactor=.5;this._sphericalHarmonics=new g.SphericalHarmonicsAmbientLight;this._mainLight={intensity:d.create(),direction:d.fromValues(1,0,0),castShadows:!1,specularStrength:1,environmentStrength:1}}var f=n.prototype;f.setLightDirectionUniform=function(e){e.setUniform3fv("lightingMainDirection",this._mainLight.direction)};f.setUniforms=function(e,k,r){e.setUniform1f("lightingFixedFactor",k?(1-this.groundLightingFactor)*(1-this.globalFactor):0);e.setUniform1f("lightingGlobalFactor",
this.globalFactor);this.setLightDirectionUniform(e);e.setUniform3fv("lightingMainIntensity",this._mainLight.intensity);e.setUniform1f("lightingSpecularStrength",this._mainLight.specularStrength);e.setUniform1f("lightingEnvironmentStrength",this._mainLight.environmentStrength);e.setUniform1f("ambientBoostFactor",this._ambientBoost);e.setUniform1b("hasFillLights",r);k=this._sphericalHarmonics;0===this._shOrder?e.setUniform3f("lightingAmbientSH0",k.r[0],k.g[0],k.b[0]):1===this._shOrder?(e.setUniform4f("lightingAmbientSH_R",
k.r[0],k.r[1],k.r[2],k.r[3]),e.setUniform4f("lightingAmbientSH_G",k.g[0],k.g[1],k.g[2],k.g[3]),e.setUniform4f("lightingAmbientSH_B",k.b[0],k.b[1],k.b[2],k.b[3])):2===this._shOrder&&(e.setUniform3f("lightingAmbientSH0",k.r[0],k.g[0],k.b[0]),e.setUniform4f("lightingAmbientSH_R1",k.r[1],k.r[2],k.r[3],k.r[4]),e.setUniform4f("lightingAmbientSH_G1",k.g[1],k.g[2],k.g[3],k.g[4]),e.setUniform4f("lightingAmbientSH_B1",k.b[1],k.b[2],k.b[3],k.b[4]),e.setUniform4f("lightingAmbientSH_R2",k.r[5],k.r[6],k.r[7],k.r[8]),
e.setUniform4f("lightingAmbientSH_G2",k.g[5],k.g[6],k.g[7],k.g[8]),e.setUniform4f("lightingAmbientSH_B2",k.b[5],k.b[6],k.b[7],k.b[8]))};f.set=function(e){x.combineLights(e,this._shOrder,this._mainLight,this._sphericalHarmonics);c.copy(this._oldSunlight.direction,this._mainLight.direction);e=1/Math.PI;this._oldSunlight.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*e;this._oldSunlight.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*e;this._oldSunlight.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*
e;c.scale(this._oldSunlight.diffuse.color,this._mainLight.intensity,e);c.copy(l,this._oldSunlight.diffuse.color);c.scale(l,l,this._ambientBoost*this.globalFactor);c.add(this._oldSunlight.ambient.color,this._oldSunlight.ambient.color,l)};b._createClass(n,[{key:"lightingMainDirection",get:function(){return this._mainLight.direction}},{key:"old",get:function(){return this._oldSunlight}}]);return n}();const l=d.create();a.SceneLighting=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lighting/SphericalHarmonics":function(){define("exports ../../../../core/mathUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../lib/LongVectorMath ./Lightsources".split(" "),
function(a,b,c,d,g,x){function w(q){return(q+1)*(q+1)}function l(q){return b.clamp(Math.floor(Math.sqrt(q)-1),0,2)}function n(q,z,v){const B=q[0],A=q[1];q=q[2];v=v||[];v.length=w(z);0<=z&&(v[0]=.28209479177);1<=z&&(v[1]=.4886025119*B,v[2]=.4886025119*q,v[3]=.4886025119*A);2<=z&&(v[4]=1.09254843059*B*A,v[5]=1.09254843059*A*q,v[6]=.31539156525*(3*q*q-1),v[7]=1.09254843059*B*q,v[8]=.54627421529*(B*B-A*A));return v}function f(q,z){q=w(q);z=z||{r:[],g:[],b:[]};z.r.length=z.g.length=z.b.length=q;for(let v=
0;v<q;v++)z.r[v]=z.g[v]=z.b[v]=0;return z}function e(q,z){const v=l(z.r.length);for(const B of q)c.negate(u,B.direction),n(u,v,h),g.elementwiseProduct(h,t),g.scalarProduct(h,B.intensity[0],m),g.add(z.r,m),g.scalarProduct(h,B.intensity[1],m),g.add(z.g,m),g.scalarProduct(h,B.intensity[2],m),g.add(z.b,m);return z}function k(q,z){n(u,0,h);for(const v of q)z.r[0]+=h[0]*t[0]*v.intensity[0]*4*Math.PI,z.g[0]+=h[0]*t[0]*v.intensity[1]*4*Math.PI,z.b[0]+=h[0]*t[0]*v.intensity[2]*4*Math.PI;return z}const r=[],
y=[],p=[],h=[0],m=[0],u=d.create(),t=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];a.combineLights=function(q,z,v,B){f(z,B);c.set(v.intensity,0,0,0);z=!1;r.length=0;y.length=0;p.length=0;for(const A of q)A instanceof x.MainLight&&!z?(c.copy(v.direction,A.direction),c.copy(v.intensity,A.intensity),v.specularStrength=A.specularStrength,v.environmentStrength=A.environmentStrength,v.castShadows=A.castShadows,z=!0):A instanceof x.MainLight||A instanceof x.FillLight?r.push(A):
A instanceof x.AmbientLight?y.push(A):A instanceof x.SphericalHarmonicsAmbientLight&&p.push(A);e(r,B);k(y,B);for(const A of p)g.add(B.r,A.r),g.add(B.g,A.g),g.add(B.b,A.b)};a.computeCoefficients=n;a.initSHCoefficients=f;a.numberOfCoefficients=w;a.orderFromNumberOfCoefficients=l;a.projectAmbientLights=k;a.projectFillLights=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/LongVectorMath":function(){define(["exports"],function(a){a.add=function(b,c,d){d=d||b;d.length=
b.length;for(let g=0;g<b.length;g++)d[g]=b[g]+c[g];return d};a.dotProduct=function(b,c){let d=0;for(let g=0;g<b.length;g++)d+=b[g]*c[g];return d};a.elementwiseProduct=function(b,c,d){d=d||b;d.length=b.length;for(let g=0;g<b.length;g++)d[g]=b[g]*c[g];return d};a.scalarProduct=function(b,c,d){d=d||b;d.length=b.length;for(let g=0;g<b.length;g++)d[g]=b[g]*c;return d};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/StippleTextureRepository":function(){define(["exports",
"../../../../core/floatRGBA","../../../../core/maybe","../../../webgl/enums","../../../webgl/Texture"],function(a,b,c,d,g){function x(l,n){var f=l.map(h=>Math.round(h*n)),e=1/n;l=Math.floor(f.reduce((h,m)=>h+m));var k=f.reduce((h,m)=>Math.max(h,m));k=(Math.floor(.5*(k-1))+.5)*e;var r=[];let y=1;for(var p of f){for(let h=0;h<p;h++)r.push(y*(Math.min(h,p-1-h)+.5)*e/k*.5+.5);y=-y}p=Math.round(f[0]/2);p=[...r.slice(p),...r.slice(0,p)];f=l+2;e=new Uint8Array(4*f);r=4;for(const h of p)b.packFloatRGBA(h,
e,r),r+=4;e.copyWithin(0,r-4,r);e.copyWithin(r,4,8);return{encodedData:e,sdfNormalizer:k,paddedPixels:f,pixels:l}}let w=function(){function l(f){this._rctx=f;this.cache=new Map}var n=l.prototype;n.dispose=function(){this.cache.forEach(f=>f.texture=c.disposeMaybe(f.texture));this.cache.clear()};n._acquire=function(f){if(c.isNone(f))return null;const e=this._patternId(f);var k=this.cache.get(e);if(k)return k.refCount++,k.bind;k=f.pixelRatio;const {encodedData:r,sdfNormalizer:y,pixels:p,paddedPixels:h}=
x(f.pattern,k),m=p/k,u={refCount:1,texture:null,bind:t=>{c.isNone(u.texture)&&(u.texture=new g.Texture(this._rctx,{width:h,height:1,internalFormat:d.PixelFormat.RGBA,pixelFormat:d.PixelFormat.RGBA,dataType:d.PixelType.UNSIGNED_BYTE,wrapMode:d.TextureWrapMode.CLAMP_TO_EDGE},r));t.bindTexture(u.texture,"stipplePatternTexture");return{pixelSize:m,sdfNormalizer:y,pixels:p}}};this.cache.set(e,u);return u.bind};n.release=function(f){if(!c.isNone(f)){f=this._patternId(f);var e=this.cache.get(f);e&&(e.refCount--,
0===e.refCount&&(c.isSome(e.texture)&&e.texture.dispose(),this.cache.delete(f)))}};n.swap=function(f,e){e=this._acquire(e);this.release(f);return e};n._patternId=function(f){return`${f.pattern.join(",")}-r${f.pixelRatio}`};return l}();a.StippleTextureRepository=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/Compositing.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder"],
function(a,b,c,d){function g(w){const l=new d.ShaderBuilder;l.include(b.ScreenSpacePass);l.fragment.uniforms.add("tex","sampler2D");w.function===a.CompositingFunction.Standard&&(w.hasOpacityFactor?(l.fragment.uniforms.add("opacity","float"),l.fragment.code.add(c.glsl`void main() {
gl_FragColor = texture2D(tex, uv) * opacity;
}`)):l.fragment.code.add(c.glsl`void main() {
gl_FragColor = texture2D(tex, uv);
}`));w.function===a.CompositingFunction.OverlayWithTransparency&&(l.fragment.uniforms.add("overlayIdx","int"),w.hasOpacityFactor&&l.fragment.uniforms.add("opacity","float"),l.fragment.code.add(c.glsl`
      void main() {
        vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
        gl_FragColor = texture2D(tex, overlayUV) ${w.hasOpacityFactor?"* opacity":""};
      }`));w.function===a.CompositingFunction.TransparentToHUDVisibility&&l.fragment.code.add(c.glsl`void main() {
gl_FragColor = vec4(1.0 - texture2D(tex, uv).a);
}`);w.function===a.CompositingFunction.Transparency&&(l.fragment.uniforms.add("colorTexture","sampler2D"),l.fragment.uniforms.add("alphaTexture","sampler2D"),l.fragment.uniforms.add("frontFaceTexture","sampler2D"),l.fragment.code.add(c.glsl`void main() {
vec4 srcColor = texture2D(colorTexture, uv);
float srcAlpha = texture2D(alphaTexture, uv).r;
vec4 frontFace = texture2D(frontFaceTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
gl_FragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`));return l}a.CompositingFunction=void 0;(function(w){w[w.Standard=0]="Standard";w[w.TransparentToHUDVisibility=1]="TransparentToHUDVisibility";w[w.Transparency=2]="Transparency";w[w.OverlayWithTransparency=3]="OverlayWithTransparency";w[w.COUNT=4]="COUNT"})(a.CompositingFunction||(a.CompositingFunction={}));const x=Object.freeze({__proto__:null,get CompositingFunction(){return a.CompositingFunction},build:g});a.CompositingShader=x;a.build=g})},"esri/views/3d/webgl-engine/shaders/CompositingTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/Compositing.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k){b.AlphaMode=void 0;(function(r){r[r.None=0]="None";r[r.Alpha=1]="Alpha";r[r.PremultipliedAlpha=2]="PremultipliedAlpha";r[r.COUNT=3]="COUNT"})(b.AlphaMode||(b.AlphaMode={}));x=function(r){function y(){return r.apply(this,arguments)||this}c._inheritsLoose(y,r);var p=y.prototype;p.initializeProgram=function(h){const m=y.shader.get().build(this.configuration);return new n.Program(h.rctx,m,l.Default3D)};p.initializePipeline=function(){if(this.configuration.function===
f.CompositingFunction.TransparentToHUDVisibility)return k.makePipelineState({colorWrite:{r:!1,g:!0,b:!1,a:!1}});switch(this.configuration.alphaMode){case b.AlphaMode.None:return k.makePipelineState({colorWrite:k.defaultColorWriteParams});case b.AlphaMode.Alpha:return k.makePipelineState({blending:k.separateBlendingParams(e.BlendFactor.SRC_ALPHA,e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA,e.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:k.defaultColorWriteParams});default:return k.makePipelineState({blending:k.simpleBlendingParams(e.BlendFactor.ONE,
e.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:k.defaultColorWriteParams})}};return y}(x.ShaderTechnique);x.shader=new g.ReloadableShaderModule(f.CompositingShader,()=>new Promise((r,y)=>a(["./Compositing.glsl"],r,y)));g=function(r){function y(){var p=r.apply(this,arguments)||this;p.function=f.CompositingFunction.Standard;p.alphaMode=b.AlphaMode.None;p.hasOpacityFactor=!1;return p}c._inheritsLoose(y,r);return y}(w.ShaderTechniqueConfiguration);d.__decorate([w.parameter({count:f.CompositingFunction.COUNT})],
g.prototype,"function",void 0);d.__decorate([w.parameter({count:b.AlphaMode.COUNT})],g.prototype,"alphaMode",void 0);d.__decorate([w.parameter()],g.prototype,"hasOpacityFactor",void 0);b.CompositingTechnique=x;b.CompositingTechniqueConfiguration=g;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/DefaultMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat3f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../ViewingMode ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/util/AlphaDiscard.glsl ../lib/basicInterfaces ../lib/GLMaterialTexture ../lib/Material ../lib/OrderIndependentTransparency ../lib/RenderPass ../lib/RenderSlot ../lib/VertexAttribute ../lib/verticalOffsetUtils ./internal/bufferWriterUtils ./internal/MaterialUtil ../shaders/DefaultMaterialTechnique ../shaders/RealisticTreeTechnique".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B){function A(U){let R=l.newLayout();R=U.instancedDoublePrecision?R.vec3f(u.VertexAttribute.MODELORIGINHI).vec3f(u.VertexAttribute.MODELORIGINLO).mat3f(u.VertexAttribute.MODEL).mat3f(u.VertexAttribute.MODELNORMAL):R.mat4f(u.VertexAttribute.MODEL).mat4f(u.VertexAttribute.MODELNORMAL);U.instanced&&-1<U.instanced.indexOf("color")&&(R=R.vec4f(u.VertexAttribute.INSTANCECOLOR));U.instanced&&-1<U.instanced.indexOf("featureAttribute")&&(R=R.vec4f(u.VertexAttribute.INSTANCEFEATUREATTRIBUTE));
return R}let E=function(U){function R(N){var T=U.call(this,N,D)||this;T.supportsEdges=!0;T.techniqueConfig=new v.DefaultMaterialTechniqueConfiguration;{var S=T.parameters;const H=S.textureId||S.normalTextureId||S.metallicRoughnessTextureId||S.emissiveTextureId||S.occlusionTextureId,Q=l.newLayout().vec3f(u.VertexAttribute.POSITION).vec3f(u.VertexAttribute.NORMAL);S.vertexTangents&&Q.vec4f(u.VertexAttribute.TANGENT);H&&Q.vec2f(u.VertexAttribute.UV0);S.vertexColors&&Q.vec4u8(u.VertexAttribute.COLOR);
S.symbolColors&&Q.vec4u8(u.VertexAttribute.SYMBOLCOLOR);S=Q}T.vertexBufferLayout=S;T.instanceBufferLayout=N.instanced?A(T.parameters):null;return T}b._inheritsLoose(R,U);var L=R.prototype;L.isVisibleInPass=function(N){return N===h.RenderPass.MATERIAL_DEPTH_SHADOWMAP_ALL||N===h.RenderPass.MATERIAL_DEPTH_SHADOWMAP_DEFAULT||N===h.RenderPass.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT?this.parameters.castShadows:!0};L.isVisible=function(){var N=this.parameters;if(!U.prototype.isVisible.call(this)||0===N.layerOpacity)return!1;
var T=N.instanced;const S=N.vertexColors,H=N.symbolColors;T=!!T&&-1<T.indexOf("color");const Q=N.vvColorEnabled,W="replace"===N.colorMixMode,V=0<N.opacity;N=N.externalColor&&0<N.externalColor[3];return S&&(T||Q||H)?W?!0:V:S?W?N:V:T||Q||H?W?!0:V:W?N:V};L.getTechniqueConfig=function(N,T){this.techniqueConfig.output=N;this.techniqueConfig.hasNormalTexture=!!this.parameters.normalTextureId;this.techniqueConfig.hasColorTexture=!!this.parameters.textureId;this.techniqueConfig.vertexTangents=this.parameters.vertexTangents;
this.techniqueConfig.instanced=!!this.parameters.instanced;this.techniqueConfig.instancedDoublePrecision=this.parameters.instancedDoublePrecision;this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled;this.techniqueConfig.verticalOffset=null!==this.parameters.verticalOffset;this.techniqueConfig.screenSizePerspective=null!==this.parameters.screenSizePerspective;this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled;this.techniqueConfig.sliceHighlightDisabled=this.parameters.sliceHighlightDisabled;
this.techniqueConfig.alphaDiscardMode=this.parameters.textureAlphaMode;this.techniqueConfig.normalsTypeDerivate="screenDerivative"===this.parameters.normals?!0:!1;this.techniqueConfig.transparent=this.parameters.transparent;this.techniqueConfig.writeDepth=this.parameters.writeDepth;c.isSome(this.parameters.customDepthTest)&&(this.techniqueConfig.customDepthTest=this.parameters.customDepthTest);this.techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees;this.techniqueConfig.cullFace=this.parameters.slicePlaneEnabled?
k.CullFaceOptions.None:this.parameters.cullFace;this.techniqueConfig.multipassTerrainEnabled=T.multipassTerrainEnabled;this.techniqueConfig.cullAboveGround=T.cullAboveGround;this.techniqueConfig.hasModelTransformation=c.isSome(this.parameters.modelTransformation);if(N===n.ShaderOutput.Color||N===n.ShaderOutput.Alpha)this.techniqueConfig.vertexColors=this.parameters.vertexColors,this.techniqueConfig.symbolColors=this.parameters.symbolColors,this.techniqueConfig.doubleSidedMode=this.parameters.treeRendering?
f.NormalsDoubleSidedMode.WindingOrder:this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?f.NormalsDoubleSidedMode.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?f.NormalsDoubleSidedMode.WindingOrder:f.NormalsDoubleSidedMode.None,this.techniqueConfig.instancedColor=!!this.parameters.instanced&&-1<this.parameters.instanced.indexOf("color"),this.techniqueConfig.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,
this.techniqueConfig.receiveAmbientOcclusion=T.ssaoEnabled?this.parameters.receiveSSAO:!1,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this.techniqueConfig.usePBR=this.parameters.usePBR,this.techniqueConfig.hasMetalnessAndRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this.techniqueConfig.hasEmissionTexture=!!this.parameters.emissiveTextureId,this.techniqueConfig.hasOcclusionTexture=
!!this.parameters.occlusionTextureId,this.techniqueConfig.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this.techniqueConfig.isSchematic=this.parameters.usePBR&&this.parameters.isSchematic,this.techniqueConfig.transparencyPassType=T.transparencyPassType,this.techniqueConfig.enableOffset=T.camera.relativeElevation<p.OITPolygonOffsetLimit;return this.techniqueConfig};L.intersect=function(N,T,S,H,Q,W,V){if(null!==this.parameters.verticalOffset){const aa=
H.camera;g.set(K,S[12],S[13],S[14]);S=null;switch(H.viewingMode){case w.ViewingMode.Global:S=g.normalize(O,K);break;case w.ViewingMode.Local:S=g.copy(O,I)}let X=0;if(null!==this.parameters.verticalOffset){var Y=g.subtract(M,K,aa.eye);const ba=g.length(Y);Y=g.scale(Y,Y,1/ba);let ha=null;this.parameters.screenSizePerspective&&(ha=g.dot(S,Y));X+=z.verticalOffsetAtDistance(aa,ba,this.parameters.verticalOffset,ha,this.parameters.screenSizePerspective)}g.scale(S,S,X);g.transformMat3(P,S,H.transform.inverseRotation);
Q=g.subtract(G,Q,P);W=g.subtract(J,W,P)}z.intersectTriangleGeometry(N,T,H,Q,W,t.getVerticalOffsetObject3D(H.verticalOffset),V)};L.requiresSlot=function(N){return N===(this.parameters.transparent?this.parameters.writeDepth?m.RenderSlot.TRANSPARENT_MATERIAL:m.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:m.RenderSlot.OPAQUE_MATERIAL)||N===m.RenderSlot.DRAPED_MATERIAL};L.createGLMaterial=function(N){return N.output===n.ShaderOutput.Color||N.output===n.ShaderOutput.Alpha||N.output===n.ShaderOutput.Depth||
N.output===n.ShaderOutput.Normal||N.output===n.ShaderOutput.Shadow||N.output===n.ShaderOutput.Highlight?new C(N):null};L.createBufferWriter=function(){return new F(this.vertexBufferLayout,this.instanceBufferLayout)};return R}(y.Material),C=function(U){function R(N){return U.call(this,{...N,...N.material.parameters})||this}b._inheritsLoose(R,U);var L=R.prototype;L.updateParameters=function(N){const T=this._material.parameters;this.updateTexture(T.textureId);return this.ensureTechnique(T.treeRendering?
B.RealisticTreeTechnique:v.DefaultMaterialTechnique,N)};L._updateShadowState=function(N){N.shadowMappingEnabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:N.shadowMappingEnabled})};L._updateOccludeeState=function(N){N.hasOccludees!==this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:N.hasOccludees})};L.beginSlot=function(N){if(this._output===n.ShaderOutput.Color||this._output===n.ShaderOutput.Alpha)this._updateShadowState(N),
this._updateOccludeeState(N);return this.updateParameters(N)};L.bind=function(N,T){T.bindPass(this._material.parameters,N);this.bindTextures(T.program)};return R}(r);const D={textureId:void 0,initTextureTransparent:!1,isSchematic:!1,usePBR:!1,normalTextureId:void 0,vertexTangents:!1,occlusionTextureId:void 0,emissiveTextureId:void 0,metallicRoughnessTextureId:void 0,emissiveFactor:[0,0,0],mrrFactors:[0,1,.5],ambient:[.2,.2,.2],diffuse:[.8,.8,.8],externalColor:[1,1,1,1],colorMixMode:"multiply",opacity:1,
layerOpacity:1,vertexColors:!1,symbolColors:!1,doubleSided:!1,doubleSidedType:"normal",cullFace:k.CullFaceOptions.Back,instanced:void 0,instancedDoublePrecision:!1,normals:"default",receiveSSAO:!0,fillLightsEnabled:!0,receiveShadows:!0,castShadows:!0,shadowMappingEnabled:!1,verticalOffset:null,screenSizePerspective:null,slicePlaneEnabled:!1,sliceHighlightDisabled:!1,offsetTransparentBackfaces:!1,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,
1,1],vvSizeValue:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:d.create(),modelTransformation:null,transparent:!1,writeDepth:!0,customDepthTest:k.DepthTestFunction.Less,textureAlphaMode:k.AlphaDiscardMode.Blend,textureAlphaCutoff:e.defaultMaskAlphaCutoff,textureAlphaPremultiplied:!1,sceneHasOcludees:!1,...y.DefaultMaterialParameters};let F=function(){function U(L,
N){this.vertexBufferLayout=L;this.instanceBufferLayout=N}var R=U.prototype;R.allocate=function(L){return this.vertexBufferLayout.createBuffer(L)};R.elementCount=function(L){return L.indices.get(u.VertexAttribute.POSITION).length};R.write=function(L,N,T,S){q.writeDefaultAttributes(N,this.vertexBufferLayout,L.transformation,L.invTranspTransformation,T,S)};return U}();const G=x.create(),J=x.create(),I=x.fromValues(0,0,1),O=x.create(),P=x.create(),K=x.create(),M=x.create();a.DefaultMaterial=E;a.getInstanceBufferLayout=
A;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../../shaderModules/interfaces"],function(a,b,c){a.NormalsDoubleSidedMode=void 0;(function(d){d[d.None=0]="None";d[d.View=1]="View";d[d.WindingOrder=2]="WindingOrder";d[d.COUNT=3]="COUNT"})(a.NormalsDoubleSidedMode||(a.NormalsDoubleSidedMode={}));a.Normals=function(d,g){d=d.fragment;d.code.add(c.glsl`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`);switch(g.doubleSidedMode){case a.NormalsDoubleSidedMode.None:d.code.add(c.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case a.NormalsDoubleSidedMode.View:d.code.add(c.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case a.NormalsDoubleSidedMode.WindingOrder:d.code.add(c.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:b.neverReached(g.doubleSidedMode);case a.NormalsDoubleSidedMode.COUNT:}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/DefaultMaterialTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Logger ../../../../core/maybe ../../../../chunks/vec3f64 ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../core/shaderLibrary/attributes/VerticalOffset.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderLibrary/shading/ReadShadowMap.glsl ../core/shaderLibrary/shading/VisualVariables.glsl ../core/shaderLibrary/util/DoublePrecision.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../materials/internal/MaterialUtil ../../../../chunks/DefaultMaterial.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E,C,D,F,G,J,I,O,P){const K=g.getLogger("esri.views.3d.webgl-engine.shaders.DefaultTechnique");g=function(M){function U(){return M.apply(this,arguments)||this}c._inheritsLoose(U,M);var R=U.prototype;R.initializeProgram=function(L){var N=U.shader.get();const T=this.configuration;N=N.build({oitEnabled:T.transparencyPassType===E.TransparencyPassType.Color,output:T.output,viewingMode:L.viewingMode,receiveShadows:T.receiveShadows,slicePlaneEnabled:T.slicePlaneEnabled,
sliceHighlightDisabled:T.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,symbolColor:T.symbolColors,vvSize:T.vvSize,vvColor:T.vvColor,vvInstancingEnabled:!0,instanced:T.instanced,instancedColor:T.instancedColor,instancedDoublePrecision:T.instancedDoublePrecision,pbrMode:T.usePBR?T.isSchematic?m.PBRMode.Schematic:m.PBRMode.Normal:m.PBRMode.Disabled,hasMetalnessAndRoughnessTexture:T.hasMetalnessAndRoughnessTexture,hasEmissionTexture:T.hasEmissionTexture,hasOcclusionTexture:T.hasOcclusionTexture,
hasNormalTexture:T.hasNormalTexture,hasColorTexture:T.hasColorTexture,hasModelTransformation:T.hasModelTransformation,receiveAmbientOcclusion:T.receiveAmbientOcclusion,useCustomDTRExponentForWater:!1,normalType:T.normalsTypeDerivate?e.NormalAttributeType.ScreenDerivative:e.NormalAttributeType.Attribute,doubleSidedMode:T.doubleSidedMode,vertexTangents:T.vertexTangents,attributeTextureCoordinates:T.hasMetalnessAndRoughnessTexture||T.hasEmissionTexture||T.hasOcclusionTexture||T.hasNormalTexture||T.hasColorTexture?
k.TextureCoordinateAttributeType.Default:k.TextureCoordinateAttributeType.None,textureAlphaPremultiplied:T.textureAlphaPremultiplied,attributeColor:T.vertexColors,screenSizePerspectiveEnabled:T.screenSizePerspective,verticalOffsetEnabled:T.verticalOffset,offsetBackfaces:T.offsetBackfaces,doublePrecisionRequiresObfuscation:q.doublePrecisionRequiresObfuscation(L.rctx),alphaDiscardMode:T.alphaDiscardMode,supportsTextureAtlas:!1,multipassTerrainEnabled:T.multipassTerrainEnabled,cullAboveGround:T.cullAboveGround});
return new F.Program(L.rctx,N,C.Default3D)};R.bindPass=function(L,N){var T,S;z.bindProjectionMatrix(this.program,N.camera.projectionMatrix);const H=this.configuration.output;this.configuration.hasModelTransformation&&(x.isSome(L.modelTransformation)?this.program.setUniformMatrix4fv("model",L.modelTransformation):K.warnOnce("hasModelTransformation true, but no modelTransformation found."));(this.configuration.output===l.ShaderOutput.Depth||N.multipassTerrainEnabled||H===l.ShaderOutput.Shadow)&&this.program.setUniform2fv("nearFar",
N.camera.nearFar);N.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",N.inverseViewport),p.bindMultipassTerrainTexture(this.program,N));H===l.ShaderOutput.Alpha&&(this.program.setUniform1f("opacity",L.opacity),this.program.setUniform1f("layerOpacity",L.layerOpacity),this.program.setUniform4fv("externalColor",L.externalColor),this.program.setUniform1i("colorMixMode",J.colorMixModes[L.colorMixMode]));H===l.ShaderOutput.Color?(N.lighting.setUniforms(this.program,!1,N.hasFillLights),
this.program.setUniform3fv("ambient",L.ambient),this.program.setUniform3fv("diffuse",L.diffuse),this.program.setUniform4fv("externalColor",L.externalColor),this.program.setUniform1i("colorMixMode",J.colorMixModes[L.colorMixMode]),this.program.setUniform1f("opacity",L.opacity),this.program.setUniform1f("layerOpacity",L.layerOpacity),this.configuration.usePBR&&m.bindPBRUniforms(this.program,L,this.configuration.isSchematic)):H===l.ShaderOutput.Highlight&&y.bindOutputHighlight(this.program,N);t.bindVisualVariablesUniformsForSymbols(this.program,
L);r.bindVerticalOffsetUniforms(this.program,L,N);J.bindScreenSizePerspective(L.screenSizePerspective,this.program,"screenSizePerspectiveAlignment");L.textureAlphaMode!==E.AlphaDiscardMode.Mask&&L.textureAlphaMode!==E.AlphaDiscardMode.MaskBlend||this.program.setUniform1f("textureAlphaCutoff",L.textureAlphaCutoff);null==(T=N.shadowMap)?void 0:T.bind(this.program);null==(S=N.ssaoHelper)?void 0:S.bind(this.program,N.camera)};R.bindDraw=function(L){const N=this.configuration.instancedDoublePrecision?
w.fromValues(L.camera.viewInverseTransposeMatrix[3],L.camera.viewInverseTransposeMatrix[7],L.camera.viewInverseTransposeMatrix[11]):L.origin;z.bindViewCustomOrigin(this.program,N,L.camera.viewMatrix);this.program.rebindTextures();(this.configuration.output===l.ShaderOutput.Color||this.configuration.output===l.ShaderOutput.Alpha||this.configuration.output===l.ShaderOutput.Depth&&this.configuration.screenSizePerspective||this.configuration.output===l.ShaderOutput.Normal&&this.configuration.screenSizePerspective||
this.configuration.output===l.ShaderOutput.Highlight&&this.configuration.screenSizePerspective)&&z.bindCameraPosition(this.program,N,L.camera.viewInverseTransposeMatrix);this.configuration.output===l.ShaderOutput.Normal&&this.program.setUniformMatrix4fv("viewNormal",L.camera.viewInverseTransposeMatrix);this.configuration.instancedDoublePrecision&&f.bindCustomOrigin(this.program,N);n.bindSliceUniforms(this.program,this.configuration,L.slicePlane,{origin:N});this.configuration.output===l.ShaderOutput.Color&&
u.bindReadShadowMapViewCustomOrigin(this.program,L,N)};R._convertDepthTestFunction=function(L){return L===E.DepthTestFunction.Lequal?O.CompareFunction.LEQUAL:O.CompareFunction.LESS};R._setPipeline=function(L,N){const T=this.configuration,S=L===E.TransparencyPassType.NONE,H=L===E.TransparencyPassType.FrontFace;return P.makePipelineState({blending:T.output!==l.ShaderOutput.Color&&T.output!==l.ShaderOutput.Alpha||!T.transparent?null:S?D.blendingDefault:D.oitBlending(L),culling:(T.cullFace?T.cullFace!==
E.CullFaceOptions.None:T.slicePlaneEnabled?!1:!T.transparent&&!T.doubleSidedMode)&&P.cullingParams(T.cullFace),depthTest:{func:D.oitDepthTest(L,this._convertDepthTestFunction(T.customDepthTest))},depthWrite:S||H?T.writeDepth&&P.defaultDepthWriteParams:null,colorWrite:P.defaultColorWriteParams,stencilWrite:T.sceneHasOcludees?G.stencilWriteMaskOn:null,stencilTest:T.sceneHasOcludees?N?G.stencilToolMaskBaseParams:G.stencilBaseAllZerosParams:null,polygonOffset:S||H?null:D.getOITPolygonOffset(T.enableOffset)})};
R.initializePipeline=function(){this._occludeePipelineState=this._setPipeline(this.configuration.transparencyPassType,!0);return this._setPipeline(this.configuration.transparencyPassType,!1)};R.getPipelineState=function(L,N){return N?this._occludeePipelineState:M.prototype.getPipelineState.call(this,L,N)};return U}(B.ShaderTechnique);g.shader=new v.ReloadableShaderModule(I.DefaultMaterialShader,()=>new Promise((M,U)=>a(["./DefaultMaterial.glsl"],M,U)));v=function(M){function U(){var R=M.apply(this,
arguments)||this;R.output=l.ShaderOutput.Color;R.alphaDiscardMode=E.AlphaDiscardMode.Opaque;R.doubleSidedMode=h.NormalsDoubleSidedMode.None;R.isSchematic=!1;R.vertexColors=!1;R.offsetBackfaces=!1;R.symbolColors=!1;R.vvSize=!1;R.vvColor=!1;R.verticalOffset=!1;R.receiveShadows=!1;R.slicePlaneEnabled=!1;R.sliceHighlightDisabled=!1;R.receiveAmbientOcclusion=!1;R.screenSizePerspective=!1;R.textureAlphaPremultiplied=!1;R.hasColorTexture=!1;R.usePBR=!1;R.hasMetalnessAndRoughnessTexture=!1;R.hasEmissionTexture=
!1;R.hasOcclusionTexture=!1;R.hasNormalTexture=!1;R.instanced=!1;R.instancedColor=!1;R.instancedDoublePrecision=!1;R.vertexTangents=!1;R.normalsTypeDerivate=!1;R.writeDepth=!0;R.sceneHasOcludees=!1;R.transparent=!1;R.enableOffset=!0;R.cullFace=E.CullFaceOptions.None;R.transparencyPassType=E.TransparencyPassType.NONE;R.multipassTerrainEnabled=!1;R.cullAboveGround=!1;R.hasModelTransformation=!1;R.customDepthTest=E.DepthTestFunction.Less;return R}c._inheritsLoose(U,M);return U}(A.ShaderTechniqueConfiguration);
d.__decorate([A.parameter({count:l.ShaderOutput.COUNT})],v.prototype,"output",void 0);d.__decorate([A.parameter({count:E.AlphaDiscardMode.COUNT})],v.prototype,"alphaDiscardMode",void 0);d.__decorate([A.parameter({count:h.NormalsDoubleSidedMode.COUNT})],v.prototype,"doubleSidedMode",void 0);d.__decorate([A.parameter()],v.prototype,"isSchematic",void 0);d.__decorate([A.parameter()],v.prototype,"vertexColors",void 0);d.__decorate([A.parameter()],v.prototype,"offsetBackfaces",void 0);d.__decorate([A.parameter()],
v.prototype,"symbolColors",void 0);d.__decorate([A.parameter()],v.prototype,"vvSize",void 0);d.__decorate([A.parameter()],v.prototype,"vvColor",void 0);d.__decorate([A.parameter()],v.prototype,"verticalOffset",void 0);d.__decorate([A.parameter()],v.prototype,"receiveShadows",void 0);d.__decorate([A.parameter()],v.prototype,"slicePlaneEnabled",void 0);d.__decorate([A.parameter()],v.prototype,"sliceHighlightDisabled",void 0);d.__decorate([A.parameter()],v.prototype,"receiveAmbientOcclusion",void 0);
d.__decorate([A.parameter()],v.prototype,"screenSizePerspective",void 0);d.__decorate([A.parameter()],v.prototype,"textureAlphaPremultiplied",void 0);d.__decorate([A.parameter()],v.prototype,"hasColorTexture",void 0);d.__decorate([A.parameter()],v.prototype,"usePBR",void 0);d.__decorate([A.parameter()],v.prototype,"hasMetalnessAndRoughnessTexture",void 0);d.__decorate([A.parameter()],v.prototype,"hasEmissionTexture",void 0);d.__decorate([A.parameter()],v.prototype,"hasOcclusionTexture",void 0);d.__decorate([A.parameter()],
v.prototype,"hasNormalTexture",void 0);d.__decorate([A.parameter()],v.prototype,"instanced",void 0);d.__decorate([A.parameter()],v.prototype,"instancedColor",void 0);d.__decorate([A.parameter()],v.prototype,"instancedDoublePrecision",void 0);d.__decorate([A.parameter()],v.prototype,"vertexTangents",void 0);d.__decorate([A.parameter()],v.prototype,"normalsTypeDerivate",void 0);d.__decorate([A.parameter()],v.prototype,"writeDepth",void 0);d.__decorate([A.parameter()],v.prototype,"sceneHasOcludees",
void 0);d.__decorate([A.parameter()],v.prototype,"transparent",void 0);d.__decorate([A.parameter()],v.prototype,"enableOffset",void 0);d.__decorate([A.parameter({count:E.CullFaceOptions.COUNT})],v.prototype,"cullFace",void 0);d.__decorate([A.parameter({count:E.TransparencyPassType.COUNT})],v.prototype,"transparencyPassType",void 0);d.__decorate([A.parameter()],v.prototype,"multipassTerrainEnabled",void 0);d.__decorate([A.parameter()],v.prototype,"cullAboveGround",void 0);d.__decorate([A.parameter()],
v.prototype,"hasModelTransformation",void 0);d.__decorate([A.parameter({count:E.DepthTestFunction.COUNT})],v.prototype,"customDepthTest",void 0);b.DefaultMaterialTechnique=g;b.DefaultMaterialTechniqueConfiguration=v;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl":function(){define("exports ../../../../../../chunks/vec3f64 ../ShaderOutputOptions ../util/DoublePrecision.glsl ../../shaderModules/interfaces ../../../lib/VertexAttribute ../../../../../webgl/doublePrecisionUtils".split(" "),
function(a,b,c,d,g,x,w){const l=b.create(),n=b.create();a.InstancedDoublePrecision=function(f,e){e.instanced&&e.instancedDoublePrecision&&(f.attributes.add(x.VertexAttribute.MODELORIGINHI,"vec3"),f.attributes.add(x.VertexAttribute.MODELORIGINLO,"vec3"),f.attributes.add(x.VertexAttribute.MODEL,"mat3"),f.attributes.add(x.VertexAttribute.MODELNORMAL,"mat3"));e.instancedDoublePrecision&&(f.vertex.include(d.DoublePrecision,e),f.vertex.uniforms.add("viewOriginHi","vec3"),f.vertex.uniforms.add("viewOriginLo",
"vec3"));const k=[g.glsl`
    vec3 calculateVPos() {
      ${e.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"}
    }
    `,g.glsl`
    vec3 subtractOrigin(vec3 _pos) {
      ${e.instancedDoublePrecision?g.glsl`
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `,g.glsl`
    vec3 dpNormal(vec4 _normal) {
      ${e.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"}
    }
    `,g.glsl`
    vec3 dpNormalView(vec4 _normal) {
      ${e.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"}
    }
    `,e.vertexTangents?g.glsl`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${e.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}

    }
    `:g.glsl``];f.vertex.code.add(k[0]);f.vertex.code.add(k[1]);f.vertex.code.add(k[2]);e.output===c.ShaderOutput.Normal&&f.vertex.code.add(k[3]);f.vertex.code.add(k[4])};a.InstancedDoublePrecisionUniforms=function(){};a.bindCustomOrigin=function(f,e){w.encodeDoubleArraySplit(e,l,n,3);f.setUniform3fv("viewOriginHi",l);f.setUniform3fv("viewOriginLo",n)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DoublePrecision.glsl":function(){define(["exports",
"../../../../../../core/has","../../shaderModules/interfaces"],function(a,b,c){a.DoublePrecision=function({code:d},g){g.doublePrecisionRequiresObfuscation?d.add(c.glsl`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):d.add(c.glsl`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)};a.doublePrecisionRequiresObfuscation=function(d){return b("force-double-precision-obfuscation")?!0:d.driverTest.doublePrecisionRequiresObfuscation};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl":function(){define(["exports","../util/DecodeNormal.glsl","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,c,d){a.NormalAttributeType=void 0;(function(g){g[g.Attribute=0]="Attribute";g[g.CompressedAttribute=
1]="CompressedAttribute";g[g.Ground=2]="Ground";g[g.ScreenDerivative=3]="ScreenDerivative";g[g.COUNT=4]="COUNT"})(a.NormalAttributeType||(a.NormalAttributeType={}));a.NormalAttribute=function(g,x){x.normalType===a.NormalAttributeType.Attribute&&(g.attributes.add(d.VertexAttribute.NORMAL,"vec3"),g.vertex.code.add(c.glsl`vec3 normalModel() {
return normal;
}`));x.normalType===a.NormalAttributeType.CompressedAttribute&&(g.include(b.DecodeNormal),g.attributes.add(d.VertexAttribute.NORMALCOMPRESSED,"vec2"),g.vertex.code.add(c.glsl`vec3 normalModel() {
return decodeNormal(normalCompressed);
}`));x.normalType===a.NormalAttributeType.ScreenDerivative&&(g.extensions.add("GL_OES_standard_derivatives"),g.fragment.code.add(c.glsl`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DecodeNormal.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.DecodeNormal=function(c){const d=b.glsl`vec3 decodeNormal(vec2 f) {
float z = 1.0 - abs(f.x) - abs(f.y);
return vec3(f + sign(f) * min(z, 0.0), z);
}`;c.fragment.code.add(d);c.vertex.code.add(d)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/DefaultMaterial.glsl":function(){define("exports ../views/ViewingMode ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/Offset.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl ../views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/HeaderComment.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E,C,D,F,G,J,I,O){function P(M){const U=new I.ShaderBuilder,R=U.vertex.code,L=U.fragment.code;U.include(F.HeaderComment,{name:"Default Material Shader",output:M.output});U.vertex.uniforms.add("proj","mat4").add("view","mat4").add("cameraPosition","vec3").add("localOrigin","vec3");const N=M.hasModelTransformation;N&&U.vertex.uniforms.add("model","mat4");U.include(f.PositionAttribute);U.varyings.add("vpos","vec3");U.include(C.VisualVariables,M);
U.include(l.InstancedDoublePrecision,M);U.include(p.VerticalOffset,M);if(M.output===g.ShaderOutput.Color||M.output===g.ShaderOutput.Alpha)U.include(n.NormalAttribute,M),U.include(w.Transform,{linearDepth:!1,hasModelTransformation:N}),M.normalType===n.NormalAttributeType.Attribute&&M.offsetBackfaces&&U.include(d.Offset),U.include(u.ComputeNormalTexture,M),U.include(y.VertexNormal,M),M.instancedColor&&U.attributes.add(O.VertexAttribute.INSTANCECOLOR,"vec4"),U.varyings.add("localvpos","vec3"),U.include(k.TextureCoordinateAttribute,
M),U.include(c.ForwardLinearDepth,M),U.include(e.SymbolColor,M),U.include(r.VertexColor,M),U.vertex.uniforms.add("externalColor","vec4"),U.varyings.add("vcolorExt","vec4"),M.multipassTerrainEnabled&&U.varyings.add("depth","float"),R.add(J.glsl`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${M.instancedColor?"vcolorExt *\x3d instanceColor;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${J.glsl.float(D.symbolAlphaCutoff)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        }
        else {
          vpos = calculateVPos();
          localvpos = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${M.normalType===n.NormalAttributeType.Attribute?J.glsl`
          vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${M.vertexTangents?"vTangent \x3d dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, ${N?"model,":""} vpos);
          ${M.normalType===n.NormalAttributeType.Attribute&&M.offsetBackfaces?"gl_Position \x3d offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${M.multipassTerrainEnabled?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
      }
    `);M.output===g.ShaderOutput.Alpha&&(U.include(x.Slice,M),U.include(D.DiscardOrAdjustAlpha,M),M.multipassTerrainEnabled&&(U.fragment.include(m.ReadLinearDepth),U.include(z.multipassTerrainTest,M)),U.fragment.uniforms.add("cameraPosition","vec3").add("localOrigin","vec3").add("opacity","float").add("layerOpacity","float"),M.hasColorTexture&&U.fragment.uniforms.add("tex","sampler2D"),U.fragment.include(G.MixExternalColor),L.add(J.glsl`
      void main() {
        discardBySlice(vpos);
        ${M.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${M.hasColorTexture?J.glsl`
        vec4 texColor = texture2D(tex, vuv0);
        ${M.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
        discardOrAdjustAlpha(texColor);`:J.glsl`vec4 texColor = vec4(1.0);`}
        ${M.attributeColor?J.glsl`
        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:J.glsl`
        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));
        `}
        gl_FragColor = vec4(opacity_);
      }
    `));M.output===g.ShaderOutput.Color&&(U.include(x.Slice,M),U.include(q.EvaluateSceneLighting,M),U.include(t.EvaluateAmbientOcclusion,M),U.include(D.DiscardOrAdjustAlpha,M),M.receiveShadows&&U.include(E.ReadShadowMap,M),M.multipassTerrainEnabled&&(U.fragment.include(m.ReadLinearDepth),U.include(z.multipassTerrainTest,M)),U.fragment.uniforms.add("cameraPosition","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("opacity","float").add("layerOpacity","float"),M.hasColorTexture&&
U.fragment.uniforms.add("tex","sampler2D"),U.include(A.PhysicallyBasedRenderingParameters,M),U.include(B.PhysicallyBasedRendering,M),U.fragment.include(G.MixExternalColor),U.include(v.Normals,M),L.add(J.glsl`
      void main() {
        discardBySlice(vpos);
        ${M.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${M.hasColorTexture?J.glsl`
        vec4 texColor = texture2D(tex, vuv0);
        ${M.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
        discardOrAdjustAlpha(texColor);`:J.glsl`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${M.normalType===n.NormalAttributeType.ScreenDerivative?J.glsl`
        vec3 normal = screenDerivativeNormal(localvpos);`:J.glsl`
        shadingParams.normalView = vNormalWorld;
        vec3 normal = shadingNormal(shadingParams);`}
        ${M.pbrMode===A.PBRMode.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${M.receiveShadows?"float shadow \x3d readShadowMap(vpos, linearDepth);":M.viewingMode===b.ViewingMode.Global?"float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow \x3d 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${M.attributeColor?J.glsl`
        vec3 albedo_ = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:J.glsl`
        vec3 albedo_ = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));
        `}
        ${M.hasNormalTexture?J.glsl`
              mat3 tangentSpace = ${M.vertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
              vec3 shadedNormal = computeTextureNormal(tangentSpace, vuv0);`:"vec3 shadedNormal \x3d normal;"}
        ${M.pbrMode===A.PBRMode.Normal||M.pbrMode===A.PBRMode.Schematic?M.viewingMode===b.ViewingMode.Global?J.glsl`vec3 normalGround = normalize(vpos + localOrigin);`:J.glsl`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:J.glsl``}
        ${M.pbrMode===A.PBRMode.Normal||M.pbrMode===A.PBRMode.Schematic?J.glsl`
            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];
            vec3 shadedColor = evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:"vec3 shadedColor \x3d evaluateSceneLighting(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight);"}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${M.oitEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
      }
    `));U.include(h.DefaultMaterialAuxiliaryPasses,M);return U}const K=Object.freeze({__proto__:null,build:P});a.DefaultMaterialShader=K;a.build=P})},"esri/views/3d/webgl-engine/core/shaderLibrary/Offset.glsl":function(){define(["exports","../shaderModules/interfaces"],function(a,b){a.Offset=function(c){c.vertex.code.add(b.glsl`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl":function(){define(["exports","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,c){a.PositionAttribute=function(d){d.attributes.add(c.VertexAttribute.POSITION,"vec3");d.vertex.code.add(b.glsl`vec3 positionModel() { return position; }`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl":function(){define(["exports",
"../../../collections/Component/Material/shader/DecodeSymbolColor.glsl","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,c,d){a.SymbolColor=function(g,x){x.symbolColor?(g.include(b.DecodeSymbolColor),g.attributes.add(d.VertexAttribute.SYMBOLCOLOR,"vec4"),g.varyings.add("colorMixMode","mediump float")):g.fragment.uniforms.add("colorMixMode","int");x.symbolColor?g.vertex.code.add(c.glsl`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`):g.vertex.code.add(c.glsl`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/DecodeSymbolColor.glsl":function(){define(["exports","../../../../../layers/support/symbolColorUtils","../../../../core/shaderModules/interfaces"],function(a,b,c){a.DecodeSymbolColor=function(d){d.vertex.code.add(c.glsl`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${c.glsl.int(b.ColorMixModeEnum.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${c.glsl.int(b.ColorMixModeEnum.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${c.glsl.int(b.ColorMixModeEnum.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${c.glsl.int(b.ColorMixModeEnum.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/symbolColorUtils":function(){define(["exports","../../../../core/mathUtils","../../../../core/maybe"],function(a,b,c){a.ColorMixModeEnum=void 0;(function(d){d[d.Multiply=1]="Multiply";d[d.Ignore=2]="Ignore";d[d.Replace=3]="Replace";d[d.Tint=4]="Tint"})(a.ColorMixModeEnum||(a.ColorMixModeEnum={}));a.encodeSymbolColor=function(d,g,x){if(c.isNone(d)||g===a.ColorMixModeEnum.Ignore)x[0]=255,x[1]=255,x[2]=255,x[3]=255;
else{var w=b.clamp(Math.round(85*d[3]),0,85);g=0===w||g===a.ColorMixModeEnum.Tint?0:g===a.ColorMixModeEnum.Replace?85:170;x[0]=b.clamp(Math.round(255*d[0]),0,255);x[1]=b.clamp(Math.round(255*d[1]),0,255);x[2]=b.clamp(Math.round(255*d[2]),0,255);x[3]=w+g}};a.parseColorMixMode=function(d){switch(d){case "multiply":return a.ColorMixModeEnum.Multiply;case "ignore":return a.ColorMixModeEnum.Ignore;case "replace":return a.ColorMixModeEnum.Replace;case "tint":return a.ColorMixModeEnum.Tint;default:return a.ColorMixModeEnum.Multiply}};
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl":function(){define(["exports","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,c){a.VertexColor=function(d,g){g.attributeColor?(d.attributes.add(c.VertexAttribute.COLOR,"vec4"),d.varyings.add("vColor","vec4"),d.vertex.code.add(b.glsl`void forwardVertexColor() { vColor = color; }`),d.vertex.code.add(b.glsl`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):
d.vertex.code.add(b.glsl`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl":function(){define(["exports","../../../../../ViewingMode","./NormalAttribute.glsl","./VertexPosition.glsl","../../shaderModules/interfaces"],function(a,b,c,d,g){a.VertexNormal=function(x,w){w.normalType===c.NormalAttributeType.Attribute||w.normalType===c.NormalAttributeType.CompressedAttribute?(x.include(c.NormalAttribute,w),x.varyings.add("vNormalWorld",
"vec3"),x.varyings.add("vNormalView","vec3"),x.vertex.uniforms.add("transformNormalGlobalFromModel","mat3"),x.vertex.uniforms.add("transformNormalViewFromGlobal","mat3"),x.vertex.code.add(g.glsl`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`)):w.normalType===c.NormalAttributeType.Ground?(x.include(d.VertexPosition,w),x.varyings.add("vNormalWorld","vec3"),x.vertex.code.add(g.glsl`
    void forwardNormal() {
      vNormalWorld = ${w.viewingMode===b.ViewingMode.Global?g.glsl`normalize(vPositionWorldCameraRelative);`:g.glsl`vec3(0.0, 0.0, 1.0);`}
    }
    `)):x.vertex.code.add(g.glsl`void forwardNormal() {}`)};a.bindVertexNormalUniforms=function(x,w){x.setUniformMatrix4fv("viewNormal",w)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexPosition.glsl":function(){define("exports ../../../../../../chunks/mat3f64 ../../../../../../chunks/mat4f64 ../../../../../../chunks/vec3f64 ./PositionAttribute.glsl ../util/DoublePrecision.glsl ../../shaderModules/interfaces".split(" "),function(a,
b,c,d,g,x,w){a.VertexPosition=function(l,n){l.include(g.PositionAttribute);l.vertex.include(x.DoublePrecision,n);l.varyings.add("vPositionWorldCameraRelative","vec3");l.varyings.add("vPosition_view","vec3");l.vertex.uniforms.add("transformWorldFromModelRS","mat3");l.vertex.uniforms.add("transformWorldFromModelTH","vec3");l.vertex.uniforms.add("transformWorldFromModelTL","vec3");l.vertex.uniforms.add("transformWorldFromViewTH","vec3");l.vertex.uniforms.add("transformWorldFromViewTL","vec3");l.vertex.uniforms.add("transformViewFromCameraRelativeRS",
"mat3");l.vertex.uniforms.add("transformProjFromView","mat4");l.vertex.code.add(w.glsl`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}
vec3 position_view() {
return transformViewFromCameraRelativeRS * positionWorldCameraRelative();
}
void forwardPosition() {
vPositionWorldCameraRelative = positionWorldCameraRelative();
vPosition_view = position_view();
gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
}
vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`);l.fragment.uniforms.add("transformWorldFromViewTL","vec3");l.fragment.code.add(w.glsl`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)};a.VertexPositionModelTransform=function(){this.transformWorldFromModelRS=b.create();this.transformWorldFromModelTH=d.create();this.transformWorldFromModelTL=d.create()};a.VertexPositionViewProjectionTransform=function(){this.transformWorldFromViewTH=d.create();this.transformWorldFromViewTL=d.create();this.transformViewFromCameraRelativeRS=b.create();this.transformProjFromView=c.create()};a.bindModelTransform=function(l,n){l.setUniformMatrix3fv("transformWorldFromModelRS",n.transformWorldFromModelRS);
l.setUniform3fv("transformWorldFromModelTH",n.transformWorldFromModelTH);l.setUniform3fv("transformWorldFromModelTL",n.transformWorldFromModelTL)};a.bindViewProjTransform=function(l,n){l.setUniform3fv("transformWorldFromViewTH",n.transformWorldFromViewTH);l.setUniform3fv("transformWorldFromViewTL",n.transformWorldFromViewTL);l.setUniformMatrix4fv("transformProjFromView",n.transformProjFromView);l.setUniformMatrix3fv("transformViewFromCameraRelativeRS",n.transformViewFromCameraRelativeRS)};Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl":function(){define("exports ../ShaderOutputOptions ../Slice.glsl ../Transform.glsl ../attributes/NormalAttribute.glsl ../attributes/TextureCoordinateAttribute.glsl ../attributes/VertexNormal.glsl ../output/OutputDepth.glsl ../output/OutputHighlight.glsl ../shading/VisualVariables.glsl ../util/AlphaDiscard.glsl ../../shaderModules/interfaces".split(" "),function(a,b,c,d,g,x,w,l,n,
f,e,k){a.DefaultMaterialAuxiliaryPasses=function(r,y){const p=r.vertex.code,h=r.fragment.code,m=y.hasModelTransformation;if(y.output===b.ShaderOutput.Depth||y.output===b.ShaderOutput.Shadow)r.include(d.Transform,{linearDepth:!0,hasModelTransformation:m}),r.include(x.TextureCoordinateAttribute,y),r.include(f.VisualVariables,y),r.include(l.OutputDepth,y),r.include(c.Slice,y),r.vertex.uniforms.add("nearFar","vec2"),r.varyings.add("depth","float"),y.hasColorTexture&&r.fragment.uniforms.add("tex","sampler2D"),
p.add(k.glsl`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPositionWithDepth(proj, view, ${m?"model,":""} vpos, nearFar, depth);
        forwardTextureCoordinates();
      }
    `),r.include(e.DiscardOrAdjustAlpha,y),h.add(k.glsl`
      void main(void) {
        discardBySlice(vpos);
        ${y.hasColorTexture?k.glsl`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}
        outputDepth(depth);
      }
    `);y.output===b.ShaderOutput.Normal&&(r.include(d.Transform,{linearDepth:!1,hasModelTransformation:m}),r.include(g.NormalAttribute,y),r.include(w.VertexNormal,y),r.include(x.TextureCoordinateAttribute,y),r.include(f.VisualVariables,y),y.hasColorTexture&&r.fragment.uniforms.add("tex","sampler2D"),r.vertex.uniforms.add("viewNormal","mat4"),r.varyings.add("vPositionView","vec3"),p.add(k.glsl`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        ${y.normalType===g.NormalAttributeType.Attribute?k.glsl`
        vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:""}
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, ${m?"model,":""} vpos);
        forwardTextureCoordinates();
      }
    `),r.include(c.Slice,y),r.include(e.DiscardOrAdjustAlpha,y),h.add(k.glsl`
      void main() {
        discardBySlice(vpos);
        ${y.hasColorTexture?k.glsl`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}

        ${y.normalType===g.NormalAttributeType.ScreenDerivative?k.glsl`
            vec3 normal = screenDerivativeNormal(vPositionView);`:k.glsl`
            vec3 normal = normalize(vNormalWorld);
            if (gl_FrontFacing == false) normal = -normal;`}
        gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
      }
    `));y.output===b.ShaderOutput.Highlight&&(r.include(d.Transform,{linearDepth:!1,hasModelTransformation:m}),r.include(x.TextureCoordinateAttribute,y),r.include(f.VisualVariables,y),y.hasColorTexture&&r.fragment.uniforms.add("tex","sampler2D"),p.add(k.glsl`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, ${m?"model,":""} vpos);
        forwardTextureCoordinates();
      }
    `),r.include(c.Slice,y),r.include(e.DiscardOrAdjustAlpha,y),r.include(n.OutputHighlight),h.add(k.glsl`
      void main() {
        discardBySlice(vpos);
        ${y.hasColorTexture?k.glsl`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}
        outputHighlight();
      }
    `))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl":function(){define("exports ../attributes/TextureCoordinateAttribute.glsl ../attributes/VertexTextureCoordinates.glsl ./Normals.glsl ../../shaderModules/interfaces ../../../lib/VertexAttribute".split(" "),function(a,b,c,d,g,x){a.ComputeNormalTexture=function(w,l){const n=w.fragment;l.vertexTangents?(w.attributes.add(x.VertexAttribute.TANGENT,"vec4"),w.varyings.add("vTangent",
"vec4"),l.doubleSidedMode===d.NormalsDoubleSidedMode.WindingOrder?n.code.add(g.glsl`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):n.code.add(g.glsl`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):(w.extensions.add("GL_OES_standard_derivatives"),n.code.add(g.glsl`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`));l.attributeTextureCoordinates!==b.TextureCoordinateAttributeType.None&&(w.include(c.VertexTextureCoordinates,l),n.uniforms.add("normalTexture","sampler2D"),n.uniforms.add("normalTextureSize","vec2"),n.code.add(g.glsl`
    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
      vtc.uv = uv;
      ${l.supportsTextureAtlas?"vtc.size \x3d normalTextureSize;":""}
      vec3 rawNormal = textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;
      return tangentSpace * rawNormal;
    }
  `))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.EvaluateAmbientOcclusion=function(c,d){c=c.fragment;d.receiveAmbientOcclusion?(c.uniforms.add("ssaoTex","sampler2D"),c.uniforms.add("viewportPixelSz","vec4"),c.code.add(b.glsl`float evaluateAmbientOcclusion() {
return 1.0 - texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
}
float evaluateAmbientOcclusionInverse() {
float ssao = texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
return viewportPixelSz.z < 0.0 ? 1.0 : ssao;
}`)):c.code.add(b.glsl`float evaluateAmbientOcclusion() { return 0.0; }
float evaluateAmbientOcclusionInverse() { return 1.0; }`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl":function(){define("exports ../../../../../ViewingMode ./EvaluateAmbientLighting.glsl ./EvaluateAmbientOcclusion.glsl ./EvaluateMainLighting.glsl ./PhysicallyBasedRendering.glsl ./PhysicallyBasedRenderingParameters.glsl ./PiUtils.glsl ./ReadShadowMap.glsl ../../shaderModules/interfaces".split(" "),function(a,
b,c,d,g,x,w,l,n,f){a.EvaluateSceneLighting=function(e,k){const r=e.fragment;e.include(g.EvaluateMainLighting);e.include(d.EvaluateAmbientOcclusion,k);k.pbrMode!==w.PBRMode.Disabled&&e.include(x.PhysicallyBasedRendering,k);e.include(c.EvaluateAmbientLighting,k);k.receiveShadows&&e.include(n.ReadShadowMap,k);r.uniforms.add("lightingGlobalFactor","float");r.uniforms.add("ambientBoostFactor","float");r.uniforms.add("hasFillLights","bool");e.include(l.PiUtils);r.code.add(f.glsl`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${k.pbrMode===w.PBRMode.Disabled?"":"const vec3 GROUND_REFLECTANCE \x3d vec3(0.2);"}
  `);r.code.add(f.glsl`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${k.viewingMode===b.ViewingMode.Global?f.glsl`normalize(vPosWorld)`:f.glsl`vec3(0.0, 0.0, 1.0)`}, lightingMainDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `);r.code.add(f.glsl`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * lightingMainIntensity;
}`);if(k.pbrMode===w.PBRMode.Disabled||k.pbrMode===w.PBRMode.WaterOnIntegratedMesh)r.code.add(f.glsl`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);else if(k.pbrMode===w.PBRMode.Normal||k.pbrMode===w.PBRMode.Schematic)r.code.add(f.glsl`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 mainLightDirection = lightingMainDirection;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),r.code.add(f.glsl`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),r.code.add(f.glsl`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * lightingMainIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * lightingMainIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),r.code.add(f.glsl`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * lightingMainIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * lightingMainIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
inputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;
inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),r.code.add(f.glsl`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${k.pbrMode===w.PBRMode.Schematic?f.glsl`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:f.glsl`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/HeaderComment.glsl":function(){define(["exports","../ShaderOutputOptions","../../shaderModules/interfaces","../../../../../webgl/checkWebGLError"],function(a,b,c,d){a.HeaderComment=function(g,x){x=c.glsl`
  /*
  *  ${x.name}
  *  ${x.output===b.ShaderOutput.Color?"RenderOutput: Color":x.output===b.ShaderOutput.Depth?"RenderOutput: Depth":x.output===b.ShaderOutput.Shadow?"RenderOutput: Shadow":x.output===b.ShaderOutput.Normal?"RenderOutput: Normal":x.output===b.ShaderOutput.Highlight?"RenderOutput: Highlight":""}
  */
  `;d.webglValidateShadersEnabled()&&(g.fragment.code.add(x),g.vertex.code.add(x))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl":function(){define(["exports","../../../../layers/support/symbolColorUtils","./ColorConversion.glsl","../../shaderModules/interfaces"],function(a,b,c,d){a.MixExternalColor=function(g){g.include(c.ColorConversion);g.code.add(d.glsl`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${d.glsl.int(b.ColorMixModeEnum.Multiply)}) {
        return allMixed;
      }
      else if (mode == ${d.glsl.int(b.ColorMixModeEnum.Ignore)}) {
        return internalMixed;
      }
      else if (mode == ${d.glsl.int(b.ColorMixModeEnum.Replace)}) {
        return externalColor;
      }
      else {
        // tint (or something invalid)
        float vIn = rgb2v(internalMixed);
        vec3 hsvTint = rgb2hsv(externalColor);
        vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
        return hsv2rgb(hsvOut);
      }
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${d.glsl.int(b.ColorMixModeEnum.Ignore)}) {
        return internalMixed;
      }
      else if (mode == ${d.glsl.int(b.ColorMixModeEnum.Replace)}) {
        return externalOpacity;
      }
      else {
        // multiply or tint (or something invalid)
        return allMixed;
      }
    }
  `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/RealisticTreeTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../../../../chunks/RealisticTree.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderLibrary/util/DoublePrecision.glsl ../core/shaderTechnique/ReloadableShaderModule ../lib/basicInterfaces ../lib/DefaultVertexAttributeLocations ../lib/Program ./DefaultMaterialTechnique".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y){y=function(p){function h(){return p.apply(this,arguments)||this}c._inheritsLoose(h,p);h.prototype.initializeProgram=function(m){var u=h.shader.get();const t=this.configuration;u=u.build({oitEnabled:t.transparencyPassType===e.TransparencyPassType.Color,output:t.output,viewingMode:m.viewingMode,receiveShadows:t.receiveShadows,slicePlaneEnabled:t.slicePlaneEnabled,sliceHighlightDisabled:t.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,symbolColor:t.symbolColors,
vvSize:t.vvSize,vvColor:t.vvColor,vvInstancingEnabled:!0,instanced:t.instanced,instancedColor:t.instancedColor,instancedDoublePrecision:t.instancedDoublePrecision,pbrMode:t.usePBR?l.PBRMode.Normal:l.PBRMode.Disabled,hasMetalnessAndRoughnessTexture:!1,hasEmissionTexture:!1,hasOcclusionTexture:!1,hasNormalTexture:!1,hasColorTexture:t.hasColorTexture,hasModelTransformation:!1,receiveAmbientOcclusion:t.receiveAmbientOcclusion,useCustomDTRExponentForWater:!1,normalType:d.NormalAttributeType.Attribute,
doubleSidedMode:w.NormalsDoubleSidedMode.WindingOrder,vertexTangents:!1,attributeTextureCoordinates:t.hasColorTexture?g.TextureCoordinateAttributeType.Default:g.TextureCoordinateAttributeType.None,textureAlphaPremultiplied:t.textureAlphaPremultiplied,attributeColor:t.vertexColors,screenSizePerspectiveEnabled:t.screenSizePerspective,verticalOffsetEnabled:t.verticalOffset,offsetBackfaces:t.offsetBackfaces,doublePrecisionRequiresObfuscation:n.doublePrecisionRequiresObfuscation(m.rctx),alphaDiscardMode:t.alphaDiscardMode,
supportsTextureAtlas:!1,multipassTerrainEnabled:t.multipassTerrainEnabled,cullAboveGround:t.cullAboveGround});return new r.Program(m.rctx,u,k.Default3D)};return h}(y.DefaultMaterialTechnique);y.shader=new f.ReloadableShaderModule(x.RealisticTreeShader,()=>new Promise((p,h)=>a(["../core/shaderLibrary/default/RealisticTree.glsl"],p,h)));b.RealisticTreeTechnique=y;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/RealisticTree.glsl":function(){define("exports ../views/ViewingMode ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/Offset.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl ../views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E,C,D,F){function G(I){const O=new D.ShaderBuilder,P=O.vertex.code,K=O.fragment.code;O.vertex.uniforms.add("proj","mat4").add("view","mat4").add("cameraPosition","vec3").add("localOrigin","vec3");O.include(f.PositionAttribute);O.varyings.add("vpos","vec3");O.include(B.VisualVariables,I);O.include(l.InstancedDoublePrecision,I);O.include(y.VerticalOffset,I);if(I.output===g.ShaderOutput.Color||I.output===g.ShaderOutput.Alpha)O.include(n.NormalAttribute,
I),O.include(w.Transform,{linearDepth:!1}),I.offsetBackfaces&&O.include(d.Offset),I.instancedColor&&O.attributes.add(F.VertexAttribute.INSTANCECOLOR,"vec4"),O.varyings.add("vNormalWorld","vec3"),O.varyings.add("localvpos","vec3"),I.multipassTerrainEnabled&&O.varyings.add("depth","float"),O.include(k.TextureCoordinateAttribute,I),O.include(c.ForwardLinearDepth,I),O.include(e.SymbolColor,I),O.include(r.VertexColor,I),O.vertex.uniforms.add("externalColor","vec4"),O.varyings.add("vcolorExt","vec4"),P.add(C.glsl`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${I.instancedColor?"vcolorExt *\x3d instanceColor;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${C.glsl.float(A.symbolAlphaCutoff)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          }
          else {
            vpos = calculateVPos();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${I.offsetBackfaces?"gl_Position \x3d offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${I.multipassTerrainEnabled?C.glsl`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `);I.output===g.ShaderOutput.Alpha&&(O.include(x.Slice,I),O.include(A.DiscardOrAdjustAlpha,I),I.multipassTerrainEnabled&&(O.fragment.include(h.ReadLinearDepth),O.include(t.multipassTerrainTest,I)),O.fragment.uniforms.add("cameraPosition","vec3").add("localOrigin","vec3").add("opacity","float").add("layerOpacity","float"),O.fragment.uniforms.add("view","mat4"),I.hasColorTexture&&O.fragment.uniforms.add("tex","sampler2D"),O.fragment.include(E.MixExternalColor),K.add(C.glsl`
      void main() {
        discardBySlice(vpos);
        ${I.multipassTerrainEnabled?C.glsl`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${I.hasColorTexture?C.glsl`
        vec4 texColor = texture2D(tex, vuv0);
        ${I.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
        discardOrAdjustAlpha(texColor);`:C.glsl`vec4 texColor = vec4(1.0);`}
        ${I.attributeColor?C.glsl`
        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:C.glsl`
        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));
        `}

        gl_FragColor = vec4(opacity_);
      }
    `));I.output===g.ShaderOutput.Color&&(O.include(x.Slice,I),O.include(u.EvaluateSceneLighting,I),O.include(m.EvaluateAmbientOcclusion,I),O.include(A.DiscardOrAdjustAlpha,I),I.receiveShadows&&O.include(v.ReadShadowMap,I),I.multipassTerrainEnabled&&(O.fragment.include(h.ReadLinearDepth),O.include(t.multipassTerrainTest,I)),O.fragment.uniforms.add("cameraPosition","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("opacity","float").add("layerOpacity","float"),O.fragment.uniforms.add("view",
"mat4"),I.hasColorTexture&&O.fragment.uniforms.add("tex","sampler2D"),O.include(z.PhysicallyBasedRenderingParameters,I),O.include(q.PhysicallyBasedRendering,I),O.fragment.include(E.MixExternalColor),K.add(C.glsl`
      void main() {
        discardBySlice(vpos);
        ${I.multipassTerrainEnabled?C.glsl`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${I.hasColorTexture?C.glsl`
        vec4 texColor = texture2D(tex, vuv0);
        ${I.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
        discardOrAdjustAlpha(texColor);`:C.glsl`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${I.pbrMode===z.PBRMode.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${I.receiveShadows?"float shadow \x3d readShadowMap(vpos, linearDepth);":I.viewingMode===b.ViewingMode.Global?"float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow \x3d 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${I.attributeColor?C.glsl`
        vec3 albedo_ = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:C.glsl`
        vec3 albedo_ = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));
        `}
        ${C.glsl`
        vec3 shadedNormal = normalize(vNormalWorld);
        albedo_ *= 1.2;
        vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
        float alignmentLightView = clamp(dot(viewForward, -lightingMainDirection), 0.0, 1.0);
        float transmittance = 1.0 - clamp(dot(viewForward, shadedNormal), 0.0, 1.0);
        float treeRadialFalloff = vColor.r;
        float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
        additionalLight += backLightFactor * lightingMainIntensity;`}
        ${I.pbrMode===z.PBRMode.Normal||I.pbrMode===z.PBRMode.Schematic?I.viewingMode===b.ViewingMode.Global?C.glsl`vec3 normalGround = normalize(vpos + localOrigin);`:C.glsl`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:C.glsl``}
        ${I.pbrMode===z.PBRMode.Normal||I.pbrMode===z.PBRMode.Schematic?C.glsl`
            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];
            vec3 shadedColor = evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:"vec3 shadedColor \x3d evaluateSceneLighting(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight);"}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${I.oitEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
      }
    `));O.include(p.DefaultMaterialAuxiliaryPasses,I);return O}const J=Object.freeze({__proto__:null,build:G});a.RealisticTreeShader=J;a.build=G})},"esri/views/3d/layers/graphics/Graphics3DIconSymbolLayer":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../symbols ../../../../core/asyncUtils ../../../../core/Error ../../../../core/has ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/urlUtils ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../support/arcadeOnDemand ../../../../symbols/support/IconSymbol3DLayerResource ../../../../symbols/support/utils ../../../2d/arcade/callExpressionWithFeature ./constants ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ./placementUtils ./pointUtils ./sdfPrimitives ../support/FastSymbolUpdates ../../terrain/OverlayRenderer ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/Texture ../../webgl-engine/materials/HUDMaterial ../../../../symbols/CIMSymbol".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E,C,D,F,G,J,I,O,P,K,M,U,R,L,N,T,S,H,Q){function W(ka){return n.isSome(ka)?"cross"===ka||"x"===ka:!1}const V=r.create(),Y=p.fromValues(0,0,1);g=M.DEFAULT_TEX_SIZE;const aa=M.DEFAULT_SYMBOL_SIZE_RATIO,X=[aa/2,aa/2,1-aa/2,1-aa/2];g=[g*aa,g*aa];J=function(ka){function ia(ca,Z,fa,ja){ca=ka.call(this,ca,Z,fa,ja)||this;ca._cimLayers=null;ca._cimSymbolMaterials=new Map;ca._cimSymbolTextures=new Map;ca._cimMaterialParametersInfo=null;ca._cimRequiredFields=
null;ca._cimScaleFactorOrFunction=null;ca._size=null;ca._symbolTextureRatio=1;ca._outlineSize=0;ca._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0};return ca}c._inheritsLoose(ia,ka);var ea=ia.prototype;ea.getCachedSize=function(){return{size:this._getIconSize()}};ea.doLoad=function(){var ca=c._asyncToGenerator(function*(Z){this._validateOrThrow();const fa=this._prepareMaterialParameters();var ja=this._getPrimitive();if(n.isSome(ja))this._prepareResourcesPrimitive(fa,ja);else{ja=
v.getIconHref(this.symbol,this.symbolLayer);const la=k.dataComponents(ja);la&&"application/json"===la.mediaType?yield this._prepareResourcesCIM(fa,JSON.parse(la.data),Z):yield this._prepareResourcesHref(fa,ja,Z)}});return function(Z){return ca.apply(this,arguments)}}();ea._validateOrThrow=function(){if(!this._drivenProperties.size){var ca=I.validateSymbolLayerSize(this._getIconSize());if(ca)throw new w("graphics3diconsymbollayer:invalid-size",ca);}};ea._getIconSize=function(){var ca=this.symbolLayer;
ca=Math.round(null!=ca.size?e.pt2px(ca.size):16);return this._drivenProperties.size?Math.max(ca,64):ca};ea._generateTextureCIM=function(ca){const Z=this._getGraphicHash(ca);let fa=""===Z?null:this._cimSymbolTextures.get(Z);fa||(ca=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol(this._cimLayers,ca,"esriGeometryPoint",{scaleFactor:this._cimScaleFactorOrFunction},null,null),this._cimMaterialParametersInfo.anchorPos=this._getAnchorPos("relative",ca.anchorPosition),fa=new S.Texture(ca.imageData,
{width:ca.imageData.width,height:ca.imageData.height,powerOfTwoResizeMode:L.PowerOfTwoResizeMode.PAD}),this._cimSymbolTextures.set(Z,fa),this._context.stage.add(fa));return fa};ea._computeSize=function(ca,Z){ca=ca.width/ca.height;return 1<ca?[Z,Math.round(Z/ca)]:[Math.round(Z*ca),Z]};ea._prepareMaterialParameters=function(){const ca={anchorPos:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},Z=this.symbol;if(Z&&"point-3d"===Z.type&&Z.hasVisibleVerticalOffset()){const {screenLength:fa,
minWorldLength:ja,maxWorldLength:la}=Z.verticalOffset;ca.verticalOffset={screenLength:e.pt2px(fa),minWorldLength:ja||0,maxWorldLength:null!=la?la:Infinity}}this._context.screenSizePerspectiveEnabled&&(ca.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);ca.occlusionTest=!0;ca.slicePlaneEnabled=this._context.slicePlaneEnabled;return ca};ea._prepareResourcesPrimitive=function(ca,Z){var fa=this._getOutlineSize();if(W(Z)&&0===fa)throw Error("Nothing to render");this._outlineSize=
fa;ca.color=this._getFillColor();ca.outlineColor=this._getOutlineColor();ca.outlineSize=this._outlineSize;fa=this._context.sharedResources.textures.fromData(Z,()=>M.createTexture(Z));this._texture=fa.texture;this._releaseTexture=fa;ca.textureIsSignedDistanceField=!0;ca.distanceFieldBoundingBox=X;ca.textureId=this._texture.id;fa=this._getIconSize();this._size=[fa,fa];this._symbolTextureRatio=1/aa;this._createMaterialAndAddToStage(ca,this._context.stage)};ea._prepareResourcesHref=function(){var ca=
c._asyncToGenerator(function*(Z,fa,ja){if(!l("esri-canvas-svg-support")&&k.isSVG(fa))throw new w("graphics3diconsymbollayer:unsupported-image-format","IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)");this._outlineSize=this._getOutlineSize();Z.color=this._getFillColor();Z.outlineColor=this._getOutlineColor();Z.outlineSize=this._outlineSize;Z.textureIsSignedDistanceField=!1;const la=this._getIconSize();ja=yield x.result(this._context.sharedResources.textures.fromUrl(fa,la*
this._context.graphicsCoreOwner.view.pixelRatio,{signal:ja}));if(!1===ja.ok)throw f.throwIfAbortError(ja.error),new w("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${fa})`);this._releaseTexture=ja.value;fa=ja.value.texture;this._size=this._computeSize(fa.params,la);Z.textureId=fa.id;this._createMaterialAndAddToStage(Z,this._context.stage)});return function(Z,fa,ja){return ca.apply(this,arguments)}}();ea._prepareResourcesCIM=function(){var ca=c._asyncToGenerator(function*(Z,
fa,ja){fa=new Q({data:fa});if(!this._context.sharedResources.cimSymbolRasterizer){var la=(yield new Promise((ya,za)=>a(["../../../../symbols/cim/CIMSymbolRasterizer"],ya,za))).CIMSymbolRasterizer;f.throwIfAborted(ja);this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new la(this._context.renderCoordsHelper.spatialReference,!0))}la=this._context.layer.fields?this._context.layer.fields.map(ya=>ya.toJSON()):null;this._cimLayers=yield this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(fa,
la,this._context.renderer&&"dictionary"===this._context.renderer.type?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:ja});let ma;if(this._context.renderer&&"dictionary"===this._context.renderer.type&&this._context.renderer.scaleExpression)if(fa=this._context.renderer,isNaN(fa.scaleExpression)){const ya=yield q.createRendererExpression(fa.scaleExpression,this._context.layer.spatialReference,la);ma=(za,pa,wa)=>{za=B(ya,za,{$view:wa},"esriGeometryPoint",pa);return null!==za?za:1}}else var ra=
Number(fa.scaleExpression);this._cimScaleFactorOrFunction=ra||ma||1;ra=this._context.renderer?yield this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];f.throwIfAborted(ja);const va=this._context.layer.fieldsIndex;this._cimRequiredFields=ra.map(ya=>va.get(ya).name);this._cimMaterialParametersInfo=Z;this._cimMaterialParametersInfo.color=this._getFillColor();this._cimMaterialParametersInfo.outlineColor=[0,0,0,0];this._cimMaterialParametersInfo.outlineSize=0;this._cimMaterialParametersInfo.textureIsSignedDistanceField=
!1});return function(Z,fa,ja){return ca.apply(this,arguments)}}();ea._getPrimitive=function(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||z.defaultPrimitive};ea._getOutlineSize=function(){var ca=0;ca=this.symbolLayer;if(n.isSome(ca.outline)&&null!=ca.outline.size)return Math.max(e.pt2px(ca.outline.size),0);ca=this._getPrimitive();ca=W(ca)?1.5:0;return Math.max(ca,0)};ea._getOutlineColor=function(){const ca=this._getLayerOpacity(),
Z=n.get(this.symbolLayer,"outline","color");if(n.isSome(Z)){const fa=d.toUnitRGB(Z);return[fa[0],fa[1],fa[2],Z.a*ca]}return[0,0,0,0]};ea._getFillColor=function(){if(W(this._getPrimitive()))return A.TRANSPARENT_UNIT;const ca=n.isNone(this._getPrimitive()),Z=n.get(this.symbolLayer,"material","color");return this._getCombinedOpacityAndColor(Z,{hasIntrinsicColor:ca})};ea._getAnchorPos=function(ca,Z){return"relative"===ca?y.fromValues((Z.x||0)+.5,-(Z.y||0)+.5):ca in P.namedAnchorToHUDMaterialAnchorPos?
P.namedAnchorToHUDMaterialAnchorPos[ca]:P.namedAnchorToHUDMaterialAnchorPos.center};ea._createMaterialAndAddToStage=function(ca,Z){this._fastUpdates=this._cimLayers?{enabled:!1}:U.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions());this._fastUpdates.enabled&&Object.assign(ca,this._fastUpdates.materialParameters);if(this._cimLayers){let fa=this._cimSymbolMaterials.get(ca.textureId);fa||(fa=new H.HUDMaterial(ca),this._cimSymbolMaterials.set(ca.textureId,fa),Z.add(fa));
return fa}this._material=new H.HUDMaterial(ca);Z.add(this._material);return this._material};ea._setDrapingDependentMaterialParameters=function(){this.draped&&(this._forEachMaterial(ca=>{ca.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,slicePlaneEnabled:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())};ea.destroy=function(){ka.prototype.destroy.call(this);this._forEachMaterial(ca=>this._context.stage.remove(ca));this._material=null;this._cimSymbolMaterials.clear();
this._cimSymbolTextures.forEach(ca=>this._context.stage.remove(ca));this._cimSymbolTextures.clear();this._releaseTexture=n.releaseMaybe(this._releaseTexture)};ea._getScaleFactor=function(ca,Z){if(this._drivenProperties.size&&ca.size){for(let fa=0;3>fa;fa++){const ja=ca.size[fa];ja&&"symbol-value"!==ja&&"proportional"!==ja&&(ca.size[fa]=e.pt2px(ja))}if("symbol-value"===ca.size[0])return 1;if(isFinite(+ca.size[0]))return+ca.size[0]/Z;if(isFinite(+ca.size[2]))return+ca.size[2]/Z}return 1};ea.createGraphics3DGraphic=
function(ca){const Z=ca.graphic;if(!this._validateGeometry(Z.geometry))return null;let fa;if(this._cimLayers){if(!this._cimLayers.length)return null;var ja=this._generateTextureCIM(Z);fa=this._createMaterialAndAddToStage({textureId:ja.id,...this._cimMaterialParametersInfo},this._context.stage);var la=[ja.params.width,ja.params.height]}else la=this._size,fa=n.unwrap(this._material);ja=K.placePointOnGeometry(Z.geometry);if(n.isNone(ja))return this.logger.warn(`unsupported geometry type for icon symbol: ${Z.geometry.type}`),
null;var ma=ca.renderingInfo;const ra=this._getVertexOpacityAndColor(ma);let va=1;this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||(va=this._getScaleFactor(ma,la[0]>la[1]?la[0]:la[1]));va*=this._symbolTextureRatio;la=[la[0]*va,la[1]*va];ma=this.setGraphicElevationContext(Z,new D.ElevationContext);this.ensureDrapedStatus("on-the-ground"===ma.mode)&&this._setDrapingDependentMaterialParameters();return this.draped?this._createAsOverlay(Z,ja,fa,ra,la,ca.layer.uid):this._createAs3DShape(Z,
ja,fa,ra,la,ma,Z.uid)};ea.layerOpacityChanged=function(){const ca=this._getFillColor(),Z=this._getOutlineColor();this._forEachMaterial(fa=>{fa.setParameters({color:ca});fa.setParameters({outlineColor:Z})});return!0};ea.layerElevationInfoChanged=function(ca,Z,fa){const ja=this._elevationContext.mode;fa=C.elevationModeChangeUpdateType(ia.elevationModeChangeTypes,fa,ja);if(fa!==C.SymbolUpdateType.UPDATE)return fa;const la=C.needsElevationUpdates2D(ja)||"absolute-height"===ja;return this.updateGraphics3DGraphicElevationInfo(ca,
Z,()=>la)};ea.slicePlaneEnabledChanged=function(){this.draped||this._forEachMaterial(ca=>{ca.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled})});return!0};ea.physicalBasedRenderingChanged=function(){return!0};ea.pixelRatioChanged=function(){return this._getPrimitive()?!0:!1};ea.applyRendererDiff=function(ca,Z){for(const fa in ca.diff)switch(fa){case "visualVariables":if(U.updateFastSymbolUpdatesState(this._fastUpdates,Z,this._fastVisualVariableConvertOptions()))n.isSome(this._material)&&
this._material.setParameters(this._fastUpdates.materialParameters);else return O.ApplyRendererDiffResult.Recreate_Symbol;break;default:return O.ApplyRendererDiffResult.Recreate_Symbol}return O.ApplyRendererDiffResult.Fast_Update};ea._defaultElevationInfoNoZ=function(){return ba};ea._createAs3DShape=function(ca,Z,fa,ja,la,ma,ra){const va=this.getFastUpdateAttrValues(ca);ca=va?za=>U.evaluateModelTransform(this._fastUpdates.materialParameters,va,za):null;ja=[N.createPointGeometry(Y,null,ja,la,ha,null,
va)];ra=K.createStageObjectForHUD(this._context,Z,ja,[fa],ma,this._context.layer.uid,ra,ca);if(null===ra)return null;const ya=new G.Graphics3DObject3DGraphicLayer(this,ra.object,ja,null,null,E.perObjectElevationAligner,ma);ya.alignedSampledElevation=ra.sampledElevation;ya.needsElevationUpdates=C.needsElevationUpdates2D(ma.mode)||"absolute-height"===ma.mode;ya.getScreenSize=this._createScreenSizeGetter(la,ca);ya.calculateRelativeScreenBounds=za=>fa.calculateRelativeScreenBounds(ya.getScreenSize(),
1,za);K.extendPointGraphicElevationContext(ya,Z,this._context.elevationProvider);return ya};ea._createAsOverlay=function(ca,Z,fa,ja,la,ma){fa.renderPriority=this._renderPriority;const ra=m.create();u.projectPointToVector(Z,ra,this._context.overlaySR);ra[2]=R.DRAPED_Z;Z=this._context.clippingExtent;if(n.isSome(Z)&&!t.containsPoint(Z,ra))return null;const va=this.getFastUpdateAttrValues(ca);Z=va?za=>U.evaluateModelTransform(this._fastUpdates.materialParameters,va,za):null;ja=N.createPointGeometry(Y,
ra,ja,la,null,null,va);ca=new T.RenderGeometry(ja,fa,{layerUid:ma,graphicUid:ca.uid,calculateShaderTransformation:Z});ra[3]=0;h.copy(ca.boundingSphere,ra);const ya=new F(this,[ca],null);ya.getScreenSize=this._createScreenSizeGetter(la,Z);ya.calculateRelativeScreenBounds=za=>fa.calculateRelativeScreenBounds(ya.getScreenSize(),1,za);return ya};ea._createScreenSizeGetter=function(ca,Z){const fa=this._outlineSize+2;if(this._fastUpdates.enabled){const ja=ca[0]/this._symbolTextureRatio,la=ca[1]/this._symbolTextureRatio;
return(ma=y.create())=>{const ra=Z(V);ma[0]=ra[0]*ja+fa;ma[1]=ra[5]*la+fa;return ma}}{const ja=ca[0]/this._symbolTextureRatio+fa,la=ca[1]/this._symbolTextureRatio+fa;return(ma=y.create())=>{ma[0]=ja;ma[1]=la;return ma}}};ea._fastVisualVariableConvertOptions=function(){var ca=this._size[0]>this._size[1]?this._size[0]:this._size[1];const Z=p.fromValues(ca,ca,ca),fa=e.px2pt(1);ca*=fa;ca=p.fromValues(ca,ca,ca);return{modelSize:Z,symbolSize:ca,unitInMeters:fa,transformation:{anchor:p.ZEROS,scale:p.ONES,
rotation:p.ZEROS}}};ea._getGraphicHash=function(ca){let Z="";for(const fa of this._cimRequiredFields)Z+=fa+ca.attributes[fa];return Z};ea._forEachMaterial=function(ca){n.isSome(this._material)&&ca(this._material);this._cimSymbolMaterials.forEach(ca)};c._createClass(ia,[{key:"test",get:function(){return{material:this._material}}}]);return ia}(J.Graphics3DSymbolLayer);J.PRIMITIVE_SIZE=g;J.elevationModeChangeTypes={definedChanged:C.SymbolUpdateType.UPDATE,staysOnTheGround:C.SymbolUpdateType.NONE,onTheGroundChanged:C.SymbolUpdateType.RECREATE};
const ba={mode:"relative-to-ground",offset:0},ha=m.fromValues(0,0,0,1);b.Graphics3DIconSymbolLayer=J;b.default=J;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/2d/arcade/callExpressionWithFeature":function(){define(["../../../core/Error","../../../core/Logger","../../../geometry/support/quantizationUtils"],function(a,b,c){function d(x){const w={};switch(x){case "esriGeometryPoint":return(l,n,f,e)=>c.unquantizePoint(n,w,l,f,e);case "esriGeometryPolygon":return(l,n,f,e)=>c.unquantizePolygon(n,
w,l,f,e);case "esriGeometryPolyline":return(l,n,f,e)=>c.unquantizePolyline(n,w,l,f,e);case "esriGeometryMultipoint":return(l,n,f,e)=>c.unquantizeMultipoint(n,w,l,f,e);default:return b.getLogger("esri.views.2d.support.arcadeOnDemand").error(new a("mapview-arcade",`Unable to handle geometryType: ${x}`)),l=>l}}const g=new Map;return function(x,w,l,n,f){if(x.referencesGeometry()&&f){{const {transform:e,hasZ:k,hasM:r}=f;g.has(n)||g.set(n,d(n));n=g.get(n)(w.geometry,e,k,r);w={...w,geometry:n}}}w=x.repurposeFeature(w);
try{return x.evaluate({...l,$feature:w})}catch(e){return b.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",e),null}}})},"esri/views/3d/layers/graphics/constants":function(){define(["exports","../../../../chunks/vec4f64"],function(a,b){const c=b.ZEROS;b=b.ONES;a.SUSPEND_RESUME_EXTENT_OPTIMISM=1.2;a.TRANSPARENT_UNIT=c;a.WHITE_UNIT=b;a.defaultIconElevationOffset=1;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DDrapedGraphicLayer":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ./graphicUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/ModelDirtyTypes".split(" "),
function(a,b,c,d,g,x,w,l,n){let f=function(){function y(h,m,u){this.graphics3DSymbolLayer=h;this.renderGeometries=m;this.boundingBox=u;this.type="draped";this.stage=null;this._addedToStage=this._visible=!1;this._graphicsCoreOwner=null;this.isElevationSource=!1}var p=y.prototype;p.initialize=function(h,m,u){this.stage=h;this._graphicsCoreOwner=u;this._overlayRenderer=this._graphicsCoreOwner.view.basemapTerrain.overlayManager.renderer};p.setVisibility=function(h){if(null!=this.stage&&this._visible!==
h)if((this._visible=h)&&!this._addedToStage)this._addedToStage=!0,this._overlayRenderer.addGeometries(this.renderGeometries,this._graphicsCoreOwner,n.ModelDirty.Geometry.ADD);else if(h||this._addedToStage){for(const m of this.renderGeometries)m.instanceParameters.visible=this._visible;this._overlayRenderer.updateGeometries(this.renderGeometries,this._graphicsCoreOwner,n.ModelDirty.State.VISIBILITIES)}};p.destroy=function(){this.stage&&this._addedToStage&&this._overlayRenderer.removeGeometries(this.renderGeometries,
this._graphicsCoreOwner,n.ModelDirty.Geometry.REMOVE);this._visible=this._addedToStage=!1;this.stage=null};p.getCenterObjectSpace=function(h=d.create()){return c.set(h,0,0,0)};p.getBoundingBoxObjectSpace=function(h=g.create()){return g.empty(h)};p.addObjectState=function(h,m){h===l.Object3DState.Highlight&&(this.renderGeometries.forEach(u=>{const t=u.addHighlight();m.addRenderGeometry(u,t,this)}),this._addedToStage&&this._overlayRenderer.updateHighlights(this.renderGeometries,this._graphicsCoreOwner))};
p.removeObjectState=function(h){this.renderGeometries.forEach(m=>{h.removeRenderGeometry(m)})};p.removeRenderGeometryObjectState=function(h,m){h.removeHighlight(m);this._addedToStage&&this._overlayRenderer.updateHighlights(this.renderGeometries,this._graphicsCoreOwner)};p.computeAttachmentOrigin=function(h){for(const m of this.renderGeometries)m.computeAttachmentOrigin(r)&&(h.draped.origin[0]+=r[0],h.draped.origin[1]+=r[1],h.draped.num++)};p.getProjectedBoundingBox=function(){var h=a._asyncToGenerator(function*(m,
u,t,q,z){g.empty(z);for(let v=0;v<this.renderGeometries.length;v++)this._getRenderGeometryProjectedBoundingRect(this.renderGeometries[v],m,e,t),g.expandWithRect(z,e);if(u){g.center(z,r);let v;m=w.demResolutionForBoundingBox(z,u);try{v=yield u.service.queryElevation(r[0],r[1],q,m,"ground")}catch(B){}b.isSome(v)&&(z[2]=Math.min(z[2],v),z[5]=Math.max(z[5],v))}return z});return function(m,u,t,q,z){return h.apply(this,arguments)}}();p._getRenderGeometryProjectedBoundingRect=function(h,m,u,t){if(this.boundingBox)g.set(k,
this.boundingBox);else{h=h.boundingSphere;const q=h[3];k[0]=h[0]-q;k[1]=h[1]-q;k[2]=h[2]-q;k[3]=h[0]+q;k[4]=h[1]+q;k[5]=h[2]+q}m(k,0,2);this.calculateRelativeScreenBounds&&t.push({location:g.center(k),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()});return g.toRect(k,u)};return y}();const e=x.create(),k=g.create(),r=d.create();return f})},"esri/views/3d/layers/graphics/placementUtils":function(){define(["exports","../../../../chunks/vec2f64","../../webgl-engine/lib/TextRenderer"],function(a,
b,c){b={"bottom-left":b.fromValues(0,0),bottom:b.fromValues(.5,0),"bottom-right":b.fromValues(1,0),left:b.fromValues(0,.5),center:b.fromValues(.5,.5),right:b.fromValues(1,.5),"top-left":b.fromValues(0,1),top:b.fromValues(.5,1),"top-right":b.fromValues(1,1)};a.anchorFromPlacements=function(d,g){switch(g){case "bottom":return"left"===d?"bottom-left":"right"===d?"bottom-right":"bottom";case "center":return d;case "top":return"left"===d?"top-left":"right"===d?"top-right":"top"}};a.horizontalPlacementFromAlignment=
function(d){return"justify"===d?"center":d};a.horizontalPlacementFromAnchor=function(d){switch(d){case "bottom-left":case "left":case "top-left":return"left";case "bottom":case "center":case "top":return"center";case "bottom-right":case "right":case "top-right":return"right"}};a.horizontalPlacementToAnchorX={left:0,center:.5,right:1};a.namedAnchorToHUDMaterialAnchorPos=b;a.textRenderAlignmentFromHorizontalPlacement=function(d){switch(d){case "left":return c.TextRenderAlignment.Left;case "right":return c.TextRenderAlignment.Right;
default:return c.TextRenderAlignment.Center}};a.verticalPlacementFromAlignment=function(d){return"middle"===d?"center":d};a.verticalPlacementFromAnchor=function(d){switch(d){case "bottom-left":case "bottom":case "bottom-right":return"bottom";case "left":case "center":case "right":return"center";case "top-left":case "top":case "top-right":return"top"}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextRenderer":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers",
"../../../../core/mathUtils","../../../../core/maybe","../../support/debugFlags"],function(a,b,c,d,g){function x(e,k,r){e.canvas||(e.canvas=document.createElement("canvas"));e.canvas.width=k;e.canvas.height=r;return e.canvas}let w=function(){function e(r,y,p,h=2048){this.text=r;this._alignment=y;this._parameters=p;this.maxSize=h;this._textWidths=[];this._lineWidths=[];this._heightMetrics=this._displayWidth=this._renderPixelRatio=null;this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${r}`;
this._lines=r.split(/\r?\n/)}var k=e.prototype;k._getLineXOffset=function(r){switch(this._alignment){case a.TextRenderAlignment.Left:return this.backgroundHorizontalPadding;case a.TextRenderAlignment.Center:return(this.displayWidth-this._lineWidths[r])/2;case a.TextRenderAlignment.Right:return this.displayWidth-this.backgroundHorizontalPadding-this._lineWidths[r]}};k.render=function(r,y=0,p=0){r.save();y/=this.renderPixelRatio;p/=this.renderPixelRatio;const h=y,m=p;var u=this.haloSize,t=this.firstLineYOffset;
y+=u;p+=t+this.baselinePosition;const q=0<this.haloSize;q&&this._renderHalo(r,h,m,u,t);this._setFontProperties(r,this.renderedFontSize);for(u=0;u<this._lines.length;++u){const z=this._lines[u],v=this._getLineXOffset(u);q&&(r.globalCompositeOperation="destination-out",r.fillStyle="rgb(0, 0, 0)",this._fillText(r,z,y+v,p),this._renderLineDecoration(r,y+v,p,this._textWidths[u]));r.globalCompositeOperation="source-over";r.fillStyle=this._parameters.textStyle;this._fillText(r,z,y+this._getLineXOffset(u),
p);this._renderLineDecoration(r,y+v,p,this._textWidths[u]);p+=this.lineSpacing}if(g.TEXT_SHOW_BASELINE)for(r.strokeStyle="rgb(255, 0, 255, 0.5)",r.setLineDash([2,2]),r.lineWidth=1,y=m+t,p=0;p<this._lines.length;++p)t=y+this.baselinePosition,this._drawLine(r,[h,t],[h+this.displayWidth,t]),y+=this.lineSpacing;g.TEXT_SHOW_BORDER&&(r.strokeStyle="rgb(255, 0, 255, 0.5)",r.setLineDash([]),r.lineWidth=1,this._drawBox(r,[h,m],[this.displayWidth,this.displayHeight]));this.hasBackground&&(this._roundedRect(r,
h,m,this._parameters.definition.background.borderRadius*this.renderPixelRatio),r.globalCompositeOperation="destination-over",r.fillStyle=this._parameters.backgroundStyle,r.fill());r.restore()};k._renderLineDecoration=function(r,y,p,h,m=!1){if("none"!==this._parameters.definition.font.decoration&&0!==h){var u=Math.max(this._parameters.definition.size/16,1);switch(this._parameters.definition.font.decoration){case "underline":p+=2*u;break;case "line-through":p-=.33*this.baselinePosition}var t=m?this.haloSize:
0;r.strokeStyle=m?this._parameters.haloStyle:this._parameters.textStyle;r.lineWidth=this._toRenderUnit(u+2*t);r.beginPath();r.moveTo(this._toRenderUnit(y-t),this._toRenderUnit(p));r.lineTo(this._toRenderUnit(y+h+t),this._toRenderUnit(p));r.stroke()}};k._roundedRect=function(r,y,p,h){y=this._toRenderUnit(y);p=this._toRenderUnit(p);const m=this.renderedWidth,u=this.renderedHeight;0===h?r.rect(y,p,m,u):(h=c.clamp(h,0,Math.floor(u/2)),r.beginPath(),r.moveTo(y,p+h),r.arcTo(y,p,y+h,p,h),r.lineTo(y+m-h,
p),r.arcTo(y+m,p,y+m,p+h,h),r.lineTo(y+m,p+u-h),r.arcTo(y+m,p+u,y+m-h,p+u,h),r.lineTo(y+h,p+u),r.arcTo(y,p+u,y,p+u-h,h),r.closePath())};k._renderHalo=function(r,y,p,h,m){const u=this.renderedWidth,t=this.renderedHeight,q=x(n,Math.max(u,512),Math.max(t,512)),z=q.getContext("2d");z.clearRect(0,0,u,t);this._setFontProperties(z,this.renderedFontSize);z.fillStyle=this._parameters.haloStyle;z.strokeStyle=this._parameters.haloStyle;var v=3>this.renderedHaloSize;z.lineJoin=v?"miter":"round";v?this._renderHaloEmulated(z,
h,m):this._renderHaloNative(z,h,m);m+=this.baselinePosition;for(v=0;v<this._lines.length;++v){const B=this._getLineXOffset(v);this._renderLineDecoration(z,h+B,m,this._textWidths[v],!0);m+=this.lineSpacing}r.globalAlpha=this._parameters.definition.halo.color[3];r.drawImage(q,0,0,u,t,this._toRenderUnit(y),this._toRenderUnit(p),u,t);r.globalAlpha=1};k._renderHaloEmulated=function(r,y,p){p+=this.baselinePosition;for(let h=0;h<this._lines.length;++h){const m=this._lines[h],u=this._getLineXOffset(h);for(const [t,
q]of l)this._fillText(r,m,y+u+this.haloSize*t,p+this.haloSize*q);p+=this.lineSpacing}};k._renderHaloNative=function(r,y,p){const h=2*this.haloSize;p+=this.baselinePosition;for(let m=0;m<this._lines.length;++m){const u=this._lines[m],t=this._getLineXOffset(m);for(let q=0;5>q;q++)r.lineWidth=this._toRenderUnit((.6+.1*q)*h),this._strokeText(r,u,y+t,p);p+=this.lineSpacing}};k._setFontProperties=function(r,y){r.font=this._parameters.fontString(y);r.textAlign="left";r.textBaseline="alphabetic"};k._ensureTextWidth=
function(){if(d.isSome(this._displayWidth))return this._displayWidth;const r=x(n,512,512).getContext("2d");this._setFontProperties(r,this.fontSize);let y=2*this.haloSize;var p=this._parameters.definition.font;if("italic"===p.style||"oblique"===p.style||"bold"===p.weight||"bolder"===p.weight)y+=.3*r.measureText("A").width;this._textWidths.length=0;p=this._lineWidths.length=0;for(const h of this._lines){const m=r.measureText(h).width,u=m+y;this._textWidths.push(m);this._lineWidths.push(u);p=Math.max(p,
u)}return this._displayWidth=p};k._ensureHeightMetrics=function(){if(d.isNone(this._heightMetrics)){var r=x(n,512,512).getContext("2d");this._setFontProperties(r,this.fontSize);const y=r.measureText(this.text+f),p=this.hasBackground?r.measureText(this._lines[0]):y;r=1===this._lines.length?p:this.hasBackground?r.measureText(this._lines[this._lines.length-1]):y;this._heightMetrics={paddingTop:y.actualBoundingBoxAscent-p.actualBoundingBoxAscent,paddingBottom:y.actualBoundingBoxDescent-r.actualBoundingBoxDescent,
lineHeight:y.actualBoundingBoxAscent+y.actualBoundingBoxDescent,baselinePosition:y.actualBoundingBoxAscent}}return this._heightMetrics};k._toRenderUnit=function(r){return r*this.renderPixelRatio};k._toRoundedRenderUnit=function(r){return Math.round(r*this.renderPixelRatio)};k._fillText=function(r,y,p,h){r.fillText(y,this._toRenderUnit(p),this._toRenderUnit(h))};k._strokeText=function(r,y,p,h){r.strokeText(y,this._toRenderUnit(p),this._toRenderUnit(h))};k._drawLine=function(r,y,p){r.beginPath();r.moveTo(this._toRoundedRenderUnit(y[0])+
.5,this._toRoundedRenderUnit(y[1])+.5);r.lineTo(this._toRoundedRenderUnit(p[0])+.5,this._toRoundedRenderUnit(p[1])+.5);r.stroke()};k._drawBox=function(r,y,p){var h=this._toRenderUnit(y[0]);y=this._toRenderUnit(y[1]);var m=this._toRenderUnit(p[0]);const u=this._toRenderUnit(p[1]);p=Math.floor(h)+.5;h=Math.ceil(h+m)-.5;m=Math.floor(y)+.5;y=Math.ceil(y+u)-.5;r.beginPath();r.moveTo(p,m);r.lineTo(h,m);r.lineTo(h,y);r.lineTo(p,y);r.lineTo(p,m);r.stroke()};b._createClass(e,[{key:"displayWidth",get:function(){return Math.ceil(this._ensureTextWidth()+
2*this.backgroundHorizontalPadding)}},{key:"displayHeight",get:function(){return Math.ceil(this.lineSpacing*(this._lines.length-1)+this.lineHeight+2*this.haloSize+this.backgroundTopPadding+this.backgroundBottomPadding)}},{key:"renderedWidth",get:function(){return Math.ceil(this._toRenderUnit(this.displayWidth))}},{key:"renderedHeight",get:function(){return Math.ceil(this._toRenderUnit(this.displayHeight))}},{key:"firstRenderedBaselinePosition",get:function(){return this._toRenderUnit(this.firstLineYOffset+
this.baselinePosition)}},{key:"firstLineYOffset",get:function(){return this.backgroundTopPadding+this.haloSize}},{key:"heightMetrics",get:function(){return this._ensureHeightMetrics()}},{key:"lineSpacing",get:function(){return(this.lineHeight+this.linePadding)*this._parameters.definition.lineSpacingFactor}},{key:"lineHeight",get:function(){return this.heightMetrics.lineHeight}},{key:"linePadding",get:function(){return.2*this.lineHeight}},{key:"baselinePosition",get:function(){return this.heightMetrics.baselinePosition}},
{key:"renderedFontSize",get:function(){return this._toRenderUnit(this.fontSize)}},{key:"fontSize",get:function(){return this._parameters.definition.size}},{key:"renderedHaloSize",get:function(){return this._toRenderUnit(this.haloSize)}},{key:"haloSize",get:function(){return this._parameters.haloSize}},{key:"backgroundHorizontalPadding",get:function(){return this.hasBackground?this._parameters.definition.background.padding[0]:0}},{key:"backgroundVerticalPadding",get:function(){return this.hasBackground?
this._parameters.definition.background.padding[1]:0}},{key:"backgroundTopPadding",get:function(){return Math.max(0,this.backgroundVerticalPadding-this.heightMetrics.paddingTop)}},{key:"backgroundBottomPadding",get:function(){return Math.max(0,this.backgroundVerticalPadding-this.heightMetrics.paddingBottom)}},{key:"hasBackground",get:function(){return!!this._parameters.backgroundStyle}},{key:"renderPixelRatio",get:function(){if(d.isNone(this._renderPixelRatio)){const r=this._parameters.definition.pixelRatio;
this._renderPixelRatio=0<this.maxSize?Math.min(r,Math.min(this.maxSize/this.displayWidth,this.maxSize/this.displayHeight)):r}return this._renderPixelRatio}}]);return e}();const l=[];for(let e=0;360>e;e+=22.5)l.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)]);a.TextRenderAlignment=void 0;(function(e){e[e.Left=0]="Left";e[e.Center=1]="Center";e[e.Right=2]="Right"})(a.TextRenderAlignment||(a.TextRenderAlignment={}));const n={canvas:null},f=(()=>{let e="";for(let k=32;127>k;k++)e+=String.fromCharCode(k);
return e})();a.TextRenderer=w;a.default=w;a.getTextHelperCanvas=x;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/FastSymbolUpdates":function(){define("exports ../../../../core/has ../../../../core/mathUtils ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../renderers/support/lengthUtils ../../support/debugFlags".split(" "),function(a,b,c,d,g,x,w,l,n,
f,e){function k(I){return null!==I&&void 0!==I}function r(I){return"number"===typeof I}function y(I){return"string"===typeof I}function p(I,O){I&&I.push(O)}function h(I,O,P,K=w.create()){I=I||0;O=O||0;P=P||0;0!==I&&x.rotateZ(K,K,-I/180*Math.PI);0!==O&&x.rotateX(K,K,O/180*Math.PI);0!==P&&x.rotateY(K,K,P/180*Math.PI);return K}function m(I,O,P,K,M){const U=I.minSize,R=I.maxSize;if(I.expression)return p(M,"Could not convert size info: expression not supported"),!1;if(I.useSymbolValue)return I=K.symbolSize[P],
O.minSize[P]=I,O.maxSize[P]=I,O.offset[P]=O.minSize[P],O.factor[P]=0,O.type[P]=a.FastSizeType.DefinedSize,!0;if(k(I.field)){if(k(I.stops)){if(2===I.stops.length&&r(I.stops[0].size)&&r(I.stops[1].size))return u(I.stops[0].size,I.stops[1].size,I.stops[0].value,I.stops[1].value,O,P),O.type[P]=a.FastSizeType.DefinedSize,!0;p(M,"Could not convert size info: stops only supported with 2 elements");return!1}if(r(U)&&r(R)&&k(I.minDataValue)&&k(I.maxDataValue))return u(U,R,I.minDataValue,I.maxDataValue,O,P),
O.type[P]=a.FastSizeType.DefinedSize,!0;if(null!=f.meterIn[I.valueUnit])return O.minSize[P]=-Infinity,O.maxSize[P]=Infinity,O.offset[P]=0,O.factor[P]=1/f.meterIn[I.valueUnit],O.type[P]=a.FastSizeType.DefinedSize,!0;if("unknown"===I.valueUnit)return p(M,"Could not convert size info: proportional size not supported"),!1;p(M,"Could not convert size info: scale-dependent size not supported");return!1}if(!k(I.field)){if(I.stops&&I.stops[0]&&r(I.stops[0].size))return O.minSize[P]=I.stops[0].size,O.maxSize[P]=
I.stops[0].size,O.offset[P]=O.minSize[P],O.factor[P]=0,O.type[P]=a.FastSizeType.DefinedSize,!0;if(r(U))return O.minSize[P]=U,O.maxSize[P]=U,O.offset[P]=U,O.factor[P]=0,O.type[P]=a.FastSizeType.DefinedSize,!0}p(M,"Could not convert size info: unsupported variant of sizeInfo");return!1}function u(I,O,P,K,M,U){K=0<Math.abs(K-P)?(O-I)/(K-P):0;M.minSize[U]=0<K?I:O;M.maxSize[U]=0<K?O:I;M.offset[U]=I-P*K;M.factor[U]=K}function t(I,O,P,K){if(I.normalizationField||I.valueRepresentation)return p(K,"Could not convert size info: unsupported property"),
null;var M=I.field;if(null!=M&&!y(M))return p(K,"Could not convert size info: field is not a string"),null;if(!O.size)O.size={field:I.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[a.FastSizeType.Undefined,a.FastSizeType.Undefined,a.FastSizeType.Undefined]};else if(I.field)if(!O.size.field)O.size.field=I.field;else if(I.field!==O.size.field)return p(K,"Could not convert size info: multiple fields in use"),null;switch(I.axis){case "width":return(M=m(I,O.size,0,P,K))?O:null;
case "height":return(M=m(I,O.size,2,P,K))?O:null;case "depth":return(M=m(I,O.size,1,P,K))?O:null;case "width-and-depth":return(M=m(I,O.size,0,P,K))&&m(I,O.size,1,P,K),M?O:null;case null:case void 0:case "all":return(M=(M=(M=m(I,O.size,0,P,K))&&m(I,O.size,1,P,K))&&m(I,O.size,2,P,K))?O:null;default:return p(K,`Could not convert size info: unknown axis "${I.axis}""`),null}}function q(I,O,P){for(let K=0;3>K;++K){let M=O.unitInMeters;I.type[K]===a.FastSizeType.DefinedSize&&(M*=O.modelSize[K],I.type[K]=
a.FastSizeType.DefinedScale);I.minSize[K]/=M;I.maxSize[K]/=M;I.offset[K]/=M;I.factor[K]/=M}if(I.type[0]!==a.FastSizeType.Undefined)O=0;else if(I.type[1]!==a.FastSizeType.Undefined)O=1;else if(I.type[2]!==a.FastSizeType.Undefined)O=2;else return p(P,"No size axis contains a valid size or scale"),!1;for(P=0;3>P;++P)I.type[P]===a.FastSizeType.Undefined&&(I.minSize[P]=I.minSize[O],I.maxSize[P]=I.maxSize[O],I.offset[P]=I.offset[O],I.factor[P]=I.factor[O],I.type[P]=I.type[O]);return!0}function z(I,O,P){I[4*
O]=P.r/255;I[4*O+1]=P.g/255;I[4*O+2]=P.b/255;I[4*O+3]=P.a}function v(I,O,P){if(I.normalizationField)return p(P,"Could not convert color info: unsupported property"),null;if(y(I.field))if(I.stops){if(8<I.stops.length)return p(P,"Could not convert color info: too many color stops"),null;O.color={field:I.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};I=I.stops;for(P=0;8>P;++P){const K=I[Math.min(P,I.length-1)];O.color.values[P]=K.value;z(O.color.colors,
P,K.color)}}else return p(P,"Could not convert color info: missing stops or colors"),null;else if(I.stops&&0<=I.stops.length)for(I=I.stops&&0<=I.stops.length&&I.stops[0].color,O.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},P=0;8>P;P++)O.color.values[P]=Infinity,z(O.color.colors,P,I);else return p(P,"Could not convert color info: no field and no colors/stops"),null;return O}function B(I,O,P){if(I.normalizationField)return p(P,
"Could not convert opacity info: unsupported property"),null;if(y(I.field))if(I.stops){if(8<I.stops.length)return p(P,"Could not convert opacity info: too many opacity stops"),null;O.opacity={field:I.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};I=I.stops;for(P=0;8>P;++P){const K=I[Math.min(P,I.length-1)];O.opacity.values[P]=K.value;O.opacity.opacityValues[P]=K.opacity}}else return p(P,"Could not convert opacity info: missing stops or opacities"),null;else if(I.stops&&0<=I.stops.length)for(I=
I.stops&&0<=I.stops.length&&I.stops[0].opacity,O.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]},P=0;8>P;P++)O.opacity.values[P]=Infinity,O.opacity.opacityValues[P]=I;else return p(P,"Could not convert opacity info: no field and no opacities/stops"),null;return O}function A(I,O,P){I=2===P&&"arithmetic"===I.rotationType;O.offset[P]=I?90:0;O.factor[P]=I?-1:1;O.type[P]=1}function E(I,O,P){if(!y(I.field))return p(P,"Could not convert rotation info: field is not a string"),
null;if(!O.rotation)O.rotation={field:I.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};else if(I.field)if(!O.rotation.field)O.rotation.field=I.field;else if(I.field!==O.rotation.field)return p(P,"Could not convert rotation info: multiple fields in use"),null;switch(I.axis){case "tilt":return A(I,O.rotation,0),O;case "roll":return A(I,O.rotation,1),O;case null:case void 0:case "heading":return A(I,O.rotation,2),O;default:return p(P,`Could not convert rotation info: unknown axis "${I.axis}""`),null}}
function C(I,O,P){if(!I)return null;const K=!O.supportedTypes||!!O.supportedTypes.size,M=!O.supportedTypes||!!O.supportedTypes.color,U=!O.supportedTypes||!!O.supportedTypes.rotation,R=!!O.supportedTypes&&!!O.supportedTypes.opacity,L=I.reduce((N,T)=>{if(!N)return N;if(T.valueExpression)return p(P,"Could not convert visual variables: arcade expressions not supported"),null;switch(T.type){case "size":return K?t(T,N,O,P):N;case "color":return M?v(T,N,P):N;case "opacity":return R?B(T,N,P):null;case "rotation":return U?
E(T,N,P):N;default:return null}},{size:null,color:null,opacity:null,rotation:null});return 0<I.length&&L&&!L.size&&!L.color&&!L.opacity&&!L.rotation||L&&L.size&&!q(L.size,O,P)?null:L}function D(I,O,P){if(!!I!==!!O||I&&I.field!==O.field)return!1;if(I&&"rotation"===P)for(P=0;3>P;P++)if(I.type[P]!==O.type[P]||I.offset[P]!==O.offset[P]||I.factor[P]!==O.factor[P])return!1;return!0}function F(I,O){const P={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,
vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},K=I&&null!=I.size;I&&I.size?(P.vvSizeEnabled=!0,P.vvSizeMinSize=I.size.minSize,P.vvSizeMaxSize=I.size.maxSize,P.vvSizeOffset=I.size.offset,P.vvSizeFactor=I.size.factor):I&&K&&(P.vvSizeValue=O.transformation.scale);I&&K&&(P.vvSymbolAnchor=O.transformation.anchor,P.vvSymbolRotationMatrix=g.create(),x.identity(J),h(O.transformation.rotation[2],
O.transformation.rotation[0],O.transformation.rotation[1],J),d.fromMat4(P.vvSymbolRotationMatrix,J));I&&I.color&&(P.vvColorEnabled=!0,P.vvColorValues=I.color.values,P.vvColorColors=I.color.colors);I&&I.opacity&&(P.vvOpacityEnabled=!0,P.vvOpacityValues=I.opacity.values,P.vvOpacityOpacities=I.opacity.opacityValues);return P}a.FastSizeType=void 0;(function(I){I[I.Undefined=0]="Undefined";I[I.DefinedSize=1]="DefinedSize";I[I.DefinedScale=2]="DefinedScale"})(a.FastSizeType||(a.FastSizeType={}));a.FastRotationType=
void 0;(function(I){I[I.Undefined=0]="Undefined";I[I.DefinedAngle=1]="DefinedAngle"})(a.FastRotationType||(a.FastRotationType={}));var G;(function(I){const O=w.create(),P=n.create();I.evaluateModelTransform=function(K,M,U){if(!K.vvSizeEnabled)return U;x.copy(O,U);U=K.vvSymbolRotationMatrix;x.set(J,U[0],U[1],U[2],0,U[3],U[4],U[5],0,U[6],U[7],U[8],0,0,0,0,1);x.multiply(O,O,J);for(U=0;3>U;++U)P[U]=c.clamp(K.vvSizeOffset[U]+M[0]*K.vvSizeFactor[U],K.vvSizeMinSize[U],K.vvSizeMaxSize[U]);x.scale(O,O,P);
x.translate(O,O,K.vvSymbolAnchor);return O};I.evaluateModelTransformScale=function(K,M,U){if(!M.vvSizeEnabled)return l.set(K,1,1,1);for(let R=0;3>R;++R)K[R]=c.clamp(M.vvSizeOffset[R]+U[0]*M.vvSizeFactor[R],M.vvSizeMinSize[R],M.vvSizeMaxSize[R]);return K}})(G||(G={}));const J=w.create();b=G.evaluateModelTransform;G=G.evaluateModelTransformScale;a.convertVisualVariables=C;a.evaluateModelTransform=b;a.evaluateModelTransformScale=G;a.getMaterialParams=F;a.initFastSymbolUpdatesState=function(I,O){return!I||
e.TESTS_DISABLE_FAST_UPDATES?{enabled:!1}:(I=C(I.visualVariables,O))?{enabled:!0,visualVariables:I,materialParameters:F(I,O),requiresShaderTransformation:I&&null!=I.size}:{enabled:!1}};a.updateFastSymbolUpdatesState=function(I,O,P){if(!O||!I.enabled)return!1;const K=I.visualVariables;O=C(O.visualVariables,P);if(!(O&&D(K.size,O.size,"size")&&D(K.color,O.color,"color")&&D(K.rotation,O.rotation,"rotation")&&D(K.opacity,O.opacity,"opacity")))return!1;I.visualVariables=O;I.materialParameters=F(O,P);I.requiresShaderTransformation=
O&&null!=O.size;return!0};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/RenderGeometry":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/uid ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec4f64 ../../support/mathUtils ./basicInterfaces ./geometryDataUtils ./InstanceParameters ./Object3DStateID ./VertexAttribute ../materials/renderers/utils".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p){let h=function(){function u(q,z,v={}){this.data=q;this.material=z;this.boundingSphere=l.create();this.instanceParameters=new k.InstanceParameters;this._transformation=x.create();this._shaderTransformationDirty=!0;this.layerUid=c.unwrapOr(v.layerUid,null);this.graphicUid=c.unwrapOr(v.graphicUid,null);this.id=v.id?v.id:d.generateUID();this.boundingInfo=c.unwrapOr(v.boundingInfo,null);this.calculateShaderTransformation=c.unwrapOr(this.calculateShaderTransformation,
null);this.castShadow=v.castShadow?v.castShadow:!1}var t=u.prototype;t.updateTransformation=function(q){q(this._transformation);this._shaderTransformationDirty=!0;this.computeBoundingSphere(this._transformation,this.boundingSphere)};t.shaderTransformationChanged=function(){this._shaderTransformationDirty=!0};t.computeBoundingSphere=function(q,z,v=n.maxScale(q)){c.isNone(this.boundingInfo)||(w.transformMat4(z,this.boundingInfo.getCenter(),q),z[3]=this.boundingInfo.getBSRadius()*v)};t.getShaderTransformation=
function(){if(c.isNone(this.calculateShaderTransformation))return c.unwrapOr(this.transformation,x.IDENTITY);this._shaderTransformationDirty&&(this._shaderTransformation||(this._shaderTransformation=x.create()),g.copy(this._shaderTransformation,this.calculateShaderTransformation(c.unwrapOr(this.transformation,x.IDENTITY))),this._shaderTransformationDirty=!1);return this._shaderTransformation};t.computeAttachmentOrigin=function(q){if(this.material.computeAttachmentOrigin)return this.material.computeAttachmentOrigin(this,
q)?(c.isSome(this._transformation)&&w.transformMat4(q,q,this._transformation),!0):!1;const z=this.indices.get(y.VertexAttribute.POSITION),v=this.vertexAttributes.get(y.VertexAttribute.POSITION);return e.computeAttachmentOriginTriangles(v,z,q)?(c.isSome(this._transformation)&&w.transformMat4(q,q,this._transformation),!0):!1};t.addHighlight=function(){const q=new r.Object3DStateID(f.Object3DState.Highlight),z=this.instanceParameters;z.highlights=p.addObject3DStateID(z.highlights,q);return q};t.removeHighlight=
function(q){const z=this.instanceParameters;z.highlights=p.removeObject3DStateID(z.highlights,q)};b._createClass(u,[{key:"transformation",get:function(){return this._transformation}},{key:"hasShaderTransformation",get:function(){return c.isSome(this.calculateShaderTransformation)}},{key:"primitiveType",get:function(){return this.data.primitiveType}},{key:"indices",get:function(){return this.data.indices}},{key:"vertexAttributes",get:function(){return this.data.vertexAttributes}}]);return u}(),m=function(u){function t(){return u.apply(this,
arguments)||this}b._inheritsLoose(t,u);return t}(h);a.RenderGeometry=h;a.ValidatedRenderGeometry=m;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/InstanceParameters":function(){define(["exports"],function(a){a.InstanceParameters=function(){this.visible=!0};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DLineSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry ../../../../core/Error ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/mat4f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/support/aaBoundingBox ../../../../renderers/support/renderingInfoUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./interfaces ./lineUtils ../support/FastSymbolUpdates ../support/markerUtils ../../support/debugFlags ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/LineMarkerMaterial ../../webgl-engine/materials/lineStippleUtils ../../webgl-engine/materials/RibbonLineMaterial ../../../../geometry/Extent ../../../../geometry/Polygon".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E,C,D,F,G){const J=["polyline","polygon","extent"];c=function(O){function P(M,U,R,L){M=O.call(this,M,U,R,L)||this;M._uniformSize=1;return M}b._inheritsLoose(P,O);var K=P.prototype;K.doLoad=function(){var M=b._asyncToGenerator(function*(){this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:1,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}};this._fastUpdates=
this._context.renderer&&this._context.renderer.visualVariables&&0<this._context.renderer.visualVariables.length?q.initFastSymbolUpdatesState(this._context.renderer,this._vvConvertOptions):{enabled:!1};if(!this._drivenProperties.size){const U=null!=this.symbolLayer.size?this.symbolLayer.size:x.px2pt(1);if(0>U)throw new d("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");this._uniformSize=U}this._markerTexture=z.prepareMarkerResources(this._context.sharedResources.textures,
this.symbolLayer.marker)});return function(){return M.apply(this,arguments)}}();K._getMaterialParameters=function(M,U=!1){var R,L=g.applySome(this.symbolLayer.marker,T=>T.color);const N=g.applySome(this.symbolLayer.material,T=>T.color);L=this._getCombinedOpacityAndColor(U&&L||N);this._patternHidesLine&&!U&&(L[3]=0);U=L[3];M={width:this._computeMaterialWidth(null==(R=this.symbolLayer)?void 0:R.size),color:L,polygonOffset:!0,join:this.symbolLayer.join||"miter",cap:t.parseCapType(this.symbolLayer.cap||
"butt"),transparent:1>U||this.needsDrivenTransparentPass,slicePlaneEnabled:this._context.slicePlaneEnabled,isClosed:M,stipplePattern:C.getStipplePatternForLinePattern(this.symbolLayer.pattern),stippleScaleWithLineWidth:!0};return this._fastUpdates&&this._fastUpdates.visualVariables?{...M,...this._fastUpdates.materialParameters}:M};K.destroy=function(){O.prototype.destroy.call(this);this._forEachMaterial(M=>this._context.stage.remove(M));this._markerMaterial=this._wireframeRingMaterial=this._wireframeLineMaterial=
this._ringMaterial=this._lineMaterial=null;this._markerTexture=g.releaseMaybe(this._markerTexture)};K._getDrivenSize=function(M){return this._drivenProperties.size&&M.size?x.pt2px(e.getDriverAxisSizeValueAny(M.size)):1};K._getSizeFeatureAttributeData=function(M){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?m.getAttributeValue(this._fastUpdates.visualVariables.size.field,M):null};K._getDrivenColor=function(M){const U=n.fromValues(1,1,1,1);this._drivenProperties.color&&M.color&&
(U[0]=M.color[0],U[1]=M.color[1],U[2]=M.color[2],0<M.color.length&&(U[3]=M.color[3]));this._drivenProperties.opacity&&M.opacity&&(U[3]=M.opacity);return U};K._getColorFeatureAttributeData=function(M){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color?m.getAttributeValue(this._fastUpdates.visualVariables.color.field,M):null};K._getOpacityFeatureAttributeData=function(M){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.opacity?m.getAttributeValue(this._fastUpdates.visualVariables.opacity.field,
M):null};K.createGraphics3DGraphic=function(M){const U=M.graphic;if(!this._validateGeometry(U.geometry,J,this.symbolLayer.type))return null;const R=this.setGraphicElevationContext(U,new y.ElevationContext);this.ensureDrapedStatus("on-the-ground"===R.mode);return this.draped?this._createAsOverlay(M,this._context.layer.uid):this._createAs3DShape(M,R,U.uid)};K.applyRendererDiff=function(M,U){for(const R in M.diff)switch(R){case "visualVariables":if(q.updateFastSymbolUpdatesState(this._fastUpdates,U,
this._vvConvertOptions))this._forEachMaterial(L=>L.setParameters(this._fastUpdates.materialParameters));else return u.ApplyRendererDiffResult.Recreate_Symbol;break;default:return u.ApplyRendererDiffResult.Recreate_Symbol}return u.ApplyRendererDiffResult.Fast_Update};K.prepareSymbolLayerPatch=function(M){var U,R;if("partial"===M.diff.type){var L=M.diff.diff,N={};"complete"===(null==(U=L.size)?void 0:U.type)&&(N.width=this._computeMaterialWidth(L.size.newValue),delete L.size);"complete"===(null==(R=
L.cap)?void 0:R.type)&&(N.cap=t.parseCapType(g.unwrapOr(L.cap.newValue,"butt")),delete L.cap);U=this._prepareMarkerPatch(M,L);this._prepareMaterialPatch(M,L,U);M.symbolLayerStatePatches.push(()=>this._forEachMaterial(T=>T.setParameters(N)))}};K.layerOpacityChanged=function(){this._forEachMaterial((M,U)=>this._updateMaterialLayerOpacity(M,U));return!0};K._forEachMaterial=function(M){g.isSome(this._lineMaterial)&&M(this._lineMaterial);g.isSome(this._ringMaterial)&&M(this._ringMaterial);g.isSome(this._wireframeLineMaterial)&&
M(this._wireframeLineMaterial);g.isSome(this._wireframeRingMaterial)&&M(this._wireframeRingMaterial);g.isSome(this._markerMaterial)&&M(this._markerMaterial,!0)};K._updateMaterialLayerOpacity=function(M,U=!1){const R=M.parameters.color,L=g.get(this.symbolLayer,"material","color");U=this._patternHidesLine&&!U?0:this._getCombinedOpacity(L);M.setParameters({color:[R[0],R[1],R[2],U],transparent:1>U||this.needsDrivenTransparentPass})};K.layerElevationInfoChanged=function(M,U,R){const L=this._elevationContext.mode;
R=r.elevationModeChangeUpdateType(P.elevationModeChangeTypes,R,L);if(R!==r.SymbolUpdateType.UPDATE)return R;const N=r.needsElevationUpdates2D(L);return this.updateGraphics3DGraphicElevationInfo(M,U,()=>N)};K.slicePlaneEnabledChanged=function(){const M={slicePlaneEnabled:this._context.slicePlaneEnabled};this._forEachMaterial(U=>U.setParameters(M));return!0};K.physicalBasedRenderingChanged=function(){return!0};K.pixelRatioChanged=function(){return!0};K._getGeometryAsPolygonOrPolyline=function(M){switch(M.type){case "extent":if(M instanceof
F)return G.fromExtent(M);break;case "polygon":case "polyline":return M}return null};K._createAs3DShape=function(M,U,R){const L=this._getGeometryAsPolygonOrPolyline(M.graphic.geometry);var N="polygon"===L.type?L.rings:L.paths,T=[];const S=[],H=[],Q=f.create(),W=t.geometryToRenderInfo(L,this._context.elevationProvider,this._context.renderCoordsHelper,U);this._logGeometryCreationWarnings(W,N,"polygon"===L.type?"rings":"paths","LineSymbol3DLayer");for(N=0;N<W.lines.length;N++){const {position:V,mapPosition:Y}=
W.lines[N];if(g.isSome(this._context.clippingExtent)&&(f.empty(Q),f.expandWithBuffer(Q,Y),!f.intersectsClippingArea(Q,this._context.clippingExtent)))continue;const aa=this._createGeometry(M,V,Y,L.type,I.ELEVATED);T.push(aa);S.push("polygon"===L.type?this.ringMaterial:this.lineMaterial);H.push(w.IDENTITY);v.LINE_WIREFRAMES&&(T.push(aa.cloneShallow()),S.push("polygon"===L.type?this.wireframeRingMaterial:this.wireframeLineMaterial),H.push(w.IDENTITY));const X=this.markerMaterial;g.isSome(X)&&(T.push(aa.cloneShallow()),
S.push(X),H.push(w.IDENTITY))}if(0===T.length)return null;M=new B.Object3D({geometries:T,materials:S,transformations:H,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:R}});T=new h.Graphics3DObject3DGraphicLayer(this,M,T,null,null,k.sharedGeometryElevationAligner,U);T.alignedSampledElevation=W.sampledElevation;T.needsElevationUpdates=r.needsElevationUpdates2D(U.mode);return T};K._createGeometry=function(M,U,R,L,N){const T=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color;
return t.createGeometry({overlayInfo:N===I.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,removeDuplicateStartEnd:"polygon"===L?t.RemoveDuplicateStartEnd.REMOVE:t.RemoveDuplicateStartEnd.KEEP,uniformSize:this._uniformSize,attributeData:{position:U,mapPosition:R,size:this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?null:this._getDrivenSize(M.renderingInfo),color:T?null:this._getDrivenColor(M.renderingInfo),sizeFeature:this._getSizeFeatureAttributeData(M.graphic),
colorFeature:this._getColorFeatureAttributeData(M.graphic),opacityFeature:this._getOpacityFeatureAttributeData(M.graphic)}})};K._createAsOverlay=function(M,U){const R=M.graphic,L=this._getGeometryAsPolygonOrPolyline(R.geometry);var N="polygon"===L.type?L.rings:L.paths;const T="polygon"===L.type?this.ringMaterial:this.lineMaterial;T.renderPriority=this._renderPriority;const S=v.LINE_WIREFRAMES?"polygon"===L.type?this.wireframeRingMaterial:this.wireframeLineMaterial:null,H=this.markerMaterial;g.isSome(S)&&
(S.renderPriority=this._renderPriority-.001);g.isSome(H)&&(H.renderPriority=this._renderPriority-.002);const Q=[],W=f.create(),V=f.empty();var Y=t.geometryToRenderInfoDraped(L,this._context.overlaySR);this._logGeometryCreationWarnings(Y,N,"polygon"===L.type?"rings":"paths","LineSymbol3DLayer");for(const aa of Y.lines){f.empty(W);f.expandWithBuffer(W,aa.position);if(!f.intersectsClippingArea(W,this._context.clippingExtent))continue;f.expandWithAABB(V,W);const X=this._createGeometry(M,aa.position,null,
L.type,I.DRAPED);N=ba=>{ba=new A.RenderGeometry(X,ba,{layerUid:U,graphicUid:R.uid});Q.push(ba);return ba};if(g.isSome(H)){Y=N(H);const ba=g.unwrap(this.symbolLayer.marker).placement;"begin"!==ba&&"begin-end"!==ba||f.expandWithBuffer(W,aa.position,0,1);"end"!==ba&&"begin-end"!==ba||f.expandWithBuffer(W,aa.position,aa.position.length-3,1);this._updateBoundingSphere(Y,W)}Y=N(T);this._updateBoundingSphere(Y,W);v.LINE_WIREFRAMES&&(N=N(S),this._updateBoundingSphere(N,W))}return new p(this,Q,V)};K._updateBoundingSphere=
function(M,U){l.set(M.boundingSphere,.5*(U[0]+U[3]),.5*(U[1]+U[4]),0,.5*Math.sqrt((U[3]-U[0])*(U[3]-U[0])+(U[4]-U[1])*(U[4]-U[1])))};K._computeMaterialWidth=function(M){M=g.unwrapOr(M,x.px2pt(1));return this._drivenProperties.size?this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?x.pt2px(1):1:x.pt2px(M)};K._prepareMaterialPatch=function(M,U,R){var L=U.material;g.isNone(L)||"collection"===L.type||(L="complete"===L.type?g.applySome(L.newValue,N=>N.color):"complete"===L.diff.color.type?
L.diff.color.newValue:null,L=this._getCombinedOpacityAndColor(L),R&&this._patchMaterialColor(n.clone(L),this._markerMaterial,M),this._patternHidesLine&&(L[3]=0),this._patchMaterialColor(L,this._lineMaterial,M),delete U.material)};K._prepareMarkerPatch=function(M,U){var R=U.marker;if(g.isNone(R)||"partial"!==R.type||g.isSome(R.diff.style)||g.isSome(R.diff.placement)||g.isSome(R.diff.color)&&"complete"!==R.diff.color.type)return!1;R=R.diff.color;if(g.isNone(R))return delete U.marker,g.isNone(this.symbolLayer)||
g.isNone(this.symbolLayer.marker)||g.isNone(this.symbolLayer.marker.color);R=g.unwrap(R.newValue);if(g.isNone(R))return delete U.marker,!0;this._patchMaterialColor(this._getCombinedOpacityAndColor(R),this._markerMaterial,M);delete U.marker;return!1};K._patchMaterialColor=function(M,U,R){if(!g.isNone(U)){var L=M[3];R.symbolLayerStatePatches.push(()=>U.setParameters({color:M,transparent:1>L||this.needsDrivenTransparentPass}))}};b._createClass(P,[{key:"lineMaterial",get:function(){g.isNone(this._lineMaterial)&&
(this._lineMaterial=new D.RibbonLineMaterial(this._getMaterialParameters(!1)),this._context.stage.add(this._lineMaterial));return this._lineMaterial}},{key:"ringMaterial",get:function(){g.isNone(this._ringMaterial)&&(this._ringMaterial=new D.RibbonLineMaterial(this._getMaterialParameters(!0)),this._context.stage.add(this._ringMaterial));return this._ringMaterial}},{key:"wireframeLineMaterial",get:function(){g.isNone(this._wireframeLineMaterial)&&(this._wireframeLineMaterial=new D.RibbonLineMaterial({...this._getMaterialParameters(!1),
wireframe:!0}),this._context.stage.add(this._wireframeLineMaterial));return this._wireframeLineMaterial}},{key:"wireframeRingMaterial",get:function(){g.isNone(this._wireframeRingMaterial)&&(this._wireframeRingMaterial=new D.RibbonLineMaterial({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._wireframeRingMaterial));return this._wireframeRingMaterial}},{key:"markerMaterial",get:function(){g.isNone(this._markerMaterial)&&g.isSome(this.symbolLayer.marker)&&g.isSome(this._markerTexture)&&
(this._markerMaterial=new E.LineMarkerMaterial({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,textureId:this._markerTexture.texture.id}),this._context.stage.add(this._markerMaterial));return this._markerMaterial}},{key:"_patternHidesLine",get:function(){const M=this.symbolLayer.pattern;return g.isSome(M)&&"style"===M.type&&"none"===M.style}}]);return P}(m.Graphics3DSymbolLayer);c.elevationModeChangeTypes={definedChanged:r.SymbolUpdateType.RECREATE,staysOnTheGround:r.SymbolUpdateType.NONE,
onTheGroundChanged:r.SymbolUpdateType.RECREATE};var I;(function(O){O[O.DRAPED=0]="DRAPED";O[O.ELEVATED=1]="ELEVATED"})(I||(I={}));a.Graphics3DLineSymbolLayer=c;a.default=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/lineUtils":function(){define("exports ../../../../core/has ../../../../core/maybe ../../../../core/typedArrayUtil ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/projectionEllipsoid ../../../../geometry/support/triangulationUtils ../../../ViewingMode ./constants ./elevationAlignmentUtils ../../terrain/OverlayRenderer ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/VertexAttribute ../../../../chunks/RibbonLine.glsl".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u){function t(v,B,A){const E=[];for(const {index:C,count:D}of v){if(1>=D)continue;v=3*C;const F=v+3*D;E.push({position:B.subarray(v,F),mapPosition:A?A.subarray(v,F):void 0})}return E}a.RemoveDuplicateStartEnd=void 0;(function(v){v[v.KEEP=0]="KEEP";v[v.REMOVE=1]="REMOVE"})(a.RemoveDuplicateStartEnd||(a.RemoveDuplicateStartEnd={}));const q=w.create(),z=w.create();a.createGeometry=function(v){const B=[],A=[];{const {attributeData:{position:I},removeDuplicateStartEnd:O}=
v;var E=I.length;E=(E=I[0]===I[E-3]&&I[1]===I[E-2]&&I[2]===I[E-1])&&O===a.RemoveDuplicateStartEnd.REMOVE;var C=I.length/3-(E?1:0),D=new Uint32Array(2*(C-1)),F=E?d.slice(I,0,I.length-3):I,G=0;for(var J=0;J<C-1;J++)D[G++]=J,D[G++]=J+1;A.push([m.VertexAttribute.POSITION,{size:3,data:F,exclusive:E}]);B.push([m.VertexAttribute.POSITION,D])}C=A[0][1].data;E=new Uint16Array(B[0][1].length);D=v.attributeData.mapPosition;c.isNone(D)||(B.push([m.VertexAttribute.MAPPOS,B[0][1]]),A.push([m.VertexAttribute.MAPPOS,
{size:3,data:D}]));c.isSome(v.attributeData.colorFeature)||(A.push([m.VertexAttribute.COLOR,{size:4,data:c.unwrapOr(v.attributeData.color,k.WHITE_UNIT)}]),B.push([m.VertexAttribute.COLOR,E]));c.isSome(v.attributeData.sizeFeature)||(A.push([m.VertexAttribute.SIZE,{size:1,data:[c.unwrapOr(v.attributeData.size,1)]}]),B.push([m.VertexAttribute.SIZE,E]));D=v.attributeData.colorFeature;c.isNone(D)||(A.push([m.VertexAttribute.COLORFEATUREATTRIBUTE,{size:1,data:new Float32Array([D])}]),B.push([m.VertexAttribute.COLOR,
E]));D=v.attributeData.sizeFeature;c.isNone(D)||(A.push([m.VertexAttribute.SIZEFEATUREATTRIBUTE,{size:1,data:new Float32Array([D])}]),B.push([m.VertexAttribute.SIZEFEATUREATTRIBUTE,E]));D=v.attributeData.opacityFeature;c.isNone(D)||(A.push([m.VertexAttribute.OPACITYFEATUREATTRIBUTE,{size:1,data:new Float32Array([D])}]),B.push([m.VertexAttribute.OPACITYFEATUREATTRIBUTE,E]));if(!c.isNone(v.overlayInfo)&&v.overlayInfo.renderCoordsHelper.viewingMode===e.ViewingMode.Global&&v.overlayInfo.spatialReference.isGeographic){E=
new Float64Array(C.length);v=n.getReferenceEllipsoid(v.overlayInfo.spatialReference);for(D=0;D<E.length;D+=3)l.lonLatToWebMercatorComparable(C,D,E,D,v);v=C.length/3;C=new Float32Array(v+1);D=q;F=z;J=G=0;x.set(D,E[J++],E[J++],E[J++]);C[0]=0;for(let I=1;I<v+1;++I)I===v&&(J=0),x.set(F,E[J++],E[J++],E[J++]),G+=g.dist(D,F),C[I]=G,[D,F]=[F,D];A.push([m.VertexAttribute.DISTANCETOSTART,{size:1,data:C}]);B.push([m.VertexAttribute.DISTANCETOSTART,B[0][1]])}return new h.Geometry(A,B,p.PrimitiveType.Line)};a.geometryToRenderInfo=
function(v,B,A,E){const {position:C,outlines:D}=f.pathsToTriangulationInfo("polygon"===v.type?v.rings:v.paths,v.hasZ,"polygon"===v.type?f.CounterClockwiseMode.CCW_IS_HOLE:f.CounterClockwiseMode.NONE),F=new Float64Array(C.length);v=r.applyPerVertexElevationAlignment(C,v.spatialReference,0,F,0,C,0,C.length/3,B,A,E);B=null!=v;return{lines:B?t(D,C,F):[],projectionSuccess:B,sampledElevation:v}};a.geometryToRenderInfoDraped=function(v,B){const {position:A,outlines:E}=f.pathsToTriangulationInfo("polygon"===
v.type?v.rings:v.paths,!1,"polygon"===v.type?f.CounterClockwiseMode.CCW_IS_HOLE:f.CounterClockwiseMode.NONE);v=l.projectBuffer(A,v.spatialReference,0,A,B,0,A.length/3);for(B=2;B<A.length;B+=3)A[B]=y.DRAPED_Z;return{lines:v?t(E,A):[],projectionSuccess:v}};a.parseCapType=function(v){switch(v){case "butt":return u.CapType.BUTT;case "square":return u.CapType.SQUARE;case "round":return u.CapType.ROUND;default:return null}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/markerUtils":function(){define(["exports",
"../../../../core/maybe","../graphics/sdfPrimitives"],function(a,b,c){function d(x,w){return x.fromData(w,()=>c.createTexture(w,64,32,6.4))}function g(x){return"diamond"===x?"kite":x}a.MARKER_SYMBOL_SIZE=32;a.MARKER_TEXTURE_SIZE=64;a.MARKER_THICKNESS=6.4;a.parseLineMarkerStyle=g;a.prepareMarkerResources=function(x,w){return b.isSome(w)?d(x,g(w.style)):null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/LineMarkerMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutputOptions ../lib/GLMaterials ../lib/GLMaterialTexture ../lib/Material ../lib/RenderSlot ../lib/VertexAttribute ./VisualVariableMaterialParameters ../shaders/LineMarkerTechnique".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r){let y=function(q){function z(B){B=q.call(this,B,h)||this;B._vertexAttributeLocations=r.markerVertexAttributeLocations;B.techniqueConfig=new r.LineMarkerTechniqueConfiguration;B.layout=B.createLayout();return B}b._inheritsLoose(z,q);var v=z.prototype;v.dispose=function(){};v.getTechniqueConfig=function(B,A){this.techniqueConfig.output=B;this.techniqueConfig.draped=A.slot===f.RenderSlot.DRAPED_MATERIAL;this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled;
this.techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees;this.techniqueConfig.transparent=this.parameters.transparent;this.techniqueConfig.writeDepth=this.parameters.writeDepth;this.techniqueConfig.vvColor=this.parameters.vvColorEnabled;this.techniqueConfig.vvOpacity=this.parameters.vvOpacityEnabled;this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled;this.techniqueConfig.occluder=this.parameters.renderOccluded===n.RenderOccludedFlag.OccludeAndTransparentStencil;this.techniqueConfig.transparencyPassType=
A.transparencyPassType;this.techniqueConfig.multipassTerrainEnabled=A.multipassTerrainEnabled;this.techniqueConfig.cullAboveGround=A.cullAboveGround;return this.techniqueConfig};v.intersect=function(){};v.createLayout=function(){const B=g.newLayout().vec3f(e.VertexAttribute.POSITION).vec2f(e.VertexAttribute.UV0).vec3f(e.VertexAttribute.AUXPOS1);this.parameters.vvSizeEnabled?B.f32(e.VertexAttribute.SIZEFEATUREATTRIBUTE):B.f32(e.VertexAttribute.SIZE);this.parameters.vvColorEnabled?B.f32(e.VertexAttribute.COLORFEATUREATTRIBUTE):
B.vec4f(e.VertexAttribute.COLOR);this.parameters.vvOpacityEnabled&&B.f32(e.VertexAttribute.OPACITYFEATUREATTRIBUTE);return B};v.createBufferWriter=function(){return new m(this.layout,this.parameters)};v.requiresSlot=function(B,A){if(B===f.RenderSlot.DRAPED_MATERIAL)return!0;if(this.parameters.renderOccluded===n.RenderOccludedFlag.OccludeAndTransparentStencil)return B===f.RenderSlot.OPAQUE_MATERIAL||B===f.RenderSlot.OCCLUDER_MATERIAL||B===f.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL;A=w.outputFromPass(A);
return A===x.ShaderOutput.Color||A===x.ShaderOutput.Alpha?B===(this.parameters.writeDepth?f.RenderSlot.TRANSPARENT_MATERIAL:f.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):B===f.RenderSlot.OPAQUE_MATERIAL};v.createGLMaterial=function(B){return B.output===x.ShaderOutput.Color||B.output===x.ShaderOutput.Alpha||B.output===x.ShaderOutput.Highlight||B.output===x.ShaderOutput.Depth?new p(B):null};v.validateParameters=function(B){B.color&&1>B.color[3]&&(B.transparent=!0)};return z}(n.Material),p=
function(q){function z(B){return q.call(this,{...B,...B.material.parameters})||this}b._inheritsLoose(z,q);var v=z.prototype;v.updateParameters=function(B){this.updateTexture(this._material.parameters.textureId);return this.ensureTechnique(r.LineMarkerTechnique,B)};v._updateOccludeeState=function(B){B.hasOccludees!==this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:B.hasOccludees})};v.beginSlot=function(B){this._output!==x.ShaderOutput.Color&&this._output!==
x.ShaderOutput.Alpha||this._updateOccludeeState(B);return this.updateParameters(B)};v.bind=function(B,A){this.bindTextures(A.program);this.bindTextureScale(A.program);A.bindPass(this._material.parameters,B)};return z}(l);const h={width:0,color:[1,1,1,1],placement:"end",textureId:null,writeDepth:!0,slicePlaneEnabled:!1,vvFastUpdate:!1,transparent:!1,sceneHasOcludees:!1,...n.DefaultMaterialParameters,...k.VisualVariableDefaultMaterialParameters};let m=function(){function q(v,B){this.vertexBufferLayout=
v;this.parameters=B}var z=q.prototype;z.allocate=function(v){return this.vertexBufferLayout.createBuffer(v)};z.elementCount=function(){return"begin-end"===this.parameters.placement?12:6};z.write=function(v,B,A,E){const C=B.vertexAttributes.get(e.VertexAttribute.POSITION).data,D=C.length/3;let F=1,G=0;this.parameters.vvSizeEnabled?G=B.vertexAttributes.get(e.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0]:B.vertexAttributes.has(e.VertexAttribute.SIZE)&&(F=B.vertexAttributes.get(e.VertexAttribute.SIZE).data[0]);
let J=[1,1,1,1],I=0;this.parameters.vvColorEnabled?I=B.vertexAttributes.get(e.VertexAttribute.COLORFEATUREATTRIBUTE).data[0]:B.vertexAttributes.has(e.VertexAttribute.COLOR)&&(J=B.vertexAttributes.get(e.VertexAttribute.COLOR).data);let O=0;this.parameters.vvOpacityEnabled&&(O=B.vertexAttributes.get(e.VertexAttribute.OPACITYFEATUREATTRIBUTE).data[0]);const P=v.transformation,K=new Float32Array(A.buffer);let M=this.vertexBufferLayout.stride/4*E;const U=(L,N,T,S)=>{K[M++]=L[0];K[M++]=L[1];K[M++]=L[2];
K[M++]=T[0];K[M++]=T[1];K[M++]=N[0];K[M++]=N[1];K[M++]=N[2];this.parameters.vvSizeEnabled?K[M++]=G:K[M++]=F;this.parameters.vvColorEnabled?K[M++]=I:(L=Math.min(4*S,J.length-4),K[M++]=J[L+0],K[M++]=J[L+1],K[M++]=J[L+2],K[M++]=J[L+3]);this.parameters.vvOpacityEnabled&&(K[M++]=O)};let R;(function(L){L[L.ASCENDING=1]="ASCENDING";L[L.DESCENDING=-1]="DESCENDING"})(R||(R={}));v=(L,N)=>{const T=c.set(u,C[3*L],C[3*L+1],C[3*L+2]),S=t;let H=L+N;do c.set(S,C[3*H],C[3*H+1],C[3*H+2]),H+=N;while(c.equals(T,S)&&
0<=H&&H<D);P&&(c.transformMat4(T,T,P),c.transformMat4(S,S,P));U(T,S,[-1,-1],L);U(T,S,[1,-1],L);U(T,S,[1,1],L);U(T,S,[-1,-1],L);U(T,S,[1,1],L);U(T,S,[-1,1],L)};B=this.parameters.placement;"begin"!==B&&"begin-end"!==B||v(0,R.ASCENDING);"end"!==B&&"begin-end"!==B||v(D-1,R.DESCENDING)};return q}();const u=d.create(),t=d.create();a.LineMarkerMaterial=y;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/LineMarkerTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../chunks/mat4 ../../../../geometry/support/vectorStacks ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../core/shaderLibrary/shading/VisualVariables.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/OrderIndependentTransparency ../lib/Program ../lib/RenderSlot ../lib/StencilUtils ../lib/VertexAttribute ../../../../chunks/LineMarker.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B){const A=new Map([[z.VertexAttribute.POSITION,0],[z.VertexAttribute.UV0,2],[z.VertexAttribute.AUXPOS1,3],[z.VertexAttribute.SIZE,6],[z.VertexAttribute.SIZEFEATUREATTRIBUTE,6],[z.VertexAttribute.COLOR,5],[z.VertexAttribute.COLORFEATUREATTRIBUTE,5],[z.VertexAttribute.OPACITYFEATUREATTRIBUTE,7]]);y=function(E){function C(F,G,J){return E.call(this,F,G,J)||this}c._inheritsLoose(C,E);var D=C.prototype;D.initializeProgram=function(F){var G=C.shader.get();
const J=this.configuration;G=G.build({oitEnabled:J.transparencyPassType===h.TransparencyPassType.Color,output:J.output,slicePlaneEnabled:J.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,draped:J.draped,vvColor:J.vvColor,vvSize:J.vvSize,vvInstancingEnabled:!0,vvOpacity:J.vvOpacity,multipassTerrainEnabled:J.multipassTerrainEnabled,cullAboveGround:J.cullAboveGround});return new u.Program(F.rctx,G,A)};D.bindPass=function(F,G){k.bindProjectionMatrix(this.program,G.camera.projectionMatrix);
this.configuration.output===w.ShaderOutput.Highlight&&n.bindOutputHighlight(this.program,G);G.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",G.inverseViewport),f.bindMultipassTerrainTexture(this.program,G));this.program.setUniform1f("intrinsicWidth",F.width);this.program.setUniform4fv("intrinsicColor",F.color);this.program.setUniform2fv("nearFar",G.camera.nearFar);this.program.setUniform1f("pixelRatio",G.camera.pixelRatio);this.program.setUniform2f("screenSize",G.camera.fullViewport[2],
G.camera.fullViewport[3]);e.bindVisualVariablesUniformsWithOpacity(this.program,F)};D.bindDraw=function(F){k.bindView(this.program,F);l.bindSliceUniforms(this.program,this.configuration,F.slicePlane,{origin:F.origin,view:F.camera.viewMatrix});this.program.setUniformMatrix4fv("inverseProjectionMatrix",g.invert(x.sm4d.get(),F.camera.projectionMatrix));this.program.rebindTextures()};D._makePipelineState=function(F,G){const J=this.configuration,I=F===h.TransparencyPassType.NONE;return B.makePipelineState({blending:J.output===
w.ShaderOutput.Color||J.output===w.ShaderOutput.Alpha?I?m.blendingDefault:m.oitBlending(F):null,depthTest:{func:m.oitDepthTest(F)},depthWrite:I?J.writeDepth&&B.defaultDepthWriteParams:m.oitDepthWrite(F),colorWrite:B.defaultColorWriteParams,stencilWrite:J.sceneHasOcludees?q.stencilWriteMaskOn:null,stencilTest:J.sceneHasOcludees?G?q.stencilToolMaskBaseParams:q.stencilBaseAllZerosParams:null,polygonOffset:{factor:0,units:-10}})};D.initializePipeline=function(){this.configuration.occluder&&(this._occluderPipelineTransparent=
B.makePipelineState({blending:m.blendingDefault,depthTest:q.depthCompareAlways,depthWrite:null,colorWrite:B.defaultColorWriteParams,stencilWrite:null,stencilTest:q.stencilToolTransparentOccluderParams}),this._occluderPipelineOpaque=B.makePipelineState({blending:m.blendingDefault,depthTest:q.depthCompareAlways,depthWrite:null,colorWrite:B.defaultColorWriteParams,stencilWrite:q.stencilWriteMaskOff,stencilTest:q.stencilToolMaskOccluderParams}),this._occluderPipelineMaskWrite=B.makePipelineState({blending:null,
depthTest:q.depthCompareLess,depthWrite:null,colorWrite:null,stencilWrite:q.stencilWriteMaskOn,stencilTest:q.stencilToolMaskBaseParams}));this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0);return this._makePipelineState(this.configuration.transparencyPassType,!1)};D.getPipelineState=function(F,G){return G?this._occludeePipelineState:this.configuration.occluder?F===t.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:F===t.RenderSlot.OCCLUDER_MATERIAL?
this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:E.prototype.getPipelineState.call(this,F,G)};return C}(y.ShaderTechnique);y.shader=new r.ReloadableShaderModule(v.LineMarkerShader,()=>new Promise((E,C)=>a(["./LineMarker.glsl"],E,C)));r=function(E){function C(){var D=E.apply(this,arguments)||this;D.output=w.ShaderOutput.Color;D.occluder=!1;D.slicePlaneEnabled=!1;D.transparent=!1;D.writeDepth=!1;D.draped=!1;D.vvSize=!1;D.vvColor=!1;D.vvOpacity=!1;D.sceneHasOcludees=!1;D.transparencyPassType=
h.TransparencyPassType.NONE;D.multipassTerrainEnabled=!1;D.cullAboveGround=!1;return D}c._inheritsLoose(C,E);return C}(p.ShaderTechniqueConfiguration);d.__decorate([p.parameter({count:w.ShaderOutput.COUNT})],r.prototype,"output",void 0);d.__decorate([p.parameter()],r.prototype,"occluder",void 0);d.__decorate([p.parameter()],r.prototype,"slicePlaneEnabled",void 0);d.__decorate([p.parameter()],r.prototype,"transparent",void 0);d.__decorate([p.parameter()],r.prototype,"writeDepth",void 0);d.__decorate([p.parameter()],
r.prototype,"draped",void 0);d.__decorate([p.parameter()],r.prototype,"vvSize",void 0);d.__decorate([p.parameter()],r.prototype,"vvColor",void 0);d.__decorate([p.parameter()],r.prototype,"vvOpacity",void 0);d.__decorate([p.parameter()],r.prototype,"sceneHasOcludees",void 0);d.__decorate([p.parameter({count:h.TransparencyPassType.COUNT})],r.prototype,"transparencyPassType",void 0);d.__decorate([p.parameter()],r.prototype,"multipassTerrainEnabled",void 0);d.__decorate([p.parameter()],r.prototype,"cullAboveGround",
void 0);b.LineMarkerTechnique=y;b.LineMarkerTechniqueConfiguration=r;b.markerVertexAttributeLocations=A;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/LineMarker.glsl":function(){define("exports ../views/3d/layers/support/markerUtils ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y){function p(m){const u=new r.ShaderBuilder;u.include(g.RibbonVertexPosition,m);m.output===c.ShaderOutput.Depth&&u.include(x.OutputDepth,m);u.fragment.include(e.RgbaFloatEncoding);u.vertex.uniforms.add("proj","mat4").add("view","mat4").add("nearFar","vec2").add("pixelRatio","float").add("screenSize","vec2").add("inverseProjectionMatrix","mat4");u.fragment.uniforms.add("tex","sampler2D");u.attributes.add(y.VertexAttribute.POSITION,"vec3");u.attributes.add(y.VertexAttribute.UV0,
"vec2");u.attributes.add(y.VertexAttribute.AUXPOS1,"vec3");u.varyings.add("vColor","vec4");u.varyings.add("vpos","vec3");u.varyings.add("vUV","vec2");u.varyings.add("vSize","float");u.varyings.add("linearDepth","float");m.multipassTerrainEnabled&&u.varyings.add("depth","float");u.vertex.code.add(k.glsl`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}`);u.vertex.code.add(k.glsl`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= screenSize / posNdc.w;
return posNdc;
}`);u.vertex.code.add(k.glsl`
    void clipAndTransform(inout vec4 pos, inout vec4 prev) {
      float vnp = nearFar[0] * 0.99;

      if (prev.z > -nearFar[0]) {
        //previous behind ncp
        prev = mix(pos, prev, interp(vnp, pos, prev));
      }

      ${m.multipassTerrainEnabled?"depth \x3d pos.z;":""}
      linearDepth = (-pos.z - nearFar[0]) / (nearFar[1] - nearFar[0]);

      pos = projectAndScale(pos);
      prev = projectAndScale(prev);
    }
  `);u.vertex.code.add(k.glsl`
    void main(void) {
      float coverage = 1.0;

      // Check for special value of uv0.y which is used by the Renderer when graphics
      // are removed before the VBO is recompacted. If this is the case, then we just
      // project outside of clip space.
      if (uv0.y == 0.0) {
        // Project out of clip space
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
      }
      else {
        float lineSize = getSize();
        float lineWidth = max(lineSize, 1.0) * pixelRatio;

        vec4 pos  = view * vec4(position.xyz, 1.0);
        vec4 prev = view * vec4(auxpos1.xyz, 1.0);
        clipAndTransform(pos, prev);

        // normalize vector along line segment
        vec2 segment = pos.xy - prev.xy;
        float segmentLen = length(segment);
        segment = (segmentLen > 0.001) ? segment / segmentLen : vec2(0.0, 0.0);

        // displace according to position in the texture
        vec2 displacementDirU = uv0.x * PERPENDICULAR(segment);
        vec2 displacementDirV = uv0.y * segment;

        vSize = ${k.glsl.float(b.MARKER_TEXTURE_SIZE/b.MARKER_THICKNESS)} * lineWidth;
        pos.xy += displacementDirU * vSize + displacementDirV * vSize;

        // Convert back into NDC
        pos.xy = (pos.xy / screenSize) * pos.w;

        // Convert texture coordinate into [0,1]
        vUV = (uv0 + 1.0) / 2.0;

        vColor = getColor();
        vColor.a *= coverage;

        // transform final position to camera space for slicing
        vpos = (inverseProjectionMatrix * pos).xyz;
        gl_Position = pos;
      }
    }
  `);m.multipassTerrainEnabled&&(u.fragment.include(w.ReadLinearDepth),u.include(l.multipassTerrainTest,m));u.include(d.Slice,m);u.fragment.uniforms.add("intrinsicColor","vec4");u.fragment.include(f.ColorConversion);u.fragment.code.add(k.glsl`
  void main() {
    discardBySlice(vpos);
    ${m.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    // Offset texture coordinate s.t. we sample texel centers
    float texelSize = ${k.glsl.float(1/b.MARKER_TEXTURE_SIZE)};
    vec2 samplePos = vUV + vec2(0.5, -0.5) * texelSize;

    // Evaluate sdf
    float sdf = rgba2float(texture2D(tex, samplePos)) - 0.5;
    float distance = sdf * vSize;

    // Grow by a halfpixel to make sure the line is fully covered by the cross marker
    // (otherwise there will be a halo if they are different colours)
    distance -= 0.5;

    finalColor.a *= clamp(0.5 - distance, 0.0, 1.0);

    if (finalColor.a < ${k.glsl.float(n.symbolAlphaCutoff)}) {
      discard;
    }

    ${m.output===c.ShaderOutput.Alpha?k.glsl`gl_FragColor = vec4(finalColor.a);`:""}
    ${m.output===c.ShaderOutput.Color?k.glsl`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${m.output===c.ShaderOutput.Color&&m.oitEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
    ${m.output===c.ShaderOutput.Highlight?k.glsl`gl_FragColor = vec4(1.0);`:""}
    ${m.output===c.ShaderOutput.Depth?k.glsl`outputDepth(linearDepth);`:""}
  }
  `);return u}const h=Object.freeze({__proto__:null,build:p});a.LineMarkerShader=h;a.build=p})},"esri/views/3d/webgl-engine/materials/lineStippleUtils":function(){define(["exports","../../../../core/maybe"],function(a,b){function c(w,l=2){return b.isNone(w)?w:{pattern:w.slice(),pixelRatio:l}}function d(w){return b.isSome(w)?c(x[w],8):null}const g={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},x={dash:g.dash,"dash-dot":[...g.dash,...g.dot],dot:g.dot,"long-dash":g["long-dash"],
"long-dash-dot":[...g["long-dash"],...g.dot],"long-dash-dot-dot":[...g["long-dash"],...g.dot,...g.dot],none:null,"short-dash":g["short-dash"],"short-dash-dot":[...g["short-dash"],...g["short-dot"]],"short-dash-dot-dot":[...g["short-dash"],...g["short-dot"],...g["short-dot"]],"short-dot":g["short-dot"],solid:null};a.createStipplePattern=c;a.createStipplePatternSimple=function(w,l=2){return{pattern:[w,w],pixelRatio:l}};a.getStipplePatternForLinePattern=function(w){return b.isSome(w)&&"style"===w.type?
d(w.style):null};a.getStipplePatternForPatternStyle=d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DMeshFillSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/has ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/MeshComponent ../../../../geometry/support/MeshMaterialMetallicRoughness ../../../../geometry/support/buffer/BufferView ../../../../chunks/vec32 ../../../../geometry/support/meshUtils/projection ../../../../layers/graphics/dehydratedFeatures ../../../ViewingMode ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ../support/edgeUtils ../support/symbolColorUtils ../../support/debugFlags ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/geometryDataUtils ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Texture ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/NativeLineMaterial ../../../webgl/enums".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E,C,D,F,G,J,I,O,P,K,M,U,R,L){const N=["mesh"];d=function(ha){function ka(ea,ca,Z,fa){ea=ha.call(this,ea,ca,Z,fa)||this;ea._materials=new Map;ea._textures=new Map;ea.ensureDrapedStatus(!1);return ea}b._inheritsLoose(ka,ha);var ia=ka.prototype;ia.doLoad=function(){var ea=b._asyncToGenerator(function*(){G.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new R.NativeLineMaterial({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new R.NativeLineMaterial({color:[0,
1,1,1]}))});return function(){return ea.apply(this,arguments)}}();ia.destroy=function(){ha.prototype.destroy.call(this);this._context.stage.removeMany(Array.from(this._materials.values(),ea=>ea.material));this._context.stage.removeMany(Array.from(this._textures.values()));this._materials.clear();this._textures.clear()};ia.createGraphics3DGraphic=function(ea){const ca=ea.graphic;if(!this._validateGeometry(ca.geometry,N,"fill on mesh-3d"))return null;const Z=this.setGraphicElevationContext(ca,new A.ElevationContext);
return this._createAs3DShape(ca,ea.renderingInfo,Z,ca.uid)};ia.layerOpacityChanged=function(ea,ca){const Z=this._getLayerOpacity();this._materials.forEach(fa=>{fa.material.setParameters({layerOpacity:Z});const ja=fa.material.parameters;this._setMaterialTransparentParameter(ja,fa);fa.material.setParameters({transparent:ja.transparent})});ea.forEach(fa=>{fa=ca(fa);g.isSome(fa)&&fa.layerOpacityChanged(Z,this._context.isAsync)});return!0};ia.layerElevationInfoChanged=function(ea,ca){return this.updateGraphics3DGraphicElevationInfo(ea,
ca,B.needsElevationUpdates3D)};ia.slicePlaneEnabledChanged=function(ea,ca){this._materials.forEach(Z=>{Z.material.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled})});ea.forEach(Z=>{Z=ca(Z);g.isSome(Z)&&Z.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)});return!0};ia.physicalBasedRenderingChanged=function(){const ea=this._usePBR();this._materials.forEach(ca=>ca.material.setParameters({usePBR:ea}));return!0};ia.pixelRatioChanged=function(){return!0};
ia._requiresSymbolVertexColors=function(){return this._drivenProperties.color||this._drivenProperties.opacity};ia._colorOrTextureUid=function(ea){return g.isNone(ea)?"-":ea instanceof c?ea.toHex():ea.contentHash};ia._materialPropertiesDefault=function(ea,ca){const Z=this._requiresSymbolVertexColors(),fa=!!ea.vertexAttributes.color;ea=!!ea.vertexAttributes.tangent;return{hasSymbolVertexColors:Z,hasVertexColors:fa,hasVertexTangents:ea,uid:`vc:${fa},vt:${ea},vct${ca},svc:${Z}`}};ia._materialProperties=
function(ea,ca,Z){ea=this._materialPropertiesDefault(ea,Z);if(!ca.material)return ea;const {color:fa,colorTexture:ja,normalTexture:la,doubleSided:ma,alphaCutoff:ra,alphaMode:va}=ca.material;Z=this._colorOrTextureUid(fa);var ya=this._colorOrTextureUid(ja),za=this._colorOrTextureUid(la);ea.color=fa;ea.colorTexture=ja;ea.normalTexture=la;ea.uid=`${ea.uid},cmuid:${Z},ctmuid:${ya},ntmuid:${za},ds:${ma},ac:${ra},am:${va}`;if(ca.material instanceof h){const {metallic:pa,roughness:wa,metallicRoughnessTexture:na,
emissiveColor:qa,emissiveTexture:ta,occlusionTexture:Fa}=ca.material;ca=this._colorOrTextureUid(na);Z=this._colorOrTextureUid(qa);ya=this._colorOrTextureUid(ta);za=this._colorOrTextureUid(Fa);ea.metallic=pa;ea.roughness=wa;ea.metallicRoughnessTexture=na;ea.emissiveColor=qa;ea.emissiveTexture=ta;ea.occlusionTexture=Fa;ea.uid=`${ea.uid},mrm:${pa},mrr:${wa},mrt:${ca},emuid:${Z},etmuid:${ya},otmuid:${za}`}return ea};ia._setInternalColorValueParameters=function(ea,ca){ca.diffuse=c.toUnitRGB(ea);ca.opacity=
ea.a};ia._getLoadableTextureResource=function(ea){return ea.data?ea.data:ea.url};ia._getInternalTextureId=function(ea){ea=this._getInternalTexture(ea,J.AlphaDiscardMode.Opaque);return g.isSome(ea)?ea.id:null};ia._getInternalTexture=function(ea,ca){const Z=this._getLoadableTextureResource(ea);if(!Z)return null;const fa=`${ea.contentHash}/${ca}`;let ja=this._textures.get(fa);ja||(ja=new K.Texture(Z,{mipmap:!0,wrap:this._castTextureWrap(ea.wrap),noUnpackFlip:!0,preMultiplyAlpha:ca!==J.AlphaDiscardMode.Opaque}),
this._textures.set(fa,ja),this._context.stage.add(ja),this._context.stage.loadImmediate(ja));return ja};ia._castTextureWrap=function(ea="repeat"){return"string"===typeof ea?(ea=this._castTextureWrapIndividual(ea),{s:ea,t:ea}):{s:this._castTextureWrapIndividual(ea.horizontal),t:this._castTextureWrapIndividual(ea.vertical)}};ia._castTextureWrapIndividual=function(ea){switch(ea){case "clamp":return L.TextureWrapMode.CLAMP_TO_EDGE;case "mirror":return L.TextureWrapMode.MIRRORED_REPEAT;default:return L.TextureWrapMode.REPEAT}};
ia._setInternalMaterialParameters=function(ea,ca){g.isSome(ea.color)&&this._setInternalColorValueParameters(ea.color,ca);if(g.isSome(ea.colorTexture)){const Z=this._getInternalTexture(ea.colorTexture,ca.textureAlphaMode);g.isSome(Z)?(ca.textureId=Z.id,ca.textureAlphaPremultiplied=!!Z.params.preMultiplyAlpha):ca.textureId=void 0}g.isSome(ea.normalTexture)&&(ca.normalTextureId=this._getInternalTextureId(ea.normalTexture));g.isSome(ea.emissiveColor)&&(ca.emissiveFactor=c.toUnitRGB(ea.emissiveColor));
g.isSome(ea.emissiveTexture)&&(ca.emissiveTextureId=this._getInternalTextureId(ea.emissiveTexture));g.isSome(ea.occlusionTexture)&&(ca.occlusionTextureId=this._getInternalTextureId(ea.occlusionTexture));g.isSome(ea.metallicRoughnessTexture)&&(ca.metallicRoughnessTextureId=this._getInternalTextureId(ea.metallicRoughnessTexture))};ia._setExternalMaterialParameters=function(ea){var ca=this._drivenProperties.color;let Z=g.isSome(this.symbolLayer.material)?this.symbolLayer.material.colorMixMode:null;ca?
ea.externalColor=k.ONES:(ca=g.isSome(this.symbolLayer.material)?this.symbolLayer.material.color:null,g.isSome(ca)?ea.externalColor=c.toUnitRGBA(ca):(Z=null,ea.externalColor=k.ONES));Z&&(ea.colorMixMode=Z);ea.castShadows=!!this.symbolLayer.castShadows};ia._hasTransparentVertexColors=function(ea){ea=ea.vertexAttributes.color;if(g.isNone(ea))return!1;for(let ca=3;ca<ea.length;ca+=4)if(255!==ea[ca])return!0;return!1};ia._getOrCreateMaterial=function(ea,ca){var Z,fa,ja,la=null==(Z=ca.material)?void 0:
Z.color;Z=null==(fa=ca.material)?void 0:fa.colorTexture;fa=null==(ja=ca.material)?void 0:ja.alphaMode;ja="blend"===fa;la="opaque"!==fa&&(this._hasTransparentVertexColors(ea)||g.isSome(la)&&1>la.a||g.isSome(Z)&&Z.transparent||ja);ea=this._materialProperties(ea,ca,la);if(ja=this._materials.get(ea.uid))return ja.material;la={material:null,isComponentTransparent:la,alphaMode:ca.material?ca.material.alphaMode:"opaque"};ja=null==ea.metallicRoughnessTexture&&null==ea.metallic&&null==ea.roughness;Z={usePBR:this._usePBR(),
isSchematic:ja,vertexColors:ea.hasVertexColors,symbolColors:ea.hasSymbolVertexColors,vertexTangents:ea.hasVertexTangents,ambient:e.ZEROS,diffuse:e.ONES,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:J.CullFaceOptions.None,layerOpacity:this._getLayerOpacity(),slicePlaneEnabled:this._context.slicePlaneEnabled,initTextureTransparent:!0};ja||(Z.mrrFactors=[null!=ea.metallic?ea.metallic:1,null!=ea.roughness?ea.roughness:1,.5]);ca.material&&(Z.doubleSided=ca.material.doubleSided,Z.cullFace=
ca.material.doubleSided?J.CullFaceOptions.None:J.CullFaceOptions.Back,Z.textureAlphaCutoff=ca.material.alphaCutoff);this._setExternalMaterialParameters(Z);this._setMaterialTransparentParameter(Z,la);this._setInternalMaterialParameters(ea,Z);ca=new U.DefaultMaterial(Z);la.material=ca;this._materials.set(ea.uid,la);this._context.stage.add(ca);return ca};ia._usePBR=function(){return this._context.physicalBasedRenderingEnabled};ia._setMaterialTransparentParameter=function(ea,ca){ea.transparent=this.needsDrivenTransparentPass||
ca.isComponentTransparent||1>ea.layerOpacity||1>ea.opacity||ea.externalColor&&1>ea.externalColor[3];ea.textureAlphaMode="auto"===ca.alphaMode?ea.transparent?J.AlphaDiscardMode.MaskBlend:J.AlphaDiscardMode.Opaque:"opaque"===ca.alphaMode?J.AlphaDiscardMode.Opaque:"mask"===ca.alphaMode?J.AlphaDiscardMode.Mask:J.AlphaDiscardMode.Blend};ia._addDebugNormals=function(ea,ca,Z,fa){var ja=ca.length,la=ea.spatialReference.isGeographic?20015077/180:1;const ma=.1*Math.max(ea.extent.width*la,ea.extent.height*la,
ea.extent.zmax-ea.extent.zmin),ra=[],va=[];ea=[];la=[];for(let qa=0;qa<ja;qa++){var ya=ca[qa],za=ya.vertexAttributes.get(M.VertexAttribute.POSITION),pa=ya.vertexAttributes.get(M.VertexAttribute.NORMAL);const ta=ya.indices.get(M.VertexAttribute.POSITION);ya=ya.indices.get(M.VertexAttribute.NORMAL);za=za.data;pa=pa.data;for(let Fa=0;Fa<ta.length;Fa++){var wa=3*ta[Fa];const Ha=3*ya[Fa];for(var na=0;3>na;na++)ra.push(za[wa+na]);for(na=0;3>na;na++)ra.push(za[wa+na]+pa[Ha+na]*ma);va.push(va.length);va.push(va.length);
if(0===Fa%3){this._calculateFaceNormal(za,ta,Fa,W);this._getFaceVertices(za,ta,Fa,S,H,Q);f.add(S,S,H);f.add(S,S,Q);f.scale(S,S,1/3);for(wa=0;3>wa;wa++)ea.push(S[wa]);for(wa=0;3>wa;wa++)ea.push(S[wa]+W[wa]*ma);la.push(la.length);la.push(la.length)}}}ja=new I.Geometry([[M.VertexAttribute.POSITION,{data:ra,size:3,exclusive:!0}]],[[M.VertexAttribute.POSITION,new Uint32Array(va)]],J.PrimitiveType.Line);ca.push(ja);Z.push(this._debugVertexNormalMaterial);fa.push(n.clone(fa[0]));ja=new I.Geometry([[M.VertexAttribute.POSITION,
{data:ea,size:3,exclusive:!0}]],[[M.VertexAttribute.POSITION,new Uint32Array(la)]],J.PrimitiveType.Line);ca.push(ja);Z.push(this._debugFaceNormalMaterial);fa.push(n.clone(fa[0]))};ia._createAs3DShape=function(ea,ca,Z,fa){ea=ea.geometry;if("mesh"!==ea.type)return null;ca=this._createGeometryInfo(ea,ca);if(!ca)return null;const {geometries:ja,materials:la,transformations:ma,objectTransformation:ra}=ca;G.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(ea,ja,la,ma);fa=new P.Object3D({geometries:ja,
materials:la,transformations:ma,metadata:{layerUid:this._context.layer.uid,graphicUid:fa}});fa.transformation=ra;ca=this._createEdgeMaterial();ca=g.isSome(ca)?{baseMaterial:la[0],edgeMaterials:[ca],properties:{mergeGeometries:!0,slicePlaneEnabled:this._context.slicePlaneEnabled}}:null;ca=new E.Graphics3DObject3DGraphicLayer(this,fa,ja,null,null,v.perObjectElevationAligner,Z,ca);ca.needsElevationUpdates=B.needsElevationUpdates3D(Z.mode);ca.useObjectOriginAsAttachmentOrigin=!0;ca.elevationContext.centerPointInElevationSR=
this._getCenterPointInElevationSR(fa);ca.alignedSampledElevation=v.perObjectElevationAligner(ca,ca.elevationContext,this._context.elevationProvider,this._context.renderCoordsHelper);return ca};ia._getCenterPointInElevationSR=function(ea){const ca=q.makeDehydratedPoint(0,0,0,this._context.elevationProvider.spatialReference);r.projectVectorToDehydratedPoint([ea.transformation[12],ea.transformation[13],ea.transformation[14]],this._context.renderCoordsHelper.spatialReference,ca);return ca};ia._createComponentNormals=
function(ea,ca,Z,fa){switch(Z.shading||"flat"){case "source":return this._createComponentNormalsSource(ea,ca,Z,fa);case "flat":return this._createComponentNormalsFlat(ea,fa);case "smooth":return this._createComponentNormalsSmooth(ea,fa)}};ia._createComponentNormalsSource=function(ea,ca,Z,fa){if(g.isNone(ca))return this._createComponentNormalsFlat(ea,fa);let ja=!1;if(!Z.trustSourceNormals)for(Z=0;Z<fa.length;Z+=3){this._calculateFaceNormal(ea,fa,Z,W);for(let la=0;3>la;la++){const ma=3*fa[Z+la];S[0]=
ca[ma+0];S[1]=ca[ma+1];S[2]=ca[ma+2];0>f.dot(W,S)&&(ca[ma+0]=-ca[ma+0],ca[ma+1]=-ca[ma+1],ca[ma+2]=-ca[ma+2],ja=!0)}}return{normals:ca,indices:fa,didFlipNormals:ja}};ia._createComponentNormalsFlat=function(ea,ca){const Z=new Float32Array(ca.length),fa=new Uint32Array(3*ca.length);for(let ja=0;ja<ca.length;ja+=3){const la=this._calculateFaceNormal(ea,ca,ja,W);for(let ma=0;3>ma;ma++)Z[ja+ma]=la[ma],fa[ja+ma]=ja/3}return{normals:Z,indices:fa,didFlipNormals:!1}};ia._createComponentNormalsSmooth=function(ea,
ca){const Z={};for(var fa=0;fa<ca.length;fa+=3){var ja=this._calculateFaceNormal(ea,ca,fa,W);for(var la=0;3>la;la++){var ma=ca[fa+la];let ra=Z[ma];ra||(ra={normal:e.create(),count:0},Z[ma]=ra);f.add(ra.normal,ra.normal,ja);ra.count++}}ea=new Float32Array(3*ca.length);fa=new Uint32Array(3*ca.length);for(ja=0;ja<ca.length;ja++){la=Z[ca[ja]];1!==la.count&&(f.normalize(la.normal,la.normal),la.count=1);for(ma=0;3>ma;ma++)ea[3*ja+ma]=la.normal[ma];fa[ja]=ja}return{normals:ea,indices:fa,didFlipNormals:!1}};
ia._getFaceVertices=function(ea,ca,Z,fa,ja,la){const ma=3*ca[Z+0],ra=3*ca[Z+1];ca=3*ca[Z+2];fa[0]=ea[ma+0];fa[1]=ea[ma+1];fa[2]=ea[ma+2];ja[0]=ea[ra+0];ja[1]=ea[ra+1];ja[2]=ea[ra+2];la[0]=ea[ca+0];la[1]=ea[ca+1];la[2]=ea[ca+2]};ia._calculateFaceNormal=function(ea,ca,Z,fa){this._getFaceVertices(ea,ca,Z,S,H,Q);f.subtract(H,H,S);f.subtract(Q,Q,S);f.cross(S,H,Q);f.normalize(fa,S);return fa};ia._getOrCreateComponents=function(ea){return g.unwrapOr(ea.components,X)};ia._createPositionBuffer=function(ea,
ca){let Z=ea.vertexAttributes.position;const fa=ca.reprojection===ba.ECEF?ca.transformBeforeProject:null;g.isSome(fa)&&(Z=t.transformPosition(Z,new Float64Array(Z.length),fa));if(ca.reprojection===ba.NONE)return ca.needsBufferCopy?new Float64Array(Z):Z;ca=g.isSome(fa)?Z:new Float64Array(Z.length);r.projectBuffer(Z,ea.spatialReference,0,ca,this._context.renderCoordsHelper.spatialReference,0,Z.length/3);return ca};ia._createNormalBuffer=function(ea,ca,Z){let fa=ea.vertexAttributes.normal;if(g.isNone(fa))return null;
var ja=Z.reprojection===ba.ECEF?Z.transformBeforeProject:null;g.isSome(ja)&&(fa=t.transformNormal(fa,new Float32Array(fa.length),ja));if("local"===this._context.graphicsCoreOwner.view.viewingMode||Z.reprojection===ba.NONE)return Z.needsBufferCopy&&ea.vertexAttributes.normal===fa?new Float32Array(fa):fa;Z=ea.vertexAttributes.position;ja=g.isSome(ja)?fa:new Float32Array(fa.length);return t.projectNormalToPCPF(fa,Z,ca,ea.spatialReference,ja)};ia._createTangentBuffer=function(ea,ca,Z){let fa=ea.vertexAttributes.tangent;
if(g.isNone(fa))return null;var ja=Z.reprojection===ba.ECEF?Z.transformBeforeProject:null;g.isSome(ja)&&(fa=t.transformTangent(fa,new Float32Array(fa.length),ja));if("local"===this._context.graphicsCoreOwner.view.viewingMode||Z.reprojection===ba.NONE)return Z.needsBufferCopy&&ea.vertexAttributes.normal===fa?new Float32Array(fa):fa;Z=ea.vertexAttributes.position;ja=g.isSome(ja)?fa:new Float32Array(fa.length);return t.projectTangentToPCPF(fa,Z,ca,ea.spatialReference,ja)};ia._createColorBuffer=function(ea){return ea.vertexAttributes.color};
ia._createSymbolColorBuffer=function(ea){if(this._requiresSymbolVertexColors()){ea=this._getVertexOpacityAndColor(ea);const ca=F.parseColorMixMode(g.get(this.symbolLayer,"material","colorMixMode")),Z=new Uint8Array(4);F.encodeSymbolColor(ea,ca,Z);return Z}return null};ia._createBuffers=function(ea,ca){var Z=ea.vertexAttributes&&ea.vertexAttributes.position;if(!Z)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;var fa=ea.vertexAttributes.normal;const ja=ea.vertexAttributes.uv;
var la=ea.vertexAttributes.tangent;if(g.isSome(fa)&&fa.length!==Z.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(g.isSome(la)&&la.length/4!==Z.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(g.isSome(ja)&&ja.length/2!==Z.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),
null;la=this._computeReprojectionInfo(ea);Z=this._createPositionBuffer(ea,la);fa=this._createColorBuffer(ea);ca=this._createSymbolColorBuffer(ca);const ma=this._createNormalBuffer(ea,Z,la),ra=this._createTangentBuffer(ea,Z,la);ea=la.reprojection===ba.NONE&&g.isSome(la.objectTransformation)?la.objectTransformation:this._transformOriginLocal(ea,Z,ma,ra);la=la.reprojection===ba.NONE&&g.isSome(la.geometryTransformation)?la.geometryTransformation:n.create();return{positionBuffer:Z,normalBuffer:ma,tangentBuffer:ra,
uvBuffer:ja,colorBuffer:fa,symbolColorBuffer:ca,objectTransformation:ea,geometryTransformation:la}};ia._computeReprojectionInfo=function(ea){var ca=g.isSome(ea.transform);const Z=ca&&ea.transform.geographic?ba.NONE:this._context.renderCoordsHelper.viewingMode===z.ViewingMode.Local?ba.NONE:ba.ECEF;if(ca){if(Z===ba.NONE)return ca=n.create(),r.computeTranslationToOriginAndRotation(ea.spatialReference,ea.transform.origin,ca,this._context.renderCoordsHelper.spatialReference),ea=n.clone(ea.transform.localMatrix),
{reprojection:Z,objectTransformation:ca,geometryTransformation:ea,needsBufferCopy:!1};ca=l.fromTranslation(n.create(),ea.transform.origin);l.multiply(ca,ca,ea.transform.localMatrix);return{reprojection:Z,transformBeforeProject:ca,needsBufferCopy:!0}}return{reprojection:Z,needsBufferCopy:!0}};ia._transformOriginLocal=function(ea,ca,Z,fa){const ja=this._context.renderCoordsHelper.spatialReference;var la=ea.anchor;T[0]=la.x;T[1]=la.y;T[2]=la.z;la=n.create();r.computeTranslationToOriginAndRotation(ea.spatialReference,
T,la,ja);ea=m.BufferViewVec3f64.fromTypedArray(ca);l.invert(V,la);u.transformMat4(ea,ea,V);if(g.isSome(Z)||g.isSome(fa))x.fromMat4(Y,la),x.transpose(Y,Y),g.isSome(Z)&&(Z=m.BufferViewVec3f.fromTypedArray(Z),u.transformMat3(Z,Z,Y)),g.isSome(fa)&&(fa=m.BufferViewVec3f.fromTypedArray(fa,4*fa.BYTES_PER_ELEMENT),u.transformMat3(fa,fa,Y));return la};ia._validateFaces=function(ea,ca){ea=ea.vertexAttributes.position.length/3;if(ca=ca.faces){let Z=-1;for(let fa=0;fa<ca.length;fa++){const ja=ca[fa];ja>Z&&(Z=
ja)}if(ea<=Z)return this.logger.warn(`Vertex index ${Z} is out of bounds of the mesh position buffer`),!1}else if(0!==ea%3)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0};ia._getOrCreateFaces=function(ea,ca){return ca.faces?ca.faces:O.generateDefaultIndexArray(ea.vertexAttributes.position.length/3)};ia._isOutsideClippingArea=function(ea){if(!this._context.clippingExtent)return!1;
var ca=ea.vertexAttributes&&ea.vertexAttributes.position;if(!ca)return!1;const Z=this._context.elevationProvider.spatialReference,fa=ca.length/3;ea.spatialReference.equals(Z)||(ca=new Float64Array(ca.length),r.projectBuffer(ea.vertexAttributes.position,ea.spatialReference,0,ca,Z,0,fa));y.empty(aa);y.expandWithBuffer(aa,ca,0,fa);return!y.intersectsClippingArea(aa,this._context.clippingExtent)};ia._createGeometryInfo=function(ea,ca){if(!r.canProjectWithoutEngine(ea.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),
null;if(this._isOutsideClippingArea(ea))return null;ca=this._createBuffers(ea,ca);if(g.isNone(ca))return null;const {positionBuffer:Z,uvBuffer:fa,colorBuffer:ja,symbolColorBuffer:la,normalBuffer:ma,tangentBuffer:ra,objectTransformation:va,geometryTransformation:ya}=ca;var za=this._getOrCreateComponents(ea);ca=[];const pa=[],wa=[];let na=!1;for(const ta of za){if(!this._validateFaces(ea,ta))return null;za=this._getOrCreateFaces(ea,ta);if(0===za.length)continue;var qa=this._createComponentNormals(Z,
ma,ta,za);qa.didFlipNormals&&(na=!0);const Fa=[[M.VertexAttribute.POSITION,{size:3,data:Z,exclusive:!0}],[M.VertexAttribute.NORMAL,{size:3,data:qa.normals,exclusive:!0}]];qa=[[M.VertexAttribute.POSITION,za],[M.VertexAttribute.NORMAL,qa.indices]];g.isSome(ja)&&(Fa.push([M.VertexAttribute.COLOR,{size:4,data:ja,exclusive:!0}]),qa.push([M.VertexAttribute.COLOR,za]));g.isSome(la)&&(Fa.push([M.VertexAttribute.SYMBOLCOLOR,{size:4,data:la,exclusive:!0}]),qa.push([M.VertexAttribute.SYMBOLCOLOR,new Uint16Array(za.length)]));
g.isSome(fa)&&(Fa.push([M.VertexAttribute.UV0,{size:2,data:fa,exclusive:!0}]),qa.push([M.VertexAttribute.UV0,za]));g.isSome(ra)&&(Fa.push([M.VertexAttribute.TANGENT,{size:4,data:ra,exclusive:!0}]),qa.push([M.VertexAttribute.TANGENT,za]));za=new I.Geometry(Fa,qa);ca.push(za);pa.push(ya);wa.push(this._getOrCreateMaterial(ea,ta))}na&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals.");
return{geometries:ca,transformations:pa,materials:wa,objectTransformation:va}};ia._createEdgeMaterial=function(){const ea={opacity:this._getLayerOpacity()};return D.createMaterial(this.symbolLayer,ea)};return ka}(C.Graphics3DSymbolLayer);const T=e.create(),S=e.create(),H=e.create(),Q=e.create(),W=e.create(),V=n.create(),Y=w.create(),aa=y.create(),X=[new p];var ba;(function(ha){ha[ha.NONE=0]="NONE";ha[ha.ECEF=1]="ECEF"})(ba||(ba={}));a.Graphics3DMeshFillSymbolLayer=d;a.default=d;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/geometry/support/MeshComponent":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/ensureType ./MeshMaterial ./MeshMaterialMetallicRoughness ./MeshVertexAttributes".split(" "),function(a,b,c,d,g,x,w,l,n,f,e,k){var r;
const y=g.getLogger("esri.geometry.support.MeshComponent");c=r=function(p){function h(u){u=p.call(this,u)||this;u.faces=null;u.material=null;u.shading="source";u.trustSourceNormals=!1;return u}a._inheritsLoose(h,p);h.from=function(u){return n.ensureClass(r,u)};var m=h.prototype;m.castFaces=function(u){return k.castArray(u,Uint32Array,[Uint16Array],{loggerTag:".faces\x3d",stride:3},y)};m.castMaterial=function(u){return u&&"object"===typeof u&&("metallic"in u||"roughness"in u||"metallicRoughnessTexture"in
u)?n.ensureClass(e,u):n.ensureClass(f,u)};m.clone=function(){return new r({faces:d.clone(this.faces),shading:this.shading,material:d.clone(this.material),trustSourceNormals:this.trustSourceNormals})};m.cloneWithDeduplication=function(u,t){u={faces:d.clone(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(u,t):null,trustSourceNormals:this.trustSourceNormals};return new r(u)};return h}(c.JSONSupport);b.__decorate([x.property({json:{write:!0}})],c.prototype,
"faces",void 0);b.__decorate([w.cast("faces")],c.prototype,"castFaces",null);b.__decorate([x.property({type:f,json:{write:!0}})],c.prototype,"material",void 0);b.__decorate([w.cast("material")],c.prototype,"castMaterial",null);b.__decorate([x.property({type:String,json:{write:!0}})],c.prototype,"shading",void 0);b.__decorate([x.property({type:Boolean})],c.prototype,"trustSourceNormals",void 0);return c=r=b.__decorate([l.subclass("esri.geometry.support.MeshComponent")],c)})},"esri/geometry/support/MeshMaterial":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Color ../../core/JSONSupport ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ./MeshTexture".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e){var k;d=k=function(r){function y(h){h=r.call(this,h)||this;h.color=null;h.colorTexture=null;h.normalTexture=null;h.alphaMode="auto";h.alphaCutoff=.5;h.doubleSided=!0;return h}a._inheritsLoose(y,r);var p=y.prototype;p.clone=function(){return this.cloneWithDeduplication(null,new Map)};p.cloneWithDeduplication=function(h,m){const u=g.isSome(h)?h.get(this):null;if(u)return u;m=new k(this.clonePropertiesWithDeduplication(m));g.isSome(h)&&h.set(this,m);return m};p.clonePropertiesWithDeduplication=
function(h){return{color:g.isSome(this.color)?this.color.clone():null,colorTexture:g.isSome(this.colorTexture)?this.colorTexture.cloneWithDeduplication(h):null,normalTexture:g.isSome(this.normalTexture)?this.normalTexture.cloneWithDeduplication(h):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided}};return y}(d.JSONSupport);b.__decorate([x.property({type:c,json:{write:!0}})],d.prototype,"color",void 0);b.__decorate([x.property({type:e,json:{write:!0}})],d.prototype,
"colorTexture",void 0);b.__decorate([x.property({type:e,json:{write:!0}})],d.prototype,"normalTexture",void 0);b.__decorate([x.property({nonNullable:!0,json:{write:!0}})],d.prototype,"alphaMode",void 0);b.__decorate([x.property({nonNullable:!0,json:{write:!0}})],d.prototype,"alphaCutoff",void 0);b.__decorate([x.property({nonNullable:!0,json:{write:!0}})],d.prototype,"doubleSided",void 0);return d=k=b.__decorate([f.subclass("esri.geometry.support.MeshMaterial")],d)})},"esri/geometry/support/MeshTexture":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../chunks/persistableUrlUtils ../../views/support/screenshotUtils".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k){var r;const y=new WeakMap;let p=0;c=r=function(h){function m(t){t=h.call(this,t)||this;t.wrap="repeat";return t}a._inheritsLoose(m,h);var u=m.prototype;u.writeData=function(t,q,z,v){t instanceof HTMLImageElement?(t={type:"image-element",src:e.toJSON(t.src,v),crossOrigin:t.crossOrigin},q[z]=t):t instanceof HTMLCanvasElement?(t=t.getContext("2d").getImageData(0,0,t.width,t.height),t={type:"canvas-element",imageData:this._encodeImageData(t)},q[z]=t):t instanceof HTMLVideoElement?
(t={type:"video-element",src:e.toJSON(t.src,v),autoplay:t.autoplay,loop:t.loop,muted:t.muted,crossOrigin:t.crossOrigin,preload:t.preload},q[z]=t):(t={type:"image-data",imageData:this._encodeImageData(t)},q[z]=t)};u.readData=function(t){switch(t.type){case "image-element":var q=new Image;q.src=t.src;q.crossOrigin=t.crossOrigin;return q;case "canvas-element":return t=this._decodeImageData(t.imageData),q=document.createElement("canvas"),q.width=t.width,q.height=t.height,q.getContext("2d").putImageData(t,
0,0),q;case "image-data":return this._decodeImageData(t.imageData);case "video-element":return q=document.createElement("video"),q.src=t.src,q.crossOrigin=t.crossOrigin,q.autoplay=t.autoplay,q.loop=t.loop,q.muted=t.muted,q.preload=t.preload,q}};u.clone=function(){const t={url:this.url,data:this.data,wrap:this._cloneWrap()};return new r(t)};u.cloneWithDeduplication=function(t){var q=t.get(this);if(q)return q;q=this.clone();t.set(this,q);return q};u._cloneWrap=function(){return"string"===typeof this.wrap?
this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}};u._encodeImageData=function(t){let q="";for(let z=0;z<t.data.length;z++)q+=String.fromCharCode(t.data[z]);return{data:btoa(q),width:t.width,height:t.height}};u._decodeImageData=function(t){const q=atob(t.data),z=new Uint8ClampedArray(q.length);for(let v=0;v<q.length;v++)z[v]=q.charCodeAt(v);return k.wrapImageData(z,t.width,t.height)};u._imageDataContainsTransparent=function(t){for(let q=3;q<t.data.length;q+=4)if(255!==t.data[q])return!0;
return!1};m.from=function(t){return"string"===typeof t?new r({url:t}):t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData||t instanceof HTMLVideoElement?new r({data:t}):w.ensureClass(r,t)};a._createClass(m,[{key:"url",get:function(){return this._get("url")||null},set:function(t){this._set("url",t);t&&this._set("data",null)}},{key:"data",get:function(){return this._get("data")||null},set:function(t){this._set("data",t);t&&this._set("url",null)}},{key:"transparent",
get:function(){var t=this.data,q=this.url;return t instanceof HTMLCanvasElement?this._imageDataContainsTransparent(t.getContext("2d").getImageData(0,0,t.width,t.height)):t instanceof ImageData?this._imageDataContainsTransparent(t):q&&(t=q.substr(q.length-4,4).toLowerCase(),q=q.substr(0,15).toLocaleLowerCase(),".png"===t||"data:image/png;"===q)?!0:!1},set:function(t){null!=t?this._override("transparent",t):this._clearOverride("transparent")}},{key:"contentHash",get:function(){const t="string"===typeof this.wrap?
this.wrap:"object"===typeof this.wrap?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",q=(z="")=>`d:${z},t:${this.transparent},w:${t}`;if(null!=this.url)return q(this.url);if(null!=this.data){if(this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement)return q(this.data.src);y.has(this.data)||y.set(this.data,++p);return q(y.get(this.data))}return q()}}]);return m}(d.JSONSupport);b.__decorate([g.property({type:String,json:{write:e.write}})],c.prototype,"url",null);b.__decorate([g.property({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),
g.property()],c.prototype,"data",null);b.__decorate([f.writer("data")],c.prototype,"writeData",null);b.__decorate([l.reader("data")],c.prototype,"readData",null);b.__decorate([g.property({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],c.prototype,"transparent",null);b.__decorate([g.property({json:{write:!0}})],c.prototype,"wrap",void 0);b.__decorate([g.property({readOnly:!0})],c.prototype,"contentHash",null);return c=r=b.__decorate([n.subclass("esri.geometry.support.MeshTexture")],
c)})},"esri/views/support/screenshotUtils":function(){define(["exports","../../core/has","../../core/mathUtils"],function(a,b,c){function d(h,m){const {format:u,quality:t,rotation:q,disableDecorations:z}=h||{};var v=n(h,m.padding);var B=m.width-v.left-v.right;m=m.height-v.top-v.bottom;v={x:0,y:0,width:B,height:m};if(h&&h.area){null!=h.area.x&&(v.x=Math.floor(h.area.x));null!=h.area.y&&(v.y=Math.floor(h.area.y));var A=null!=h.area.width?Math.floor(h.area.width):null,E=null!=h.area.height?Math.floor(h.area.height):
null;v.width=B-v.x;v.height=m-v.y;null!=A&&null!=E?(v.width=Math.min(v.width,A),v.height=Math.min(v.height,E)):null==A&&null!=E?(A=Math.min(v.width,A),v.height*=A/v.width,v.width=A):null!=A&&null==E&&(A=Math.min(v.height,E),v.width*=A/v.height,v.height=A)}v=l(v,h);A=Math.floor(Math.max(v.x,0));E=Math.floor(Math.max(v.y,0));B={x:A,y:E,width:Math.floor(Math.min(v.width,B-A)),height:Math.floor(Math.min(v.height,m-E))};m=B.width/B.height;v=v.width/v.height;v!==m&&(v>m?(m=Math.floor(B.width/v),B={x:B.x,
y:Math.floor(B.y+(B.height-m)/2),width:B.width,height:m}):(m=Math.floor(B.height*v),B={x:Math.floor(B.x+(B.width-m)/2),y:B.y,width:m,height:B.height}));const {width:C,height:D}=w(h,B);m=f(u);v=y[m];v=c.clamp(null!=t?t:v,0,100);return{format:m,quality:v,area:B,width:C,height:D,rotation:q,disableDecorations:!!z,ignoreBackground:!(!h||!h.ignoreBackground),ignorePadding:!(!h||!h.ignorePadding)}}function g(h,m){return h.toDataURL(r[m.format],m.quality/100)}function x(h,m,u){u||(e||(e=document.createElement("canvas"),
e.width=1,e.height=1),u=e);return u.getContext("2d").createImageData(h,m)}function w(h,m){if(!h)return m;const u=h.width;h=h.height;if(null!=u&&null!=h)return{width:Math.floor(u),height:Math.floor(h)};if(null==u&&null==h)return m;m=m.width/m.height;return null==h?{width:Math.floor(u),height:Math.floor(u/m)}:{width:Math.floor(h*m),height:Math.floor(h)}}function l(h,m){if(!m||null==m.width||null==m.height)return h;m=m.width/m.height;const u=h.width/h.height;if(u===m)return h;if(u<m)return m=Math.floor(h.height*
m),h.x-=(m-h.width)/2,h.width=m,h;m=Math.floor(h.width/m);h.y-=(m-h.height)/2;h.height=m;return h}function n(h,m){return!m||h&&h.ignorePadding?p:m}function f(h){switch(h){case "png":case "jpg":case "jpeg":return h;case null:case void 0:return"png";default:return"png"}}let e=null,k=!0;const r={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},y={png:100,jpg:98,jpeg:98},p={top:0,right:0,bottom:0,left:0};a.completeUserSettings=d;a.createEmptyImageData=function(h,m,u){if(!h||!m)throw Error("Cannot construct image data without dimensions");
if(k)try{return new ImageData(h,m)}catch(t){k=!1}return x(h,m,u)};a.encodeResult=function(h,m,u,t){if(t.premultipliedAlpha){{var q=h.data;const v=q.length;for(let B=0;B<v;B+=4){var z=q[B+3];0<z&&(z/=255,q[B+0]/=z,q[B+1]/=z,q[B+2]/=z)}}}u.width=h.width;u.height=h.height;q=u.getContext("2d");q.putImageData(h,0,0);t.flipY&&(q.save(),q.globalCompositeOperation="copy",q.scale(1,-1),q.translate(0,-q.canvas.height),q.drawImage(q.canvas,0,0),q.restore());h=q.getImageData(0,0,h.width,h.height);m=g(u,m);u.width=
0;u.height=0;return{dataUrl:m,data:h}};a.getFormatAndQuality=function(h,m){h=f(h);const u=y[h];m=c.clamp(null!=m?m:u,0,100);return{format:h,quality:m}};a.getMaximumResolutionScale=function(h,m){return m/Math.max(h[0],h[1])};a.resampleHermite=function(h,m,u,t=0,q=0,z=h.width-t,v=h.height-q,B=!1){const {data:A}=h,{width:E,height:C,data:D}=m;z/=E;v/=C;const F=Math.ceil(z/2),G=Math.ceil(v/2);h=h.width;for(let O=0;O<C;O++)for(let P=0;P<E;P++){const K=4*(P+(B?C-O-1:O)*E);let M=0,U=0,R=0,L=0,N=0,T=0;const S=
(O+.5)*v;for(let H=Math.floor(O*v);H<(O+1)*v;H++){var J=Math.abs(S-(H+.5))/G;const Q=(P+.5)*z;J*=J;for(let W=Math.floor(P*z);W<(P+1)*z;W++){var I=Math.abs(Q-(W+.5))/F;I=Math.sqrt(J+I*I);if(1<=I)continue;I=2*I*I*I-3*I*I+1;const V=4*(t+W+(q+H)*h);T+=I*A[V+3];U+=I;!u&&255>A[V+3]&&(I=I*A[V+3]/255);R+=I*A[V];L+=I*A[V+1];N+=I*A[V+2];M+=I}}D[K]=R/M;D[K+1]=L/M;D[K+2]=N/M;D[K+3]=T/U}return m};a.screenshotSuperSampleSettings=function(h,m,u){if(!m)return h;const {framebufferWidth:t,framebufferHeight:q,pixelRatio:z,
region:v}=h;m=n(h,u);u=m.left+m.right;const B=m.top+m.bottom,A=t-u,E=q-B,C=Math.min(8,Math.min((2048-u)/A,(2048-B)/E));return 1.5>C?h:{...h,framebufferWidth:Math.round(A*C)+u,framebufferHeight:Math.round(E*C)+B,pixelRatio:z*C,resample:{region:{x:Math.round((v.x-m.left)*C)+m.left,y:Math.round((v.y-m.top)*C)+m.top,width:Math.round(v.width*C),height:Math.round(v.height*C)},width:t,height:q}}};a.toDataUrl=g;a.toRenderSettings=function(h,m){const u=d(h,m),t=u.area,q=u.width/t.width,z=n(u,m.padding),v=
z.left+z.right,B=z.top+z.bottom;return{framebufferWidth:Math.floor((m.width-v)*q+v),framebufferHeight:Math.floor((m.height-B)*q+B),region:{x:Math.floor(t.x*q)+z.left,y:Math.floor(t.y*q)+z.top,width:u.width,height:u.height},format:u.format,quality:u.quality,rotation:u.rotation,pixelRatio:q,layers:h&&h.layers?h.layers:[],disableDecorations:u.disableDecorations,ignoreBackground:u.ignoreBackground,ignorePadding:u.ignorePadding}};a.wrapImageData=function(h,m,u,t){if(!m||!u)throw Error("Cannot construct image data without dimensions");
if(k)try{return new ImageData(h,m,u)}catch(q){k=!1}m=x(m,u,t);m.data.set(h,0);return m};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/MeshMaterialMetallicRoughness":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Color ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ./MeshMaterial ./MeshTexture".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e){var k;x=k=function(r){function y(h){h=r.call(this,h)||this;h.emissiveColor=null;h.emissiveTexture=null;h.occlusionTexture=null;h.metallic=1;h.roughness=1;h.metallicRoughnessTexture=null;return h}a._inheritsLoose(y,r);var p=y.prototype;p.clone=function(){return this.cloneWithDeduplication(null,new Map)};p.cloneWithDeduplication=function(h,m){const u=d.isSome(h)?h.get(this):null;if(u)return u;m=new k(this.clonePropertiesWithDeduplication(m));d.isSome(h)&&h.set(this,m);
return m};p.clonePropertiesWithDeduplication=function(h){return{...r.prototype.clonePropertiesWithDeduplication.call(this,h),emissiveColor:d.isSome(this.emissiveColor)?this.emissiveColor.clone():null,emissiveTexture:d.isSome(this.emissiveTexture)?this.emissiveTexture.cloneWithDeduplication(h):null,occlusionTexture:d.isSome(this.occlusionTexture)?this.occlusionTexture.cloneWithDeduplication(h):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:d.isSome(this.metallicRoughnessTexture)?
this.metallicRoughnessTexture.cloneWithDeduplication(h):null}};return y}(f);b.__decorate([g.property({type:c,json:{write:!0}})],x.prototype,"emissiveColor",void 0);b.__decorate([g.property({type:e,json:{write:!0}})],x.prototype,"emissiveTexture",void 0);b.__decorate([g.property({type:e,json:{write:!0}})],x.prototype,"occlusionTexture",void 0);b.__decorate([g.property({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],x.prototype,"metallic",void 0);b.__decorate([g.property({type:Number,
nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],x.prototype,"roughness",void 0);b.__decorate([g.property({type:e,json:{write:!0}})],x.prototype,"metallicRoughnessTexture",void 0);return x=k=b.__decorate([n.subclass("esri.geometry.support.MeshMaterialMetallicRoughness")],x)})},"esri/geometry/support/MeshVertexAttributes":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,d,g,x,w,l,n){function f(p,h,m,u){const {loggerTag:t,stride:q}=h;return 0!==p.length%q?(u.error(t,`Invalid array length, expected a multiple of ${q}`),new m([])):p}function e(p,h,m,u,t){if(!p)return p;if(p instanceof h)return f(p,u,h,t);for(const q of m)if(p instanceof q)return f(new h(p),u,h,t);if(Array.isArray(p))return f(new h(p),u,h,t);m=m.map(q=>`'${q.name}'`);t.error(`Failed to set property, expected one of ${m}, but got ${p.constructor.name}`);return new h([])}function k(p,h,
m){{const u=Array(p.length);for(let t=0;t<p.length;t++)u[t]=p[t];p=u}h[m]=p}var r;const y=x.getLogger("esri.geometry.support.MeshVertexAttributes");a.MeshVertexAttributes=r=function(p){function h(u){u=p.call(this,u)||this;u.color=null;u.position=new Float64Array(0);u.uv=null;u.normal=null;u.tangent=null;return u}b._inheritsLoose(h,p);var m=h.prototype;m.castColor=function(u){return e(u,Uint8Array,[Uint8ClampedArray],{loggerTag:".color\x3d",stride:4},y)};m.castPosition=function(u){u&&u instanceof Float32Array&&
y.warn(".position\x3d","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array");return e(u,Float64Array,[Float32Array],{loggerTag:".position\x3d",stride:3},y)};m.castUv=function(u){return e(u,Float32Array,[Float64Array],{loggerTag:".uv\x3d",stride:2},y)};m.castNormal=function(u){return e(u,Float32Array,[Float64Array],{loggerTag:".normal\x3d",stride:3},y)};m.castTangent=function(u){return e(u,Float32Array,[Float64Array],
{loggerTag:".tangent\x3d",stride:4},y)};m.clone=function(){const u={position:g.clone(this.position),uv:g.clone(this.uv),normal:g.clone(this.normal),tangent:g.clone(this.tangent),color:g.clone(this.color)};return new r(u)};m.clonePositional=function(){const u={position:g.clone(this.position),normal:g.clone(this.normal),tangent:g.clone(this.tangent),uv:this.uv,color:this.color};return new r(u)};return h}(d.JSONSupport);c.__decorate([w.property({json:{write:k}})],a.MeshVertexAttributes.prototype,"color",
void 0);c.__decorate([l.cast("color")],a.MeshVertexAttributes.prototype,"castColor",null);c.__decorate([w.property({nonNullable:!0,json:{write:k}})],a.MeshVertexAttributes.prototype,"position",void 0);c.__decorate([l.cast("position")],a.MeshVertexAttributes.prototype,"castPosition",null);c.__decorate([w.property({json:{write:k}})],a.MeshVertexAttributes.prototype,"uv",void 0);c.__decorate([l.cast("uv")],a.MeshVertexAttributes.prototype,"castUv",null);c.__decorate([w.property({json:{write:k}})],a.MeshVertexAttributes.prototype,
"normal",void 0);c.__decorate([l.cast("normal")],a.MeshVertexAttributes.prototype,"castNormal",null);c.__decorate([w.property({json:{write:k}})],a.MeshVertexAttributes.prototype,"tangent",void 0);c.__decorate([l.cast("tangent")],a.MeshVertexAttributes.prototype,"castTangent",null);a.MeshVertexAttributes=r=c.__decorate([n.subclass("esri.geometry.support.MeshVertexAttributes")],a.MeshVertexAttributes);a.castArray=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/meshUtils/projection":function(){define("exports ../../../core/Logger ../../../core/maybe ../../../chunks/mat3 ../../../chunks/mat3f64 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../projection ../../projectionEllipsoid ../spatialReferenceUtils ../webMercatorUtils ../buffer/BufferView ../../../chunks/vec32".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y){function p(A,E,C,D,F,G){if(E){var J=C.count,I=f.getSphericalPCPF(F);if(m(F))for(C=0;C<J;C++)D.getVec(C,q),E.getVec(C,z),n.computeTranslationToOriginAndRotation(I,q,v,I),d.fromMat4(B,v),A===t.FROM_PCPF&&d.transpose(B,B),w.transformMat3(z,z,B),G.setVec(C,z);else for(F=0;F<J;F++){D.getVec(F,q);E.getVec(F,z);n.computeTranslationToOriginAndRotation(I,q,v,I);d.fromMat4(B,v);var O=k.y2lat(C.get(F,1));O=Math.cos(O);A===t.TO_PCPF&&(O=1/O);B[0]*=O;B[1]*=O;B[2]*=O;B[3]*=
O;B[4]*=O;B[5]*=O;A===t.FROM_PCPF&&d.transpose(B,B);w.transformMat3(z,z,B);w.normalize(z,z);G.setVec(F,z)}return G}}function h(A){return m(A)||A.isWebMercator}function m(A){return A.isWGS84||e.isCGCS2000(A)||e.isMars(A)||e.isMoon(A)}const u=b.getLogger("esri.geometry.support.meshUtils.normalProjection");var t;(function(A){A[A.TO_PCPF=0]="TO_PCPF";A[A.FROM_PCPF=1]="FROM_PCPF"})(t||(t={}));const q=l.create(),z=l.create(),v=x.create(),B=g.create();a.projectFromPCPF=function(A,E,C){n.projectBuffer(A,
f.getSphericalPCPF(C),0,E,C,0,A.length/3);return E};a.projectNormalFromPCPF=function(A,E,C,D,F){if(!h(D))return u.error("Cannot convert to spatial reference from PCPF"),F;p(t.FROM_PCPF,r.BufferViewVec3f.fromTypedArray(A),r.BufferViewVec3f64.fromTypedArray(E),r.BufferViewVec3f64.fromTypedArray(C),D,r.BufferViewVec3f.fromTypedArray(F));return F};a.projectNormalToPCPF=function(A,E,C,D,F){if(!h(D))return u.error("Cannot convert spatial reference to PCPF"),F;p(t.TO_PCPF,r.BufferViewVec3f.fromTypedArray(A),
r.BufferViewVec3f64.fromTypedArray(E),r.BufferViewVec3f64.fromTypedArray(C),D,r.BufferViewVec3f.fromTypedArray(F));return F};a.projectTangentFromPCPF=function(A,E,C,D,F){if(!h(D))return u.error("Cannot convert to spatial reference from PCPF"),F;p(t.FROM_PCPF,r.BufferViewVec3f.fromTypedArray(A,16),r.BufferViewVec3f64.fromTypedArray(E),r.BufferViewVec3f64.fromTypedArray(C),D,r.BufferViewVec3f.fromTypedArray(F,16));for(E=3;E<A.length;E+=4)F[E]=A[E];return F};a.projectTangentToPCPF=function(A,E,C,D,F){if(!h(D))return u.error("Cannot convert spatial reference to PCPF"),
F;p(t.TO_PCPF,r.BufferViewVec3f.fromTypedArray(A,4*Float32Array.BYTES_PER_ELEMENT),r.BufferViewVec3f64.fromTypedArray(E),r.BufferViewVec3f64.fromTypedArray(C),D,r.BufferViewVec3f.fromTypedArray(F,4*Float32Array.BYTES_PER_ELEMENT));for(E=3;E<A.length;E+=4)F[E]=A[E];return F};a.projectToPCPF=function(A,E,C){n.projectBuffer(A,E,0,C,f.getSphericalPCPF(E),0,A.length/3);return C};a.transformNormal=function(A,E,C){if(c.isNone(A))return E;d.normalFromMat4(B,C);A=r.BufferViewVec3f.fromTypedArray(A);C=r.BufferViewVec3f.fromTypedArray(E);
y.transformMat3(C,A,B);d.isOrthoNormal(B)||y.normalize(C,C);return E};a.transformPosition=function(A,E,C){if(c.isNone(A))return E;A=r.BufferViewVec3f64.fromTypedArray(A);const D=r.BufferViewVec3f64.fromTypedArray(E);y.transformMat4(D,A,C);return E};a.transformTangent=function(A,E,C){if(c.isNone(A))return E;d.normalFromMat4(B,C);C=r.BufferViewVec3f.fromTypedArray(A,4*Float32Array.BYTES_PER_ELEMENT);const D=r.BufferViewVec3f.fromTypedArray(E,4*Float32Array.BYTES_PER_ELEMENT);y.transformMat3(D,C,B);
d.isOrthoNormal(B)||y.normalize(D,D);if(A!==E)for(C=3;C<A.length;C+=4)E[C]=A[C];return E};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/NativeLineMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Logger ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/frustum ../../../../geometry/support/lineSegment ../../../../geometry/support/plane ../../../../geometry/support/buffer/BufferView ../core/shaderLibrary/ShaderOutputOptions ../lib/geometryDataUtils ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/Util ../lib/VertexAttribute ./internal/bufferWriterUtils ./internal/DefaultBufferWriter ./internal/MaterialUtil ./renderers/utils ../shaders/NativeLineTechnique".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A){const E=c.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");var C;(function(aa){aa[aa.START=0]="START";aa[aa.END=1]="END"})(C||(C={}));c=function(aa){function X(ha){ha=aa.call(this,ha,G)||this;ha._techniqueConfig=new A.NativeLineTechniqueConfiguration;return ha}b._inheritsLoose(X,aa);var ba=X.prototype;ba.getTechniqueConfig=function(ha,ka){this._techniqueConfig.output=ha;this._techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled;
this._techniqueConfig.vertexColors=this.parameters.vertexColors;this._techniqueConfig.transparent=1>this.parameters.color[3]||1>this.parameters.width;this._techniqueConfig.draped=ka.slot===m.RenderSlot.DRAPED_MATERIAL;ha=d.isSome(this.parameters.stipplePattern);this._techniqueConfig.stippleEnabled=ha;this._techniqueConfig.stippleOffColorEnabled=ha&&d.isSome(this.parameters.stippleOffColor);this._techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees;this._techniqueConfig.stipplePreferContinuous=
this.parameters.stipplePreferContinuous;return this._techniqueConfig};ba.getPassParameters=function(){return this.parameters};ba.intersect=function(ha,ka,ia,ea,ca,Z,fa,ja,la){d.isSome(la)?v.intersectDrapedRenderLineGeometry(ha,ea,la,Z,1,fa):this._intersectLineGeometry(ha,ka,ia,ea,fa)};ba._intersectLineGeometry=function(ha,ka,ia,ea,ca){if(ea.options.selectionMode&&!B.isInstanceHidden(ka))if(u.isTranslationMatrix(ia)){var Z=ha.vertexAttributes.get(t.VertexAttribute.POSITION).data,fa=ea.camera,ja=T;
x.copy(ja,ea.point);w.set(S[0],ja[0]-2,ja[1]+2,0);w.set(S[1],ja[0]+2,ja[1]+2,0);w.set(S[2],ja[0]+2,ja[1]-2,0);w.set(S[3],ja[0]-2,ja[1]-2,0);for(ha=0;4>ha;ha++)if(!fa.unprojectFromRenderScreen(S[ha],H[ha]))return;e.fromPoints(fa.eye,H[0],H[1],Q);e.fromPoints(fa.eye,H[1],H[2],W);e.fromPoints(fa.eye,H[2],H[3],V);e.fromPoints(fa.eye,H[3],H[0],Y);ka=Number.MAX_VALUE;ha=0;for(let ma=0;ma<Z.length-5;ma+=3)if(J[0]=Z[ma]+ia[12],J[1]=Z[ma+1]+ia[13],J[2]=Z[ma+2]+ia[14],I[0]=Z[ma+3]+ia[12],I[1]=Z[ma+4]+ia[13],
I[2]=Z[ma+5]+ia[14],!(0>e.signedDistance(Q,J)&&0>e.signedDistance(Q,I)||0>e.signedDistance(W,J)&&0>e.signedDistance(W,I)||0>e.signedDistance(V,J)&&0>e.signedDistance(V,I)||0>e.signedDistance(Y,J)&&0>e.signedDistance(Y,I))){fa.projectToRenderScreen(J,K);fa.projectToRenderScreen(I,M);if(0>K[2]&&0<M[2]){w.subtract(O,J,I);var la=fa.frustum;la=-e.signedDistance(la[n.PlaneIndex.NEAR],J)/w.dot(O,e.normal(la[n.PlaneIndex.NEAR]));w.scale(O,O,la);w.add(J,J,O);fa.projectToRenderScreen(J,K)}else if(0<K[2]&&0>
M[2])w.subtract(O,I,J),la=fa.frustum,la=-e.signedDistance(la[n.PlaneIndex.NEAR],I)/w.dot(O,e.normal(la[n.PlaneIndex.NEAR])),w.scale(O,O,la),w.add(I,I,O),fa.projectToRenderScreen(I,M);else if(0>K[2]&&0>M[2])continue;K[2]=0;M[2]=0;la=f.distance2(f.fromPoints(K,M,L),ja);la<ka&&(ka=la,w.copy(U,J),w.copy(R,I),ha=ma/3)}ia=ea.rayBegin;ea=ea.rayEnd;4>ka&&(ka=Number.MAX_VALUE,f.closestLineSegmentPoint(f.fromPoints(U,R,L),f.fromPoints(ia,ea,N),P)&&(w.subtract(P,P,ia),ka=w.length(P),w.scale(P,P,1/ka),ka/=w.distance(ia,
ea)),ca(ka,P,ha,!1))}else E.error("intersection assumes a translation-only matrix")};ba.computeAttachmentOrigin=function(ha,ka){ha=ha.vertexAttributes;if(!ha)return!1;ha=ha.get(t.VertexAttribute.POSITION);return y.computeAttachmentOriginLines(ha,null,!1,ka)};ba.requiresSlot=function(ha){return ha===m.RenderSlot.OPAQUE_MATERIAL||ha===m.RenderSlot.DRAPED_MATERIAL};ba.createGLMaterial=function(ha){return ha.output===r.ShaderOutput.Color||ha.output===r.ShaderOutput.Highlight?new D(ha):null};ba.createBufferWriter=
function(){const ha=this.parameters.vertexColors?z.PositionColorLayout:z.PositionLayout;return d.isNone(this.parameters.stipplePattern)?new z.DefaultBufferWriter(ha):new F(ha.clone().vec3f(t.VertexAttribute.AUXPOS1).vec2f(t.VertexAttribute.UV0))};return X}(h.Material);let D=function(aa){function X(){return aa.apply(this,arguments)||this}b._inheritsLoose(X,aa);var ba=X.prototype;ba.updateParameters=function(ha){return this.ensureTechnique(A.NativeLineTechnique,ha)};ba._updateOccludeeState=function(ha){ha.hasOccludees!==
this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:ha.hasOccludees})};ba.beginSlot=function(ha){this._output===r.ShaderOutput.Color&&this._updateOccludeeState(ha);return this.updateParameters(ha)};ba.bind=function(ha,ka){ka.bindPass(this._material.getPassParameters(),ha)};return X}(p),F=function(){function aa(ba){this.vertexBufferLayout=ba}var X=aa.prototype;X.allocate=function(ba){return this.vertexBufferLayout.createBuffer(ba)};X.elementCount=function(ba){return ba.indices.get(t.VertexAttribute.POSITION).length};
X.write=function(ba,ha,ka,ia){q.writeDefaultAttributes(ha,this.vertexBufferLayout,ba.transformation,ba.invTranspTransformation,ka,ia);this._writeAuxpos1(ba,ha,ka,ia);this._writeUV0(ba,ha,ka,ia)};X._writeAuxpos1=function(ba,ha,ka,ia){var ea=ka.getField(t.VertexAttribute.AUXPOS1,k.BufferViewVec3f);ka=ha.indices.get(t.VertexAttribute.POSITION);ha=ha.vertexAttributes.get(t.VertexAttribute.POSITION).data;ba=ba.transformation;const ca=ea.typedBufferStride;ea=ea.typedBuffer;ia*=ca;for(let fa=0;fa<ka.length-
1;fa+=2)for(const ja of[1,0]){var Z=3*ka[fa+ja];const la=ha[Z],ma=ha[Z+1];Z=ha[Z+2];const ra=ba[1]*la+ba[5]*ma+ba[9]*Z+ba[13],va=ba[2]*la+ba[6]*ma+ba[10]*Z+ba[14];ea[ia]=ba[0]*la+ba[4]*ma+ba[8]*Z+ba[12];ea[ia+1]=ra;ea[ia+2]=va;ia+=ca}};X._writeUV0=function(ba,ha,ka,ia){var ea,ca=ka.getField(t.VertexAttribute.UV0,k.BufferViewVec2f),Z=ha.indices.get(t.VertexAttribute.POSITION);ka=ha.vertexAttributes.get(t.VertexAttribute.POSITION).data;const fa=null==(ea=ha.vertexAttributes.get(t.VertexAttribute.DISTANCETOSTART))?
void 0:ea.data;ba=ba.transformation;ha=ca.typedBufferStride;ca=ca.typedBuffer;ia*=ha;let ja=0;ca[ia]=C.START;ca[ia+1]=ja;ia+=ha;ea=3*Z[0];ea=w.set(J,ka[ea],ka[ea+1],ka[ea+2]);ba&&w.transformMat4(ea,ea,ba);const la=I,ma=Z.length-1;let ra=1;const va=fa?(za,pa,wa)=>ja=fa[wa]:(za,pa,wa)=>ja+=w.distance(za,pa);for(let za=1;za<ma;za+=2){var ya=3*Z[za];w.set(la,ka[ya],ka[ya+1],ka[ya+2]);ba&&w.transformMat4(la,la,ba);va(ea,la,ra++);for(ya=0;2>ya;++ya)ca[ia]=1-ya,ca[ia+1]=ja,ia+=ha;w.copy(ea,la)}Z=3*Z[ma];
w.set(la,ka[Z],ka[Z+1],ka[Z+2]);ba&&w.transformMat4(la,la,ba);va(ea,la,ra);ca[ia]=C.END;ca[ia+1]=ja};return aa}();const G={color:[1,1,1,1],vertexColors:!1,slicePlaneEnabled:!1,width:1,stipplePattern:null,stippleOffColor:null,stipplePreferContinuous:!0,sceneHasOcludees:!1,...h.DefaultMaterialParameters},J=l.create(),I=l.create(),O=l.create(),P=l.create(),K=g.createRenderScreenPointArray3(),M=g.createRenderScreenPointArray3(),U=l.create(),R=l.create(),L=f.create(),N=f.create(),T=l.create(),S=[g.createRenderScreenPointArray3(),
g.createRenderScreenPointArray3(),g.createRenderScreenPointArray3(),g.createRenderScreenPointArray3()],H=[l.create(),l.create(),l.create(),l.create()],Q=e.create(),W=e.create(),V=e.create(),Y=e.create();a.NativeLineMaterial=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/NativeLineTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/Program ../lib/StencilUtils ../../../../chunks/NativeLine.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u){e=function(t){function q(v,B,A){B=t.call(this,v,B,A)||this;B.stipplePattern=null;B.stippleTextureBind=null;B.stippleTextureRepository=v.stippleTextureRepository;return B}c._inheritsLoose(q,t);var z=q.prototype;z.initializeProgram=function(v){var B=q.shader.get();const A=this.configuration;B=B.build({output:A.output,attributeColor:A.vertexColors,slicePlaneEnabled:A.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,draped:A.draped,
stippleEnabled:this.stippleEnabled,stippleOffColorEnabled:A.stippleOffColorEnabled,stippleRequiresClamp:!1,stippleScaleWithLineWidth:!1,stipplePreferContinuous:A.stipplePreferContinuous});return new y.Program(v.rctx,B,r.Default3D)};z.destroy=function(){t.prototype.destroy.call(this);this.stippleTextureRepository.release(this.stipplePattern);this.stippleTextureBind=this.stipplePattern=null};z.bindPass=function(v,B){n.bindProjectionMatrix(this.program,B.camera.projectionMatrix);if(this.stipplePattern!==
v.stipplePattern){const A=v.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,A);this.stipplePattern=A}if(this.stippleEnabled){const {pixelSize:A,sdfNormalizer:E,pixels:C}=g.isSome(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1};this.program.setUniform1f("stipplePatternSDFNormalizer",E);this.program.setUniform1f("stipplePatternTextureSize",C);this.program.setUniform1f("stipplePatternPixelSize",A);this.program.setUniform1f("stipplePatternPixelSizeInv",
1/A);this.program.setUniform1f("pixelRatio",B.camera.pixelRatio);this.configuration.draped?this.program.setUniform1f("worldToScreenRatio",1/B.screenToPCSRatio):this.program.setUniform1f("worldToScreenPerDistanceRatio",1/B.camera.perScreenPixelRatio);this.program.setUniform2f("ndcToPixel",B.camera.fullViewport[2]/2,B.camera.fullViewport[3]/2)}this.program.setUniform4fv("constantColor",v.color);this.program.setUniform1f("alphaCoverage",Math.min(1,v.width*B.camera.pixelRatio));this.configuration.stippleOffColorEnabled&&
(v=g.unwrap(v.stippleOffColor),this.program.setUniform4f("stippleOffColor",v[0],v[1],v[2],3<v.length?v[3]:1));this.configuration.output===x.ShaderOutput.Highlight&&l.bindOutputHighlight(this.program,B)};z.bindDraw=function(v){n.bindView(this.program,v);this.stippleEnabled&&!this.configuration.draped&&n.bindCameraPosition(this.program,v.origin,v.camera.viewInverseTransposeMatrix);w.bindSliceUniformsWithOrigin(this.program,this.configuration,v);this.program.rebindTextures()};z.initializePipeline=function(){const v=
this.configuration,B=u.separateBlendingParams(m.BlendFactor.SRC_ALPHA,m.BlendFactor.ONE,m.BlendFactor.ONE_MINUS_SRC_ALPHA,m.BlendFactor.ONE_MINUS_SRC_ALPHA),A=(E,C=null,D=null)=>u.makePipelineState({blending:C,depthTest:p.depthCompareLess,depthWrite:D,colorWrite:u.defaultColorWriteParams,stencilWrite:v.sceneHasOcludees?p.stencilWriteMaskOn:null,stencilTest:v.sceneHasOcludees?E?p.stencilToolMaskBaseParams:p.stencilBaseAllZerosParams:null});return v.output===x.ShaderOutput.Color?(this._occludeePipelineState=
A(!0,v.transparent||this.stippleEnabled?B:null,u.defaultDepthWriteParams),A(!1,v.transparent||this.stippleEnabled?B:null,u.defaultDepthWriteParams)):A(!1)};z.getPipelineState=function(v,B){return B?this._occludeePipelineState:t.prototype.getPipelineState.call(this,v,B)};c._createClass(q,[{key:"stippleEnabled",get:function(){return this.configuration.stippleEnabled&&this.configuration.output!==x.ShaderOutput.Highlight}},{key:"primitiveType",get:function(){return m.PrimitiveType.LINES}}]);return q}(e.ShaderTechnique);
e.shader=new f.ReloadableShaderModule(h.NativeLineShader,()=>new Promise((t,q)=>a(["./NativeLine.glsl"],t,q)));f=function(t){function q(){var z=t.apply(this,arguments)||this;z.output=x.ShaderOutput.Color;z.slicePlaneEnabled=!1;z.vertexColors=!1;z.transparent=!1;z.draped=!1;z.stippleEnabled=!1;z.stippleOffColorEnabled=!1;z.stipplePreferContinuous=!0;z.sceneHasOcludees=!1;return z}c._inheritsLoose(q,t);return q}(k.ShaderTechniqueConfiguration);d.__decorate([k.parameter({count:x.ShaderOutput.COUNT})],
f.prototype,"output",void 0);d.__decorate([k.parameter()],f.prototype,"slicePlaneEnabled",void 0);d.__decorate([k.parameter()],f.prototype,"vertexColors",void 0);d.__decorate([k.parameter()],f.prototype,"transparent",void 0);d.__decorate([k.parameter()],f.prototype,"draped",void 0);d.__decorate([k.parameter()],f.prototype,"stippleEnabled",void 0);d.__decorate([k.parameter()],f.prototype,"stippleOffColorEnabled",void 0);d.__decorate([k.parameter()],f.prototype,"stipplePreferContinuous",void 0);d.__decorate([k.parameter()],
f.prototype,"sceneHasOcludees",void 0);b.NativeLineTechnique=e;b.NativeLineTechniqueConfiguration=f;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/NativeLine.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e){function k(y){const p=new f.ShaderBuilder;p.include(d.Transform,{linearDepth:!1});p.include(g.VertexColor,y);p.include(w.LineStipple,{...y,stippleRequiresStretchMeasure:!1});p.vertex.uniforms.add("proj","mat4").add("view","mat4");y.stippleEnabled&&(p.vertex.uniforms.add("ndcToPixel","vec2"),p.attributes.add(e.VertexAttribute.UV0,"vec2"),p.attributes.add(e.VertexAttribute.AUXPOS1,"vec3"));p.attributes.add(e.VertexAttribute.POSITION,"vec3");p.varyings.add("vpos","vec3");
p.vertex.code.add(n.glsl`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`);y.stippleEnabled&&(p.vertex.code.add(n.glsl`vec4 vpos2 = transformPosition(proj, view, auxpos1);
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),y.draped||p.vertex.code.add(n.glsl`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),p.vertex.code.add(n.glsl`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),y.draped?p.vertex.code.add(n.glsl`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`):p.vertex.code.add(n.glsl`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),p.vertex.code.add(n.glsl`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`));p.vertex.code.add(n.glsl`}`);y.output===b.ShaderOutput.Highlight&&p.include(x.OutputHighlight);p.include(c.Slice,y);p.fragment.uniforms.add("constantColor","vec4").add("alphaCoverage","float");p.fragment.code.add(n.glsl`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${y.attributeColor?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    if (finalColor.a < ${n.glsl.float(l.symbolAlphaCutoff)}) {
      discard;
    }

    ${y.output===b.ShaderOutput.Color?n.glsl`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${y.output===b.ShaderOutput.Highlight?n.glsl`outputHighlight();`:""}
  }
  `);return p}const r=Object.freeze({__proto__:null,build:k});a.NativeLineShader=r;a.build=k})},"esri/views/3d/layers/graphics/Graphics3DObjectSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../symbols/support/ObjectSymbol3DLayerResource ../../../../symbols/support/symbolLayerUtils3D ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DLodInstanceGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ./Loadable ./lodResourceUtils ./objectResourceUtils ./pointUtils ./primitiveObjectSymbolUtils ./symbolComplexity ../support/FastSymbolUpdates ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/lib/lodRendering/LodRenderer ../../webgl-engine/lib/lodRendering/LodResources ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E,C,D,F,G,J,I,O,P){t=function(N){function T(H,Q,W,V){H=N.call(this,H,Q,W,V)||this;H._resources=null;H._optionalFields=[];H._instanceIndexToGraphicUid=new Map;H.hasLoadedPBRTextures=!1;H.ensureDrapedStatus(!1);H.hasLoadedPBRTextures=W.physicalBasedRenderingEnabled;return H}b._inheritsLoose(T,N);var S=T.prototype;S.getCachedSize=function(){const [H,Q,W]=d.isSome(this._resources)?this._resources.symbolSize:[1,1,1];return{width:H,depth:Q,height:W}};
S.doLoad=function(){var H=b._asyncToGenerator(function*(Q){if(!this._drivenProperties.size&&q.validateSymbolLayerSize(this.symbolLayer))throw Error();const W=this.symbolLayer;this._resources=this.isPrimitive?yield this._createResourcesForPrimitive(W.resource?W.resource.primitive:r.defaultPrimitive,Q):yield this._createResourcesForUrl(W.resource.href,Q);this.layerOpacityChanged();this.slicePlaneEnabledChanged();this.physicalBasedRenderingChanged();this.complexity=this.computeComplexity()});return function(Q){return H.apply(this,
arguments)}}();S._setMaterialTransparencyParams=function(H,Q=d.get(this.symbolLayer,"material","color")){Q=this._getCombinedOpacity(Q);const W=1>Q||this.needsDrivenTransparentPass;H.transparent=W;H.opacity=Q;H.cullFace=W?G.CullFaceOptions.None:G.CullFaceOptions.Back;return H};S._createResourcesForPrimitive=function(){var H=b._asyncToGenerator(function*(Q,W){if(!C.isValidPrimitive(Q))throw Error(`Unknown object symbol primitive: ${Q}`);var V=this.symbolLayer;const Y=k.create(y.objectSymbolLayerPrimitiveBoundingBox(Q)),
aa=n.fromArray(k.size(Y)),X=n.fromArray(y.objectSymbolLayerSizeWithResourceSize(aa,V)),ba=l.length(X);var ha={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,instanced:["transformation"],ambient:n.ONES,diffuse:n.ONES,slicePlaneEnabled:this._context.slicePlaneEnabled,sliceHighlightDisabled:!0,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive};const ka=ha.usePBR;this._setMaterialTransparencyParams(ha);const ia=this.symbol;if("point-3d"===
ia.type&&ia.verticalOffset){const {screenLength:ea,minWorldLength:ca,maxWorldLength:Z}=ia.verticalOffset;ha.verticalOffset={screenLength:g.pt2px(ea),minWorldLength:ca||0,maxWorldLength:null!=Z?Z:Infinity};ha.castShadows=!1}this._context.screenSizePerspectiveEnabled&&(ha.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);this._drivenProperties.color?ha.externalColor=f.ONES:(V=d.isSome(V.material)&&V.material.color,V=d.isSome(V)?c.toUnitRGBA(V):f.ONES,ha.externalColor=
V);this._fastUpdates=F.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions(Y,X,aa,d.none));this._fastUpdates.enabled?(Object.assign(ha,this._fastUpdates.materialParameters),ha.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(ha.instanced.push("color"),this._optionalFields.push("color"));ha=new P.DefaultMaterial(ha);ha=C.primitiveLodResources(Q,ha);if(!ha)throw Error(`Unknown object symbol primitive: ${Q}`);
Q=O.materialsFromLodResources(ha).map(ea=>({opacity:1,transparent:ea.parameters.transparent}));V=yield this._createStageResources(ha,ka);W=yield this._createLodRenderer(ha,W);return{lodResources:ha,lodRenderer:W,stageResources:V,symbolSize:X,extentPadding:ba,isEsriSymbolResource:!1,isWosr:!1,originalMaterialParameters:Q,physicalBasedRenderingEnabled:ka,resourceBoundingBox:Y,resourceSize:aa,dispose:d.none,pivotOffset:d.none}});return function(Q,W){return H.apply(this,arguments)}}();S._createResourcesForUrl=
function(){var H=b._asyncToGenerator(function*(Q,W){var V=["transformation"],Y={materialParamsMixin:{instanced:V,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=F.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions(d.none,d.none,d.none,d.none));this._fastUpdates.enabled?(Object.assign(Y.materialParamsMixin,
this._fastUpdates.materialParameters),V.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(V.push("color"),this._optionalFields.push("color"));V=this.symbol;if("point-3d"===V.type&&V.verticalOffset){const {screenLength:ra,minWorldLength:va,maxWorldLength:ya}=V.verticalOffset;Y.materialParamsMixin.verticalOffset={screenLength:g.pt2px(ra),minWorldLength:va||0,maxWorldLength:null!=ya?ya:Infinity};Y.materialParamsMixin.castShadows=!1}Y.signal=W;Y.usePBR=
this._context.physicalBasedRenderingEnabled;V=Y.usePBR;var aa=yield A.fetch(Q,Y);Q=aa.isEsriSymbolResource;Y=aa.isWosr;const X=aa.remove,ba=B.makeLodResources(aa.lods);B.fillEstimatedMinScreenSpaceRadius(ba);ba.levels.sort((ra,va)=>ra.minScreenSpaceRadius-va.minScreenSpaceRadius);ba.levels[0].minScreenSpaceRadius=Math.min(2,ba.levels[0].minScreenSpaceRadius);const ha=this._context,ka=this._getExternalColorParameters(this.symbolLayer.material);var ia=d.get(this.symbolLayer,"material","color");const ea=
this._getCombinedOpacity(ia,{hasIntrinsicColor:!0}),ca=this.needsDrivenTransparentPass;var Z=O.materialsFromLodResources(ba);ia=O.materialsFromLodResources(ba).map(ra=>({opacity:ra.parameters.opacity||1,transparent:ra.parameters.transparent}));Z.forEach(ra=>{const va=ra.parameters;ra.setParameters(ka);const ya=va.opacity*ea;ra.setParameters({opacity:ya,transparent:1>ya||ca||va.transparent});ha.screenSizePerspectiveEnabled&&ra.setParameters({screenSizePerspective:ha.sharedResources.screenSizePerspectiveSettings})});
aa=aa.referenceBoundingBox;const fa=n.fromArray(k.size(aa)),ja=n.fromArray(ba.levels[0].pivotOffset),la=n.fromArray(y.objectSymbolLayerSizeWithResourceSize(fa,this.symbolLayer)),ma=l.length(la);F.updateFastSymbolUpdatesState(this._fastUpdates,this._context.renderer,this._fastVisualVariableConvertOptions(aa,la,fa,ja))&&Z.forEach(ra=>ra.setParameters(this._fastUpdates.materialParameters));Z=yield this._createStageResources(ba,V);W=yield this._createLodRenderer(ba,W);return{lodResources:ba,lodRenderer:W,
stageResources:Z,symbolSize:la,extentPadding:ma,isEsriSymbolResource:Q,isWosr:Y,originalMaterialParameters:ia,physicalBasedRenderingEnabled:V,resourceBoundingBox:aa,resourceSize:fa,dispose:X,pivotOffset:ja}});return function(Q,W){return H.apply(this,arguments)}}();S._createStageResources=function(){var H=b._asyncToGenerator(function*(Q,W){const V=this._context.stage,Y=O.materialsFromLodResources(Q);W!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged();V.addMany(Y);
W=O.texturesFromLodResources(Q);V.addMany(W);yield V.load(W);Q=O.geometriesFromLodResources(Q);V.addMany(Q);return{materials:Y,textures:W,geometries:Q}});return function(Q,W){return H.apply(this,arguments)}}();S._createLodRenderer=function(){var H=b._asyncToGenerator(function*(Q,W){const V=this._context.stage;Q=new I.LodRenderer(Q,this._optionalFields,{layerUid:this._context.layer.uid,graphicUid:Y=>this._instanceIndexToGraphicUid.get(Y),notifyGraphicGeometryChanged:Y=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(Y)),
notifyGraphicVisibilityChanged:Y=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(Y))},this._fastUpdates.enabled?{applyTransform:(Y,aa,X)=>{Y.getFeatureAttribute(aa,R);x.copy(X,F.evaluateModelTransform(this._fastUpdates.materialParameters,R,X))},scaleFactor:(Y,aa,X)=>{aa.getFeatureAttribute(X,R);return F.evaluateModelTransformScale(Y,this._fastUpdates.materialParameters,R)}}:null);Q.slicePlaneEnabled=this._context.slicePlaneEnabled;yield V.addRenderPlugin(Q.slots,
Q,W);return Q});return function(Q,W){return H.apply(this,arguments)}}();S._getExternalColorParameters=function(H){const Q={};this._drivenProperties.color?Q.externalColor=f.ONES:d.isSome(H)&&d.isSome(H.color)?Q.externalColor=c.toUnitRGBA(H.color):(Q.externalColor=f.ONES,Q.colorMixMode="ignore");return Q};S.destroy=function(){N.prototype.destroy.call(this);if(d.isSome(this._resources)){const H=this._context.stage;H.removeRenderPlugin(this._resources.lodRenderer);const Q=this._resources.stageResources;
H.removeMany(Q.materials);H.removeMany(Q.textures);H.removeMany(Q.geometries);d.isSome(this._resources.dispose)&&this._resources.dispose();this._resources=null}};S.createGraphics3DGraphic=function(H){const Q=H.graphic;if(!this._validateGeometry(Q.geometry))return null;const W=E.placePointOnGeometry(Q.geometry);if(d.isNone(W))return this.logger.warn(`unsupported geometry type for icon symbol: ${Q.geometry.type}`),null;const V=this.setGraphicElevationContext(Q,new m.ElevationContext);return this._createAs3DShape(Q,
W,H.renderingInfo,V,Q.uid)};S.notifyDestroyGraphicLayer=function(H){this._instanceIndexToGraphicUid.delete(H.instanceIndex)};S.graphicLayerToGraphicId=function(){return 0};S.layerOpacityChanged=function(){if(d.isNone(this._resources))return!0;const H=this._drivenProperties.opacity,Q=!this.isPrimitive,W=this._resources.stageResources.materials,V=this._resources.originalMaterialParameters;for(let X=0;X<W.length;X++){const ba=W[X];var Y=d.get(this.symbolLayer,"material","color"),aa=V[X];Y=this._getCombinedOpacity(Y,
{hasIntrinsicColor:Q})*aa.opacity;aa=1>Y||H||aa.transparent;ba.setParameters({opacity:Y,transparent:aa});this.isPrimitive&&ba.setParameters({cullFace:aa?G.CullFaceOptions.None:G.CullFaceOptions.Back})}return!0};S.layerElevationInfoChanged=function(H,Q){return this.updateGraphics3DGraphicElevationInfo(H,Q,h.needsElevationUpdates3D)};S.slicePlaneEnabledChanged=function(){if(d.isNone(this._resources))return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const H of this._resources.stageResources.materials)H.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled});
return!0};S.physicalBasedRenderingChanged=function(){if(d.isNone(this._resources))return!0;const {stageResources:H,isWosr:Q}=this._resources;for(const W of H.materials)this.isPrimitive?W.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):Q||W.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return!1===this.hasLoadedPBRTextures&&!0===this._context.physicalBasedRenderingEnabled?(this.hasLoadedPBRTextures=!0,!1):!0};S.pixelRatioChanged=
function(){return!0};S.applyRendererDiff=function(H,Q){if(d.isNone(this._resources))return z.ApplyRendererDiffResult.Recreate_Symbol;const {stageResources:{materials:W},lodRenderer:V,resourceBoundingBox:Y,symbolSize:aa,resourceSize:X,pivotOffset:ba}=this._resources;for(const ha in H.diff)switch(ha){case "visualVariables":if(F.updateFastSymbolUpdatesState(this._fastUpdates,Q,this._fastVisualVariableConvertOptions(Y,aa,X,ba))){for(const ka of W)ka.setParameters(this._fastUpdates.materialParameters);
V.notifyShaderTransformationChanged()}else return z.ApplyRendererDiffResult.Recreate_Symbol;break;default:return z.ApplyRendererDiffResult.Recreate_Symbol}return z.ApplyRendererDiffResult.Fast_Update};S.computeComplexity=function(){if(d.isNone(this._resources))return N.prototype.computeComplexity.call(this);const H=O.geometriesFromLodLevelResources(this._resources.lodResources.levels[0]).reduce((W,V)=>W+V.indices.get(J.VertexAttribute.POSITION).length,0)/3,Q=D.defaultSymbolLayerMemoryComplexity(this.symbol,
this.symbolLayer);return{primitivesPerFeature:H,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:Q}};S._hasLodRenderer=function(){return d.isSome(this._resources)};S._createAs3DShape=function(H,Q,W,V,Y){if(!this._hasLodRenderer()||d.isNone(this._resources))return null;H=this.getFastUpdateAttrValues(H);const aa=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?q.mixinColorAndOpacity(W.color,W.opacity):null;var X=this._context.clippingExtent;e.projectPointToVector(Q,K,this._context.elevationProvider.spatialReference);
if(d.isSome(X)&&!k.containsPoint(X,K))return null;X=this._requiresTerrainElevation(V);const ba=this._computeGlobalTransform(Q,V,U,L);W=this._computeLocalTransform(this._resources,this.symbolLayer,W,M);const ha=this._resources.lodRenderer.instanceData,ka=ha.addInstance();this._instanceIndexToGraphicUid.set(ka,Y);ha.setLocalTransform(ka,W,!1);ha.setGlobalTransform(ka,ba);H&&ha.setFeatureAttribute(ka,H);aa&&ha.setColor(ka,aa);Y=new u(this,ka,p.perLodInstanceElevationAligner,V);X&&(Y.alignedSampledElevation=
L.sampledElevation);Y.needsElevationUpdates=h.needsElevationUpdates3D(V.mode);E.extendPointGraphicElevationContext(Y,Q,this._context.elevationProvider);return Y};S._computeGlobalTransform=function(H,Q,W,V){h.evaluateElevationInfoAtPoint(H,this._context.elevationProvider,Q,this._context.renderCoordsHelper,V);K[0]=H.x;K[1]=H.y;K[2]=V.z;e.computeTranslationToOriginAndRotation(H.spatialReference,K,W,this._context.renderCoordsHelper.spatialReference);return W};S._computeLocalTransform=function(H,Q,W,V){x.identity(V);
this._applyObjectRotation(W,!1,V);this._applyObjectRotation(Q,!0,V);this._applyObjectScale(H,W,V);this._applyAnchor(H,Q,V);return V};S._applyObjectScale=function(H,Q,W){this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation||(H=q.computeObjectScale(this._drivenProperties.size&&Q.size?Q.size:H.symbolSize,H.symbolSize,H.resourceSize,this._context.renderCoordsHelper.unitInMeters),1===H[0]&&1===H[1]&&1===H[2]||x.scale(W,W,H))};S.prepareSymbolLayerPatch=function(H){if("partial"===H.diff.type){var Q=
H.diff.diff;this._preparePatchTransform(H,Q);this._preparePatchColor(H,Q)}};S.updateGeometry=function(H,Q){if(d.isNone(this._resources))return!0;const W=Q&&E.placePointOnGeometry(Q);if(d.isNone(W))return!1;Q=this.getGeometryElevationMode(Q);if(H.elevationContext.mode!==Q)return!1;this._computeGlobalTransform(W,H.elevationContext,U,L);this._requiresTerrainElevation(H.elevationContext)&&(H.alignedSampledElevation=L.sampledElevation);this._resources.lodRenderer.instanceData.setGlobalTransform(H.instanceIndex,
U,!0);E.extendPointGraphicElevationContext(H,W,this._context.elevationProvider);return!0};S._preparePatchTransform=function(H,Q){if((Q.heading||Q.tilt||Q.roll||Q.width||Q.height||Q.depth||Q.anchor||Q.anchorPosition)&&!d.isNone(this._resources)){var W=(ca,Z,fa)=>d.unwrapOr(null!=ca&&"complete"===ca.type?ca.newValue:Z,fa),V=W(Q.heading,this.symbolLayer.heading,0),Y=W(Q.tilt,this.symbolLayer.tilt,0),aa=W(Q.roll,this.symbolLayer.roll,0),X=W(Q.width,this.symbolLayer.width,void 0),ba=W(Q.height,this.symbolLayer.height,
void 0),ha=W(Q.depth,this.symbolLayer.depth,void 0),ka=W(Q.anchor,this.symbolLayer.anchor,void 0);W=W(Q.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete Q.heading;delete Q.tilt;delete Q.roll;delete Q.width;delete Q.height;delete Q.depth;delete Q.anchor;delete Q.anchorPosition;var ia={heading:V,tilt:Y,roll:aa,anchor:ka,anchorPosition:W},ea=this._resources;this.loadStatus===v.LoadStatus.LOADED&&H.symbolLayerStatePatches.push(()=>{ea.symbolSize=n.fromArray(y.objectSymbolLayerSizeWithResourceSize(ea.resourceSize,
{width:X,height:ba,depth:ha,isPrimitive:this.symbolLayer.isPrimitive}))});H.graphics3DGraphicPatches.push((ca,Z)=>{Z=this._computeLocalTransform(ea,ia,Z,M);ea.lodRenderer.instanceData.setLocalTransform(ca.instanceIndex,Z,!0)})}};S._preparePatchColor=function(H,Q){if(Q.material&&"partial"===Q.material.type&&(Q=Q.material.diff,Q.color&&"complete"===Q.color.type&&null!=Q.color.newValue&&null!=Q.color.oldValue)){var W=Q.color.newValue,V=d.isSome(W)?c.toUnitRGBA(W):f.ONES;delete Q.color;var Y=this._resources;
d.isNone(Y)||H.graphics3DGraphicPatches.push(aa=>{this._hasPerInstanceColor()?(Y.lodRenderer.instanceData.setColor(aa.instanceIndex,V),aa=this._setMaterialTransparencyParams({},W)):aa=this._setMaterialTransparencyParams({externalColor:V},W);for(const X of Y.stageResources.materials)X.setParameters(aa)})}};S._requiresTerrainElevation=function(H){return"absolute-height"!==H.mode};S._applyObjectRotation=function(H,Q,W){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&Q))return q.computeObjectRotation(H.heading,
H.tilt,H.roll,W)};S._computeAnchor=function(H,Q,W){const V=n.create();switch(W.anchor){case "center":l.copy(V,k.center(H));l.negate(V,V);break;case "top":Q=k.center(H);l.set(V,-Q[0],-Q[1],-H[5]);break;case "bottom":Q=k.center(H);l.set(V,-Q[0],-Q[1],-H[2]);break;case "relative":Q=k.center(H);H=k.size(H);W=(W=W.anchorPosition)?n.fromValues(W.x,W.y,W.z):n.ZEROS;l.multiply(V,H,W);l.add(V,V,Q);l.negate(V,V);break;default:d.isSome(Q)?l.negate(V,Q):l.copy(V,n.ZEROS)}return V};S._applyAnchor=function(H,Q,
W){this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation||(H=this._computeAnchor(H.resourceBoundingBox,H.pivotOffset,Q))&&x.translate(W,W,H)};S._hasPerInstanceColor=function(){return this._drivenProperties.color||this._drivenProperties.opacity};S._fastVisualVariableConvertOptions=function(H,Q,W,V){const Y=d.isSome(H)?n.fromArray(k.size(H)):n.ONES;H=d.isSome(H)?this._computeAnchor(H,V,this.symbolLayer):n.ZEROS;V=this._context.renderCoordsHelper.unitInMeters;W=q.computeObjectScale(d.isSome(Q)?
Q:void 0,Q,W,V);const aa=n.fromValues(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return{modelSize:Y,symbolSize:d.isSome(Q)?Q:n.ONES,unitInMeters:V,transformation:{anchor:H,scale:W,rotation:aa}}};b._createClass(T,[{key:"extentPadding",get:function(){return d.isSome(this._resources)?this._resources.extentPadding:0}},{key:"isPrimitive",get:function(){return!(this.symbolLayer.resource&&this.symbolLayer.resource.href)}},{key:"lodRenderer",get:function(){return d.get(this._resources,
"lodRenderer")}}]);return T}(t.Graphics3DSymbolLayer);const K=n.create(),M=w.create(),U=w.create(),R=f.create(),L=new h.SampleElevationInfo;a.Graphics3DObjectSymbolLayer=t;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DLodInstanceGraphicLayer":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ./featureExpressionInfoUtils ./graphicUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Object3DStateID".split(" "),
function(a,b,c,d,g,x,w,l,n,f){let e=function(){function m(t,q,z,v){this.graphics3DSymbolLayer=t;this.instanceIndex=q;this.elevationAligner=z;this.elevationContext=v;this.type="lod-instance";this._highlights=new Set;this.alignedSampledElevation=0;this.needsElevationUpdates=this.isElevationSource=!1}var u=m.prototype;u.initialize=function(){};u.setVisibility=function(t){const q=this.lodRenderer.instanceData;t!==q.getVisible(this.instanceIndex)&&q.setVisible(this.instanceIndex,t)};u.destroy=function(){null!=
this.instanceIndex&&(this.lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))};u.alignWithElevation=function(t,q,z){this.elevationAligner&&(w.setContextFeature(this.elevationContext.featureExpressionInfoContext,z),t=this.elevationAligner(this,this.elevationContext,t,q),b.isSome(t)&&(this.alignedSampledElevation=t))};u.getCenterObjectSpace=function(t=g.create()){this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,
h);return d.transformMat4(t,this.lodRenderer.baseBoundingSphere.center,h)};u.getBoundingBoxObjectSpace=function(t=x.create()){this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,h);const q=this.lodRenderer.baseBoundingBox;x.empty(t);for(let z=0;8>z;++z)d.set(r,0===(z&1)?q[0]:q[3],0===(z&2)?q[1]:q[4],0===(z&4)?q[2]:q[5]),d.transformMat4(r,r,h),x.expandWithVec3(t,r);return t};u.computeAttachmentOrigin=function(t){this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,
h);t.render.origin[0]+=h[12];t.render.origin[1]+=h[13];t.render.origin[2]+=h[14];t.render.num++};u.getProjectedBoundingBox=function(){var t=a._asyncToGenerator(function*(q,z,v,B,A){A=this.getBoundingBoxObjectSpace(A);var E=p;const C=x.isPoint(A)?1:E.length;this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,h);for(var D=0;D<C;D++){const F=E[D];r[0]=A[F[0]];r[1]=A[F[1]];r[2]=A[F[2]];d.transformMat4(r,r,h);k[3*D]=r[0];k[3*D+1]=r[1];k[3*D+2]=r[2]}if(!q(k,0,C))return null;x.empty(A);q=
null;this.calculateRelativeScreenBounds&&(q=this.calculateRelativeScreenBounds());for(E=0;E<3*C;E+=3){for(D=0;3>D;D++)A[D]=Math.min(A[D],k[E+D]),A[D+3]=Math.max(A[D+3],k[E+D]);q&&v.push({location:k.slice(E,E+3),screenSpaceBoundingRect:q})}if(z&&(x.center(A,y),"absolute-height"!==this.elevationContext.mode)){let F;v=l.demResolutionForBoundingBox(A,z);try{F=yield z.service.queryElevation(y[0],y[1],B,v,"ground")}catch(G){}b.isSome(F)&&x.offset(A,0,0,-this.alignedSampledElevation+F)}return A});return function(q,
z,v,B,A){return t.apply(this,arguments)}}();u.addObjectState=function(t,q){t===n.Object3DState.Highlight&&(t=new f.Object3DStateID(t),this._addHighlightId(t),q.addExternal(z=>{this._removeHighlightId(z)},t))};u.removeObjectState=function(t){this._highlights.forEach(q=>t.remove(q))};u._addHighlightId=function(t){this._highlights.add(t);this.lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)};u._removeHighlightId=function(t){this._highlights.delete(t);this.lodRenderer.instanceData.setHighlight(this.instanceIndex,
0<this._highlights.size)};a._createClass(m,[{key:"lodRenderer",get:function(){return this.graphics3DSymbolLayer.lodRenderer}}]);return m}();const k=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r=g.create(),y=g.create(),p=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],h=c.create();return e})},"esri/views/3d/layers/graphics/lodResourceUtils":function(){define(["exports","../../webgl-engine/lib/lodRendering/LodResources"],function(a,b){function c(g){const x=[];g.stageResources.geometries.forEach((w,
l)=>{x.push({material:g.stageResources.materials[l],geometry:w,textures:g.stageResources.textures})});return{components:x,minScreenSpaceRadius:g.lodThreshold,pivotOffset:g.pivotOffset}}function d(g,x=.05){g=b.computeFaceCount(g);return Math.sqrt(g/(x*Math.PI))}a.estimateMinScreenSpaceRadius=d;a.fillEstimatedMinScreenSpaceRadius=function(g){g.levels.forEach(x=>{x.minScreenSpaceRadius||(x.minScreenSpaceRadius=d(x))})};a.makeLodLevelResources=c;a.makeLodResources=function(g){return{levels:g.map(x=>c(x))}};
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/objectResourceUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/devEnvironmentUtils ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/buffer/BufferView ../../../../chunks/vec32 ../../../../chunks/vec42 ../../../../geometry/support/buffer/utils ../../glTF/DefaultLoadingContext ../../glTF/loader ../../glTF/internal/indexUtils ./wosrLoader ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Texture ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/DefaultMaterial_COLOR_GAMMA ../../../webgl/enums ../../../../chunks/vec22 ../../../../chunks/vec43 ../../../../chunks/vec33".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E,C,D,F,G){function J(){J=b._asyncToGenerator(function*(P,K){var M=I(c.adjustStaticAGOUrl(P));if("wosr"===M.fileType)return P=yield K.cache?K.cache.loadWOSR(M.url,K):t.load(M.url,K),M=t.processLoadResult(P,K),{lods:[M],referenceBoundingBox:M.boundingBox,isEsriSymbolResource:!1,isWosr:!0,remove:P.remove};P=yield K.cache?K.cache.loadGLTF(M.url,K,K.usePBR):m.load(new h.DefaultLoadingContext(K.streamDataRequester),M.url,K,K.usePBR);var U=d.get(P.model.meta,
"ESRI_proxyEllipsoid");if(P.meta.isEsriSymbolResource&&d.isSome(U)&&-1!==P.meta.uri.indexOf("/RealisticTrees/"))a:for(var R=0;R<P.model.lods.length;++R){var L=P.model.lods[R];P.customMeta.esriTreeRendering=!0;for(var N of L.parts){L=N.attributes.normal;if(d.isNone(L))break a;const S=N.attributes.position,H=S.count,Q=f.create(),W=f.create(),V=f.create(),Y=p.createBuffer(k.BufferViewVec4u8,H),aa=p.createBuffer(k.BufferViewVec3f,H),X=w.invert(l.create(),N.transform);for(let ba=0;ba<H;ba++){S.getVec(ba,
W);L.getVec(ba,Q);n.transformMat4(W,W,N.transform);n.subtract(V,W,U.center);n.divide(V,V,U.radius);const ha=V[2];var T=n.length(V);T=Math.min(.45+.55*T*T,1);n.divide(V,V,U.radius);n.transformMat4(V,V,X);n.normalize(V,V);R+1!==P.model.lods.length&&1<P.model.lods.length&&(-1<ha?n.lerp(V,V,Q,.2):n.lerp(V,V,Q,Math.min(-4*ha-3.8,1)));aa.setVec(ba,V);Y.set(ba,0,255*T);Y.set(ba,1,255*T);Y.set(ba,2,255*T);Y.set(ba,3,255)}N.attributes.normal=aa;N.attributes.color=Y}}N=P.meta.isEsriSymbolResource?{usePBR:K.usePBR,
isSchematic:!1,treeRendering:P.customMeta.esriTreeRendering,mrrFactors:[0,1,.2]}:{usePBR:K.usePBR,isSchematic:!1,mrrFactors:[0,1,.5]};K={...K.materialParamsMixin,treeRendering:P.customMeta.esriTreeRendering};if(null!=M.specifiedLodIndex)return U=O(P,N,K,M.specifiedLodIndex),R=U[0].boundingBox,0!==M.specifiedLodIndex&&(R=O(P,N,K,0)[0].boundingBox),{lods:U,referenceBoundingBox:R,isEsriSymbolResource:P.meta.isEsriSymbolResource,isWosr:!1,remove:P.remove};M=O(P,N,K);return{lods:M,referenceBoundingBox:M[0].boundingBox,
isEsriSymbolResource:P.meta.isEsriSymbolResource,isWosr:!1,remove:P.remove}});return J.apply(this,arguments)}function I(P){const K=P.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return K?{fileType:"gltf",url:K[1],specifiedLodIndex:null!=K[4]?Number(K[4]):null}:P.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:P,specifiedLodIndex:null}:{fileType:"unknown",url:P,specifiedLodIndex:null}}function O(P,K,M,U){const R=P.model,L=x.create(),N=[],T=new Map,S=new Map;R.lods.forEach((H,Q)=>{if(void 0===U||
Q===U){var W={name:H.name,stageResources:{textures:[],materials:[],geometries:[]},lodThreshold:d.isSome(H.lodThreshold)?H.lodThreshold:null,pivotOffset:[0,0,0],numberOfVertices:0,boundingBox:e.empty()};N.push(W);H.parts.forEach(V=>{var Y=V.material+(V.attributes.normal?"_normal":"")+(V.attributes.color?"_color":"")+(V.attributes.texCoord0?"_texCoord0":"")+(V.attributes.tangent?"_tangent":"");const aa=R.materials.get(V.material),X=d.isSome(V.attributes.texCoord0);var ba=d.isSome(V.attributes.normal);
a:{switch(aa.alphaMode){case "BLEND":var ha=q.AlphaDiscardMode.Blend;break a;case "MASK":ha=q.AlphaDiscardMode.Mask;break a;case "OPAQUE":case null:case void 0:ha=q.AlphaDiscardMode.Opaque;break a}ha=void 0}if(!T.has(Y)){if(X){if(d.isSome(aa.textureColor)&&!S.has(aa.textureColor)){var ka=R.textures.get(aa.textureColor);S.set(aa.textureColor,new v.Texture(ka.data,{...ka.parameters,preMultiplyAlpha:ha!==q.AlphaDiscardMode.Opaque}))}d.isSome(aa.textureNormal)&&!S.has(aa.textureNormal)&&(ka=R.textures.get(aa.textureNormal),
S.set(aa.textureNormal,new v.Texture(ka.data,ka.parameters)));d.isSome(aa.textureOcclusion)&&!S.has(aa.textureOcclusion)&&(ka=R.textures.get(aa.textureOcclusion),S.set(aa.textureOcclusion,new v.Texture(ka.data,ka.parameters)));d.isSome(aa.textureEmissive)&&!S.has(aa.textureEmissive)&&(ka=R.textures.get(aa.textureEmissive),S.set(aa.textureEmissive,new v.Texture(ka.data,ka.parameters)));d.isSome(aa.textureMetallicRoughness)&&!S.has(aa.textureMetallicRoughness)&&(ka=R.textures.get(aa.textureMetallicRoughness),
S.set(aa.textureMetallicRoughness,new v.Texture(ka.data,ka.parameters)))}ka=aa.color[0]**(1/E.COLOR_GAMMA);var ia=aa.color[1]**(1/E.COLOR_GAMMA),ea=aa.color[2]**(1/E.COLOR_GAMMA),ca=aa.emissiveFactor[0]**(1/E.COLOR_GAMMA);const Z=aa.emissiveFactor[1]**(1/E.COLOR_GAMMA),fa=aa.emissiveFactor[2]**(1/E.COLOR_GAMMA),ja=d.isSome(aa.textureColor)&&X?S.get(aa.textureColor):null;T.set(Y,new A.DefaultMaterial({...K,transparent:ha===q.AlphaDiscardMode.Blend,customDepthTest:q.DepthTestFunction.Lequal,textureAlphaMode:ha,
textureAlphaCutoff:aa.alphaCutoff,diffuse:[ka,ia,ea],ambient:[ka,ia,ea],opacity:aa.opacity,doubleSided:aa.doubleSided,doubleSidedType:"winding-order",cullFace:aa.doubleSided?q.CullFaceOptions.None:q.CullFaceOptions.Back,vertexColors:!!V.attributes.color,vertexTangents:!!V.attributes.tangent,normals:ba?"default":"screenDerivative",castShadows:!0,receiveSSAO:!0,fillLightsEnabled:!0,textureId:d.isSome(ja)?ja.id:void 0,colorMixMode:aa.colorMixMode,normalTextureId:d.isSome(aa.textureNormal)&&X?S.get(aa.textureNormal).id:
void 0,textureAlphaPremultiplied:d.isSome(ja)&&!!ja.params.preMultiplyAlpha,occlusionTextureId:d.isSome(aa.textureOcclusion)&&X?S.get(aa.textureOcclusion).id:void 0,emissiveTextureId:d.isSome(aa.textureEmissive)&&X?S.get(aa.textureEmissive).id:void 0,metallicRoughnessTextureId:d.isSome(aa.textureMetallicRoughness)&&X?S.get(aa.textureMetallicRoughness).id:void 0,emissiveFactor:[ca,Z,fa],mrrFactors:[aa.metallicFactor,aa.roughnessFactor,K.mrrFactors[2]],isSchematic:!1,...M}))}a:{ba=V.indices||V.attributes.position.count;
switch(V.primitiveType){case C.PrimitiveType.TRIANGLES:ba=u.trianglesToTriangles(ba);break a;case C.PrimitiveType.TRIANGLE_STRIP:ba=u.triangleStripToTriangles(ba);break a;case C.PrimitiveType.TRIANGLE_FAN:ba=u.triangleFanToTriangles(ba);break a}ba=void 0}ha=ba;ba=V.attributes.position.count;ka=p.createBuffer(k.BufferViewVec3f,ba);r.transformMat4(ka,V.attributes.position,V.transform);ka=[[B.VertexAttribute.POSITION,{data:ka.typedBuffer,size:ka.elementCount,exclusive:!0}]];ia=[[B.VertexAttribute.POSITION,
ha]];d.isSome(V.attributes.normal)&&(ea=p.createBuffer(k.BufferViewVec3f,ba),g.normalFromMat4(L,V.transform),r.transformMat3(ea,V.attributes.normal,L),ka.push([B.VertexAttribute.NORMAL,{data:ea.typedBuffer,size:ea.elementCount,exclusive:!0}]),ia.push([B.VertexAttribute.NORMAL,ha]));d.isSome(V.attributes.tangent)&&(ea=p.createBuffer(k.BufferViewVec4f,ba),g.normalFromMat4(L,V.transform),y.transformMat3(ea,V.attributes.tangent,L),ka.push([B.VertexAttribute.TANGENT,{data:ea.typedBuffer,size:ea.elementCount,
exclusive:!0}]),ia.push([B.VertexAttribute.TANGENT,ha]));d.isSome(V.attributes.texCoord0)&&(ea=p.createBuffer(k.BufferViewVec2f,ba),D.normalizeIntegerBuffer(ea,V.attributes.texCoord0),ka.push([B.VertexAttribute.UV0,{data:ea.typedBuffer,size:ea.elementCount,exclusive:!0}]),ia.push([B.VertexAttribute.UV0,ha]));d.isSome(V.attributes.color)&&(ea=p.createBuffer(k.BufferViewVec4u8,ba),4===V.attributes.color.elementCount?V.attributes.color instanceof k.BufferViewVec4f?y.scale(ea,V.attributes.color,255):
V.attributes.color instanceof k.BufferViewVec4u8?F.copy(ea,V.attributes.color):V.attributes.color instanceof k.BufferViewVec4u16&&y.scale(ea,V.attributes.color,1/256):(F.fill(ea,255,255,255,255),ca=new k.BufferViewVec3u8(ea.buffer,0,4),V.attributes.color instanceof k.BufferViewVec3f?r.scale(ca,V.attributes.color,255):V.attributes.color instanceof k.BufferViewVec3u8?G.copy(ca,V.attributes.color):V.attributes.color instanceof k.BufferViewVec3u16&&r.scale(ca,V.attributes.color,1/256)),ka.push([B.VertexAttribute.COLOR,
{data:ea.typedBuffer,size:ea.elementCount,exclusive:!0}]),ia.push([B.VertexAttribute.COLOR,ha]));V=new z.Geometry(ka,ia);W.stageResources.geometries.push(V);W.stageResources.materials.push(T.get(Y));X&&(d.isSome(aa.textureColor)&&W.stageResources.textures.push(S.get(aa.textureColor)),d.isSome(aa.textureNormal)&&W.stageResources.textures.push(S.get(aa.textureNormal)),d.isSome(aa.textureOcclusion)&&W.stageResources.textures.push(S.get(aa.textureOcclusion)),d.isSome(aa.textureEmissive)&&W.stageResources.textures.push(S.get(aa.textureEmissive)),
d.isSome(aa.textureMetallicRoughness)&&W.stageResources.textures.push(S.get(aa.textureMetallicRoughness)));W.numberOfVertices+=ba;Y=V.boundingInfo;d.isSome(Y)&&(e.expandWithVec3(W.boundingBox,Y.getBBMin()),e.expandWithVec3(W.boundingBox,Y.getBBMax()))})}});return N}a.fetch=function(P,K){return J.apply(this,arguments)};a.gltfToEngineResources=O;a.parseUrl=I;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/devEnvironmentUtils":function(){define(["exports"],function(a){const b=/^devext.arcgis.com$/,
c=/^qaext.arcgis.com$/,d=/^[\w-]*\.mapsdevext.arcgis.com$/,g=/^[\w-]*\.mapsqa.arcgis.com$/,x=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,b,c,/^jsapps.esri.com$/,d,g];a.adjustStaticAGOUrl=function(w,l){return w?(l=l||globalThis.location.hostname)?null!=l.match(b)||null!=l.match(d)?w.replace("static.arcgis.com","staticdev.arcgis.com"):null!=l.match(c)||null!=l.match(g)?w.replace("static.arcgis.com","staticqa.arcgis.com"):w:w:w};a.isDevEnvironment=function(w){w=w||globalThis.location.hostname;return x.some(l=>
{var n;return null!=(null==(n=w)?void 0:n.match(l))})};a.isTelemetryDevEnvironment=function(w){w=w||globalThis.location.hostname;return[/^zrh-.+?\.esri\.com$/].concat(x).some(l=>{var n;return null!=(null==(n=w)?void 0:n.match(l))})};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/vec42":function(){define(["exports","../geometry/support/buffer/math/common"],function(a,b){function c(l,n,f){if(l.count!==n.count)b.mathLogger.error("source and destination buffers need to have the same number of elements");
else{var e=l.count,k=f[0],r=f[1],y=f[2],p=f[3],h=f[4],m=f[5],u=f[6],t=f[7],q=f[8],z=f[9],v=f[10],B=f[11],A=f[12],E=f[13],C=f[14];f=f[15];var D=l.typedBuffer;l=l.typedBufferStride;var F=n.typedBuffer;n=n.typedBufferStride;for(let J=0;J<e;J++){const I=J*l;var G=J*n;const O=F[G],P=F[G+1],K=F[G+2];G=F[G+3];D[I]=k*O+h*P+q*K+A*G;D[I+1]=r*O+m*P+z*K+E*G;D[I+2]=y*O+u*P+v*K+C*G;D[I+3]=p*O+t*P+B*K+f*G}}}function d(l,n,f){if(l.count!==n.count)b.mathLogger.error("source and destination buffers need to have the same number of elements");
else{var e=l.count,k=f[0],r=f[1],y=f[2],p=f[3],h=f[4],m=f[5],u=f[6],t=f[7];f=f[8];var q=l.typedBuffer;l=l.typedBufferStride;var z=n.typedBuffer;n=n.typedBufferStride;for(let B=0;B<e;B++){const A=B*l;var v=B*n;const E=z[v],C=z[v+1],D=z[v+2];v=z[v+3];q[A]=k*E+p*C+u*D;q[A+1]=r*E+h*C+t*D;q[A+2]=y*E+m*C+f*D;q[A+3]=v}}}function g(l,n,f){const e=Math.min(l.count,n.count),k=l.typedBuffer;l=l.typedBufferStride;const r=n.typedBuffer;n=n.typedBufferStride;for(let y=0;y<e;y++){const p=y*l,h=y*n;k[p]=f*r[h];k[p+
1]=f*r[h+1];k[p+2]=f*r[h+2];k[p+3]=f*r[h+3]}}function x(l,n,f){const e=Math.min(l.count,n.count),k=l.typedBuffer;l=l.typedBufferStride;const r=n.typedBuffer;n=n.typedBufferStride;for(let y=0;y<e;y++){const p=y*l,h=y*n;k[p]=r[h]>>f;k[p+1]=r[h+1]>>f;k[p+2]=r[h+2]>>f;k[p+3]=r[h+3]>>f}}const w=Object.freeze({__proto__:null,transformMat4:c,transformMat3:d,scale:g,shiftRight:x});a.scale=g;a.shiftRight=x;a.transformMat3=d;a.transformMat4=c;a.vec4=w})},"esri/geometry/support/buffer/utils":function(){define("exports ./types ../../../chunks/mat32 ../../../chunks/mat42 ../../../chunks/scalar ../../../chunks/vec22 ../../../chunks/vec33 ../../../chunks/vec43".split(" "),
function(a,b,c,d,g,x,w,l){a.mat3=c.mat3;a.mat4=d.mat4;a.scalar=g.scalar;a.vec2=x.vec2;a.vec3=w.vec3;a.vec4=l.vec4;a.createBuffer=function(n,f){return new n(new ArrayBuffer(f*n.ElementCount*b.elementTypeSize(n.ElementType)))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/mat32":function(){define(["exports"],function(a){function b(d,g,x){const w=d.typedBuffer;d=d.typedBufferStride;const l=g.typedBuffer,n=g.typedBufferStride;g=x?x.count:g.count;let f=(x&&x.dstIndex?x.dstIndex:0)*d;
x=(x&&x.srcIndex?x.srcIndex:0)*n;for(let e=0;e<g;++e){for(let k=0;9>k;++k)w[f+k]=l[x+k];f+=d;x+=n}}const c=Object.freeze({__proto__:null,copy:b});a.copy=b;a.mat3=c})},"esri/chunks/mat42":function(){define(["exports"],function(a){function b(d,g,x){const w=d.typedBuffer;d=d.typedBufferStride;const l=g.typedBuffer,n=g.typedBufferStride;g=x?x.count:g.count;let f=(x&&x.dstIndex?x.dstIndex:0)*d;x=(x&&x.srcIndex?x.srcIndex:0)*n;for(let e=0;e<g;++e){for(let k=0;16>k;++k)w[f+k]=l[x+k];f+=d;x+=n}}const c=Object.freeze({__proto__:null,
copy:b});a.copy=b;a.mat4=c})},"esri/chunks/scalar":function(){define(["exports"],function(a){function b(g,x,w){const l=g.typedBuffer;g=g.typedBufferStride;const n=x.typedBuffer,f=x.typedBufferStride;x=w?w.count:x.count;let e=(w&&w.dstIndex?w.dstIndex:0)*g;w=(w&&w.srcIndex?w.srcIndex:0)*f;for(let k=0;k<x;++k)l[e]=n[w],e+=g,w+=f}function c(g,x){const w=g.count;x||(x=new g.TypedArrayConstructor(w));for(let l=0;l<w;l++)x[l]=g.get(l);return x}const d=Object.freeze({__proto__:null,copy:b,makeDense:c});
a.copy=b;a.makeDense=c;a.scalar=d})},"esri/chunks/vec22":function(){define(["exports","../geometry/support/buffer/types"],function(a,b){function c(w,l,n){const f=w.typedBuffer;w=w.typedBufferStride;const e=l.typedBuffer,k=l.typedBufferStride;l=n?n.count:l.count;let r=(n&&n.dstIndex?n.dstIndex:0)*w;n=(n&&n.srcIndex?n.srcIndex:0)*k;for(let y=0;y<l;++y)f[r]=e[n],f[r+1]=e[n+1],r+=w,n+=k}function d(w,l,n){const f=w.typedBuffer,e=w.typedBufferStride,k=l.typedBuffer,r=l.typedBufferStride,y=n?n.count:l.count;
let p=(n&&n.dstIndex?n.dstIndex:0)*e,h=(n&&n.srcIndex?n.srcIndex:0)*r;if(b.isInteger(l.elementType))if(n=b.maximumValue(l.elementType),b.isSigned(l.elementType))for(l=0;l<y;++l)f[p]=Math.max(k[h]/n,-1),f[p+1]=Math.max(k[h+1]/n,-1),p+=e,h+=r;else for(l=0;l<y;++l)f[p]=k[h]/n,f[p+1]=k[h+1]/n,p+=e,h+=r;else c(w,l,n);return w}function g(w,l,n,f){var e,k;const r=w.typedBuffer,y=w.typedBufferStride;w=null!=(e=null==f?void 0:f.count)?e:w.count;f=(null!=(k=null==f?void 0:f.dstIndex)?k:0)*y;for(k=0;k<w;++k)r[f]=
l,r[f+1]=n,f+=y}const x=Object.freeze({__proto__:null,copy:c,normalizeIntegerBuffer:d,fill:g});a.copy=c;a.fill=g;a.normalizeIntegerBuffer=d;a.vec2=x})},"esri/chunks/vec33":function(){define(["exports"],function(a){function b(g,x,w){const l=g.typedBuffer;g=g.typedBufferStride;const n=x.typedBuffer,f=x.typedBufferStride;x=w?w.count:x.count;let e=(w&&w.dstIndex?w.dstIndex:0)*g;w=(w&&w.srcIndex?w.srcIndex:0)*f;for(let k=0;k<x;++k)l[e]=n[w],l[e+1]=n[w+1],l[e+2]=n[w+2],e+=g,w+=f}function c(g,x,w,l,n){var f,
e;const k=g.typedBuffer,r=g.typedBufferStride;g=null!=(f=null==n?void 0:n.count)?f:g.count;n=(null!=(e=null==n?void 0:n.dstIndex)?e:0)*r;for(e=0;e<g;++e)k[n]=x,k[n+1]=w,k[n+2]=l,n+=r}const d=Object.freeze({__proto__:null,copy:b,fill:c});a.copy=b;a.fill=c;a.vec3=d})},"esri/chunks/vec43":function(){define(["exports"],function(a){function b(g,x,w){const l=g.typedBuffer;g=g.typedBufferStride;const n=x.typedBuffer,f=x.typedBufferStride;x=w?w.count:x.count;let e=(w&&w.dstIndex?w.dstIndex:0)*g;w=(w&&w.srcIndex?
w.srcIndex:0)*f;for(let k=0;k<x;++k)l[e]=n[w],l[e+1]=n[w+1],l[e+2]=n[w+2],l[e+3]=n[w+3],e+=g,w+=f}function c(g,x,w,l,n,f){var e,k;const r=g.typedBuffer,y=g.typedBufferStride;g=null!=(e=null==f?void 0:f.count)?e:g.count;f=(null!=(k=null==f?void 0:f.dstIndex)?k:0)*y;for(k=0;k<g;++k)r[f]=x,r[f+1]=w,r[f+2]=l,r[f+3]=n,f+=y}const d=Object.freeze({__proto__:null,copy:b,fill:c});a.copy=b;a.fill=c;a.vec4=d})},"esri/views/3d/glTF/DefaultLoadingContext":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../request ../../../core/asyncUtils ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../core/urlUtils".split(" "),
function(a,b,c,d,g,x,w,l){let n=function(){function e(r){this.streamDataRequester=r}var k=e.prototype;k.loadJSON=function(){var r=b._asyncToGenerator(function*(y,p){return this._load("json",y,p)});return function(y,p){return r.apply(this,arguments)}}();k.loadBinary=function(){var r=b._asyncToGenerator(function*(y,p){return l.isDataProtocol(y)?(w.throwIfAborted(p),l.dataToArrayBuffer(y)):this._load("binary",y,p)});return function(y,p){return r.apply(this,arguments)}}();k.loadImage=function(){var r=
b._asyncToGenerator(function*(y,p){return this._load("image",y,p)});return function(y,p){return r.apply(this,arguments)}}();k._load=function(){var r=b._asyncToGenerator(function*(y,p,h){if(x.isNone(this.streamDataRequester))return(yield c(p,{responseType:f[y]})).data;y=yield d.result(this.streamDataRequester.request(p,y,h));if(!0===y.ok)return y.value;w.throwIfAbortError(y.error);throw new g("",`Request for resource failed: ${y.error}`);});return function(y,p,h){return r.apply(this,arguments)}}();
return e}();const f={image:"image",binary:"array-buffer",json:"json"};a.DefaultLoadingContext=n;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/glTF/loader":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../chunks/mat4f64 ./DefaultErrorContext ./LoaderResult ./internal/Resource ../../webgl/enums".split(" "),function(a,b,c,d,g,x,w,l){function n(){n=b._asyncToGenerator(function*(u,t,q={},z=!0){const v=yield w.Resource.load(u,p,t,q),
B=`gltf_${y++}`,A={lods:[],materials:new Map,textures:new Map,meta:f(v)};u=!(!v.json.asset.extras||"symbolResource"!==v.json.asset.extras.ESRI_type);const E=new Map;yield e(v,function(){var C=b._asyncToGenerator(function*(D,F,G,J){var I;const O=null!=(I=E.get(G))?I:0;E.set(G,O+1);var P=void 0!==D.mode?D.mode:l.PrimitiveType.TRIANGLES;I=P===l.PrimitiveType.TRIANGLES||P===l.PrimitiveType.TRIANGLE_STRIP||P===l.PrimitiveType.TRIANGLE_FAN?P:null;if(c.isNone(I))p.warnUnsupported("Unsupported primitive mode ("+
m[P]+"). Skipping primitive.");else if(v.hasPositions(D)){P=v.getPositionData(D,q);var K=v.getMaterial(D,q,z),M=v.hasNormals(D)?v.getNormalData(D,q):null,U=v.hasTangents(D)?v.getTangentData(D,q):null,R=v.hasTextureCoordinates(D)?v.getTextureCoordinates(D,q):null,L=v.hasVertexColors(D)?v.getVertexColors(D,q):null;D=v.getIndexData(D,q);F={transform:d.clone(F),attributes:{position:yield P,normal:M?yield M:null,texCoord0:R?yield R:null,color:L?yield L:null,tangent:U?yield U:null},indices:yield D,primitiveType:I,
material:r(A,yield K,B)};D=null;c.isSome(A.meta)&&c.isSome(A.meta.ESRI_lod)&&"screenSpaceRadius"===A.meta.ESRI_lod.metric&&(D=A.meta.ESRI_lod.thresholds[G]);A.lods[G]=A.lods[G]||{parts:[],name:J,lodThreshold:D};A.lods[G].parts[O]=F}else p.warn("Skipping primitive without POSITION vertex attribute.")});return function(D,F,G,J){return C.apply(this,arguments)}}());for(const C of A.lods)C.parts=C.parts.filter(D=>!!D);return{model:A,meta:{isEsriSymbolResource:u,uri:v.uri},customMeta:{}}});return n.apply(this,
arguments)}function f(u){let t=null;u.json.nodes.forEach(q=>{q=q.extras;c.isSome(q)&&(q.ESRI_proxyEllipsoid||q.ESRI_lod)&&(t=q)});return t}function e(u,t){return k.apply(this,arguments)}function k(){k=b._asyncToGenerator(function*(u,t){function q(C,D){return z.apply(this,arguments)}function z(){z=b._asyncToGenerator(function*(C,D){const F=v.nodes[C];C=u.getNodeTransform(C);p.warnUnsupportedIf(null!=F.weights,"Morph targets are not supported.");if(null!=F.mesh){const G=v.meshes[F.mesh];for(const J of G.primitives)E.push(t(J,
C,D,G.name))}for(const G of F.children||[])E.push(q(G,D))});return z.apply(this,arguments)}const v=u.json;var B=v.scenes[v.scene||0].nodes;const A=1<B.length,E=[];for(const C of B)B=v.nodes[C],E.push(q(C,0)),B.extensions&&B.extensions.MSFT_lod&&Array.isArray(B.extensions.MSFT_lod.ids)&&!A&&B.extensions.MSFT_lod.ids.forEach((D,F)=>q(D,F+1));yield Promise.all(E)});return k.apply(this,arguments)}function r(u,t,q){const z=B=>{const A=`${q}_tex_${B&&B.id}${B&&B.name?"_"+B.name:""}`;if(B&&!u.textures.has(A)){const E=
x.makeTextureSource(B.data,{wrap:{s:B.wrapS,t:B.wrapT},mipmap:h.some(C=>C===B.minFilter),noUnpackFlip:!0});u.textures.set(A,E)}return A},v=`${q}_mat_${t.id}_${t.name}`;u.materials.has(v)||(t=x.makeMaterialParameters({color:[t.color[0],t.color[1],t.color[2]],opacity:t.color[3],alphaMode:t.alphaMode,alphaCutoff:t.alphaCutoff,doubleSided:t.doubleSided,colorMixMode:t.ESRI_externalColorMixMode,textureColor:t.colorTexture?z(t.colorTexture):void 0,textureNormal:t.normalTexture?z(t.normalTexture):void 0,
textureOcclusion:t.occlusionTexture?z(t.occlusionTexture):void 0,textureEmissive:t.emissiveTexture?z(t.emissiveTexture):void 0,textureMetallicRoughness:t.metallicRoughnessTexture?z(t.metallicRoughnessTexture):void 0,emissiveFactor:[t.emissiveFactor[0],t.emissiveFactor[1],t.emissiveFactor[2]],metallicFactor:t.metallicFactor,roughnessFactor:t.roughnessFactor}),u.materials.set(v,t));return v}let y=0;const p=new g.DefaultErrorContext,h=[l.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,l.TextureSamplingMode.LINEAR_MIPMAP_NEAREST],
m="POINTS LINES LINE_LOOP LINE_STRIP TRIANGLES TRIANGLE_STRIP TRIANGLE_FAN".split(" ");a.load=function(u,t){return n.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/glTF/DefaultErrorContext":function(){define(["exports","../../../core/Error","../../../core/Logger"],function(a,b,c){const d=c.getLogger("esri.views.3d.glTF");c=function(){function g(){}var x=g.prototype;x.error=function(w){throw new b("gltf-loader-error",w);};x.errorUnsupported=function(w){throw new b("gltf-loader-unsupported-feature",
w);};x.errorUnsupportedIf=function(w,l){w&&this.errorUnsupported(l)};x.assert=function(w,l){w||this.error(l)};x.warn=function(w){d.warn(w)};x.warnUnsupported=function(w){this.warn("[Unsupported Feature] "+w)};x.warnUnsupportedIf=function(w,l){w&&this.warnUnsupported(l)};return g}();a.DefaultErrorContext=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/glTF/LoaderResult":function(){define(["exports","../../webgl/enums"],function(a,b){a.makeMaterialParameters=function(c={}){return{color:[1,
1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...c}};a.makeTextureSource=function(c,d={}){return{data:c,parameters:{wrap:{s:b.TextureWrapMode.REPEAT,t:b.TextureWrapMode.REPEAT,...d.wrap},noUnpackFlip:!0,mipmap:!1,...d}}};Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/glTF/internal/Resource":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/compilerUtils ../../../../core/MapUtils ../../../../core/urlUtils ../../../../core/Version ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/quat ../../../../chunks/quatf64 ../../../../geometry/support/buffer/BufferView ../../../../chunks/scalar ./BinaryStreamReader ./enums ./fillDefaults ./pathUtils ../../../webgl/enums".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m){function u(J){switch(J.componentType){case m.DataType.BYTE:return new e.BufferViewVec2i8(J.raw,J.byteOffset,J.byteStride,J.byteOffset+J.byteStride*J.entryCount);case m.DataType.UNSIGNED_BYTE:return new e.BufferViewVec2u8(J.raw,J.byteOffset,J.byteStride,J.byteOffset+J.byteStride*J.entryCount);case m.DataType.SHORT:return new e.BufferViewVec2i16(J.raw,J.byteOffset,J.byteStride,J.byteOffset+J.byteStride*J.entryCount);case m.DataType.UNSIGNED_SHORT:return new e.BufferViewVec2u16(J.raw,
J.byteOffset,J.byteStride,J.byteOffset+J.byteStride*J.entryCount);case m.DataType.UNSIGNED_INT:return new e.BufferViewVec2u32(J.raw,J.byteOffset,J.byteStride,J.byteOffset+J.byteStride*J.entryCount);case m.DataType.FLOAT:return new e.BufferViewVec2f(J.raw,J.byteOffset,J.byteStride,J.byteOffset+J.byteStride*J.entryCount);default:c.neverReached(J.componentType)}}function t(J){return q.apply(this,arguments)}function q(){q=b._asyncToGenerator(function*(J){return new Promise((I,O)=>{const P=new Blob([J]),
K=new FileReader;K.onload=()=>{I(JSON.parse(K.result))};K.onerror=M=>{O(M)};K.readAsText(P)})});return q.apply(this,arguments)}function z(J,I){return v.apply(this,arguments)}function v(){v=b._asyncToGenerator(function*(J,I){return new Promise((O,P)=>{const K=new Blob([J],{type:I}),M=URL.createObjectURL(K),U=new Image;U.addEventListener("load",()=>{URL.revokeObjectURL(M);"decode"in U?U.decode().then(()=>O(U),()=>O(U)):O(U)});U.addEventListener("error",R=>{URL.revokeObjectURL(M);P(R)});U.src=M})});
return v.apply(this,arguments)}let B=function(){function J(O,P,K,M,U){this.context=O;this.errorContext=P;this.uri=K;this.json=M;this.glbBuffer=U;this.bufferLoaders=new Map;this.textureLoaders=new Map;this.textureCache=new Map;this.materialCache=new Map;this.nodeParentMap=new Map;this.nodeTransformCache=new Map;this.baseUri=h.splitURI(this.uri).dirPart;this._checkVersionSupported();this._checkRequiredExtensionsSupported();P.errorUnsupportedIf(null==M.scenes,"Scenes must be defined.");P.errorUnsupportedIf(null==
M.meshes,"Meshes must be defined");P.errorUnsupportedIf(null==M.nodes,"Nodes must be defined.");this._computeNodeParents()}J.load=function(){var O=b._asyncToGenerator(function*(P,K,M,U){if(g.isDataProtocol(M)){var R=g.dataComponents(M);if("model/gltf-binary"!==R.mediaType)try{const L=JSON.parse(R.isBase64?atob(R.data):R.data);return new J(P,K,M,L)}catch{}R=g.dataToArrayBuffer(M);if(J._isGLBData(R))return this._fromGLBData(P,K,M,R)}if(M.endsWith(".gltf"))return U=yield P.loadJSON(M,U),new J(P,K,M,
U);R=yield P.loadBinary(M,U);if(J._isGLBData(R))return this._fromGLBData(P,K,M,R);U=yield P.loadJSON(M,U);return new J(P,K,M,U)});return function(P,K,M,U){return O.apply(this,arguments)}}();J._isGLBData=function(O){O=new r.BinaryStreamReader(O);return 4<=O.remainingBytes()&&1179937895===O.readUint32()};J._fromGLBData=function(){var O=b._asyncToGenerator(function*(P,K,M,U){U=yield J._parseGLBData(K,U);return new J(P,K,M,U.json,U.binaryData)});return function(P,K,M,U){return O.apply(this,arguments)}}();
J._parseGLBData=function(){var O=b._asyncToGenerator(function*(P,K){const M=new r.BinaryStreamReader(K);P.assert(12<=M.remainingBytes(),"GLB binary data is insufficiently large.");var U=M.readUint32(),R=M.readUint32();const L=M.readUint32();P.assert(1179937895===U,"Magic first 4 bytes do not fit to expected GLB value.");P.assert(K.byteLength>=L,"GLB binary data is smaller than header specifies.");P.errorUnsupportedIf(2!==R,"An unsupported GLB container version was detected. Only version 2 is supported.");
K=0;let N,T;for(;8<=M.remainingBytes();)U=M.readUint32(),R=M.readUint32(),0===K?(P.assert(1313821514===R,"First GLB chunk must be JSON."),P.assert(0<=U,"No JSON data found."),N=yield t(M.readUint8Array(U))):1===K?(P.errorUnsupportedIf(5130562!==R,"Second GLB chunk expected to be BIN."),T=M.readUint8Array(U)):P.warnUnsupported("More than 2 GLB chunks detected. Skipping."),K+=1;N||P.error("No GLB JSON chunk detected.");return{json:N,binaryData:T}});return function(P,K){return O.apply(this,arguments)}}();
var I=J.prototype;I.getBuffer=function(){var O=b._asyncToGenerator(function*(P,K){const M=this.json.buffers[P],U=this.errorContext;if(null==M.uri)return U.assert(null!=this.glbBuffer,"GLB buffer not present"),this.glbBuffer;P=yield this._getBufferLoader(P,K);U.assert(P.byteLength===M.byteLength,"Buffer byte lengths should match.");return P});return function(P,K){return O.apply(this,arguments)}}();I._getBufferLoader=function(){var O=b._asyncToGenerator(function*(P,K){const M=this.bufferLoaders.get(P);
if(M)return M;K=this.context.loadBinary(this._resolveUri(this.json.buffers[P].uri),K).then(U=>new Uint8Array(U));this.bufferLoaders.set(P,K);return K});return function(P,K){return O.apply(this,arguments)}}();I.getAccessor=function(){var O=b._asyncToGenerator(function*(P,K){var M=this.errorContext;M.errorUnsupportedIf(!this.json.accessors,"Accessors missing.");P=this.json.accessors[P];M.errorUnsupportedIf(null==(null==P?void 0:P.bufferView),"Some accessor does not specify a bufferView.");M.errorUnsupportedIf(P.type in
[y.AttributeType.MAT2,y.AttributeType.MAT3,y.AttributeType.MAT4],`AttributeType ${P.type} is not supported`);M=this.json.bufferViews[P.bufferView];K=yield this.getBuffer(M.buffer,K);const U=D[P.type],R=F[P.componentType],L=U*R,N=M.byteStride||L;return{raw:K.buffer,byteStride:N,byteOffset:K.byteOffset+(M.byteOffset||0)+(P.byteOffset||0),entryCount:P.count,isDenselyPacked:N===L,componentCount:U,componentByteSize:R,componentType:P.componentType,min:P.min,max:P.max,normalized:!!P.normalized}});return function(P,
K){return O.apply(this,arguments)}}();I.getIndexData=function(){var O=b._asyncToGenerator(function*(P,K){if(null==P.indices)return null;P=yield this.getAccessor(P.indices,K);if(P.isDenselyPacked)switch(P.componentType){case m.DataType.UNSIGNED_BYTE:return new Uint8Array(P.raw,P.byteOffset,P.entryCount);case m.DataType.UNSIGNED_SHORT:return new Uint16Array(P.raw,P.byteOffset,P.entryCount);case m.DataType.UNSIGNED_INT:return new Uint32Array(P.raw,P.byteOffset,P.entryCount)}else switch(P.componentType){case m.DataType.UNSIGNED_BYTE:return k.makeDense(this._wrapAccessor(e.BufferViewUint8,
P));case m.DataType.UNSIGNED_SHORT:return k.makeDense(this._wrapAccessor(e.BufferViewUint16,P));case m.DataType.UNSIGNED_INT:return k.makeDense(this._wrapAccessor(e.BufferViewUint32,P))}});return function(P,K){return O.apply(this,arguments)}}();I.getPositionData=function(){var O=b._asyncToGenerator(function*(P,K){const M=this.errorContext;M.errorUnsupportedIf(null==P.attributes.POSITION,"No POSITION vertex data found.");P=yield this.getAccessor(P.attributes.POSITION,K);M.errorUnsupportedIf(P.componentType!==
m.DataType.FLOAT,"Expected type FLOAT for POSITION vertex attribute, but found "+G[P.componentType]);M.errorUnsupportedIf(3!==P.componentCount,"POSITION vertex attribute must have 3 components, but found "+P.componentCount.toFixed());return this._wrapAccessor(e.BufferViewVec3f,P)});return function(P,K){return O.apply(this,arguments)}}();I.getNormalData=function(){var O=b._asyncToGenerator(function*(P,K){const M=this.errorContext;M.assert(null!=P.attributes.NORMAL,"No NORMAL vertex data found.");P=
yield this.getAccessor(P.attributes.NORMAL,K);M.errorUnsupportedIf(P.componentType!==m.DataType.FLOAT,"Expected type FLOAT for NORMAL vertex attribute, but found "+G[P.componentType]);M.errorUnsupportedIf(3!==P.componentCount,"NORMAL vertex attribute must have 3 components, but found "+P.componentCount.toFixed());return this._wrapAccessor(e.BufferViewVec3f,P)});return function(P,K){return O.apply(this,arguments)}}();I.getTangentData=function(){var O=b._asyncToGenerator(function*(P,K){const M=this.errorContext;
M.assert(null!=P.attributes.TANGENT,"No TANGENT vertex data found.");P=yield this.getAccessor(P.attributes.TANGENT,K);M.errorUnsupportedIf(P.componentType!==m.DataType.FLOAT,"Expected type FLOAT for TANGENT vertex attribute, but found "+G[P.componentType]);M.errorUnsupportedIf(4!==P.componentCount,"TANGENT vertex attribute must have 4 components, but found "+P.componentCount.toFixed());return new e.BufferViewVec4f(P.raw,P.byteOffset,P.byteStride,P.byteOffset+P.byteStride*P.entryCount)});return function(P,
K){return O.apply(this,arguments)}}();I.getTextureCoordinates=function(){var O=b._asyncToGenerator(function*(P,K){const M=this.errorContext;M.assert(null!=P.attributes.TEXCOORD_0,"No TEXCOORD_0 vertex data found.");P=yield this.getAccessor(P.attributes.TEXCOORD_0,K);M.errorUnsupportedIf(2!==P.componentCount,"TEXCOORD_0 vertex attribute must have 2 components, but found "+P.componentCount.toFixed());if(P.componentType===m.DataType.FLOAT)return this._wrapAccessor(e.BufferViewVec2f,P);M.errorUnsupportedIf(!P.normalized,
"Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return u(P)});return function(P,K){return O.apply(this,arguments)}}();I.getVertexColors=function(){var O=b._asyncToGenerator(function*(P,K){const M=this.errorContext;M.assert(null!=P.attributes.COLOR_0,"No COLOR_0 vertex data found.");P=yield this.getAccessor(P.attributes.COLOR_0,K);M.errorUnsupportedIf(4!==P.componentCount&&3!==P.componentCount,"COLOR_0 attribute must have 3 or 4 components, but found "+P.componentCount.toFixed());
if(4===P.componentCount){if(P.componentType===m.DataType.FLOAT)return this._wrapAccessor(e.BufferViewVec4f,P);if(P.componentType===m.DataType.UNSIGNED_BYTE)return this._wrapAccessor(e.BufferViewVec4u8,P);if(P.componentType===m.DataType.UNSIGNED_SHORT)return this._wrapAccessor(e.BufferViewVec4u16,P)}else if(3===P.componentCount){if(P.componentType===m.DataType.FLOAT)return this._wrapAccessor(e.BufferViewVec3f,P);if(P.componentType===m.DataType.UNSIGNED_BYTE)return this._wrapAccessor(e.BufferViewVec3u8,
P);if(P.componentType===m.DataType.UNSIGNED_SHORT)return this._wrapAccessor(e.BufferViewVec3u16,P)}M.errorUnsupported("Unsupported component type for COLOR_0 attribute: "+G[P.componentType])});return function(P,K){return O.apply(this,arguments)}}();I.hasPositions=function(O){return void 0!==O.attributes.POSITION};I.hasNormals=function(O){return void 0!==O.attributes.NORMAL};I.hasVertexColors=function(O){return void 0!==O.attributes.COLOR_0};I.hasTextureCoordinates=function(O){return void 0!==O.attributes.TEXCOORD_0};
I.hasTangents=function(O){return void 0!==O.attributes.TANGENT};I.getMaterial=function(){var O=b._asyncToGenerator(function*(P,K,M){var U=this.materialCache.get(P.material);if(!U){U=null!=P.material?p.material(this.json.materials[P.material]):p.material();const R=U.pbrMetallicRoughness,L=this.hasVertexColors(P),N=this.getTexture(R.baseColorTexture,K),T=this.getTexture(U.normalTexture,K),S=M?this.getTexture(U.occlusionTexture,K):null,H=M?this.getTexture(U.emissiveTexture,K):null;K=M?this.getTexture(R.metallicRoughnessTexture,
K):null;P=null!=P.material?P.material:-1;U={alphaMode:U.alphaMode,alphaCutoff:U.alphaCutoff,color:R.baseColorFactor,doubleSided:!!U.doubleSided,colorTexture:yield N,normalTexture:yield T,name:U.name,id:P,occlusionTexture:yield S,emissiveTexture:yield H,emissiveFactor:U.emissiveFactor,metallicFactor:R.metallicFactor,roughnessFactor:R.roughnessFactor,metallicRoughnessTexture:yield K,vertexColors:L,ESRI_externalColorMixMode:U.extras.ESRI_externalColorMixMode}}return U});return function(P,K,M){return O.apply(this,
arguments)}}();I.getTexture=function(){var O=b._asyncToGenerator(function*(P,K){if(!P)return null;this.errorContext.errorUnsupportedIf(0!==(P.texCoord||0),"Only TEXCOORD with index 0 is supported.");const M=P.index,U=this.errorContext;P=this.json.textures[M];const R=p.textureSampler(null!=P.sampler?this.json.samplers[P.sampler]:{});U.errorUnsupportedIf(null==P.source,"Source is expected to be defined for a texture.");const L=this.json.images[P.source],N=yield this._loadTextureImageData(M,P,K);return d.getOrCreateMapValue(this.textureCache,
M,()=>{const T=H=>33071===H||33648===H||10497===H,S=H=>{U.error(`Unexpected TextureSampler WrapMode: ${H}. Using default REPEAT(10497).`);return 10497};return{data:N,wrapS:T(R.wrapS)?R.wrapS:S(R.wrapS),wrapT:T(R.wrapT)?R.wrapT:S(R.wrapT),minFilter:R.minFilter,name:L.name,id:M}})});return function(P,K){return O.apply(this,arguments)}}();I.getNodeTransform=function(O){if(void 0===O)return E;var P=this.nodeTransformCache.get(O);if(!P){P=this.getNodeTransform(this._getNodeParent(O));const K=this.json.nodes[O];
if(K.matrix)P=w.multiply(l.create(),P,K.matrix);else if(K.translation||K.rotation||K.scale)P=l.clone(P),K.translation&&w.translate(P,P,K.translation),K.rotation&&(C[3]=n.getAxisAngle(C,K.rotation),w.rotate(P,P,C[3],C)),K.scale&&w.scale(P,P,K.scale);this.nodeTransformCache.set(O,P)}return P};I._wrapAccessor=function(O,P){return new O(P.raw,P.byteOffset,P.byteStride,P.byteOffset+P.byteStride*(P.entryCount-1)+P.componentByteSize*P.componentCount)};I._resolveUri=function(O){return g.makeAbsolute(O,this.baseUri)};
I._getNodeParent=function(O){return this.nodeParentMap.get(O)};I._checkVersionSupported=function(){const O=x.Version.parse(this.json.asset.version,"glTF");A.validate(O)};I._checkRequiredExtensionsSupported=function(){const O=this.json,P=this.errorContext;O.extensionsRequired&&0!==O.extensionsRequired.length&&P.errorUnsupported("gltf loader was not able to load unsupported feature. Required extensions: "+O.extensionsRequired.join(", "))};I._computeNodeParents=function(){this.json.nodes.forEach((O,
P)=>{O.children&&O.children.forEach(K=>{this.nodeParentMap.set(K,P)})})};I._loadTextureImageData=function(){var O=b._asyncToGenerator(function*(P,K,M){const U=this.textureLoaders.get(P);if(U)return U;K=this._createTextureLoader(K,M);this.textureLoaders.set(P,K);return K});return function(P,K,M){return O.apply(this,arguments)}}();I._createTextureLoader=function(){var O=b._asyncToGenerator(function*(P,K){P=this.json.images[P.source];if(P.uri)return this.context.loadImage(this._resolveUri(P.uri),K);
const M=this.errorContext;M.errorUnsupportedIf(null==P.bufferView,"Image bufferView must be defined.");M.errorUnsupportedIf(null==P.mimeType,"Image mimeType must be defined.");const U=this.json.bufferViews[P.bufferView];K=yield this.getBuffer(U.buffer,K);M.errorUnsupportedIf(null!=U.byteStride,"byteStride not supported for image buffer");return z(new Uint8Array(K.buffer,K.byteOffset+(U.byteOffset||0),U.byteLength),P.mimeType)});return function(P,K){return O.apply(this,arguments)}}();return J}();const A=
new x.Version(2,0,"glTF"),E=w.fromXRotation(l.create(),Math.PI/2),C=f.create(),D={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},F={[m.DataType.BYTE]:1,[m.DataType.UNSIGNED_BYTE]:1,[m.DataType.SHORT]:2,[m.DataType.UNSIGNED_SHORT]:2,[m.DataType.FLOAT]:4,[m.DataType.UNSIGNED_INT]:4},G={5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5125:"UNSIGNED_INT",5126:"FLOAT"};a.Resource=B;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/glTF/internal/BinaryStreamReader":function(){define(["exports"],
function(a){let b=function(){function c(g){this.data=g;this.offset4=0;this.dataUint32=new Uint32Array(this.data,0,Math.floor(this.data.byteLength/4))}var d=c.prototype;d.readUint32=function(){const g=this.offset4;this.offset4+=1;return this.dataUint32[g]};d.readUint8Array=function(g){const x=4*this.offset4;this.offset4+=g/4;return new Uint8Array(this.data,x,g)};d.remainingBytes=function(){return this.data.byteLength-4*this.offset4};return c}();a.BinaryStreamReader=b;Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/views/3d/glTF/internal/enums":function(){define(["exports"],function(a){a.AttributeType=void 0;(function(b){b.SCALAR="SCALAR";b.VEC2="VEC2";b.VEC3="VEC3";b.VEC4="VEC4";b.MAT2="MAT2";b.MAT3="MAT3";b.MAT4="MAT4"})(a.AttributeType||(a.AttributeType={}));a.BufferViewTarget=void 0;(function(b){b[b.ARRAY_BUFFER=34962]="ARRAY_BUFFER";b[b.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(a.BufferViewTarget||(a.BufferViewTarget={}));Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/glTF/internal/fillDefaults":function(){define(["exports","../../../../core/compilerUtils","../../../webgl/enums"],function(a,b,c){const d={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},g={pbrMetallicRoughness:d,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},x={ESRI_externalColorMixMode:"tint"},w={magFilter:c.TextureSamplingMode.LINEAR,minFilter:c.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,wrapS:c.TextureWrapMode.REPEAT,wrapT:c.TextureWrapMode.REPEAT};
a.material=(l={})=>{const n={...d,...l.pbrMetallicRoughness};var f={...x,...l.extras};switch(f.ESRI_externalColorMixMode){case "multiply":case "tint":case "ignore":case "replace":break;default:b.neverReached(f.ESRI_externalColorMixMode),f.ESRI_externalColorMixMode="tint"}return{...g,...l,pbrMetallicRoughness:n,extras:f}};a.textureSampler=l=>({...w,...l});Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/glTF/internal/pathUtils":function(){define(["exports"],function(a){a.splitURI=
function(b){let c,d;b.replace(/^(.*\/)?([^/]*)$/,(g,x,w)=>{c=x||"";d=w||"";return""});return{dirPart:c,filePart:d}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/glTF/internal/indexUtils":function(){define(["exports","../../../../core/typedArrayUtil","../../webgl-engine/lib/geometryDataUtils"],function(a,b,c){a.triangleFanToTriangles=function(d){var g="number"===typeof d?d:d.length;if(3>g)return new Uint16Array(0);g-=2;const x=65536>=g?new Uint16Array(3*g):new Uint32Array(3*g);
if("number"===typeof d){d=0;for(var w=0;w<g;++w)x[d++]=0,x[d++]=w+1,x[d++]=w+2;return x}{w=d[0];let l=d[1],n=0;for(let f=0;f<g;++f){const e=d[f+2];x[n++]=w;x[n++]=l;l=x[n++]=e}return x}};a.triangleStripToTriangles=function(d){var g="number"===typeof d?d:d.length;if(3>g)return new Uint16Array(0);g-=2;const x=65536>=g?new Uint16Array(3*g):new Uint32Array(3*g);if("number"===typeof d){d=0;for(var w=0;w<g;w+=1)0===w%2?(x[d++]=w,x[d++]=w+1):(x[d++]=w+1,x[d++]=w),x[d++]=w+2}else{w=0;for(let e=0;e<g;e+=1)if(0===
e%2){var l=d[e],n=d[e+1],f=d[e+2];x[w++]=l;x[w++]=n;x[w++]=f}else l=d[e+1],n=d[e],f=d[e+2],x[w++]=l,x[w++]=n,x[w++]=f}return x};a.trianglesToTriangles=function(d,g=c.generateDefaultIndexArray){return"number"===typeof d?g(d):b.isUint16Array(d)||b.isUint8Array(d)?new Uint32Array(d):d};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/wosrLoader":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../request ../../../../core/asyncUtils ../../../../core/Error ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/Version ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../support/requestImageUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Texture ../../webgl-engine/materials/DefaultMaterial ../../../webgl/enums".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m){function u(){u=b._asyncToGenerator(function*(J,I){J=yield t(J,I);I=yield E(J.textureDefinitions,I);return{resource:J,textures:I}});return u.apply(this,arguments)}function t(J,I){return q.apply(this,arguments)}function q(){q=b._asyncToGenerator(function*(J,I){const O=w.isSome(I)&&I.streamDataRequester;if(O)return z(J,O,I);J=yield d.result(c(J,w.unwrap(I)));if(!0===J.ok)return J.value.data;l.throwIfAbortError(J.error);B(J.error)});return q.apply(this,arguments)}
function z(J,I,O){return v.apply(this,arguments)}function v(){v=b._asyncToGenerator(function*(J,I,O){J=yield d.result(I.request(J,"json",O));if(!0===J.ok)return J.value;l.throwIfAbortError(J.error);B(J.error.details.url)});return v.apply(this,arguments)}function B(J){throw new g("",`Request for object resource failed: ${J}`);}function A(J){const I=e.empty();J.forEach(O=>{O=O.boundingInfo;w.isSome(O)&&(e.expandWithVec3(I,O.getBBMin()),e.expandWithVec3(I,O.getBBMax()))});return I}function E(J,I){return C.apply(this,
arguments)}function C(){C=b._asyncToGenerator(function*(J,I){const O=[];for(const M in J){var P=J[M],K=P.images[0].data;if(!K){F.warn("Externally referenced texture data is not yet supported");continue}K=P.encoding+";base64,"+K;const U="/textureDefinitions/"+M,R="rgba"===P.channels?P.alphaChannelUsage||"transparency":"none",L={noUnpackFlip:!0,wrap:{s:m.TextureWrapMode.REPEAT,t:m.TextureWrapMode.REPEAT},preMultiplyAlpha:D(R)!==r.AlphaDiscardMode.Opaque};P=w.isSome(I)&&I.disableTextures?Promise.resolve(null):
k.requestImage(K,I);O.push(P.then(N=>({refId:U,image:N,params:L,alphaChannelUsage:R})))}J=yield Promise.all(O);I={};for(const M of J)I[M.refId]=M;return I});return C.apply(this,arguments)}function D(J){switch(J){case "mask":return r.AlphaDiscardMode.Mask;case "maskAndTransparency":return r.AlphaDiscardMode.MaskBlend;case "none":return r.AlphaDiscardMode.Opaque;case "transparency":return r.AlphaDiscardMode.Blend;default:return r.AlphaDiscardMode.Blend}}const F=x.getLogger("esri.views.3d.layers.graphics.objectResourceUtils"),
G=new n.Version(1,2,"wosr");a.createTextureResources=E;a.load=function(J,I){return u.apply(this,arguments)};a.processLoadResult=function(J,I){const O=[],P=[],K=[],M=[],U=J.resource;var R=n.Version.parse(U.version||"1.0","wosr");G.validate(R);R=U.model.name;const L=U.model.geometries,N=U.materialDefinitions;J=J.textures;let T=0;const S=new Map;for(let ba=0;ba<L.length;ba++){var H=L[ba],Q=H,W=Q.params,V=W.topology;var Y=!0;W.vertexAttributes||(F.warn("Geometry must specify vertex attributes"),Y=!1);
switch(W.topology){case "PerAttributeArray":break;case "Indexed":case null:case void 0:V=W.faces;if(!V)F.warn("Indexed geometries must specify faces"),Y=!1;else if(W.vertexAttributes)for(const ha in W.vertexAttributes)(W=V[ha])&&W.values?(null!=W.valueType&&"UInt32"!==W.valueType&&(F.warn(`Unsupported indexed geometry indices type '${W.valueType}', only UInt32 is currently supported`),Y=!1),null!=W.valuesPerElement&&1!==W.valuesPerElement&&(F.warn(`Unsupported indexed geometry values per element '${W.valuesPerElement}', only 1 is currently supported`),
Y=!1)):(F.warn(`Indexed geometry does not specify face indices for '${ha}' attribute`),Y=!1);break;default:F.warn(`Unsupported topology '${V}'`),Y=!1}Q.params.material||(F.warn("Geometry requires material"),Y=!1);Q=Q.params.vertexAttributes;for(const ha in Q)Q[ha].values||(F.warn("Geometries with externally defined attributes are not yet supported"),Y=!1);if(Y){Y=H.params;Y={id:1,material:Y.material,texture:Y.texture,region:Y.texture};W=H.params.vertexAttributes;Q=[];for(const ha in W)V=W[ha],Q.push([ha,
{data:V.values,size:V.valuesPerElement,exclusive:!0}]);W=[];if("PerAttributeArray"!==H.params.topology){H=H.params.faces;for(const ha in H)W.push([ha,new Uint32Array(H[ha].values)])}if((H=J&&J[Y.texture])&&!S.has(Y.texture)){const {image:ha,params:ka}=H;V=new p.Texture(ha,ka);M.push(V);S.set(Y.texture,V)}V=(V=S.get(Y.texture))?V.id:void 0;var aa=K[Y.material]?K[Y.material][Y.texture]:null;if(!aa){aa=Y.material.substring(Y.material.lastIndexOf("/")+1);aa=N[aa].params;1===aa.transparency&&(aa.transparency=
0);var X=H&&H.alphaChannelUsage;X=0<aa.transparency||"transparency"===X||"maskAndTransparency"===X;const ha=H?D(H.alphaChannelUsage):void 0;H={ambient:f.fromArray(aa.diffuse),diffuse:f.fromArray(aa.diffuse),opacity:1-(aa.transparency||0),transparent:X,textureAlphaMode:ha,textureAlphaCutoff:.33,textureId:V,initTextureTransparent:!0,doubleSided:!0,cullFace:r.CullFaceOptions.None,colorMixMode:aa.externalColorMixMode||"tint",textureAlphaPremultiplied:H?!!H.params.preMultiplyAlpha:!1};w.isSome(I)&&I.materialParamsMixin&&
Object.assign(H,I.materialParamsMixin);aa=new h.DefaultMaterial(H);K[Y.material]||(K[Y.material]={});K[Y.material][Y.texture]=aa}P.push(aa);Y=new y.Geometry(Q,W);T+=W.position?W.position.length:0;O.push(Y)}}return{name:R,stageResources:{textures:M,materials:P,geometries:O},pivotOffset:U.model.pivotOffset,boundingBox:A(O),numberOfVertices:T,lodThreshold:null}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/DefaultMaterial_COLOR_GAMMA":function(){define(["exports"],
function(a){a.COLOR_GAMMA=2.1;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodRenderer":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../chunks/mat4f64 ../../../../../chunks/vec2f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../chunks/vec4f64 ../../../support/debugFlags ../../../support/buffer/glUtil ../../core/shaderLibrary/output/OutputHighlight.glsl ../Camera ../DefaultVertexAttributeLocations ../IntersectorInterfaces ../Octree ../RenderPass ../RenderSlot ../Util ./InstanceData ./InstanceOctree ./LevelSelector ./LodLevel ./RenderInstanceData ../../materials/DefaultMaterial ../../materials/internal/MaterialUtil ../../materials/renderers/utils ../../../../webgl/Util".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E,C,D,F){function G(L,N,T){const S=L.allocateHead();L=L.view;D.encodeDoubleVec3(N.modelOrigin,T,L.modelOriginHi,L.modelOriginLo,S);L.model.copyFrom(S,N.model,T);L.modelNormal.copyFrom(S,N.modelNormal,T);N.color&&L.color&&L.color.copyFrom(S,N.color,T);N.featureAttribute&&L.featureAttribute&&L.featureAttribute.copyFrom(S,N.featureAttribute,T)}let J=function(L){const N=L.baseBoundingSphere.radius;L=L.levels.map(T=>T.minScreenSpaceRadius);return new v.LevelSelector(N,
L)},I=function(){function L(T,S,H,Q){this.type=p.IntersectorType.LOD;this.isGround=!1;this._inverseViewport=x.create();this._levels=[];this._defaultRenderInstanceData=[];this._highlightRenderInstanceData=[];this._instanceIndex=0;this._slicePlane=!1;this._enableLevelSelection=!0;this._lastCamera=new r.default;this._updateCyclesWithStaticCamera=-1;this._needFullCycle=!1;this.slots=[u.RenderSlot.OPAQUE_PLUGIN,u.RenderSlot.TRANSPARENT_PLUGIN];this.canRender=!0;this._symbol=T;this._optionalFields=S;this._metadata=
H;this._instanceBufferLayout=E.getInstanceBufferLayout({instancedDoublePrecision:!0,instanced:S});this._glInstanceBufferLayout=e.glLayout(this._instanceBufferLayout,1);this._instanceData=new q.InstanceData(this._optionalFields,Q);this._instanceData.on("instance-added",()=>this._requestUpdateCycle());this._instanceData.on("instance-removed",()=>this._requestUpdateCycle());this._instanceData.on("instance-transform-changed",W=>{this._requestUpdateCycle();this._metadata.notifyGraphicGeometryChanged(W.index)});
this._instanceData.on("instance-visibility-changed",W=>{this._requestUpdateCycle(!0);this._metadata.notifyGraphicVisibilityChanged(W.index)});this._instanceData.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0));this._enableLevelSelection=1<this._symbol.levels.length}var N=L.prototype;N.initializeRenderContext=function(){var T=b._asyncToGenerator(function*(S,H){this._context=S;const Q=S.renderContext.rctx,W=yield Promise.allSettled(this._symbol.levels.map(Y=>{this._defaultRenderInstanceData.push(new A.RenderInstanceData(Q,
this._instanceBufferLayout));this._highlightRenderInstanceData.push(new A.RenderInstanceData(Q,this._instanceBufferLayout));return B.LodLevel.create(S,Y,H)})),V=W.map(Y=>"fulfilled"===Y.status?Y.value:null).filter(Y=>Y);if(d.isAborted(H)||V.length!==W.length){V.forEach(Y=>Y.destroy());d.throwIfAborted(H);for(const Y of W)if("rejected"===Y.status)throw Y.reason;}this._levels=V;this._levelSelector=J(this)});return function(S,H){return T.apply(this,arguments)}}();N.uninitializeRenderContext=function(){this._invalidateOctree();
this._levels.forEach(T=>T.destroy());this._defaultRenderInstanceData.forEach(T=>T.destroy());this._highlightRenderInstanceData.forEach(T=>T.destroy())};N.prepareRender=function(T,S){f.LOD_INSTANCE_RENDERER_DISABLE_UPDATES||(this._enableLevelSelection&&(T=S.equals(this._lastCamera),this._lastCamera.copyFrom(S),T||this._requestUpdateCycle()),T=this._needFullCycle?this._instanceData.size:2E3,this._needFullCycle=!1,this._updateInstances(S,T),this.needsUpdates&&this._context.requestRender())};N.render=
function(T){var S,H,Q,W;const V=T.slot===u.RenderSlot.OPAQUE_PLUGIN?u.RenderSlot.OPAQUE_MATERIAL:T.slot===u.RenderSlot.TRANSPARENT_PLUGIN?u.RenderSlot.TRANSPARENT_MATERIAL:null;if(V&&this.baseMaterial.isVisible()&&this.baseMaterial.isVisibleInPass(T.pass)){var Y=T.camera;this._inverseViewport[0]=1/Y.fullViewport[2];this._inverseViewport[1]=1/Y.fullViewport[3];Y={slot:V,origin:[0,0,0],camera:Y,inverseViewport:this._inverseViewport,shadowMap:T.shadowMap,shadowMappingEnabled:T.shadowMap.enabled,ssaoHelper:T.ssaoHelper,
ssaoEnabled:T.ssaoHelper.enabled,screenToWorldRatio:null,screenToPCSRatio:null,slicePlane:T.sliceHelper&&T.sliceHelper.plane,hudVisibilityTexture:null!=(S=null==(H=T.offscreenRenderingHelper)?void 0:H.hudVisibilityTexture)?S:null,highlightDepthTexture:null!=(Q=null==(W=T.offscreenRenderingHelper)?void 0:W.depthTexture)?Q:null,hasOccludees:!1,linearDepthTexture:null,lastFrameColorTexture:null,reprojectionMatrix:g.IDENTITY,ssrEnabled:!1,lighting:T.scenelightingData,transparencyPassType:T.transparencyPassType,
terrainLinearDepthTexture:T.multipassTerrainParams.terrainLinearDepthTexture,geometryLinearDepthTexture:T.multipassGeometryParams.geometryLinearDepthTexture,multipassTerrainEnabled:T.multipassTerrainParams.multipassTerrainEnabled,cullAboveGround:T.multipassTerrainParams.cullAboveGround,multipassGeometryEnabled:T.multipassGeometryParams.multipassGeometryEnabled,highlightColorTexture:null,cloudsCompositionParams:null,hasFillLights:T.hasFillLights};T.rctx.bindVAO();S=T.pass!==m.RenderPass.MATERIAL_DEPTH_SHADOWMAP_DEFAULT;
T.pass!==m.RenderPass.MATERIAL_HIGHLIGHT&&T.pass!==m.RenderPass.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT&&this._renderComponents(T,V,Y,this._defaultRenderInstanceData);S&&this._renderComponents(T,V,Y,this._highlightRenderInstanceData)}};N.intersect=function(T,S,H,Q){if(this.baseMaterial.isVisible()){var W=l.create();w.subtract(W,Q,H);var V=Y=>{this._instanceData.getCombinedModelTransform(Y,K);T.transform.set(K);w.transformMat4(M,H,T.transform.inverse);w.transformMat4(U,Q,T.transform.inverse);const aa=this._instanceData.getState(Y),
X=this._instanceData.getLodLevel(Y);t.assert(aa&q.StateFlags.ACTIVE,"invalid instance state");t.assert(0<=X&&X<this._levels.length,"invaid lod level");this._levels[X].intersect(T,S,M,U,Y,this._metadata)};this.baseMaterial.parameters.verticalOffset?this.octree.forEach(V):this.octree.forEachAlongRay(H,W,V)}};N.queryDepthRange=function(T){return this._queryDepthRangeOctree(T)};N.notifyShaderTransformationChanged=function(){this._invalidateOctree()};N._requestUpdateCycle=function(T=!1){this._updateCyclesWithStaticCamera=
-1;T&&(this._needFullCycle=!0);this.needsUpdates&&this._context.requestRender()};N._invalidateOctree=function(){this._octree&&(this._octree.destroy(),this._octree=null)};N._buildOctree=function(){const T=new z.InstanceOctree(this._instanceData,this.baseBoundingSphere);var S=this._instanceData;S=S.view?S.view.state:null;for(let H=0;H<this._instanceData.capacity;++H)S.get(H)&q.StateFlags.ACTIVE&&T.addInstance(H);return T};N._queryDepthRangeOctree=function(T){var S=T.eye;const H=T.viewForward;var Q=
this.octree.findClosest(H,h.DepthOrder.FRONT_TO_BACK,T.frustum);const W=this.octree.findClosest(H,h.DepthOrder.BACK_TO_FRONT,T.frustum);return null!=Q&&null!=W?(this._instanceData.view.boundingSphere.getVec(Q,P),w.subtract(P,P,S),Q=w.dot(P,H)-P[3],this._instanceData.view.boundingSphere.getVec(W,P),w.subtract(P,P,S),S=w.dot(P,H)+P[3],{near:Math.max(T.near,Q),far:Math.min(T.far,S)}):{near:Infinity,far:-Infinity}};N._startUpdateCycle=function(){this._updateCyclesWithStaticCamera++;this._defaultRenderInstanceData.forEach(T=>
{T.startUpdateCylce()});this._highlightRenderInstanceData.forEach(T=>{T.startUpdateCylce()});this.needsUpdates&&this._context.requestRender()};N._updateInstances=function(T,S){const H=this._enableLevelSelection,Q=this._levelSelector;Q.updateCamera(T);this._defaultRenderInstanceData.forEach(ba=>{ba.beginUpdate()});this._highlightRenderInstanceData.forEach(ba=>{ba.beginUpdate()});T=this._instanceData;const W=this._instanceData.view,V=T.capacity;let Y=this._instanceIndex;S=Math.min(T.size,S);for(let ba=
0;ba<S;++ba){0===Y&&this._startUpdateCycle();const ha=W.state.get(Y);var aa=0;if(ha&q.StateFlags.ALLOCATED){var X=W.lodLevel.get(Y);ha&q.StateFlags.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[X].freeTail();ha&q.StateFlags.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[X].freeTail();ha&q.StateFlags.REMOVE?T.freeInstance(Y):ha&q.StateFlags.VISIBLE?(X=0,H&&(W.modelOrigin.getVec(Y,O),X=Q.selectLevel(O,T.getCombinedMedianScaleFactor(Y))),aa=ha&~(q.StateFlags.ACTIVE|q.StateFlags.TRANSFORM_CHANGED),
0<=X&&(ha&q.StateFlags.HIGHLIGHT?(G(this._highlightRenderInstanceData[X],W,Y),aa|=q.StateFlags.HIGHLIGHT_ACTIVE):(G(this._defaultRenderInstanceData[X],W,Y),aa|=q.StateFlags.DEFAULT_ACTIVE)),W.state.set(Y,aa),W.lodLevel.set(Y,X)):(aa=ha&~(q.StateFlags.ACTIVE|q.StateFlags.TRANSFORM_CHANGED),W.state.set(Y,aa));this._octree&&(X=!!(ha&q.StateFlags.ACTIVE),aa=!!(aa&q.StateFlags.ACTIVE),!X&&aa?this._octree.addInstance(Y):X&&!aa?this._octree.removeInstance(Y):X&&aa&&ha&q.StateFlags.TRANSFORM_CHANGED&&(this._octree.removeInstance(Y),
this._octree.addInstance(Y)));Y=(Y+1)%V}else Y=(Y+1)%V,S++}this._instanceIndex=Y;this._defaultRenderInstanceData.forEach(ba=>{ba.endUpdate()});this._highlightRenderInstanceData.forEach(ba=>{ba.endUpdate()})};N._renderComponents=function(T,S,H,Q){this.levels.forEach((W,V)=>{W.components.forEach(Y=>{this._renderComponent(T,S,H,Q[V],Y,V)})})};N._renderComponent=function(T,S,H,Q,W,V){if(0!==Q.size&&W.material.requiresSlot(S)){var {rctx:Y,pass:aa}=T,X=W.glMaterials.load(Y,aa);if(!c.isNone(X)){var ba=X.beginSlot(H);
S=Y.useTechnique(ba,S);X.bind(H,ba);Y.bindVAO(W.vao);ba.ensureAttributeLocations(W.vao);T.isHighlightPass&&k.bindOutputHighlight(S,H);ba.bindDraw(H);f.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&T.pass===m.RenderPass.MATERIAL&&(S.setUniform4fv("externalColor",R[Math.min(V,R.length-1)]),S.setUniform1i("colorMixMode",C.colorMixModes.replace));var ha=Y.capabilities.instancing;T=Q.capacity;H=Q.headIndex;V=Q.tailIndex;X=Q.firstIndex;var ka=this._glInstanceBufferLayout;S=(ia,ea)=>{F.bindVertexBufferLayout(Y,
y.Default3D,Q.buffer,ka,ia);ha.drawArraysInstanced(ba.primitiveType,0,W.vertexCount,ea-ia);F.unbindVertexBufferLayout(Y,y.Default3D,Q.buffer,ka)};W.material.parameters.transparent&&null!=X?H>V?(t.assert(X>=V&&X<=H,"invalid firstIndex"),S(X,H),S(V,X)):H<V&&(X<=H?(t.assert(0<=X&&X<=H,"invalid firstIndex"),S(X,H),S(V,T),S(0,X)):(t.assert(X>=V&&X<=T,"invalid firstIndex"),S(X,T),S(0,H),S(V,X))):H>V?S(V,H):H<V&&(S(0,H),S(V,T));Y.bindVAO(null)}}};b._createClass(L,[{key:"levels",get:function(){return this._levels}},
{key:"baseBoundingBox",get:function(){return this._levels[this._levels.length-1].boundingBox}},{key:"baseBoundingSphere",get:function(){return this._levels[this._levels.length-1].boundingSphere}},{key:"baseMaterial",get:function(){return this._levels[this._levels.length-1].components[0].material}},{key:"slicePlaneEnabled",get:function(){return this._slicePlane},set:function(T){this._slicePlane=T}},{key:"layerUid",get:function(){return this._metadata.layerUid}},{key:"instanceData",get:function(){return this._instanceData}},
{key:"memoryUsage",get:function(){const T={cpu:0,gpu:0};this._defaultRenderInstanceData.forEach(S=>{S=S.memoryUsage;T.cpu+=S.cpu;T.gpu+=S.gpu});this._highlightRenderInstanceData.forEach(S=>{S=S.memoryUsage;T.cpu+=S.cpu;T.gpu+=S.gpu});return T}},{key:"renderStats",get:function(){const T=this._instanceData.size,S=[];this._levels.forEach((H,Q)=>{Q=this._defaultRenderInstanceData[Q].size+this._highlightRenderInstanceData[Q].size;H=H.triangleCount;S.push({renderedInstances:Q,renderedTriangles:Q*H,trianglesPerInstance:H})});
return{totalInstances:T,renderedInstances:S.reduce((H,Q)=>H+Q.renderedInstances,0),renderedTriangles:S.reduce((H,Q)=>H+Q.renderedTriangles,0),levels:S}}},{key:"needsTransparentPass",get:function(){return this._levels.some(T=>T.components.some(S=>S.material.requiresSlot(u.RenderSlot.TRANSPARENT_MATERIAL)))}},{key:"needsHighlight",get:function(){return this._highlightRenderInstanceData.some(T=>0<T.size)}},{key:"needsUpdates",get:function(){return 0<this._instanceData.size&&1>this._updateCyclesWithStaticCamera}},
{key:"octree",get:function(){this._octree||(this._octree=this._buildOctree());return this._octree}}]);return L}();const O=l.create(),P=n.create(),K=g.create(),M=l.create(),U=l.create(),R=[[1,0,1,1],[0,0,1,1],[0,1,0,1],[1,1,0,1],[1,0,0,1]];a.LodRenderer=I;a.setLevelSelectorFactory=function(L){J=L};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceData":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/Evented ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/buffer/BufferView ../../../support/mathUtils ../../../support/buffer/InterleavedLayout ../Util ../VertexAttribute".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y){a.StateFlags=void 0;(function(q){q[q.ALLOCATED=1]="ALLOCATED";q[q.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE";q[q.VISIBLE=4]="VISIBLE";q[q.HIGHLIGHT=8]="HIGHLIGHT";q[q.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE";q[q.REMOVE=32]="REMOVE";q[q.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED";q[q.ACTIVE=18]="ACTIVE"})(a.StateFlags||(a.StateFlags={}));let p=function(q){this.localTransform=q.getField(y.VertexAttribute.LOCALTRANSFORM,f.BufferViewMat4f64);this.globalTransform=q.getField(y.VertexAttribute.GLOBALTRANSFORM,
f.BufferViewMat4f64);this.modelOrigin=q.getField(y.VertexAttribute.MODELORIGIN,f.BufferViewVec3f64);this.model=q.getField(y.VertexAttribute.MODEL,f.BufferViewMat3f);this.modelNormal=q.getField(y.VertexAttribute.MODELNORMAL,f.BufferViewMat3f);this.modelScaleFactors=q.getField(y.VertexAttribute.MODELSCALEFACTORS,f.BufferViewVec2f);this.boundingSphere=q.getField(y.VertexAttribute.BOUNDINGSPHERE,f.BufferViewVec4f64);this.color=q.getField(y.VertexAttribute.COLOR,f.BufferViewVec4f);this.featureAttribute=
q.getField(y.VertexAttribute.FEATUREATTRIBUTE,f.BufferViewVec4f);this.state=q.getField(y.VertexAttribute.STATE,f.BufferViewUint8);this.lodLevel=q.getField(y.VertexAttribute.LODLEVEL,f.BufferViewUint8)};c=function(q){function z(B,A){var E=q.call(this)||this;E._capacity=0;E._size=0;E._next=0;{let C=k.newLayout().mat4f64(y.VertexAttribute.LOCALTRANSFORM).mat4f64(y.VertexAttribute.GLOBALTRANSFORM).vec4f64(y.VertexAttribute.BOUNDINGSPHERE).vec3f64(y.VertexAttribute.MODELORIGIN).mat3f(y.VertexAttribute.MODEL).mat3f(y.VertexAttribute.MODELNORMAL).vec2f(y.VertexAttribute.MODELSCALEFACTORS);
0<=B.indexOf("color")&&(C=C.vec4f(y.VertexAttribute.COLOR));0<=B.indexOf("featureAttribute")&&(C=C.vec4f(y.VertexAttribute.FEATUREATTRIBUTE));B=C=C.u8(y.VertexAttribute.STATE).u8(y.VertexAttribute.LODLEVEL).alignTo(8)}E._layout=B;E._shaderTransformation=A;return E}b._inheritsLoose(z,q);var v=z.prototype;v.addInstance=function(){this._size+1>this._capacity&&this._grow();const B=this._findSlot();this._view.state.set(B,a.StateFlags.ALLOCATED);this._size++;this.emit("instance-added",{index:B});return B};
v.removeInstance=function(B){const A=this._view.state;r.assert(0<=B&&B<this._capacity&&A.get(B)&a.StateFlags.ALLOCATED,"invalid instance handle");this._getStateFlag(B,a.StateFlags.ACTIVE)?this._setStateFlags(B,a.StateFlags.REMOVE):this.freeInstance(B);this.emit("instance-removed",{index:B})};v.freeInstance=function(B){const A=this._view.state;r.assert(0<=B&&B<this._capacity&&A.get(B)&a.StateFlags.ALLOCATED,"invalid instance handle");A.set(B,0);this._size--};v.setLocalTransform=function(B,A,E=!0){this._view.localTransform.setMat(B,
A);E&&this.updateModelTransform(B)};v.getLocalTransform=function(B,A){this._view.localTransform.getMat(B,A)};v.setGlobalTransform=function(B,A,E=!0){this._view.globalTransform.setMat(B,A);E&&this.updateModelTransform(B)};v.getGlobalTransform=function(B,A){this._view.globalTransform.getMat(B,A)};v.updateModelTransform=function(B){const A=this._view;var E=h;const C=m;A.localTransform.getMat(B,u);A.globalTransform.getMat(B,t);const D=x.multiply(t,t,u);l.set(E,D[12],D[13],D[14]);A.modelOrigin.setVec(B,
E);d.fromMat4(C,D);A.model.setMat(B,C);E=e.scaleFromMatrix(h,D);E.sort();A.modelScaleFactors.set(B,0,E[1]);A.modelScaleFactors.set(B,1,E[2]);d.invert(C,C);d.transpose(C,C);A.modelNormal.setMat(B,C);this._setStateFlags(B,a.StateFlags.TRANSFORM_CHANGED);this.emit("instance-transform-changed",{index:B})};v.getModelTransform=function(B,A){const E=this._view;E.model.getMat(B,m);E.modelOrigin.getVec(B,h);A[0]=m[0];A[1]=m[1];A[2]=m[2];A[3]=0;A[4]=m[3];A[5]=m[4];A[6]=m[5];A[7]=0;A[8]=m[6];A[9]=m[7];A[10]=
m[8];A[11]=0;A[12]=h[0];A[13]=h[1];A[14]=h[2];A[15]=1};v.applyShaderTransformation=function(B,A){this._shaderTransformation&&this._shaderTransformation.applyTransform(this,B,A)};v.getCombinedModelTransform=function(B,A){this.getModelTransform(B,A);this._shaderTransformation&&this._shaderTransformation.applyTransform(this,B,A);return A};v.getCombinedLocalTransform=function(B,A){this._view.localTransform.getMat(B,A);this._shaderTransformation&&this._shaderTransformation.applyTransform(this,B,A);return A};
v.getCombinedMaxScaleFactor=function(B){let A=this._view.modelScaleFactors.get(B,1);this._shaderTransformation&&(B=this._shaderTransformation.scaleFactor(h,this,B),A*=Math.max(B[0],B[1],B[2]));return A};v.getCombinedMedianScaleFactor=function(B){let A=this._view.modelScaleFactors.get(B,0);this._shaderTransformation&&(B=this._shaderTransformation.scaleFactor(h,this,B),B.sort(),A*=B[1]);return A};v.getModel=function(B,A){this._view.model.getMat(B,A)};v.setFeatureAttribute=function(B,A){this._view.featureAttribute.setVec(B,
A)};v.getFeatureAttribute=function(B,A){this._view.featureAttribute.getVec(B,A)};v.setColor=function(B,A){this._view.color.setVec(B,A)};v.getColor=function(B,A){this._view.color.getVec(B,A)};v.setVisible=function(B,A){A!==this.getVisible(B)&&(this._setStateFlag(B,a.StateFlags.VISIBLE,A),this.emit("instance-visibility-changed",{index:B}))};v.getVisible=function(B){return this._getStateFlag(B,a.StateFlags.VISIBLE)};v.setHighlight=function(B,A){A!==this.getHighlight(B)&&(this._setStateFlag(B,a.StateFlags.HIGHLIGHT,
A),this.emit("instance-highlight-changed",{index:B}))};v.getHighlight=function(B){return this._getStateFlag(B,a.StateFlags.HIGHLIGHT)};v.getState=function(B){return this._view.state.get(B)};v.getLodLevel=function(B){return this._view.lodLevel.get(B)};v.countFlags=function(B){let A=0;for(let E=0;E<this._capacity;++E)this.getState(E)&B&&++A;return A};v._setStateFlags=function(B,A){const E=this._view.state;A|=E.get(B);E.set(B,A)};v._clearStateFlags=function(B,A){const E=this._view.state;A=E.get(B)&~A;
E.set(B,A)};v._setStateFlag=function(B,A,E){E?this._setStateFlags(B,A):this._clearStateFlags(B,A)};v._getStateFlag=function(B,A){return!!(this._view.state.get(B)&A)};v._grow=function(){const B=Math.max(1024,Math.floor(2*this._capacity)),A=this._layout.createBuffer(B);if(this._buffer){const E=new Uint8Array(this._buffer.buffer);(new Uint8Array(A.buffer)).set(E)}this._capacity=B;this._buffer=A;this._view=new p(this._buffer)};v._findSlot=function(){const B=this._view.state;let A=this._next;for(;B.get(A)&
a.StateFlags.ALLOCATED;)A=(A+1)%this._capacity;this._next=(A+1)%this._capacity;return A};b._createClass(z,[{key:"capacity",get:function(){return this._capacity}},{key:"size",get:function(){return this._size}},{key:"buffer",get:function(){return this._buffer.buffer}},{key:"view",get:function(){return this._view}}]);return z}(c);const h=n.create(),m=g.create(),u=w.create(),t=w.create();a.InstanceData=c;a.InstanceDataView=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceOctree":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/sphere ../../../support/mathUtils ../Octree".split(" "),
function(a,b,c,d,g,x,w){w=function(l){function n(e,k){var r=l.call(this,y=>g.wrap(r._instanceData.view.boundingSphere.getVec(y,r._tmpSphere)),{maximumDepth:25})||this;r._tmpSphere=g.create();r._tmpMat4=c.create();r._instanceData=e;r._boundingSphere=k;return r}b._inheritsLoose(n,l);var f=n.prototype;f.addInstance=function(e){const k=this._instanceData.view.boundingSphere,r=this._instanceData.getCombinedModelTransform(e,this._tmpMat4);d.transformMat4(this._tmpSphere,this._boundingSphere.center,r);this._tmpSphere[3]=
this._boundingSphere.radius*x.maxScale(r);k.setVec(e,this._tmpSphere);this.add([e])};f.removeInstance=function(e){this.remove([e])};return n}(w.default);a.InstanceOctree=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/LevelSelector":function(){define(["exports","../Camera"],function(a,b){let c=function(){function d(x,w){this.thresholdScale=1;this._camera=new b.default;this._worldSpaceRadius=x;this._thresholds=w.map(l=>l)}var g=d.prototype;g.updateCamera=
function(x){this._camera.copyFrom(x)};g.selectLevel=function(x,w){x=this._camera.computeScreenPixelSizeAt(x);w=this._worldSpaceRadius*w/x;x=this._thresholds;let l=-1;for(let n=0;n<x.length;++n)w>=x[n]*this.thresholdScale&&(l=n);return l};return d}();a.LevelSelector=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodLevel":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../chunks/vec3f64 ../../../../../geometry/support/aaBoundingBox ./LodComponentData".split(" "),
function(a,b,c,d,g,x,w){let l=function(){function n(e,k){this.minScreenSpaceRadius=e;this.components=k}n.create=function(){var e=b._asyncToGenerator(function*(k,r,y){const p=yield Promise.allSettled(r.components.map(m=>k.schedule(()=>new w.LodComponentData(k,m),y))),h=p.map(m=>"fulfilled"===m.status?m.value:null).filter(m=>m);if(d.isAborted(y)||h.length!==p.length){h.forEach(m=>m.destroy());d.throwIfAborted(y);for(const m of p)if("rejected"===m.status)throw m.reason;}return new n(r.minScreenSpaceRadius,
h)});return function(k,r,y){return e.apply(this,arguments)}}();var f=n.prototype;f.destroy=function(){this.components.forEach(e=>e.destroy())};f.intersect=function(e,k,r,y,p,h){this.components.forEach(m=>m.intersect(e,k,r,y,p,h))};b._createClass(n,[{key:"boundingBox",get:function(){if(c.isNone(this._boundingBox)){const e=x.empty();this.components.forEach(k=>{c.isSome(k.boundingInfo)&&(x.expandWithVec3(e,k.boundingInfo.bbMin),x.expandWithVec3(e,k.boundingInfo.bbMax))});this._boundingBox=e}return this._boundingBox}},
{key:"boundingSphere",get:function(){if(c.isNone(this._boundingSphere)){const e=this.boundingBox,k=g.create();x.center(e,k);this._boundingSphere={center:k,radius:.5*x.diameter(e)}}return this._boundingSphere}},{key:"triangleCount",get:function(){return this.components.reduce((e,k)=>e+k.triangleCount,0)}}]);return n}();a.LodLevel=l;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodComponentData":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../support/buffer/glUtil ../DefaultVertexAttributeLocations ../GLMaterials ../Intersector ../IntersectorInterfaces ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject".split(" "),
function(a,b,c,d,g,x,w,l,n,f){let e=function(){function k(y,p){const h=y.renderContext.rctx,{geometry:m,material:u}=p;this._materialRepository=y.materialRep;u.setParameters({instancedDoublePrecision:!0});y=u.createBufferWriter();p=y.vertexBufferLayout;const t=y.elementCount(m),q=y.allocate(t);y.write({},m,q,0);this.geometry=m;this.material=u;this.glMaterials=new g.GLMaterials(u,this._materialRepository);this.vertexBufferLayout=p;this.vbo=l.BufferObject.createVertex(h,n.Usage.STATIC_DRAW,q.buffer);
this.vao=new f.VertexArrayObject(h,d.Default3D,{geometry:c.glLayout(p)},{geometry:this.vbo});this.vertexCount=t}var r=k.prototype;r.destroy=function(){this.glMaterials.destroy();this.vbo.dispose();this.vao.dispose()};r.intersect=function(y,p,h,m,u,t){const q=this.geometry.id;this.material.intersect(this.geometry,null,y.transform.transform,y,h,m,(z,v,B,A,E)=>{0<=z&&(null==p||p(y.rayBegin,y.rayEnd,z))&&(B={layerUid:t.layerUid,graphicUid:t.graphicUid(u),geometryId:q,triangleNr:B},(null==y.results.min.drapedLayerOrder||
E>=y.results.min.drapedLayerOrder)&&(null==y.results.min.dist||z<y.results.min.dist)&&y.results.min.set(w.IntersectorType.LOD,B,z,v,y.transform.transform,E),y.options.store!==w.StoreResults.MIN&&(null==y.results.max.drapedLayerOrder||E>=y.results.max.drapedLayerOrder)&&(null==y.results.max.dist||z>y.results.max.dist)&&y.results.max.set(w.IntersectorType.LOD,B,z,v,y.transform.transform,E),y.options.store===w.StoreResults.ALL&&(A=x.newIntersectorResult(y.results.min.ray),A.set(w.IntersectorType.LOD,
B,z,v,y.transform.transform,E),y.results.all.push(A)))})};b._createClass(k,[{key:"boundingInfo",get:function(){return this.geometry.boundingInfo}},{key:"triangleCount",get:function(){return this.vertexCount/3}}]);return k}();a.LodComponentData=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/RenderInstanceData":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../geometry/support/buffer/BufferView ../Util ../VertexAttribute ./BackedBufferObject".split(" "),
function(a,b,c,d,g,x){let w=function(n){this.modelOriginHi=n.getField(g.VertexAttribute.MODELORIGINHI,c.BufferViewVec3f);this.modelOriginLo=n.getField(g.VertexAttribute.MODELORIGINLO,c.BufferViewVec3f);this.model=n.getField(g.VertexAttribute.MODEL,c.BufferViewMat3f);this.modelNormal=n.getField(g.VertexAttribute.MODELNORMAL,c.BufferViewMat3f);this.color=n.getField(g.VertexAttribute.INSTANCECOLOR,c.BufferViewVec4f);this.featureAttribute=n.getField(g.VertexAttribute.INSTANCEFEATUREATTRIBUTE,c.BufferViewVec4f)},
l=function(){function n(e,k){this._tailIndex=this._headIndex=0;this._captureFirstIndex=!0;this._updating=!1;this._prevHeadIndex=0;this._resized=!1;this._rctx=e;this._instanceBufferLayout=k;this._elementSize=k.stride;this._capacity=1}var f=n.prototype;f.destroy=function(){this._buffer&&this._buffer.destroy()};f.reset=function(){this._tailIndex=this._headIndex=0;this._firstIndex=null};f.startUpdateCylce=function(){this._captureFirstIndex=!0};f.beginUpdate=function(){d.assert(!this._updating,"already updating");
this._updating=!0;this._prevHeadIndex=this._headIndex};f.endUpdate=function(){d.assert(this._updating,"not updating");this.size<.3*this.capacity&&this._shrink();this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex);this._updating=!1};f.allocateHead=function(){d.assert(this._updating,"not updating");this.isFull&&this._grow();const e=this.headIndex;this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1);this._incrementHead();
d.assert(this._headIndex!==this._tailIndex,"invalid pointers");return e};f.freeTail=function(){d.assert(this._updating,"not updating");d.assert(0<this.size,"invalid size");const e=this._tailIndex===this._firstIndex;this._incrementTail();e&&(this._firstIndex=this._tailIndex)};f._grow=function(){this._resize(Math.max(1024,Math.floor(2*this._capacity)))};f._shrink=function(){this._resize(Math.max(1024,Math.floor(.5*this._capacity)))};f._resize=function(e){d.assert(this._updating,"not updating");if(e!==
this._capacity){var k=new x(this._rctx,this._elementSize,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const r=this.size,y=this._compactInstances(k);d.assert(y===r,"invalid compaction");this._buffer.destroy();this._tailIndex=0;this._headIndex=y;this._prevHeadIndex=0}this._resized=!0;this._capacity=e;this._buffer=k;this._view=new w(this._instanceBufferLayout.createView(this._buffer.array))}};f._compactInstances=function(e){const k=
this._headIndex,r=this._tailIndex;return r<k?(this._buffer.copyRange(r,k,e),k-r):r>k?(this._buffer.copyRange(r,this._capacity,e),0<k&&this._buffer.copyRange(0,k,e,this._capacity-r),k+(this._capacity-r)):0};f._incrementHead=function(e=1){this._headIndex=(this._headIndex+e)%this._capacity};f._incrementTail=function(e=1){this._tailIndex=(this._tailIndex+e)%this._capacity};f._transferRange=function(e,k){e<k?this._buffer.transferRange(e,k):e>k&&(0<k&&this._buffer.transferRange(0,k),this._buffer.transferRange(e,
this._capacity))};b._createClass(n,[{key:"buffer",get:function(){return this._buffer.buffer}},{key:"view",get:function(){return this._view}},{key:"capacity",get:function(){return this._capacity}},{key:"size",get:function(){const e=this._headIndex,k=this._tailIndex;return e>=k?e-k:e+this._capacity-k}},{key:"isEmpty",get:function(){return this._headIndex===this._tailIndex}},{key:"isFull",get:function(){return this._tailIndex===(this._headIndex+1)%this._capacity}},{key:"headIndex",get:function(){return this._headIndex}},
{key:"tailIndex",get:function(){return this._tailIndex}},{key:"firstIndex",get:function(){return this._firstIndex}},{key:"memoryUsage",get:function(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}}]);return n}();a.RenderInstanceData=l;a.RenderInstanceDataView=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/BackedBufferObject":function(){define(["../../../../../chunks/_rollupPluginBabelHelpers","../../../../webgl/BufferObject","../../../../webgl/enums"],
function(a,b,c){return function(){function d(x,w,l){this._elementSize=w;this._buffer=b.BufferObject.createVertex(x,c.Usage.STATIC_DRAW);this.resize(l)}var g=d.prototype;g.destroy=function(){this._buffer.dispose()};g.copyRange=function(x,w,l,n=0){x=new Uint8Array(this.array,x*this.elementSize,(w-x)*this.elementSize);(new Uint8Array(l.array,n*this.elementSize)).set(x)};g.transferAll=function(){this._buffer.setData(this._array)};g.transferRange=function(x,w){x*=this._elementSize;this._buffer.setSubData(this._array,
x,x,w*this._elementSize)};g.resize=function(x){const w=x*this._elementSize,l=new ArrayBuffer(w);this._array&&(x>=this._capacity?(new Uint8Array(l)).set(new Uint8Array(this._array)):(new Uint8Array(l)).set((new Uint8Array(this._array)).subarray(0,x*this._elementSize)));this._array=l;this._buffer.setSize(w);this._capacity=x};a._createClass(d,[{key:"elementSize",get:function(){return this._elementSize}},{key:"capacity",get:function(){return this._capacity}},{key:"array",get:function(){return this._array}},
{key:"buffer",get:function(){return this._buffer}},{key:"memoryUsage",get:function(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}}]);return d}()})},"esri/views/3d/layers/graphics/Graphics3DPathSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Error ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/mat2 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f32 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ../support/FastSymbolUpdates ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/PathGeometry ../../webgl-engine/lib/pathGeometryUtils ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/PathMaterial".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E,C,D){function F(N,T,S){switch(T){case "world":for(const H of N.vertices)n.add(U,H.pos,N.offset),S.worldUpAtPosition(U,M),H.setFrameFromUpVector(M),H.computeRotationAxisAndAngleFromUpVector();break;case "path":n.add(U,N.vertices[0].pos,N.offset);S.worldUpAtPosition(U,M);E.computeMinimumRotationTangentFrame(N,M);for(const H of N.vertices)N=Math.sign(n.dot(H.frame.right,H.vRight)),n.cross(H.rotationFrame.up,H.vRight,H.vLeft),n.scale(H.rotationFrame.up,
H.rotationFrame.up,N),n.normalize(H.rotationFrame.up,H.rotationFrame.up),T=n.dot(H.rotationFrame.up,H.frame.up),S=n.dot(H.rotationFrame.up,H.frame.right),n.scale(U,H.frame.up,-S),n.scale(R,H.frame.right,T),n.add(U,U,R),n.normalize(H.rotationFrame.right,U),E.vertexSpaceToProfileSpace(H.rotationRight,H.frame,H.rotationFrame.right),n.negate(U,H.vLeft),H.rotationAngle=-N*(Math.PI-d.acosClamped(n.dot(U,H.vRight))),0<Math.abs(H.rotationAngle)&&(N=d.reciprocalClamped(Math.cos(.5*H.rotationAngle)),x.set(H.miterStretch,
1+(N-1)*H.rotationRight[0]*H.rotationRight[0],(N-1)*H.rotationRight[0]*H.rotationRight[1],(N-1)*H.rotationRight[0]*H.rotationRight[1],1+(N-1)*H.rotationRight[1]*H.rotationRight[1])),H.maxStretchDistance=Math.abs(Math.min(H.vLeftLength,H.vRightLength)*d.reciprocalClamped(Math.cos(.5*(Math.PI-H.rotationAngle))))}}function G(N,T,S){switch(N){case "symbol-value":return S;case "proportional":return T;default:return N}}function J(N,T,S,H){N=N.stageObject;const Q=N.geometryRecords;var W=0;P.spatialReference=
H.spatialReference;for(const ba of Q){const ha=ba.geometry;if(!A.isPathGeometry(ha))continue;const ka=ha.path,ia=ka.builder.path;K.spatialReference=ha.geometrySR;{var V=ia;var Y=T,aa=S,X=H;let ea=0;for(const ca of V.vertices)p.evaluateElevationInfoAtPoint(ca.posES,aa,Y,X,L),ea+=L.sampledElevation,n.add(M,ca.pos,V.offset),X.setAltitude(M,L.z),n.subtract(ca.pos,M,V.offset);V.updatePathVertexInformation();V=ea/V.vertices.length}W+=V;"world"!==ha.upVectorAlignment&&F(ia,ha.upVectorAlignment,H);ka.onPathChanged();
ha.invalidateBoundingInfo();N.geometryVertexAttrsUpdated(ba)}return W/Q.length}const I=["polyline"];let O=function(N){function T(H,Q,W,V){H=N.call(this,H,Q,W,V)||this;H._intrinsicSize=l.fromValues(1,1);H.upVectorAlignment="path";H.stencilWidth=.1;H.ensureDrapedStatus(!1);return H}b._inheritsLoose(T,N);var S=T.prototype;S.doLoad=function(){var H=b._asyncToGenerator(function*(){const Q=g.isSome(this.symbolLayer.width)?this.symbolLayer.width:this.symbolLayer.height,W=g.isSome(this.symbolLayer.height)?
this.symbolLayer.height:Q;this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[Q,1,W],unitInMeters:this._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}};this._fastUpdates=this._context.renderer&&this._context.renderer.visualVariables&&0<this._context.renderer.visualVariables.length?z.initFastSymbolUpdatesState(this._context.renderer,this._vvConvertOptions):{enabled:!1};var V=this.symbolLayer.anchor||
"center";this.upVectorAlignment="path";"heading"===this.symbolLayer.profileRotation&&(this.upVectorAlignment="world");var Y=this.symbolLayer.profile||"circle";switch(Y){default:this._profile=E.Profile.circle(10);break;case "quad":this._profile=E.Profile.rect()}var aa=[0,0];"center"!==V&&(aa={left:[.5,0],right:[-.5,0],top:[0,-.5],bottom:[0,.5]}[V],this._profile.translate(aa[0],aa[1]));switch(this.symbolLayer.join||"simple"){case "round":this._extruder=new E.MiterExtruder(0,3);break;case "bevel":this._extruder=
new E.MiterExtruder(0,1);break;case "miter":this._extruder=new E.MiterExtruder(.8*Math.PI,1);break;default:this._extruder=new E.SimpleExtruder}V=this.symbolLayer.cap||"butt";switch(V){case "none":this._startCap=new E.NoCapBuilder;this._endCap=new E.NoCapBuilder;break;default:this._startCap=new E.TriangulationCapBuilder(this._profile,0);this._endCap=new E.TriangulationCapBuilder(this._profile,0,!0);break;case "square":this._startCap=new E.TriangulationCapBuilder(this._profile,-.5);this._endCap=new E.TriangulationCapBuilder(this._profile,
.5,!0);break;case "round":Y="quad"===Y?!0:!1,this._startCap=new E.RoundCapBuilder({profile:this._profile,flip:!1,breakNormals:Y,subdivisions:3}),this._endCap=new E.RoundCapBuilder({profile:this._profile,flip:!0,breakNormals:Y,subdivisions:3})}Y=g.get(this.symbolLayer,"material","color");aa=this._getCombinedOpacityAndColor(Y);Y=e.fromArray(aa);aa=aa[3];const X=1>aa||this.needsDrivenTransparentPass;V={diffuse:Y,ambient:Y,opacity:aa,transparent:X,vertexColors:!1,slicePlaneEnabled:this._context.slicePlaneEnabled,
castShadows:this.symbolLayer.castShadows,cullFace:X||"none"===V?v.CullFaceOptions.None:v.CullFaceOptions.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(w.set(this._intrinsicSize,Q,W),!t.isValidSize(this._intrinsicSize[0])||!t.isValidSize(this._intrinsicSize[1])))throw new c("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||w.scale(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters);
this._fastUpdates.enabled?(Object.assign(V,this._fastUpdates.materialParameters,{size:[this._intrinsicSize[0],this._intrinsicSize[1],0]}),this._material=new D.PathMaterial(V)):(V.vertexColors=this._drivenProperties.color||this._drivenProperties.opacity,this._material=new C.DefaultMaterial(V));this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});this._context.stage.add(this._material)});return function(){return H.apply(this,arguments)}}();S.destroy=function(){N.prototype.destroy.call(this);
this._context.stage.remove(this._material);this._material=null};S.createGraphics3DGraphic=function(H){const Q=H.graphic;if(!this._validateGeometry(Q.geometry,I,this.symbolLayer.type))return null;const W=this.setGraphicElevationContext(Q,new h.ElevationContext);return this._createAs3DShape(Q,H.renderingInfo,W,Q.uid)};S.layerOpacityChanged=function(){var H=g.get(this.symbolLayer,"material","color");H=this._getCombinedOpacity(H);this._material.setParameters({opacity:H,transparent:1>H||this.needsDrivenTransparentPass});
return!0};S.layerElevationInfoChanged=function(H,Q){return this.updateGraphics3DGraphicElevationInfo(H,Q,p.needsElevationUpdates3D)};S.slicePlaneEnabledChanged=function(){this._material.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};S.physicalBasedRenderingChanged=function(){this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});return!0};S.pixelRatioChanged=function(){return!0};S.applyRendererDiff=function(H,Q){for(const W in H.diff)switch(W){case "visualVariables":if(z.updateFastSymbolUpdatesState(this._fastUpdates,
Q,this._vvConvertOptions))this._material.setParameters(this._fastUpdates.materialParameters);else return q.ApplyRendererDiffResult.Recreate_Symbol;break;default:return q.ApplyRendererDiffResult.Recreate_Symbol}return q.ApplyRendererDiffResult.Fast_Update};S.getVertexData=function(H){let Q=0;const W=H.paths,V=[],Y=H.spatialReference,aa=this._context.elevationProvider.spatialReference,X=this._context.renderCoordsHelper.spatialReference;for(var ba of W)Q+=ba.length;ba=new Float64Array(3*Q);const ha=
new Float64Array(3*Q),ka=new Float64Array(3*Q);let ia=0;for(const ea of W){V.push({index:ia,numVertices:ea.length});for(const ca of ea)ba[ia++]=ca[0],ba[ia++]=ca[1],ba[ia++]=H.hasZ?ca[2]:0}H=!0;Y.equals(aa)?this._copyVertices(ba,0,ha,0,Q):H=k.projectBuffer(ba,Y,0,ha,aa,0,Q);aa.equals(X)?this._copyVertices(ha,0,ka,0,Q):k.projectBuffer(ha,aa,0,ka,X,0,Q);return{pathVertexDataInfos:V,vertexDataGS:ba,vertexDataES:ha,vertexDataRS:ka,projectionSuccess:H,terrainElevation:0}};S._copyVertices=function(H,Q,
W,V,Y){Q*=3;V*=3;for(let aa=0;aa<Y;++aa)W[V++]=H[Q++],W[V++]=H[Q++],W[V++]=H[Q++]};S._createAs3DShape=function(H,Q,W,V){var Y=H.geometry,aa=[];const X=[],ba=[],ha=Y.spatialReference,ka=r.create(),ia=this._context.renderCoordsHelper;K.spatialReference=ha;const ea=this.getVertexData(Y);if(!ea.projectionSuccess)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(0<ea.pathVertexDataInfos.length){for(Y=0;Y<ea.pathVertexDataInfos.length;++Y){var ca=
ea.pathVertexDataInfos[Y],Z=ca.index;ca=ca.numVertices;if(2>ca)continue;if(g.isSome(this._context.clippingExtent)&&(r.empty(ka),r.expandWithBuffer(ka,ea.vertexDataES,3*Z,ca),!r.intersectsClippingArea(ka,this._context.clippingExtent)))continue;var fa=[];for(var ja=Z;ja<Z+3*ca;){const ra=ja++,va=ja++,ya=ja++,za=new E.PathVertex;n.set(za.posGS,ea.vertexDataGS[ra],ea.vertexDataGS[va],ea.vertexDataGS[ya]);n.set(za.posES,ea.vertexDataES[ra],ea.vertexDataES[va],ea.vertexDataES[ya]);const pa=p.evaluateElevationAlignmentAtPoint(za.posES,
this._context.elevationProvider,W,ia);n.set(M,ea.vertexDataRS[ra],ea.vertexDataRS[va],ea.vertexDataRS[ya]);ia.setAltitude(M,pa);n.set(za.pos,M[0],M[1],M[2]);fa.push(za)}Z=new E.Path(fa);F(Z,this.upVectorAlignment,this._context.renderCoordsHelper);Z=new E.Builder(Z,this._profile,this._extruder,this._startCap,this._endCap);ca=null;this._fastUpdates.enabled?(ja=this._fastUpdates.visualVariables,ca=ja.size?u.getAttributeValue(ja.size.field,H):0,fa=ja.color?u.getAttributeValue(ja.color.field,H):0,ja=ja.opacity?
u.getAttributeValue(ja.opacity.field,H):0,ca=new E.FastUpdatePathGeometry(Z,ca,fa,ja)):(ca=[this._intrinsicSize[0],this._intrinsicSize[1]],this._drivenProperties.size&&(ca[0]*=G(Q.size[0],"symbol-value"===Q.size[2]?this.symbolLayer.height||0:Q.size[2],this.symbolLayer.width||0),ca[1]*=G(Q.size[2],"symbol-value"===Q.size[0]?this.symbolLayer.width||0:Q.size[0],this.symbolLayer.height||0)),fa=null,this._drivenProperties.color&&(fa=Q.color),this._drivenProperties.opacity&&null!=Q.opacity&&(fa=fa?[fa[0],
fa[1],fa[2],Q.opacity]:[1,1,1,Q.opacity]),Z=new E.StaticPathGeometry(Z),Z.bake(ca),fa&&Z.bakeVertexColors(fa),ca=Z);const {vertexAttributes:la,indices:ma}=ca.createGeometryData();Z=new A.PathGeometry(la,ma,ca,ha,this.upVectorAlignment,this.stencilWidth);aa.push(Z);X.push(this._material);ba.push(ca.xform)}if(0<aa.length)return H=new B.Object3D({geometries:aa,materials:X,transformations:ba,metadata:{layerUid:this._context.layer.uid,graphicUid:V}}),aa=new m.Graphics3DObject3DGraphicLayer(this,H,aa,null,
null,J,W),aa.alignedSampledElevation=ea.terrainElevation,aa.needsElevationUpdates=p.needsElevationUpdates3D(W.mode),aa}else 0!==Y.paths.length&&Y.paths.some(la=>0<la.length)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)");return null};return T}(u.Graphics3DSymbolLayer);const P=y.makeDehydratedPoint(0,0,0,null),K=y.makeDehydratedPoint(0,0,0,null),M=e.create(),U=f.create(),R=f.create(),L=new p.SampleElevationInfo;a.Graphics3DPathSymbolLayer=O;a.NUM_CIRCLE_PROFILE_SUBDIVISIONS=
10;a.NUM_ROUND_CAP_EXTRUSION_SUBDIVISIONS=3;a.NUM_ROUND_JOIN_SUBDIVISIONS=3;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/mat2":function(){define(["exports","./common"],function(a,b){function c(E,C){E[0]=C[0];E[1]=C[1];E[2]=C[2];E[3]=C[3];return E}function d(E){E[0]=1;E[1]=0;E[2]=0;E[3]=1;return E}function g(E,C,D,F,G){E[0]=C;E[1]=D;E[2]=F;E[3]=G;return E}function x(E,C){if(E===C){const D=C[1];E[1]=C[2];E[2]=D}else E[0]=C[0],E[1]=C[2],E[2]=C[1],E[3]=C[3];return E}function w(E,C){const D=
C[0],F=C[1],G=C[2];C=C[3];let J=D*C-G*F;if(!J)return null;J=1/J;E[0]=C*J;E[1]=-F*J;E[2]=-G*J;E[3]=D*J;return E}function l(E,C){const D=C[0];E[0]=C[3];E[1]=-C[1];E[2]=-C[2];E[3]=D;return E}function n(E){return E[0]*E[3]-E[2]*E[1]}function f(E,C,D){const F=C[0],G=C[1],J=C[2];C=C[3];const I=D[0],O=D[1],P=D[2];D=D[3];E[0]=F*I+J*O;E[1]=G*I+C*O;E[2]=F*P+J*D;E[3]=G*P+C*D;return E}function e(E,C,D){const F=C[0],G=C[1],J=C[2];C=C[3];const I=Math.sin(D);D=Math.cos(D);E[0]=F*D+J*I;E[1]=G*D+C*I;E[2]=F*-I+J*D;
E[3]=G*-I+C*D;return E}function k(E,C,D){const F=C[1],G=C[2],J=C[3],I=D[0];D=D[1];E[0]=C[0]*I;E[1]=F*I;E[2]=G*D;E[3]=J*D;return E}function r(E,C){const D=Math.sin(C);C=Math.cos(C);E[0]=C;E[1]=D;E[2]=-D;E[3]=C;return E}function y(E,C){E[0]=C[0];E[1]=0;E[2]=0;E[3]=C[1];return E}function p(E){return"mat2("+E[0]+", "+E[1]+", "+E[2]+", "+E[3]+")"}function h(E){return Math.sqrt(E[0]**2+E[1]**2+E[2]**2+E[3]**2)}function m(E,C,D,F){E[2]=F[2]/F[0];D[0]=F[0];D[1]=F[1];D[3]=F[3]-E[2]*D[1];return[E,C,D]}function u(E,
C,D){E[0]=C[0]+D[0];E[1]=C[1]+D[1];E[2]=C[2]+D[2];E[3]=C[3]+D[3];return E}function t(E,C,D){E[0]=C[0]-D[0];E[1]=C[1]-D[1];E[2]=C[2]-D[2];E[3]=C[3]-D[3];return E}function q(E,C){return E[0]===C[0]&&E[1]===C[1]&&E[2]===C[2]&&E[3]===C[3]}function z(E,C){const D=E[0],F=E[1],G=E[2];E=E[3];const J=C[0],I=C[1],O=C[2];C=C[3];return Math.abs(D-J)<=b.EPSILON*Math.max(1,Math.abs(D),Math.abs(J))&&Math.abs(F-I)<=b.EPSILON*Math.max(1,Math.abs(F),Math.abs(I))&&Math.abs(G-O)<=b.EPSILON*Math.max(1,Math.abs(G),Math.abs(O))&&
Math.abs(E-C)<=b.EPSILON*Math.max(1,Math.abs(E),Math.abs(C))}function v(E,C,D){E[0]=C[0]*D;E[1]=C[1]*D;E[2]=C[2]*D;E[3]=C[3]*D;return E}function B(E,C,D,F){E[0]=C[0]+D[0]*F;E[1]=C[1]+D[1]*F;E[2]=C[2]+D[2]*F;E[3]=C[3]+D[3]*F;return E}const A=Object.freeze({__proto__:null,copy:c,identity:d,set:g,transpose:x,invert:w,adjoint:l,determinant:n,multiply:f,rotate:e,scale:k,fromRotation:r,fromScaling:y,str:p,frob:h,LDU:m,add:u,subtract:t,exactEquals:q,equals:z,multiplyScalar:v,multiplyScalarAndAdd:B,mul:f,
sub:t});a.LDU=m;a.add=u;a.adjoint=l;a.copy=c;a.determinant=n;a.equals=z;a.exactEquals=q;a.frob=h;a.fromRotation=r;a.fromScaling=y;a.identity=d;a.invert=w;a.mat2=A;a.mul=f;a.multiply=f;a.multiplyScalar=v;a.multiplyScalarAndAdd=B;a.rotate=e;a.scale=k;a.set=g;a.str=p;a.sub=t;a.subtract=t;a.transpose=x})},"esri/views/3d/webgl-engine/lib/PathGeometry":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./Geometry"],function(a,b,c){c=function(d){function g(x,w,l,n,f,e){x=d.call(this,
x,w)||this;x.path=l;x.geometrySR=n;x.upVectorAlignment=f;x.stencilWidth=e;return x}b._inheritsLoose(g,d);return g}(c.Geometry);a.PathGeometry=c;a.isPathGeometry=function(d){return"upVectorAlignment"in d};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/pathGeometryUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../chunks/mat2 ../../../../chunks/mat2f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/plane ../../../../geometry/support/ray ./GeometryUtil ./VertexAttribute ../materials/internal/MaterialUtil".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h){function m(){return{up:e.create(),right:e.create()}}let u=function(){function Q(){this.pos=e.create();this.posES=e.create();this.posGS=e.create();this.vRight=e.create();this.vLeft=e.create();this.frame=m();this.rotationFrame=m();this.rotationRight=n.create();this.rotationAngle=0;this.miterStretch=g.create()}var W=Q.prototype;W.setFrameFromUpVector=function(V){f.copy(this.frame.up,V);f.add(R,this.vLeft,this.vRight);f.normalize(R,R);f.scale(U,this.frame.up,
f.dot(R,this.frame.up));f.subtract(T,R,U);f.normalize(T,T);f.cross(this.frame.right,T,this.frame.up)};W.computeRotationAxisAndAngleFromUpVector=function(){f.copy(this.rotationFrame.up,this.frame.up);f.copy(this.rotationFrame.right,this.frame.right);l.set(this.rotationRight,1,0);f.scale(U,this.frame.up,f.dot(this.frame.up,this.vLeft));f.subtract(U,this.vLeft,U);f.negate(U,U);f.normalize(U,U);f.scale(R,this.frame.up,f.dot(this.frame.up,this.vRight));f.subtract(R,this.vRight,R);f.normalize(R,R);f.cross(L,
this.rotationFrame.up,this.vLeft);this.rotationAngle=Math.sign(f.dot(L,this.vRight))*(Math.PI-c.acosClamped(f.dot(U,R)));if(0<Math.abs(this.rotationAngle)){const V=c.reciprocalClamped(Math.cos(.5*this.rotationAngle));d.set(this.miterStretch,1+(V-1),0,0,1)}this.maxStretchDistance=Math.abs(Math.min(this.vLeftLength,this.vRightLength)/Math.cos(.5*(Math.PI-this.rotationAngle)))};return Q}(),t=function(){function Q(){this.vertices=[];this.vertexIndices=[];this.vertexNormals=[];this.poles=[];this.poleIndices=
[];this.uvIndices=this.uvs=null}var W=Q.prototype;W.addVertex=function(V,Y){this.vertices.push(n.clone(V));this.vertexNormals.push(n.clone(Y));return this.vertices.length-1};W.addUV=function(V){this.uvs||(this.uvs=[],this.uvIndices=[]);this.uvs.push(V);return this.uvs.length-1};W.addPole=function(V,Y=null){this.poles.push({position:n.clone(V),normal:Y?n.clone(Y):null});return this.poles.length-1};W.addSegment=function(V,Y=null,aa=null){this.vertexIndices.push(V.v0);this.vertexIndices.push(V.v1);Y&&
(this.uvIndices.push(Y.v0),this.uvIndices.push(Y.v1));aa&&(this.poleIndices.push(aa.v0),this.poleIndices.push(aa.v1))};W.hasUV=function(){return null!=this.uvs};W.translate=function(V,Y){for(const aa of this.vertices)aa[0]+=V,aa[1]+=Y;for(const aa of this.poles)aa.position[0]+=V,aa.position[1]+=Y};Q.circle=function(V=20){const Y=new Q,aa={v0:0,v1:0};Y.addPole(n.fromValues(0,0));for(var X=0;X<V;++X){var ba=2*X*Math.PI/V,ha=Math.cos(ba);const ka=Math.sin(ba);ba=n.fromValues(.5*ha,.5*ka);ha=n.fromValues(ha,
ka);Y.addVertex(ba,ha);Y.addUV(X/V)}Y.addUV(1);for(X=0;X<V-1;++X)ha={v0:X,v1:X+1},Y.addSegment(ha,ha,aa);Y.addSegment({v0:V-1,v1:0},{v0:V-1,v1:V},aa);return Y};Q.rect=function(){const V=new Q,Y=n.fromValues(-.5,-.5),aa=n.fromValues(.5,-.5),X=n.fromValues(.5,.5),ba=n.fromValues(-.5,.5),ha=n.fromValues(0,-1),ka=n.fromValues(1,0),ia=n.fromValues(0,1),ea=n.fromValues(-1,0);V.addUV(0);V.addUV(1);V.addPole(n.fromValues(0,.5),ia);V.addPole(n.fromValues(0,.5));V.addPole(n.fromValues(0,-.5));V.addPole(n.fromValues(0,
-.5),ha);const ca={v0:0,v1:1};V.addVertex(Y,ha);V.addVertex(aa,ha);V.addSegment({v0:0,v1:1},ca,{v0:3,v1:3});V.addVertex(aa,ka);V.addVertex(X,ka);V.addSegment({v0:2,v1:3},ca,{v0:2,v1:1});V.addVertex(X,ia);V.addVertex(ba,ia);V.addSegment({v0:4,v1:5},ca,{v0:0,v1:0});V.addVertex(ba,ea);V.addVertex(Y,ea);V.addSegment({v0:6,v1:7},ca,{v0:1,v1:2});return V};b._createClass(Q,[{key:"numSegments",get:function(){return this.vertexIndices.length/2}}]);return Q}(),q=function(){function Q(W){this.vertices=[];this.offset=
e.create();this.xform=w.create();this.vertices=W;f.copy(this.offset,this.vertices[Math.floor((W.length-1)/2)].pos);for(const V of this.vertices)f.subtract(V.pos,V.pos,this.offset);x.translate(this.xform,this.xform,this.offset);this.updatePathVertexInformation()}Q.prototype.updatePathVertexInformation=function(){const W=this.vertices.length;let V=this.vertices[0];V.index=0;f.set(V.vLeft,0,0,0);V.vLeftLength=0;f.subtract(V.vRight,this.vertices[1].pos,V.pos);V.vRightLength=f.length(V.vRight);f.normalize(V.vRight,
V.vRight);let Y=V;for(let aa=1;aa<W;++aa)V=this.vertices[aa],V.index=aa,f.copy(V.vLeft,Y.vRight),V.vLeftLength=Y.vRightLength,aa<W-1?(f.subtract(V.vRight,this.vertices[aa+1].pos,V.pos),V.vRightLength=f.length(V.vRight),f.normalize(V.vRight,V.vRight)):(f.copy(V.vRight,V.vLeft),V.vRightLength=V.vLeftLength),Y=V};return Q}(),z=function(){function Q(){}var W=Q.prototype;W.numProfilesPerJoin=function(){return 1};W.extrude=function(V,Y,aa){for(let X=0;X<Y.vertices.length;++X)aa(V.index,V.frame,Y.vertices[X],
Y.vertexNormals[X],!1)};return Q}(),v=function(){function Q(V=.8*Math.PI,Y=1){this.cutoffAngle=V;this.numBendSubdivisions=Y}var W=Q.prototype;W.numProfilesPerJoin=function(){return this.numBendSubdivisions+1};W.extrude=function(V,Y,aa){var X=S;if(Math.abs(V.rotationAngle)>=this.cutoffAngle)for(var ba=0;ba<this.numBendSubdivisions+1;++ba){x.fromRotation(H,.5*-V.rotationAngle+ba*V.rotationAngle/this.numBendSubdivisions,V.rotationFrame.up);var ha=X,ka=V.frame,ia=H;f.transformMat4(ha.up,ka.up,ia);f.transformMat4(ha.right,
ka.right,ia);for(ha=0;ha<Y.vertices.length;++ha)0<=l.dot(Y.vertices[ha],V.rotationRight)*V.rotationAngle?aa(V.index,X,Y.vertices[ha],Y.vertexNormals[ha],!1):(l.transformMat2(P,Y.vertices[ha],V.miterStretch),aa(V.index,V.frame,P,Y.vertexNormals[ha],!0))}else for(X=0;X<this.numBendSubdivisions+1;++X)for(ba=0;ba<Y.vertices.length;++ba)ha=0<=l.dot(Y.vertices[ba],V.rotationRight)*V.rotationAngle,l.transformMat2(P,Y.vertices[ba],V.miterStretch),aa(V.index,V.frame,P,Y.vertexNormals[ba],ha?!1:!0)};return Q}();
const B={generateUV:!1};let A=function(){function Q(){}Q.prototype.rebuildConnectingProfileGeometry=function(W,V,Y){for(let aa=0;aa<V.vertices.length;++aa)Y(W.index,W.frame,V.vertices[aa],V.vertexNormals[aa],0,0)};return Q}(),E=function(Q){function W(){return Q.call(this)||this}b._inheritsLoose(W,Q);var V=W.prototype;V.getNumVertices=function(){return 0};V.getNumIndices=function(){return 0};V.rebuildCapGeometry=function(){};V.buildTopology=function(){};return W}(A),C=function(Q){function W(Y,aa=0,
X=!1){var ba=Q.call(this)||this;ba.profile=Y;ba.profilePlaneOffset=aa;ba.flip=X;return ba}b._inheritsLoose(W,Q);var V=W.prototype;V.getNumVertices=function(){return this.profile.vertices.length};V.getNumIndices=function(){return 3*this.profile.numSegments};V.rebuildConnectingProfileGeometry=function(Y,aa,X){for(let ba=0;ba<aa.vertices.length;++ba)X(Y.index,Y.frame,aa.vertices[ba],aa.vertexNormals[ba],this.profilePlaneOffset,0)};V.rebuildCapGeometry=function(Y,aa){const X=K;l.set(X,0,0);const ba=this.flip?
1:-1;for(let ha=0;ha<this.profile.vertices.length;++ha)aa(Y.index,Y.frame,this.profile.vertices[ha],X,this.profilePlaneOffset,ba)};V.buildTopology=function(Y,aa){Y=this.vertexBufferStart+this.profile.vertexIndices[0];for(let X=1;X<this.profile.numSegments;++X){const ba=this.vertexBufferStart+this.profile.vertexIndices[2*X],ha=this.vertexBufferStart+this.profile.vertexIndices[2*X+1];this.flip?aa(ha,ba,Y):aa(Y,ba,ha)}};return W}(A),D=function(Q){function W(Y){var aa=Q.call(this)||this;aa.flip=!1;aa.sign=
0;aa.breakNormals=!1;aa.numSegments=3;aa.profile=Y.profile;aa.flip=Y.flip;aa.sign=aa.flip?1:-1;aa.breakNormals=Y.breakNormals;aa.numSegments=Y.subdivisions;return aa}b._inheritsLoose(W,Q);var V=W.prototype;V.getNumVertices=function(){let Y=0;Y=this.profile.vertices.length*(this.numSegments-1);this.breakNormals&&(Y+=this.profile.vertices.length);return Y+=this.profile.poles.length};V.getNumIndices=function(){let Y;Y=2*this.profile.numSegments*(this.numSegments-1);for(let aa=0;aa<this.profile.numSegments;++aa)Y=
this.profile.poleIndices[this.profile.vertexIndices[2*aa]]===this.profile.poleIndices[this.profile.vertexIndices[2*aa+1]]?Y+1:Y+2;return 3*Y};V.rebuildCapGeometry=function(Y,aa){const X=Y.frame,ba=.5*this.sign,ha=P,ka=K;l.set(ka,0,0);for(var ia=0;ia<this.profile.poles.length;++ia){var ea=this.profile.poles[ia];ea.normal?aa(Y.index,X,ea.position,ea.normal,ba,0):aa(Y.index,X,ea.position,ka,ba,this.sign)}if(this.breakNormals)for(ia=0;ia<this.profile.vertices.length;++ia)aa(Y.index,X,this.profile.vertices[ia],
this.profile.vertexNormals[ia],0,0);for(ia=0;ia<this.numSegments-1;++ia){var ca=(1-(ia+1)/this.numSegments)*Math.PI*.5;ea=Math.sin(ca);ca=Math.cos(ca);for(let Z=0;Z<this.profile.vertices.length;++Z){const fa=this.profile.poles[this.profile.poleIndices[Z]];l.subtract(ha,this.profile.vertices[Z],fa.position);l.scale(ha,ha,ea);fa.normal?(l.add(ha,ha,fa.position),aa(Y.index,X,ha,fa.normal,ba*ca,0)):(l.normalize(ka,ha),l.scale(ka,ka,ea),l.add(ha,ha,fa.position),aa(Y.index,X,ha,ka,ba*ca,this.sign*ca))}}};
V.buildTopology=function(Y,aa){Y=this.breakNormals?this.vertexBufferStart+this.profile.poles.length:this.firstProfileVertexIndex;const X=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length;for(let ba=0;ba<this.profile.numSegments;++ba){const ha=this.profile.vertexIndices[2*ba],ka=this.profile.vertexIndices[2*ba+1],ia=this.vertexBufferStart+this.profile.poleIndices[ha],ea=this.vertexBufferStart+this.profile.poleIndices[ka];
let ca=Y+ha,Z=Y+ka;for(let fa=0;fa<this.numSegments-1;++fa){const ja=X+fa*this.profile.vertices.length+ha,la=X+fa*this.profile.vertices.length+ka;this.flip?(aa(ja,Z,ca),aa(Z,ja,la)):(aa(ca,Z,ja),aa(la,ja,Z));ca=ja;Z=la}this.flip?(aa(ia,Z,ca),ia!==ea&&aa(ia,ea,Z)):(aa(ca,Z,ia),ia!==ea&&aa(Z,ea,ia))}};return W}(A),F=function(){function Q(V,Y,aa,X,ba,ha=B){this.options=ha;this.numUVTotal=this.numNormalsTotal=this.numVerticesTotal=this.numExtrusionProfiles=this._triangleCount=this._extrusionVertexCount=
0;this.profile=Y;this.path=V;this.extruder=aa;this.startCap=X;this.endCap=ba;V=this.path.vertices.length-2;this.numExtrusionProfiles=aa.numProfilesPerJoin()*V+2;this.numNormalsTotal=this.numVerticesTotal=Y.vertices.length*this.numExtrusionProfiles;this.startCap.vertexBufferStart=this.numVerticesTotal;Y=this.startCap.getNumVertices();this.numVerticesTotal+=Y;this.numNormalsTotal+=Y;this.endCap.vertexBufferStart=this.numVerticesTotal;Y=this.endCap.getNumVertices();this.numVerticesTotal+=Y;this.numNormalsTotal+=
Y;this.pathVertexData=new Float32Array(1*this.numVerticesTotal);this.profileRightAxisData=new Float32Array(4*this.numVerticesTotal);this.profileUpAxisData=new Float32Array(4*this.numVerticesTotal);this.profileVertexAndNormalData=new Float32Array(4*this.numVerticesTotal);this.profile.hasUV()&&this.options.generateUV&&(this.numUVTotal=this.profile.uvs.length,this.uvData=new Float32Array(2*this.numUVTotal));this.originData=new Float32Array(3*this.path.vertices.length);this._rebuildGeometry();this.buildTopology()}
var W=Q.prototype;W.emitVertex=function(V,Y,aa,X,ba){this.profileRightAxisData[4*this._extrusionVertexCount]=Y.right[0];this.profileRightAxisData[4*this._extrusionVertexCount+1]=Y.right[1];this.profileRightAxisData[4*this._extrusionVertexCount+2]=Y.right[2];this.profileUpAxisData[4*this._extrusionVertexCount]=Y.up[0];this.profileUpAxisData[4*this._extrusionVertexCount+1]=Y.up[1];this.profileUpAxisData[4*this._extrusionVertexCount+2]=Y.up[2];this.profileVertexAndNormalData[4*this._extrusionVertexCount]=
aa[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=aa[1];this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=X[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=X[1];this.pathVertexData[this._extrusionVertexCount]=V;ba?(V=this.path.vertices[V],this.profileRightAxisData[4*this._extrusionVertexCount+3]=V.rotationRight[0]*V.maxStretchDistance,this.profileUpAxisData[4*this._extrusionVertexCount+3]=V.rotationRight[1]*V.maxStretchDistance):(this.profileRightAxisData[4*
this._extrusionVertexCount+3]=0,this.profileUpAxisData[4*this._extrusionVertexCount+3]=0);++this._extrusionVertexCount};W.emitCapVertex=function(V,Y,aa,X,ba,ha){this.profileRightAxisData[4*this._extrusionVertexCount]=Y.right[0];this.profileRightAxisData[4*this._extrusionVertexCount+1]=Y.right[1];this.profileRightAxisData[4*this._extrusionVertexCount+2]=Y.right[2];this.profileUpAxisData[4*this._extrusionVertexCount]=Y.up[0];this.profileUpAxisData[4*this._extrusionVertexCount+1]=Y.up[1];this.profileUpAxisData[4*
this._extrusionVertexCount+2]=Y.up[2];this.profileVertexAndNormalData[4*this._extrusionVertexCount]=aa[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=aa[1];this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=X[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=X[1];this.pathVertexData[this._extrusionVertexCount]=V;this.profileRightAxisData[4*this._extrusionVertexCount+3]=ba;this.profileUpAxisData[4*this._extrusionVertexCount+3]=ha;++this._extrusionVertexCount};
W.emitTriangle=function(V,Y,aa){this.vertexIndices[3*this._triangleCount]=V;this.vertexIndices[3*this._triangleCount+1]=Y;this.vertexIndices[3*this._triangleCount+2]=aa;this.pathVertexIndices[3*this._triangleCount]=this.pathVertexData[V];this.pathVertexIndices[3*this._triangleCount+1]=this.pathVertexData[Y];this.pathVertexIndices[3*this._triangleCount+2]=this.pathVertexData[aa];this.normalIndices[3*this._triangleCount]=V;this.normalIndices[3*this._triangleCount+1]=Y;this.normalIndices[3*this._triangleCount+
2]=aa;++this._triangleCount};W._rebuildGeometry=function(){var V=(X,ba,ha,ka,ia)=>this.emitVertex(X,ba,ha,ka,ia);const Y=(X,ba,ha,ka,ia,ea)=>this.emitCapVertex(X,ba,ha,ka,ia,ea);this._extrusionVertexCount=0;for(var aa of this.path.vertices)this.originData[3*aa.index]=aa.pos[0],this.originData[3*aa.index+1]=aa.pos[1],this.originData[3*aa.index+2]=aa.pos[2];this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],this.profile,Y);for(aa=1;aa<this.path.vertices.length-1;++aa)this.extruder.extrude(this.path.vertices[aa],
this.profile,V);this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-1],this.profile,Y);this.startCap.rebuildCapGeometry(this.path.vertices[0],Y);this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-1],Y);if(this.profile.hasUV()&&this.options.generateUV)for(V=0;V<this.profile.uvs.length;++V)this.uvData[2*V]=this.profile.uvs[V],this.uvData[2*V+1]=0};W.buildTopology=function(){const V=(ha,ka,ia)=>this.emitTriangle(ha,ka,ia);this._triangleCount=
0;const Y=this.profile.vertices.length,aa=this.profile.numSegments,X=this.numExtrusionProfiles-1;var ba=aa*X*6;this.startCap.indexBufferStart=ba;this.startCap.firstProfileVertexIndex=0;ba+=this.startCap.getNumIndices();this.endCap.indexBufferStart=ba;this.endCap.firstProfileVertexIndex=Y*(this.numExtrusionProfiles-1);ba+=this.endCap.getNumIndices();this.vertexIndices=new Uint32Array(ba);this.normalIndices=new Uint32Array(ba);this.pathVertexIndices=new Uint32Array(ba);this.profile.hasUV()&&this.options.generateUV&&
(this.uvIndices=new Uint32Array(ba));for(ba=0;ba<aa;++ba){const ha=this.profile.vertexIndices[2*ba],ka=this.profile.vertexIndices[2*ba+1];for(let ia=0;ia<X;++ia){const ea=ia*Y+ha,ca=(ia+1)*Y+ka,Z=ia*Y+ka;V(ea,(ia+1)*Y+ha,ca);V(ea,ca,Z)}}this.startCap.buildTopology(this.path.vertices[0],V);this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],V)};W.onPathChanged=function(){this._rebuildGeometry()};return Q}(),G=function(){function Q(W){this.builder=W}Q.prototype.onPathChanged=function(){this.builder.onPathChanged()};
b._createClass(Q,[{key:"xform",get:function(){return this.builder.path.xform}}]);return Q}(),J=function(Q){function W(Y){Y=Q.call(this,Y)||this;Y.vertexAttributePosition=null;Y.vertexAttributeNormal=null;Y.vertexAttributeColor=null;Y.vertexAttributePosition=new Float32Array(3*Y.builder.numVerticesTotal);Y.vertexAttributeNormal=new Float32Array(3*Y.builder.numNormalsTotal);Y.vertexAttributeColor=new Uint8Array(4);Y.vertexAttributeColor[0]=255;Y.vertexAttributeColor[1]=255;Y.vertexAttributeColor[2]=
255;Y.vertexAttributeColor[3]=255;return Y}b._inheritsLoose(W,Q);var V=W.prototype;V.bakeVertexColors=function(Y){this.vertexAttributeColor[0]=255*Y[0];this.vertexAttributeColor[1]=255*Y[1];this.vertexAttributeColor[2]=255*Y[2];this.vertexAttributeColor[3]=255*(3<Y.length?Y[3]:1)};V.bake=function(Y){this.size=Y;for(let ha=0;ha<this.builder.numVerticesTotal;++ha){var aa=this.builder.pathVertexData[ha],X=0===aa||aa===this.builder.path.vertices.length-1;aa*=3;var ba=O;f.set(ba,this.builder.originData[aa++],
this.builder.originData[aa++],this.builder.originData[aa]);aa=4*ha;const ka=U,ia=P,ea=R,ca=L,Z=N;let fa=0,ja=0;f.set(ca,this.builder.profileRightAxisData[aa],this.builder.profileRightAxisData[aa+1],this.builder.profileRightAxisData[aa+2]);f.set(Z,this.builder.profileUpAxisData[aa],this.builder.profileUpAxisData[aa+1],this.builder.profileUpAxisData[aa+2]);l.set(ia,this.builder.profileVertexAndNormalData[aa]*Y[0],this.builder.profileVertexAndNormalData[aa+1]*Y[1]);if(X)f.cross(ea,Z,ca),fa=this.builder.profileRightAxisData[aa+
3]*Y[0],ja=this.builder.profileUpAxisData[aa+3];else{X=K;const la=M;l.set(X,this.builder.profileRightAxisData[aa+3],this.builder.profileUpAxisData[aa+3]);const ma=l.length(X);l.normalize(X,X);const ra=l.dot(ia,X);if(Math.abs(ra)>ma){l.set(la,-X[1],X[0]);const va=l.dot(ia,la);l.scale(X,X,ma*Math.sign(ra));l.scale(la,la,va);l.add(ia,X,la)}f.set(ea,0,0,0)}f.set(ka,ca[0]*ia[0]+Z[0]*ia[1],ca[1]*ia[0]+Z[1]*ia[1],ca[2]*ia[0]+Z[2]*ia[1]);this.vertexAttributePosition[3*ha]=ba[0]+ka[0]+ea[0]*fa;this.vertexAttributePosition[3*
ha+1]=ba[1]+ka[1]+ea[1]*fa;this.vertexAttributePosition[3*ha+2]=ba[2]+ka[2]+ea[2]*fa;ba=P;l.set(ba,this.builder.profileVertexAndNormalData[aa+2],this.builder.profileVertexAndNormalData[aa+3]);this.vertexAttributeNormal[3*ha]=ca[0]*ba[0]+Z[0]*ba[1]+ea[0]*ja;this.vertexAttributeNormal[3*ha+1]=ca[1]*ba[0]+Z[1]*ba[1]+ea[1]*ja;this.vertexAttributeNormal[3*ha+2]=ca[2]*ba[0]+Z[2]*ba[1]+ea[2]*ja}};V.createGeometryData=function(){const Y=[[p.VertexAttribute.POSITION,this.builder.vertexIndices],[p.VertexAttribute.NORMAL,
this.builder.normalIndices]],aa=[[p.VertexAttribute.POSITION,{size:3,data:this.vertexAttributePosition,exclusive:!0}],[p.VertexAttribute.NORMAL,{size:3,data:this.vertexAttributeNormal,exclusive:!0}]];this.vertexAttributeColor&&(Y.push([p.VertexAttribute.COLOR,new Uint32Array(this.builder.vertexIndices.length)]),aa.push([p.VertexAttribute.COLOR,{size:4,data:this.vertexAttributeColor}]));return{vertexAttributes:aa,indices:Y}};V.onPathChanged=function(){Q.prototype.onPathChanged.call(this);this.bake(this.size)};
V.intersect=function(Y,aa,X){const ba=this.builder.vertexIndices;h.intersectTriangles(Y,aa,0,ba.length/3,ba,{size:3,data:this.vertexAttributePosition},void 0,void 0,X)};return W}(G),I=function(Q){function W(V,Y,aa,X){var ba=Q.call(this,V)||this;ba.sizeAttributeValue=Y;ba.colorAttributeValue=aa;ba.opacityAttributeValue=X;ba.vvData=null;ba.baked=new J(V);ba.vvData=new Float32Array(4*ba.builder.path.vertices.length);for(V=0;V<ba.builder.path.vertices.length;++V)ba.vvData[4*V]=Y,ba.vvData[4*V+1]=aa,ba.vvData[4*
V+2]=X,ba.vvData[4*V+3]=0===V||V===ba.builder.path.vertices.length-1?1:0;return ba}b._inheritsLoose(W,Q);W.prototype.createGeometryData=function(){return{vertexAttributes:[[p.VertexAttribute.POSITION,{size:3,data:this.builder.originData,exclusive:!0}],[p.VertexAttribute.PROFILERIGHT,{size:4,data:this.builder.profileRightAxisData,exclusive:!0}],[p.VertexAttribute.PROFILEUP,{size:4,data:this.builder.profileUpAxisData,exclusive:!0}],[p.VertexAttribute.PROFILEVERTEXANDNORMAL,{size:4,data:this.builder.profileVertexAndNormalData,
exclusive:!0}],[p.VertexAttribute.FEATUREVALUE,{size:4,data:this.vvData,exclusive:!0}]],indices:[[p.VertexAttribute.POSITION,this.builder.pathVertexIndices],[p.VertexAttribute.PROFILERIGHT,this.builder.vertexIndices],[p.VertexAttribute.PROFILEUP,this.builder.vertexIndices],[p.VertexAttribute.PROFILEVERTEXANDNORMAL,this.builder.vertexIndices],[p.VertexAttribute.FEATUREVALUE,this.builder.pathVertexIndices]]}};return W}(G);const O=e.create(),P=n.create(),K=n.create(),M=n.create(),U=e.create(),R=e.create(),
L=e.create(),N=e.create(),T=e.create(),S=m(),H=w.create();a.Builder=F;a.CapBuilder=A;a.Extruder=function(){};a.FastUpdatePathGeometry=I;a.MiterExtruder=v;a.NoCapBuilder=E;a.Path=q;a.PathGeometryData=G;a.PathVertex=u;a.Profile=t;a.RoundCapBuilder=D;a.SimpleExtruder=z;a.StaticPathGeometry=J;a.TriangulationCapBuilder=C;a.computeMinimumRotationTangentFrame=function(Q,W){let V=null;const Y=Q.vertices.length,aa=e.create(),X=e.create(),ba=e.create(),ha=e.create(),ka=e.create(),ia=e.create(),ea=k.create();
let ca=Q.vertices[0];f.copy(X,W);f.set(aa,0,1,0);y.makeOrthoBasisDirUpFallback(ca.vRight,X,aa,aa,ba,X,.99619469809);f.copy(ca.frame.up,X);f.copy(ca.frame.right,ba);V=ca;for(W=1;W<Y;++W){ca=Q.vertices[W];f.add(ka,ca.vLeft,ca.vRight);let Z=f.length(ka);0<Z?(Z=1/Math.sqrt(Z),ka[0]*=Z,ka[1]*=Z,ka[2]*=Z):(ka[0]=ca.vRight[0],ka[1]=ca.vRight[1],ka[2]=ca.vRight[2]);f.add(ia,V.pos,V.frame.up);k.fromPositionAndNormal(ca.pos,ka,ea);k.intersectRay(ea,r.wrap(ia,ca.vLeft),ha)?(f.subtract(ha,ha,ca.pos),f.normalize(X,
ha),f.cross(ba,ka,X),f.normalize(ba,ba)):y.makeOrthoBasisDirUpFallback(ka,V.frame.up,V.frame.right,aa,ba,X,.99619469809);f.copy(ca.frame.up,X);f.copy(ca.frame.right,ba);V=ca}};a.makeFrame=m;a.profileSpaceToVertexSpace=function(Q,W,V){Q[0]=V[0]*W.right[0]+V[1]*W.up[0];Q[1]=V[0]*W.right[1]+V[1]*W.up[1];Q[2]=V[0]*W.right[2]+V[1]*W.up[2]};a.vertexSpaceToProfileSpace=function(Q,W,V){l.set(Q,f.dot(V,W.right),f.dot(V,W.up))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/mat2f64":function(){define(["exports"],
function(a){function b(){return[1,0,0,1]}function c(w){return[w[0],w[1],w[2],w[3]]}function d(w,l,n,f){return[w,l,n,f]}function g(w,l){return new Float64Array(w,l,4)}const x=Object.freeze({__proto__:null,create:b,clone:c,fromValues:d,createView:g});a.clone=c;a.create=b;a.createView=g;a.fromValues=d;a.mat2f64=x})},"esri/views/3d/webgl-engine/materials/PathMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../core/maybe ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/buffer/BufferView ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/shading/Normals.glsl ../lib/geometryDataUtils ../lib/GLMaterial ../lib/Material ../lib/PathGeometry ../lib/RenderPass ../lib/RenderSlot ../lib/Util ../lib/VertexAttribute ./PathTechnique ./VisualVariableMaterialParameters ./internal/bufferWriterUtils ./internal/MaterialUtil".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z){let v=function(C){function D(G){G=C.call(this,G,A)||this;G.supportsEdges=!0;G._vertexAttributeLocations=u.pathVertexAttributeLocations;G.techniqueConfig=new u.PathTechniqueConfiguration;G.vertexBufferLayout=D.getVertexBufferLayout(G.parameters);return G}b._inheritsLoose(D,C);var F=D.prototype;F.getTechniqueConfig=function(G,J){this.techniqueConfig.output=G;this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled;this.techniqueConfig.vvColor=this.parameters.vvColorEnabled;
this.techniqueConfig.vvOpacity=this.parameters.vvOpacityEnabled;this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled;this.techniqueConfig.transparent=this.parameters.transparent;this.techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees;if(G===l.ShaderOutput.Color||G===l.ShaderOutput.Alpha)this.techniqueConfig.doubleSidedMode=this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?n.NormalsDoubleSidedMode.View:this.parameters.doubleSided&&"winding-order"===
this.parameters.doubleSidedType?n.NormalsDoubleSidedMode.WindingOrder:n.NormalsDoubleSidedMode.None,this.techniqueConfig.receiveShadows=this.parameters.receiveShadows,this.techniqueConfig.receiveSSAO=J.ssaoEnabled?this.parameters.receiveSSAO:!1;this.techniqueConfig.transparencyPassType=J.transparencyPassType;this.techniqueConfig.multipassTerrainEnabled=J.multipassTerrainEnabled;this.techniqueConfig.cullAboveGround=J.cullAboveGround;return this.techniqueConfig};F.getPassParameters=function(){return this.parameters};
F.isVisibleInPass=function(G){return G===y.RenderPass.MATERIAL_DEPTH_SHADOWMAP_ALL||G===y.RenderPass.MATERIAL_DEPTH_SHADOWMAP_DEFAULT||G===y.RenderPass.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT?this.parameters.castShadows:!0};F.isVisible=function(){const G=this.parameters;return C.prototype.isVisible.call(this)?0<G.opacity:!1};F.intersect=function(G,J,I,O,P,K,M){if(r.isPathGeometry(G)){J=G.path;I=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSizeEnabled){var U=this.parameters.vvSizeOffset,
R=this.parameters.vvSizeFactor;const L=this.parameters.vvSizeMinSize,N=this.parameters.vvSizeMaxSize,T=J.sizeAttributeValue;I[0]*=c.clamp(U[0]+T*R[0],L[0],N[0]);I[1]*=c.clamp(U[2]+T*R[2],L[2],N[2])}U=Math.max(I[0],I[1]);G=G.boundingInfo;d.isNone(G)?this._intersectTriangles(J,I,P,K,M):(G=g.fromValues(G.bbMin[0]-U,G.bbMin[1]-U,G.bbMin[2]-U,G.bbMax[0]+U,G.bbMax[1]+U,G.bbMax[2]+U),U=[K[0]-P[0],K[1]-P[1],K[2]-P[2]],R=Math.sqrt(U[0]*U[0]+U[1]*U[1]+U[2]*U[2]),z.intersectAabbInvDir(G,P,[R/U[0],R/U[1],R/U[2]],
O.tolerance)&&this._intersectTriangles(J,I,P,K,M))}};F._intersectTriangles=function(G,J,I,O,P){G.baked.size&&G.baked.size[0]===J[0]&&G.baked.size[1]===J[1]||G.baked.bake(J);G.baked.intersect(I,O,P)};F.computeAttachmentOrigin=function(G,J){G=G.vertexAttributes;if(!G)return null;G=G.get(m.VertexAttribute.POSITION);return f.computeAttachmentOriginLines(G,null,!1,J)};F.createBufferWriter=function(){return new E(this.vertexBufferLayout)};F.requiresSlot=function(G){return G===(this.parameters.transparent?
p.RenderSlot.TRANSPARENT_MATERIAL:p.RenderSlot.OPAQUE_MATERIAL)||G===p.RenderSlot.DRAPED_MATERIAL};F.createGLMaterial=function(G){return G.output===l.ShaderOutput.Color||G.output===l.ShaderOutput.Alpha||G.output===l.ShaderOutput.Depth||G.output===l.ShaderOutput.Normal||G.output===l.ShaderOutput.Highlight||G.output===l.ShaderOutput.Shadow&&this.parameters.castShadows?new B(G):null};D.getVertexBufferLayout=function(G){let J=w.newLayout().vec3f(m.VertexAttribute.POSITION).vec4f(m.VertexAttribute.PROFILERIGHT).vec4f(m.VertexAttribute.PROFILEUP).vec4f(m.VertexAttribute.PROFILEVERTEXANDNORMAL);
if(G.vvColorEnabled||G.vvSizeEnabled||G.vvOpacityEnabled)J=J.vec4f(m.VertexAttribute.FEATUREVALUE);return J};return D}(k.Material),B=function(C){function D(){return C.apply(this,arguments)||this}b._inheritsLoose(D,C);var F=D.prototype;F.updateParameters=function(G){return this.ensureTechnique(u.PathTechnique,G)};F._updateOccludeeState=function(G){G.hasOccludees!==this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:G.hasOccludees})};F._updateShadowState=function(G){(d.isNone(this.technique)||
G.shadowMappingEnabled!==this.technique.configuration.receiveShadows)&&this._material.setParameters({receiveShadows:G.shadowMappingEnabled})};F.beginSlot=function(G){if(this._output===l.ShaderOutput.Color||this._output===l.ShaderOutput.Alpha)this._updateShadowState(G),this._updateOccludeeState(G);return this.updateParameters(G)};F.bind=function(G,J){J.bindPass(this._material.getPassParameters(),G)};return D}(e);const A={size:[1,1,1],ambient:[.2,.2,.2],diffuse:[.8,.8,.8],specular:[0,0,0],opacity:1,
doubleSided:!1,doubleSidedType:"normal",receiveSSAO:!0,receiveShadows:!1,castShadows:!0,slicePlaneEnabled:!1,transparent:!1,sceneHasOcludees:!1,...t.VisualVariableDefaultMaterialParameters,...k.DefaultMaterialParameters};let E=function(){function C(F){this.vertexBufferLayout=F}var D=C.prototype;D.allocate=function(F){return this.vertexBufferLayout.createBuffer(F)};D.elementCount=function(F){return F.indices.get(m.VertexAttribute.POSITION).length};D.write=function(F,G,J,I){const O=P=>{if(G.vertexAttributes.has(P)){const K=
G.vertexAttributes.get(P),M=G.indices.get(P);h.assert(4===K.size);const U=J.getField(P,x.BufferViewVec4f);if(U)q.writeBufferVec4(M,K.data,U,I);else throw Error("unable to acquire view for "+P);}};O(m.VertexAttribute.PROFILERIGHT);O(m.VertexAttribute.PROFILEUP);O(m.VertexAttribute.PROFILEVERTEXANDNORMAL);this.vertexBufferLayout.hasField(m.VertexAttribute.FEATUREVALUE)&&O(m.VertexAttribute.FEATUREVALUE);q.writeDefaultAttributes(G,this.vertexBufferLayout,F.transformation,F.invTranspTransformation,J,
I)};return C}();a.PathMaterial=v;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/PathTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/attributes/PathVertexPosition.glsl ../core/shaderLibrary/attributes/VertexNormal.glsl ../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderLibrary/shading/ReadShadowMap.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../lib/VertexAttribute ../../../../chunks/Path.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B){const A=new Map([[z.VertexAttribute.POSITION,0],[z.VertexAttribute.PROFILERIGHT,1],[z.VertexAttribute.PROFILEUP,2],[z.VertexAttribute.PROFILEVERTEXANDNORMAL,3],[z.VertexAttribute.FEATUREVALUE,4]]);p=function(E){function C(){return E.apply(this,arguments)||this}c._inheritsLoose(C,E);var D=C.prototype;D.initializeProgram=function(F){var G=C.shader.get();const J=this.configuration;G=G.build({oitEnabled:J.transparencyPassType===m.TransparencyPassType.Color,
output:J.output,viewingMode:F.viewingMode,slicePlaneEnabled:J.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,receiveShadows:J.receiveShadows,vvSize:J.vvSize,vvColor:J.vvColor,vvInstancingEnabled:!0,vvOpacity:J.vvOpacity,pbrMode:e.PBRMode.Disabled,useCustomDTRExponentForWater:!1,receiveAmbientOcclusion:J.receiveSSAO,doubleSidedMode:J.doubleSidedMode,multipassTerrainEnabled:J.multipassTerrainEnabled,cullAboveGround:J.cullAboveGround});return new t.Program(F.rctx,G,A)};
D.bindPass=function(F,G){var J,I;r.bindProjectionMatrix(this.program,G.camera.projectionMatrix);this.program.setUniform3fv("size",F.size);G.multipassTerrainEnabled&&(this.program.setUniform2fv("nearFar",G.camera.nearFar),this.program.setUniform2fv("inverseViewport",G.inverseViewport),n.bindMultipassTerrainTexture(this.program,G));this.configuration.output!==g.ShaderOutput.Color&&this.configuration.output!==g.ShaderOutput.Alpha||this.program.setUniform1f("opacity",F.opacity);this.configuration.output===
g.ShaderOutput.Color?(G.lighting.setUniforms(this.program,!1,!1),this.program.setUniform3fv("ambient",F.ambient),this.program.setUniform3fv("diffuse",F.diffuse),this.program.setUniform3fv("specular",F.specular),this.program.setUniform1f("opacity",F.opacity)):this.configuration.output!==g.ShaderOutput.Depth&&this.configuration.output!==g.ShaderOutput.Shadow||this.program.setUniform2fv("nearFar",G.camera.nearFar);w.setVVUniforms(this.program,F);null==(J=G.shadowMap)?void 0:J.bind(this.program);null==
(I=G.ssaoHelper)?void 0:I.bind(this.program,G.camera)};D.bindDraw=function(F){r.bindView(this.program,F);x.bindSliceUniformsWithOrigin(this.program,this.configuration,F);this.program.rebindTextures();this.configuration.output!==g.ShaderOutput.Color&&this.configuration.output!==g.ShaderOutput.Alpha||r.bindCameraPosition(this.program,F.origin,F.camera.viewInverseTransposeMatrix);this.configuration.output===g.ShaderOutput.Color&&k.bindReadShadowMapView(this.program,F);this.configuration.output===g.ShaderOutput.Normal&&
l.bindVertexNormalUniforms(this.program,F.camera.viewInverseTransposeMatrix)};D._setPipelineState=function(F){const G=this.configuration,J=F===m.TransparencyPassType.NONE,I=F===m.TransparencyPassType.FrontFace;return B.makePipelineState({blending:G.output!==g.ShaderOutput.Color&&G.output!==g.ShaderOutput.Alpha||!G.transparent?null:J?u.blendingDefault:u.oitBlending(F),culling:(G.slicePlaneEnabled?!1:!G.transparent&&G.doubleSidedMode!==f.NormalsDoubleSidedMode.None)&&B.frontFaceCullingParams,depthTest:{func:u.oitDepthTest(F)},
depthWrite:J||I?B.defaultDepthWriteParams:null,colorWrite:B.defaultColorWriteParams,stencilWrite:G.sceneHasOcludees?q.stencilWriteMaskOn:null,stencilTest:G.sceneHasOcludees?q.stencilBaseAllZerosParams:null,polygonOffset:J||I?null:u.OITPolygonOffset})};D.initializePipeline=function(){return this._setPipelineState(this.configuration.transparencyPassType)};return C}(p.ShaderTechnique);p.shader=new y.ReloadableShaderModule(v.PathShader,()=>new Promise((E,C)=>a(["../shaders/Path.glsl"],E,C)));y=function(E){function C(){var D=
E.apply(this,arguments)||this;D.output=g.ShaderOutput.Color;D.doubleSidedMode=f.NormalsDoubleSidedMode.None;D.receiveShadows=!1;D.receiveSSAO=!1;D.vvSize=!1;D.vvColor=!1;D.vvOpacity=!1;D.slicePlaneEnabled=!1;D.transparent=!1;D.sceneHasOcludees=!1;D.transparencyPassType=m.TransparencyPassType.NONE;D.multipassTerrainEnabled=!1;D.cullAboveGround=!1;return D}c._inheritsLoose(C,E);return C}(h.ShaderTechniqueConfiguration);d.__decorate([h.parameter({count:g.ShaderOutput.COUNT})],y.prototype,"output",void 0);
d.__decorate([h.parameter({count:f.NormalsDoubleSidedMode.COUNT})],y.prototype,"doubleSidedMode",void 0);d.__decorate([h.parameter()],y.prototype,"receiveShadows",void 0);d.__decorate([h.parameter()],y.prototype,"receiveSSAO",void 0);d.__decorate([h.parameter()],y.prototype,"vvSize",void 0);d.__decorate([h.parameter()],y.prototype,"vvColor",void 0);d.__decorate([h.parameter()],y.prototype,"vvOpacity",void 0);d.__decorate([h.parameter()],y.prototype,"slicePlaneEnabled",void 0);d.__decorate([h.parameter()],
y.prototype,"transparent",void 0);d.__decorate([h.parameter()],y.prototype,"sceneHasOcludees",void 0);d.__decorate([h.parameter({count:m.TransparencyPassType.COUNT})],y.prototype,"transparencyPassType",void 0);d.__decorate([h.parameter()],y.prototype,"multipassTerrainEnabled",void 0);d.__decorate([h.parameter()],y.prototype,"cullAboveGround",void 0);b.PathTechnique=p;b.PathTechniqueConfiguration=y;b.pathVertexAttributeLocations=A;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/PathVertexPosition.glsl":function(){define(["exports",
"./PositionAttribute.glsl","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,c,d){a.PathVertexPosition=function(g,x){g.attributes.add(d.VertexAttribute.FEATUREVALUE,"vec4");g.vertex.code.add(c.glsl`bool isCapVertex() {
return featureValue.w == 1.0;
}`);g.vertex.uniforms.add("size","vec3");x.vvSize?(g.vertex.uniforms.add("vvSizeMinSize","vec3"),g.vertex.uniforms.add("vvSizeMaxSize","vec3"),g.vertex.uniforms.add("vvSizeOffset","vec3"),g.vertex.uniforms.add("vvSizeFactor","vec3"),g.vertex.code.add(c.glsl`vec2 getSize() {
return size.xy*clamp(vvSizeOffset + featureValue.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
}`)):g.vertex.code.add(c.glsl`vec2 getSize(){
return size.xy;
}`);x.vvOpacity?(g.vertex.constants.add("vvOpacityNumber","int",8),g.vertex.code.add(c.glsl`uniform float vvOpacityValues[vvOpacityNumber];
uniform float vvOpacityOpacities[vvOpacityNumber];
vec4 applyOpacity(vec4 color) {
float value = featureValue.z;
if (value <= vvOpacityValues[0]) {
return vec4( color.xyz, vvOpacityOpacities[0]);
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
}
}
return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
}`)):g.vertex.code.add(c.glsl`vec4 applyOpacity(vec4 color){
return color;
}`);x.vvColor?(g.vertex.constants.add("vvColorNumber","int",8),g.vertex.code.add(c.glsl`uniform float vvColorValues[vvColorNumber];
uniform vec4 vvColorColors[vvColorNumber];
vec4 getColor() {
float value = featureValue.y;
if (value <= vvColorValues[0]) {
return applyOpacity(vvColorColors[0]);
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
}
}
return applyOpacity(vvColorColors[vvColorNumber - 1]);
}`)):g.vertex.code.add(c.glsl`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`);g.include(b.PositionAttribute);g.attributes.add(d.VertexAttribute.PROFILERIGHT,"vec4");g.attributes.add(d.VertexAttribute.PROFILEUP,"vec4");g.attributes.add(d.VertexAttribute.PROFILEVERTEXANDNORMAL,"vec4");g.vertex.code.add(c.glsl`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`);g.vertex.code.add(c.glsl`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`);g.vertex.code.add(c.glsl`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`);g.vertex.code.add(c.glsl`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)};a.setVVUniforms=function(g,x){x.vvSizeEnabled&&(g.setUniform3fv("vvSizeMinSize",x.vvSizeMinSize),g.setUniform3fv("vvSizeMaxSize",x.vvSizeMaxSize),g.setUniform3fv("vvSizeOffset",x.vvSizeOffset),g.setUniform3fv("vvSizeFactor",x.vvSizeFactor));x.vvColorEnabled&&(g.setUniform1fv("vvColorValues",x.vvColorValues),g.setUniform4fv("vvColorColors",x.vvColorColors));x.vvOpacityEnabled&&(g.setUniform1fv("vvOpacityValues",x.vvOpacityValues),g.setUniform1fv("vvOpacityOpacities",x.vvOpacityOpacities))};Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/chunks/Path.glsl":function(){define("exports ../views/ViewingMode ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PathVertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t){function q(v){const B=new t.ShaderBuilder;B.vertex.uniforms.add("proj","mat4").add("view","mat4").add("cameraPosition","vec3").add("localOrigin","vec3");B.varyings.add("vpos","vec3");B.include(w.PathVertexPosition,v);if(v.output===d.ShaderOutput.Color||v.output===d.ShaderOutput.Alpha)B.include(x.Transform,{linearDepth:!1}),v.receiveShadows&&B.include(h.ReadShadowMap,v),B.include(c.ForwardLinearDepth,v),B.varyings.add("vnormal","vec3"),B.varyings.add("vcolor",
"vec4"),v.multipassTerrainEnabled&&B.varyings.add("depth","float"),B.vertex.code.add(u.glsl`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${v.multipassTerrainEnabled?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${v.output===d.ShaderOutput.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `);v.multipassTerrainEnabled&&(B.fragment.include(f.ReadLinearDepth),B.include(r.multipassTerrainTest,v));v.output===d.ShaderOutput.Alpha&&(B.include(g.Slice,v),B.fragment.uniforms.add("cameraPosition","vec3"),B.fragment.uniforms.add("localOrigin","vec3"),B.fragment.uniforms.add("opacity","float"),B.fragment.code.add(u.glsl`
      void main() {
        discardBySlice(vpos);
        ${v.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        gl_FragColor = vec4(combinedOpacity);
      }
    `));v.output===d.ShaderOutput.Color&&(B.include(g.Slice,v),B.include(k.EvaluateSceneLighting,v),B.include(e.EvaluateAmbientOcclusion,v),v.receiveShadows&&B.include(h.ReadShadowMap,v),B.include(y.Normals,v),B.fragment.uniforms.add("cameraPosition","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("specular","vec3").add("opacity","float"),B.fragment.include(m.ColorConversion),B.fragment.code.add(u.glsl`
      void main() {
        discardBySlice(vpos);
        ${v.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}

        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        shadingParams.normalView = vnormal;
        vec3 normal = shadingNormal(shadingParams);
        float ssao = evaluateAmbientOcclusionInverse();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${v.receiveShadows?"float shadow \x3d readShadowMap(vpos, linearDepth);":v.viewingMode===b.ViewingMode.Global?"float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow \x3d 0.0;"}
        vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
        float combinedOpacity = vcolor.a * opacity;
        albedo += 0.25 * specular; // don't completely ignore specular for now

        vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
        gl_FragColor = vec4(shadedColor, combinedOpacity);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${v.oitEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
      }
    `));if(v.output===d.ShaderOutput.Depth||v.output===d.ShaderOutput.Shadow)B.include(x.Transform,{linearDepth:!0}),B.vertex.uniforms.add("nearFar","vec2"),B.varyings.add("depth","float"),B.vertex.code.add(u.glsl`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),B.include(g.Slice,v),B.include(l.OutputDepth,v),B.fragment.uniforms.add("timeElapsed","float"),B.fragment.code.add(u.glsl`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);v.output===d.ShaderOutput.Normal&&(B.include(x.Transform,{linearDepth:!1}),B.include(p.NormalUtils,v),B.vertex.uniforms.add("viewNormal","mat4"),B.varyings.add("vnormal","vec3"),B.vertex.code.add(u.glsl`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),B.include(g.Slice,v),B.fragment.uniforms.add("waterColor","vec4"),B.fragment.code.add(u.glsl`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`));v.output===d.ShaderOutput.Highlight&&(B.include(x.Transform,{linearDepth:!1}),B.include(p.NormalUtils,v),B.vertex.uniforms.add("viewNormal","mat4"),B.varyings.add("vnormal","vec3"),B.vertex.code.add(u.glsl`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),B.include(g.Slice,v),B.include(n.OutputHighlight),B.fragment.code.add(u.glsl`void main() {
discardBySlice(vpos);
outputHighlight();
}`));return B}const z=Object.freeze({__proto__:null,build:q});a.PathShader=z;a.build=q})},"esri/views/3d/layers/graphics/Graphics3DPolygonFillSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/earcut ../../../../chunks/mat4f64 ../../../../chunks/vec4 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/buffer/BufferView ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./lineUtils ./polygonUtils ../support/patternUtils ../support/uvUtils ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/lineStippleUtils ../../webgl-engine/materials/PatternMaterial ../../webgl-engine/materials/RibbonLineMaterial".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E,C){const D=["polyline","polygon","extent"];p=function(I){function O(K,M,U,R){K=I.call(this,K,M,U,R)||this;K._needsUV=!1;K._hasOutline=!1;return K}b._inheritsLoose(O,I);var P=O.prototype;P.doLoad=function(){var K=b._asyncToGenerator(function*(){});return function(){return K.apply(this,arguments)}}();P._ensureMaterials=function(){this._ensureFillMaterial();this._ensureOutlineMaterial()};P._ensureFillMaterial=function(){if(!d.isSome(this._material)){var K=
d.get(this.symbolLayer,"material","color");K=this._getCombinedOpacityAndColor(K);this._material=t.createMaterial(this.symbolLayer,{color:K,transparent:1>K[3]||this.needsDrivenTransparentPass,polygonOffset:!1,vertexColors:!0,writeLinearDepth:!0,slicePlaneEnabled:this._context.slicePlaneEnabled},{isDraped:this.draped});this._needsUV=this._material instanceof E.PatternMaterial;this._context.stage.add(this._material)}};P._ensureOutlineMaterial=function(){const K=this.symbolLayer.outline;!d.isSome(this._outlineMaterial)&&
this._isValidOutline(K)&&(this._hasOutline=!0,this._outlineMaterial=(M=>{const U=A.getStipplePatternForLinePattern(K.pattern);return new C.RibbonLineMaterial({width:M,color:this._getOutlineColor(),polygonOffset:!0,slicePlaneEnabled:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:U,stippleScaleWithLineWidth:!0,cap:m.parseCapType(K.patternCap||"butt")})})(g.pt2px(K.size)),this._context.stage.add(this._outlineMaterial))};P._isValidOutline=function(K){return d.isSome(K)&&K.size&&0<K.size&&
d.isSome(K.color)&&(d.isNone(K.pattern)||"style"!==K.pattern.type||"none"!==K.pattern.style)};P.destroy=function(){I.prototype.destroy.call(this);this._context.stage.remove(this._material);this._material=null;this._context.stage.remove(this._outlineMaterial);this._outlineMaterial=null};P.createGraphics3DGraphic=function(K){const M=K.graphic;if(!this._validateGeometry(M.geometry,D,this.symbolLayer.type))return null;K=this._getVertexOpacityAndColor(K.renderingInfo,255);const U=this.setGraphicElevationContext(M,
new k.ElevationContext);this.ensureDrapedStatus("on-the-ground"===U.mode);this._ensureMaterials();return this.draped?this._createAsOverlay(M,K):this._createAs3DShape(M,K,U)};P.layerOpacityChanged=function(){if(d.isSome(this._material)){var K=this._material.parameters.color,M=d.get(this.symbolLayer,"material","color");M=this._getCombinedOpacity(M);this._material.setParameters({color:[K[0],K[1],K[2],M],transparent:1>M||this.needsDrivenTransparentPass})}d.isSome(this._outlineMaterial)&&(K=this._outlineMaterial.parameters.color,
this._outlineMaterial.setParameters({color:[K[0],K[1],K[2],this._getOutlineOpacity()]}));return!0};P.layerElevationInfoChanged=function(K,M,U){const R=this._elevationContext.mode;U=e.elevationModeChangeUpdateType(O.elevationModeChangeTypes,U,R);if(U!==e.SymbolUpdateType.UPDATE)return U;const L=e.needsElevationUpdates2D(R);return this.updateGraphics3DGraphicElevationInfo(K,M,()=>L)};P.slicePlaneEnabledChanged=function(){d.isSome(this._material)&&this._material.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled});
d.isSome(this._outlineMaterial)&&this._outlineMaterial.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};P.physicalBasedRenderingChanged=function(){return!0};P.pixelRatioChanged=function(){return!0};P._createAs3DShape=function(K,M,U){const R=u.geometryAsPolygon(K.geometry);if(d.isNone(R))return null;G.renderData=u.geometryToRenderInfo(R,this._context.elevationProvider,this._context.renderCoordsHelper,U);G.color=M;M=G.renderData.position.length/3;this._needsUV&&(G.uvMapSpace=
new Float32Array(4*M),G.boundingRect=new Float64Array(9*M));G.outNum=0;G.outGeometries=[];G.outTransforms=[];G.outMaterials=[];this._createAs3DShapeFill(G);this._hasOutline&&this._createAs3DShapeOutline(G);this._logGeometryCreationWarnings(G.renderData,R.rings,"rings","FillSymbol3DLayer");if(0===G.outNum)return null;this._needsUV&&q.createMapSpaceUVCoords(f.BufferViewVec4f.fromTypedArray(G.uvMapSpace),f.BufferViewVec3f64.fromTypedArray(G.renderData.position),this._context.renderCoordsHelper,f.BufferViewMat3f64.fromTypedArray(G.boundingRect));
K=new z.Object3D({geometries:G.outGeometries,materials:G.outMaterials,transformations:G.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:K.uid}});K=new y.Graphics3DObject3DGraphicLayer(this,K,G.outGeometries,null,null,t.uvElevationAligner,U);K.alignedSampledElevation=G.renderData.sampledElevation;K.needsElevationUpdates=e.needsElevationUpdates2D(U.mode);return K};P._createAs3DShapeFill=function(K){var M=K.renderData.polygons;for(const {position:U,mapPosition:R,holeIndices:L,
index:N,count:T}of M){if(d.isSome(this._context.clippingExtent)&&(n.empty(F),n.expandWithBuffer(F,R),!n.intersectsClippingArea(F,this._context.clippingExtent)))continue;M=x.earcut(R,L,3);0!==M.length&&(M=new Uint32Array(M),M=u.createColorGeometry({indices:M,attributeData:{position:U,color:K.color,mapPosition:R,uvMapSpace:this._needsUV?new Float32Array(K.uvMapSpace.buffer,4*N*K.uvMapSpace.BYTES_PER_ELEMENT,4*T):null,boundingRect:this._needsUV?new Float64Array(K.boundingRect.buffer,9*N*K.boundingRect.BYTES_PER_ELEMENT,
9*T):null}}),K.outGeometries.push(M),K.outMaterials.push(d.unwrap(this._material)),K.outTransforms.push(w.IDENTITY),K.outNum++)}};P._createAs3DShapeOutline=function(K){if(this._hasOutline){var M=K.renderData.outlines;for(let U=0;U<M.length;++U){const {mapPosition:R,position:L}=M[U];if(d.isSome(this._context.clippingExtent)&&(n.empty(F),n.expandWithBuffer(F,R),!n.intersectsClippingArea(F,this._context.clippingExtent)))continue;const N=m.createGeometry({overlayInfo:null,removeDuplicateStartEnd:m.RemoveDuplicateStartEnd.REMOVE,
attributeData:{position:L,mapPosition:R}}),T=N.vertexAttributes.get(B.VertexAttribute.POSITION);T.data===L&&(T.data=new Float64Array(L));K.outGeometries.push(N);K.outMaterials.push(d.unwrap(this._outlineMaterial));K.outTransforms.push(w.IDENTITY);K.outNum++}}};P._createAsOverlay=function(K,M){const U=u.geometryAsPolygon(K.geometry);if(d.isNone(U))return null;d.unwrap(this._material).renderPriority=this._renderPriority+this._renderPriorityStep/2;d.isSome(this._outlineMaterial)&&(this._outlineMaterial.renderPriority=
this._renderPriority);J.renderData=u.geometryToRenderInfoDraped(U,this._context.overlaySR);J.color=M;M=J.renderData.position.length/3;this._needsUV&&(J.uvMapSpace=new Float32Array(4*M));J.outNum=0;J.outGeometries=[];J.outBoundingBox=n.empty();J.layerUid=this._context.layer.uid;J.graphicsUid=K.uid;this._createAsOverlayFill(J);this._hasOutline&&this._createAsOverlayOutline(J);this._logGeometryCreationWarnings(J.renderData,U.rings,"rings","FillSymbol3DLayer");if(0===J.outNum)return null;this._needsUV&&
q.createMapSpaceUVCoordsDraped(f.BufferViewVec4f.fromTypedArray(J.uvMapSpace),f.BufferViewVec3f64.fromTypedArray(J.renderData.position),this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode);return 0<J.outNum?new r(this,J.outGeometries,J.outBoundingBox):null};P._createAsOverlayFill=function(K){var M=K.renderData.polygons;for(const {position:U,holeIndices:R,index:L,count:N}of M){n.empty(F);n.expandWithBuffer(F,U);if(!n.intersectsClippingArea(F,this._context.clippingExtent))continue;
M=x.earcut(U,R,3);if(0===M.length)continue;n.expandWithAABB(K.outBoundingBox,F);M=new Uint32Array(M);M=u.createColorGeometry({indices:M,attributeData:{position:U,color:K.color,uvMapSpace:this._needsUV?new Float32Array(K.uvMapSpace.buffer,4*L*K.uvMapSpace.BYTES_PER_ELEMENT,4*N):null}});M=new v.RenderGeometry(M,d.unwrap(this._material),{layerUid:K.layerUid,graphicUid:K.graphicsUid});const T=F;l.set(M.boundingSphere,.5*(T[0]+T[3]),.5*(T[1]+T[4]),0,.5*Math.sqrt((T[3]-T[0])*(T[3]-T[0])+(T[4]-T[1])*(T[4]-
T[1])));K.outGeometries.push(M);K.outNum++}};P._createAsOverlayOutline=function(K){if(this._hasOutline){var M=K.renderData.outlines;for(let R=0;R<M.length;++R){var {position:U}=M[R];n.empty(F);n.expandWithBuffer(F,U);if(!n.intersectsClippingArea(F,this._context.clippingExtent))continue;n.expandWithAABB(K.outBoundingBox,F);U=m.createGeometry({overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:m.RemoveDuplicateStartEnd.REMOVE,
attributeData:{position:U}});U=new v.RenderGeometry(U,d.unwrap(this._outlineMaterial),{layerUid:K.layerUid,graphicUid:K.graphicsUid});const L=F;l.set(U.boundingSphere,.5*(L[0]+L[3]),.5*(L[1]+L[4]),0,.5*Math.sqrt((L[3]-L[0])*(L[3]-L[0])+(L[4]-L[1])*(L[4]-L[1])));K.outGeometries.push(U);K.outNum++}}};P._getOutlineOpacity=function(){const K=d.get(this.symbolLayer,"outline","color");return(this.draped?1:this._getLayerOpacity())*(d.isSome(K)?K.a:0)};P._getOutlineColor=function(){const K=d.get(this.symbolLayer,
"outline","color"),M=this._getOutlineOpacity();return h.mixinColorAndOpacity(d.isSome(K)?c.toUnitRGB(K):null,M)};b._createClass(O,[{key:"test",get:function(){return{createAsOverlay:(K,M)=>this._createAsOverlay(K,M),createAs3DShape:(K,M,U)=>this._createAs3DShape(K,M,U)}}}]);return O}(p.Graphics3DSymbolLayer);p.elevationModeChangeTypes={definedChanged:e.SymbolUpdateType.RECREATE,staysOnTheGround:e.SymbolUpdateType.NONE,onTheGroundChanged:e.SymbolUpdateType.RECREATE};const F=n.create(),G={renderData:null,
color:null,uvMapSpace:null,boundingRect:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},J={renderData:null,color:null,uvMapSpace:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null};a.Graphics3DPolygonFillSymbolLayer=p;a.default=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/patternUtils":function(){define("exports ../../../../core/has ../../../../core/maybe ../../../../chunks/vec4f64 ../../../../geometry/support/buffer/BufferView ../graphics/ElevationAligners ./uvUtils ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/ColorMaterial ../../webgl-engine/materials/PatternMaterial ../../webgl-engine/materials/PatternStyle".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e){function k(h,m,u){if(c.isSome(h)){if("none"===h.style||"solid"===h.style)return"none"===h.style&&(m.color=d.fromValues(0,0,0,0),m.transparent=!0),new n.ColorMaterial(m);m.style=r(h.style);m.draped=u.isDraped;return new f.PatternMaterial(m)}return new n.ColorMaterial(m)}function r(h){switch(h){case "horizontal":return e.Style.Horizontal;case "vertical":return e.Style.Vertical;case "cross":return e.Style.Cross;case "forward-diagonal":return e.Style.ForwardDiagonal;case "backward-diagonal":return e.Style.BackwardDiagonal;
case "diagonal-cross":return e.Style.DiagonalCross}}function y(h){return h.material instanceof f.PatternMaterial&&!h.material.parameters.draped}function p(h,m){if(y(h)){var u=h.geometry.vertexAttributes;h=u.get(l.VertexAttribute.POSITION).data;const t=u.get(l.VertexAttribute.UVMAPSPACE).data;u=u.get(l.VertexAttribute.BOUNDINGRECT).data;w.createMapSpaceUVCoords(g.BufferViewVec4f.fromTypedArray(t),g.BufferViewVec3f64.fromTypedArray(h),m,g.BufferViewMat3f64.fromTypedArray(u))}}a.createMaterial=function(h,
m,u){return k(h&&h.pattern||null,m,u)};a.createMaterialFromPattern=k;a.parsePatternStyle=r;a.requiresUVUpdates=y;a.updateMapSpaceUVCoords=p;a.uvElevationAligner=function(h,m,u,t){m=x.perVertexElevationAligner(h,m,u,t);h=h.stageObject.geometryRecords;for(u=0;u<h.length;u++)p(h[u],t);return m};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/uvUtils":function(){define("exports ../../../../core/maybe ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/projectionEllipsoid ../../../../geometry/support/plane ../../../../geometry/support/buffer/BufferView ../../../ViewingMode".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k){function r(I,O,P,K,M,U,R){x.set(I,O*M[0]+P*U[0]+K*R[0],O*M[1]+P*U[1]+K*R[1],O*M[2]+P*U[2]+K*R[2])}const y=w.create(),p=w.create(),h=f.create(),m=w.create(),u=w.create(),t=w.create(),q=g.create(),z=g.create(),v=g.create(),B=w.create(),A=w.create(),E=w.create(),C=c.create(),D=w.create(),F=w.create(),G=w.create(),J=w.create();a.createMapSpaceUVCoords=function(I,O,P,K,M=1){x.set(m,1,0,0);x.set(u,0,1,0);x.set(t,0,0,1);x.set(J,0,0,0);for(var U=0;U<O.count-1;U++)O.getVec(U,
p),x.add(J,J,p);x.scale(y,J,1/(O.count-1));U=O.count-1;if(U=f.fromManyPointsSampleAt(O,h,0,Math.floor(U/3),Math.floor(2/3*U))){b.isSome(P)?(P.basisMatrixAtPosition(y,C),x.set(D,C[0],C[1],C[2]),x.set(F,C[4],C[5],C[6]),x.set(G,C[8],C[9],C[10])):(x.set(D,1,0,0),x.set(F,0,1,0),x.set(G,0,0,1));P=f.normal(h);0>x.dot(P,G)&&x.scale(P,P,-1);x.copy(t,P);U=x.dot(P,F);var R=x.dot(P,D);Math.abs(U)<Math.abs(R)?(x.scaleAndAdd(m,D,P,-R),x.normalize(m,m),x.cross(u,m,P),x.normalize(u,u),x.scale(u,u,-1)):(x.scaleAndAdd(u,
F,P,-U),x.normalize(u,u),x.cross(m,u,P),x.normalize(m,m))}d.set(q,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);d.set(z,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(P=0;P<O.count;P++)O.getVec(P,p),U=x.dot(m,p),R=x.dot(u,p),q[0]=Math.min(q[0],U),q[1]=Math.min(q[1],R),z[0]=Math.max(z[0],U),z[1]=Math.max(z[1],R);P=x.dot(t,y);r(B,q[0],q[1],P,m,u,t);r(A,z[0],q[1],P,m,u,t);r(E,q[0],z[1],P,m,u,t);x.subtract(A,A,B);x.scale(A,A,.5);x.subtract(E,E,B);x.scale(E,E,.5);x.add(B,B,A);x.add(B,B,E);
P=q[1]%M;v[0]=q[0]-q[0]%M;v[1]=q[1]-P;for(P=0;P<O.count;P++)for(O.getVec(P,p),I.setValues(P,(x.dot(m,p)-v[0])/M,(x.dot(u,p)-v[1])/M,v[0]/M,v[1]/M),U=0;3>U;U++)K.set(P,U,B[U]),K.set(P,U+3,A[U]),K.set(P,U+6,E[U])};a.createMapSpaceUVCoordsDraped=function(I,O,P,K,M=1){if(P.isGeographic&&K===k.ViewingMode.Global){K=new Float64Array(O.typedBuffer.length);const U=3*O.count;P=n.getReferenceEllipsoid(P);for(let R=0;R<U;R+=3)l.lonLatToWebMercatorComparable(O.typedBuffer,R,K,R,P);O=e.BufferViewVec3f64.fromTypedArray(K)}d.set(q,
Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(K=0;K<O.count;K++)O.getVec(K,p),q[0]=Math.min(q[0],p[0]),q[1]=Math.min(q[1],p[1]);K=q[1]%M;v[0]=q[0]-q[0]%M;v[1]=q[1]-K;for(K=0;K<O.count;K++)O.getVec(K,p),I.setValues(K,(p[0]-v[0])/M,(p[1]-v[1])/M,v[0]/M,v[1]/M)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/ColorMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderLibrary/ShaderOutputOptions ../lib/basicInterfaces ../lib/GLMaterial ../lib/GLMaterials ../lib/Material ../lib/OrderIndependentTransparency ../lib/RenderSlot ./internal/DefaultBufferWriter ./internal/MaterialUtil ../shaders/ColorMaterialTechnique".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k){let r=function(h){function m(t){t=h.call(this,t,p)||this;t.supportsEdges=!0;t.techniqueConfig=new k.ColorMaterialTechniqueConfiguration;return t}b._inheritsLoose(m,h);var u=m.prototype;u.getTechniqueConfig=function(t,q){this.techniqueConfig.output=t;this.techniqueConfig.cullFace=this.parameters.cullFace;this.techniqueConfig.vertexColors=this.parameters.vertexColors;this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled;this.techniqueConfig.transparent=
this.parameters.transparent;this.techniqueConfig.polygonOffset=this.parameters.polygonOffset;this.techniqueConfig.writeDepth=this.parameters.writeDepth;this.techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees;this.techniqueConfig.transparencyPassType=q.transparencyPassType;this.techniqueConfig.enableOffset=q.camera.relativeElevation<l.OITPolygonOffsetLimit;this.techniqueConfig.multipassTerrainEnabled=q.multipassTerrainEnabled;this.techniqueConfig.cullAboveGround=q.cullAboveGround;return this.techniqueConfig};
u.getPassParameters=function(){return this.parameters};u.intersect=function(t,q,z,v,B,A,E){e.intersectTriangleGeometry(t,q,v,B,A,void 0,E)};u.requiresSlot=function(t,q){return t===n.RenderSlot.DRAPED_MATERIAL?!0:x.outputFromPass(q)===c.ShaderOutput.Highlight?t===n.RenderSlot.OPAQUE_MATERIAL:t===(this.parameters.transparent?this.parameters.writeDepth?n.RenderSlot.TRANSPARENT_MATERIAL:n.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:n.RenderSlot.OPAQUE_MATERIAL)};u.createGLMaterial=function(t){return t.output===
c.ShaderOutput.Color||t.output===c.ShaderOutput.Alpha||t.output===c.ShaderOutput.Highlight||t.output===c.ShaderOutput.Depth&&this.parameters.writeLinearDepth?new y(t):null};u.createBufferWriter=function(){return new f.DefaultBufferWriter(f.PositionColorLayout)};return m}(w.Material),y=function(h){function m(){return h.apply(this,arguments)||this}b._inheritsLoose(m,h);var u=m.prototype;u.updateParameters=function(t){return this.ensureTechnique(k.ColorMaterialTechnique,t)};u._updateOccludeeState=function(t){t.hasOccludees!==
this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:t.hasOccludees})};u.beginSlot=function(t){this._output!==c.ShaderOutput.Color&&this._output!==c.ShaderOutput.Alpha||this._updateOccludeeState(t);return this.updateParameters(t)};u.bind=function(t,q){q.bindPass(this._material.getPassParameters(),t)};return m}(g);const p={color:[1,1,1,1],transparent:!1,writeDepth:!0,writeLinearDepth:!1,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,cullFace:d.CullFaceOptions.None,
sceneHasOcludees:!1,...w.DefaultMaterialParameters};a.ColorMaterial=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/ColorMaterialTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../../../../chunks/ColorMaterial.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t){e=function(z){function v(){return z.apply(this,arguments)||this}c._inheritsLoose(v,z);var B=v.prototype;B.initializeProgram=function(A){var E=v.shader.get();const C=this.configuration;E=E.build({output:C.output,oitEnabled:C.transparencyPassType===r.TransparencyPassType.Color,attributeColor:C.vertexColors,slicePlaneEnabled:C.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,multipassTerrainEnabled:C.multipassTerrainEnabled,
cullAboveGround:C.cullAboveGround});return new h.Program(A.rctx,E,y.Default3D)};B.bindPass=function(A,E){n.bindProjectionMatrix(this.program,E.camera.projectionMatrix);this.program.setUniform4fv("eColor",A.color);this.configuration.output===g.ShaderOutput.Highlight&&w.bindOutputHighlight(this.program,E);(this.configuration.output===g.ShaderOutput.Depth||E.multipassTerrainEnabled)&&this.program.setUniform2fv("nearFar",E.camera.nearFar);E.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",
E.inverseViewport),l.bindMultipassTerrainTexture(this.program,E))};B.bindDraw=function(A){n.bindView(this.program,A);this.program.rebindTextures();x.bindSliceUniformsWithOrigin(this.program,this.configuration,A)};B._createPipeline=function(A,E){const C=this.configuration,D=A===r.TransparencyPassType.NONE,F=A===r.TransparencyPassType.FrontFace;return t.makePipelineState({blending:C.output!==g.ShaderOutput.Color&&C.output!==g.ShaderOutput.Alpha||!C.transparent?null:D?p.blendingDefault:p.oitBlending(A),
culling:t.cullingParams(C.cullFace),depthTest:{func:p.oitDepthTest(A)},depthWrite:D||F?C.writeDepth&&t.defaultDepthWriteParams:null,colorWrite:t.defaultColorWriteParams,stencilWrite:C.sceneHasOcludees?m.stencilWriteMaskOn:null,stencilTest:C.sceneHasOcludees?E?m.stencilToolMaskBaseParams:m.stencilBaseAllZerosParams:null,polygonOffset:D||F?C.polygonOffset&&q:p.getOITPolygonOffset(C.enableOffset)})};B.initializePipeline=function(){this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,
!0);return this._createPipeline(this.configuration.transparencyPassType,!1)};B.getPipelineState=function(A,E){return E?this._occludeePipelineState:z.prototype.getPipelineState.call(this,A,E)};return v}(e.ShaderTechnique);e.shader=new f.ReloadableShaderModule(u.ColorMaterialShader,()=>new Promise((z,v)=>a(["./ColorMaterial.glsl"],z,v)));const q={factor:1,units:1};f=function(z){function v(){var B=z.apply(this,arguments)||this;B.output=g.ShaderOutput.Color;B.cullFace=r.CullFaceOptions.None;B.slicePlaneEnabled=
!1;B.vertexColors=!1;B.transparent=!1;B.polygonOffset=!1;B.enableOffset=!0;B.writeDepth=!0;B.sceneHasOcludees=!1;B.transparencyPassType=r.TransparencyPassType.NONE;B.multipassTerrainEnabled=!1;B.cullAboveGround=!1;return B}c._inheritsLoose(v,z);return v}(k.ShaderTechniqueConfiguration);d.__decorate([k.parameter({count:g.ShaderOutput.COUNT})],f.prototype,"output",void 0);d.__decorate([k.parameter({count:r.CullFaceOptions.COUNT})],f.prototype,"cullFace",void 0);d.__decorate([k.parameter()],f.prototype,
"slicePlaneEnabled",void 0);d.__decorate([k.parameter()],f.prototype,"vertexColors",void 0);d.__decorate([k.parameter()],f.prototype,"transparent",void 0);d.__decorate([k.parameter()],f.prototype,"polygonOffset",void 0);d.__decorate([k.parameter()],f.prototype,"enableOffset",void 0);d.__decorate([k.parameter()],f.prototype,"writeDepth",void 0);d.__decorate([k.parameter()],f.prototype,"sceneHasOcludees",void 0);d.__decorate([k.parameter({count:r.TransparencyPassType.COUNT})],f.prototype,"transparencyPassType",
void 0);d.__decorate([k.parameter()],f.prototype,"multipassTerrainEnabled",void 0);d.__decorate([k.parameter()],f.prototype,"cullAboveGround",void 0);b.ColorMaterialTechnique=e;b.ColorMaterialTechniqueConfiguration=f;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/ColorMaterial.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y){function p(m){const u=new r.ShaderBuilder,t=m.output===b.ShaderOutput.Depth;u.include(d.Transform,{linearDepth:t});u.include(g.VertexColor,m);u.vertex.uniforms.add("proj","mat4").add("view","mat4");u.attributes.add(y.VertexAttribute.POSITION,"vec3");u.varyings.add("vpos","vec3");m.multipassTerrainEnabled&&u.varyings.add("depth","float");t&&(u.include(x.OutputDepth,m),u.vertex.uniforms.add("nearFar","vec2"),u.varyings.add("linearDepth","float"));u.vertex.code.add(k.glsl`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      ${m.multipassTerrainEnabled?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${t?k.glsl`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:k.glsl`transformPosition(proj, view, vpos);`}
    }
  `);u.include(c.Slice,m);u.fragment.include(e.ColorConversion);m.multipassTerrainEnabled&&(u.fragment.include(l.ReadLinearDepth),u.include(n.multipassTerrainTest,m));u.fragment.uniforms.add("eColor","vec4");m.output===b.ShaderOutput.Highlight&&u.include(w.OutputHighlight);u.fragment.code.add(k.glsl`
  void main() {
    discardBySlice(vpos);
    ${m.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 fColor = ${m.attributeColor?"vColor * eColor;":"eColor;"}

    if (fColor.a < ${k.glsl.float(f.symbolAlphaCutoff)}) {
      discard;
    }

    ${m.output===b.ShaderOutput.Alpha?k.glsl`gl_FragColor = vec4(fColor.a);`:""}

    ${m.output===b.ShaderOutput.Color?k.glsl`gl_FragColor = highlightSlice(fColor, vpos); ${m.oitEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}`:""}
    ${m.output===b.ShaderOutput.Highlight?k.glsl`outputHighlight();`:""};
    ${m.output===b.ShaderOutput.Depth?k.glsl`outputDepth(linearDepth);`:""};
  }
  `);return u}const h=Object.freeze({__proto__:null,build:p});a.ColorMaterialShader=h;a.build=p})},"esri/views/3d/webgl-engine/materials/PatternMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry/support/buffer/BufferView ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutputOptions ../lib/basicInterfaces ../lib/GLMaterial ../lib/GLMaterials ../lib/Material ../lib/OrderIndependentTransparency ../lib/RenderSlot ../lib/Util ../lib/VertexAttribute ./PatternStyle ./internal/bufferWriterUtils ./internal/DefaultBufferWriter ./internal/MaterialUtil ../shaders/PatternTechnique".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u){let t=function(B){function A(C){C=B.call(this,C,v)||this;C.supportsEdges=!0;C._vertexAttributeLocations=u.patternVertexAttributeLocations;C.techniqueConfig=new u.PatternTechniqueConfiguration;return C}b._inheritsLoose(A,B);var E=A.prototype;E.getTechniqueConfig=function(C,D){this.techniqueConfig.output=C;this.techniqueConfig.cullFace=this.parameters.cullFace;this.techniqueConfig.vertexColors=this.parameters.vertexColors;this.techniqueConfig.slicePlaneEnabled=
this.parameters.slicePlaneEnabled;this.techniqueConfig.polygonOffset=this.parameters.polygonOffset;this.techniqueConfig.writeDepth=this.parameters.writeDepth;this.techniqueConfig.style=this.parameters.style;this.techniqueConfig.patternSpacing=this.parameters.patternSpacing;this.techniqueConfig.lineWidth=this.parameters.lineWidth;this.techniqueConfig.draped=this.parameters.draped;this.techniqueConfig.transparencyPassType=D.transparencyPassType;this.techniqueConfig.enableOffset=D.camera.relativeElevation<
f.OITPolygonOffsetLimit;this.techniqueConfig.multipassTerrainEnabled=D.multipassTerrainEnabled;this.techniqueConfig.cullAboveGround=D.cullAboveGround;return this.techniqueConfig};E.getPassParameters=function(){return this.parameters};E.intersect=function(C,D,F,G,J,I,O){m.intersectTriangleGeometry(C,D,G,J,I,void 0,O)};E.requiresSlot=function(C,D){return C===e.RenderSlot.DRAPED_MATERIAL?!0:l.outputFromPass(D)===g.ShaderOutput.Highlight?C===e.RenderSlot.OPAQUE_MATERIAL:C===(this.parameters.writeDepth?
e.RenderSlot.TRANSPARENT_MATERIAL:e.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL)};E.createGLMaterial=function(C){return C.output===g.ShaderOutput.Color||C.output===g.ShaderOutput.Alpha||C.output===g.ShaderOutput.Highlight||C.output===g.ShaderOutput.Depth&&this.parameters.writeLinearDepth?new q(C):null};E.createBufferWriter=function(){const C=d.newLayout().vec3f(r.VertexAttribute.POSITION).vec4u8(r.VertexAttribute.COLOR).vec4f(r.VertexAttribute.UVMAPSPACE);this.parameters.draped||C.mat3f(r.VertexAttribute.BOUNDINGRECT);
return new z(C)};return A}(n.Material),q=function(B){function A(){return B.apply(this,arguments)||this}b._inheritsLoose(A,B);var E=A.prototype;E.updateParameters=function(C){return this.ensureTechnique(u.PatternTechnique,C)};E._updateOccludeeState=function(C){C.hasOccludees!==this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:C.hasOccludees})};E.beginSlot=function(C){this._output!==g.ShaderOutput.Color&&this._output!==g.ShaderOutput.Alpha||this._updateOccludeeState(C);
return this.updateParameters(C)};E.bind=function(C,D){D.bindPass(this._material.getPassParameters(),C)};return A}(w),z=function(B){function A(){return B.apply(this,arguments)||this}b._inheritsLoose(A,B);var E=A.prototype;E.write=function(C,D,F,G){for(const I of this.vertexBufferLayout.fieldNames){const O=D.vertexAttributes.get(I),P=D.indices.get(I);if(O&&P)switch(I){case r.VertexAttribute.POSITION:k.assert(3===O.size);var J=F.getField(I,c.BufferViewVec3f);J&&p.writePosition(P,O.data,C.transformation,
J,G);break;case r.VertexAttribute.COLOR:k.assert(3===O.size||4===O.size);(J=F.getField(I,c.BufferViewVec4u8))&&p.writeColor(P,O.data,O.size,J,G);break;case r.VertexAttribute.UVMAPSPACE:k.assert(4===O.size);(J=F.getField(I,c.BufferViewVec4f))&&p.writeBufferVec4(P,O.data,J,G);break;case r.VertexAttribute.BOUNDINGRECT:k.assert(9===O.size),(J=F.getField(I,c.BufferViewMat3f))&&this.writeBoundingRect(P,O.data,C.transformation,J,G)}}};E.writeBoundingRect=function(C,D,F,G,J){const I=G.typedBuffer;G=G.typedBufferStride;
const O=C.length;J*=G;for(let K=0;K<O;++K){const M=9*C[K];var P=D[M];const U=D[M+1],R=D[M+2];I[J]=F[0]*P+F[4]*U+F[8]*R+F[12];I[J+1]=F[1]*P+F[5]*U+F[9]*R+F[13];I[J+2]=F[2]*P+F[6]*U+F[10]*R+F[14];for(P=3;9>P;++P)I[J+P]=D[M+P];J+=G}};return A}(h.DefaultBufferWriter);const v={color:[1,1,1,1],writeDepth:!0,writeLinearDepth:!1,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,cullFace:x.CullFaceOptions.None,sceneHasOcludees:!1,style:y.Style.Cross,patternSpacing:10,lineWidth:1,draped:!0,...n.DefaultMaterialParameters};
a.PatternMaterial=t;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/PatternStyle":function(){define(["exports"],function(a){a.Style=void 0;var b=a.Style||(a.Style={});b[b.Horizontal=0]="Horizontal";b[b.Vertical=1]="Vertical";b[b.Cross=2]="Cross";b[b.ForwardDiagonal=3]="ForwardDiagonal";b[b.BackwardDiagonal=4]="BackwardDiagonal";b[b.DiagonalCross=5]="DiagonalCross";b[b.COUNT=6]="COUNT";Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/PatternTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../lib/VertexAttribute ../materials/PatternStyle ../../../../chunks/Pattern.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q){e=function(B){function A(){return B.apply(this,arguments)||this}c._inheritsLoose(A,B);var E=A.prototype;E.initializeProgram=function(C){var D=A.shader.get();const F=this.configuration;D=D.build({output:F.output,attributeColor:F.vertexColors,slicePlaneEnabled:F.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,style:F.style,patternSpacing:F.patternSpacing,lineWidth:F.lineWidth,draped:F.draped,oitEnabled:F.transparencyPassType===
r.TransparencyPassType.Color,multipassTerrainEnabled:F.multipassTerrainEnabled,cullAboveGround:F.cullAboveGround});return new p.Program(C.rctx,D,v)};E.bindPass=function(C,D){n.bindProjectionMatrix(this.program,D.camera.projectionMatrix);this.program.setUniform4fv("uColor",C.color);this.configuration.draped?(this.program.setUniform1f("worldToScreenRatio",1/D.screenToPCSRatio),this.program.setUniform1f("texelSize",1/D.camera.pixelRatio)):this.program.setUniform1f("worldToScreenPerDistanceRatio",1/D.camera.perScreenPixelRatio);
this.configuration.output===g.ShaderOutput.Highlight&&w.bindOutputHighlight(this.program,D);(this.configuration.output===g.ShaderOutput.Depth||D.multipassTerrainEnabled)&&this.program.setUniform2fv("nearFar",D.camera.nearFar);D.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",D.inverseViewport),l.bindMultipassTerrainTexture(this.program,D))};E.bindDraw=function(C){n.bindView(this.program,C);n.bindCameraPosition(this.program,C.origin,C.camera.viewInverseTransposeMatrix);x.bindSliceUniformsWithOrigin(this.program,
this.configuration,C);this.program.rebindTextures()};E._setPipelineState=function(C,D){const F=this.configuration,G=C===r.TransparencyPassType.NONE,J=C===r.TransparencyPassType.FrontFace;return q.makePipelineState({blending:F.output===g.ShaderOutput.Color||F.output===g.ShaderOutput.Alpha?G?y.blendingDefault:y.oitBlending(C):null,culling:q.cullingParams(F.cullFace),depthTest:{func:y.oitDepthTest(C)},depthWrite:G?F.writeDepth&&q.defaultDepthWriteParams:y.oitDepthWrite(C),colorWrite:q.defaultColorWriteParams,
stencilWrite:F.sceneHasOcludees?h.stencilWriteMaskOn:null,stencilTest:F.sceneHasOcludees?D?h.stencilToolMaskBaseParams:h.stencilBaseAllZerosParams:null,polygonOffset:G||J?F.polygonOffset&&z:y.getOITPolygonOffset(F.enableOffset)})};E.initializePipeline=function(){this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0);return this._setPipelineState(this.configuration.transparencyPassType,!1)};E.getPipelineState=function(C,D){return D?this._occludeePipelineState:
B.prototype.getPipelineState.call(this,C,D)};return A}(e.ShaderTechnique);e.shader=new f.ReloadableShaderModule(t.PatternShader,()=>new Promise((B,A)=>a(["./Pattern.glsl"],B,A)));const z={factor:1,units:1};f=function(B){function A(){var E=B.apply(this,arguments)||this;E.output=g.ShaderOutput.Color;E.cullFace=r.CullFaceOptions.None;E.slicePlaneEnabled=!1;E.vertexColors=!1;E.polygonOffset=!1;E.writeDepth=!0;E.sceneHasOcludees=!1;E.enableOffset=!0;E.transparencyPassType=r.TransparencyPassType.NONE;E.multipassTerrainEnabled=
!1;E.cullAboveGround=!1;return E}c._inheritsLoose(A,B);return A}(k.ShaderTechniqueConfiguration);d.__decorate([k.parameter({count:g.ShaderOutput.COUNT})],f.prototype,"output",void 0);d.__decorate([k.parameter({count:r.CullFaceOptions.COUNT})],f.prototype,"cullFace",void 0);d.__decorate([k.parameter()],f.prototype,"slicePlaneEnabled",void 0);d.__decorate([k.parameter()],f.prototype,"vertexColors",void 0);d.__decorate([k.parameter()],f.prototype,"polygonOffset",void 0);d.__decorate([k.parameter()],
f.prototype,"writeDepth",void 0);d.__decorate([k.parameter()],f.prototype,"sceneHasOcludees",void 0);d.__decorate([k.parameter({count:u.Style.COUNT})],f.prototype,"style",void 0);d.__decorate([k.parameter()],f.prototype,"patternSpacing",void 0);d.__decorate([k.parameter()],f.prototype,"lineWidth",void 0);d.__decorate([k.parameter()],f.prototype,"enableOffset",void 0);d.__decorate([k.parameter()],f.prototype,"draped",void 0);d.__decorate([k.parameter({count:r.TransparencyPassType.COUNT})],f.prototype,
"transparencyPassType",void 0);d.__decorate([k.parameter()],f.prototype,"multipassTerrainEnabled",void 0);d.__decorate([k.parameter()],f.prototype,"cullAboveGround",void 0);const v=new Map([[m.VertexAttribute.POSITION,0],[m.VertexAttribute.COLOR,3],[m.VertexAttribute.UVMAPSPACE,4],[m.VertexAttribute.BOUNDINGRECT,5]]);b.PatternTechnique=e;b.PatternTechniqueConfiguration=f;b.patternVertexAttributeLocations=v;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/Pattern.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/materials/PatternStyle".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p){function h(t){const q=new r.ShaderBuilder;t.draped||q.extensions.add("GL_OES_standard_derivatives");const z=t.output===b.ShaderOutput.Depth;q.include(d.Transform,{linearDepth:z});q.include(g.VertexColor,t);q.vertex.uniforms.add("proj","mat4");q.vertex.uniforms.add("view","mat4");z&&(q.include(x.OutputDepth,t),q.vertex.uniforms.add("nearFar","vec2"),q.varyings.add("linearDepth","float"));t.draped?q.vertex.uniforms.add("worldToScreenRatio","float"):(q.vertex.uniforms.add("worldToScreenPerDistanceRatio",
"float"),q.vertex.uniforms.add("cameraPosition","vec3"),q.attributes.add(y.VertexAttribute.BOUNDINGRECT,"mat3"));q.attributes.add(y.VertexAttribute.POSITION,"vec3");q.attributes.add(y.VertexAttribute.UVMAPSPACE,"vec4");q.varyings.add("vpos","vec3");q.varyings.add("vuv","vec2");t.multipassTerrainEnabled&&q.varyings.add("depth","float");const v=t.style===p.Style.ForwardDiagonal||t.style===p.Style.BackwardDiagonal||t.style===p.Style.DiagonalCross;v&&q.vertex.code.add(k.glsl`
      const mat2 rotate45 = mat2(${k.glsl.float(.70710678118)}, ${k.glsl.float(-.70710678118)},
                                 ${k.glsl.float(.70710678118)}, ${k.glsl.float(.70710678118)});
    `);t.draped||(q.vertex.code.add(k.glsl`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),q.vertex.code.add(k.glsl`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),q.vertex.code.add(k.glsl`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${k.glsl.float(.08715574274)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `));q.vertex.code.add(k.glsl`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${v?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${v?" * rotate45":""};

      ${t.draped?"":k.glsl`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${k.glsl.float(t.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `);q.vertex.code.add(k.glsl`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${t.multipassTerrainEnabled?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      gl_Position = ${z?k.glsl`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:k.glsl`transformPosition(proj, view, vpos);`}
    }
  `);q.include(c.Slice,t);q.fragment.include(e.ColorConversion);q.fragment.uniforms.add("uColor","vec4");t.draped&&q.fragment.uniforms.add("texelSize","float");t.output===b.ShaderOutput.Highlight&&q.include(w.OutputHighlight);t.multipassTerrainEnabled&&(q.fragment.include(l.ReadLinearDepth),q.include(n.multipassTerrainTest,t));t.output!==b.ShaderOutput.Highlight&&(q.fragment.code.add(k.glsl`
      const float lineWidth = ${k.glsl.float(t.lineWidth)};
      const float spacing = ${k.glsl.float(t.patternSpacing)};
      const float spacingINV = ${k.glsl.float(1/t.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),t.draped||q.fragment.code.add(k.glsl`const int maxSamples = 5;
float sample(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`));q.fragment.code.add(k.glsl`
    void main() {
      discardBySlice(vpos);
      ${t.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec4 color = ${t.attributeColor?"vColor * uColor;":"uColor;"}
      color = highlightSlice(color, vpos);

      ${t.output!==b.ShaderOutput.Highlight?k.glsl`color.a *= ${m(t)};`:""}

      if (color.a < ${k.glsl.float(f.symbolAlphaCutoff)}) {
        discard;
      }

      ${t.output===b.ShaderOutput.Alpha?k.glsl`gl_FragColor = vec4(color.a);`:""}

      ${t.output===b.ShaderOutput.Color?k.glsl`gl_FragColor = color; ${t.oitEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}`:""}
      ${t.output===b.ShaderOutput.Highlight?k.glsl`outputHighlight();`:""}
      ${t.output===b.ShaderOutput.Depth?k.glsl`outputDepth(linearDepth);`:""};
    }
  `);return q}function m(t){function q(z){return t.draped?k.glsl`coverage(vuv.${z}, texelSize)`:k.glsl`sample(vuv.${z})`}switch(t.style){case p.Style.ForwardDiagonal:case p.Style.Horizontal:return q("y");case p.Style.BackwardDiagonal:case p.Style.Vertical:return q("x");case p.Style.DiagonalCross:case p.Style.Cross:return k.glsl`
        1.0 - (1.0 - ${q("x")}) * (1.0 - ${q("y")})
      `;default:return"0.0"}}const u=Object.freeze({__proto__:null,build:h});a.PatternShader=u;a.build=h})},"esri/views/3d/layers/graphics/Graphics3DTextSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Error ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../chunks/vec2f64 ../../../../symbols/callouts/calloutUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./placementUtils ./pointUtils ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTextureFactory ../../webgl-engine/materials/HUDMaterial".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q){function z(C,D,F){C&&C.forEach(G=>{const J=D(G);d.isSome(J)&&F(J,G.graphic)})}function v(C,D){if("baseline"===D.verticalPlacement)return D=p.horizontalPlacementToAnchorX[D.horizontalPlacement],C=d.isSome(C)?C.baselineAnchorY:0,w.fromValues(D,C);C=p.anchorFromPlacements(D.horizontalPlacement,D.verticalPlacement);return p.namedAnchorToHUDMaterialAnchorPos[C]}const B=[0,0,1];r=function(C){function D(G,J,I,O){G=C.call(this,G,J,I,O)||this;G._elevationOptions=
{supportsOffsetAdjustment:!0,supportsOnTheGround:!1};G.ensureDrapedStatus(!1);return G}b._inheritsLoose(D,C);var F=D.prototype;F.doLoad=function(){var G=b._asyncToGenerator(function*(){if(!this._drivenProperties.size){const J=y.validateSymbolLayerSize(this.symbolLayer.size);if(J)throw new c("graphics3dtextsymbollayer:invalid-size",J);}yield this._createTextRenderParameters()});return function(){return G.apply(this,arguments)}}();F._createTextRenderParameters=function(){var G=b._asyncToGenerator(function*(){this._textRenderParameters=
yield u.TextRenderParameters.fromSymbol(this.symbolLayer,this._context.graphicsCoreOwner.view.pixelRatio)});return function(){return G.apply(this,arguments)}}();F.destroy=function(){C.prototype.destroy.call(this)};F.createGraphics3DGraphic=function(G){G=G.graphic;const J=h.placePointOnGeometry(G.geometry);if(d.isNone(J))return this.logger.warn(`unsupported geometry type for text symbol: ${G.geometry.type}`),null;const I=this.symbolLayer.text;if(d.isNone(I)||""===I)return null;var O=l.hasCalloutSupport(this.symbol)&&
this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(d.isSome(O)&&!l.textSymbolLayerSupportsVerticalOffset(this.symbolLayer))return this.logger.errorOncePerTick("Callouts and vertical offset on text symbols are currently only supported with 'center' "+`horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;O={...E,verticalOffset:O,horizontalPlacement:p.horizontalPlacementFromAlignment(this.symbolLayer.horizontalAlignment),verticalPlacement:p.verticalPlacementFromAlignment(this.symbolLayer.verticalAlignment)};
return this._createAs3DShape(G,J,I,O)};F.createLabel=function(G,J,I,O){G=G.graphic;const P=h.placePointOnGeometry(G.geometry);if(d.isNone(P))return this.logger.warn(`unsupported geometry type for label: ${G.geometry.type}`),null;const K=J.text;return!K||/^\s+$/.test(K)?null:this._createAs3DShape(G,P,K,J,I,O)};F.setGraphicElevationContext=function(G,J,I=0){G=C.prototype.setGraphicElevationContext.call(this,G,J);G.addOffsetRenderUnits(I);return G};F.layerOpacityChanged=function(){this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer");
return!1};F.layerElevationInfoChanged=function(G,J){z(G,J,(I,O)=>{this.updateGraphicElevationContext(O,I)});return f.SymbolUpdateType.UPDATE};F.slicePlaneEnabledChanged=function(G,J){z(G,J,I=>{for(const O of I.stageObject.geometryRecords)O.material.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled})});return!0};F.physicalBasedRenderingChanged=function(){return!0};F.pixelRatioChanged=function(){return!1};F.updateGraphicElevationContext=function(G,J){this.setGraphicElevationContext(G,
J.elevationContext,J.metadata.elevationOffset);J.needsElevationUpdates=f.needsElevationUpdates2D(J.elevationContext.mode)||"absolute-height"===J.elevationContext.mode};F._defaultElevationInfoNoZ=function(){return A};F._createAs3DShape=function(G,J,I,O,P,K){const M=this.setGraphicElevationContext(G,new e.ElevationContext,O.elevationOffset);var U="polyline"===d.get(G.geometry,"type");G=G.uid;let R=null;var L=null;if(d.isNone(K)){L=p.textRenderAlignmentFromHorizontalPlacement(O.horizontalPlacement);
R=new t(I,L,this._textRenderParameters);let H=null;L=this._context.sharedResources.textures.fromData(R.key,()=>d.unwrap(R).create(),()=>{d.isSome(H)&&H.release()});var N=this._context.stage.renderView.textureRepository.acquire(L.texture.id);if(d.isNone(N)||g.isPromiseLike(N))return L.release(),null;H=N}N=v(R,O);N={occlusionTest:!0,screenOffset:O.screenOffset,anchorPos:N,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:O.centerOffsetUnits,debugDrawLabelBorder:O.debugDrawLabelBorder,drawInSecondSlot:!0};
d.isSome(L)&&(N.textureId=L.texture.id);d.isSome(K)&&(N.textureId=K.id);if(d.isSome(O.verticalOffset)){const {screenLength:H,minWorldLength:Q,maxWorldLength:W}=O.verticalOffset;N.verticalOffset={screenLength:x.pt2px(H),minWorldLength:Q||0,maxWorldLength:null!=W?W:Infinity}}if(this._context.screenSizePerspectiveEnabled){const {screenSizePerspectiveSettings:H,screenSizePerspectiveSettingsLabels:Q}=this._context.sharedResources;N.screenSizePerspective=Q.overridePadding(this._textRenderParameters.haloSize+
this._textRenderParameters.definition.background.padding[0]);N.screenSizePerspectiveAlignment=H}U&&(N.shaderPolygonOffset=1E-4);N.slicePlaneEnabled=this._context.slicePlaneEnabled;d.isSome(P)?(U=JSON.stringify(N),K=P.get(U),d.isNone(K)&&(K=new q.HUDMaterial(N),P.add(U,K))):K=new q.HUDMaterial(N);K=[K];U=O.translation;N=d.isSome(R)?[R.displayWidth,R.displayHeight]:[0,0];U=[m.createPointGeometry(B,U,null,N,O.centerOffset,[0,0],null)];G=h.createStageObjectForHUD(this._context,J,U,K,M,this._context.layer.uid,
G);if(null===G)return null;P=new k.Graphics3DObject3DGraphicLayer(this,G.object,U,d.isNone(P)?K:null,L,n.perObjectElevationAligner,M);P.alignedSampledElevation=G.sampledElevation;P.needsElevationUpdates=f.needsElevationUpdates2D(M.mode)||"absolute-height"===M.mode;const {displayWidth:T,displayHeight:S}=d.isSome(R)?R:O;P.getScreenSize=(H=w.create())=>{H[0]=T;H[1]=S;return H};P.metadata={labelText:I,elevationOffset:O.elevationOffset};h.extendPointGraphicElevationContext(P,J,this._context.elevationProvider);
return P};return D}(r.Graphics3DSymbolLayer);const A={mode:"relative-to-ground",offset:0},E={text:null,translation:[0,0,0],elevationOffset:0,centerOffset:[0,0,0,1],screenOffset:[0,0],horizontalPlacement:"center",verticalPlacement:"center",verticalOffset:null,centerOffsetUnits:null,debugDrawLabelBorder:!1,displayWidth:0,displayHeight:0};a.Graphics3DTextSymbolLayer=r;a.default=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextRenderParameters":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/Logger ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec4f64".split(" "),
function(a,b,c,d,g,x,w){const l=d.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters");d=function(){function n(e){this.definition=e;this.key=JSON.stringify(e);this.haloSize=Math.round(e.halo.size);this.textStyle=this._colorToRGBA(e.color);this.haloStyle=this._colorToRGB(e.halo.color);this.backgroundStyle=0!==e.background.color[3]?this._colorToRGBA(e.background.color):null}var f=n.prototype;f.fontString=function(e){const k=this.definition.font;return`${k.style} ${k.weight} ${e}px ${k.family}, sans-serif`};
f._colorToRGB=function(e){return`rgb(${e.slice(0,3).map(k=>Math.floor(255*k)).toString()})`};f._colorToRGBA=function(e){return`rgba(${e.slice(0,3).map(k=>Math.floor(255*k)).toString()},${e[3]})`};n.fromSymbol=function(){var e=b._asyncToGenerator(function*(k,r=1){var y=g.get(k,"material","color");const p=g.mapOr(y,w.ZEROS,c.toUnitRGBA);y=g.mapOr(k.size,12,x.pt2px);const h=k.lineHeight,m=g.isSome(k.background)?c.toUnitRGBA(k.background.color):w.ZEROS,u={family:g.mapOr(k.font,"sans-serif",q=>q.family),
decoration:g.mapOr(k.font,"none",q=>q.decoration),weight:g.mapOr(k.font,"normal",q=>q.weight),style:g.mapOr(k.font,"normal",q=>q.style)};var t=k.halo;t=g.isSome(t)&&g.isSome(t.color)&&0<t.size?{size:x.pt2px(t.size),color:c.toUnitRGBA(t.color)}:{size:0,color:w.ZEROS};k=new n({color:p,size:y,background:{color:m,padding:g.isSome(k.background)?[.65*y,.5*y]:[0,0],borderRadius:g.isSome(k.background)?.375*y:0},lineSpacingFactor:h,font:u,halo:t,pixelRatio:r});r=k.fontString(y);try{yield document.fonts.load(r)}catch(q){l.warnOnce(`Failed to preload font '${r}'. Some text symbology may be rendered using the default browser font.`)}return k});
return function(k){return e.apply(this,arguments)}}();return n}();a.TextRenderParameters=d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextTextureFactory":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","./basicInterfaces","./TextRenderer","./Texture","../../../webgl/enums"],function(a,b,c,d,g){const x={canvas:null};return function(){function w(l,n,f){this._renderer=new c.TextRenderer(l,n,f)}w.prototype.create=function(){const l=c.getTextHelperCanvas(x,
this._renderer.renderedWidth,this._renderer.renderedHeight),n=l.getContext("2d");n.save();this._renderer.render(n,0,0);n.restore();return new d.Texture(l,{wrap:{s:g.TextureWrapMode.CLAMP_TO_EDGE,t:g.TextureWrapMode.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0,powerOfTwoResizeMode:b.PowerOfTwoResizeMode.PAD})};a._createClass(w,[{key:"key",get:function(){return this._renderer.key}},{key:"baselineAnchorY",get:function(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}},
{key:"displayWidth",get:function(){return this._renderer.displayWidth}},{key:"displayHeight",get:function(){return this._renderer.displayHeight}}]);return w}()})},"esri/views/3d/layers/graphics/Graphics3DWaterSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/maybe ../../../../core/unitUtils ../../../../chunks/earcut ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec4 ../../../../chunks/common ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./polygonUtils ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/WaterMaterial ../../webgl-engine/materials/internal/waterMaterialUtils".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A){const E=["polyline","polygon","extent"];t=function(O){function P(M,U,R,L){return O.call(this,M,U,R,L)||this}b._inheritsLoose(P,O);var K=P.prototype;K.doLoad=function(){var M=b._asyncToGenerator(function*(){});return function(){return M.apply(this,arguments)}}();K.destroy=function(){O.prototype.destroy.call(this);this._context.stage.remove(this._material);this._material=null};K.createGraphics3DGraphic=function(M){M=M.graphic;if(!this._validateGeometry(M.geometry,
E,this.symbolLayer.type))return null;const U=this.setGraphicElevationContext(M,new h.ElevationContext);this.ensureDrapedStatus("on-the-ground"===U.mode);this.ensureMaterial();return this.draped?this._createAsOverlay(M):this._createAs3DShape(M,U,M.uid)};K.ensureMaterial=function(){if(!d.isSome(this._material)){var M={...A.defaultWaterMaterialParameters},U=this.symbolLayer.color;d.isSome(U)&&(M.color=c.toUnitRGBA(U));U=this._getCombinedOpacity(U,{hasIntrinsicColor:!0});M.color=[M.color[0],M.color[1],
M.color[2],U];M.transparent=1>U||this.needsDrivenTransparentPass;M.waveDirection=d.isSome(this.symbolLayer.waveDirection)?P.headingVectorFromAngle(this.symbolLayer.waveDirection):n.fromValues(0,0);U=A.wavePresets[this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize];M.waveStrength=U.waveStrength;M.waveTextureRepeat=U.textureRepeat;M.waveVelocity=U.waveVelocity;M.flowStrength=U.perturbationStrength;M.slicePlaneEnabled=this._context.slicePlaneEnabled;M.isDraped=this.draped;this._material=
new B.WaterMaterial(M);this._context.stage.add(this._material)}};K.layerOpacityChanged=function(){if(d.isNone(this._material))return!0;const M=this._material.parameters.color,U=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0});this._material.setParameters({color:[M[0],M[1],M[2],U],transparent:1>U||this.needsDrivenTransparentPass});return!0};K.layerElevationInfoChanged=function(M,U,R){const L=this._elevationContext.mode;R=p.elevationModeChangeUpdateType(P.elevationModeChangeTypes,
R,L);if(R!==p.SymbolUpdateType.UPDATE)return R;const N=p.needsElevationUpdates2D(L);return this.updateGraphics3DGraphicElevationInfo(M,U,()=>N)};K.slicePlaneEnabledChanged=function(){d.isSome(this._material)&&this._material.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};K.physicalBasedRenderingChanged=function(){return!0};K.pixelRatioChanged=function(){return!0};K._createAs3DShape=function(M,U,R){M=q.geometryAsPolygon(M.geometry);if(d.isNone(M))return null;J.renderData=
q.geometryToRenderInfo(M,this._context.elevationProvider,this._context.renderCoordsHelper,U);const L=J.renderData.position.length/3;J.uvCoords=new Float64Array(2*L);J.outNum=0;J.outGeometries=[];J.outTransforms=[];J.outMaterials=[];this._create3DShapeGeometries(J);this._logGeometryCreationWarnings(J.renderData,M.rings,"rings","WaterSymbol3DLayer");if(0===J.outNum)return null;this._createUVCoordsFromVertices(J.uvCoords,J.renderData.mapPosition,L,this._context.elevationProvider.spatialReference);R=
new z.Object3D({geometries:J.outGeometries,materials:J.outMaterials,transformations:J.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:R}});R=new u.Graphics3DObject3DGraphicLayer(this,R,J.outGeometries,null,null,y.perVertexElevationAligner,U);R.alignedSampledElevation=J.renderData.sampledElevation;R.needsElevationUpdates=p.needsElevationUpdates2D(U.mode);return R};K._createUVCoordsFromVertices=function(M,U,R,L){L=g.getMetersPerUnitForSR(L);r.empty(D);for(var N=0;N<
R;N++)l.set(F,U[3*N],U[3*N+1]),r.expandPointInPlace(D,F);f.scale(D,D,L);N=D[1]%P.unitSizeOfTexture;C[0]=D[0]-D[0]%P.unitSizeOfTexture;C[1]=D[1]-N;for(N=0;N<R;N++)M[2*N]=(U[3*N]*L-C[0])/P.unitSizeOfTexture,M[2*N+1]=(U[3*N+1]*L-C[1])/P.unitSizeOfTexture};K._create3DShapeGeometries=function(M){var U=M.renderData.polygons;const R=M.uvCoords;for(const {count:L,index:N,position:T,mapPosition:S,holeIndices:H}of U){if(d.isSome(this._context.clippingExtent)&&(k.empty(G),k.expandWithBuffer(G,S),!k.intersectsClippingArea(G,
this._context.clippingExtent)))continue;U=x.earcut(S,H,3);if(0===U.length)continue;U=new Uint32Array(U);const Q=new Float64Array(R.buffer,2*N*R.BYTES_PER_ELEMENT,2*L);U=q.createWaterGeometry({indices:U,attributeData:{position:T,uv0:Q,mapPosition:S}});M.outGeometries.push(U);M.outMaterials.push(d.unwrap(this._material));M.outTransforms.push(w.IDENTITY);M.outNum++}};K._createAsOverlay=function(M){const U=q.geometryAsPolygon(M.geometry);if(d.isNone(U))return null;d.unwrap(this._material).renderPriority=
this._renderPriority;I.renderData=q.geometryToRenderInfoDraped(U,this._context.overlaySR);const R=I.renderData.position.length/3;I.uvCoords=new Float64Array(2*R);I.outNum=0;I.outGeometries=[];I.outBoundingBox=k.empty();I.layerUid=this._context.layer.uid;I.graphicsUid=M.uid;this._createAsOverlayWater(I);this._logGeometryCreationWarnings(I.renderData,U.rings,"rings","WaterSymbol3DLayer");if(0===I.outNum)return null;this._createUVCoordsFromVertices(I.uvCoords,I.renderData.position,R,this._context.overlaySR);
return 0<I.outNum?new m(this,I.outGeometries,I.outBoundingBox):null};K._createAsOverlayWater=function(M){const U=M.uvCoords;var R=M.renderData.polygons;for(const {position:N,holeIndices:T,index:S,count:H}of R)if(k.empty(G),k.expandWithBuffer(G,N),k.intersectsClippingArea(G,this._context.clippingExtent)&&(k.expandWithAABB(M.outBoundingBox,G),R=x.earcut(N,T,3),0!==R.length)){R=new Uint32Array(R);var L=new Float64Array(U.buffer,2*S*U.BYTES_PER_ELEMENT,2*H);R=q.createWaterGeometry({indices:R,attributeData:{position:N,
uv0:L}});R=new v.RenderGeometry(R,d.unwrap(this._material),{layerUid:M.layerUid,graphicUid:M.graphicsUid});L=G;f.set(R.boundingSphere,.5*(L[0]+L[3]),.5*(L[1]+L[4]),0,.5*Math.sqrt((L[3]-L[0])*(L[3]-L[0])+(L[4]-L[1])*(L[4]-L[1])));M.outGeometries.push(R);M.outNum++}};P.headingVectorFromAngle=function(M){const U=n.create();M=e.toRadian(M);U[0]=Math.sin(M);U[1]=Math.cos(M);return U};b._createClass(P,[{key:"test",get:function(){return{create3DShape:M=>this._createAs3DShape(M.graphic,M.elevationContext,
M.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}}]);return P}(t.Graphics3DSymbolLayer);t.unitSizeOfTexture=100;t.elevationModeChangeTypes={definedChanged:p.SymbolUpdateType.RECREATE,staysOnTheGround:p.SymbolUpdateType.NONE,onTheGroundChanged:p.SymbolUpdateType.RECREATE};const C=n.create(),D=r.create(),F=n.create(),G=k.create(),J={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},I={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,
outGeometries:null,outMaterials:null,outTransforms:null};a.Graphics3DWaterSymbolLayer=t;a.default=t;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DWebStyleSymbol":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","./interfaces","./Loadable","./symbolComplexity"],function(a,b,c,d,g){return function(x){function w(n,f,e){f=x.call(this,f)||this;f.symbol=n;f.convert=e;f.graphics3DSymbol=null;f.referenced=0;return f}
a._inheritsLoose(w,x);var l=w.prototype;l.getSymbolLayerSize=function(n){return b.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.getSymbolLayerSize(n):null};l.doLoad=function(){var n=a._asyncToGenerator(function*(f){f=yield this.symbol.fetchSymbol({signal:f});f.id=this.symbol.id;this.graphics3DSymbol=this.convert(f);b.isSome(this.graphics3DSymbol)&&(yield this.graphics3DSymbol.load())});return function(f){return n.apply(this,arguments)}}();l.createGraphics3DGraphic=function(n){return b.isSome(this.graphics3DSymbol)?
this.graphics3DSymbol.createGraphics3DGraphic(n,this):null};l.globalPropertyChanged=function(n,f){return b.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.globalPropertyChanged(n,f):!1};l.applyRendererDiff=function(n,f){return b.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.applyRendererDiff(n,f):c.ApplyRendererDiffResult.Recreate_Symbol};l.prepareSymbolPatch=function(n){b.isSome(this.graphics3DSymbol)&&this.graphics3DSymbol.prepareSymbolPatch(n)};l.updateGeometry=function(n,f){return b.isSome(this.graphics3DSymbol)?
this.graphics3DSymbol.updateGeometry(n,f):!1};l.onRemoveGraphic=function(){};l.getFastUpdateStatus=function(){return b.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}};l.destroy=function(){b.isSome(this.graphics3DSymbol)&&this.graphics3DSymbol.destroy();this.graphics3DSymbol=void 0;x.prototype.destroy.call(this)};a._createClass(w,[{key:"symbolLayers",get:function(){return b.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.symbolLayers:[]}},{key:"extentPadding",
get:function(){return b.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.extentPadding:0}},{key:"complexity",get:function(){return b.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.complexity:g.emptySymbolComplexity}},{key:"destroyed",get:function(){return void 0===this.graphics3DSymbol}}]);return w}(d.Loadable)})},"esri/views/3d/layers/graphics/labelPlacement":function(){define("exports ../../../../core/has ../../../../core/Logger ../../../../core/maybe ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/support/aaBoundingBox ./graphicSymbolUtils ../../webgl-engine/materials/HUDMaterial".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e){function k(E){E=f.getGraphics3DSymbol(E.graphics3DGraphic.graphics3DSymbol);return d.isSome(E)?E.symbol.symbolLayers.getItemAt(0):null}function r(E,C){var D=C.graphics3DGraphic.graphic.geometry;if(d.isNone(D))return null;if(d.isSome(C.disablePlacement))return C.labelClass.labelPlacement?(q.warnOncePerTick(y(E.placement,C.disablePlacement.logEntityDescription)),p(C)):E;D=D.type;switch(D){case "polyline":case "polygon":case "extent":case "multipoint":if(C.labelClass.labelPlacement)return q.warnOncePerTick(y(E.placement,
`'${D}' geometries`)),p(C)}return E}function y(E,C){return`the requested label placement '${E}' is currently unsupported for ${C} in SceneView`}function p(E){const C=E.graphics3DGraphic.graphic.geometry;if(d.isNone(C))return null;switch(C.type){case "polyline":case "extent":case "multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case "polygon":return E=k(E),d.isSome(E)&&"extrude"===E.type?z["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"};
case "point":return z["above-center"];case "mesh":return z["above-center"]}}function h(E,C=B){({graphics3DGraphic:E}=E);E=E.graphics[0];(E=d.isSome(E)?E.stageObject.geometryRecords[0].material:null)&&E instanceof e.HUDMaterial?(E=E.parameters.anchorPos,C[0]=2*(E[0]-.5),C[1]=2*(E[1]-.5)):(C[0]=0,C[1]=0);return C}function m(E,C,D){D=d.isSome(D)?D.getBoundingBoxObjectSpace(A):A;D=w.fromValues(D[3]-D[0],D[4]-D[1],D[5]-D[2]);E.centerOffset[0]=Math.sqrt(D[0]*D[0]+D[1]*D[1])/2*C.normalizedOffset[0];const F=
E.translation[2],G=D[2]/2*C.normalizedOffset[1];E.translation[2]=0;E.elevationOffset=F+G;D=x.length(D);E.centerOffset[2]=D/2*C.normalizedOffset[2]}function u(E){const C=E.labelClass.labelPlacement,{labelSymbol:D,graphics3DGraphic:F}=E;var G=f.getGraphics3DSymbol(F.graphics3DSymbol);G=d.applySome(G,J=>"point-3d"===J.symbol.type?J.symbol:null);E=z[C]||p(E);if(d.isSome(G)&&G.supportsCallout()&&G.hasVisibleVerticalOffset()&&!F.isDraped)return{placement:null,hasLabelVerticalOffset:!1,verticalOffset:t(G.verticalOffset),
anchor:null,normalizedOffset:null};if(D&&D.hasVisibleVerticalOffset()&&(d.isNone(G)||!G.supportsCallout()||!G.verticalOffset||F.isDraped)){a:switch(E.placement){case "above-center":G=!0;break a;default:G=!1}return G?{placement:"above-center",verticalOffset:t(D.verticalOffset),anchor:"bottom",normalizedOffset:[0,E.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(q.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+
C+" placement)"),null)}return{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}function t(E){const {screenLength:C,minWorldLength:D,maxWorldLength:F}=E;return{screenLength:C,minWorldLength:D,maxWorldLength:F}}const q=c.getLogger("esri.views.3d.layers.graphics.labelPlacement"),z={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",
normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",
normalizedOffset:[1,0,0],anchor:"left"}};b={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],
"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const E in b){const C=z[E];b[E].forEach(D=>{z[D]=C})}Object.freeze&&(Object.freeze(z),Object.keys(z).forEach(function(E){Object.freeze(z[E]);Object.freeze(z[E].normalizedOffset)}));const v=[0,0],B=[0,0],A=n.create();a.get=function(E){var C=u(E);if(d.isNone(C))return null;if(C.anchor)var D=C;else{D=E.labelClass.labelPlacement;var F=z[D],G=F||p(E);D&&!F&&q.warnOncePerTick(`the requested label placement '${D}' is not currently supported in SceneView`);
D=r(G,E)}if(d.isNone(D))return null;F=!!C.hasLabelVerticalOffset;C={anchor:D.anchor,verticalOffset:C.verticalOffset,screenOffset:g.create(),centerOffset:l.fromValues(0,0,0,-1),centerOffsetUnits:"world",translation:w.create(),elevationOffset:0,hasLabelVerticalOffset:F};F=E.graphics3DGraphic.graphic.geometry;if(d.isNone(F))E=null;else{switch(F.type){case "point":G=k(E);if(!d.isNone(G))switch(F=E.graphics3DGraphic.graphics[0],d.isSome(F)?F.getCenterObjectSpace(C.translation):x.set(C.translation,0,0,
0),G.type){case "icon":case "text":({graphics3DGraphic:G}=E);F=d.isSome(F)?F.getScreenSize():null;!G.isDraped&&d.isSome(F)?(E=h(E),v[0]=F[0]/2*(D.normalizedOffset[0]-E[0]),v[1]=F[1]/2*(D.normalizedOffset[1]-E[1]),C.screenOffset[0]=v[0],C.hasLabelVerticalOffset?(C.centerOffset[1]=v[1],C.centerOffsetUnits="screen"):C.screenOffset[1]=v[1]):C.hasLabelVerticalOffset||"center"===C.anchor||(z[E.labelClass.labelPlacement]&&q.warnOncePerTick(`the requested placement '${D.placement}' is currently unsupported for draped graphics`),
C.anchor="center");break;case "object":m(C,D,F)}break;case "polygon":F=k(E);if(!d.isNone(F))switch(F.type){case "extrude":E=E.graphics3DGraphic.graphics[0],d.isSome(E)?(E.getBoundingBoxObjectSpace(A),n.center(A,C.translation),C.translation[2]=n.height(A)/2):x.set(C.translation,0,0,0),m(C,D,E)}break;case "mesh":m(C,D,E.graphics3DGraphic.graphics[0])}E=C}return E};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/MaterialCollection":function(){define(["exports"],function(a){let b=
function(){function c(g){this._stage=g;this._materials=new Map}var d=c.prototype;d.get=function(g){return this._materials.get(g)};d.add=function(g,x){this._materials.set(g,x);this._stage.add(x)};d.dispose=function(){this._stage.removeMany(Array.from(this._materials.values()));this._materials.clear()};return c}();a.MaterialCollection=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextTextureAtlas":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/MapUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/uid ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ./ContentObjectType ./VertexAttribute ../../../support/Scheduler ../../../webgl/enums ../../../webgl/Texture".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t){var q;a.TextTextureAtlas=q=function(v){function B(E){E=v.call(this,E)||this;E.type=p.ContentObjectType.Texture;E.id=n.generateUID();E.events=new g;E._glTexture=null;E.needsClear=!1;E.elementsToAddOrUpdate=new Map;E.elementsToRemove=new Map;E.elementsToRender=new Map;E.elements=new Map;E.stageObjects=new Map;E.updating=!1;return E}b._inheritsLoose(B,v);var A=B.prototype;A.initialize=function(){this.stage=this.view._stage;this.canvas=this._create2DCanvas();
this.ctx=this.canvas.getContext("2d");this.stage.add(this);const E=this._computeAtlasResolution(this.view.width,this.view.height);this._createAtlasRegion(E);this._update2DCanvasSize();this._resetAtlasCursor()};A.unload=function(){this._glTexture=l.disposeMaybe(this._glTexture);this.updating=!1;this.events.emit("unloaded")};A._createDescriptor=function(E){return{target:u.TextureType.TEXTURE_2D,pixelFormat:u.PixelFormat.RGBA,dataType:u.PixelType.UNSIGNED_BYTE,wrapMode:u.TextureWrapMode.CLAMP_TO_EDGE,
flipped:!0,samplingMode:u.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:E.parameters.maxMaxAnisotropy}};A.load=function(E){if(l.isSome(this._glTexture))return this._glTexture;this._glTexture=new t.Texture(E,this._createDescriptor(E),this.canvas);this.frameWorker=this.view.resourceController.scheduler.registerTask(m.TaskPriority.TEXT_TEXTURE_ATLAS,this);this.setDirty();return this._glTexture};A.dispose=function(){this.elementsToRender=this.elementsToRemove=
this.elementsToAddOrUpdate=this.elements=null;this.frameWorker=l.removeMaybe(this.frameWorker);this._glTexture&&(this.stage.remove(this),this._glTexture=l.disposeMaybe(this._glTexture));this.canvas.width=0;this.canvas.height=0;this.ctx=this.canvas=null};A._create2DCanvas=function(){const E=document.createElement("canvas");E.setAttribute("id","canvas2d");E.setAttribute("style","display:none");E.setAttribute("width",(512).toString());E.setAttribute("height",(512).toString());return E};A._update2DCanvasSize=
function(){this.canvas.setAttribute("width",this.atlas.size.width.toString());this.canvas.setAttribute("height",this.atlas.size.height.toString())};A._createAtlasRegion=function(E=512){this.atlas={size:{width:E,height:E},cursor:{x:0,y:0},lineHeight:0}};A._computeAtlasResolution=function(E,C){E=Math.max(E,C);E=w.nextHighestPowerOfTwo(E+256);return E=Math.min(E,4096)};A._resizeAtlas=function(E,C){C=C||E;const D=this.atlas;D.size.width=E;D.size.height=C;l.isSome(this._glTexture)&&this._glTexture.resize(E,
C);this._update2DCanvasSize()};A._resetAtlasCursor=function(){const E=this.atlas;E.cursor.x=2;E.cursor.y=4;E.lineHeight=0;this.needsClear=!0};A._getAtlasUsage=function(){const E=this.atlas;return(E.cursor.x+E.cursor.y*E.size.width)/(E.size.width*E.size.height)};A._getExpectedAtlasUsage=function(){const E=this.elementsToRemove.size,C=this.elementsToAddOrUpdate.size,D=this.elements.size;return this._getAtlasUsage()/D*(D+C-E)};A._addAtlasElement=function(E,C,D,F){const G=this.atlas,{renderedWidth:J,
renderedHeight:I,displayWidth:O,displayHeight:P}=E.textRenderer;E.placement.offset.x=G.cursor.x;E.placement.offset.y=G.cursor.y;E.placement.size.width=J;E.placement.size.height=I;E.placement.size.displayWidth=O;E.placement.size.displayHeight=P;E.placement.uvMinMax=[E.placement.offset.x/G.size.width,1-(E.placement.offset.y+I)/G.size.height,(E.placement.offset.x+J)/G.size.width,1-E.placement.offset.y/G.size.height];G.cursor.x+=D;G.lineHeight=Math.max(G.lineHeight,F);this.elements.set(C,E)};A._removeAtlasElement=
function(E){if(E&&this.elements.has(E.textId)){const C=E.placement.offset,D=E.placement.size;this.ctx.clearRect(C.x,C.y,D.width,D.height);this.elements.delete(E.textId)}};A._ensureStageObjects=function(E){var C=this.stageObjects.get(E);if(C)return C;C=new Set;this.stageObjects.set(E,C);return C};A._addStageObject=function(E,C){this._ensureStageObjects(E).add(C)};A._removeStageObject=function(E,C){(E=this.stageObjects.get(E))&&E.delete(C)&&(C.geometries[0].vertexAttributes.get(h.VertexAttribute.SIZE).data=
[0,0],C.geometryVertexAttrsUpdated(C.geometryRecords[0]))};A._processAddition=function(E,C){const D=this.atlas;var F=E.textId;const G=E.textRenderer.renderedWidth+2,J=E.textRenderer.renderedHeight+2+2;if(D.cursor.x+G<D.size.width&&D.cursor.y+J<D.size.height)this._addAtlasElement(E,F,G,J),this.elementsToRender.set(F,E),this.elementsToAddOrUpdate.delete(F);else if(D.cursor.y+J+D.lineHeight<D.size.height)D.cursor.x=2,D.cursor.y+=D.lineHeight,D.lineHeight=0,this._addAtlasElement(E,F,G,J),this.elementsToRender.set(F,
E),this.elementsToAddOrUpdate.delete(F);else{E=this._getExpectedAtlasUsage();(F=.85<E&&4096>D.size.width)&&this._resizeAtlas(2*D.size.width,2*D.size.height);if(!C||!F&&.95<E&&4096===D.size.width)return this._processRemovals(),z.OK;this._repack();return z.REPACK}return z.OK};A._processRemovals=function(){this.elementsToRemove.forEach((E,C)=>{const D=this.stageObjects.get(C);D&&0!==D.size||this._removeAtlasElement(E);D&&0===D.size&&this.stageObjects.delete(C)});this.elementsToRemove.clear()};A._repack=
function(){this._processRemovals();this.elements.forEach((E,C)=>{E.rendered=!1;this.elementsToAddOrUpdate.set(C,E)});this.elements.clear();this._resetAtlasCursor();this.elementsToRender.clear()};A._processRenderingRequest=function(E){this.ctx.clearRect(E.placement.offset.x,E.placement.offset.y,E.placement.size.width,E.placement.size.height);E.textRenderer.render(this.ctx,E.placement.offset.x,E.placement.offset.y);const C=this.stageObjects.get(E.textId);C&&C.forEach(D=>{D.geometries[0].vertexAttributes.get(h.VertexAttribute.UV0).data=
new Float32Array(E.placement.uvMinMax);D.geometries[0].vertexAttributes.get(h.VertexAttribute.SIZE).data=[E.placement.size.displayWidth,E.placement.size.displayHeight];D.geometryVertexAttrsUpdated(D.geometryRecords[0])});E.rendered=!0};A.runTask=function(E,C=!0){if(this._glTexture){var D=!1;x.someMap(this.elementsToAddOrUpdate,(G,J)=>(G=this.elements.get(J))&&G.rendered?((G=this.stageObjects.get(J))&&G.forEach(I=>{const O=I.geometries[0].vertexAttributes,P=this.elements.get(J);O.get(h.VertexAttribute.UV0).data=
new Float32Array(P.placement.uvMinMax);O.get(h.VertexAttribute.SIZE).data=new Float32Array([P.placement.size.displayWidth,P.placement.size.displayHeight]);I.geometryVertexAttrsUpdated(I.geometryRecords[0])}),this.elementsToAddOrUpdate.delete(J),!1):this._processAddition(this.elementsToAddOrUpdate.get(J),C)===z.REPACK?D=!0:!1);if(D)this.runTask(m.noBudget,!1);else{var F=!1;0<this.elementsToRender.size&&this.needsClear&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.needsClear=!1);
x.someMap(this.elementsToRender,(G,J)=>{this._processRenderingRequest(G);this.elementsToRender.delete(J);F=!0;E.madeProgress();return E.done});F&&l.isSome(this._glTexture)&&this._glTexture.setData(this.canvas);this.updating=0<this.elementsToRender.size;!this.updating&&q.test.orderedRepackingEnabled&&this.repackOrdered()}}};A.addTextTexture=function(E,C){const D=E.key;this.elementsToAddOrUpdate.has(D)||this.elementsToAddOrUpdate.set(D,{textId:D,placement:{offset:{x:0,y:0},size:{width:0,height:0,displayWidth:0,
displayHeight:0},uvMinMax:[]},textRenderer:E,rendered:!1});this._addStageObject(D,C);this.elementsToRemove.delete(D);this.setDirty()};A.removeTextTexture=function(E,C){E=E.key;this.elementsToRemove.set(E,this.elements.get(E));this._removeStageObject(E,C)};A.setDirty=function(){this._glTexture&&(this.updating=!0)};A.repackOrdered=function(){if(0!==this.elements.size){var E=[];this.elements.forEach((D,F)=>E.push({element:D,key:F}));var C=!0;for(let D=0;D<E.length-1;D++)if(0<E[D].key.localeCompare(E[D+
1].key)){C=!1;break}if(!C||this.elementsToRemove.size){E.sort((D,F)=>D.key.localeCompare(F.key));this.elements.clear();for(const {element:D,key:F}of E)this.elements.set(F,D);this._repack();this.setDirty()}}};b._createClass(B,[{key:"width",get:function(){return this.atlas.size.width}},{key:"height",get:function(){return this.atlas.size.height}},{key:"requiresFrameUpdates",get:function(){return!1}},{key:"glTexture",get:function(){return this._glTexture}},{key:"running",get:function(){return this.updating}},
{key:"test",get:function(){const {elements:E,stageObjects:C,elementsToRemove:D,atlas:F}=this,G=this;return{elements:E,stageObjects:C,elementsToRemove:D,atlas:F,_resizeAtlas:(J,I)=>G._resizeAtlas(J,I),run:(J,I)=>G.runTask(J,I)}}}]);return B}(d);a.TextTextureAtlas.test={orderedRepackingEnabled:!1};c.__decorate([f.property({constructOnly:!0})],a.TextTextureAtlas.prototype,"view",void 0);c.__decorate([f.property({type:Boolean})],a.TextTextureAtlas.prototype,"updating",void 0);a.TextTextureAtlas=q=c.__decorate([y.subclass("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],
a.TextTextureAtlas);var z;(function(v){v[v.OK=0]="OK";v[v.REPACK=1]="REPACK"})(z||(z={}));a.default=a.TextTextureAtlas;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/ObjectResourceCache":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Handles ../../../../core/handleUtils ../../../../core/maybe ../../../../core/promiseUtils ../../glTF/DefaultLoadingContext ../../glTF/loader ./wosrLoader".split(" "),function(a,b,c,d,g,x,w,
l,n){let f=function(){function k(){this.gltfCache=new Map;this.wosrCache=new Map;this.evictHandles=new c}var r=k.prototype;r.loadGLTF=function(y,p,h){return this._fromCache(this.gltfCache,h?`gltfPBR:${y}`:`gltf:${y}`,m=>l.load(new w.DefaultLoadingContext(m.streamDataRequester),y,m,h),p)};r.loadWOSR=function(y,p){return this._fromCache(this.wosrCache,`wosr:${y}:${p.disableTextures}`,h=>n.load(y,h),p)};r.destroy=function(){this.evictHandles.destroy();this.gltfCache.clear();this.wosrCache.clear()};r._fromCache=
function(y,p,h,m){return new Promise((u,t)=>{if(x.isAborted(m))t(x.createAbortError());else{var q=x.onAbort(m,()=>{this._remove(y,p);t(x.createAbortError())}),z=y.get(p);if(z)this.evictHandles.remove(p),z.refCount++,z.item.then(u,t);else{z=new AbortController;var v={refCount:1,abortController:z,item:h({...m,signal:z.signal}).then(B=>{v.abortController=null;B.remove=()=>this._remove(y,p);return B})};y.set(p,v);v.item.then(B=>{g.isSome(q)&&q.remove();u(B)},B=>{g.isSome(q)&&q.remove();t(B)})}}})};r._remove=
function(y,p){const h=y.get(p);h&&(h.refCount--,0===h.refCount&&this.evictHandles.add(d.timeoutHandle(()=>{y.delete(p);g.isSome(h.abortController)&&h.abortController.abort()},e),p))};b._createClass(k,[{key:"size",get:function(){return this.wosrCache.size+this.gltfCache.size}}]);return k}(),e=1E4;a.ObjectResourceCache=f;a.test={overrideEvictDelay(k){e=k;return{remove(){e=1E4}}}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/FeatureTileTree3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Collection ../../../../core/Handles ../../../../core/Logger ../../../../core/maybe ../../../../core/PooledArray ../../../../core/watchUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/support/aaBoundingRect ./FeatureTileDescriptor3D ./FeatureTileMeasurements3D ../../support/extentUtils ../../../support/Scheduler".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q){const z=w.getLogger("esri.views.3d.layers.support.FeatureTileTree3D");a.FeatureTileTree3D=function(A){function E(D){D=A.call(this,D)||this;D.tiles=new g;D.tileSize=512;D._idToTile=new Map;D._handles=new x;D._clients=new Set;D._dirty=!1;D._newTiles=new n;return D}b._inheritsLoose(E,A);var C=E.prototype;C.initialize=function(){this._handles.add(this.watch(["tilingScheme","tileSize"],()=>this._reset(),!0));this._handles.add(f.init(this,["tileSize","cameraOnSurface.location",
"tilingScheme","viewState.contentCamera","focus.location"],()=>this._setDirty(),!0));this.scheduler&&(this._frameWorker=this.scheduler.registerTask(q.TaskPriority.FEATURE_TILE_TREE,this))};C.destroy=function(){this._frameWorker=l.removeMaybe(this._frameWorker);this._handles=l.destroyMaybe(this._handles)};C.addClient=function(){const D=v++;this._clients.add(D);1===this._clients.size&&this._setDirty();return{remove:()=>this._removeClient(D)}};C._removeClient=function(D){this._clients.delete(D);this._hasClients||
this._clear()};C._setDirty=function(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(q.noBudget))};C._clear=function(){this.tiles.removeAll();this._idToTile.clear();this._reset();this._dirty=!1;this.notifyChange("updating")};C.runTask=function(D){this._dirty=!1;this._pendingTiles||(this._startUpdate(),l.isSome(this._frameWorker)&&(this._frameWorker.priority=q.TaskPriority.FEATURE_TILE_TREE_ACTIVE));this._subdivideTilesForView(D);
!this._pendingTiles&&l.isSome(this._frameWorker)&&(this._frameWorker.priority=q.TaskPriority.FEATURE_TILE_TREE);this.notifyChange("updating")};C._startUpdate=function(){this.suspended||(this.tilingScheme?(this._tileMeasurements||(this._tileMeasurements=new u.FeatureTileMeasurements3D({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize})),this._tileMeasurements.begin(this.viewState.contentCamera,this.focus.location,this.cameraOnSurface.location.z),this._pendingTiles=
this._getRootTiles()):this._clear())};C._reset=function(){this._newTiles.clear();this._pendingTiles=this._tileMeasurements=null;this._setDirty()};C._getRootTiles=function(){return this.rootTileIds.map(D=>new m.FeatureTileDescriptor3D(D[0],D[1],D[2],this.tilingScheme))};C._purgeHorizonTiles=function(D){D.sort((F,G)=>{F=F.measures.screenRect;G=G.measures.screenRect;return F[1]+F[3]-(G[1]+G[3])});h.empty(B);for(let F=0;F<D.length;F++)if(h.expand(B,D.data[F].measures.screenRect,B),10<h.height(B))return D.data.slice(F,
D.length);return[]};C._subdivideTilesForView=function(D){if(this._pendingTiles){for(;0<this._pendingTiles.length&&!D.done;){const F=this._pendingTiles.pop();D.madeProgress();if(!this.filterExtentRect||h.intersects(this.filterExtentRect,F.extent))this._tileMeasurements.updateTile(F),F.measures.visibility!==m.Visibility.INVISIBLE&&(F.measures.shouldSplit?(this.tilingScheme.ensureMaxLod(F.lij[0]+1),this._pendingTiles.push(...F.getChildren())):this._newTiles.push(F))}0===this._pendingTiles.length&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),
this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}};C._updateTiles=function(D){for(var F of this.tiles.items)F.used=!1;D=D.filter(G=>{const J=this._idToTile.get(G.id);J?(J.copyMeasurementsFrom(G),J.used=!0):this._idToTile.set(G.id,G);return!J});F=this.tiles.items.filter(G=>G.used?!1:(this._idToTile.delete(G.id),!0));this.tiles.removeMany(F);this.tiles.addMany(D);this._sortTiles()};C._sortTiles=function(){this.viewState.fixedContentCamera||this.tiles.sort((D,F)=>D.measures.visibility!==
F.measures.visibility?D.measures.visibility===m.Visibility.VISIBLE_ON_SURFACE?-1:1:D.measures.distance-F.measures.distance);this.tiles.forEach((D,F)=>D.loadPriority=F)};b._createClass(E,[{key:"tilingScheme",get:function(){const D=this.tilingSchemeOwner.tilingScheme;return D?D.clone():null}},{key:"filterExtent",set:function(D){if(l.isSome(D)&&!D.spatialReference.equals(this.viewState.spatialReference))z.error("#extent","extent spatial reference needs to be in the same spatial reference as the view");
else{var F=this._get("filterExtent");F===D||l.isSome(F)&&D&&F.equals(D)||(D=l.isSome(D)?D.clone():null,this._set("filterExtent",D),this._setDirty())}}},{key:"filterExtentRect",get:function(){if(l.isNone(this.filterExtent)||!this.tilingScheme)return null;const D=h.create();t.toBoundingRect(this.filterExtent,D,this.tilingScheme.spatialReference);return D}},{key:"rootTileIds",get:function(){return this.filterExtentRect?this.tilingScheme.rootTilesInExtent(this.filterExtentRect):[[0,0,0]]}},{key:"suspended",
set:function(D){D!==this._get("suspended")&&(this._set("suspended",D),this._setDirty())}},{key:"updating",get:function(){return this._dirty||!!this._pendingTiles}},{key:"_hasClients",get:function(){return 0<this._clients.size}},{key:"running",get:function(){return this.updating}}]);return E}(d);c.__decorate([e.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"scheduler",void 0);c.__decorate([e.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"renderCoordsHelper",void 0);c.__decorate([e.property({constructOnly:!0})],
a.FeatureTileTree3D.prototype,"tilingSchemeOwner",void 0);c.__decorate([e.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"cameraOnSurface",void 0);c.__decorate([e.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"focus",void 0);c.__decorate([e.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"viewState",void 0);c.__decorate([e.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"terrain",void 0);c.__decorate([e.property()],a.FeatureTileTree3D.prototype,"tiles",
void 0);c.__decorate([e.property()],a.FeatureTileTree3D.prototype,"tileSize",void 0);c.__decorate([e.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"tilingScheme",null);c.__decorate([e.property()],a.FeatureTileTree3D.prototype,"filterExtent",null);c.__decorate([e.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"filterExtentRect",null);c.__decorate([e.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"rootTileIds",null);c.__decorate([e.property({value:!1})],a.FeatureTileTree3D.prototype,
"suspended",null);c.__decorate([e.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"updating",null);a.FeatureTileTree3D=c.__decorate([p.subclass("esri.views.3d.layers.support.FeatureTileTree3D")],a.FeatureTileTree3D);let v=0;const B=h.create();a.default=a.FeatureTileTree3D;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/FeatureTileDescriptor3D":function(){define(["exports","../../../../geometry/support/aaBoundingRect"],function(a,b){let c=function(){function d(x,
w,l,n=null){this.lij=[0,0,0];this.extent=b.create();this.loadPriority=this.resolution=0;this.measures={visibility:a.Visibility.VISIBLE_ON_SURFACE,screenRect:b.create(),distance:0,shouldSplit:!1};this.used=!1;n&&this.acquire(x,w,l,n)}var g=d.prototype;g.acquire=function(x,w,l,n){this.tilingScheme=n;this.id=d.id(x,w,l);this.lij[0]=x;this.lij[1]=w;this.lij[2]=l;n.getExtent(x,w,l,this.extent);this.resolution=n.resolutionAtLevel(x)};g.release=function(){this.tilingScheme=null};g.getChildren=function(x){const w=
this.lij[0]+1,l=2*this.lij[1],n=2*this.lij[2];if(!x)return[new d(w,l,n,this.tilingScheme),new d(w,l+1,n,this.tilingScheme),new d(w,l,n+1,this.tilingScheme),new d(w,l+1,n+1,this.tilingScheme)];x[0].acquire(w,l,n,this.tilingScheme);x[1].acquire(w,l+1,n,this.tilingScheme);x[2].acquire(w,l,n+1,this.tilingScheme);x[3].acquire(w,l+1,n+1,this.tilingScheme);return x};g.copyMeasurementsFrom=function(x){this.measures.visibility=x.measures.visibility;this.measures.shouldSplit=x.measures.shouldSplit;this.measures.distance=
x.measures.distance;b.copy(x.measures.screenRect,this.measures.screenRect)};d.id=function(x,w,l){return`${x}/${w}/${l}`};return d}();a.Visibility=void 0;(function(d){d[d.INVISIBLE=0]="INVISIBLE";d[d.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED";d[d.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(a.Visibility||(a.Visibility={}));a.FeatureTileDescriptor3D=c;a.default=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/FeatureTileMeasurements3D":function(){define("exports ../../../../core/screenUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/frustum ../../../../geometry/support/plane ../../../../geometry/support/triangle ./FeatureTileDescriptor3D ./FeatureTileVisibility3D ../../webgl-engine/lib/Camera".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e){let k=function(){function q(v){this.camera=new e.default;this.focusOnMap=[0,0];this.screenRect=g.create();this.tileSize=v.tileSize;this.renderCoordsHelper=v.renderCoordsHelper;this.tilingScheme=v.tilingScheme;this.visibility=new f.FeatureTileVisibility3D(v.renderCoordsHelper)}var z=q.prototype;z.begin=function(v,B,A){this.camera.copyFrom(v);this.surfaceElevation=A;this.focusOnMap[0]=B.x;this.focusOnMap[1]=B.y;g.fromValues(0,0,v.fullWidth,v.fullHeight,this.screenRect);
this.visibility.begin(this.camera,A)};z.end=function(){this.visibility.end()};z.updateTile=function(v){v.measures.visibility=this.visibility.calculate(v);v.measures.distance=g.distance(v.extent,this.focusOnMap);v.measures.visibility!==n.Visibility.INVISIBLE&&this._updateScreenMeasure(v)};z._updateScreenMeasure=function(v){const B=v.measures.screenRect;g.empty(B);let A=0;const E=v.lij[0]+2,C=v.lij[1]<<2,D=v.lij[2]<<2;var F=this._tileSizeWithBias(v);F*=F;for(let G=0;4>G;G++)for(let J=0;4>J;J++)if(A+=
this._computeScreenArea(v,E,C+G,D+J,B),A>F){v.measures.shouldSplit=!0;return}v.measures.shouldSplit=!1};z._tileSizeWithBias=function(v){return v.measures.visibility===n.Visibility.VISIBLE_WHEN_EXTENDED?5*this.tileSize:this.tileSize};z._computeScreenArea=function(v,B,A,E,C){this._projectToScreen(B,A,E,v.measures.visibility===n.Visibility.VISIBLE_WHEN_EXTENDED,y);g.empty(r);for(v=0;4>v;v++)g.expandPointInPlace(r,y[v]);g.expand(C,r,C);return l.areaPoints2d(y[0],y[1],y[2])+l.areaPoints2d(y[0],y[2],y[3])};
z._projectToScreen=function(v,B,A,E,C){this.tilingScheme.ensureMaxLod(v);this.tilingScheme.getExtent(v,B,A,p);this._toRenderCoords(p,0,3,m[0]);this._toRenderCoords(p,2,3,m[1]);this._toRenderCoords(p,2,1,m[2]);this._toRenderCoords(p,0,1,m[3]);E&&(this._projectToPlane(m,this.camera.frustum[x.PlaneIndex.NEAR]),this._projectToPlane(m,this.camera.frustum[x.PlaneIndex.TOP]),this._projectToPlane(m,this.camera.frustum[x.PlaneIndex.BOTTOM]));for(v=0;4>v;v++)this.camera.projectToRenderScreen(m[v],t),this.camera.renderToScreen(t,
C[v])};z._projectToPlane=function(v,B){for(var A=0;4>A;A++)u[A]=w.signedDistance(B,v[A]);A=Math.max(u[0],u[1],u[2],u[3]);if(0<A)for(B=c.scale(h,w.normal(B),-A),A=0;4>A;A++)c.add(v[A],v[A],B)};z._toRenderCoords=function(v,B,A,E){h[0]=v[B];h[1]=v[A];h[2]=this.surfaceElevation;this.renderCoordsHelper.toRenderCoords(h,this.tilingScheme.spatialReference,E);return E};return q}();const r=g.create(),y=[b.createScreenPointArray(),b.createScreenPointArray(),b.createScreenPointArray(),b.createScreenPointArray()],
p=g.create(),h=d.create(),m=[d.create(),d.create(),d.create(),d.create()],u=[0,0,0,0],t=b.createRenderScreenPointArray3();a.FeatureTileMeasurements3D=k;a.default=k;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/FeatureTileVisibility3D":function(){define("exports ../../../../core/mathUtils ../../../../core/ObjectPool ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projectionEllipsoid ../../../../geometry/support/frustum ../../../../geometry/support/plane ../../../../geometry/support/ray ../../../ViewingMode ./FeatureTileDescriptor3D ../../state/Frustum ../../support/FrustumExtentIntersection".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r){let y=function(){function t(z){this.renderCoordsHelper=z;this.surfaceElevation=0;this.cache=new Map;this.frustum=new k.Frustum(z);this.extendedFrustum=new k.Frustum(z);this.intersector=new r.FrustumExtentIntersection({renderCoordsHelper:z});this.renderCoordsHelper=z}var q=t.prototype;q.begin=function(z,v){this.surfaceElevation=v;this.aboveGround=this.renderCoordsHelper.getAltitude(z.eye)>v;this.frustum.update(z);this._shortenFrustumFarPlane(this.frustum);this._updateExtendedFrustum(z)};
q.end=function(){this.cache.clear()};q.calculate=function(z){if(this.allTilesInvisible)return e.Visibility.INVISIBLE;const v=this.renderCoordsHelper.viewingMode===f.ViewingMode.Global&&2<=z.lij[0]&&6>z.lij[0],B=this._getOrCalculateSingleTileVisibility(z,!v);return B!==e.Visibility.INVISIBLE&&v?this._calculateAggregatedChildrenVisibility(z):B};q._shortenFrustumFarPlane=function(z){var v=k.Frustum.nearFarLineIndices;const B=z.mutablePoints;for(const A of v){const [E,C]=A;v=B[E];d.subtract(p,B[C],v);
d.scale(p,p,.95);d.add(B[C],v,p)}z.updatePoints(B)};q._calculateAggregatedChildrenVisibility=function(z){let v=e.Visibility.INVISIBLE;var B=this.cache.get(z.id);if(null!=B)return B;B=u.acquire();z.getChildren(B);for(const A of B){const E=this.calculate(A);if(E!==e.Visibility.INVISIBLE&&(v=E,E===e.Visibility.VISIBLE_ON_SURFACE))break}u.release(B);this.cache.set(z.id,v);return v};q._getOrCalculateSingleTileVisibility=function(z,v){var B=this.cache.get(z.id);if(null!=B)return B;B=this._calculateSingleTileVisibility(z);
v&&this.cache.set(z.id,B);return B};q._calculateSingleTileVisibility=function(z){if(!this.aboveGround&&this.renderCoordsHelper.viewingMode===f.ViewingMode.Global&&12>z.lij[0]){if(this._calculateSingleTileVisibilitySided(z,!1)===e.Visibility.INVISIBLE)return this._calculateSingleTileVisibilitySided(z,!0)}else return this._calculateSingleTileVisibilitySided(z,this.aboveGround)};q._calculateSingleTileVisibilitySided=function(z,v){this.intersector.update(z.extent,z.tilingScheme.spatialReference,this.surfaceElevation,
v);z=x.getReferenceEllipsoid(z.tilingScheme.spatialReference).radius;return this.intersector.isVisibleInFrustum(this.extendedFrustum,z)?this.intersector.isVisibleInFrustum(this.frustum,z,!0)?e.Visibility.VISIBLE_ON_SURFACE:e.Visibility.VISIBLE_WHEN_EXTENDED:e.Visibility.INVISIBLE};q._updateExtendedFrustum=function(z){this.extendedFrustum.update(z);this._shortenFrustumFarPlane(this.extendedFrustum);var v=this.renderCoordsHelper.worldUpAtPosition(z.eye,p);this.aboveGround||d.negate(v,v);v=b.acosClamped(-d.dot(v,
z.viewForward));this.allTilesInvisible=v>(Math.PI+z.fovY)/2;if(!this.allTilesInvisible&&(this.hasExtendedFrustum=v>z.fovY/2)){z=this._extendedFrustumParameters();v=this.extendedFrustum.mutablePoints;for(let B=0;4>B;B++){const A=z.pointIndices[B],E=v[A],C=this.renderCoordsHelper.getAltitude(E);if(z.needsAltitudeAdjustment(C)){this.renderCoordsHelper.worldUpAtPosition(E,p);switch(A){case w.PointIndex.FAR_BOTTOM_LEFT:case w.PointIndex.FAR_TOP_LEFT:case w.PointIndex.NEAR_BOTTOM_LEFT:case w.PointIndex.NEAR_TOP_LEFT:l.projectVector(this.extendedFrustum.planes[w.PlaneIndex.LEFT],
p,p);break;case w.PointIndex.FAR_BOTTOM_RIGHT:case w.PointIndex.FAR_TOP_RIGHT:case w.PointIndex.NEAR_BOTTOM_RIGHT:case w.PointIndex.NEAR_TOP_RIGHT:l.projectVector(this.extendedFrustum.planes[w.PlaneIndex.RIGHT],p,p)}d.scale(p,p,z.direction);this.renderCoordsHelper.intersectInfiniteManifold(n.wrap(E,p),z.zWithMargin,E)}}this.extendedFrustum.updatePoints(v);l.fromPoints(v[w.PointIndex.NEAR_BOTTOM_LEFT],v[w.PointIndex.NEAR_BOTTOM_RIGHT],v[w.PointIndex.NEAR_TOP_RIGHT],h);l.fromPoints(v[w.PointIndex.NEAR_BOTTOM_RIGHT],
v[w.PointIndex.NEAR_TOP_RIGHT],v[w.PointIndex.NEAR_TOP_LEFT],m);0>d.dot(l.normal(h),l.normal(m))&&(z=this.extendedFrustum.mutablePoints,this.aboveGround?[z[w.PointIndex.NEAR_BOTTOM_LEFT],z[w.PointIndex.NEAR_BOTTOM_RIGHT]]=[z[w.PointIndex.NEAR_BOTTOM_RIGHT],z[w.PointIndex.NEAR_BOTTOM_LEFT]]:[z[w.PointIndex.NEAR_TOP_LEFT],z[w.PointIndex.NEAR_TOP_RIGHT]]=[z[w.PointIndex.NEAR_TOP_RIGHT],z[w.PointIndex.NEAR_TOP_LEFT]],this.extendedFrustum.updatePoints(z))}};q._extendedFrustumParameters=function(){return this.aboveGround?
this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()};q._extendedFrustumParametersAboveSurface=function(){const z=this.surfaceElevation-1;return{zWithMargin:z,pointIndices:k.Frustum.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment(v){return v>z}}};q._extendedFrustumParametersBelowSurface=function(){const z=this.surfaceElevation+1;return{zWithMargin:z,pointIndices:k.Frustum.planePointIndices.top,direction:1,needsAltitudeAdjustment(v){return v<z}}};
return t}();const p=g.create(),h=l.create(),m=l.create(),u=new c(Array,t=>{4!==t.length&&(t[0]=new e.FeatureTileDescriptor3D,t[1]=new e.FeatureTileDescriptor3D,t[2]=new e.FeatureTileDescriptor3D,t[3]=new e.FeatureTileDescriptor3D)},t=>{t[0].release();t[1].release();t[2].release();t[3].release()});a.FeatureTileVisibility3D=y;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/Frustum":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/vec3",
"../../../chunks/vec3f64","../../../geometry/support/frustum"],function(a,b,c,d,g){function x(l,n,f){l.origin=n;l.endpoint=f;c.direction(l.direction,n,f)}let w=function(){function l(f){this.renderCoordsHelper=f;this.frustum=g.create();this._points=g.createPoints();this.lines=Array(12);this._origin=d.create();this._direction=d.create();this._altitude=null;for(f=0;12>f;f++)this.lines[f]={origin:null,direction:d.create(),endpoint:null}}var n=l.prototype;n.update=function(f){g.fromMatrix(f.viewMatrix,
f.projectionMatrix,this.frustum,this._points);c.copy(this._origin,f.eye);c.copy(this._direction,f.viewForward);this._altitude=this.renderCoordsHelper.getAltitude(this._origin);this._updateLines()};n.updatePoints=function(f){for(let e=0;e<this._points.length;e++)c.copy(this._points[e],f[e]);g.computePlanes(this.frustum,this._points);this._updateLines()};n.intersectsSphere=function(f){return g.intersectsSphere(this.frustum,f)};n.intersectsRay=function(f){return g.intersectsRay(this.frustum,f)};n.intersectsLineSegment=
function(f,e){return g.intersectsLineSegment(this.frustum,f,e)};n.intersectsPoint=function(f){return g.intersectsPoint(this.frustum,f)};n._updateLines=function(){const f=this._points;for(let e=0;4>e;e++){const k=e+4;x(this.lines[e],f[e],f[k]);x(this.lines[e+4],f[e],3===e?f[0]:f[e+1]);x(this.lines[e+8],f[k],3===e?f[4]:f[k+1])}};b._createClass(l,[{key:"planes",get:function(){return this.frustum}},{key:"points",get:function(){return this._points}},{key:"mutablePoints",get:function(){return this._points}},
{key:"direction",get:function(){return this._direction}},{key:"altitude",get:function(){return this._altitude}}]);return l}();w.planePointIndices=g.planePointIndices;w.nearFarLineIndices=[[g.PointIndex.NEAR_BOTTOM_LEFT,g.PointIndex.FAR_BOTTOM_LEFT],[g.PointIndex.NEAR_BOTTOM_RIGHT,g.PointIndex.FAR_BOTTOM_RIGHT],[g.PointIndex.NEAR_TOP_RIGHT,g.PointIndex.FAR_TOP_RIGHT],[g.PointIndex.NEAR_TOP_LEFT,g.PointIndex.FAR_TOP_LEFT]];a.Frustum=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/FrustumExtentIntersection":function(){define("exports ../../../core/compilerUtils ../../../core/mathUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/projectionEllipsoid ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/frustum ../../../geometry/support/lineSegment ../../../geometry/support/plane ../../../geometry/support/ray ../../ViewingMode ./intersectionUtils".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m){const u=.5*Math.PI,t=u/Math.PI*180;let q=function(){function F(J){this.renderCoordsHelper=J.renderCoordsHelper;this.extent=Array(4);this.planes=Array(6);this.maxSpan=0;this.center={origin:w.create(),direction:w.create()};for(J=0;4>J;J++)this.extent[J]={origin:w.create(),direction:w.create(),cap:{next:null,direction:w.create()}},this.planes[J]=y.create();this.planes[k.PlaneIndex.NEAR]=y.create();this.planes[k.PlaneIndex.FAR]=y.create();this.planesWithoutFar=
this.planes.slice(0,5)}var G=F.prototype;G.update=function(J,I,O,P=!0){const K=this.extent;this._toRenderBoundingExtent(J,I,O);x.add(this.center.origin,K[0].origin,K[2].origin);x.scale(this.center.origin,this.center.origin,.5);this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction);P||x.scale(this.center.direction,this.center.direction,-1);for(O=0;4>O;O++){const M=K[O];this.renderCoordsHelper.worldUpAtPosition(M.origin,M.direction);const U=K[3===O?0:O+1];M.cap.next=U.origin;
x.direction(M.cap.direction,M.origin,U.origin);y.fromVectorsAndPoint(M.direction,M.cap.direction,M.origin,this.planes[O]);P||x.scale(M.direction,M.direction,-1)}y.fromVectorsAndPoint(K[0].cap.direction,K[1].cap.direction,K[0].origin,this.planes[k.PlaneIndex.NEAR]);P?y.negate(this.planes[k.PlaneIndex.NEAR],this.planes[k.PlaneIndex.FAR]):(y.copy(this.planes[k.PlaneIndex.FAR],this.planes[k.PlaneIndex.NEAR]),y.negate(this.planes[k.PlaneIndex.NEAR],this.planes[k.PlaneIndex.NEAR]));this.maxSpan=Math.max(Math.abs(J[0]-
J[2]),Math.abs(J[1]-J[3]));this.maxSpanSpatialReference=I;this.minGlobalAltitude=.9*n.getReferenceEllipsoid(this.maxSpanSpatialReference).radius};G.isVisibleInFrustum=function(J,I,O=!1){if(null==J)return!1;if(this.renderCoordsHelper.viewingMode===h.ViewingMode.Global){if(this.maxSpan>(this.maxSpanSpatialReference.isGeographic?t:u*I))return!0;if(J.altitude>=this.minGlobalAltitude)return this._isVisibleInFrustumGlobal(J)}if(0===this.maxSpan)return I=this.extent[0],!O&&J.intersectsRay(p.wrap(I.origin,
I.direction))?!0:!1;for(I=0;I<this.extent.length;I++){var P=this.extent[I];if(!O&&J.intersectsRay(p.wrap(P.origin,P.direction))||J.intersectsLineSegment(r.fromPoints(P.origin,P.cap.next,D),P.cap.direction))return!0}O=O?this.planes:this.planesWithoutFar;for(I=0;I<J.lines.length;I++)if(P=J.lines[I],m.frustumLineSegment(O,P.origin,P.endpoint,P.direction))return!0;return!1};G._toRenderBoundingExtentGlobal=function(J,I,O){e.center(J,v);v[2]=O;l.computeTranslationToOriginAndRotation(I,v,B,this.renderCoordsHelper.spatialReference);
d.invert(A,B);f.empty(E);for(const {x0:P,x1:K,y0:M,y1:U}of z)for(let R=0;5>R;R++){const L=R/4;v[0]=c.lerp(J[P],J[K],L);v[1]=c.lerp(J[M],J[U],L);v[2]=O;l.projectVectorToVector(v,I,v,this.renderCoordsHelper.spatialReference);x.transformMat4(v,v,A);f.expandWithVec3(E,v)}x.set(this.extent[0].origin,E[0],E[1],E[2]);x.set(this.extent[1].origin,E[3],E[1],E[2]);x.set(this.extent[2].origin,E[3],E[4],E[2]);x.set(this.extent[3].origin,E[0],E[4],E[2]);for(J=0;4>J;++J)x.transformMat4(this.extent[J].origin,this.extent[J].origin,
B)};G._toRenderBoundingExtentLocal=function(J,I,O){l.projectBoundingRect(J,I,C,this.renderCoordsHelper.spatialReference);x.set(this.extent[0].origin,C[0],C[1],O);x.set(this.extent[1].origin,C[2],C[1],O);x.set(this.extent[2].origin,C[2],C[3],O);x.set(this.extent[3].origin,C[0],C[3],O)};G._toRenderBoundingExtent=function(J,I,O){switch(this.renderCoordsHelper.viewingMode){case h.ViewingMode.Global:this._toRenderBoundingExtentGlobal(J,I,O);break;case h.ViewingMode.Local:this._toRenderBoundingExtentLocal(J,
I,O);break;default:b.neverReached(this.renderCoordsHelper.viewingMode)}};G._isVisibleInFrustumGlobal=function(J){if(0>x.dot(this.center.direction,J.direction))return!0;for(let I=0;4>I;I++)if(0>x.dot(this.extent[I].direction,J.direction))return!0;return!1};return F}();const z=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],v=w.create(),B=g.create(),A=g.create(),E=f.create(),C=e.create(),D=r.create();a.FrustumExtentIntersection=q;a.default=q;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/support/extentUtils":function(){define(["exports","../../../core/maybe","../../../chunks/vec3f64","../../../geometry/projection"],function(a,b,c,d){const g=c.create();a.projectToBoundingBox=function(x,w,l){if(b.isNone(x)||b.isNone(l))return!1;let n;g[0]=null!=x.xmin?x.xmin:0;g[1]=null!=x.ymin?x.ymin:0;g[2]=null!=x.zmin?x.zmin:0;n=d.projectBuffer(g,x.spatialReference,0,w,l,0,1);g[0]=null!=x.xmax?x.xmax:0;g[1]=null!=x.ymax?x.ymax:0;g[2]=null!=x.zmax?x.zmax:
0;n=n&&d.projectBuffer(g,x.spatialReference,0,w,l,3,1);null==x.xmin&&(w[0]=-Infinity);null==x.ymin&&(w[1]=-Infinity);null==x.zmin&&(w[2]=-Infinity);null==x.xmax&&(w[3]=Infinity);null==x.ymax&&(w[4]=Infinity);null==x.zmax&&(w[5]=Infinity);return n};a.toBoundingRect=function(x,w,l){if(b.isNone(x)||b.isNone(l))return!1;let n;g[0]=null!=x.xmin?x.xmin:0;g[1]=null!=x.ymin?x.ymin:0;g[2]=null!=x.zmin?x.zmin:0;n=d.projectBuffer(g,x.spatialReference,0,g,l,0,1);w[0]=g[0];w[1]=g[1];g[0]=null!=x.xmax?x.xmax:0;
g[1]=null!=x.ymax?x.ymax:0;g[2]=null!=x.zmax?x.zmax:0;n=n&&d.projectBuffer(g,x.spatialReference,0,g,l,0,1);w[2]=g[0];w[3]=g[1];null==x.xmin&&(w[0]=-Infinity);null==x.ymin&&(w[1]=-Infinity);null==x.xmax&&(w[2]=Infinity);null==x.ymax&&(w[3]=Infinity);return n};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/ViewState":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Evented ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/watch ../../../chunks/vec3f64 ../../../geometry/projectionEllipsoid ../../ViewAnimation ../../ViewingMode ./Constraints ./controllers/AnimationController ./controllers/CameraController ../support/PropertiesPool ../webgl-engine/lib/Camera".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q){c=function(A){function E(){var D=A.apply(this,arguments)||this;D._propertiesPool=new t.PropertiesPool({camera:q.default},a._assertThisInitialized(D));D._lastSeenCameraProjectionValues=new q.default;D.events=new d;D.viewingMode=p.ViewingMode.Global;D._cameraChanged=!1;D.updateQueue=[];D.processingUpdates=!1;return D}a._inheritsLoose(E,A);var C=E.prototype;C.init=function(D,F){this._set("viewingMode",D);this._set("spatialReference",F);this._set("constraints",
new h.default({mode:this.viewingMode}))};C.exit=function(){this.cameraController=null;this._propertiesPool.destroy();this._propertiesPool=new t.PropertiesPool({camera:q.default},this)};C.createInitialCamera=function(){if(this.viewingMode===p.ViewingMode.Global){const D=r.getReferenceEllipsoid(this.spatialReference).radius;this.camera=new q.default(k.fromValues(4*D,0,0),k.fromValues(D,0,0),k.fromValues(0,0,1))}else this.camera=new q.default(k.fromValues(0,0,100),k.fromValues(0,0,0),k.fromValues(0,
1,0))};C.switchCameraController=function(D){this.cameraController=D;return D.state!==u.State.Rejected};C.stopActiveCameraController=function(){return this.cameraController&&!this.cameraController.stopController()?!1:!0};C.updateCamera=function(D){this.updateQueue.push(D);this._processUpdateQueue()};C._processUpdateQueue=function(){if(0!==this.updateQueue.length&&!this.processingUpdates){this.processingUpdates=!0;var D=this.updateQueue.shift();z.copyFrom(this._get("camera"));D(z);this.camera=z;this.processingUpdates=
!1;this._processUpdateQueue()}};C._cameraProjectionChanged=function(D,F){return D.fov!==F.fov||D.fullViewport[0]!==F.fullViewport[0]||D.fullViewport[1]!==F.fullViewport[1]||D.fullViewport[2]!==F.fullViewport[2]||D.fullViewport[3]!==F.fullViewport[3]||D.padding[q.PaddingSide.TOP]!==F.padding[q.PaddingSide.TOP]||D.padding[q.PaddingSide.RIGHT]!==F.padding[q.PaddingSide.RIGHT]||D.padding[q.PaddingSide.BOTTOM]!==F.padding[q.PaddingSide.BOTTOM]||D.padding[q.PaddingSide.LEFT]!==F.padding[q.PaddingSide.LEFT]?
!0:!1};a._createClass(E,[{key:"animation",get:function(){return this.cameraController instanceof m.AnimationController&&g.isSome(this.cameraController.viewAnimation)?this.cameraController.viewAnimation:null}},{key:"camera",get:function(){return this._get("camera")},set:function(D){D!==z&&z.copyFrom(D);z.computeUp(this.viewingMode);v.camera=z;this.events.emit("before-camera-change",v);D=this._get("camera");this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,z)&&(this._lastSeenCameraProjectionValues.copyFrom(z),
B.camera=this._lastSeenCameraProjectionValues,this.events.emit("camera-projection-changed",B));if(!D||!D.equals(z))if(this._set("camera",this._propertiesPool.get("camera").copyFrom(z)),this._cameraChanged=!D||!D.almostEquals(z)){const F=e.afterDispatch(()=>{this._cameraChanged=!1;F.remove()})}}},{key:"contentCamera",get:function(){return g.isSome(this._contentCamera)?this._contentCamera:this.camera},set:function(D){this._contentCamera=g.isSome(D)?D.clone():null}},{key:"fixedContentCamera",get:function(){return!!g.isSome(this._contentCamera)}},
{key:"isGlobal",get:function(){return this.viewingMode===p.ViewingMode.Global}},{key:"isLocal",get:function(){return this.viewingMode===p.ViewingMode.Local}},{key:"navigating",get:function(){return!(!this.cameraController||!this.cameraController.isInteractive)}},{key:"stationary",get:function(){return!this._cameraChanged&&!this.navigating}},{key:"cameraController",get:function(){return this._get("cameraController")},set:function(D){this.stopActiveCameraController()?(D&&(D.watch("state",F=>{if(F===
u.State.Finished||F===u.State.Stopped)this._set("cameraController",null),this.updateCamera(G=>D.onControllerEnd(G))},!0),D.onControllerStart(this.camera)),this._set("cameraController",D)):D&&(D.state=u.State.Rejected)}}]);return E}(c);b.__decorate([x.property({readOnly:!0,type:y})],c.prototype,"animation",null);b.__decorate([x.property({type:q.default})],c.prototype,"camera",null);b.__decorate([x.property({})],c.prototype,"_contentCamera",void 0);b.__decorate([x.property({type:q.default})],c.prototype,
"contentCamera",null);b.__decorate([x.property({readOnly:!0})],c.prototype,"fixedContentCamera",null);b.__decorate([x.property({readOnly:!0})],c.prototype,"constraints",void 0);b.__decorate([x.property({readOnly:!0})],c.prototype,"events",void 0);b.__decorate([x.property({readOnly:!0})],c.prototype,"isGlobal",null);b.__decorate([x.property({readOnly:!0})],c.prototype,"isLocal",null);b.__decorate([x.property({readOnly:!0})],c.prototype,"viewingMode",void 0);b.__decorate([x.property({readOnly:!0})],
c.prototype,"spatialReference",void 0);b.__decorate([x.property({readOnly:!0})],c.prototype,"navigating",null);b.__decorate([x.property({readOnly:!0})],c.prototype,"stationary",null);b.__decorate([x.property()],c.prototype,"_cameraChanged",void 0);b.__decorate([x.property()],c.prototype,"cameraController",null);b=c=b.__decorate([f.subclass("esri.views.3d.state.ViewState")],c);const z=new q.default,v={camera:null},B={camera:null};return b})},"esri/views/3d/support/PropertiesPool":function(){define(["exports",
"../../../core/ReentrantObjectPool","../../../core/accessorSupport/watch"],function(a,b,c){let d=function(){function g(w,l){this.owner=l;this.properties={};this.afterDispatchHandle=null;for(const n in w)l=new b.ReentrantObjectPool(w[n],null,null,2,2),this.properties[n]={pool:l,acquired:[]};this.afterDispatchHandle=c.afterDispatch(()=>this._release())}var x=g.prototype;x.destroy=function(){this.afterDispatchHandle&&(this.afterDispatchHandle.remove(),this.afterDispatchHandle=null);for(const w in this.properties){const l=
this.properties[w];for(const n of l.acquired)c.isValueInUse(n)||l.pool.release(n);l.pool.destroy();l.pool=null;l.acquired=null}this.owner=this.properties=null};x.get=function(w){const l=this.owner._get(w);w=this.properties[w];let n=w.pool.acquire();for(w.acquired.push(n);n===l;)w.acquired.push(n),n=w.pool.acquire();return n};x._release=function(){for(const w in this.properties){const l=this.properties[w];let n=0;for(const f of l.acquired)c.isValueInUse(f)?l.acquired[n++]=f:l.pool.release(f);l.acquired.length=
n}};return g}();a.PropertiesPool=d;a.default=d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/ViewStateManager":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Camera ../../../Viewpoint ../../../core/Accessor ../../../core/Handles ../../../core/Logger ../../../core/maybe ../../../core/scheduling ../../../core/screenUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/Extent ../../../geometry/Point ../../../geometry/support/webMercatorUtils ../../ViewingMode ../camera/constraintUtils ../camera/intersectionUtils ./ConstraintsManager ./Frustum ./GoToOperation ./controllers/SurfaceCollisionCorrectionController ../support/cameraUtils ../support/PropertiesPool ../support/viewpointUtils ../webgl-engine/lib/Camera".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E,C,D,F,G,J,I,O,P,K){const M=w.getLogger("esri.views.3d.state.ViewStateManager");g=function(H){function Q(V){V=H.call(this,V)||this;V.propertiesPool=new O.PropertiesPool({frustum:F.Frustum},a._assertThisInitialized(V));V.handles=new x;V.cameraSetByUser=!1;V.gotoOperation=null;V.ready=!1;V.updateDevicePixelRatio=null;V.test={contentCameraResetState:new Map};return V}a._inheritsLoose(Q,H);var W=Q.prototype;W.installContentCameraReset=function(V){this.handles.remove("contentCameraReset");
this.test.contentCameraResetState.clear();if(!this.view.state.fixedContentCamera)return!1;const Y=this.zoom,aa=this.view.state.camera.distance**2,X=u.fromArray(this.view.state.camera.center),ba=V.sticky?this.contentCamera.clone():null;this.handles.add([this.watch("contentCamera",()=>{V.sticky||(this.handles.remove("contentCameraReset"),this.test.contentCameraResetState.clear())}),this.watch("zoom",ha=>{this.test.contentCameraResetState.set("view.zoom",Math.abs(ha-Y)/2);2<Math.abs(ha-Y)?this.contentCamera=
null:this.view.state.fixedContentCamera||(this.contentCamera=ba)}),this.view.state.watch("camera",ha=>{ha=m.squaredDistance(X,ha.center);this.test.contentCameraResetState.set("camera.center",ha/aa);ha>aa?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=ba)})],"contentCameraReset");return!0};W._paddingToArray=function(V,Y,aa){V?t.set(aa,V.top||0,V.right||0,V.bottom||0,V.left||0):t.set(aa,0,0,0,0);for(V=0;4>V;V++)aa[V]=Math.round(aa[V]*Y)};W.initialize=function(){this.handles.add([e.on(this.view,
"state.events","before-camera-change",V=>this._updateElevation(V.camera))]);e.once(this.view.state,"camera",V=>this._updateElevation(V),!0);this.handles.add(n.addFrameTask({prepare:()=>this._prepareFrame()}));this.handles.add(this.view.state.watch("cameraController",()=>{this.cameraSetByUser=!0;this.handles.remove("pending-initial-view")}));this.handles.add(e.on(this.view,"state.events","camera-projection-changed",()=>this.notifyChange("scale")))};W.destroy=function(){this.deinit();this.handles&&
(this.handles.destroy(),this.handles=null);this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null)};W.init=function(){this.constraintsManager=new D.default({view:this.view});this._prepareFrame();var V=this._getInitialProperties();this.cameraSetByUser=!1;this._set("ready",!0);for(const Y of V)this.set(Y.name,Y.value);this.cameraSetByUser||((V=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent)&&this.isCompatible(V)?this._setInitialView(V):this.view.state.viewingMode===
A.ViewingMode.Local&&this.handles.add(e.whenOnce(this.view.basemapTerrain,"ready",()=>{this.handles.remove("pending-initial-view");this._setInitialView(this.view.dataExtent)}),"pending-initial-view"))};W.deinit=function(){this._cancelGoToOperation();this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this.cameraSetByUser=!1,this.handles.remove("pending-initial-view"),this.constraintsManager&&(this.constraintsManager.destroy(),this.constraintsManager=
null))};W.goTo=function(){var V=a._asyncToGenerator(function*(Y,aa){aa={animate:!0,...aa};l.isSome(this.gotoOperation)&&this.gotoOperation.abort(aa.animate);this.gotoOperation=new G.GoToOperation(Y,aa,this.view);this.view.resourceController.scheduler.stopFrame();return this.gotoOperation});return function(Y,aa){return V.apply(this,arguments)}}();W.debugSetCameraOnContent=function(){this.setStateCamera(C.cameraOnContentAlongViewDirection(this.view),{applyConstraints:!1})};W.step=function(V){const Y=
this.view.state,aa=Y&&this.view.state.cameraController;aa&&(Y.updateCamera(X=>{aa.stepController(V,X)}),aa.steppingFinished&&aa.finishController())};W._cancelGoToOperation=function(){l.isSome(this.gotoOperation)&&(this.gotoOperation.abort(),this.gotoOperation=null)};W._getInitialProperties=function(){const V=new Set,Y=[];for(const {propertyName:aa,overrides:X}of R){const ba=V.has(aa),ha=this._isOverridden(aa);!ba&&ha&&Y.push({name:aa,value:this._get(aa)});this._clearOverride(aa);(ba||ha)&&X.forEach(ka=>
V.add(ka))}return Y};W._setInitialView=function(V){if(!l.isNone(V)&&!this.cameraSetByUser)if(V instanceof c)this.setStateCamera(I.externalToInternal(this.view,V),{applyConstraints:!1});else if(V instanceof d)if(V.targetGeometry instanceof z){var Y=I.fromExtent(this.view,V.targetGeometry,0,.5,I.OrientationMode.LOCKED);l.isSome(Y)&&this.setStateCamera(I.externalToInternal(this.view,Y),{applyConstraints:!0})}else Y={applyConstraints:!V.camera},V=this._viewpointToCamera(V),this.setStateCamera(V,Y);else Y=
I.fromExtent(this.view,V,0,.5,I.OrientationMode.LOCKED),l.isSome(Y)&&this.setStateCamera(I.externalToInternal(this.view,Y),{applyConstraints:!0})};W._updatePropertyBeforeReady=function(V,Y){if(this.ready)return!1;this._override(V,Y);Y&&-1!==U.indexOf(V)&&this._override("hasInitialView",!0);return!0};W.isCompatible=function(V){return l.isNone(V)?!1:V instanceof d?V.camera?this.isCompatible(V.camera):this.isCompatible(V.targetGeometry):V instanceof c?this.isCompatible(V.position):V.spatialReference&&
B.canProject(V.spatialReference,this.view.spatialReference)};W._getPreservingHeadingTilt=function(V=L){this.cameraSetByUser?(V.heading=this.camera.heading,V.tilt=this.camera.tilt):(V.heading=0,V.tilt=.5);return V};W._centerPointAtDistanceToCamera=function(V,Y,aa=T){const {heading:X,tilt:ba}=this._getPreservingHeadingTilt();V=I.getObserverForPointAtDistance(this.view,X,ba,V,Y,I.OrientationMode.ADJUST);if(l.isNone(V))return null;aa.copyFrom(this.view.state.camera);aa.eye=V.eye;aa.center=V.center;aa.up=
V.up;return aa};W._centerToCamera=function(V){const Y=this.view.pointsOfInterest.centerOnContent;Y.runTask();return this._centerPointAtDistanceToCamera(V,Y.distance)};W._extentToCamera=function(V){const {heading:Y,tilt:aa}=this._getPreservingHeadingTilt();V=I.fromExtent(this.view,V,Y,aa,I.OrientationMode.ADJUST,N);return l.isSome(V)?I.externalToInternal(this.view,V):null};W._scaleToCamera=function(V){if(null==V)return null;const Y=this.view.pointsOfInterest.centerOnContent;Y.runTask();const aa=Y.renderLocation;
V=I.scaleToDistance(this.view,V,Y.location.latitude);return this._centerPointAtDistanceToCamera(aa,V)};W._zoomToCamera=function(V){return this._scaleToCamera(I.zoomToScale(this.view,V))};W._viewpointToCamera=function(V){return I.externalToInternal(this.view,P.toCamera(this.view,V))};W.setStateCamera=function(V,Y){if(l.isNone(V)||!this.view.state.stopActiveCameraController())return!1;this.cameraSetByUser=!0;Y.doNotCancelGoToOperation||this._cancelGoToOperation();this.view.state.updateCamera(aa=>{Y.positionAndOrientationOnly?
(aa.eye=V.eye,aa.center=V.center,aa.up=V.up):aa.copyFrom(V);Y.applyConstraints&&E.applyAll(this.view,aa)});Y.applyConstraints||(this.view.state.cameraController=new J.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:V}));return!0};W._prepareFrame=function(){const {container:V,canvas:Y}=this.view;if(V&&Y){l.isSome(this.updateDevicePixelRatio)&&this.updateDevicePixelRatio();var aa=this.view.pixelRatio,X=Math.round(V.clientWidth*aa),ba=Math.round(V.clientHeight*aa);if(0!==X&&0!==ba){if(Y.width!==
X||Y.height!==ba)Y.width=X,Y.height=ba;if(this.view.state){const ha=this.view.state.camera;if(ha.fullWidth!==X||ha.fullHeight!==ba||ha.pixelRatio!==aa)T.copyFrom(ha),T.pixelRatio!==aa&&(this._paddingToArray(this.padding,aa,S),T.padding=S),T.fullWidth=X,T.fullHeight=ba,T.pixelRatio=aa,this.view.state.camera=T}}}};W._updateElevation=function(V){var Y=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference;const aa=this.view.renderCoordsHelper.getAltitude(V.eye);Y=Y?C.surfaceElevationBelowRenderLocation(this.view,
V.eye):0;V.relativeElevation=aa-Y};a._createClass(Q,[{key:"camera",get:function(){const V=this._get("camera");if(!this.ready)return V;const Y=I.internalToExternal(this.view,this.view.state.camera);return Y&&V&&Y.equals(V)?V:Y},set:function(V){this._updatePropertyBeforeReady("camera",V)||(this.view.elevationProvider.enableElevationCache(!0),this.setStateCamera(I.externalToInternal(this.view,V),{applyConstraints:!1})||M.error("#camera\x3d","Invalid camera",V),this.view.elevationProvider.enableElevationCache(!1))}},
{key:"contentCamera",get:function(){const V=this._get("contentCamera");if(!this.ready)return V;const Y=I.internalToExternal(this.view,this.view.state.contentCamera);return Y&&V&&Y.equals(V)?V:Y},set:function(V){this._updatePropertyBeforeReady("contentCamera",V)||(V=I.externalToInternal(this.view,V),l.isNone(V)?this.view.state.contentCamera=null:(this._updateElevation(V),this.view.state.contentCamera=V))}},{key:"center",get:function(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:
this._get("center")},set:function(V){this._updatePropertyBeforeReady("center",V)||(V?this.isCompatible(V)?this.setStateCamera(this._centerToCamera(V),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():M.error("#center\x3d","Invalid center",V):M.error("#center\x3d","Center has an incompatible spatial reference (center: "+(V.spatialReference?V.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",V):M.error("#center\x3d","Center may not be null or undefined"))}},
{key:"extent",get:function(){if(!this.ready)return this._get("extent");var V=this.view;V=I.toExtent(V,V.state.camera,V.pointsOfInterest.centerOnContent.renderLocation);return l.isSome(V)?V:this._get("extent")},set:function(V){this._updatePropertyBeforeReady("extent",V)||(V?this.isCompatible(V)?this.setStateCamera(this._extentToCamera(V),{applyConstraints:!0})||M.error("#extent\x3d","Invalid extent",V):M.error("#extent\x3d","Extent has an incompatible spatial reference (extent: "+(V.spatialReference?
V.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",V):M.error("#extent\x3d","Extent may not be null or undefined"))}},{key:"frustum",get:function(){const V=this.propertiesPool.get("frustum");V.renderCoordsHelper=this.view.renderCoordsHelper;V.update(this.view.state.camera);return V}},{key:"hasInitialView",get:function(){return!!this.view.get("map.initialViewProperties.viewpoint")}},{key:"scale",get:function(){if(this.ready){const V=this.view.pointsOfInterest.centerOnContent;
return I.distanceToScale(this.view,V.distance,V.location.latitude)}return this._get("scale")},set:function(V){this._updatePropertyBeforeReady("scale",V)||this.setStateCamera(this._scaleToCamera(V),{applyConstraints:!0})||M.error("#scale\x3d","Invalid scale",V)}},{key:"padding",get:function(){if(!this.ready)return this._get("padding");var V=this.view.state.camera,Y=V.padding;const aa=V.pixelRatio;V=this._get("padding");const X=Math.round(Y[K.PaddingSide.TOP]/aa),ba=Math.round(Y[K.PaddingSide.RIGHT]/
aa),ha=Math.round(Y[K.PaddingSide.BOTTOM]/aa);Y=Math.round(Y[K.PaddingSide.LEFT]/aa);return null!=V&&V.top===X&&V.right===ba&&V.bottom===ha&&V.left===Y?V:{top:X,right:ba,bottom:ha,left:Y}},set:function(V){this._updatePropertyBeforeReady("padding",V)||(this._paddingToArray(V,this.view.state.camera.pixelRatio,S),this.view.state.updateCamera(Y=>Y.padding=S))}},{key:"screenCenter",get:function(){const V=this.padding;return f.createScreenPoint((this.view.width-(V.left+V.right))/2+V.left,(this.view.height-
(V.top+V.bottom))/2+V.top)}},{key:"viewpoint",get:function(){return this.ready?P.fromCamera(this.view,this.camera):this._get("viewpoint")},set:function(V){if(!this._updatePropertyBeforeReady("viewpoint",V))if(V)if(this.isCompatible(V))this.setStateCamera(this._viewpointToCamera(V),{applyConstraints:!V.camera})||M.error("#viewpoint\x3d","Invalid viewpoint",V);else{var Y=l.isSome(V.camera)?V.camera.position:V.targetGeometry;Y=l.isSome(Y)&&Y.spatialReference;M.error("#viewpoint\x3d","Viewpoint has an incompatible spatial reference (viewpoint: "+
(Y?Y.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",V)}else M.error("#viewpoint\x3d","Viewpoint may not be null or undefined")}},{key:"zoom",get:function(){return this.ready?I.scaleToZoom(this.view,this.scale):this._get("zoom")},set:function(V){this._updatePropertyBeforeReady("zoom",V)||this.setStateCamera(this._zoomToCamera(V),{applyConstraints:!0})||M.error("#zoom\x3d","Invalid zoom",V)}}]);return Q}(g);b.__decorate([k.property({type:c,dependsOn:["view.state.camera","ready"]})],g.prototype,
"camera",null);b.__decorate([k.property({type:c,dependsOn:["view.state.contentCamera","ready"]})],g.prototype,"contentCamera",null);b.__decorate([k.property({type:v})],g.prototype,"center",null);b.__decorate([k.property({type:z})],g.prototype,"extent",null);b.__decorate([k.property({readOnly:!0})],g.prototype,"frustum",null);b.__decorate([k.property({readOnly:!0})],g.prototype,"hasInitialView",null);b.__decorate([k.property({readOnly:!0,type:Boolean})],g.prototype,"ready",void 0);b.__decorate([k.property({type:Number})],
g.prototype,"scale",null);b.__decorate([k.property()],g.prototype,"padding",null);b.__decorate([k.property({readOnly:!0})],g.prototype,"screenCenter",null);b.__decorate([k.property({constructOnly:!0})],g.prototype,"view",void 0);b.__decorate([k.property({type:d})],g.prototype,"viewpoint",null);b.__decorate([k.property({type:Number})],g.prototype,"zoom",null);b.__decorate([k.property({constructOnly:!0})],g.prototype,"updateDevicePixelRatio",void 0);b=g=b.__decorate([h.subclass("esri.views.3d.state.ViewStateManager")],
g);const U="camera viewpoint extent scale center zoom".split(" "),R=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],L={heading:0,tilt:0},N=new c,T=new K.default,S=q.create();return b})},"esri/views/3d/state/ConstraintsManager":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/mathUtils ../../../core/maybe ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../ViewingMode ../camera/constraintUtils ../camera/intersectionUtils ../camera/constraintUtils/common ./NearFarHeuristic ./SurfaceCollisionConstraint".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t){a.ConstraintsManager=function(q){function z(B){var A=q.call(this,B)||this;A._handles=new g;A.nearFarHeuristic=u.createNearFarHeuristic(B.view.state.viewingMode,B.view.basemapTerrain,B.view.renderCoordsHelper.spatialReference);return A}b._inheritsLoose(z,q);var v=z.prototype;v.initialize=function(){this._handles.add([this.view.watch(["constraints.clipDistance.near","constraints.clipDistance.far"],()=>this._clipDistanceNearFarChanged()),this.view.watch("constraints.clipDistance.mode",
()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",B=>this._updateCameraNearFar(B.camera)),this.view.watch("renderDataExtent",()=>this._updateNearFar(),!0),this.view.watch(["constraints.altitude.min","constraints.altitude.max"],()=>this._updateAltitude(),!0),this.view.watch("constraints.tilt.max",()=>this._updateTiltMax(),!0),this.view.watch("constraints.tilt.mode",()=>this._updateTilt(),!0),this.view.watch("state.camera",()=>this._updateTiltAutoMax(),!0),this.view.watch(["map.ground.navigationConstraint.type",
"constraints.collision.enabled"],()=>this._updateCollision(),!0)]);this.view.state.isLocal&&this._handles.add(l.init(this.view,"renderDataExtent",B=>this._updateLocalSurfaceDistance(B)));this._updateNearFar();this.view.state.viewingMode!==y.ViewingMode.Local&&this._updateAltitude();this._updateTilt();this._updateCollision();this._set("surfaceCollisionConstraint",new t.default({view:this.view}))};v.destroy=function(){this._handles=w.destroyMaybe(this._handles);this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),
this._set("surfaceCollisionConstraint",null))};v._clipDistanceNearFarChanged=function(){var B;const A=null==(B=this.view.constraints)?void 0:B.clipDistance;A&&"auto"!==A.mode&&this.view.state.updateCamera(E=>{this._updateCameraNearFarManual(E,A);return!0})};v._updateNearFar=function(){this.view.state.updateCamera(B=>{this._updateCameraNearFar(B);return!0})};v._updateCameraNearFar=function(B){const A=this.view.constraints&&this.view.constraints.clipDistance;"manual"===(A?A.mode:"auto")?this._updateCameraNearFarManual(B,
A):this._updateCameraNearFarAuto(B,A)};v._updateCameraNearFarAuto=function(B,A){this.nearFarHeuristic.compute(B.eye,B.center,this.view.renderDataExtent,h.surfaceElevationBelowRenderLocation(this.view,B.eye),B);A&&A.autoUpdate(B.near,B.far)};v._updateCameraNearFarManual=function(B,A){A&&(B.near=A.near,B.far=A.far)};v._updateCollision=function(){var B,A,E;const C=null==(B=this.view.map)?void 0:null==(A=B.ground)?void 0:null==(E=A.navigationConstraint)?void 0:E.type;B=C?"stay-above"===C:!0;A=this.view.state.constraints.collision;
B!==A.enabled&&((A.enabled=B)&&this._reapplyConstraints(m.ConstraintTypes.COLLISION),(B=this.view.constraints&&this.view.constraints.tilt)&&"auto"!==B.mode||this._updateTiltAuto())};v._updateAltitude=function(){const B=this.view.constraints&&this.view.constraints.altitude;this.view.state.constraints.altitude=B&&this.view.state.viewingMode!==y.ViewingMode.Local?{min:B.min,max:B.max}:null;this._reapplyConstraints()};v._updateTiltMax=function(){const B=this.view.constraints&&this.view.constraints.tilt;
B&&"auto"!==B.mode&&(this._updateTiltManual(B),this._reapplyConstraints())};v._updateTilt=function(){const B=this.view.constraints&&this.view.constraints.tilt;"manual"===(B?B.mode:"auto")?this._updateTiltManual(B):this._updateTiltAuto();this._reapplyConstraints()};v._updateTiltManual=function(B){const A=this.view.state.constraints;A.tilt=A.createConstantMaxTilt(x.deg2rad(B.max))};v._updateTiltAuto=function(){const B=this.view.state.constraints;B.tilt=B.createDefaultTilt();this._updateTiltAutoMax()};
v._updateTiltAutoMax=function(){const B=this.view.constraints&&this.view.constraints.tilt;if(B&&"auto"===B.mode){var A=this.view.state.constraints;A.tilt&&(A=A.tilt(this.view.state.camera.distance).max,B.autoUpdate(x.rad2deg(A)))}};v._updateLocalSurfaceDistance=function(B){if(!w.isNone(B)){var A=Math.max(B.width,B.height);0>=A||(B.hasZ&&(A=Math.max(A,B.zmax-B.zmin)),B=this.view.state,A=3*A/Math.atan(B.camera.fov/2),A!==B.constraints.distance&&(B.constraints.distance=A))}};v._reapplyConstraints=function(B=
m.ConstraintTypes.ALL){this.view.state.updateCamera(A=>p.applyAll(this.view,A,{selection:B,interactionType:m.InteractionType.NONE,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:m.TiltMode.TUMBLE}))};return z}(d);c.__decorate([n.property({constructOnly:!0})],a.ConstraintsManager.prototype,"view",void 0);c.__decorate([n.property({readOnly:!0})],a.ConstraintsManager.prototype,"surfaceCollisionConstraint",void 0);a.ConstraintsManager=c.__decorate([r.subclass("esri.views.3d.state.ConstraintsManager")],
a.ConstraintsManager);a.default=a.ConstraintsManager;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/NearFarHeuristic":function(){define("exports ../../../core/mathUtils ../../../core/maybe ../../../core/unitUtils ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/Extent ../../../geometry/projectionEllipsoid ../../ViewingMode".split(" "),function(a,b,c,d,g,x,w,l,n){function f(p,h,m,u){m=2/m;p/h>m?(u.far=p,u.near=u.far/h):(u.near=m,u.far=u.near*h);return u}let e=
function(){function p(h,m){this.elevationProvider=h;this._referenceEllipsoid=l.getReferenceEllipsoid(m);this.unitInMeters=d.getMetersPerUnitForSR(m,this._referenceEllipsoid.metersPerDegree)}p.prototype.compute=function(h,m,u,t,q){q||(q={near:0,far:0});var z=h[2]*this.unitInMeters,v=z;t=z-t;var B=this.elevationProvider?this.elevationProvider.elevationBounds:null;B&&(z=0<=t?v-this.unitInMeters*B.min:this.unitInMeters*B.max-v);u=c.isSome(u)?u:new w({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0});v=Math.max(u.xmax-
u.xmin,u.ymax-u.ymin,4*Math.max(u.xmax-u.xmin,u.ymax-u.ymin));g.subtract(y,m,h);r[0]=0<y[0]?u.xmax:u.xmin;r[1]=0<y[1]?u.ymax:u.ymin;r[2]=0<y[2]?v/2:-v/2;g.subtract(r,r,h);g.normalize(y,y);h=1.1*g.dot(r,y)*this.unitInMeters;m=Math.sqrt(z*(z+2*this._referenceEllipsoid.radius));u=Math.max(u.xmax-u.xmin,u.ymax-u.ymin);B=1E-4*u*this.unitInMeters;z=b.clamp((z-B)/(.001*u*this.unitInMeters-B),0,1);z=b.lerp(m,h,z*z*z);z*=Math.max(Math.log(Math.abs(t)),1);z=Math.min(z,Math.max(34064E4,v));z/=this.unitInMeters;
return f(z,2E4,this.unitInMeters,q)};return p}(),k=function(){function p(h){this._referenceEllipsoid=l.getReferenceEllipsoid(h)}p.prototype.compute=function(h,m,u,t,q){q||(q={near:0,far:0});h=g.length(h)-this._referenceEllipsoid.radius;h=Math.max(Math.abs(h-t),Math.abs(h));t=Math.sqrt(h*(h+2*(this._referenceEllipsoid.radius+Math.min(0,t))));h=b.clamp(2E4-(Math.log(h)-7.983)/9.011*19E3,1E3,2E4);return f(1.2*t,h,1,q)};return p}();const r=x.create(),y=x.create();a.createNearFarHeuristic=function(p,h,
m){return p===n.ViewingMode.Global?new k(m):new e(h,m)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/SurfaceCollisionConstraint":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../camera/constraintUtils ../camera/intersectionUtils ../camera/constraintUtils/surfaceCollision".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r){a.SurfaceCollisionConstraint=function(y){function p(m){m=y.call(this,m)||this;m.handles=new g;return m}b._inheritsLoose(p,y);var h=p.prototype;h.initialize=function(){this.handles.add(this.view.basemapTerrain.on("elevation-change",m=>this._handleElevationChangeEvent(m)))};h.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};h._handleElevationChangeEvent=function(m){this.view.state.cameraController||k.eyeWithinExtent(this.view,this.view.state.camera,
m.extent,m.spatialReference)&&this._applyToCurrentCamera()};h._applyToCurrentCamera=function(){this.view.state.updateCamera(m=>{r.applySurfaceCollisionConstraint(this.view,m,r.Mode.EYE_AND_CENTER)})};return p}(d);c.__decorate([x.property({constructOnly:!0})],a.SurfaceCollisionConstraint.prototype,"view",void 0);a.SurfaceCollisionConstraint=c.__decorate([f.subclass("esri.views.3d.state.ElevationCollisionConstraint")],a.SurfaceCollisionConstraint);a.default=a.SurfaceCollisionConstraint;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/state/GoToOperation":function(){define("exports ../../../Camera ../../../Viewpoint ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../core/watchUtils ../camera/constraintUtils ./controllers/CameraController ./controllers/PointToPointAnimationController ./controllers/SurfaceCollisionCorrectionController ../support/cameraUtils ../support/viewpointUtils ../camera/constraintUtils/surfaceCollision".split(" "),function(a,b,c,d,g,x,w,l,
n,f,e,k,r,y){let p=function(){function h(u,t,q){this.target=u;this.options=t;this.view=q;this.state="pending";this.animationController=this.abortController=null;this.promise=new Promise((z,v)=>{this.resolveCallback=z;this.rejectCallback=v;z=new AbortController;if(g.isSome(this.options.signal))x.onAbort(this.options.signal,()=>{this.abort()});this.abortController=z;this.waitForReady()})}var m=h.prototype;m.then=function(u,t){return this.promise.then(u,t)};m.catch=function(u){return this.promise.catch(u)};
m.resolve=function(u){this.state="finished";return this.resolveCallback(u)};m.reject=function(u){this.state="finished";return this.rejectCallback(u)};m.abort=function(u=!1){switch(this.state){case "pending":case "wait-for-ready":case "wait-for-viewpoint":this.reject(x.createAbortError());break;case "wait-for-animation-finish":!u&&g.isSome(this.animationController)&&this.view.state.cameraController===this.animationController&&this.animationController.active&&this.animationController.stopController(),
this.reject(x.createAbortError())}};m.waitForReady=function(){this.state="wait-for-ready";this.view.ready?this.createViewPoint():w.whenOnce(this.view,"ready",this.abortController.signal).then(()=>{this.createViewPoint()},u=>{this.reject(u)})};m.createViewPoint=function(){"finished"!==this.state&&(this.state="wait-for-viewpoint",this.animationController=this.options.animate?this._getAnimationController():null,r.create(this.view,this.target,this.abortController.signal).then(u=>{"finished"!==this.state&&
(u=this._getCameraFromViewpoint(u),g.isNone(u)||(this.options.animate?g.isNone(this.animationController)||this.startAnimation(u,this.animationController):(this.view.stateManager.setStateCamera(u.camera,{applyConstraints:!u.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve())))},u=>{this.reject(u)}))};m._getCameraFromViewpoint=function(u){const t=!!(this.target instanceof c&&this.target.camera||this.target instanceof b);var q=u.camera;if(g.isNone(q))return null;
if(!this.view.stateManager.isCompatible(q))return u=(u=q.position)&&u.spatialReference,this.reject(new d("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${u?u.wkid:"none"}, view: ${this.view.spatialReference.wkid})`,{camera:q})),null;q=k.externalToInternal(this.view,q);return g.isNone(q)?(this.reject(new d("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:u,camera:q,isFullySpecified:t}};m.startAnimation=function(u,
t){this.state="wait-for-animation-finish";const q=t.viewAnimation;if(g.isNone(q))this.reject(new d("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));else{q.update(u.viewpoint,"running");if(!t.active||g.isNone(t.viewAnimation)||t.viewAnimation.target!==u.viewpoint||this.view.state.cameraController!==t)return this.abort();if(u.isFullySpecified){var z=new e.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:u.camera});y.applySurfaceCollisionConstraint(this.view,
u.camera,y.Mode.EYE_AND_CENTER)}else l.applyAll(this.view,u.camera);t.begin(u.camera,this.options);var v=B=>{if(!g.isNone(this.view.state))switch(t.state){case n.State.Finished:switch(this.state){case "pending":case "wait-for-ready":case "wait-for-viewpoint":case "wait-for-animation-finish":this.resolve()}break;case n.State.Ready:case n.State.Rejected:case n.State.Running:case n.State.Stopped:switch(this.state){case "pending":case "wait-for-ready":case "wait-for-viewpoint":case "wait-for-animation-finish":this.reject(B)}}};
q.when(()=>{const B=this.view.state.cameraController;z&&(B&&B.active?B instanceof f.PointToPointAnimationController&&g.isSome(B.viewAnimation)&&B.viewAnimation.target===u.viewpoint&&(this.view.state.cameraController=z):g.isSome(t.viewAnimation)&&t.viewAnimation.target===u.viewpoint&&"finished"===t.state&&(this.view.state.cameraController=z))},B=>v(B));t.asyncResult={resolve:()=>v(),reject:B=>v(B)}}};m._getAnimationController=function(){let u;var t=null;t=this.view.state.cameraController;t instanceof
f.PointToPointAnimationController&&(t.updateStateFromViewAnimation(),t.active&&(u=t,t=u.viewAnimation));return null!=u||(u=new f.PointToPointAnimationController({view:this.view,mode:"animation"}),t=u.viewAnimation,this.view.state.switchCameraController(u))?u:(g.isSome(t)&&t.stop(),this.reject(new d("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)};return h}();a.GoToOperation=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/SurfaceCollisionCorrectionController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Handles ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../camera/constraintUtils ../../camera/intersectionUtils ./CameraController ../../camera/constraintUtils/surfaceCollision".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r){a.SurfaceCollisionCorrectionController=function(y){function p(m){m=y.call(this,m)||this;m.handles=new d;return m}b._inheritsLoose(p,y);var h=p.prototype;h.onControllerStart=function(){this.state=k.State.Running;this.handles.add(this.view.basemapTerrain.on("elevation-change",m=>this._handleElevationChangeEvent(m)));this._applyCorrection()};h.onControllerEnd=function(){this.handles.removeAll()};h.stepController=function(){};h._handleElevationChangeEvent=function(m){e.eyeWithinExtent(this.view,
this.desiredCamera,m.extent,m.spatialReference)&&this._applyCorrection()};h._applyCorrection=function(){this.view.state.updateCamera(m=>{m.copyViewFrom(this.desiredCamera);r.applySurfaceCollisionConstraint(this.view,m,r.Mode.EYE_AND_CENTER)||this.constraintEnabled||(this.state=k.State.Stopped)})};b._createClass(p,[{key:"desiredCamera",set:function(m){this._set("desiredCamera",m.clone())}},{key:"canStop",get:function(){return!0}},{key:"constraintEnabled",get:function(){return this.view.state.constraints.collision.enabled}}]);
return p}(k.CameraController);c.__decorate([g.property({constructOnly:!0})],a.SurfaceCollisionCorrectionController.prototype,"view",void 0);c.__decorate([g.property({constructOnly:!0})],a.SurfaceCollisionCorrectionController.prototype,"desiredCamera",null);a.SurfaceCollisionCorrectionController=c.__decorate([n.subclass("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],a.SurfaceCollisionCorrectionController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/helpers/SceneIntersectionHelper":function(){define("exports ../../../../core/maybe ../../../../core/PooledArray ../../../../core/screenUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/ray ../../../../geometry/support/vectorStacks ../../../ViewingMode ../../support/geometryUtils/ray ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/intersectorUtils".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r){function y(q){h&&h.viewingMode===q||(h=e.newIntersector(q));return h}let p=function(){function q(v,B,A){this.viewingMode=v;this._forEachLayer=B;this.view=A;this.externalIntersectionHandlers=new c;this.tolerance=e.DEFAULT_TOLERANCE;this.tmpRay=w.create();this.validateHUDIntersector=e.newIntersector(this.viewingMode);this.validateHUDIntersector.options.hud=!1}var z=q.prototype;z.intersectScreen=function(v,B){return this.intersectRay(this._getPickRay(v,this.tmpRay),
y(this.viewingMode),B)};z.intersectScreenFreePointFallback=function(v,B){return this.intersectRayFreePointFallback(this._getPickRay(v,this.tmpRay),B)};z.intersectRayFreePointFallback=function(v,B){return this.intersectRay(v,y(this.viewingMode),B)||this._intersectRayFreePointLocal(v,B)};z.intersectRay=function(v,B,A,E){B.options.selectionMode=!1;B.options.store=k.StoreResults.MIN;this.computeIntersection(v,B,E);return B.results.min?B.results.min.getIntersectionPoint(A):!1};z.getCenterRayWithSubpixelOffset=
function(v,B,A=.5,E=.5){v.getRenderCenter(t,A,E);t[0]+=.0466;t[1]-=.0123;return f.fromRenderAtEye(v,t,B)};z.intersectIntersectorScreen=function(v,B,A){this.computeIntersection(this._getPickRay(v,this.tmpRay),B,A)};z.intersectToolIntersectorScreen=function(v,B,A){v=this._getPickRay(v,this.tmpRay);this.intersectToolIntersectorRay(v,B,A)};z.intersectToolIntersectorRay=function(v,B,A){B.options.selectionMode=!0;this.computeIntersection(v,B,A);const E=B.results.min;this.view.basemapTerrain&&this.view.basemapTerrain.opaque||
r.isValidIntersectorResult(E)&&E.intersector!==k.IntersectorType.TERRAIN||(B.options.selectionMode=!1,this.computeIntersection(v,B,A))};z.setTolerance=function(v=e.DEFAULT_TOLERANCE){this.tolerance=v};z.addIntersectionHandler=function(v){this.externalIntersectionHandlers.push(v);this.externalIntersectionHandlers.sort((B,A)=>B.type===k.IntersectorType.TERRAIN?1:A.type===k.IntersectorType.TERRAIN?-1:0)};z.removeIntersectionHandler=function(v){this.externalIntersectionHandlers.removeUnordered(v);this.externalIntersectionHandlers.sort((B,
A)=>B.type===k.IntersectorType.TERRAIN?1:A.type===k.IntersectorType.TERRAIN?-1:0)};z._getPickRay=function(v,B){return f.fromScreen(this.view.state.camera,v,B)};z._intersectRayFreePointLocal=function(v,B){if(this.viewingMode!==n.ViewingMode.Local||b.isNone(v))return!1;var A=this.view.renderDataExtent;if(b.isNone(A))return g.add(B,v.origin,g.normalize(l.sv3d.get(),v.direction)),!0;var E=Math.max(A.xmax-A.xmin,A.ymax-A.ymin,8*Math.max(A.xmax-A.xmin,A.ymax-A.ymin));if(0===E)return g.add(B,v.origin,g.normalize(l.sv3d.get(),
v.direction)),!0;var C=this.view.state.camera;const D=Math.max(0,A.xmin-C.eye[0],C.eye[0]-A.xmax);A=Math.max(0,A.ymin-C.eye[1],C.eye[1]-A.ymax);C=E/Math.max(1,Math.max(0,Math.log(E/(Math.abs(C.relativeElevation)+Number.MIN_VALUE)))**2);C=Math.max(C,Math.min(Math.sqrt(D*D+A*A),E));E=g.scale(l.sv3d.get(),v.direction,C/g.length(v.direction));g.add(B,v.origin,E);return!0};z.intersectElevationFromScreen=function(v,B,A=0,E=null){return this._intersectElevation(this._getPickRay(v,this.tmpRay),B,A,E)};z._intersectElevation=
function(v,B,A=0,E=null){if(b.isNone(v))return null;var C=b.isSome(B)?B.mode:"absolute-height",D=b.isSome(B)?b.unwrapOr(B.offset,0):0,F="on-the-ground"!==C?D+A:0;B=F/this.view.renderCoordsHelper.unitInMeters;if("absolute-height"===C)return this.view.renderCoordsHelper.intersectInfiniteManifold(v,F,u)?(A=this.view.computeMapPointFromVec3d(u),A.z-=D,A):null;D=this.view.state.camera;const G=d.castRenderScreenPointArray3(l.sv3d.get());D.projectToRenderScreen(v.origin,G);F=new m(null,this._forEachLayer);
const J=this.view.slicePlane,I=b.isSome(J)?r.sliceFilterPredicate(J):null,O=e.newIntersector(this.viewingMode);O.options.store=k.StoreResults.MIN;O.options.verticalOffset=B;B=v.origin;v=g.add(l.sv3d.get(),B,v.direction);O.reset(B,v,D);O.point=G;const P=b.isSome(E)?"type"in E&&"graphics"===E.type?K=>K.metadata.layerUid!==E.uid:K=>K.metadata.graphicUid!==E.uid:null;switch(C){case "relative-to-scene":O.intersect(F.layers,G,this.tolerance,null,K=>(b.isNone(P)||P(K))&&K.metadata&&K.metadata.isElevationSource);
this.externalIntersectionHandlers.forAll(K=>{K.type!==k.IntersectorType.I3S&&K.type!==k.IntersectorType.TERRAIN||K.intersect(O,K.slicePlaneEnabled?I:null,O.rayBegin,O.rayEnd,G)});break;case "on-the-ground":case "relative-to-ground":this.externalIntersectionHandlers.forAll(K=>{K.isGround&&K.intersect(O,K.slicePlaneEnabled?I:null,O.rayBegin,O.rayEnd,G)})}return O.results.min.getIntersectionPoint(u)?(C=this.view.computeMapPointFromVec3d(u),C.z=A,C):null};z.computeIntersection=function(v,B,A){if(!b.isNone(v)){var E=
this.view.state.camera,C=d.castRenderScreenPointArray3(l.sv3d.get());E.projectToRenderScreen(v.origin,C);var D=new m(A,this._forEachLayer);B.options.selectOpaqueTerrainOnly=!A||!("include"in A||"exclude"in A);var F=v.origin,G=g.add(l.sv3d.get(),v.origin,v.direction);B.reset(F,G,E);B.intersect(D.layers,C,this.tolerance);v=this.view.slicePlane;var J=b.isSome(v)?r.sliceFilterPredicate(v):null;B.intersect(D.sliceableLayers,C,this.tolerance,J);var I=A&&(A.requiresGroundFeedback||A.enableDraped);this.externalIntersectionHandlers.forAll(O=>
{B.options.isFiltered=!D.filterLayerUid(O.layerUid);(O.isGround&&I||!B.options.isFiltered)&&O.intersect(B,O.slicePlaneEnabled?J:null,F,G,C)});v=l.sv3d.get();if(A&&A.enableDraped&&B.results.ground.getIntersectionPoint(v)){A=this.view.basemapTerrain.overlayManager.renderer;const O=this.view.renderCoordsHelper.spatialReference,P=l.sv3d.get();this.view.renderCoordsHelper.fromRenderCoords(v,P,this.view.spatialReference);P[2]=b.unwrapOr(this.view.elevationProvider.getElevation(v[0],v[1],v[2],O,"ground"),
0);A.intersect(B,P,B.results.ground,K=>D.filterRenderGeometry(K))}B.sortResults();v=B.results.hud;if(r.isHudIntersectorResult(v)){const O=d.castRenderScreenPointArray3(l.sv3d.get()),P=l.sv3d.get(),K=l.sv3d.get();this._unprojectHUDResultRay(v.target.center,O,P,K);A=g.distance(v.target.center,P)/g.distance(P,K)*.99;this.validateHUDIntersector.reset(P,K,E);this.validateHUDIntersector.intersect(D.layers,O,this.tolerance);this.validateHUDIntersector.intersect(D.sliceableLayers,O,this.tolerance,J);this.externalIntersectionHandlers.forAll(M=>
{D.filterLayerUid(M.layerUid)&&M.intersect(this.validateHUDIntersector,M.slicePlaneEnabled?J:null,P,K,O)});E=this.validateHUDIntersector.results.min;if(null==E.dist||A<=E.dist)B.results.min.copy(v),B.results.all.splice(0,0,v)}}};z._unprojectHUDResultRay=function(v,B,A,E){const C=this.view.state.camera;C.projectToRenderScreen(v,B);v=d.castRenderScreenPointArray3(l.sv3d.get());v[0]=B[0];v[1]=B[1];v[2]=0;C.unprojectFromRenderScreen(v,A);v[2]=1;C.unprojectFromRenderScreen(v,E)};return q}(),h,m=function(){function q(v,
B){this.layers=[];this.sliceableLayers=[];this.include=null==v?void 0:v.include;this.exclude=null==v?void 0:v.exclude;B(A=>{A.isPickable&&this.filterLayerUid(A.apiLayerUid)&&(A.isSliceable?this.sliceableLayers:this.layers).push(A)})}var z=q.prototype;z.filterLayerUid=function(v){const {include:B,exclude:A}=this;return b.isNone(v)?null==B&&null==A:(null==B||B.has(v))&&(null==A||!A.has(v))};z.filterRenderGeometry=function(v){return this.filterLayerUid(v.layerUid)};return q}();const u=x.create(),t=d.createRenderScreenPointArray3();
a.SceneIntersectionHelper=p;a.isIntersectionHandler=function(q){return"object"===typeof q&&"intersect"in q};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/CombinedElevationProvider":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Evented ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../layers/graphics/ElevationQuery".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r){function y(p,h,m,u,t,q,z){for(const v of h)h=v.getElevation(m,u,t,q,z),x.isSome(h)&&(p=x.isSome(p)?Math.max(h,p):h);return p}a.CombinedElevationProvider=function(p){function h(u){u=p.call(this,u)||this;u.im=[];u.ground=[];u.scene=[];u.handles=new Map;u.lastElevationQuery=null;u.elevationCacheEnabled=!1;return u}b._inheritsLoose(h,p);var m=h.prototype;m.destroy=function(){this._elevationQuery=x.destroyMaybe(this._elevationQuery)};m.enableElevationCache=function(u){u||
(this.lastElevationQuery=null);this.elevationCacheEnabled=u};m.getElevation=function(u,t,q,z,v){if(this.elevationCacheEnabled&&null!=this.lastElevationQuery){var B=this.lastElevationQuery;if(u===B.x&&t===B.y&&q===B.z&&z.equals(B.spatialReference)&&v===B.queryContext)return B.result}B=y(null,this.im,u,t,q,z,v);x.isNone(B)&&(B=y(B,this.ground,u,t,q,z,v));"scene"===v&&(B=y(B,this.scene,u,t,q,z,v));this.elevationCacheEnabled&&(this.lastElevationQuery={x:u,y:t,z:q,spatialReference:z,queryContext:v,result:B});
return B};m.queryElevation=function(u,t,q,z,v,B=null,A=0){const E=w.createResolver();this.elevationQuery.queryElevation(u,t,B,A).then(C=>{"scene"===v&&(C=y(C,this.scene,u,t,q,z,v));E.resolve(C)}).catch(C=>{w.isAbortError(C)?E.reject(C):E.resolve(this.getElevation(u,t,q,z,v))});return E.promise};m.register=function(u,t){this.handles.set(t,t.on("elevation-change",q=>this.emit("elevation-change",q)));this[u].push(t)};m.unregister=function(u){this.handles.has(u)&&(this.handles.get(u).remove(),this.handles.delete(u));
for(const t of[this.im,this.ground,this.scene]){const q=t.indexOf(u);-1<q&&t.splice(q,1)}};b._createClass(h,[{key:"elevationQuery",get:function(){x.isNone(this._elevationQuery)&&(this._elevationQuery=new r.ElevationQuery(this.view.resourceController.scheduler,this.view.spatialReference,()=>this.view.map&&this.view.map.ground,{maximumAutoTileRequests:4}));return this._elevationQuery}}]);return h}(g.EventedMixin(d));c.__decorate([l.property({constructOnly:!0})],a.CombinedElevationProvider.prototype,
"view",void 0);c.__decorate([l.property({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],a.CombinedElevationProvider.prototype,"spatialReference",void 0);a.CombinedElevationProvider=c.__decorate([k.subclass("esri.views.3d.support.CombinedElevationProvider")],a.CombinedElevationProvider);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/ElevationQuery":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry ../../../../core/arrayUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../support/Scheduler ../../../../geometry/Multipoint".split(" "),
function(a,b,c,d,g,x,w,l){c=function(){function f(k,r){this.spatialReference=k;this.view=r}var e=f.prototype;e.getElevation=function(k,r,y){return this.view.elevationProvider.getElevation(k,r,0,this.spatialReference,y)};e.queryElevation=function(){var k=b._asyncToGenerator(function*(r,y,p,h,m){return this.view.elevationProvider.queryElevation(r,y,0,this.spatialReference,m,p,h)});return function(r,y,p,h,m){return k.apply(this,arguments)}}();return f}();let n=function(){function f(k,r,y,p){this.spatialReference=
r;this._getElevationQueryProvider=y;this._queries=[];this._queryOptions={...p,ignoreInvisibleLayers:!0};this._frameTask=k.registerTask(w.TaskPriority.ELEVATION_QUERY,this)}var e=f.prototype;e.destroy=function(){this._frameTask.remove()};e.queryElevation=function(k,r,y,p=0){return new Promise((h,m)=>{const u={x:k,y:r,minDemResolution:p,result:{resolve:h,reject:m},signal:y};this._queries.push(u);x.onAbort(y,()=>{d.remove(this._queries,u);m(x.createAbortError())})})};e.runTask=function(){const k=this._queries;
this._queries=[];const r=this._getElevationQueryProvider();if(r){var y=k.map(u=>[u.x,u.y]),p=k.reduce((u,t)=>Math.min(u,t.minDemResolution),Infinity);y=new l({points:y,spatialReference:this.spatialReference});var h=1<k.length&&k.some(u=>!!u.signal)?new AbortController:null,m=g.isSome(h)?h.signal:k[0].signal;if(g.isSome(h)){let u=0;k.forEach(t=>x.onAbort(t.signal,()=>{u++;t.result.reject(x.createAbortError());u===k.length&&h.abort()}))}r.queryElevation(y,{...this._queryOptions,minDemResolution:p,signal:m}).then(u=>
{k.forEach((t,q)=>{g.isSome(t.signal)&&t.signal.aborted?t.result.reject(x.createAbortError()):t.result.resolve(u.geometry.points[q][2])})}).catch(u=>{k.forEach(t=>t.result.reject(u))})}else k.forEach(u=>u.result.reject())};b._createClass(f,[{key:"running",get:function(){return 0<this._queries.length}},{key:"test",get:function(){const k=this;return{update:()=>0<k._queries.length&&k.runTask()}}}]);return f}();a.ElevationQuery=n;a.ViewElevationProvider=c;Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/support/DisplayQualityProfile":function(){define(["../../../core/has"],function(a){function b(){const d=!!a("esri-mobile"),g=!!a("ios");return{low:{graphics3D:{maxTotalNumberOfFeatures:25E3,maxTotalNumberOfPrimitives:85E4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25E3},sceneService:{"3dObject":{lodFactor:.2,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:0},point:{lodFactor:1},integratedMesh:{lodFactor:.6},
pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:0},antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5E4,maxTotalNumberOfPrimitives:17E5,polygonLodFactor:d?.8:1,polylineLodFactor:d?1.2:1.5,snapshotAvailable:!g},
heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5E4},sceneService:{"3dObject":{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:400},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:d},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!a("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,
memoryLimit:d?600:750,additionalCacheMemory:d?0:150,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5E4,maxTotalNumberOfPrimitives:17E5,polygonLodFactor:d?1.2:2,polylineLodFactor:d?1.2:2,snapshotAvailable:!g},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5E4},sceneService:{"3dObject":{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:400},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},
uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!a("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:d?900:1500,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:d?null:4096,maximumPixelRatio:d?1:null}}}let c=function(){function d(){}d.isValidProfile=function(g){return g in d.profiles};d.getDefaultProfile=function(){return a("trident")||
a("esri-iPhone")?"low":"medium"};d.apply=function(g,x){g=d.profiles[g];x.graphics3D.maxTotalNumberOfFeatures=g.graphics3D.maxTotalNumberOfFeatures;x.graphics3D.maxTotalNumberOfPrimitives=g.graphics3D.maxTotalNumberOfPrimitives;x.graphics3D.polygonLodFactor=g.graphics3D.polygonLodFactor;x.graphics3D.polylineLodFactor=g.graphics3D.polylineLodFactor;x.graphics3D.snapshotAvailable=g.graphics3D.snapshotAvailable;{const w=x.sceneService["3dObject"],l=g.sceneService["3dObject"];w.lodFactor=l.lodFactor;w.lodCrossfadeinDuration=
l.lodCrossfadeinDuration;w.lodCrossfadeoutDuration=l.lodCrossfadeoutDuration;w.lodCrossfadeUncoveredDuration=l.lodCrossfadeUncoveredDuration}x.sceneService.point.lodFactor=g.sceneService.point.lodFactor;x.sceneService.integratedMesh.lodFactor=g.sceneService.integratedMesh.lodFactor;x.sceneService.pointCloud.lodFactor=g.sceneService.pointCloud.lodFactor;x.sceneService.uncompressedTextureDownsamplingEnabled=g.sceneService.uncompressedTextureDownsamplingEnabled;x.tiledSurface.lodBias=g.tiledSurface.lodBias;
x.tiledSurface.angledSplitBias=g.tiledSurface.angledSplitBias;x.tiledSurface.reduceTileLevelDifferences=g.tiledSurface.reduceTileLevelDifferences;x.tiledSurface.textureFadeDuration=g.tiledSurface.textureFadeDuration;x.heatmap.pixelRatio=g.heatmap.pixelRatio;x.heatmap.maxTotalNumberOfFeatures=g.heatmap.maxTotalNumberOfFeatures;x.antialiasingEnabled=g.antialiasingEnabled;x.physicallyBasedRenderingEnabled=g.physicalBasedRenderingEnabled;x.highQualityTransparency=g.highQualityTransparency;x.memoryLimit=
g.memoryLimit;x.additionalCacheMemory=g.additionalCacheMemory;x.frameRate=g.frameRate;x.maximumRenderResolution=g.maximumRenderResolution;x.maximumPixelRatio=g.maximumPixelRatio};return d}();c.debug={reset(){const d=b();for(const g in d)c.profiles[g]=d[g]}};(c||(c={})).profiles=b();return c})},"esri/views/3d/support/HighlightOptions":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec4f32".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e){d=function(k){function r(){var y=k.apply(this,arguments)||this;y.color=new c([0,255,255]);y.haloColor=null;y.haloOpacity=1;y.fillOpacity=.25;y.shadowOpacity=.4;y.shadowColor=new c([0,0,0]);y.shadowDifference=.2;return y}a._inheritsLoose(r,k);r.toEngineOptions=function(y){const p=c.toUnitRGBA(y.color),h=g.isSome(y.haloColor)?c.toUnitRGBA(y.haloColor):p,m=c.toUnitRGBA(y.shadowColor);return{color:e.fromValues(p[0],p[1],p[2],p[3]),haloColor:e.fromValues(h[0],h[1],h[2],
h[3]),haloOpacity:y.haloOpacity,haloOpacityOccluded:.25*y.haloOpacity,fillOpacity:y.fillOpacity,fillOpacityOccluded:.25*y.fillOpacity,shadowOpacity:y.shadowOpacity,shadowColor:e.fromValues(m[0],m[1],m[2],m[3]),occludedShadowOpacity:y.shadowOpacity*(1-y.shadowDifference)}};return r}(d);b.__decorate([x.property({type:c})],d.prototype,"color",void 0);b.__decorate([x.property({type:c})],d.prototype,"haloColor",void 0);b.__decorate([x.property()],d.prototype,"haloOpacity",void 0);b.__decorate([x.property()],
d.prototype,"fillOpacity",void 0);b.__decorate([x.property()],d.prototype,"shadowOpacity",void 0);b.__decorate([x.property({type:c})],d.prototype,"shadowColor",void 0);b.__decorate([x.property()],d.prototype,"shadowDifference",void 0);return d=b.__decorate([f.subclass("esri.views.3d.support.HighlightOptions")],d)})},"esri/chunks/vec4f32":function(){define(["exports"],function(a){function b(){return new Float32Array(4)}function c(t){const q=new Float32Array(4);q[0]=t[0];q[1]=t[1];q[2]=t[2];q[3]=t[3];
return q}function d(t,q,z,v){const B=new Float32Array(4);B[0]=t;B[1]=q;B[2]=z;B[3]=v;return B}function g(t,q){return new Float32Array(t,q,4)}function x(){return b()}function w(){return d(1,1,1,1)}function l(){return d(1,0,0,0)}function n(){return d(0,1,0,0)}function f(){return d(0,0,1,0)}function e(){return d(0,0,0,1)}const k=b(),r=w(),y=l(),p=n(),h=f(),m=e(),u=Object.freeze({__proto__:null,create:b,clone:c,fromValues:d,createView:g,zeros:x,ones:w,unitX:l,unitY:n,unitZ:f,unitW:e,ZEROS:k,ONES:r,UNIT_X:y,
UNIT_Y:p,UNIT_Z:h,UNIT_W:m});a.ONES=r;a.UNIT_W=m;a.UNIT_X=y;a.UNIT_Y=p;a.UNIT_Z=h;a.ZEROS=k;a.clone=c;a.create=b;a.createView=g;a.fromValues=d;a.ones=w;a.unitW=e;a.unitX=l;a.unitY=n;a.unitZ=f;a.vec4f32=u;a.zeros=x})},"esri/views/3d/support/MapCoordsHelper":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry ../../../core/Error ../../../core/unitUtils ../../../geometry/projectionEllipsoid ../../../portal/support/geometryServiceUtils ../../../rest/geometryService/project ../../../rest/support/ProjectParameters ../../../geometry/Point ../../../geometry/SpatialReference".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e){c=function(){function k(r,y){this.spatialReference=y;this.unitInMeters=g.getMetersPerUnitForSR(this.spatialReference,x.getReferenceEllipsoid(this.spatialReference).metersPerDegree);this._geometryServiceURLPromise=w.getGeometryServiceURL(r&&r.get("portalItem")).catch(()=>{throw new d("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config");})}k.prototype.toGeographic=function(){var r=b._asyncToGenerator(function*(y){var p=yield this._geometryServiceURLPromise;
let h=!0;Array.isArray(y[0])&&"number"!==typeof y[0]||(y=[y],h=!1);y=y.map(m=>m instanceof f?m:new f(m,this.spatialReference));y=new n({geometries:y,outSpatialReference:e.WGS84});p=(yield l.project(p,y)).map(m=>"point"===m.type?[m.x,m.y]:void 0);return h?p:p[0]});return function(y){return r.apply(this,arguments)}}();return k}();a.MapCoordsHelper=c;a.default=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/portal/support/geometryServiceUtils":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../config ../../core/Error ../Portal ../../rest/geometryService/project ../../rest/support/ProjectParameters".split(" "),
function(a,b,c,d,g,x,w){function l(){return n.apply(this,arguments)}function n(){n=b._asyncToGenerator(function*(e=null,k){var r,y;if(c.geometryServiceUrl)return c.geometryServiceUrl;if(!e)throw new d("internal:geometry-service-url-not-configured");e="portal"in e?e.portal||g.getDefault():e;yield e.load({signal:k});k=null==(r=e.helperServices)?void 0:null==(y=r.geometry)?void 0:y.url;if(!k)throw new d("internal:geometry-service-url-not-configured");return k});return n.apply(this,arguments)}function f(){f=
b._asyncToGenerator(function*(e,k,r=null,y){r=yield l(r,y);const p=new w;p.geometries=[e];p.outSpatialReference=k;if((e=yield x.project(r,p,{signal:y}))&&Array.isArray(e)&&1===e.length)return e[0];throw new d("internal:geometry-service-projection-failed");});return f.apply(this,arguments)}a.getGeometryServiceURL=l;a.projectGeometry=function(e,k){return f.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/QualitySettings":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,d,g,x,w,l){let n=function(p){function h(){var m=p.apply(this,arguments)||this;m.minTotalNumberOfFeatures=2E3;m.maxTotalNumberOfFeatures=5E4;m.maxTotalNumberOfPrimitives=17E5;m.snapshotAvailable=!0;m.polygonLodFactor=1;m.polylineLodFactor=1;return m}a._inheritsLoose(h,p);return h}(c);b.__decorate([d.property()],n.prototype,"minTotalNumberOfFeatures",void 0);b.__decorate([d.property()],n.prototype,"maxTotalNumberOfFeatures",void 0);b.__decorate([d.property()],n.prototype,"maxTotalNumberOfPrimitives",
void 0);b.__decorate([d.property()],n.prototype,"snapshotAvailable",void 0);b.__decorate([d.property()],n.prototype,"polygonLodFactor",void 0);b.__decorate([d.property()],n.prototype,"polylineLodFactor",void 0);n=b.__decorate([l.subclass("esri.views.3d.support.QualitySettings.Graphics3DSettings")],n);let f=function(p){function h(){var m=p.apply(this,arguments)||this;m.lodFactor=1;return m}a._inheritsLoose(h,p);return h}(c);b.__decorate([d.property()],f.prototype,"lodFactor",void 0);f=b.__decorate([l.subclass("esri.views.3d.support.QualitySettings.LoDFactorSettings")],
f);let e=function(p){function h(){var m=p.apply(this,arguments)||this;m.lodCrossfadeinDuration=0;m.lodCrossfadeoutDuration=0;m.lodCrossfadeUncoveredDuration=0;return m}a._inheritsLoose(h,p);return h}(f);e=b.__decorate([l.subclass("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],e);let k=function(p){function h(){var m=p.apply(this,arguments)||this;m["3dObject"]=new e;m.point=new f;m.integratedMesh=new f;m.pointCloud=new f;m.uncompressedTextureDownsamplingEnabled=!1;return m}a._inheritsLoose(h,
p);return h}(c);b.__decorate([d.property({type:e})],k.prototype,"3dObject",void 0);b.__decorate([d.property({type:f})],k.prototype,"point",void 0);b.__decorate([d.property({type:f})],k.prototype,"integratedMesh",void 0);b.__decorate([d.property({type:f})],k.prototype,"pointCloud",void 0);b.__decorate([d.property()],k.prototype,"uncompressedTextureDownsamplingEnabled",void 0);k=b.__decorate([l.subclass("esri.views.3d.support.QualitySettings.SceneServiceSettings")],k);let r=function(p){function h(){var m=
p.apply(this,arguments)||this;m.lodBias=0;m.angledSplitBias=1;m.reduceTileLevelDifferences=!0;m.textureFadeDuration=500;return m}a._inheritsLoose(h,p);return h}(c);b.__decorate([d.property()],r.prototype,"lodBias",void 0);b.__decorate([d.property()],r.prototype,"angledSplitBias",void 0);b.__decorate([d.property()],r.prototype,"reduceTileLevelDifferences",void 0);b.__decorate([d.property()],r.prototype,"textureFadeDuration",void 0);r=b.__decorate([l.subclass("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],
r);let y=function(p){function h(){var m=p.apply(this,arguments)||this;m.pixelRatio=1;m.maxTotalNumberOfFeatures=5E4;return m}a._inheritsLoose(h,p);return h}(c);b.__decorate([d.property()],y.prototype,"pixelRatio",void 0);b.__decorate([d.property()],y.prototype,"maxTotalNumberOfFeatures",void 0);y=b.__decorate([l.subclass("esri.views.3d.support.QualitySettings.HeatmapSettings")],y);c=function(p){function h(){var m=p.apply(this,arguments)||this;m.graphics3D=new n;m.sceneService=new k;m.tiledSurface=
new r;m.heatmap=new y;m.antialiasingEnabled=!0;m.physicallyBasedRenderingEnabled=!1;m.highQualityTransparency=!0;return m}a._inheritsLoose(h,p);return h}(c);b.__decorate([d.property({type:n})],c.prototype,"graphics3D",void 0);b.__decorate([d.property({type:k})],c.prototype,"sceneService",void 0);b.__decorate([d.property({type:r})],c.prototype,"tiledSurface",void 0);b.__decorate([d.property({type:y})],c.prototype,"heatmap",void 0);b.__decorate([d.property()],c.prototype,"antialiasingEnabled",void 0);
b.__decorate([d.property()],c.prototype,"physicallyBasedRenderingEnabled",void 0);b.__decorate([d.property()],c.prototype,"highQualityTransparency",void 0);b.__decorate([d.property()],c.prototype,"memoryLimit",void 0);b.__decorate([d.property()],c.prototype,"additionalCacheMemory",void 0);b.__decorate([d.property()],c.prototype,"frameRate",void 0);b.__decorate([d.property()],c.prototype,"maximumRenderResolution",void 0);b.__decorate([d.property()],c.prototype,"maximumPixelRatio",void 0);return c=
b.__decorate([l.subclass("esri.views.3d.support.QualitySettings.QualitySettings")],c)})},"esri/views/3d/support/RenderCoordsHelper":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../core/unitUtils ../../../chunks/mat4 ../../../chunks/vec3 ../../../geometry/projection ../../../geometry/SpatialReference ../../../geometry/support/Axis ../../../geometry/support/coordinateSystem ../../../geometry/support/plane ../../../geometry/support/vectorStacks ../../../layers/graphics/dehydratedFeatureUtils ../../ViewingMode ../../support/spatialReferenceSupport".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p){function h(u){if(p.isSpatialReferenceSupported(u,y.ViewingMode.Global))return 1;u=f.renderSRFromViewSR(!1,u);return d.getMetersPerUnitForSR(u)}let m=function(){function u(q,z,v,B){this.viewingMode=q;this.spatialReference=z;this.unitInMeters=v;this.coordinateSystem=B;this._coordinateSystem=f.create(B)}var t=u.prototype;t.getAltitude=function(q){return f.altitudeAt(this.coordinateSystem,q)};t.setAltitude=function(q,z,v=q){return f.setAltitudeAt(this.coordinateSystem,
v,z,q)};t.setAltitudeOfTransformation=function(q,z){f.setAltitudeOfTransformation(this.coordinateSystem,z,q,z)};t.worldUpAtPosition=function(q,z){return f.normalAt(this.coordinateSystem,q,z)};t.worldBasisAtPosition=function(q,z,v){return f.axisAt(this.coordinateSystem,q,z,v)};t.basisMatrixAtPosition=function(q,z){const v=this.worldBasisAtPosition(q,n.Axis.X,k.sv3d.get()),B=this.worldBasisAtPosition(q,n.Axis.Y,k.sv3d.get());q=this.worldBasisAtPosition(q,n.Axis.Z,k.sv3d.get());g.set(z,v[0],v[1],v[2],
0,B[0],B[1],B[2],0,q[0],q[1],q[2],0,0,0,0,1);return z};t.intersectManifoldClosestSilhouette=function(q,z,v){f.elevate(this.coordinateSystem,z,this._coordinateSystem);f.intersectRayClosestSilhouette(this._coordinateSystem,q,v);return v};t.intersectManifold=function(q,z,v){f.elevate(this.coordinateSystem,z,this._coordinateSystem);z=k.sv3d.get();return f.intersectRay(this._coordinateSystem,q,z)?x.copy(v,z):null};t.intersectInfiniteManifold=function(q,z,v){if(this.viewingMode===y.ViewingMode.Global)return this.intersectManifold(q,
z,v);f.elevate(this.coordinateSystem,z,this._coordinateSystem);z=this._coordinateSystem.value;const B=k.sv3d.get();return e.intersectRay(z.plane,q,B)?x.copy(v,B):null};t.toRenderCoords=function(q,z,v){return r.isDehydratedPoint(q)?w.projectPointToVector(q,z,this.spatialReference):w.projectVectorToVector(q,z,v,this.spatialReference)};t.fromRenderCoords=function(q,z,v=null){return r.isDehydratedPoint(z)?(c.isSome(v)&&(z.spatialReference=v),w.projectVectorToDehydratedPoint(q,this.spatialReference,z)):
z instanceof l?w.projectVectorToPoint(q,this.spatialReference,z):w.projectVectorToVector(q,this.spatialReference,z,v)?z:null};u.create=function(q,z){switch(q){case y.ViewingMode.Local:return new u(y.ViewingMode.Local,z,d.getMetersPerUnitForSR(z),f.createLocal());case y.ViewingMode.Global:return new u(y.ViewingMode.Global,z,1,f.createGlobal(z))}};u.renderUnitScaleFactor=function(q,z){return h(q)/h(z)};b._createClass(u,[{key:"extent",set:function(q){q&&f.setExtent(this.coordinateSystem,q,this.coordinateSystem)}}]);
return u}();a.RenderCoordsHelper=m;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/ResourceController":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/scheduling ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./index ./MemoryController ./StreamDataLoader ../../support/Scheduler".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m){a.ResourceControllerMain=function(t){function q(){var z=t.apply(this,arguments)||this;z.updating=!1;return z}b._inheritsLoose(q,t);return q}(d);c.__decorate([n.property({readOnly:!0})],a.ResourceControllerMain.prototype,"updating",void 0);a.ResourceControllerMain=c.__decorate([r.subclass("esri.views.3d.support.ResourceController")],a.ResourceControllerMain);var u;(function(t){let q=function(z){function v(){var A=z.apply(this,arguments)||this;A._scheduler=
null;A._memoryController=null;A._streamDataLoader=null;A._cameraChangeTime=0;A._handles=new g;A._frameTask=null;A._scheduleTask=m.ImmediateTask;A._state=m.State.IDLE;return A}b._inheritsLoose(v,z);var B=v.prototype;B.initialize=function(){this._cameraChangeTime=this.now();this._scheduler=m.newScheduler(this.now);this._memoryController=p.newMemoryController(this.view);this._streamDataLoader=new h.StreamDataLoader;this._streamDataLoader.setup(y.maxDownloadSlots,y.downloadSlotsPerClient,this._scheduler);
this._handles.add([this.view.watch("state.camera",(A,E)=>this._cameraChangedHandler(A,E),!0),this.view.watch("stationary",()=>this._stationaryChangedHandler()),this._memoryController.events.on("updating-changed",()=>this.notifyChange("updating"))]);this._frameTask=w.addFrameTask({update:A=>this._frame(A)});this._scheduleTask=this._scheduler.registerTask(m.TaskPriority.RESOURCE_CONTROLLER)};B.destroy=function(){this._handles=x.destroyMaybe(this._handles);this._scheduleTask.remove();this._frameTask=
x.removeMaybe(this._frameTask);this._streamDataLoader=x.destroyMaybe(this._streamDataLoader);this._memoryController=x.destroyMaybe(this._memoryController);this._scheduler=x.destroyMaybe(this._scheduler)};B.schedule=function(A,E,C){return this._scheduleTask.schedule(A,E,C)};B.createStreamDataRequester=function(A){const E=this._streamDataLoader;return{request(C,D,F){return E.request(C,D,A,F)},get busy(){return!E.hasDownloadSlots(A)}}};B._frame=function(A){if(!this.view.suspended){if(this.view.stateManager&&
(this.view.stateManager.step(l.secondsFromMilliseconds(A.deltaTime)),!this._scheduler))return;this._updateState();this._scheduler.state=this._state;this._scheduler.updateBudget(A)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update()}};B._cameraChangedHandler=function(A,E){A&&E&&A.almostEquals(E)||(this._cameraChangeTime=this._scheduler.now,this._updateState(),this._scheduler.state=this._state)};B._stationaryChangedHandler=function(){this.memoryController.resetStableQuality()};
B._updateState=function(){this.view.animation?this._state=m.State.ANIMATING:this.view.interacting?this._state=m.State.INTERACTING:(this._state===m.State.ANIMATING&&(this._cameraChangeTime=0),this._state=300>=this._scheduler.now-this._cameraChangeTime?m.State.INTERACTING:m.State.IDLE)};b._createClass(v,[{key:"updating",get:function(){var A,E;return!!(null!=(A=this._memoryController)&&A.updating||null!=(E=this._streamDataLoader)&&E.updating)}},{key:"scheduler",get:function(){return this._scheduler}},
{key:"memoryController",get:function(){return this._memoryController}},{key:"test",get:function(){return{getQueueStats:A=>this._streamDataLoader.test.loadQueue.getStatsForType(A),state:this._state}}}]);return v}(a.ResourceControllerMain);c.__decorate([n.property({constructOnly:!0})],q.prototype,"view",void 0);c.__decorate([n.property({constructOnly:!0})],q.prototype,"now",void 0);c.__decorate([n.property()],q.prototype,"_scheduler",void 0);c.__decorate([n.property()],q.prototype,"_memoryController",
void 0);c.__decorate([n.property()],q.prototype,"_streamDataLoader",void 0);c.__decorate([n.property({readOnly:!0})],q.prototype,"updating",null);q=c.__decorate([r.subclass("esri.views.3d.support.ResourceController")],q);t.ResourceController=q})(u||(u={}));a.newResourceController=function(t,q=()=>performance.now()){return new u.ResourceController({view:t,now:q})};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/index":function(){define(["exports"],function(a){a.ClientType=
void 0;(function(c){c[c.ELEVATION=0]="ELEVATION";c[c.BASEMAP=1]="BASEMAP";c[c.I3S_INDEX=2]="I3S_INDEX";c[c.I3S_DATA=3]="I3S_DATA";c[c.SYMBOLOGY=4]="SYMBOLOGY"})(a.ClientType||(a.ClientType={}));const b=(()=>{const c=[];c[a.ClientType.ELEVATION]=10;c[a.ClientType.BASEMAP]=10;c[a.ClientType.I3S_INDEX]=10;c[a.ClientType.I3S_DATA]=10;c[a.ClientType.SYMBOLOGY]=5;return c})();a.downloadSlotsPerClient=b;a.maxDownloadSlots=30;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/MemoryController":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Evented ../../../core/Logger ../../../core/maybe ../../../core/MemCache ../layers/support/MemoryManagedLayerView".split(" "),
function(a,b,c,d,g,x,w){const l=d.getLogger("esri.views.3d.support.MemoryController");let n=function(){function f(k){this._view=k;this.events=new c;this.minQuality=.1;this._maxMemory=500;this._additionalCacheMemory=100;this._quality=1;this._downscaleMemoryUsed=this._stableQuality=0;this._canFastRecover=!1;this._memoryPredicted=this._memoryUsed=0;this._cacheStorage=new x.MemCacheStorage;this._numQualityChanges=0;this._updating=!1}var e=f.prototype;e.destroy=function(){this.events=null;this._cacheStorage.destroy()};
e.newCache=function(k,r){return new x.MemCache(k,this._cacheStorage,r)};e.disableMemCache=function(){this._additionalCacheMemory=-4096};e.resetStableQuality=function(){this._stableQuality=0};e.update=function(){this._updateMemory();if(!(0>=this._memoryPredicted)||this._updating){var k=this._layersUpdating();if(.6>this._memoryPredicted&&this._canFastRecover)this._stableQuality=this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._updateQuality(1);else if(k){if(1.1<this._memoryPredicted||1<this._memoryUsed)0<
this._stableQuality?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._memoryUsed&&(this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryUsed,this._canFastRecover=!1)}else this._downscaleMemoryUsed=0,1<this._memoryUsed?(this._stableQuality=0,this._canFastRecover=!1,k=this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryPredicted):this._stableQuality!==this._quality&&(.75>
this._memoryUsed&&1>this._quality?(this._stableQuality=this._quality,k=this._updateQuality(this._quality+.05)):1>this._quality&&(this._canFastRecover=!0));this.updating!==k&&(this._updating=k,this.events.emit("updating-changed",this.updating))}};e._updateQuality=function(k){k=Math.min(Math.max(k,this.minQuality),1);if(k===this._quality)return!1;this._quality=k;this.events.emit("quality-changed",this._quality);++this._numQualityChanges;return!0};e._layersUpdating=function(){return this._view.allLayerViews.some(k=>
!!k.updating)};e._updateMemory=function(){let k=0,r=0;this._view.basemapTerrain&&this._view.basemapTerrain.getUsedMemory&&(k+=this._view.basemapTerrain.getUsedMemory());var y=this._view._stage&&this._view._stage.renderView&&this._view._stage.renderView.edgeView;g.isSome(y)&&(k+=y.usedMemory);this._view.allLayerViews&&this._view.allLayerViews.forEach(h=>{if(w.isMemoryManagedLayerView(h)){const m=h.ignoresMemoryFactor()?this._quality:1;k+=h.getUsedMemory()*m;r+=h.getUnloadedMemory()*m}});var p=null==
this._warnMemoryUsage||Math.round(10*k)!==Math.round(10*this._warnMemoryUsage);y=1048576*this._maxMemory;if(k>y&&p){this._warnMemoryUsage=k;p=m=>(m/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB";const h=Math.round(100*this._quality);l.warn(`Memory Limit exceeded! Limit: ${p(y)} Current: ${p(k)} Projected: ${p(k+r)} Quality: ${h}%`)}this._memoryUsed=k/y;this._memoryPredicted=(k+r)/y;this._cacheStorage.maxSize=Math.max(0,y-k+1048576*this._additionalCacheMemory);this.events.emit("memory-used",
this._memoryUsed)};b._createClass(f,[{key:"maxMemory",get:function(){return this._maxMemory},set:function(k){null!=k&&0<k&&(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<k&&this._updateQuality(1),this._maxMemory=k)}},{key:"additionalCacheMemory",set:function(k){null!=k&&0<=k&&(this._additionalCacheMemory=k)}},{key:"memoryFactor",get:function(){return this._quality}},{key:"updating",get:function(){return this._updating}},{key:"usedMemory",get:function(){return this._memoryUsed}},{key:"test",
get:function(){const k=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const r=k._numQualityChanges;k._numQualityChanges=0;return r}}}}]);return f}();a.newMemoryController=function(f){return new n(f)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/MemoryManagedLayerView":function(){define(["exports"],function(a){a.isMemoryManagedLayerView=function(b){return"function"===typeof b.getUsedMemory};Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/support/StreamDataLoader":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../request ../../../core/Accessor ../../../core/arrayUtils ../../../core/Error ../../../core/lang ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./AsyncWorkerQueue ../webgl-engine/lib/Util ../../support/Scheduler".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h){function m(z){if(2>z.byteLength)return"unknown";z=new Uint8Array(z,0,z.byteLength);return 137===z[0]&&80===z[1]?"image/png":71===z[0]&&73===z[1]?"image/gif":66===z[0]&&77===z[1]?"image/bmp":255===z[0]&&216===z[1]?"image/jpeg":"unknown"}a.StreamDataLoader=function(z){function v(){var A=z.apply(this,arguments)||this;A._tasks=new Map;A._onLoadQueue=[];A._doneQueue=[];A.updating=!1;return A}b._inheritsLoose(v,z);var B=v.prototype;B.setup=function(A,E,C){this._loadQueue=
new y.AsyncWorkerQueue((D,F)=>this._startLoading(D,F),(D,F)=>this._doneLoadingCB(D,F),A,E);C&&(this._frameTask=C.registerTask(h.TaskPriority.STREAM_DATA_LOADER,this))};B.destroy=function(){this._frameTask=n.removeMaybe(this._frameTask);this._tasks.forEach(A=>n.abortMaybe(A.abortController));this._loadQueue=n.destroyMaybe(this._loadQueue);this._tasks=this._doneQueue=this._onLoadQueue=null};B.hasDownloadSlots=function(A){return this._loadQueue.hasQuota(A)};B.request=function(A,E,C,D={}){const F=f.createResolver();
F.__signal=n.isSome(D)?D.signal:null;const G=this._createOrUpdateTask(A,E,C,D,F);f.onAbort(D,()=>this._cancelRequest(G,F));return F.promise};B._createTask=function(A,E,C,D,F,G){A=new q(A,E,C,D,F);this._updateTask(A,G);this._tasks.set(F,A);1===this._tasks.size&&this._set("updating",!0);this._loadQueue.push(A);return A};B._cancelRequest=function(A,E){x.removeUnordered(A.resolvers,E);E.reject(f.createAbortError());0===A.resolvers.length&&(A.status===a.TaskStatus.DOWNLOADING&&(A.status=a.TaskStatus.CANCELLED,
this._loadQueue.cancel(A),A.abortController.abort(),A.request=null,A.abortController=null),A.status=a.TaskStatus.CANCELLED,this._tasks.delete(A.key),0===this._tasks.size&&this._set("updating",!1))};B._updateTask=function(A,E){A.resolvers.push(E)};B._createOrUpdateTask=function(A,E,C,D,F){const G=`${n.isSome(D)&&D.uid||A}:${E}:${C}`,J=this._tasks.get(G);return J?(this._updateTask(J,F),J):this._createTask(A,D,E,C,G,F)};B._doneLoadingCB=function(A,E){this._loadQueue&&(p.assert(A.status===a.TaskStatus.DOWNLOADING),
A.status=a.TaskStatus.DOWNLOADED,this._frameTask?this._doneQueue.push({task:A,err:E}):this._doneLoading(A,E))};B.runTask=function(A){for(;!A.done&&0<this._onLoadQueue.length;){var E=this._onLoadQueue.shift();f.throwIfAborted(E.task.abortController);E.task.abortController=null;E.callback(E.task);A.madeProgress()}for(;!A.done&&0<this._doneQueue.length;)E=this._doneQueue.shift(),E.task.status!==a.TaskStatus.DOWNLOADED&&(E.err=E.err||f.createAbortError()),this._doneLoading(E.task,E.err),A.madeProgress()};
B._doneLoading=function(A,E){if(E&&!f.isAbortError(E)&&0<A.numRetries)--A.numRetries,this._loadQueue.push(A);else{var C=A.result instanceof HTMLImageElement?0:A.resolvers.length;for(const D of A.resolvers)if(E)f.isAbortError(E)?D.reject(E):D.reject(new w("stream-data-loader:request-error",`Failed to request resource at '${A.url}'. ${E}`,{url:A.url,error:E}));else{--C;const F=0>=C?A.result:l.clone(A.result);D.resolve(F)}this._tasks.delete(A.key);0===this._tasks.size&&this._set("updating",!1)}};B._startLoading=
function(A,E){if(A.status===a.TaskStatus.CANCELLED)return!1;A.startTime=performance.now();A.status=a.TaskStatus.DOWNLOADING;let C,D;switch(A.docType){case "binary":D="array-buffer";C=0;break;case "image":D="image";break;case "image+type":D="array-buffer";break;default:D="json"}A.abortController=new AbortController;const F=A.abortController.signal;A.request=d(A.url,{...A.options,responseType:D,timeout:C,signal:F});let G=()=>{};const J=O=>{A.duration=performance.now()-A.startTime;A.size=O instanceof
ArrayBuffer?O.byteLength:A.size||0;A.result=O;this._frameTask?this._onLoadQueue.push({callback:E,task:A}):(A.abortController=null,E(A))},I=O=>{A.status===a.TaskStatus.DOWNLOADING&&E(A,O);G()};if("image+type"!==A.docType)return A.request.then(O=>J(O.data),I),!0;A.request.then(O=>{O=O.data;const P=m(O);D="image";A.size=O.byteLength;if("unknown"===P)A.request=d(A.url,{responseType:D,timeout:C,signal:F}),A.request.then(M=>J(M.data),I);else{O=new Blob([O],{type:P});var K=window.URL.createObjectURL(O);
G=()=>window.URL.revokeObjectURL(K);A.request=d(K,{responseType:D,timeout:C,signal:F});A.request.then(M=>J(new t(M.data,P,G)),I)}},I);return!0};b._createClass(v,[{key:"running",get:function(){return 0<this._doneQueue.length||0<this._onLoadQueue.length}},{key:"test",get:function(){return{loadQueue:this._loadQueue}}}]);return v}(g);c.__decorate([e.property({readOnly:!0})],a.StreamDataLoader.prototype,"updating",void 0);a.StreamDataLoader=c.__decorate([r.subclass("esri.views.3d.support.StreamDataLoader")],
a.StreamDataLoader);const u={numRetries:0};let t=function(){function z(v,B,A){this.image=v;this.type=B;this.release=A}b._createClass(z,[{key:"isOpaque",get:function(){return"image/jpeg"===this.type}}]);return z}(),q=function(z){function v(B,A,E,C,D){C=z.call(this,C)||this;C.url=B;C.options=A;C.docType=E;C.key=D;C.result=null;C.status=a.TaskStatus.QUEUED;C.request=null;C.abortController=null;C.resolvers=[];C.startTime=0;C.numRetries=u.numRetries;return C}b._inheritsLoose(v,z);return v}(y.BaseTask);
a.TaskStatus=void 0;(function(z){z[z.QUEUED=1]="QUEUED";z[z.DOWNLOADING=2]="DOWNLOADING";z[z.DOWNLOADED=3]="DOWNLOADED";z[z.CANCELLED=4]="CANCELLED"})(a.TaskStatus||(a.TaskStatus={}));a.ImageWithType=t;a.test=u;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/AsyncWorkerQueue":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../webgl-engine/lib/Util"],function(a,b,c){let d=function(w){this.typeWorkerQuota=w;this.tasks=[];this.numWorkers=0;this.statistics=
new g},g=function(){this.speed=this.duration=this.size=this.requests=0},x=function(){function w(n,f,e,k){this._workerFunc=n;this._callbackFunc=f;this._maxTotalNumWorkers=e;this._totalNumWorkers=0;this._clients=k.map(r=>new d(r))}var l=w.prototype;l.hasQuota=function(n){return(n=this._clients[n])?this._totalNumWorkers<this._maxTotalNumWorkers||n.numWorkers+n.tasks.length<n.typeWorkerQuota:!1};l.push=function(n){const f=this._clients[n.client];f&&(this._totalNumWorkers<this._maxTotalNumWorkers?(f.numWorkers++,
this._totalNumWorkers++,this._workerFunc(n,(e,k)=>this._taskCallback(e,k))):f.tasks.push(n))};l.cancel=function(n){this._taskFinished(n);n._cancelled=!0};l.destroy=function(){this._clients.length=0};l._taskFinished=function(n){const f=this._clients[n.client];this._totalNumWorkers--;f.numWorkers--;f.statistics.requests++;f.statistics.size+=n.size||0;f.statistics.duration+=n.duration||0;f.statistics.speed=0<f.statistics.duration?f.statistics.size/f.statistics.duration:0;c.assert(0<=f.numWorkers);this._next()};
l._next=function(){for(const n of this._clients)if(n&&n.numWorkers<n.typeWorkerQuota&&this._processQueue(n))return;for(const n of this._clients)if(n&&this._processQueue(n))break};l._processQueue=function(n){for(;0<n.tasks.length;)if(this._workerFunc(n.tasks.shift(),(f,e)=>this._taskCallback(f,e)))return n.numWorkers++,this._totalNumWorkers++,!0;return!1};l._taskCallback=function(n,f){n._cancelled||(this._callbackFunc(n,f),this._taskFinished(n))};l.getStatsForType=function(n){return(n=this._clients[n])?
{quota:n.typeWorkerQuota,workers:n.numWorkers,queueSize:n.tasks.length,requestStats:n.statistics}:null};b._createClass(w,[{key:"test",get:function(){const n=this;return{set workerFunc(f){n._workerFunc=f}}}}]);return w}();a.AsyncWorkerQueue=x;a.BaseTask=function(w){this.client=w;this._cancelled=!1;this.duration=this.size=0};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/SceneViewPerformanceInfo":function(){define(["../../../core/byteSizeEstimations","../../../core/maybe",
"../layers/support/MemoryManagedLayerView","./LayerPerformanceInfo","../terrain/terrainUtils"],function(a,b,c,d,g){return function(x){this.usedMemory=this.totalMemory=0;this.quality=1;this.edgesMemory=this.terrainMemory=this.load=0;this.layerPerformanceInfos=[];var w=x.resourceController.memoryController;this.totalMemory=w.maxMemory*a.ByteSizeUnit.MEGABYTES;this.usedMemory=Math.round(w.usedMemory*this.totalMemory);this.quality=w.memoryFactor;this.load=x.resourceController.scheduler.load;this.terrainMemory=
x.basemapTerrain?x.basemapTerrain.getUsedMemory():0;w=x._stage&&x._stage.renderView&&x._stage.renderView.edgeView;this.edgesMemory=b.isSome(w)?w.usedMemory:0;x.allLayerViews.items.forEach(l=>{(c.isMemoryManagedLayerView(l)||g.isSurfaceLayerView(l))&&this.layerPerformanceInfos.push(new d(l,x))});this.layerPerformanceInfos.sort((l,n)=>n.memory-l.memory)}})},"esri/views/3d/support/LayerPerformanceInfo":function(){define(["../layers/support/PerformanceInfoLayerView","../terrain/terrainUtils"],function(a,
b){return function(c,d){this.layer=null;this.displayedNumberOfFeatures=this.memory=0;this.totalNumberOfFeatures=this.maximumNumberOfFeatures=null;this.layer=c.layer;this.memory=b.isSurfaceLayerView(c)?d.basemapTerrain.getUsedMemoryForLayerView(c):c.getUsedMemory();a.isPerformanceInfoLayerView(c)&&(c=c.performanceInfo,this.displayedNumberOfFeatures=c.displayedNumberOfFeatures,this.maximumNumberOfFeatures=c.maximumNumberOfFeatures,this.totalNumberOfFeatures=c.totalNumberOfFeatures)}})},"esri/views/3d/layers/support/PerformanceInfoLayerView":function(){define(["exports"],
function(a){a.isPerformanceInfoLayerView=function(b){return"performanceInfo"in b};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/terrainUtils":function(){define("exports ../../../core/Collection ../../../core/maybe ../../../geometry/support/spatialReferenceUtils ../../../layers/support/layerUtils ../../ViewingMode ../support/StreamDataLoader ../../../chunks/terrainUtilsPlanar ../../../chunks/terrainUtilsSpherical".split(" "),function(a,b,c,d,g,x,w,l,n){function f(A){return"vector-tile"===
(null==A?void 0:A.type)}function e(A){return"imagery-tile"===(null==A?void 0:A.type)||"wcs"===(null==A?void 0:A.type)}function k(A){return"imagery-tile-3d"===(null==A?void 0:A.type)}function r(A){return"tile-3d"===(null==A?void 0:A.type)}function y(A){return"vector-tile-3d"===(null==A?void 0:A.type)}function p(A){return"wmts-3d"===(null==A?void 0:A.type)}function h(A){return"elevation-3d"===(null==A?void 0:A.type)}function m(A,E,C,D){return q[D].checkIfTileInfoSupportedForViewSR(A,C,E)}function u(A,
E,C){A=g.getTileMaxtrixSetFromActiveLayer(A);if(c.isSome(A))if(b.isCollection(A)){if(A=A.find(D=>null==m(D.tileInfo,D.fullExtent,E,C)))return{tileInfo:A.tileInfo,fullExtent:A.fullExtent}}else return{tileInfo:A.tileInfo,fullExtent:A.fullExtent};return{tileInfo:null,fullExtent:null}}function t(A){return A.isWGS84||A.isWebMercator||d.isCGCS2000(A)||!d.isEarth(A)}const q={[x.ViewingMode.Global]:n.terrainUtilsSpherical,[x.ViewingMode.Local]:l.terrainUtilsPlanar},z=80/180*Math.PI,v=110/180*Math.PI,B={force512VTL:!1};
a.checkIfTileInfoSupportedForView=m;a.computeSkirtScale=function(A,E,C){const D=q[A.viewingMode];if(D.isInsideExtent(A,E))var F=c.unwrapOr(A.getElevation(E[0],E[1],E[1],A.spatialReference),0);else{if(!D.isInsideExtent(A,E,1.2))return 0;var G=A.getTileWithElevation(E[0],E[1],E[1],A.spatialReference);F=c.isSome(G)?G.elevationBounds[0]:A.elevationBounds.min;G=c.isSome(G)?G.elevationBounds[1]:A.elevationBounds.max;F=.5*(F+G);A=D.tiltToExtentEdge(A,E,F);if(A>z&&A<v)return 0}E=E[2]-F;return Math.abs(E)<
C?0:0>E?-1:1};a.getLayerWithExtentRange=function(A){return k(A)?{fullExtent:A.fullExtent,minScale:A.layer.minScale,maxScale:A.layer.maxScale,tilemapCache:null}:A.layer};a.getTileInfoAndExtentFromWMTSLayer=u;a.getTiledLayerInfo=function(A,E,C){var D=null;let F=null;if(g.isWMTSLayer(A))A=u(A,E,C),D=A.tileInfo,F=A.fullExtent;else if(F=e(A)?A.getCompatibleFullExtent(E):A.fullExtent,D=C===x.ViewingMode.Local,e(A))D=A.getCompatibleTileInfo(E,F,D);else if(f(A)){D=D&&!t(E)||B.force512VTL;const G=A.tileInfo.spatialReference.isGeographic;
D=D?A.tileInfo:A.tileInfo.getOrCreateCompatible(256,G?1:2)}else D=A.tileInfo;return c.isSome(D)&&c.isSome(F)&&null==m(D,F,E,C)?{tileInfo:D,fullExtent:F}:null};a.isElevationLayerView=h;a.isImageryTileLayerView=k;a.isImageryTileRenderInfo=function(A){var E;A=null==A?void 0:null==(E=A.sourceLayerInfo)?void 0:E.data;return c.isSome(A)&&"type"in A&&"raster-tile"===A.type};a.isProjectableRasterLayer=e;a.isRasterTileRenderInfo=function(A){var E;A=null==A?void 0:null==(E=A.sourceLayerInfo)?void 0:E.data;
return A instanceof HTMLImageElement||A instanceof w.ImageWithType||A instanceof HTMLCanvasElement||A instanceof ImageData};a.isSurfaceLayerView=function(A){return A&&(r(A)||k(A)||h(A)||y(A)||p(A))};a.isTextureTileRenderInfo=function(A){var E;A=null==A?void 0:null==(E=A.sourceLayerInfo)?void 0:E.data;return c.isSome(A)&&"type"in A&&"tile-texture"===A.type};a.isTileLayerView=r;a.isVectorTileLayer=f;a.isVectorTileLayerView=y;a.isVectorTileRenderInfo=function(A){var E;A=null==A?void 0:null==(E=A.sourceLayerInfo)?
void 0:E.data;return c.isSome(A)&&"type"in A&&"vector-tile"===A.type};a.isWMTSLayerView=p;a.releaseTileData=function(A){c.isSome(A)&&"release"in A&&A.release();return null};a.test=B;a.useFetchTileForLayer=function(A){return A.fetchTile&&!1!==A.hasOverriddenFetchTile};a.vtlAssumes256PixelSizeAsDefault=t;a.weakAssert=function(A,E){A||console.warn("Terrain: "+E)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/terrainUtilsPlanar":function(){define("exports ../core/Error ../core/maybe ./vec3 ./vec3f64 ../geometry/projection ../geometry/support/aaBoundingRect ../views/3d/terrain/TerrainConst ../views/3d/terrain/TilingScheme".split(" "),
function(a,b,c,d,g,x,w,l,n){function f(u,t,q=0){u=u.extent;return c.isNone(u)?!1:0===q?w.containsPoint(u,t):w.containsPointWithMargin(u,t,q*Math.min(u[2]-u[0],u[3]-u[1]))}function e(u,t,q,z){d.copy(y,q);y[z]=t[z];z=d.subtract(y,y,t);var v=d.subtract(p,u,t);v=d.dot(v,z);const B=d.dot(z,z);t=0>=v?t:B<=v?q:d.add(y,t,d.scale(z,z,v/B));u=d.subtract(y,u,t);return Math.PI/2-Math.atan(u[2]/Math.sqrt(u[0]*u[0]+u[1]*u[1]))}function k(u,t,q){u=u.extent;if(c.isNone(u))return 0;h[0]=u[0];h[1]=u[1];h[2]=q;m[0]=
u[2];m[1]=u[3];m[2]=q;u=q=Infinity;t[0]<h[0]?q=e(t,h,m,0):t[0]>m[0]&&(q=e(t,m,h,0));t[1]<h[1]?u=e(t,h,m,1):t[1]>m[1]&&(u=e(t,m,h,1));return Math.min(q,u)}function r(u,t,q){if(c.isNone(u))return n.getMissingTileInfoError();if(u.spatialReference.isGeographic&&!x.canProjectToWGS84ComparableLonLat(u.spatialReference))return new b("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");var z=n.default.checkUnsupported(u);if(c.isSome(z))return z;
{var v=u.lods;z=v[0].resolution*2**v[0].level;var B=[z*u.size[0],z*u.size[1]];const A=[u.origin.x,u.origin.y];q=w.fromExtent(q);const E=w.create();n.default.computeRowColExtent(q,B,A,E);B=(E[2]-E[0])*(E[3]-E[1]);B>l.MAX_ROOT_TILES?(v=v[0].scale*2**v[0].level,z=Math.max((q[3]-q[1])/u.size[1],(q[2]-q[0])/u.size[0])*v/z,q=Math.floor(Math.log(z)/Math.log(10)),z=Math.ceil(z/10**q)*10**q,z=new b("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(v).toLocaleString()+
") is too large for the layer's extent. Suggested scale: 1:"+z.toLocaleString()+".",{level0Scale:v,suggestedLevel0Scale:z,requiredNumRootTiles:B,allowedNumRootTiles:l.MAX_ROOT_TILES})):z=null}if(z)return z;u=u.spatialReference;return!t||u.equals(t)||t.isWGS84&&u.isWebMercator?null:new b("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")}const y=g.create(),p=g.create(),h=g.create(),m=g.create();g=Object.freeze({__proto__:null,isInsideExtent:f,
tiltToExtentEdge:k,checkIfTileInfoSupportedForViewSR:r});a.checkIfTileInfoSupportedForViewSR=r;a.isInsideExtent=f;a.terrainUtilsPlanar=g;a.tiltToExtentEdge=k})},"esri/chunks/terrainUtilsSpherical":function(){define("exports ../core/Error ../core/maybe ../geometry/projection ../geometry/support/spatialReferenceUtils ../views/3d/terrain/TilingScheme".split(" "),function(a,b,c,d,g,x){function w(){return!0}function l(){return 0}function n(e,k){if(c.isNone(e))return x.getMissingTileInfoError();const r=
e.lods.length-1,y=e.spatialReference,p=d.canProjectToWGS84ComparableLonLat(y)||g.isMars(y)||g.isMoon(y);if(y.isWebMercator){if(!x.default.makeWebMercatorAuxiliarySphere(r).compatibleWith(e))return new b("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else if(p){if(!x.default.makeGCSWithTileSize(e.spatialReference,e.size[0],r).compatibleWith(e))return e.spatialReference.isWGS84?new b("tilingscheme:incompatible-global-wgs84",
"The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new b("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}else return new b("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(k&&!e.spatialReference.equals(k))return new b("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}
const f=Object.freeze({__proto__:null,isInsideExtent:w,tiltToExtentEdge:l,checkIfTileInfoSupportedForViewSR:n});a.checkIfTileInfoSupportedForViewSR=n;a.isInsideExtent=w;a.terrainUtilsSpherical=f;a.tiltToExtentEdge=l})},"esri/views/3d/support/SharedSymbolResources":function(){define("exports ../../../core/arrayUtils ../../../core/Handles ../../../geometry/projectionEllipsoid ./index ./StreamTextureCollection ../webgl-engine/lib/screenSizePerspectiveUtils ../../webgl/enums".split(" "),function(a,b,
c,d,g,x,w,l){let n=function(){function e(r){this.streamDataRequester=this.textures=null;this.graphicsOwners=[];this.cimSymbolRasterizer=this.screenSizePerspectiveHandles=null;this.viewState=r.viewState;this.view=r.view;this.pointsOfInterest=r.pointsOfInterest;this.objectResourceCache=r.objectResourceCache;this.streamDataRequester=r.resourceController.createStreamDataRequester(g.ClientType.SYMBOLOGY);this.textures=new x.StreamTextureCollection(this.streamDataRequester,r.view._stage,{preMultiplyAlpha:!0,
wrap:{s:l.TextureWrapMode.CLAMP_TO_EDGE,t:l.TextureWrapMode.CLAMP_TO_EDGE}},r.resourceController.scheduler);const y=d.getReferenceEllipsoid(this.view.spatialReference).radius;this.screenSizePerspectiveSettings=w.getSettings(r.viewingMode,y);this.screenSizePerspectiveSettingsLabels=w.getLabelSettings(r.viewingMode,y)}var k=e.prototype;k.destroy=function(){this.textures.destroy();this.streamDataRequester=this.textures=null};k.addGraphicsOwner=function(r){if(!r)return{remove(){}};this.graphicsOwners.push(r);
const y="layer"in r?r.watch("layer.screenSizePerspectiveEnabled",()=>this._updateScreenSizePerspectiveEnabled()):null;this._updateScreenSizePerspectiveEnabled();return{remove:()=>{y&&(y.remove(),b.removeUnordered(this.graphicsOwners,r),this._updateScreenSizePerspectiveEnabled())}}};k._updateScreenSizePerspectiveEnabled=function(){var r=this.graphicsOwners.some(y=>!0===y.get("layer.screenSizePerspectiveEnabled"));r&&!this.screenSizePerspectiveHandles?(this.screenSizePerspectiveHandles=new c,r=()=>
this._updateScreenSizePerspectiveSettings(),this.screenSizePerspectiveHandles.add([this.pointsOfInterest.centerOnSurfaceInfrequent.watch("distance",r,!0),this.viewState.events.on("camera-projection-changed",r)]),this._updateScreenSizePerspectiveSettings()):!r&&this.screenSizePerspectiveHandles&&(this.screenSizePerspectiveHandles.destroy(),this.screenSizePerspectiveHandles=null)};k._updateScreenSizePerspectiveSettings=function(){f.distance=this.pointsOfInterest.centerOnSurfaceInfrequent.distance;f.fovY=
this.viewState.camera.fovY;this.screenSizePerspectiveSettings.update(f);this.screenSizePerspectiveSettingsLabels.update(f);this.view._stage.renderView.requestRender()};return e}();const f={distance:0,fovY:0};a.SharedSymbolResources=n;a.default=n;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/StreamTextureCollection":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../core/promiseUtils ../../../core/urlUtils ./TextureCollection ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/Texture".split(" "),
function(a,b,c,d,g,x,w,l){x=function(n){function f(k,r,y,p){r=n.call(this,r,p)||this;r._streamDataRequester=k;r._parameters=y;return r}b._inheritsLoose(f,n);var e=f.prototype;e.fromUrl=function(){var k=b._asyncToGenerator(function*(r,y,p){var h=this;d.throwIfAborted(p);const m=c.isSome(p)&&p.signal,u=this.makeUid(r,y);let t=this._textureRequests.get(u);if(!t){p=new AbortController;const q=this._streamDataRequester.request(r,"image",{uid:u,signal:p.signal});t={referenceCount:0,texture:null,textureAsync:null,
abortController:p};this._textureRequests.set(u,t);t.textureAsync=q.then(function(){var z=b._asyncToGenerator(function*(v){v=h._createTexture(r,v,y);t.texture=v;t.abortController=null;h._stage.add(v);yield h._stage.load(v);return{uid:u,texture:v,release:()=>h._release(u)}});return function(v){return z.apply(this,arguments)}}(),z=>{t.abortController=null;throw z;})}t.referenceCount++;return(new Promise((q,z)=>{d.onAbort(m,()=>{z(d.createAbortError())});t.textureAsync.then(q,z)})).catch(q=>{this._release(u);
throw q;})});return function(r,y,p){return k.apply(this,arguments)}}();e._createTexture=function(k,r,y){const p={...this._parameters,powerOfTwoResizeMode:w.PowerOfTwoResizeMode.PAD};if(g.isSVG(k)){if(y||0===r.width&&0===r.height)k=r.width?r.height/r.width:1,y=y||64,1<k?(r.width=Math.round(y/k),r.height=y):(r.width=y,r.height=Math.round(y*k));this._stage.renderView&&this._stage.renderView.renderingContext.driverTest.svgAlwaysPremultipliesAlpha&&(p.preMultiplyAlpha=!1)}p.width=r.width;p.height=r.height;
return new l.Texture(r,p)};return f}(x.TextureCollection);a.StreamTextureCollection=x;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/pointsOfInterest/PointsOfInterest":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/maybe ../../../../core/watchUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/ray ../debugFlags ../debugUtils ../PropertiesPool ../geometryUtils/ray ./CameraOnSurface ./CenterOnSurface ./ContentGeometryUpdates ./Focus ./StableSurfaceCenter ./SurfaceGeometryUpdates ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/verticalOffsetUtils ../../../support/Scheduler".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E,C,D,F,G){a.PointsOfInterest=function(K){function M(R){R=K.call(this,R)||this;R._handles=new g;R._tmpRay=p.create();R._centerRayDirty=!0;R._surfaceAltitudeAtCenter=0;R._surfaceAltitudeAtCenterDirty=!0;R._contentAltitudeAtCenter=0;R._contentAltitudeAtCenterDirty=!0;R._propertiesPool=new u.PropertiesPool({renderPointOfView:J},b._assertThisInitialized(R));R.renderPointOfView=y.create();R._pois=[];R._debugCenters=new Map;return R}b._inheritsLoose(M,
K);var U=M.prototype;U.initialize=function(){var R;const {state:L,basemapTerrain:N,renderCoordsHelper:T,map:S}=this.view;this._surfaceIntersector=C.newIntersector(L.viewingMode);this._surfaceIntersector.options.backfacesTerrain=L.isGlobal?!1:!0;this._surfaceIntersector.options.invisibleTerrain=!1;this._surfaceIntersector.options.store=D.StoreResults.MIN;this._contentIntersector=C.newIntersector(L.viewingMode);var H=()=>this._estimateSurfaceAltitudeAtCenter();const Q=this.view.resourceController.scheduler,
W=x.unwrap(null==(R=this.view.basemapTerrain)?void 0:R.elevationQueryCache);R={state:L,scheduler:Q,surface:N,renderCoordsHelper:T};this._set("centerOnSurfaceInfrequent",new z.default({...R,task:G.TaskPriority.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:H}));this._set("centerOnSurfaceFrequent",new z.default({...R,task:G.TaskPriority.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:H}));this._set("contentCenterOnSurface",new z.default({...R,task:G.TaskPriority.POINT_OF_INTEREST_INFREQUENT,
estimateSurfaceAltitudeAtCenter:H,cameraName:"contentCamera"}));this._set("centerOnContent",new z.default({...R,task:G.TaskPriority.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()}));this._set("cameraOnSurface",new q.default({...R,cache:W,task:G.TaskPriority.POINT_OF_INTEREST_INFREQUENT,map:S}));this._set("contentCameraOnSurface",new q.default({...R,cache:W,task:G.TaskPriority.POINT_OF_INTEREST_INFREQUENT,map:S,cameraName:"contentCamera"}));this._set("surfaceGeometryUpdates",
new E.SurfaceGeometryUpdates({...R,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]}));this._set("contentGeometryUpdates",new v.ContentGeometryUpdates({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:T}));this._set("surfaceOrigin",new A.StableSurfaceCenter({cache:W,view:this.view}));this._set("focus",new B.default({state:L,scheduler:Q,surface:N,renderCoordsHelper:T,centerOnSurface:this.contentCenterOnSurface,estimateSurfaceIntersectionAtRenderPoint:(V,
Y)=>this._estimateSurfaceIntersectionAtRenderPoint(V,this.view.state.contentCamera,Y)}));this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.contentCenterOnSurface,this.cameraOnSurface,this.contentCameraOnSurface,this.focus);H=this.view.graphics;this._debugCenters.set(this.centerOnContent,new m.PointGraphics(H,"red","CenterOnContent"));this._debugCenters.set(this.centerOnSurfaceFrequent,new m.PointGraphics(H,"red","CenterOnSurface"));this._debugCenters.set(this.centerOnSurfaceInfrequent,
new m.PointGraphics(H,"red","CenterOnSurface"));this._debugCenters.set(this.contentCenterOnSurface,new m.PointGraphics(H,"red","ContentCenterOnSurface"));this._debugCenters.set(this.cameraOnSurface,new m.PointGraphics(H,"blue","CameraOnSurface"));this._debugCenters.set(this.contentCameraOnSurface,new m.PointGraphics(H,"blue","ContentCameraOnSurface"));this._debugCenters.set(this.focus,new m.PointGraphics(H,"green","Focus"));this._handles.add([L.watch("camera",V=>this._cameraChanged(V),!0),N.watch("extent",
()=>this._updateCenterPointsOfInterest()),w.whenFalse(N,"updating",()=>this._updateCenterPointsOfInterest(),!0),this.surfaceGeometryUpdates.events.on("request-update",()=>this._updateCenterPointsOfInterest()),this.contentGeometryUpdates.events.on("request-update",()=>this._updateCenterOnContent()),w.init(h,"SHOW_POI",V=>this._setDebug(V))]);this._cameraChanged(this.view.state.camera);for(const V of this._pois)V.runTask()};U.destroy=function(){this._setDebug(!1);this._handles.destroy();this._propertiesPool.destroy();
for(const R of this._pois)R.destroy();this.surfaceOrigin.destroy()};U._estimateContentAltitudeAtCenter=function(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const R=this.centerRay;if(x.isNone(R))return this._contentAltitudeAtCenter;this.view.sceneIntersectionHelper.intersectRay(R,this._contentIntersector,I,P)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(I):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter();
return this._contentAltitudeAtCenter};U._estimateSurfaceAltitudeAtCenter=function(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const R=this.centerRay;if(x.isNone(R))return this._surfaceAltitudeAtCenter;const L=R.origin,N=r.add(I,R.origin,R.direction);this._surfaceIntersector.resetWithRay(R,this.view.state.camera);this.view.basemapTerrain.intersect(this._surfaceIntersector,null,L,N);this._surfaceIntersector.results.min.getIntersectionPoint(I)&&
(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(I));return this._surfaceAltitudeAtCenter};U._estimateSurfaceIntersectionAtRenderPoint=function(R,L,N){R=t.fromRenderAtEye(L,R,O);if(x.isNone(R))return null;const T=R.origin,S=r.add(I,R.origin,R.direction);this._surfaceIntersector.resetWithRay(R,L);this.view.basemapTerrain.intersect(this._surfaceIntersector,null,T,S);return this._surfaceIntersector.results.min.getIntersectionPoint(N)?N:null};U._cameraChanged=function(R){this._updateCenterPointsOfInterest();
R=R.eye;r.exactEquals(this.renderPointOfView,R)||this._set("renderPointOfView",r.copy(this._propertiesPool.get("renderPointOfView"),R))};U._updateCenterPointsOfInterest=function(){this._contentAltitudeAtCenterDirty=this._surfaceAltitudeAtCenterDirty=this._centerRayDirty=!0;for(const R of this._pois)R.updateRenderLocation()};U._updateCenterOnContent=function(){this._contentAltitudeAtCenterDirty=!0;this.centerOnContent.updateRenderLocation()};U._setDebug=function(R){if(R)for(const L of this._pois)this._handles.add(w.init(L,
"renderLocation",N=>this._debugCenters.get(L).show(N,L.renderCoordsHelper.spatialReference)),"debug");else this._debugCenters.forEach(L=>L.hide()),this._handles.remove("debug")};b._createClass(M,[{key:"updating",get:function(){var R;return!!(null!=(R=this.surfaceGeometryUpdates)&&R.updating||this._pois.some(L=>L.updating))}},{key:"centerRay",get:function(){this._centerRayDirty&&(this._centerRay=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.camera,this._tmpRay),this._centerRayDirty=
!1);return this._centerRay}},{key:"test",get:function(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const R of this._pois)R.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}}]);return M}(d);c.__decorate([l.property({readOnly:!0})],a.PointsOfInterest.prototype,"centerOnContent",void 0);c.__decorate([l.property({readOnly:!0})],a.PointsOfInterest.prototype,"centerOnSurfaceFrequent",void 0);c.__decorate([l.property({readOnly:!0})],a.PointsOfInterest.prototype,"centerOnSurfaceInfrequent",
void 0);c.__decorate([l.property({readOnly:!0})],a.PointsOfInterest.prototype,"contentCenterOnSurface",void 0);c.__decorate([l.property({readOnly:!0})],a.PointsOfInterest.prototype,"cameraOnSurface",void 0);c.__decorate([l.property({readOnly:!0})],a.PointsOfInterest.prototype,"contentCameraOnSurface",void 0);c.__decorate([l.property({readOnly:!0})],a.PointsOfInterest.prototype,"focus",void 0);c.__decorate([l.property({readOnly:!0})],a.PointsOfInterest.prototype,"renderPointOfView",void 0);c.__decorate([l.property({readOnly:!0})],
a.PointsOfInterest.prototype,"surfaceOrigin",void 0);c.__decorate([l.property({readOnly:!0})],a.PointsOfInterest.prototype,"contentGeometryUpdates",void 0);c.__decorate([l.property({readOnly:!0})],a.PointsOfInterest.prototype,"surfaceGeometryUpdates",void 0);c.__decorate([l.property({constructOnly:!0})],a.PointsOfInterest.prototype,"view",void 0);c.__decorate([l.property({readOnly:!0})],a.PointsOfInterest.prototype,"updating",null);a.PointsOfInterest=c.__decorate([k.subclass("esri.views.3d.support.PointsOfInterest")],
a.PointsOfInterest);const J=Array,I=y.create(),O=p.create(),P={exclude:new Set([F.TERRAIN_ID])};a.default=a.PointsOfInterest;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/debugUtils":function(){define("exports ../../../geometry ../../../Graphic ../../../symbols ../../../core/maybe ../../../geometry/Polygon ../../../symbols/FillSymbol3DLayer ../../../symbols/PolygonSymbol3D ../../../geometry/Point ../../../symbols/PointSymbol3D ../../../symbols/IconSymbol3DLayer ../../../symbols/TextSymbol3DLayer".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k){b=function(){function r(p,h,m=""){this.graphics=p;this._symbol=new f({symbolLayers:[new e({material:{color:h},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new k({text:m,halo:{color:"white",size:1/.75},material:{color:h},size:12})]})}var y=r.prototype;y.show=function(p,h){g.isNone(h)||(this.hide(),p=new n({x:p[0],y:p[1],z:p[2],spatialReference:h}),this._graphic=new c({geometry:p,symbol:this._symbol}),this.graphics.add(this._graphic))};y.hide=
function(){g.isSome(this._graphic)&&(this.graphics.remove(this._graphic),this._graphic=null)};return r}();d=function(){function r(p,h,m=""){this.graphics=p;this._graphics=[];this._outline=new l({symbolLayers:[new w({material:{color:[0,0,0,0]},outline:{color:h,size:2}})]});this._text=new f({symbolLayers:[new k({text:m,halo:{color:"white",size:1/.75},material:{color:h},size:12})]})}var y=r.prototype;y.show=function(p){this.hide();const h=new n({x:p.xmin,y:p.ymin,z:p.zmax,spatialReference:p.spatialReference});
this._graphics.push(new c({geometry:x.fromExtent(p),symbol:this._outline}));this._graphics.push(new c({geometry:h,symbol:this._text}));this.graphics.addMany(this._graphics)};y.hide=function(){this.graphics.removeMany(this._graphics);this._graphics.length=0};return r}();a.ExtentGraphics=d;a.PointGraphics=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/pointsOfInterest/CameraOnSurface":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/Point ../cameraUtils ../PropertiesPool ./PointOfInterest".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h){const m=Array;a.CameraOnSurface=function(t){function q(v){v=t.call(this,v)||this;v._dirty=!1;v._propertiesPool=new p.PropertiesPool({location:r,renderLocation:m},b._assertThisInitialized(v));v._estimatedSurfaceAltitude=0;v._pendingElevationQueryController=null;v.cameraName="camera";v.renderLocation=k.create();v.tmpPoint=new r;return v}b._inheritsLoose(q,t);var z=q.prototype;z.initialize=function(){this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,
this));this.runTask();if(this.map){const v=()=>this._setDirty();this.handles.add(g.on(this.map,"ground.layers","change",v,v,v))}this._updateRenderLocation()};z.destroy=function(){this._cancelPendingRequest();this._propertiesPool.destroy();this._propertiesPool=null};z.updateRenderLocation=function(){this._setDirty();this._updateRenderLocation()};z._setDirty=function(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))};z._cancelPendingRequest=function(){const v=this._pendingElevationQueryController;
v&&(this._pendingElevationQueryController=null,v.abort(),this.notifyChange("updating"))};z.runTask=function(){this._cancelPendingRequest();this._dirty=!1;this.notifyChange("updating");if(this.map&&this.map.ground){this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this.tmpPoint,this.state.spatialReference);var v=new AbortController;this.map.ground.queryElevation(this.tmpPoint,{signal:v.signal,cache:this.cache}).then(B=>this._updateSurfaceAltitude(B.geometry.z)).catch(B=>{d.isAbortError(B)||
this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===v&&(this._pendingElevationQueryController=null,this.notifyChange("updating"));v=null});this._pendingElevationQueryController=v}else this._updateSurfaceAltitude(0)};z._updateSurfaceAltitude=function(v){this._estimatedSurfaceAltitude!==v&&(this._estimatedSurfaceAltitude=v,this._updateRenderLocation())};z._updateRenderLocation=function(){this.renderCoordsHelper.setAltitude(u,this._estimatedSurfaceAltitude,
this._camera.eye);e.exactEquals(this._get("renderLocation"),u)||this._set("renderLocation",e.copy(this._propertiesPool.get("renderLocation"),u))};b._createClass(q,[{key:"_camera",get:function(){return this.state[this.cameraName]}},{key:"location",get:function(){const v=this._propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,v,this.state.spatialReference);return v}},{key:"scale",get:function(){const v=this._camera,B=e.distance(v.eye,this.renderLocation);return y.distanceToScale({renderCoordsHelper:this.renderCoordsHelper,
state:{camera:v}},B,0)}},{key:"updating",get:function(){return this._dirty||null!=this._pendingElevationQueryController}},{key:"running",get:function(){return!this._pendingElevationQueryController&&this._dirty}}]);return q}(h.PointOfInterest);c.__decorate([x.property({constructOnly:!0})],a.CameraOnSurface.prototype,"scheduler",void 0);c.__decorate([x.property({constructOnly:!0})],a.CameraOnSurface.prototype,"cache",void 0);c.__decorate([x.property({constructOnly:!0})],a.CameraOnSurface.prototype,
"task",void 0);c.__decorate([x.property({constructOnly:!0})],a.CameraOnSurface.prototype,"cameraName",void 0);c.__decorate([x.property({readOnly:!0})],a.CameraOnSurface.prototype,"location",null);c.__decorate([x.property({constructOnly:!0})],a.CameraOnSurface.prototype,"map",void 0);c.__decorate([x.property({readOnly:!0})],a.CameraOnSurface.prototype,"renderLocation",void 0);c.__decorate([x.property({readOnly:!0})],a.CameraOnSurface.prototype,"scale",null);c.__decorate([x.property({readOnly:!0})],
a.CameraOnSurface.prototype,"updating",null);a.CameraOnSurface=c.__decorate([f.subclass("esri.views.3d.support.CameraOnSurface")],a.CameraOnSurface);const u=k.create();a.default=a.CameraOnSurface;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/pointsOfInterest/PointOfInterest":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,d,g,x,w,l,n,f){a.PointOfInterest=function(e){function k(r){r=e.call(this,r)||this;r.handles=new g;return r}b._inheritsLoose(k,e);k.prototype.destroy=function(){this.handles.destroy()};return k}(d);c.__decorate([x.property({constructOnly:!0})],a.PointOfInterest.prototype,"renderCoordsHelper",void 0);c.__decorate([x.property({constructOnly:!0})],a.PointOfInterest.prototype,"surface",void 0);c.__decorate([x.property({constructOnly:!0})],a.PointOfInterest.prototype,"state",void 0);a.PointOfInterest=
c.__decorate([f.subclass("esri.views.3d.support.PointOfInterest")],a.PointOfInterest);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/pointsOfInterest/CenterOnSurface":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/Point ../../../../geometry/projection ../../../../geometry/projectionEllipsoid ../../../../geometry/support/aaBoundingRect ../debugFlags ../PropertiesPool ./PointOfInterest".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t){const q=Array;a.CenterOnSurface=function(A){function E(D){D=A.call(this,D)||this;D._propertiesPool=new u.PropertiesPool({location:r,renderLocation:q},b._assertThisInitialized(D));D._currentSurfaceAltitude=0;D._latestSurfaceAltitude=0;D.cameraName="camera";D.distance=0;D.renderLocation=k.create();D.updating=!1;return D}b._inheritsLoose(E,A);var C=E.prototype;C.initialize=function(){this._frameWorker=this.scheduler.registerTask(this.task,this);this.runTask()};
C.destroy=function(){this._frameWorker=g.removeMaybe(this._frameWorker);this._propertiesPool=g.destroyMaybe(this._propertiesPool)};C.updateRenderLocation=function(){this.updating=!0;this._updateRenderLocation()};C.runTask=function(){this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter();this._updateRenderLocation();this.updating=!1};C._updateRenderLocation=function(){const D=z;let F=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,D);var G=this._currentSurfaceAltitude!==
this._latestSurfaceAltitude;!F&&G&&(F=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,D))&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude);G=v;F&&this._latestSurfaceAltitudeChangesDistanceSignificantly(D,G)&&(e.copy(D,G),this._currentSurfaceAltitude=this._latestSurfaceAltitude);F?this.distance=e.distance(this._camera.eye,D):(e.scale(D,this._camera.viewForward,this._get("distance")),e.add(D,D,this._camera.eye));e.exactEquals(this._get("renderLocation"),D)||this._set("renderLocation",
e.copy(this._propertiesPool.get("renderLocation"),D))};C._calculateSurfaceIntersection=function(D,F){var G=this._camera;if(!this.renderCoordsHelper.intersectManifold(G.ray,D,F))return!1;if(this.state.isGlobal){const J=p.getReferenceEllipsoid(this.renderCoordsHelper.spatialReference).radius;D=J+D;const I=e.squaredLength(G.eye),O=I<D*D,P=e.distance(G.eye,F);O&&P>J/4&&(e.scale(F,G.viewForward,D-Math.sqrt(I)),e.add(F,F,G.eye))}else G=this.surface.ready?this.surface.extent:null,g.isSome(G)&&y.projectBoundingRect(G,
this.surface.spatialReference,B,this.renderCoordsHelper.spatialReference)&&(F[0]=d.clamp(F[0],B[0],B[2]),F[1]=d.clamp(F[1],B[1],B[3]));return!0};C._latestSurfaceAltitudeChangesDistanceSignificantly=function(D,F){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||null==D)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,F)){if(m.TESTS_DISABLE_OPTIMIZATIONS)return!0;const G=this._camera.eye;D=e.distance(G,D);F=e.distance(G,F);if(.05<Math.abs(F-D)/D)return!0}return!1};
b._createClass(E,[{key:"_camera",get:function(){return this.state[this.cameraName]}},{key:"location",get:function(){const D=this._propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,D,this.state.spatialReference);return D}},{key:"estimatedSurfaceAltitude",get:function(){return this._latestSurfaceAltitude}},{key:"running",get:function(){return this.updating}}]);return E}(t.PointOfInterest);c.__decorate([x.property({constructOnly:!0})],a.CenterOnSurface.prototype,
"scheduler",void 0);c.__decorate([x.property({constructOnly:!0})],a.CenterOnSurface.prototype,"task",void 0);c.__decorate([x.property({constructOnly:!0})],a.CenterOnSurface.prototype,"cameraName",void 0);c.__decorate([x.property()],a.CenterOnSurface.prototype,"distance",void 0);c.__decorate([x.property({constructOnly:!0})],a.CenterOnSurface.prototype,"estimateSurfaceAltitudeAtCenter",void 0);c.__decorate([x.property({readOnly:!0})],a.CenterOnSurface.prototype,"location",null);c.__decorate([x.property({readOnly:!0})],
a.CenterOnSurface.prototype,"renderLocation",void 0);c.__decorate([x.property()],a.CenterOnSurface.prototype,"updating",void 0);a.CenterOnSurface=c.__decorate([f.subclass("esri.views.3d.support.CenterOnSurface")],a.CenterOnSurface);const z=k.create(),v=k.create(),B=h.create();a.default=a.CenterOnSurface;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/pointsOfInterest/ContentGeometryUpdates":function(){define(["exports","../../../../core/Evented","../../../../core/Handles"],
function(a,b,c){let d=function(){function x(l){this.handles=new c;this.events=new b;this.contentLayerViews=l.contentLayerViews;this.handles.add(this.contentLayerViews.on("change",n=>this._layerViewsChanged(n)));this._layerViewsChanged({added:this.contentLayerViews.toArray(),removed:[],moved:[],target:this.contentLayerViews})}var w=x.prototype;w.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};w._layerViewsChanged=function(l){l.added.forEach(n=>{"esri.views.3d.layers.SceneLayerView3D"===
n.declaredClass&&this.handles.add(n.on("visible-geometry-changed",()=>this._contentChanged()),n.uid)});l.removed.forEach(n=>this.handles.remove(n.uid))};w._contentChanged=function(){this.events.emit("request-update",g)};return x}();const g={};a.ContentGeometryUpdates=d;a.default=d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/pointsOfInterest/Focus":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/Point ../../../../geometry/support/ray ../PropertiesPool ./PointOfInterest ../../webgl-engine/lib/Camera ../../../support/Scheduler".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u){const t=Array;a.Focus=function(B){function A(C){C=B.call(this,C)||this;C._propertiesPool=new p.PropertiesPool({location:r,renderLocation:t},b._assertThisInitialized(C));C._dirty=!0;C.renderLocation=C._propertiesPool.get("renderLocation");return C}b._inheritsLoose(A,B);var E=A.prototype;E.initialize=function(){this.handles.add([this.centerOnSurface.watch("renderLocation",()=>this.updateRenderLocation()),this.state.watch("contentCamera",()=>this.updateRenderLocation())]);
this.scheduler&&this.handles.add(this.scheduler.registerTask(u.TaskPriority.POINT_OF_INTEREST_FREQUENT,this))};E.destroy=function(){this._propertiesPool.destroy();this._propertiesPool=null};E.runTask=function(){var C=this._get("renderLocation");const D=this.centerOnSurface.renderLocation;var F=this.renderCoordsHelper,G=this.state.contentCamera;this._dirty=!1;F.worldUpAtPosition(D,q);F=Math.max(0,(Math.acos(e.dot(q,G.viewForward))-.5*Math.PI)*(G.aboveGround?1:-1));Number.isNaN(F)?C&&e.equals(C,D)||
(C=this._propertiesPool.get("renderLocation"),e.copy(C,D),this._set("renderLocation",C)):(F=1-d.clamp(F/(.5*Math.PI),0,1),F*=F*F,this._calculateScreenHorizontalEdgeOnSurface(v),G=this._propertiesPool.get("renderLocation"),e.lerp(G,D,v,F),C&&e.equals(C,G)||this._set("renderLocation",G))};E._calculateScreenHorizontalEdgeOnSurface=function(C){const D=this.state.contentCamera;var F=D.getRenderCenter(g.createRenderScreenPointArray3());F[1]=D.aboveGround?D.padding[m.PaddingSide.BOTTOM]:D.fullHeight-D.padding[m.PaddingSide.TOP];
if(this.estimateSurfaceIntersectionAtRenderPoint(F,C))return C;const G=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);return D.unprojectFromRenderScreen(F,z)&&(e.subtract(z,z,D.eye),F=e.normalize(z,z),this.renderCoordsHelper.intersectManifold(y.wrap(D.eye,F),G,C))?C:this.renderCoordsHelper.setAltitude(C,G,D.eye)};E.updateRenderLocation=function(){this._dirty=!0};b._createClass(A,[{key:"updating",get:function(){return this._dirty||this.centerOnSurface.updating}},{key:"location",
get:function(){const C=this._propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,C,this.state.spatialReference);return C}},{key:"running",get:function(){return this._dirty}}]);return A}(h.PointOfInterest);c.__decorate([x.property()],a.Focus.prototype,"_dirty",void 0);c.__decorate([x.property({constructOnly:!0})],a.Focus.prototype,"scheduler",void 0);c.__decorate([x.property({constructOnly:!0})],a.Focus.prototype,"centerOnSurface",void 0);c.__decorate([x.property({constructOnly:!0})],
a.Focus.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0);c.__decorate([x.property({readOnly:!0})],a.Focus.prototype,"updating",null);c.__decorate([x.property({readOnly:!0})],a.Focus.prototype,"location",null);c.__decorate([x.property({readOnly:!0})],a.Focus.prototype,"renderLocation",void 0);a.Focus=c.__decorate([f.subclass("esri.views.3d.support.CenterOnSurface")],a.Focus);const q=k.create(),z=k.create(),v=k.create();a.default=a.Focus;Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/support/pointsOfInterest/StableSurfaceCenter":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3f64 ../../../../geometry/Point ../../../../geometry/support/aaBoundingRect".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h){a.StableSurfaceCenter=function(m){function u(q){q=m.call(this,q)||this;q.location=null;q._updateController=null;q._handles=new g;return q}b._inheritsLoose(u,m);var t=u.prototype;t.initialize=function(){this.view.state.isLocal&&(this._handles.add([this.watch(["surfaceView.spatialReference","surfaceView.extent"],()=>this._update()),l.on(this,"surface.layers","change",()=>this._update())]),this._update())};t.destroy=function(){this._handles.destroy()};t._update=
function(){this._updateController&&(this._updateController.abort(),this._updateController=null);if(this.surfaceView&&!x.isNone(this.surfaceView.extent)&&this.surfaceView.spatialReference){var q=h.center(this.surfaceView.extent);q=new p({x:q[0],y:q[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&0<this.surface.layers.length?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(q,{noDataValue:0,signal:this._updateController.signal,
cache:this.cache}).then(z=>{this._updateController=null;this._set("location",z.geometry)}).catch(z=>{w.isAbortError(z)||z&&"elevation-query:invalid-layer"===z.name||console.error("StableSurfaceCenter failed to update: ",z)})):this._set("location",q)}else this._set("location",null)};b._createClass(u,[{key:"renderLocation",get:function(){if(!this.location)return null;const q=y.create();this.view.renderCoordsHelper.toRenderCoords(this.location,q);return q}}]);return u}(d);c.__decorate([n.property({constructOnly:!0})],
a.StableSurfaceCenter.prototype,"view",void 0);c.__decorate([n.property({constructOnly:!0})],a.StableSurfaceCenter.prototype,"cache",void 0);c.__decorate([n.property({readOnly:!0,aliasOf:"view.map.ground"})],a.StableSurfaceCenter.prototype,"surface",void 0);c.__decorate([n.property({readOnly:!0,aliasOf:"view.basemapTerrain"})],a.StableSurfaceCenter.prototype,"surfaceView",void 0);c.__decorate([n.property({readOnly:!0})],a.StableSurfaceCenter.prototype,"location",void 0);c.__decorate([n.property({readOnly:!0})],
a.StableSurfaceCenter.prototype,"renderLocation",null);a.StableSurfaceCenter=c.__decorate([r.subclass("esri.views.3d.terrain.StableSurfaceCenter")],a.StableSurfaceCenter);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/pointsOfInterest/SurfaceGeometryUpdates":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Handles ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../support/Scheduler".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p){a.SurfaceGeometryUpdates=function(q){function z(){var B=q.apply(this,arguments)||this;B.handles=new x;B._tileGeometryUpdateExtent=y.empty();B._tileGeometryUpdateSpatialReference=null;B.events=new g;B.updating=!1;return B}b._inheritsLoose(z,q);var v=z.prototype;v.initialize=function(){this.handles.add([this.surface.on("elevation-change",B=>this._tileGeometryChanged(B)),this.scheduler.registerTask(p.TaskPriority.SURFACE_GEOMETRY_UPDATES,this)])};v.destroy=function(){this.handles=
w.destroyMaybe(this.handles)};v.runTask=function(){this.updating&&(this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",h),y.empty(this._tileGeometryUpdateExtent),this._set("updating",!1))};v._tileGeometryChanged=function(B){this._tileGeometryUpdateSpatialReference=B.spatialReference;y.expand(this._tileGeometryUpdateExtent,B.tile.extent,this._tileGeometryUpdateExtent);this._set("updating",!0)};v._furthestCenterOnSurface=
function(){let B=this.centerOnSurfaces[0];for(let A=1;A<this.centerOnSurfaces.length;A++){const E=this.centerOnSurfaces[A];E.distance>B.distance&&(B=E)}return B};v._centerIntersectsExtent=function(B,A){const E=this.state.camera.eye,C=t,D=this._furthestCenterOnSurface();this.renderCoordsHelper.fromRenderCoords(E,m,A);this.renderCoordsHelper.fromRenderCoords(D.renderLocation,u,A);m[0]<u[0]?(C[0]=m[0],C[2]=u[0]):(C[0]=u[0],C[2]=m[0]);m[1]<u[1]?(C[1]=m[1],C[3]=u[1]):(C[1]=u[1],C[3]=m[1]);return y.intersects(C,
B)};b._createClass(z,[{key:"running",get:function(){return this.updating}}]);return z}(d);c.__decorate([l.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"state",void 0);c.__decorate([l.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"centerOnSurfaces",void 0);c.__decorate([l.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"renderCoordsHelper",void 0);c.__decorate([l.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"scheduler",void 0);
c.__decorate([l.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"surface",void 0);c.__decorate([l.property({readOnly:!0})],a.SurfaceGeometryUpdates.prototype,"updating",void 0);a.SurfaceGeometryUpdates=c.__decorate([k.subclass("esri.views.3d.support.SurfaceGeometryUpdates")],a.SurfaceGeometryUpdates);const h={},m=r.create(),u=r.create(),t=y.empty();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/TerrainSurface":function(){define("require ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/Accessor ../../../core/arrayUtils ../../../core/CollectionFlattener ../../../core/Evented ../../../core/Handles ../../../core/Logger ../../../core/mathUtils ../../../core/maybe ../../../core/ObjectPool ../../../core/PooledArray ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators/aliasOf ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4f64 ../../../geometry/projection ../../../geometry/projectionEllipsoid ../../../geometry/support/aaBoundingRect ../../../geometry/support/frustum ../../../layers/mixins/RefreshableLayer ../../../layers/support/ElevationQueryTileCache ../../../layers/support/layerUtils ../../../layers/support/LercDecoder ../../2d/engine/vectorTiles/VectorTile ../layers/ElevationLayerView3D ../support/cameraUtils ../support/debugFlags ../support/extentUtils ../support/index ../support/updatingProperties ./ElevationBounds ./ElevationData ./ExtentHelper ./interfaces ./LayerClass ./OverlayManager ./PlanarPatch ./RenderOrder ./SphericalPatch ./TerrainConst ./TerrainRenderer ./TerrainSurfacePerformanceInfo ./terrainUtils ./Tile ./TilePerLayerInfo ./TileUpdate ./tileUtils ./TilingSchemeLogic ./UpsampleInfo ../webgl-engine/lib/basicInterfaces ../../support/Scheduler ../../support/WatchUpdatingTracking".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E,C,D,F,G,J,I,O,P,K,M,U,R,L,N,T,S,H,Q,W,V,Y,aa,X,ba,ha,ka,ia,ea,ca,Z,fa,ja,la,ma,ra,va,ya,za,pa){function wa(ab,Za){return ab[0]===Za[0]&&ab[1]===Za[1]&&ab[2]===Za[2]}function na(ab){return ab.isLeaf?!1:ab.children[0].shouldLoad||ab.children[1].shouldLoad||ab.children[2].shouldLoad||ab.children[3].shouldLoad||na(ab.children[0])||na(ab.children[1])||na(ab.children[2])||na(ab.children[3])}const qa=f.getLogger("esri.views.3d.terrain.TerrainSurface");
g=function(ab){function Za(ua){var Aa=ab.call(this,ua)||this;Aa._elevationBounds=new Q.ElevationBounds;Aa._iteratorPool=new r(ma.IteratorPreorder,Ia=>Ia.remove=()=>Aa._iteratorPool.release(Ia));Aa._postorderIterator=new ma.IteratorPostorder;Aa._hasPendingUpdates=!1;Aa._pendingUpdates=0;Aa._asyncWorkItems=0;Aa._allTilesDirty=!0;Aa._allTilesSorted=!0;Aa._visible=!1;Aa._usedMemory=-1;Aa._performanceInfo=new ca;Aa._viewChanged=!1;Aa._inFrameTask=!1;Aa._viewChangeUpdateDirty=!1;Aa._eyePosRenderSR=C.create();
Aa._eyePosSurfaceSR=C.create();Aa._splitLimits=new fa.SplitLimits;Aa._snapLevel=Infinity;Aa._frustum=I.create();Aa._viewProjectionMatrix=A.create();Aa._layerViews=[[],[]];Aa._layerIndexByUid=[new Map,new Map];Aa._basemapLayerViewHandles=new Map;Aa._handles=new n;Aa._watchUpdatingTracking=new pa.WatchUpdatingTracking;Aa._frameTask=za.ImmediateTask;Aa._allTiles=new y;Aa._upsampleInfoPool=new r(va.UpsampleInfo);Aa._rootTilesExtent=J.create();Aa._maxNumUpdating=1;Aa.maxTextureScale=1.2;Aa.backgroundImage=
ia.DEFAULT_TILE_BACKGROUND;Aa.backgroundColor=null;Aa._layerViewsDirty=!1;return Aa}b._inheritsLoose(Za,ab);var Pa=Za.prototype;Pa.initialize=function(){this._lercDecoder=M.acquireDecoder(this.view.resourceController);this._tilePool=this.view.state.isLocal?new r(ba.PlanarPatch):new r(ka.SphericalPatch);var ua=this.view.resourceController.memoryController;this._upsampleMapCache=ua.newCache("esri.views.3d.terrain.upsample",Aa=>Aa.unloadMapData());this._elevationQueryCache=new P.ElevationQueryTileCache(ua.newCache("elevation-query"));
this._set("overlayManager",new X.OverlayManager({surface:this}));this._handles.add([this.watch("overlayManager.hasHighlights",Aa=>this._renderer.setNeedsHighlight(Aa)),this.watch("overlayManager.rendersOccluded",Aa=>this._renderer.setRenderOccludedOverlay(Aa))],"overlayManager");this._renderer=new ea({overlayRenderer:this.overlayManager.renderer,ellipsoidRadius:G.getReferenceEllipsoid(this.view.spatialReference).radius,stage:this.view._stage,allTiles:this._allTiles});this._handles.add([m.init(this,
"baseOpacity",Aa=>{this._handleLayerViewChanges();this._updateBaseOpacity(Aa)},!0),m.init(this,"_background",()=>{this._handleLayerViewChanges();this._renderer.setTileBackground(this._background)},!0),this.view.watch("pointsOfInterest",Aa=>{this._renderer.pointsOfInterest=Aa;this._watchUpdatingTracking.removeAll();Aa&&this._watchUpdatingTracking.add(()=>Aa.focus.renderLocation,()=>()=>this._allTilesSorted=!1)}),m.init(N,"TERRAIN_TILE_TREE_SHOW_TILES",Aa=>{Aa&&!this._treeDebugger?(new Promise((Ia,
Na)=>a(["../layers/support/TerrainTileTree3DDebugger"],Ia,Na))).then(({TerrainTileTree3DDebugger:Ia})=>{!this._treeDebugger&&N.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new Ia({view:this.view}))}):Aa||(this._treeDebugger=k.destroyMaybe(this._treeDebugger))})]);this._extentHelper=V.create(this.viewingMode,{layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,viewSpatialReference:this.view.spatialReference});ua=this.view.defaultsFromMap?new w({getCollections:()=>{var Aa,Ia,Na;return null==
(Aa=this.view)?void 0:null==(Ia=Aa.defaultsFromMap)?void 0:null==(Na=Ia.mapCollections)?void 0:Na.map(({layers:Sa})=>Sa)},getChildrenFunction:Aa=>Aa&&"layers"in Aa?Aa.layers:null}):this.view.map.allLayers;ua=new ra.TilingSchemeLogic({layers:ua,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:this.view.spatialReference});this._set("tilingSchemeLogic",ua);this._updateTilingScheme();this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(S.ClientType.ELEVATION);
this._mapDataRequester=this.view.resourceController.createStreamDataRequester(S.ClientType.BASEMAP);this._frameTask=this.view.resourceController.scheduler.registerTask(za.TaskPriority.TERRAIN_SURFACE,this);this.view.resourceController.memoryController.events.on("quality-changed",()=>this._viewChangeUpdate());this._handles.add([m.init(this._extentHelper,"stencilEnabledExtents",Aa=>this._renderer.setStencilEnabledLayerExtents(Aa)),this.tilingSchemeLogic.watch("tilingScheme",()=>this._updateTilingScheme(),
!0),m.init(this,"extent",()=>this._updateRootTiles()),this.view.on("resize",()=>this._viewChangeUpdate()),this.view.watch("state.camera",()=>this._viewChangeUpdate(),!0),this.view.watch("state.contentCamera",()=>this.view.state.fixedContentCamera&&this._viewChangeUpdate(),!0),this.view.watch("qualitySettings.tiledSurface.lodBias",()=>this._viewChangeUpdate()),m.init(this.view,"qualitySettings.tiledSurface.textureFadeDuration",Aa=>this._renderer.textureFadingEnabled=0<Aa),this.view.watch("lodSnapping",
()=>this._viewChangeUpdate()),h.watch(()=>this._userClippingExtent,()=>this._updateClippingExtent(),h.sync)]);this._handles.add(this.view.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0));this._layerViewsDirty=!0;this._handleLayerViewChanges()};Pa.destroy=function(){this._frameTask.remove();this._handles.destroy();this._watchUpdatingTracking.destroy();this._lercDecoder=k.releaseMaybe(this._lercDecoder);this._removeAllTiles();this._upsampleMapCache=k.destroyMaybe(this._upsampleMapCache);
this._elevationQueryCache=k.destroyMaybe(this._elevationQueryCache);this._set("tilingSchemeLogic",k.destroyMaybe(this.tilingSchemeLogic));this._extentHelper=k.destroyMaybe(this._extentHelper);this._basemapLayerViewHandles.forEach((ua,Aa)=>this._unregisterTiledLayerView(Aa));this._mapDataRequester=this._elevationDataRequester=null;this._set("overlayManager",k.destroyMaybe(this.overlayManager));this._tilePool=k.destroyMaybe(this._tilePool);fa.Tile.prune();this._treeDebugger&&(this._treeDebugger.destroy(),
this._treeDebugger=null);this._renderer=k.destroyMaybe(this._renderer);this._iteratorPool=k.destroyMaybe(this._iteratorPool);this._set("view",null);this._upsampleInfoPool=k.destroyMaybe(this._upsampleInfoPool);U.printAllocations();ja.printAllocations()};Pa.intersect=function(ua,Aa,Ia,Na){this._renderer.intersect(ua,Aa,Ia,Na)};Pa.getElevation=function(ua,Aa,Ia,Na){ua=this.getTileWithElevation(ua,Aa,Ia,Na,ta);return k.isNone(ua)?null:W.sampleElevation(ta[0],ta[1],ua.renderData.geometryState.samplerData)};
Pa.getTileWithElevation=function(ua,Aa,Ia,Na,Sa=ta){var Ua;const Ya=this.rootTiles;if(k.isNone(Ya)||!Ya.length||0===Ya[0].layerInfo[aa.LayerClass.ELEVATION].length)return null;Sa[0]=ua;Sa[1]=Aa;Sa[2]=Ia;if(!F.projectVectorToVector(Sa,Na,Sa,null==(Ua=this.tilingScheme)?void 0:Ua.spatialReference))return qa.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;for(let $a of Ya)if($a.containsPoint(Sa)){for(;$a&&!$a.rendered&&!$a.isLeaf;)ua=0,Sa[0]>
.5*($a.extent[0]+$a.extent[2])&&(ua+=1),Sa[1]<.5*($a.extent[1]+$a.extent[3])&&(ua+=2),$a=$a.children[ua];if((Sa=$a.renderData)&&Sa.geometryState.samplerData)return $a;break}return null};Pa.getScale=function(ua){if(this.tilingScheme){if(!F.projectPointToVector(ua,ta,this.spatialReference))return qa.error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;ua=this.rootTiles;if(k.isSome(ua))for(let Aa of ua)if(Aa.containsPoint(ta)){for(;null!=Aa.children[0];)ua=
0,ta[0]>Aa.children[0].extent[2]&&(ua+=1),ta[1]<Aa.children[0].extent[1]&&(ua+=2),Aa=Aa.children[ua];return this._getLodBiasCorrectedScale(Aa.level)}}return 1E100};Pa.getSphereScale=function(ua,Aa){if(!this.tilingScheme)return null;if(!F.projectPointToVector(ua,ta,this.spatialReference))return qa.error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;ta[3]=Aa;let Ia=null;const Na=Sa=>{if(Sa&&J.intersectsSphere(Sa.extent,ta))if(null!=Sa.children[0])for(const Ua of Sa.children)Na(Ua);
else Sa=this._getLodBiasCorrectedScale(Sa.level),Ia=null==Ia?Sa:Math.min(Ia,Sa)};ua=this.rootTiles;if(k.isSome(ua))for(const Sa of ua)Na(Sa);return Ia};Pa.queryVisibleScaleRange=function(ua,Aa,Ia,Na){Aa=Aa?this.tilingScheme.levelAtScale(Aa):0;Ia=Ia?this.tilingScheme.levelAtScale(Ia):Infinity;const Sa=this.lodBias;this._renderer.queryVisibleLevelRange(ua,Aa+Sa,Ia+Sa,Na)};Pa._updateBaseOpacity=function(ua){const Aa=this._renderer.opaque;this._renderer.opaque=1<=ua;this._renderer.isTransparent=this._allTransparentSurfaceLayers();
ua=Aa===this._renderer.opaque?Y.TextureUpdate.UNFADED:Y.TextureUpdate.IMMEDIATE;if(ua===Y.TextureUpdate.IMMEDIATE){var Ia,Na;null==(Ia=this.view)?void 0:null==(Na=Ia._stage)?void 0:Na.renderView.setRenderParameters({opaqueTerrain:this.opaque})}this._updateTileTextures(ua)};Pa._updateTilingScheme=function(){const ua=this.tilingSchemeLogic.tilingScheme;ua!==this.tilingScheme&&(Z.weakAssert(!!ua,"tiling scheme cannot be reset to undefined"),this.tilingScheme&&this._removeAllTiles(),this._set("tilingScheme",
ua),this._updateClippingExtent(),ua&&(this._updateTiledLayers(),this._renderer.setTileSize(ua.pixelSize),this.overlayManager.setSpatialReference(ua.spatialReference),this._updateRootTiles()))};Pa._acquireTile=function(ua,Aa,Ia,Na){const Sa=this._tilePool.acquire();Ha[0]=ua;Ha[1]=Aa;Ha[2]=Ia;Sa.init(Ha,Na,this);return Sa};Pa._updateRootTiles=function(){const {extent:ua,tilingScheme:Aa}=this;if(Aa){var Ia=Fa,Na=Aa.rootTilesInExtent(ua,Ia,5*ia.MAX_ROOT_TILES);if(k.isSome(this.rootTiles)){if(Na.length>
ia.MAX_ROOT_TILES){qa.warn(ia.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR);return}const Sa=this.rootTiles.map(Ya=>Ya.lij),Ua=x.difference(Sa,Na,wa);if(0<Ua.removed.length||0<Ua.added.length){const Ya=this.rootTiles.filter($a=>-1<Ua.removed.findIndex(sa=>wa(sa,$a.lij))?(this._purgeTile($a),!1):!0);Ua.added.forEach($a=>Ya.push(this._newRootTile($a)));this._setRootTiles(Ya)}}else Na.length>ia.MAX_ROOT_TILES&&(qa.warn(ia.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR),Na=Aa.rootTilesInExtent(ua,Ia,ia.MAX_ROOT_TILES)),
this._setRootTiles(Na.map(Sa=>this._newRootTile(Sa)));J.equals(Ia,this._rootTilesExtent)||(this._rootTilesExtent=J.create(Ia));this.visible=!0;this._viewChangeUpdate();this.overlayManager.setPlacementDirty();this.notifyChange("ready")}};Pa._newRootTile=function(ua){ua=this._acquireTile(0,ua[1],ua[2],null);ua.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)===la.TileUpdate.SPLIT&&ua.setPendingUpdate(la.TileUpdate.SPLIT);this._loadTile(ua);return ua};Pa._setRootTiles=function(ua){this._set("rootTiles",
ua);this._allTiles.clear();if(k.isSome(ua)){const Aa=this._iteratorPool.acquire();for(Aa.reset(ua);!Aa.done;)this._allTiles.push(Aa.next());Aa.remove()}this._renderer.setRootTiles(this.rootTiles);this._updateTilesVisibility(ua)};Pa._runViewChangeUpdateIfDirty=function(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())};Pa._viewChangeUpdate=function(){this.view&&!this.suspended&&this.tilingScheme&&this._visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:
(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateSkirts(),this._updateTilesVisibility(this.rootTiles)))};Pa._updateClippingStatus=function(ua){ua.updateClippingStatus(this.extent)&&ua.resetPendingUpdate(la.TileUpdate.GEOMETRY)&&this._updateTileGeometry(ua)};Pa._updateTilesVisibility=function(ua){if(!k.isNone(ua)){var Aa=ma.hasLoadableSiblings(ua),Ia=Aa?this._elevationBounds.min:Infinity;Aa=Aa?this._elevationBounds.max:-Infinity;var Na=this.view.state.fixedContentCamera,
Sa=this.extent,Ua=this._viewProjectionMatrix;this.setTileTreeDirty();var Ya=this._iteratorPool.acquire();for(Ya.reset(ua);!Ya.done;){ua=Ya.next();ua.updateClippingStatus(Sa)&&ua.resetPendingUpdate(la.TileUpdate.GEOMETRY)&&this._updateTileGeometry(ua);ua.setPendingUpdate(la.TileUpdate.RENDERDATA);const $a=ua.computeVisibility();Na||$a?(ua.updateScreenDepth(Ua),ua.renderData&&(Ia=Math.min(ua.elevationBounds[0],Ia),Aa=Math.max(ua.elevationBounds[1],Aa))):Ya.skipSubtree()}Ya.remove();this._allTilesDirty=
this._viewChanged=!0;isFinite(Ia)&&isFinite(Aa)&&(this._elevationBounds.min!==Ia||this._elevationBounds.max!==Aa)&&(this._elevationBounds.min=Ia,this._elevationBounds.max=Aa,this.emit("elevation-bounds-change",null))}};Pa._updateViewDependentParameters=function(){const ua=this.view.state.camera,Aa=this.view.state.contentCamera,Ia=Math.tan(.5*Aa.fovX),Na=Math.tan(.5*Aa.fovY),Sa=this.tilingScheme.pixelSize,Ua=2**-this.lodBias*ua.pixelRatio;this._splitLimits.aboveGround=ua.aboveGround;this._splitLimits.fovX=
Ia;this._splitLimits.fovY=Na;this._splitLimits.relativeWidthLimit=Sa/ua.width*this.maxTextureScale*Ua;this._splitLimits.relativeHeightLimit=Sa/ua.height*this.maxTextureScale*Ua;this._splitLimits.maxLod=this.tilingScheme.getMaxLod();this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias;this.view.state.fixedContentCamera?(k.isNone(this._splitLimits.frustum)&&(this._splitLimits.frustum=I.create()),I.copy(this._splitLimits.frustum,Aa.frustum)):this._splitLimits.frustum=
null;I.copy(this._frustum,ua.frustum);B.multiply(this._viewProjectionMatrix,Aa.projectionMatrix,Aa.viewMatrix);E.copy(this._eyePosRenderSR,Aa.eye);F.projectVectorToVector(ua.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)};Pa._updateSkirts=function(){const ua=this.view.state.camera;this.skirtScale=Z.computeSkirtScale(this,this._eyePosSurfaceSR,this.view.state.constraints.collision.enabled?0:1.11*ua.near)};Pa._updateRenderData=function(ua){ua.rendered&&!ua.shouldLoad&&
(na(ua)?this._loadChildren(ua):ua.isLeaf&&ua.parent&&ua.parent.shouldLoad&&this._loadParent(ua))};Pa._updateTileGeometry=function(ua){ua.updateVisibility();this._renderer.updateTileGeometry(ua);this._elevationUpdate(ua);this._usedMemory=-1};Pa._updateTileTexture=function(ua,Aa){const Ia=ua.resetPendingUpdate(la.TileUpdate.TEXTURE_FADING)?la.TileUpdate.TEXTURE_FADING:ua.resetPendingUpdate(la.TileUpdate.TEXTURE_NOFADING)?la.TileUpdate.TEXTURE_NOFADING:!1;Ia&&(this._renderer.updateTileTexture(ua,Ia),
this._usedMemory=-1,Aa.madeProgress())};Pa._elevationUpdate=function(ua){La.spatialReference=this.spatialReference;La.tile=ua;La.extent=ua.extent;this.emit("elevation-change",La);J.containsPoint(ua.extent,this._eyePosSurfaceSR)&&this._updateSkirts()};Pa.runTask=function(ua){this._handleLayerViewChanges(ua);this._frameTask.processQueue(ua);this._inFrameTask=!0;this._pendingUpdates=0;this._hasPendingUpdates=!1;this._updateTileStatus(ua);this._sortTiles(ua);const Aa=!this.view.state.fixedContentCamera;
this._mergeAndSplit(ua,Aa);ua.run(()=>this._updateElevation(ua));ua.run(()=>this._updateTextures(ua));Aa||this._mergeAndSplit(ua,!0);this._inFrameTask=!1;this._runViewChangeUpdateIfDirty();ua.done&&this.requestUpdate();this.notifyChange("updatingProgressValue")};Pa._updateTileStatus=function(ua){if(this._viewChanged&&this.rootTiles&&!ua.done){this._viewChanged=!1;var Aa=this._iteratorPool.acquire();for(Aa.reset(this.rootTiles);!Aa.done;){var Ia=Aa.next();if(Ia.loadable){var Na=Ia.shouldSplit(this._splitLimits,
this._eyePosRenderSR,this.lodSnapping);if(Na===la.TileUpdate.SPLIT){Ia.resetPendingUpdate(la.TileUpdate.MERGE);Ia.isLeaf&&(Ia.setPendingUpdate(la.TileUpdate.SPLIT),Aa.skipSubtree());continue}Ia.resetPendingUpdate(la.TileUpdate.SPLIT)&&Ia.updateAgentSuspension();Na===la.TileUpdate.VSPLITMERGE&&Ia.updateAgents(aa.LayerClass.ELEVATION)}Aa.skipSubtree();if(!Ia.isLeaf){Ia.setPendingUpdate(la.TileUpdate.MERGE);Ia.resetPendingUpdate(la.TileUpdate.SPLIT);Na=this._iteratorPool.acquire();Na.resetOne(Ia);for(Ia=
Na.next();!Na.done;Ia=Na.next())this._updateClippingStatus(Ia),Ia.updateVisibility(),Ia.loadable&&Ia.updateScreenDepth(this._viewProjectionMatrix);Na.remove()}}Aa.remove();this.requestUpdate();ua.madeProgress()}};Pa._sortTiles=function(ua){ua.done||this._allTilesSorted||(ma.sortTilesByPOI(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),ua.madeProgress())};Pa._mergeAndSplit=function(ua,Aa){if(!this.suspended&&!ua.done&&
this._allTilesDirty){this._allTilesDirty=!1;this.requestUpdate();for(var Ia=0;!ua.done;){let Na=!1;Ia=0;const Sa=!this._allTiles.some(Ua=>{Ia+=Ua.usedMemory;if(Ua.resetPendingUpdate(la.TileUpdate.MERGE)){if(!Aa)return Ua.setPendingUpdate(la.TileUpdate.MERGE),ua.done;this._mergeTile(Ua);Na=!0;ua.madeProgress()}else Ua.resetPendingUpdate(la.TileUpdate.SPLIT)&&(this._splitTile(Ua),Na=!0,ua.madeProgress());!ua.done&&Ua.resetPendingUpdate(la.TileUpdate.RENDERDATA)&&(this._updateRenderData(Ua),ua.madeProgress());
return ua.done});Na&&(this._allTilesSorted=!1,this._allTilesDirty=!0);if(Sa){this._usedMemory=Ia;if(!Na)break;this._updateTilesVisibility(this.rootTiles)}else this._allTilesDirty=!0}0===Ia&&(this._allTilesDirty=!0);this._sortTiles(ua)}};Pa._updateElevation=function(ua){this._allTiles.some(Aa=>{Aa.resetPendingUpdate(la.TileUpdate.GEOMETRY)&&(this._updateTileGeometry(Aa),this._updateTileTexture(Aa,ua),ua.madeProgress());return ua.done});return ua.hasProgressed};Pa._updateTextures=function(ua){this._allTiles.some(Aa=>
{this._updateTileTexture(Aa,ua);return ua.done});return ua.hasProgressed};Pa._updateClippingExtent=function(){this.spatialReference&&(this.updateTileOverlayParams(ya.RenderRequestType.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())};Pa._getLodBiasCorrectedScale=function(ua){const Aa=this.tilingScheme.levels;ua=e.clamp(ua-this.lodBias,0,Aa.length-1);const Ia=ua-Math.floor(ua);return Aa[Math.floor(ua)].scale*(1-Ia)+Aa[Math.ceil(ua)].scale*Ia};Pa._removeAllTiles=function(){k.isSome(this.rootTiles)&&
(this.rootTiles.forEach(ua=>this._purgeTile(ua)),this._setRootTiles(null),this.notifyChange("ready"));this._allTiles.clear();this.visible=!1};Pa._purgeChildTiles=function(ua){if(ua.isLeaf)return!1;let Aa=this._purgeTile(ua.children[0]);Aa=this._purgeTile(ua.children[1])||Aa;Aa=this._purgeTile(ua.children[2])||Aa;Aa=this._purgeTile(ua.children[3])||Aa;ua.unsetChildren();return Aa};Pa._purgeTile=function(ua){const Aa=this._purgeChildTiles(ua)||ua.rendered;this._allTiles.removeUnordered(ua);ua.unload(this._renderer);
this._tilePool.release(ua);return Aa};Pa._splitTile=function(ua){Z.weakAssert(ua.isLeaf,"tile that is already split should not be split again!");const Aa=ua.level+1,Ia=2*ua.lij[1],Na=2*ua.lij[2];ua.setChildren(this._createTile(Aa,Ia,Na,ua),this._createTile(Aa,Ia,Na+1,ua),this._createTile(Aa,Ia+1,Na,ua),this._createTile(Aa,Ia+1,Na+1,ua));ua.setPendingUpdate(la.TileUpdate.RENDERDATA);ua.updateAgentSuspension();this._allTiles.pushArray(ua.children);this._allTilesDirty=!0;this._emitTileScaleChange(ua,
Aa);++this._performanceInfo.numSplit};Pa._emitTileScaleChange=function(ua,Aa=ua.level){Ra.spatialReference=this.spatialReference;Ra.extent=ua.extent;Ra.scale=this._getLodBiasCorrectedScale(Aa);this.emit("scale-change",Ra)};Pa._createTile=function(ua,Aa,Ia,Na){Z.weakAssert(!!Na,"_createTile sanity check");ua=this._acquireTile(ua,Aa,Ia,Na);ua.updateClippingStatus(this.extent);ua.loadable&&(ua.updateScreenDepth(this._viewProjectionMatrix),ua.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)===
la.TileUpdate.SPLIT&&ua.setPendingUpdate(la.TileUpdate.SPLIT));return ua};Pa._mergeTile=function(ua){Z.weakAssert(!ua.hasPendingUpdate(la.TileUpdate.SPLIT),"_mergeTile sanity check");this._purgeChildTiles(ua)&&(Z.weakAssert(!ua.renderData,"_mergeTile sanity check"),this._loadTile(ua));this._allTilesDirty=!0;++this._performanceInfo.numMerged;this._emitTileScaleChange(ua)};Pa._loadChildren=function(ua){Z.weakAssert(ua.rendered,"parent should be rendered");ua.unload(this._renderer);this._loadTile(ua.children[0]);
this._loadTile(ua.children[1]);this._loadTile(ua.children[2]);this._loadTile(ua.children[3])};Pa._loadParent=function(ua){ua=ua.parent;this._unloadChildren(ua);this._loadTile(ua)};Pa._unloadChildren=function(ua){ua.isLeaf||(this._unloadChildren(ua.children[0]),ua.children[0].unload(this._renderer),this._unloadChildren(ua.children[1]),ua.children[1].unload(this._renderer),this._unloadChildren(ua.children[2]),ua.children[2].unload(this._renderer),this._unloadChildren(ua.children[3]),ua.children[3].unload(this._renderer))};
Pa._loadTile=function(ua){ua.load(this._renderer);ua.setPendingUpdate(la.TileUpdate.RENDERDATA);this.requestUpdate();this._allTilesDirty=!0;this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(ua);this._elevationUpdate(ua)};Pa._elevationDataArrived=function(ua,Aa,Ia){Ia=new W.ElevationData(ua.lij,ua.extent,Ia);ua.dataArrived(Aa,aa.LayerClass.ELEVATION,Ia);Ia=[ua];ua=ua.level;const Na=this._iteratorPool.acquire();for(Na.reset(Ia);!Na.done;){const Sa=Na.next();
Sa.findElevationBoundsForLayer(Aa,ua);Sa.computeElevationBounds()}Na.remove();this._updateTilesVisibility(Ia)};Pa._handleLayerViewChanges=function(ua=za.noBudget){if(this._layerViewsDirty){var Aa=this._layerViewsDirty=!1,Ia=new Set,Na=-1;for(const Ua of this.view.allLayerViews.items)if(Ia.add(Ua.uid),Z.isSurfaceLayerView(Ua))if(this._basemapLayerViewHandles.has(Ua.uid)){var Sa=this._layerClassFromLayerView(Ua);Sa=this._layerIndexByUid[Sa].get(Ua.uid);Sa<Na&&(Aa=!0);Na=Sa}else this._registerTiledLayerView(Ua),
Ua.layer.loaded&&(Aa=!0);this._basemapLayerViewHandles.forEach((Ua,Ya)=>{Ia.has(Ya)||(this._unregisterTiledLayerView(Ya),Aa=!0)});Aa&&this._updateTiledLayers();this._renderer.isTransparent=this._allTransparentSurfaceLayers();ua.madeProgress()}};Pa._allTransparentSurfaceLayers=function(){var ua,Aa;let Ia=0===(null==(ua=this.view.map)?void 0:null==(Aa=ua.ground)?void 0:Aa.opacity);for(const Na of this.view.allLayerViews.items)if(Z.isSurfaceLayerView(Na)&&!Z.isElevationLayerView(Na)&&!K.isBaseLayer(Na.layer)&&
0!==Na.fullOpacity){Ia=!1;break}return Ia};Pa._layerClassFromLayerView=function(ua){return Z.isElevationLayerView(ua)?aa.LayerClass.ELEVATION:aa.LayerClass.MAP};Pa._registerTiledLayerView=function(ua){const Aa=[],Ia=this._layerClassFromLayerView(ua);Aa.push(ua.watch("suspended",()=>this._updateTiledLayers()));Aa.push(ua.watch("fullOpacity",()=>this._updateTileTextures(Y.TextureUpdate.UNFADED)));Aa.push(ua.layer.watch("effectiveScaleRange",()=>this._restartAllAgents(Ia)));ua.on("data-changed",()=>
{const Na=this._layerIndexByUid[Ia].get(ua.uid);null!=Na&&this._invalidateLayerData(Na,Ia)});this._basemapLayerViewHandles.set(ua.uid,Aa)};Pa._unregisterTiledLayerView=function(ua){const Aa=this._basemapLayerViewHandles.get(ua);if(Aa){for(let Ia=0;Ia<Aa.length;Ia++)Aa[Ia].remove();this._basemapLayerViewHandles.delete(ua)}};Pa._updateTiledLayers=function(){if(this.tilingScheme&&!this.view.suspended){var ua=this.view.allLayerViews,Aa=[[],[]],Ia=null,Na=J.empty();ua.forEach(Ua=>{var Ya=Ua.layer;if(Ya&&
!Ua.suspended&&Z.isSurfaceLayerView(Ua)){var $a=Ua.fullExtent;$a?(J.expand(Na,$a,Na),Ya=this._layerClassFromLayerView(Ua),Ya===aa.LayerClass.MAP&&($a=Ua.displayLevelRange,Infinity!==$a.maxLevel&&(null===Ia||$a.maxLevel>Ia)&&(Ia=$a.maxLevel)),Aa[Ya].push(Ua)):qa.warn("Terrain: Map or elevation layer does not have fullExtent: "+Ya.id)}});for(const Ua of aa.LayerClasses){var Sa=this._layerViews[Ua];ua=Aa[Ua];ua.reverse();const Ya=ua.length;let $a=Sa.length!==Ya;const sa=Array(Ya),Ca=Array(Sa.length);
this._layerIndexByUid[Ua].clear();for(let Ma=0;Ma<Ya;Ma++){this._layerIndexByUid[Ua].set(ua[Ma].uid,Ma);const Xa=Sa.indexOf(ua[Ma]);sa[Ma]=Xa;Ma!==Xa&&($a=!0);-1<Xa&&(Ca[Xa]=Ma)}if($a){Sa=this._postorderIterator;for(Sa.reset(this.rootTiles);!Sa.done;)Sa.next().modifyLayers(Ca,sa,Ua);this._layerViews[Ua]=ua;this._restartAllAgents(Ua);this._updateTilesVisibility(this.rootTiles)}}this.tilingScheme.ensureMaxLod(Ia)&&this._viewChangeUpdate()}};Pa._restartAllAgents=function(ua){const Aa=this._postorderIterator;
for(Aa.reset(this.rootTiles);!Aa.done;){const Ia=Aa.next();Ia.restartAgents(ua);ua===aa.LayerClass.ELEVATION&&Ia.computeElevationBounds()}};Pa.layerViewByIndex=function(ua,Aa){return this._layerViews[Aa][ua]};Pa.numLayers=function(ua){return this._layerViews[ua].length};Pa._updateTileTextures=function(ua){this._allTiles.forAll(Aa=>{Aa.updateAgents(aa.LayerClass.MAP);ua===Y.TextureUpdate.IMMEDIATE?this.renderer.updateTileTexture(Aa,la.TileUpdate.TEXTURE_NOFADING):Aa.updateRenderData(aa.LayerClass.MAP,
ua)});this._renderer.isTransparent=this._allTransparentSurfaceLayers()};Pa._invalidateLayerData=function(ua,Aa){this._allTiles.forAll(Ia=>Ia.removeLayerAgent(ua,Aa));this._allTiles.forAll(Ia=>Ia.invalidateLayerData(ua,Aa))};Pa.setTileTreeDirty=function(){this._allTilesDirty=!0};Pa.requestRender=function(ua=ya.RenderRequestType.UPDATE){this.renderer.setNeedsRender(ua)};Pa.requestUpdate=function(){1===++this._pendingUpdates&&(this._hasPendingUpdates=!0)};Pa.requestTileData=function(ua,Aa,Ia,Na){const Sa=
this.layerViewByIndex(Aa,Ia);Aa=Sa.layer;if(!Aa.tilemapCache||Z.isVectorTileLayerView(Sa))return this._requestTileData(ua,Ia,Sa,Na);++this._asyncWorkItems;return Aa.tilemapCache.fetchAvailability(ua.lij[0],ua.lij[1],ua.lij[2],{...Na,timeout:6E3}).then(()=>--this._asyncWorkItems).catch(Ua=>{--this._asyncWorkItems;p.isAbortError(Ua)||this._dataMissing(ua,Ia,Sa,{notInTilemap:!0});throw Ua;}).then(()=>this._frameTask.schedule(()=>this._requestTileData(ua,Ia,Sa,Na),Na.signal))};Pa._requestTileData=function(ua,
Aa,Ia,Na){return Aa===aa.LayerClass.ELEVATION?this._requestElevationTileData(ua,Ia,Na):this._requestMapTileData(ua,Ia,Na)};Pa._requestElevationTileData=function(ua,Aa,Ia){if(Z.isElevationLayerView(Aa)){var Na=Ya=>{--this._asyncWorkItems;if(!p.isAborted(Ia)){var $a=this._layerIndexByUid[aa.LayerClass.ELEVATION].get(Aa.uid);null==$a?qa.warn("TerrainSurface: received data from unknown layer %d %s",aa.LayerClass.ELEVATION,ua.lij.toString()):(this._usedMemory=-1,this.requestUpdate(),this._elevationDataArrived(ua,
$a,Ya))}},Sa=Ya=>{--this._asyncWorkItems;p.isAbortError(Ya)||(this._dataMissing(ua,aa.LayerClass.ELEVATION,Aa,Ya),this.requestUpdate())};++this._asyncWorkItems;if(Z.useFetchTileForLayer(Aa.layer))return Aa.layer.fetchTile(ua.lij[0],ua.lij[1],ua.lij[2],{noDataValue:ia.ELEVATION_NODATA_VALUE,signal:Ia.signal}).then(Ya=>{p.isAborted(Ia)?(qa.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),Sa(p.createAbortError())):
this._frameTask.schedule(()=>Na(Ya),Ia.signal,Sa)},Sa);var Ua=Aa.getTileUrl(ua.lij[0],ua.lij[1],ua.lij[2]);return this._elevationDataRequester.request(Ua,"binary",Ia).then(Ya=>this._lercDecoder.decode(Ya,{noDataValue:ia.ELEVATION_NODATA_VALUE},Ia.signal)).then(Ya=>{Na({values:Ya.pixelData,width:Ya.width,height:Ya.height,noDataValue:Ya.noDataValue,minValue:Ya.minValue,maxValue:Ya.maxValue})},Sa)}Z.weakAssert(!1,"_requestElevationTileData can only be called for elevation layer views")};Pa._requestMapTileData=
function(ua,Aa,Ia){if(Aa instanceof R)return Promise.reject();++this._asyncWorkItems;const Na=(sa,Ca)=>{--this._asyncWorkItems;Z.releaseTileData(Ca);p.isAborted(Ia)||(this._dataMissing(ua,aa.LayerClass.MAP,Aa,sa),this.requestUpdate())},Sa=sa=>Ca=>Na(Ca,sa),Ua=sa=>this._frameTask.schedule(()=>{--this._asyncWorkItems;this.requestUpdate();p.isAborted(Ia)?Z.releaseTileData(sa):this._mapTileDataArrived(ua,Aa,sa)},Ia.signal,Sa(sa)).catch(Sa(sa)),Ya=(sa,Ca=null)=>this._frameTask.schedule(()=>Na(sa,Ca));
if(Z.isVectorTileLayerView(Aa)){var $a=Aa.schemaHelper.getLevelRowColumn(ua.lij);return Aa.fetchTile($a[0],$a[1],$a[2],Ia).then(Ua,Ya)}if(Z.isImageryTileLayerView(Aa))return Aa.fetchTile(ua.lij[0],ua.lij[1],ua.lij[2],Ia).then(Ua,Ya);if(Z.isTileLayerView(Aa)&&Z.useFetchTileForLayer(Aa.layer))return Aa.layer.fetchTile(ua.lij[0],ua.lij[1],ua.lij[2],Ia).then(sa=>{p.isAborted(Ia)?(qa.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),
Ya(p.createAbortError())):Ua(sa)},Ya);$a=Aa.getTileUrl(ua.lij[0],ua.lij[1],ua.lij[2]);O.isRefreshableLayer(Aa.layer)&&Aa.layer.refreshTimestamp&&($a+=`${$a.includes("?")?"\x26":"?"}_ts=${Aa.layer.refreshTimestamp}`);return this._mapDataRequester.request($a,Aa.hasMixedImageFormats?"image+type":"image",Ia).then(Ua,Ya)};Pa._mapTileDataArrived=function(ua,Aa,Ia){Aa=this._layerIndexByUid[aa.LayerClass.MAP].get(Aa.uid);null!=Aa?ua.dataArrived(Aa,aa.LayerClass.MAP,Ia):(Z.releaseTileData(Ia),qa.warn("TerrainSurface: received data from unknown layer"))};
Pa._dataMissing=function(ua,Aa,Ia,Na){Ia=this._layerIndexByUid[Aa].get(Ia.uid);null!=Ia?ua.dataMissing(Ia,Aa,Na):qa.warn("TerrainSurface: received data from unknown layer")};Pa.updateTileOverlayParams=function(ua){this.rootTiles&&this.overlayManager&&(this._allTiles.forAll(Aa=>{Aa.renderData&&this.overlayManager.setTileParameters(Aa)}),this._renderer.setNeedsRender(ua))};Pa.getUsedMemory=function(){if(!this.tilingScheme)return 0;-1===this._usedMemory&&(this._usedMemory=0,this._allTiles.forAll(ua=>
this._usedMemory+=ua.usedMemory));return this._usedMemory};Pa.getUsedMemoryForLayerView=function(ua){let Aa=0;const Ia=this._layerClassFromLayerView(ua),Na=this._layerIndexByUid[Ia].get(ua.uid);this._allTiles.forAll(Sa=>Aa+=Sa.getUsedMemoryForLayer(Ia,Na));return Aa};Pa.getTile=function(ua){if(k.isNone(ua)||k.isNone(this.rootTiles))return null;const Aa=ua.split("/").map(Ua=>+Ua);if(0===Aa[0])return this.rootTiles.find(Ua=>Ua.lij[1]===Aa[1]&&Ua.lij[2]===Aa[2]);ua=2**Aa[0];const Ia=Math.floor(Aa[1]/
ua),Na=Math.floor(Aa[2]/ua);let Sa;this.rootTiles.some(Ua=>Ua.lij[1]===Ia&&Ua.lij[2]===Na?(Sa=Ua,!0):!1);if(Sa){for(ua=1<<Aa[0]-1;Sa.lij[0]<Aa[0];){let Ua=Aa[1]&ua?2:0;0<(Aa[2]&ua)&&Ua++;if(!Sa.children[Ua])return null;Sa=Sa.children[Ua];ua>>=1}Z.weakAssert(Sa.lij[0]===Aa[0]&&Sa.lij[1]===Aa[1]&&Sa.lij[2]===Aa[2],"not the right tile?");return Sa}return null};b._createClass(Za,[{key:"renderer",get:function(){return this._renderer}},{key:"frustum",get:function(){return this._frustum}},{key:"snapLevel",
get:function(){var ua,Aa,Ia=null==(ua=this.view.pointsOfInterest)?void 0:null==(Aa=ua.contentCameraOnSurface)?void 0:Aa.scale;Ia&&(ua=this.view.state.contentCamera,ua=L.directionToHeadingTilt(this.view,ua.eye,ua.viewForward,ua.up).tilt,90<ua&&(ua=180-ua),ua=2*(ua/90)**2,Ia=L.scaleToZoom(this.view,Ia)-ua,.25<Math.abs(this._snapLevel-Ia)&&(Math.round(Ia)!==Math.round(this._snapLevel)&&(this._viewChanged=!0),this._snapLevel=Ia));return Math.round(this._snapLevel)}},{key:"lodSnapping",get:function(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?
Y.LODSnapping.ON:Y.LODSnapping.OFF}},{key:"upsampleInfoPool",get:function(){return this._upsampleInfoPool}},{key:"upsampleMapCache",get:function(){return this._upsampleMapCache}},{key:"elevationQueryCache",get:function(){return this._elevationQueryCache}},{key:"mapTileRequester",get:function(){return this._mapDataRequester}},{key:"_userClippingExtent",get:function(){var {spatialReference:ua}=this,{clippingArea:Aa}=this.view;if(k.isNone(Aa)||k.isNone(ua))return null;const Ia=J.create();ua=T.toBoundingRect(Aa,
Ia,ua)?Ia:null;Aa=this._get("extent");return J.equals(ua,Aa)?Aa:ua}},{key:"extent",get:function(){const ua=J.intersection(this.groundExtent,this._userClippingExtent,J.create()),Aa=this._get("extent");return J.equals(ua,Aa)?Aa:ua}},{key:"groundExtent",get:function(){return k.isSome(this._tilingSchemeExtent)?this._tilingSchemeExtent:this._rootTilesExtent}},{key:"_tilingSchemeExtent",get:function(){var ua;return null==(ua=this.tilingSchemeLogic)?void 0:ua.extent}},{key:"updating",get:function(){this._hasPendingUpdates||
(this._maxNumUpdating=1);return!!((this._watchUpdatingTracking.updating||this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||0<this._asyncWorkItems||!this._allTilesSorted||this._renderer.updating||this._layerViewsDirty)&&this.ready&&!this.suspended||this.overlayManager.updating||this._frameTask.updating)}},{key:"updatingProgressValue",get:function(){this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating);return 1-this._pendingUpdates/this._maxNumUpdating}},{key:"viewingMode",
get:function(){return this.view.state.viewingMode}},{key:"ready",get:function(){return k.isSome(this.rootTiles)}},{key:"renderOrder",set:function(ua){this._renderer.renderOrder=ua;this._set("renderOrder",ua)}},{key:"skirtScale",get:function(){return this._renderer.skirtScale},set:function(ua){this._renderer.skirtScale=ua}},{key:"spatialReference",get:function(){var ua,Aa;return null!=(ua=null==(Aa=this.tilingScheme)?void 0:Aa.spatialReference)?ua:null}},{key:"_background",get:function(){return null!=
this.backgroundColor?this.backgroundColor:this.backgroundImage}},{key:"slicePlaneEnabled",set:function(ua){var Aa,Ia;this._renderer.slicePlaneEnabled=ua;this._set("slicePlaneEnabled",ua);null==(Aa=this.view)?void 0:null==(Ia=Aa._stage)?void 0:Ia.renderView.setRenderParameters({opaqueTerrain:this.opaque})}},{key:"velvetOverground",set:function(ua){ua!==this.velvetOverground&&(this._renderer.velvetOverground=ua);this._set("velvetOverground",ua)}},{key:"visible",set:function(ua){ua!==this._visible&&
(this._visible=ua,this._renderer.setVisibility(ua),this.suspended=!ua)}},{key:"opaque",get:function(){return this._renderer.opaque}},{key:"suspended",set:function(ua){this._set("suspended",ua);this._viewChangeUpdate()}},{key:"elevationBounds",get:function(){return this._elevationBounds}},{key:"running",get:function(){return this.updating&&this.ready&&!this.suspended}},{key:"lodBias",get:function(){return this.view.qualitySettings.tiledSurface.lodBias-(1-this.view.resourceController.memoryController.memoryFactor)*
ia.MAX_MEMORY_LOD_BIAS}},{key:"performanceInfo",get:function(){const ua=this._performanceInfo;ua.numNodes=this._allTiles.length;ua.numLeaves=ua.numVisible=ua.numRendered=ua.numLoadedPerLevel.length=ua.numRenderedPerLevel.length=0;this._allTiles.forAll(Aa=>{Aa.isLeaf&&ua.numLeaves++;const Ia=Aa.level;Aa.renderData&&(ua.numLoadedPerLevel[Ia]=(ua.numLoadedPerLevel[Ia]||0)+1);Aa.visible&&(ua.numVisible++,Aa.rendered&&(ua.numRenderedPerLevel[Ia]=(ua.numRenderedPerLevel[Ia]||0)+1,ua.numRendered++))});return ua}},
{key:"test",get:function(){const ua=this;return{renderer:ua._renderer,lercDecoder:ua._lercDecoder,forceReload:()=>{k.isSome(ua.rootTiles)&&(ua._mergeTile(ua.rootTiles[0]),ua._viewChangeUpdate())},getTiles:()=>ua._allTiles.toArray(),getRenderedTiles(){Ka.clear();ua._allTiles.forAll(Ia=>{Ia.visible&&Ia.rendered&&Ka.push(Ia)});const Aa=Ka.toArray();ma.sortTiles(ua.renderOrder,Aa);return Aa},lockTilingScheme(Aa,Ia){ua._extentHelper.defaultTiledLayersExtent=Ia;ua.tilingSchemeLogic.test.lockTilingScheme(Aa)}}}}]);
return Za}(l.EventedMixin(g));c.__decorate([z.property()],g.prototype,"_renderer",void 0);c.__decorate([z.property()],g.prototype,"_hasPendingUpdates",void 0);c.__decorate([z.property()],g.prototype,"_asyncWorkItems",void 0);c.__decorate([z.property()],g.prototype,"_allTilesDirty",void 0);c.__decorate([z.property()],g.prototype,"_allTilesSorted",void 0);c.__decorate([z.property()],g.prototype,"_viewChanged",void 0);c.__decorate([z.property({readOnly:!0})],g.prototype,"_watchUpdatingTracking",void 0);
c.__decorate([z.property()],g.prototype,"_frameTask",void 0);c.__decorate([z.property({readOnly:!0})],g.prototype,"snapLevel",null);c.__decorate([z.property({readOnly:!0})],g.prototype,"lodSnapping",null);c.__decorate([z.property({constructOnly:!0})],g.prototype,"view",void 0);c.__decorate([z.property()],g.prototype,"_userClippingExtent",null);c.__decorate([z.property()],g.prototype,"_rootTilesExtent",void 0);c.__decorate([z.property({readOnly:!0})],g.prototype,"extent",null);c.__decorate([z.property({readOnly:!0})],
g.prototype,"groundExtent",null);c.__decorate([z.property({readOnly:!0})],g.prototype,"_tilingSchemeExtent",null);c.__decorate([z.property({readOnly:!0})],g.prototype,"updating",null);c.__decorate([z.property(H.updatingProgress)],g.prototype,"updatingProgress",void 0);c.__decorate([z.property({readOnly:!0})],g.prototype,"updatingProgressValue",null);c.__decorate([z.property()],g.prototype,"_maxNumUpdating",void 0);c.__decorate([z.property({aliasOf:"view.map.ground.opacity"})],g.prototype,"baseOpacity",
void 0);c.__decorate([z.property({readOnly:!0})],g.prototype,"overlayManager",void 0);c.__decorate([z.property({readOnly:!0})],g.prototype,"viewingMode",null);c.__decorate([z.property()],g.prototype,"maxTextureScale",void 0);c.__decorate([z.property({readOnly:!0})],g.prototype,"ready",null);c.__decorate([z.property({value:ha.RenderOrder.FRONT_TO_BACK})],g.prototype,"renderOrder",null);c.__decorate([z.property({readOnly:!0})],g.prototype,"rootTiles",void 0);c.__decorate([z.property({readOnly:!0})],
g.prototype,"spatialReference",null);c.__decorate([z.property()],g.prototype,"backgroundImage",void 0);c.__decorate([z.property({type:d,aliasOf:"view.map.ground.surfaceColor"})],g.prototype,"backgroundColor",void 0);c.__decorate([z.property()],g.prototype,"_background",null);c.__decorate([z.property({value:!1})],g.prototype,"slicePlaneEnabled",null);c.__decorate([z.property({readOnly:!0})],g.prototype,"tilingScheme",void 0);c.__decorate([z.property({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeLocked"})],
g.prototype,"tilingSchemeLocked",void 0);c.__decorate([z.property({readOnly:!0})],g.prototype,"tilingSchemeLogic",void 0);c.__decorate([z.property({value:!0})],g.prototype,"velvetOverground",null);c.__decorate([u.aliasOf("_renderer.wireframe")],g.prototype,"wireframe",void 0);c.__decorate([z.property({value:!1})],g.prototype,"suspended",null);c.__decorate([z.property({readOnly:!0,aliasOf:"view.qualitySettings.tiledSurface.textureFadeDuration"})],g.prototype,"textureFadeDuration",void 0);c.__decorate([z.property()],
g.prototype,"_layerViewsDirty",void 0);c.__decorate([u.aliasOf("_renderer.renderPatchBorders")],g.prototype,"renderPatchBorders",void 0);c.__decorate([u.aliasOf("_renderer.renderingDisabled")],g.prototype,"renderingDisabled",void 0);c=g=c.__decorate([v.subclass("esri.views.3d.terrain.TerrainSurface")],g);const ta=D.create(),Fa=J.create(),Ha=[0,0,0],Ka=new y,La={spatialReference:null,tile:null,extent:null,context:"ground"},Ra={spatialReference:null,extent:null,scale:0};return c})},"esri/layers/support/ElevationQueryTileCache":function(){define(["exports"],
function(a){let b=function(){function c(g){this.store=g}var d=c.prototype;d.destroy=function(){this.store.destroy()};d.get=function(g){return this.store.get(g)};d.put=function(g,x){this.store.put(g,x,x.values.byteLength+256)};return c}();a.ElevationQueryTileCache=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/support/LercDecoder":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/maybe","../../core/workers/WorkerHandle"],function(a,b,c,d){let g=function(w){function l(f=
null){var e=w.call(this,"LercWorker","_decode",f,{strategy:"dedicated"})||this;e.schedule=f;e.ref=0;return e}b._inheritsLoose(l,w);var n=l.prototype;n.decode=function(f,e,k){return f&&0!==f.byteLength?this.invoke({buffer:f,options:e},k):Promise.resolve(null)};n.getTransferList=function(f){return[f.buffer]};n.release=function(){0>=--this.ref&&(x.forEach((f,e)=>{f===this&&x.delete(e)}),this.destroy())};return l}(d.WorkerHandle);const x=new Map;a.acquireDecoder=function(w=null){let l=x.get(c.unwrap(w));
l||(c.isSome(w)?(l=new g(n=>w.schedule(n)),x.set(w,l)):(l=new g,x.set(null,l)));++l.ref;return l};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/workers/WorkerHandle":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../arrayUtils ../handleUtils ../Logger ../maybe ../promiseUtils ./workers".split(" "),function(a,b,c,d,g,x,w,l){const n=g.getLogger("esri.core.workers.WorkerHandle");g=function(){function f(k,r,y,p={}){this._mainMethod=r;this._listeners=[];this._promise=
l.open(k,{...p,schedule:y}).then(h=>{if(void 0===this._thread){this._thread=h;this._promise=null;p.hasInitialize&&this.broadcast({},"initialize");for(const m of this._listeners)this._connectListener(m)}else h.close()});this._promise.catch(h=>n.error(`Failed to initialize ${k} worker: ${h}`))}var e=f.prototype;e.on=function(k,r){const y={removed:!1,eventName:k,callback:r,threadHandle:null};this._listeners.push(y);this._connectListener(y);return d.makeHandle(()=>{y.removed=!0;c.remove(this._listeners,
y);this._thread&&x.isSome(y.threadHandle)&&y.threadHandle.remove()})};e.destroy=function(){this._thread&&(this._thread.close(),this._thread=null);this._promise=null};e.invoke=function(k,r){return this.invokeMethod(this._mainMethod,k,r)};e.invokeMethod=function(k,r,y){if(this._thread){const p=this.getTransferList(r,k);return this._thread.invoke(k,r,{transferList:p,signal:y})}return this._promise?this._promise.then(()=>{w.throwIfAborted(y);return this.invokeMethod(k,r,y)}):Promise.reject(null)};e.broadcast=
function(k,r){return this._thread?Promise.all(this._thread.broadcast(r,k)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(k,r)):Promise.reject()};e._connectListener=function(k){this._thread&&this._thread.on(k.eventName,k.callback).then(r=>{k.removed||(k.threadHandle=r)})};b._createClass(f,[{key:"promise",get:function(){return this._promise}}]);return f}();a.WorkerHandle=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/VectorTile":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f32 ./enums ./RenderBucket ./decluttering/config ../webgl/TiledDisplayObject".split(" "),
function(a,b,c,d,g,x,w,l,n){n=function(e){function k(y,p,h,m,u,t,q=null){p=e.call(this,y,p,h,m,u,4096,4096)||this;p._memCache=q;p.type="vector-tile";p._referenced=0;p._hasSymbolBuckets=!1;p._memoryUsedByLayerData=0;p.layerData=new Map;p.layerCount=0;p.status="loading";p.allSymbolsFadingOut=!1;p.lastOpacityUpdate=0;p.symbols=new Map;p.isCoverage=!1;p.neededForCoverage=!1;p.decluttered=!1;p.invalidating=!1;p.parentTile=null;p.childrenTiles=new Set;p._processed=!1;p._referenced=1;p.styleRepository=t;
p.id=y.id;return p}b._inheritsLoose(k,e);var r=k.prototype;r.setData=function(y){this.changeDataImpl(y);this.requestRender();this.ready();this.invalidating=!1;this._processed=!0};r.deleteLayerData=function(y){let p=!1;for(const h of y)this.layerData.has(h)&&(y=this.layerData.get(h),this._memoryUsedByLayerData-=y.memoryUsed,y.type===x.BucketType.SYMBOL&&this.symbols.has(h)&&(this.symbols.delete(h),p=!0),y.destroy(),this.layerData.delete(h),this.layerCount--);c.isSome(this._memCache)&&this._memCache.updateSize(this.key.id,
this,this._memoryUsedByLayerData);p&&this.emit("symbols-changed");this.requestRender()};r.processed=function(){return this._processed};r.hasData=function(){return 0<this.layerCount};r.dispose=function(){"unloaded"!==this.status&&(f.delete(this),k._destroyRenderBuckets(this.layerData),this.layerData=null,this._memoryUsedByLayerData=this.layerCount=0,this.destroy(),this.status="unloaded")};r.release=function(){return 0===--this._referenced?(this.dispose(),this.stage=null,!0):!1};r.retain=function(){++this._referenced};
r.changeDataImpl=function(y){let p=!1;if(y){const {bucketsWithData:h,emptyBuckets:m}=y;y=this._createRenderBuckets(h);if(m&&0<m.byteLength){const u=new Uint32Array(m);for(const t of u)this._deleteLayerData(t)}for(const [u,t]of y)this._deleteLayerData(u),t.type===x.BucketType.SYMBOL&&(this.symbols.set(u,t.symbols),p=!0),this._memoryUsedByLayerData+=t.memoryUsed,this.layerData.set(u,t),this.layerCount++;c.isSome(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData)}this._hasSymbolBuckets=
!1;for(const [,h]of this.layerData)h.type===x.BucketType.SYMBOL&&(this._hasSymbolBuckets=!0);p&&this.emit("symbols-changed")};r.attachWithContext=function(y){this.stage={context:y,trashDisplayObject(p){p.processDetach()},untrashDisplayObject(){return!1}}};r.setTransform=function(y,p){e.prototype.setTransform.call(this,y,p);var h=p/(y.resolution*y.pixelRatio);p=this.width/this.rangeX*h;h*=this.height/this.rangeY;const m=[0,0];y.toScreen(m,[this.x,this.y]);const u=this.transforms.tileUnitsToPixels;
d.identity(u);d.translate(u,u,m);d.rotate(u,u,Math.PI*y.rotation/180);d.scale(u,u,[p,h,1])};r._createTransforms=function(){return{dvs:g.create(),tileMat3:g.create(),tileUnitsToPixels:g.create()}};k._destroyRenderBuckets=function(y){if(y){var p=new Set;y.forEach(h=>{p.has(h)||(h.destroy(),p.add(h))});y.clear()}};r._createRenderBuckets=function(y){const p=new Map,h=new Map;for(const m of y){y=this._deserializeBucket(m,h);for(const u of y.layerUIDs)p.set(u,y)}return p};r._deserializeBucket=function(y,
p){let h=p.get(y);if(h)return h;switch((new Uint32Array(y))[0]){case x.BucketType.FILL:h=new w.FillRenderBucket(y,this.styleRepository);break;case x.BucketType.LINE:h=new w.LineRenderBucket(y,this.styleRepository);break;case x.BucketType.SYMBOL:h=new w.SymbolRenderBucket(y,this.styleRepository,this);break;case x.BucketType.CIRCLE:h=new w.CircleRenderBucket(y,this.styleRepository)}p.set(y,h);return h};r._deleteLayerData=function(y){if(this.layerData.has(y)){var p=this.layerData.get(y);this._memoryUsedByLayerData-=
p.memoryUsed;p.destroy();this.layerData.delete(y);this.layerCount--}};b._createClass(k,[{key:"hasSymbolBuckets",get:function(){return this._hasSymbolBuckets}},{key:"isFading",get:function(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<l.FADE_DURATION}},{key:"isHoldingForFade",get:function(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<l.FADE_DURATION)}},{key:"wasRequested",get:function(){return"errored"===this.status||
"loaded"===this.status||"reloading"===this.status}},{key:"referenced",get:function(){return this._referenced}},{key:"memoryUsage",get:function(){return(this._memoryUsedByLayerData+256)/(this._referenced||1)}}]);return k}(n.TiledDisplayObject);const f=new Map;a.VectorTile=n;a.printAllocations=function(){f.forEach((e,k)=>{console.log(`\n${k.key}:`);e[0].forEach(r=>console.log(r));console.log("\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d");e[1].forEach(r=>console.log(r))})};Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/chunks/mat3f32":function(){define(["exports"],function(a){function b(){const w=new Float32Array(9);w[0]=1;w[4]=1;w[8]=1;return w}function c(w){const l=new Float32Array(9);l[0]=w[0];l[1]=w[1];l[2]=w[2];l[3]=w[3];l[4]=w[4];l[5]=w[5];l[6]=w[6];l[7]=w[7];l[8]=w[8];return l}function d(w,l,n,f,e,k,r,y,p){const h=new Float32Array(9);h[0]=w;h[1]=l;h[2]=n;h[3]=f;h[4]=e;h[5]=k;h[6]=r;h[7]=y;h[8]=p;return h}function g(w,l){return new Float32Array(w,l,9)}const x=Object.freeze({__proto__:null,
create:b,clone:c,fromValues:d,createView:g});a.clone=c;a.create=b;a.createView=g;a.fromValues=d;a.mat3f32=x})},"esri/views/2d/engine/vectorTiles/enums":function(){define(["exports"],function(a){a.MemoryBufferType=void 0;(function(b){b[b.UNKNOWN=0]="UNKNOWN";b[b.FILL_VERTEX=1]="FILL_VERTEX";b[b.FILL_DD_VERTEX=2]="FILL_DD_VERTEX";b[b.FILL_INDEX=3]="FILL_INDEX";b[b.OUTLINE_VERTEX=4]="OUTLINE_VERTEX";b[b.OUTLINE_DD_VERTEX=5]="OUTLINE_DD_VERTEX";b[b.OUTLINE_INDEX=6]="OUTLINE_INDEX";b[b.LINE_VERTEX=7]=
"LINE_VERTEX";b[b.LINE_DD_VERTEX=8]="LINE_DD_VERTEX";b[b.LINE_INDEX=9]="LINE_INDEX";b[b.ICON_VERTEX=10]="ICON_VERTEX";b[b.ICON_DD_VERTEX=11]="ICON_DD_VERTEX";b[b.ICON_INDEX=12]="ICON_INDEX";b[b.TEXT_VERTEX=13]="TEXT_VERTEX";b[b.TEXT_DD_VERTEX=14]="TEXT_DD_VERTEX";b[b.TEXT_INDEX=15]="TEXT_INDEX";b[b.CIRCLE_VERTEX=16]="CIRCLE_VERTEX";b[b.CIRCLE_INDEX=17]="CIRCLE_INDEX"})(a.MemoryBufferType||(a.MemoryBufferType={}));a.BucketType=void 0;(function(b){b[b.FILL=1]="FILL";b[b.LINE=2]="LINE";b[b.SYMBOL=3]=
"SYMBOL";b[b.CIRCLE=4]="CIRCLE"})(a.BucketType||(a.BucketType={}));a.DrawPhase=void 0;(function(b){b[b.BACKGROUND=0]="BACKGROUND";b[b.OPAQUE=1]="OPAQUE";b[b.TRANSLUCENT=2]="TRANSLUCENT";b[b.SYMBOLS=3]="SYMBOLS";b[b.HITTEST=4]="HITTEST"})(a.DrawPhase||(a.DrawPhase={}));a.ShaderProgramType=void 0;(function(b){b[b.BACKGROUND=0]="BACKGROUND";b[b.FILL=1]="FILL";b[b.OUTLINE=2]="OUTLINE";b[b.LINE=3]="LINE";b[b.ICON=4]="ICON";b[b.CIRCLE=5]="CIRCLE";b[b.TEXT=6]="TEXT";b[b.TILEINFO=7]="TILEINFO"})(a.ShaderProgramType||
(a.ShaderProgramType={}));a.StyleUpdateType=void 0;(function(b){b[b.PAINTER_CHANGED=0]="PAINTER_CHANGED";b[b.LAYOUT_CHANGED=1]="LAYOUT_CHANGED";b[b.LAYER_CHANGED=2]="LAYER_CHANGED";b[b.LAYER_REMOVED=3]="LAYER_REMOVED";b[b.SPRITES_CHANGED=4]="SPRITES_CHANGED"})(a.StyleUpdateType||(a.StyleUpdateType={}));Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/RenderBucket":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ./enums ./decluttering/util ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexArrayObject".split(" "),
function(a,b,c,d,g,x,w,l){let n=function(){function y(h,m){this.layerUIDs=[];this.isDestroyed=!1;this.data=h;this.memoryUsed=h.byteLength;let u=1;h=new Uint32Array(h);this.layerUIDs=[];const t=h[u++];for(let q=0;q<t;q++)this.layerUIDs[q]=h[u++];this.bufferDataOffset=u;m&&(this.layer=m.getStyleLayerByUID(this.layerUIDs[0]))}var p=y.prototype;p.destroy=function(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)};p.prepareForRendering=function(h){c.isNone(this.data)||(this.doPrepareForRendering(h,
this.data,this.bufferDataOffset),this.data=null)};b._createClass(y,[{key:"isPreparedForRendering",get:function(){return c.isNone(this.data)}},{key:"offset",get:function(){return this.bufferDataOffset}}]);return y}(),f=function(y){function p(m,u){u=y.call(this,m,u)||this;u.type=d.BucketType.LINE;u.lineIndexStart=0;u.lineIndexCount=0;m=new Uint32Array(m);let t=u.bufferDataOffset;u.lineIndexStart=m[t++];u.lineIndexCount=m[t++];const q=m[t++];if(0<q){const z=new Map;for(let v=0;v<q;v++){const B=m[t++],
A=m[t++],E=m[t++];z.set(B,[A,E])}u.patternMap=z}u.bufferDataOffset=t;return u}b._inheritsLoose(p,y);var h=p.prototype;h.hasData=function(){return 0<this.lineIndexCount};h.triangleCount=function(){return this.lineIndexCount/3};h.doDestroy=function(){c.isSome(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose();c.isSome(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose();c.isSome(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose();this.lineIndexBuffer=this.lineVertexBuffer=this.lineVertexArrayObject=
null;this.memoryUsed=0};h.doPrepareForRendering=function(m,u,t){u=new Uint32Array(u);var q=new Int32Array(u.buffer);const z=u[t++];this.lineVertexBuffer=x.BufferObject.createVertex(m,w.Usage.STATIC_DRAW,new Int32Array(q.buffer,4*t,z));t+=z;q=u[t++];this.lineIndexBuffer=x.BufferObject.createIndex(m,w.Usage.STATIC_DRAW,new Uint32Array(u.buffer,4*t,q));t+=q;t=this.layer.lineMaterial;this.lineVertexArrayObject=new l.VertexArrayObject(m,t.getAttributeLocations(),t.getLayoutInfo(),{geometry:this.lineVertexBuffer},
this.lineIndexBuffer)};return p}(n),e=function(y){function p(m,u){u=y.call(this,m,u)||this;u.type=d.BucketType.FILL;u.fillIndexStart=0;u.fillIndexCount=0;u.outlineIndexStart=0;u.outlineIndexCount=0;m=new Uint32Array(m);let t=u.bufferDataOffset;u.fillIndexStart=m[t++];u.fillIndexCount=m[t++];u.outlineIndexStart=m[t++];u.outlineIndexCount=m[t++];const q=m[t++];if(0<q){const z=new Map;for(let v=0;v<q;v++){const B=m[t++],A=m[t++],E=m[t++];z.set(B,[A,E])}u.patternMap=z}u.bufferDataOffset=t;return u}b._inheritsLoose(p,
y);var h=p.prototype;h.hasData=function(){return 0<this.fillIndexCount||0<this.outlineIndexCount};h.triangleCount=function(){return(this.fillIndexCount+this.outlineIndexCount)/3};h.doDestroy=function(){c.isSome(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose();c.isSome(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose();c.isSome(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose();this.fillIndexBuffer=this.fillVertexBuffer=this.fillVertexArrayObject=null;c.isSome(this.outlineVertexArrayObject)&&
this.outlineVertexArrayObject.dispose();c.isSome(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose();c.isSome(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose();this.outlineIndexBuffer=this.outlineVertexBuffer=this.outlineVertexArrayObject=null;this.memoryUsed=0};h.doPrepareForRendering=function(m,u,t){u=new Uint32Array(u);var q=new Int32Array(u.buffer),z=u[t++];this.fillVertexBuffer=x.BufferObject.createVertex(m,w.Usage.STATIC_DRAW,new Int32Array(q.buffer,4*t,z));t+=z;z=u[t++];
this.fillIndexBuffer=x.BufferObject.createIndex(m,w.Usage.STATIC_DRAW,new Uint32Array(u.buffer,4*t,z));t+=z;z=u[t++];this.outlineVertexBuffer=x.BufferObject.createVertex(m,w.Usage.STATIC_DRAW,new Int32Array(q.buffer,4*t,z));t+=z;q=u[t++];this.outlineIndexBuffer=x.BufferObject.createIndex(m,w.Usage.STATIC_DRAW,new Uint32Array(u.buffer,4*t,q));t+=q;u=this.layer;t=u.fillMaterial;u=u.outlineMaterial;this.fillVertexArrayObject=new l.VertexArrayObject(m,t.getAttributeLocations(),t.getLayoutInfo(),{geometry:this.fillVertexBuffer},
this.fillIndexBuffer);this.outlineVertexArrayObject=new l.VertexArrayObject(m,u.getAttributeLocations(),u.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)};return p}(n),k=function(y){function p(m,u,t){u=y.call(this,m,u)||this;u.type=d.BucketType.SYMBOL;u.iconPerPageElementsMap=new Map;u.glyphPerPageElementsMap=new Map;u.symbolInstances=[];u.isIconSDF=!1;u.opacityChanged=!1;u.lastOpacityUpdate=0;u.symbols=[];const q=new Uint32Array(m),z=new Int32Array(m);m=new Float32Array(m);
let v=u.bufferDataOffset;u.isIconSDF=!!q[v++];var B=q[v++];for(var A=0;A<B;A++){var E=q[v++],C=q[v++],D=q[v++];u.iconPerPageElementsMap.set(E,[C,D])}B=q[v++];for(A=0;A<B;A++)E=q[v++],C=q[v++],D=q[v++],u.glyphPerPageElementsMap.set(E,[C,D]);B=q[v++];A=q[v++];u.iconOpacity=new Int32Array(B);u.textOpacity=new Int32Array(A);v=g.deserializeSymbols(q,z,m,v,u.symbols,t);u.bufferDataOffset=v;return u}b._inheritsLoose(p,y);var h=p.prototype;h.hasData=function(){return 0<this.iconPerPageElementsMap.size||0<
this.glyphPerPageElementsMap.size};h.triangleCount=function(){let m=0;for(const [,u]of this.iconPerPageElementsMap)m+=u[1];for(const [,u]of this.glyphPerPageElementsMap)m+=u[1];return m/3};h.doDestroy=function(){c.isSome(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose();c.isSome(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose();c.isSome(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose();c.isSome(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose();this.iconIndexBuffer=
this.iconOpacityBuffer=this.iconVertexBuffer=this.iconVertexArrayObject=null;c.isSome(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose();c.isSome(this.textVertexBuffer)&&this.textVertexBuffer.dispose();c.isSome(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose();c.isSome(this.textIndexBuffer)&&this.textIndexBuffer.dispose();this.textIndexBuffer=this.textOpacityBuffer=this.textVertexBuffer=this.textVertexArrayObject=null;this.memoryUsed=0};h.updateOpacityInfo=function(){if(this.opacityChanged){this.opacityChanged=
!1;var m=c.unwrap(this.iconOpacity),u=c.unwrap(this.iconOpacityBuffer);0<m.length&&m.byteLength===u.size&&u.setSubData(m);m=c.unwrap(this.textOpacity);u=c.unwrap(this.textOpacityBuffer);0<m.length&&m.byteLength===u.size&&u.setSubData(m)}};h.doPrepareForRendering=function(m,u,t){u=new Uint32Array(u);var q=new Int32Array(u.buffer),z=u[t++];this.iconVertexBuffer=x.BufferObject.createVertex(m,w.Usage.STATIC_DRAW,new Int32Array(q.buffer,4*t,z));t+=z;z=u[t++];this.iconIndexBuffer=x.BufferObject.createIndex(m,
w.Usage.STATIC_DRAW,new Uint32Array(u.buffer,4*t,z));t+=z;z=u[t++];this.textVertexBuffer=x.BufferObject.createVertex(m,w.Usage.STATIC_DRAW,new Int32Array(q.buffer,4*t,z));t+=z;q=u[t++];this.textIndexBuffer=x.BufferObject.createIndex(m,w.Usage.STATIC_DRAW,new Uint32Array(u.buffer,4*t,q));t+=q;this.iconOpacityBuffer=x.BufferObject.createVertex(m,w.Usage.STATIC_DRAW,c.unwrap(this.iconOpacity).buffer);this.textOpacityBuffer=x.BufferObject.createVertex(m,w.Usage.STATIC_DRAW,c.unwrap(this.textOpacity).buffer);
u=this.layer;t=u.iconMaterial;u=u.textMaterial;this.iconVertexArrayObject=new l.VertexArrayObject(m,t.getAttributeLocations(),t.getLayoutInfo(),{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer);this.textVertexArrayObject=new l.VertexArrayObject(m,u.getAttributeLocations(),u.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)};return p}(n),r=function(y){function p(m,u){u=y.call(this,m,u)||this;u.type=d.BucketType.CIRCLE;
u.circleIndexStart=0;u.circleIndexCount=0;m=new Uint32Array(m);let t=u.bufferDataOffset;u.circleIndexStart=m[t++];u.circleIndexCount=m[t++];u.bufferDataOffset=t;return u}b._inheritsLoose(p,y);var h=p.prototype;h.hasData=function(){return 0<this.circleIndexCount};h.triangleCount=function(){return this.circleIndexCount/3};h.doDestroy=function(){c.isSome(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose();c.isSome(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose();c.isSome(this.circleIndexBuffer)&&
this.circleIndexBuffer.dispose();this.circleIndexBuffer=this.circleVertexBuffer=this.circleVertexArrayObject=null;this.memoryUsed=0};h.doPrepareForRendering=function(m,u,t){u=new Uint32Array(u);var q=new Int32Array(u.buffer);const z=u[t++];this.circleVertexBuffer=x.BufferObject.createVertex(m,w.Usage.STATIC_DRAW,new Int32Array(q.buffer,4*t,z));t+=z;q=u[t++];this.circleIndexBuffer=x.BufferObject.createIndex(m,w.Usage.STATIC_DRAW,new Uint32Array(u.buffer,4*t,q));t+=q;t=this.layer.circleMaterial;this.circleVertexArrayObject=
new l.VertexArrayObject(m,t.getAttributeLocations(),t.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)};return p}(n);a.CircleRenderBucket=r;a.FillRenderBucket=e;a.LineRenderBucket=f;a.RenderBucketBase=n;a.SymbolRenderBucket=k;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/decluttering/util":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../enums","./core"],function(a,b,c,d,
g){let x=function(f){this.tile=f;this.parent=null;this.children=new Set},w=function(){function f(){this.nodes=new Map;this.roots=new Set}var e=f.prototype;e.create=function(k){const r=new x(k);let y;const p=[];this.nodes.forEach(h=>{this._canConnectDirectly(r,h)&&p.push(h);!y&&this._canConnectDirectly(h,r)&&(y=h)});if(y){for(const h of p)y.children.delete(h),r.children.add(h),h.parent=r;y.children.add(r);r.parent=y}else{this.roots.add(r);for(const h of p)r.children.add(h),h.parent=r,this.roots.delete(h)}this.nodes.set(k.key.id,
r);return r};e.destroy=function(k){c.isSome(k.parent)?(k.parent.children.delete(k),k.children.forEach(r=>{c.isSome(k.parent)&&k.parent.children.add(r)})):this.roots.delete(k);k.children.forEach(r=>{(r.parent=k.parent)||this.roots.add(r)});this.nodes.delete(k.tile.key.id)};e.clear=function(){this.roots.clear();this.nodes.clear()};e._canConnectDirectly=function(k,r){let {level:y,row:p,col:h}=r.tile.key;for({world:r}=r.tile.key;0<y;){y--;p>>=1;h>>=1;if(k.tile.key.level===y&&k.tile.key.row===p&&k.tile.key.col===
h&&k.tile.key.world===r)return!0;if(this.nodes.has(`${y}/${p}/${h}/${r}`))break}return!1};return f}(),l=function(){function f(){this._tileGraph=new w;this._tileArray=null}var e=f.prototype;e.has=function(k){return"string"===typeof k?this._tileGraph.nodes.has(k):this._tileGraph.nodes.has(k.key.id)};e.getAll=function(){this._tileArray||(this._tileArray=[],this._tileGraph.nodes.forEach(k=>{this._tileArray.push(k.tile)}));return this._tileArray};e.getRoots=function(){const k=[];this._tileGraph.roots.forEach(r=>
{k.push(r.tile)});return k};e.getParent=function(k){k=this._tileGraph.nodes.get("string"===typeof k?k:k.key.id);return c.isSome(k.parent)&&k.parent.tile};e.getChildren=function(k){const r=[];this._tileGraph.nodes.get("string"===typeof k?k:k.key.id).children.forEach(y=>{r.push(y.tile)});return r};e.get=function(k){return this._tileGraph.nodes.get(k).tile};e.removeKey=function(k){k=this._tileGraph.nodes.get(k);this._tileGraph.destroy(k);this._tileArray=null};e.forEach=function(k){this._tileGraph.nodes.forEach((r,
y)=>k(r.tile,y))};e.add=function(k){this._tileGraph.create(k);this._tileArray=null};e.remove=function(k){k=this._tileGraph.nodes.get(k.key.id);this._tileGraph.destroy(k);this._tileArray=null};e.clear=function(){this._tileGraph.clear();this._tileArray=[]};return f}(),n=function(){function f(k,r,y){this._rows=Math.ceil(r/y);this._columns=Math.ceil(k/y);this._cellSize=y;this.cells=Array(this._rows);for(k=0;k<this._rows;k++)for(this.cells[k]=Array(this._columns),r=0;r<this._columns;r++)this.cells[k][r]=
[]}var e=f.prototype;e.getCell=function(k,r){r=Math.min(Math.max(Math.floor(r/this._cellSize),0),this._rows-1);k=Math.min(Math.max(Math.floor(k/this._cellSize),0),this._columns-1);return this.cells[r]&&this.cells[r][k]||null};e.getCellSpan=function(k,r,y,p){return[Math.min(Math.max(Math.floor(k/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(y/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(p/this._cellSize),
0),this.rows-1)]};b._createClass(f,[{key:"cellSize",get:function(){return this._cellSize}},{key:"columns",get:function(){return this._columns}},{key:"rows",get:function(){return this._rows}}]);return f}();a.GridIndex=n;a.TileForest=l;a.TileGraph=w;a.TileNode=x;a.deserializeSymbols=function(f,e,k,r,y,p){const h=e[r++];for(let t=0;t<h;t++){const q=new g.VTLSymbol(p);q.xTile=e[r++];q.yTile=e[r++];q.hash=e[r++];q.priority=e[r++];var m=e[r++];for(var u=0;u<m;u++){const z=e[r++],v=e[r++],B=e[r++],A=e[r++],
E=!!e[r++],C=e[r++],D=k[r++],F=k[r++],G=e[r++],J=e[r++];q.colliders.push({xTile:z,yTile:v,dxPixels:B,dyPixels:A,hard:E,partIndex:C,width:G,height:J,minLod:D,maxLod:F})}m=f[r++];for(u=0;u<m;u++)q.textVertexRanges.push([f[r++],f[r++]]);m=f[r++];for(u=0;u<m;u++)q.iconVertexRanges.push([f[r++],f[r++]]);y.push(q)}return r};a.tileCoordChange=function(f,e,k,r,y,p){k-=y;if(0<=k)return(e>>k)+(r-(p<<k))*(f>>k);k=-k;return e-(p-(r<<k))*(f>>k)<<k};a.writeOpacityToBuffers=function(f,e,k){for(const [t,q]of f.symbols){{var r=
f,y=e,p=k,h=q;const z=r.layerData.get(t);if(z.type===d.BucketType.SYMBOL){for(const v of h){h=v.unique;var m=void 0;if(v.selectedForRendering){var u=h.parts[0];m=u.startOpacity;u=u.targetOpacity;r.allSymbolsFadingOut=r.allSymbolsFadingOut&&0===u;m=p?Math.floor(127*m)|u<<7:u?255:0;m|=m<<24|m<<16|m<<8}else m=0;for(const [B,A]of v.iconVertexRanges)for(u=B;u<B+A;u+=4)z.iconOpacity[u/4]=m;v.selectedForRendering?(m=h.parts[1],h=m.startOpacity,m=m.targetOpacity,r.allSymbolsFadingOut=r.allSymbolsFadingOut&&
0===m,h=p?Math.floor(127*h)|m<<7:m?255:0,m=h<<24|h<<16|h<<8|h):m=0;for(const [B,A]of v.textVertexRanges)for(h=B;h<B+A;h+=4)z.textOpacity[h/4]=m}z.lastOpacityUpdate=y;z.opacityChanged=!0}}}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/decluttering/core":function(){define(["exports"],function(a){a.VTLSymbol=function(b){this.hash=this.yTile=this.xTile=0;this.priority=1;this.colliders=[];this.textVertexRanges=[];this.iconVertexRanges=[];this.tile=b};a.VTLUniqueSymbol=
function(){this.tileSymbols=[];this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}];this.show=!1};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/decluttering/config":function(){define(["exports"],function(a){a.COLLISION_GRID_CELL_SIZE=32;a.DECLUTTER_BUDGET=1.5;a.DECLUTTER_TILES=!0;a.FADE_DURATION=200;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/webgl/TiledDisplayObject":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/mat3","../DisplayObject","../../tiling/TileKey"],function(a,b,c,d,g){d=function(x){function w(n,f,e,k,r,y=k,p=r){var h=x.call(this)||this;h.triangleCountReportedInDebug=0;h.triangleCount=0;h.texture=null;h.key=new g(n);h.x=f;h.y=e;h.width=k;h.height=r;h.rangeX=y;h.rangeY=p;return h}b._inheritsLoose(w,x);var l=w.prototype;l.destroy=function(){this.texture&&(this.texture.dispose(),this.texture=null)};l.setTransform=function(n,f){f/=
n.resolution*n.pixelRatio;const e=this.transforms.tileMat3,[k,r]=n.toScreenNoRotation([0,0],[this.x,this.y]);c.set(e,this.width/this.rangeX*f,0,0,0,this.height/this.rangeY*f,0,k,r,1);c.multiply(this.transforms.dvs,n.displayViewMat3,e)};return w}(d.DisplayObject);a.TiledDisplayObject=d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/DisplayObject":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Evented ../../../core/has ../../../core/maybe ../../../core/promiseUtils".split(" "),
function(a,b,c,d,g,x){const w=1/d("mapview-transitions-duration");c=function(l){function n(){var e=l.apply(this,arguments)||this;e._fadeOutResolver=null;e._fadeInResolver=null;e._clips=null;e.computedVisible=!0;e.computedOpacity=1;e.fadeTransitionEnabled=!1;e.inFadeTransition=!1;e._isReady=!1;e._opacity=1;e._stage=null;e._visible=!0;return e}b._inheritsLoose(n,l);var f=n.prototype;f._getTransforms=function(){g.isNone(this._transforms)&&(this._transforms=this._createTransforms());return this._transforms};
f.fadeIn=function(){if(this._fadeInResolver)return this._fadeInResolver.promise;this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null);this.computedOpacity=0;this.fadeTransitionEnabled=!0;this._fadeInResolver=x.createResolver();this.requestRender();return this._fadeInResolver.promise};f.fadeOut=function(){if(this._fadeOutResolver)return this._fadeOutResolver.promise;this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null);this.fadeTransitionEnabled=!0;this._fadeOutResolver=
x.createResolver();this.requestRender();return this._fadeOutResolver.promise};f.beforeRender=function(e){this.updateTransitionProperties(e.deltaTime,e.state.scale)};f.afterRender=function(e){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&0===this.computedOpacity&&(this._fadeOutResolver(),this._fadeOutResolver=null)};f.remove=function(){var e;null==(e=this.parent)?void 0:e.removeChild(this)};f.setTransform=function(e){};
f.processRender=function(e){this.stage&&this.computedVisible&&this.doRender(e)};f.requestRender=function(){this.stage&&this.stage.requestRender()};f.processDetach=function(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null);this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null);this.onDetach();this.emit("detach")};f.updateTransitionProperties=function(e,k){if(this.fadeTransitionEnabled){k=this._fadeOutResolver||!this.visible?0:this.opacity;const r=this.computedOpacity;
r===k?this.computedVisible=this.visible:(e*=w,this.computedOpacity=r>k?Math.max(k,r-e):Math.min(k,r+e),this.computedVisible=0<this.computedOpacity,e=k===this.computedOpacity,this.inFadeTransition=!e,e||this.requestRender())}else this.computedOpacity=this.opacity,this.computedVisible=this.visible};f.onAttach=function(){};f.onDetach=function(){};f.doRender=function(e){};f.ready=function(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())};b._createClass(n,[{key:"clips",get:function(){return this._clips},
set:function(e){this._clips=e;this.requestRender()}},{key:"isReady",get:function(){return this._isReady}},{key:"opacity",get:function(){return this._opacity},set:function(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this.requestRender())}},{key:"stage",get:function(){return this._stage},set:function(e){if(this._stage!==e){var k=this._stage;(this._stage=e)?this._stage.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):k.trashDisplayObject(this)}}},{key:"transforms",
get:function(){return this._getTransforms()}},{key:"visible",get:function(){return this._visible},set:function(e){this._visible!==e&&(this._visible=e,this.requestRender())}}]);return n}(c);a.DisplayObject=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/tiling/TileKey":function(){define(["../../../chunks/_rollupPluginBabelHelpers","../../../core/ObjectPool"],function(a,b){let c=function(){function d(x,w,l,n){this.set(x,w,l,n)}d.getId=function(x,w,l,n){return"object"===typeof x?
`${x.level}/${x.row}/${x.col}/${x.world}`:`${x}/${w}/${l}/${n}`};var g=d.prototype;g.acquire=function(x,w,l,n){this.set(x,w,l,n)};g.contains=function(x){const w=x.level-this.level;return this.row===x.row>>w&&this.col===x.col>>w&&this.world===x.world};g.equals=function(x){return this.level===x.level&&this.row===x.row&&this.col===x.col&&this.world===x.world};g.clone=function(){return new d(this)};g.release=function(){this.world=this.col=this.row=this.level=0};g.set=function(x,w,l,n){if(null==x)this.world=
this.col=this.row=this.level=0;else if("object"===typeof x)this.level=x.level||0,this.row=x.row||0,this.col=x.col||0,this.world=x.world||0;else if("string"===typeof x){const [f,e,k,r]=x.split("/");this.level=parseFloat(f);this.row=parseFloat(e);this.col=parseFloat(k);this.world=parseFloat(r)}else this.level=+x,this.row=+w,this.col=+l,this.world=+n||0;return this};g.toString=function(){return`${this.level}/${this.row}/${this.col}/${this.world}`};g.getParentKey=function(){return 0>=this.level?null:
new d(this.level-1,this.row>>1,this.col>>1,this.world)};g.getChildKeys=function(){const x=this.level+1,w=this.row<<1,l=this.col<<1,n=this.world;return[new d(x,w,l,n),new d(x,w,l+1,n),new d(x,w+1,l,n),new d(x,w+1,l+1,n)]};g.compareRowMajor=function(x){return this.row<x.row?-1:this.row>x.row?1:this.col<x.col?-1:this.col>x.col?1:0};a._createClass(d,[{key:"key",get:function(){return this}},{key:"id",get:function(){return this.toString()},set:function(x){this.set(x)}},{key:"hash",get:function(){return(this.world&
3)<<30|(this.col&4095)<<22|(this.row&4095)<<8|this.level&63}}]);return d}();c.pool=new b(c,null,null,25,50);return c})},"esri/views/3d/layers/ElevationLayerView3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./LayerView3D ./TiledLayerView3D ../../layers/LayerView".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e){g=function(k){function r(){var y=k.apply(this,arguments)||this;y.type="elevation-3d";return y}a._inheritsLoose(r,k);r.prototype.initialize=function(){var y,p,h,m;const u=null==(y=this.view)?void 0:null==(p=y.map)?void 0:p.allLayers;y=u&&u.includes(this.layer);var t=(p=null==(t=this.view)?void 0:null==(h=t.map)?void 0:null==(m=h.ground)?void 0:m.layers)&&p.includes(this.layer);y&&!t&&(t=new c("layerview:elevation-layer-only","3D elevation layer '"+this.layer.id+"' can only be added to layers in map.ground"),
this.addResolvingPromise(Promise.reject(t)));this._addTilingSchemeMatchPromise()};return r}(f.TiledLayerView3D(n.LayerView3D(e)));b.__decorate([d.property()],g.prototype,"layer",void 0);b.__decorate([d.property({readOnly:!0,aliasOf:"layer.tileInfo"})],g.prototype,"tileInfo",void 0);return g=b.__decorate([l.subclass("esri.views.3d.layers.ElevationLayerView3D")],g)})},"esri/views/3d/layers/LayerView3D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/heightModelInfoUtils".split(" "),
function(a,b,c,d,g,x,w,l,n,f){a.LayerView3D=e=>{e=function(k){function r(){var p=k.apply(this,arguments)||this;p.slicePlaneEnabled=!1;p.supportsHeightUnitConversion=!1;return p}b._inheritsLoose(r,k);var y=r.prototype;y.postscript=function(p){k.prototype.postscript.call(this,p);f.mayHaveHeightModelInfo(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())};y._validateHeightModelInfo=function(){var p=b._asyncToGenerator(function*(){var h=d.whenTrueOnce(this.view.defaultsFromMap,"heightModelInfoReady");
this.handles.add(h);yield h;if(h=f.rejectLayerError(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion))throw h;});return function(){return p.apply(this,arguments)}}();y.canResume=function(){const p=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return k.prototype.canResume.call(this)&&(!p||!p.minScale||!p.maxScale||p.minScale>=p.maxScale)};y.getSuspendInfo=function(){const p=k.prototype.getSuspendInfo.call(this),h=this.layer&&"effectiveScaleRange"in
this.layer?this.layer.effectiveScaleRange:null;h&&h.minScale&&h.maxScale&&h.minScale<h.maxScale&&(p.outsideScaleRange=!0);return p};return r}(e);c.__decorate([g.property()],e.prototype,"view",void 0);c.__decorate([g.property()],e.prototype,"slicePlaneEnabled",void 0);return e=c.__decorate([n.subclass("esri.views.3d.layers.LayerView3D")],e)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/TiledLayerView3D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/maybe ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../support/updatingProperties ../terrain/terrainUtils".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r){a.TiledLayerView3D=y=>{y=function(p){function h(){return p.apply(this,arguments)||this}b._inheritsLoose(h,p);var m=h.prototype;m.getTileUrl=function(u,t,q){return this.layer.getTileUrl(u,t,q)};m._addTilingSchemeMatchPromise=function(){if(g.isNone(this.fullExtent))return this.addResolvingPromise(Promise.reject(new d("tilingscheme:extent-not-defined","This layer doesn't define a fullExtent.")));var u=this._getTileInfoSupportError(this.tileInfo,this.fullExtent);if(g.isSome(u))return this.addResolvingPromise(Promise.reject(u));
u=x.whenTrueOnce(this.view,"basemapTerrain.tilingSchemeLocked").then(()=>{const t=this._getTileInfoCompatibilityError(this.tileInfo,this.view.basemapTerrain.tilingScheme);if(t)throw t;});this.addResolvingPromise(u)};m._getTileInfoSupportError=function(u,t){if(u=r.checkIfTileInfoSupportedForView(u,t,this.view.spatialReference,this.view.state.viewingMode)){t={layer:this.layer,error:u};switch(u.name){case "tilingscheme:spatial-reference-mismatch":case "tilingscheme:global-unsupported-spatial-reference":case "tilingscheme:local-unsupported-spatial-reference":u=
new d("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",t);break;default:u=new d("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",t)}return u}return null};m._getTileInfoCompatibilityError=function(u,t){return t.compatibleWith(u)?null:new d("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface")};m.levelRangeFromScaleRange=
function(u,t){const q={minLevel:0,maxLevel:Infinity};var z=this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.tilingScheme;if(!z)return q;const v=z.levels[0];z=B=>{B=Math.log(v.scale/B)/Math.LN2;return 1E-9>.5-Math.abs(.5-B%1)?Math.round(B):Math.ceil(B)};null!=u&&0<u&&(q.minLevel=Math.max(0,z(u)));null!=t&&0<t&&(q.maxLevel=Math.max(0,z(t)));return q};m.isUpdating=function(){return!!(this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.updating)};b._createClass(h,[{key:"imageFormatIsOpaque",
get:function(){return!1}},{key:"fullExtent",get:function(){return this.layer.fullExtent}},{key:"isOpaque",get:function(){return 1<=this.fullOpacity&&this.imageFormatIsOpaque}},{key:"dataLevelRange",get:function(){const u=this.tileInfo.lods;return this.levelRangeFromScaleRange(u[0].scale,u[u.length-1].scale)}},{key:"displayLevelRange",get:function(){var u=this.tileInfo.lods;u=this.levelRangeFromScaleRange(this.layer.minScale||u[0].scale,this.layer.maxScale||u[u.length-1].scale);this.layer.maxScale&&
u.maxLevel++;return u}}]);return h}(y);c.__decorate([w.property({readOnly:!0})],y.prototype,"imageFormatIsOpaque",null);c.__decorate([w.property({readOnly:!0})],y.prototype,"updating",void 0);c.__decorate([w.property(k.updatingProgress)],y.prototype,"updatingProgress",void 0);c.__decorate([w.property(k.updatingProgressValue)],y.prototype,"updatingProgressValue",void 0);c.__decorate([w.property()],y.prototype,"fullExtent",null);c.__decorate([w.property({readOnly:!0})],y.prototype,"isOpaque",null);
c.__decorate([w.property({readOnly:!0})],y.prototype,"dataLevelRange",null);c.__decorate([w.property({readOnly:!0})],y.prototype,"displayLevelRange",null);c.__decorate([w.property()],y.prototype,"layer",void 0);c.__decorate([w.property()],y.prototype,"tileInfo",void 0);return y=c.__decorate([e.subclass("esri.views.3d.layers.TiledLayerView3D")],y)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/updatingProperties":function(){define(["exports"],function(a){a.updatingProgress=
{readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};a.updatingProgressValue={value:.5,readOnly:!0};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/ElevationBounds":function(){define(["exports"],function(a){let b=function(){function c(d=0,g=0){this.min=d;this.max=g;this.level=0;this.hasNoDataValues=!1}c.prototype.copyFrom=function(d){this.min=d.min;this.max=d.max;this.level=d.level;this.hasNoDataValues=d.hasNoDataValues};return c}();a.ElevationBounds=
b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/ElevationData":function(){define(["exports","../../../core/mathUtils","../../../core/maybe","../support/mathUtils","./TerrainConst"],function(a,b,c,d,g){let x=function(){function w(n,f,e){this.type="elevation";this.samplerData=null;this.level=n[0];this.i=n[1];this.j=n[2];this.extent=f;n=e.noDataValue;const k=e.values;let r=Infinity,y=-Infinity,p=!0,h=!1;for(let m=0;m<k.length;m++){const u=k[m];u!==n?(r=u<r?u:r,y=u>y?u:y,
p=!1):h=!0}p&&(y=r=0);this.samplerData={pixelData:e.values,width:e.width,height:e.height,noDataValue:n,safeWidth:.99999999*(e.width-1),dx:(e.width-1)/(f[2]-f[0]),dy:(e.width-1)/(f[3]-f[1]),x0:f[0],y1:f[3]};this.bounds=[r,-3E38<y?y:0];this.hasNoDataValues=h}var l=w.prototype;l.release=function(){this.bounds=this.samplerData=null};l.computeMinMaxValue=function(n,f,e,k){k.min=Infinity;k.max=-Infinity;k.hasNoDataValues=!1;n-=this.level;if(0>=n)return k;var r=2**n;if(Math.floor(f/r)!==this.i||Math.floor(e/
r)!==this.j)return k;var y=Infinity,p=-Infinity,h=this.samplerData.width,m=this.samplerData.pixelData,u=.5*g.ELEVATION_NODATA_VALUE;n=(h-1)/r;e=(e-this.j*r)*n;let t=(f-this.i*r)*n;if(1>n){const v=Math.floor(e),B=Math.floor(t);var q=v+B*h;f=m[q];r=m[q+1];var z=m[q+h];q=m[q+h+1];if(f+r+z+q<u)return y=e-v,u=t-B,p=d.bilerp(f,r,z,q,y,u),h=d.bilerp(f,r,z,q,y+n,u),m=d.bilerp(f,r,z,q,y,u+n),n=d.bilerp(f,r,z,q,y+n,u+n),k.min=Math.min(p,h,m,n),k.max=Math.max(p,h,m,n),k;e=v;t=B;n=1}else e=Math.floor(e),t=Math.floor(t),
n=Math.ceil(n);for(f=e;f<=e+n;f++)for(r=t;r<=t+n;r++)z=m[f+r*h],z<u?(y=Math.min(y,z),p=Math.max(p,z)):k.hasNoDataValues=!0;k.min=y;k.max=p;return k};return w}();a.ElevationData=x;a.sampleElevation=function(w,l,n){if(c.isNone(n))return null;for(const y of n){if(!y)continue;var f=y.safeWidth;n=b.clamp(y.dy*(y.y1-l),0,f);f=b.clamp(y.dx*(w-y.x0),0,f);const p=Math.floor(n),h=Math.floor(f);var e=y.width,k=p*e+h,r=y.pixelData;const m=r[k],u=r[k+1];k+=e;e=r[k];r=r[k+1];if(m+e+u+r<.5*g.ELEVATION_NODATA_VALUE)return n-=
p,f-=h,w=m+(u-m)*f,w+(e+(r-e)*f-w)*n}return null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/ExtentHelper":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../geometry/support/aaBoundingRect ../../../layers/support/layerUtils ../../ViewingMode ./TerrainConst ./terrainUtils".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m){function u(z,v){return x.isSome(z)&&!z.spatialReference.equals(v)?k.projectWithoutEngine(z,z.spatialReference,v):z}a.ExtentHelper=function(z){function v(A){A=z.call(this,A)||this;A._handles=new g;return A}b._inheritsLoose(v,z);var B=v.prototype;B.initialize=function(){this._handles.add([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])};B.destroy=function(){this._handles.destroy();this._handles=null};B._computeStencilEnabledExtents=
function(){const A=[];this.layerViews.forEach(E=>{E=E.layer;"IntegratedMeshLayer"===E.operationalLayerType&&null!=this.viewSpatialReference&&(E=u(E.fullExtent,this.viewSpatialReference),x.isSome(E)&&A.push(r.fromExtent(E)))});return A};b._createClass(v,[{key:"layerViewsExtent",get:function(){return this._computeLayerViewsExtent()}},{key:"tiledLayersExtent",get:function(){return this._computeTiledLayersExtent()}},{key:"stencilEnabledExtents",get:function(){return this._computeStencilEnabledExtents()}}]);
return v}(d);c.__decorate([w.property({readOnly:!0})],a.ExtentHelper.prototype,"layerViewsExtent",null);c.__decorate([w.property({readOnly:!0})],a.ExtentHelper.prototype,"tiledLayersExtent",null);c.__decorate([w.property({readOnly:!0})],a.ExtentHelper.prototype,"stencilEnabledExtents",null);c.__decorate([w.property()],a.ExtentHelper.prototype,"viewSpatialReference",void 0);c.__decorate([w.property()],a.ExtentHelper.prototype,"tilingScheme",void 0);c.__decorate([w.property()],a.ExtentHelper.prototype,
"defaultTiledLayersExtent",void 0);c.__decorate([w.property({constructOnly:!0})],a.ExtentHelper.prototype,"layers",void 0);c.__decorate([w.property({constructOnly:!0})],a.ExtentHelper.prototype,"layerViews",void 0);a.ExtentHelper=c.__decorate([e.subclass("esri.views.3d.terrain.ExtentHelper")],a.ExtentHelper);let t=function(z){function v(){return z.apply(this,arguments)||this}b._inheritsLoose(v,z);var B=v.prototype;B._computeLayerViewsExtent=function(){return this._globalExtent};B._computeTiledLayersExtent=
function(){return this._globalExtent};b._createClass(v,[{key:"_globalExtent",get:function(){return this.viewSpatialReference.isWebMercator?h.WEBMERCATOR_WORLD_EXTENT:h.GEOGRAPHIC_WORLD_EXTENT}}]);return v}(a.ExtentHelper);t=c.__decorate([e.subclass("esri.views.3d.terrain.ExtentHelperGlobal")],t);let q=function(z){function v(){return z.apply(this,arguments)||this}b._inheritsLoose(v,z);var B=v.prototype;B._computeLayerViewsExtent=function(){const A=r.empty(),E=this.viewSpatialReference;this.layerViews.forEach(F=>
{const G=F.layer;!F.isResolved()||"graphics"===G.type&&G.internal||(F=u("fullExtentInLocalViewSpatialReference"in F&&F.fullExtentInLocalViewSpatialReference||F.layer.fullExtent,E),r.expand(A,F,A))});const C=r.allFinite(A)?A:null,D=this._get("layerViewsExtent");return r.equals(C,D)?D:C};B._computeTiledLayersExtent=function(){const A=this.tilingScheme;if(!A)return null;const E=this.viewSpatialReference,C=r.empty();this.layers.forEach(G=>{if(G.loaded&&y.isTiledLayer(G)){const O=m.getTiledLayerInfo(G,
E,p.ViewingMode.Local);if(!x.isNone(O)){var {tileInfo:J,fullExtent:I}=O;(x.isSome(J)&&m.isProjectableRasterLayer(G)&&x.isSome(I)||x.isSome(J)&&A.compatibleWith(J)&&x.isSome(I)&&I.spatialReference.equals(A.spatialReference))&&r.expand(C,I,C)}}});r.expand(C,this.defaultTiledLayersExtent,C);const D=r.allFinite(C)?C:null,F=this._get("tiledLayersExtent");return r.equals(D,F)?F:D};return v}(a.ExtentHelper);q=c.__decorate([e.subclass("esri.views.3d.terrain.ExtentHelperLocal")],q);a.create=function(z,v){return z===
p.ViewingMode.Global?new t(v):new q(v)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/LayerClass":function(){define(["exports"],function(a){a.LayerClass=void 0;var b=a.LayerClass||(a.LayerClass={});b[b.ELEVATION=0]="ELEVATION";b[b.MAP=1]="MAP";a.LayerClasses=[a.LayerClass.ELEVATION,a.LayerClass.MAP];Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/OverlayManager":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/has ../../../core/mathUtils ../../../core/maybe ../../../core/scheduling ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec2 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/projection ../../../geometry/projectionEllipsoid ../../../geometry/support/aaBoundingRect ../../../geometry/support/ray ../../../chunks/sphere ../../../geometry/support/vector ../../../geometry/support/webMercatorUtils ../layers/interfaces ../state/utils/viewUtils ../support/debugFlags ../support/debugUtils ../support/mathUtils ./interfaces ./Overlay ./OverlayRenderer ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/Intersector ../webgl-engine/lib/LocalOriginFactory ../webgl-engine/parts/requireUtils ../../support/Scheduler".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E,C,D,F,G,J,I,O,P,K,M,U,R,L,N){const T=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let S;a.OverlayManager=function(ba){function ha(ia){ia=ba.call(this,ia)||this;ia._handles=new g;ia._spatialReference=null;ia._renderSR=null;ia._overlaySREqualsRenderSR=!0;ia._drapeSources=new Map;ia._drapeTargets=new Set;ia._placementDirty=!1;ia._contentUpdated=!1;ia._drawTexturesDirty=
!1;ia._drawTexturesAnimateDirty=!1;ia._layerViewsDirty=!0;ia._hasUnusedRenderTargets=!1;ia._longitudeCyclical=null;ia._latestOriginId=0;ia._maxResolution=x("esri-mobile")?2048:4096;ia._animationTimeLast=0;return ia}b._inheritsLoose(ha,ba);var ka=ha.prototype;ka.initialize=function(){const ia=this.view;this.renderer=new K.OverlayRenderer({view:ia,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference});this._groundIntersector=U.newIntersector(this.view.state.viewingMode);this._groundIntersector.options.backfacesTerrain=
!0;this._groundIntersector.options.invisibleTerrain=!0;this._groundIntersector.options.hud=!1;this._handles.add([this.renderer.events.on("has-highlights",()=>{this._setDrawTexturesDirty();this.notifyChange("hasHighlights")}),this.renderer.events.on("has-water",ea=>{var ca;return null==(ca=ia._stage)?void 0:ca.renderView.setRenderParameters({hasOverlayWater:ea})}),this.renderer.events.on("renders-occluded",()=>{this._setDrawTexturesDirty();this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",
()=>this._setDrawTexturesDirty()),this.renderer.events.on("textures-disposed",()=>this.updateDrapeTargets()),ia.watch(["pointsOfInterest.renderPointOfView","pointsOfInterest.centerOnSurfaceFrequent.location","pixelRatio"],()=>this.setPlacementDirty()),this.surface.on("elevation-change",()=>this.setPlacementDirty()),ia.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0),ia.watch("graphicsView",()=>this._layerViewsDirty=!0),ia.on("resize",()=>this.setPlacementDirty()),n.addFrameTask({preRender:ea=>
{this._contentUpdated=!1;this.renderer.processSyncLayers();this._updateLayerViews();this.renderer.hasOverlays&&(this._dispatchAnimationUpdate(ea),this._drawOverlayTextures(this.renderer.overlays,M.RenderRequestType.UPDATE));this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory()}}),ia.resourceController.scheduler.registerTask(N.TaskPriority.OVERLAY,this),ia._stage.renderView.events.on("force-camera-for-screenshot",ea=>{this._updateOverlays(ea,M.RenderRequestType.BACKGROUND);this.renderer.hasOverlays&&
this._drawOverlayTextures(this.renderer.overlays,M.RenderRequestType.BACKGROUND,ea)})]);this._updateLayerViews()};ka.destroy=function(){this._drapeSources.forEach((ia,ea)=>this.unregisterDrapeSource(ea));this._drapeTargets.forEach(ia=>this._unregisterDrapeTarget(ia));this.renderer.dispose();this._handles&&(this._handles.destroy(),this._handles=null);l.isSome(S)&&(S.hide(),S=null)};ka.setSpatialReference=function(ia){this._spatialReference=ia;this.renderer.spatialReference=ia;this._longitudeCyclical=
null;const ea=this.view.renderSpatialReference;l.isSome(ia)&&l.isSome(ea)?(this._renderSR=ea,this._overlaySREqualsRenderSR=ia.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=ia.isWebMercator?new I.Cyclical(-2.0037508342787E7,2.0037508342787E7):new I.Cyclical(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()};ka._updateLayerViews=function(){if(this._layerViewsDirty){var ia=
new Set;for(var ea of this.view.allLayerViews.items)ia.add(ea.uid),"drapeSourceType"in ea&&!this._drapeSources.has(ea)&&this._registerDrapeSource(ea,D.DrapeSourceRegistration.LAYER_VIEW),"drapeTargetType"in ea&&!this._drapeTargets.has(ea)&&this._registerDrapeTarget(ea);ea=this.view.graphicsView;l.isSome(ea)&&!this._drapeSources.has(ea)&&(this._registerDrapeSource(ea,D.DrapeSourceRegistration.LAYER_VIEW),ia.add(ea.uid));this._drapeSources.forEach((ca,Z)=>{ca!==D.DrapeSourceRegistration.LAYER_VIEW||
ia.has(Z.uid)||this.unregisterDrapeSource(Z)});this._drapeTargets.forEach(ca=>{ia.has(ca.uid)||this._unregisterDrapeTarget(ca)});this.renderer.updateLayerOrder();this._setDrawTexturesDirty();this._layerViewsDirty=!1}};ka.registerDrapeSource=function(ia){this._registerDrapeSource(ia,D.DrapeSourceRegistration.EXTERNAL)};ka._registerDrapeSource=function(ia,ea){this._drapeSources.set(ia,ea);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);this._updateDrapeSourceExtent(ia);this._setContentDirty();
this.notifyChange("running")};ka._updateDrapeSourceExtent=function(ia){2===this.renderer.overlays.length&&l.isSome(ia.setDrapingExtent)&&l.isSome(this._spatialReference)&&ia.setDrapingExtent(this.renderer.overlays,this._spatialReference)};ka.unregisterDrapeSource=function(ia){this._drapeSources.has(ia)&&(this._drapeSources.delete(ia),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))};ka._registerDrapeTarget=function(ia){this._drapeTargets.add(ia);
this._updateDrapeTarget(ia);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)};ka.updateDrapeTargets=function(){this._drapeTargets.forEach(ia=>this._updateDrapeTarget(ia))};ka._updateDrapeTarget=function(ia){ia.setDrapingTextures(this.renderer.overlays)};ka._unregisterDrapeTarget=function(ia){this._drapeTargets.delete(ia);this.renderer.ensureDrapeTargets(this._drapeTargets)};ka._setContentDirty=function(){this.setPlacementDirty();this._setDrawTexturesDirty()};ka.setPlacementDirty=
function(){this._placementDirty=!0};ka.runTask=function(){this._updateOverlays(this.view.state.camera,M.RenderRequestType.UPDATE)};ka._updateOverlays=function(ia,ea){if(this._spatialReference){this._updateLayerViews();var ca=P.computeOverlayResolution(ia.fullWidth,ia.fullHeight,this._maxResolution);this._computeOverlayExtents(ia,ca,W);var Z=v.width(W.inner)/v.width(W.outer);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);ia=this._updateOverlay(O.OverlayIndex.INNER,W.inner,ca,1*
W.pixelRatioAdjustment,W.mapUnitsPerPixel);ca=this._updateOverlay(O.OverlayIndex.OUTER,W.outer,ca,Z*W.pixelRatioAdjustment,W.mapUnitsPerPixel);if(ia===X.EXTENT||ca===X.EXTENT)this._drapeSources.forEach((fa,ja)=>this._updateDrapeSourceExtent(ja)),this.surface.updateTileOverlayParams(ea);ia===X.NONE&&ca===X.NONE||this._setDrawTexturesDirty();this._placementDirty=!1}};ka._updateOverlay=function(ia,ea,ca,Z,fa){if(0===this.renderer.overlays.length)return X.NONE;ia=this.renderer.overlays[ia];const ja=ia.mapUnitsPerPixel;
ia.mapUnitsPerPixel=fa;ia.pixelRatio=Z;{Z=ia.extent;const la=G.TESTS_DISABLE_OPTIMIZATIONS?0:1E-5*Math.max(ea[2]-ea[0],ea[3]-ea[1],Z[2]-Z[0],Z[3]-Z[1]);Z=Math.abs(Z[0]-ea[0])<=la&&Math.abs(Z[1]-ea[1])<=la&&Math.abs(Z[2]-ea[2])<=la&&Math.abs(Z[3]-ea[3])<=la}if(Z&&ca===ia.resolution)return ja===fa?X.NONE:X.RERENDER_ONLY;v.copy(ia.extent,ea);ia.resolution=ca;ea=v.center(ia.extent);ia.renderLocalOrigin=R.fromValues(ea[0],ea[1],0,`OV_${this._latestOriginId++}`);return X.EXTENT};ka.setTileParameters=function(ia){const ea=
ia.renderData.overlay;if(0<this.renderer.overlays.length){const ca=this.renderer.overlays[O.OverlayIndex.INNER],Z=this.renderer.overlays[O.OverlayIndex.OUTER];ia=v.intersection(ia.extent,this.surface.extent,V);this._rectInsideRect(ca.extent,ia)||this._rectanglesOverlap(ia,ca.extent)||this._rectanglesOverlap(ia,Z.extent)?(this._setTileOverlayData(ia,O.OverlayIndex.INNER,ea),this._setTileOverlayData(ia,O.OverlayIndex.OUTER,ea)):(this._clearTileOverlayData(O.OverlayIndex.INNER,ea),this._clearTileOverlayData(O.OverlayIndex.OUTER,
ea))}else this._clearTileOverlayData(O.OverlayIndex.INNER,ea),this._clearTileOverlayData(O.OverlayIndex.OUTER,ea)};ka.overlayPixelSizeInMapUnits=function(ia){if(0===this.renderer.overlays.length)return 0;const ea=this.renderer.overlays[O.OverlayIndex.INNER],ca=this.renderer.overlays[O.OverlayIndex.OUTER];ia=this._pointIsInExtent(ia,ea.extent)?ea:ca;return(ia.extent[2]-ia.extent[0])/ia.resolution};ka._setTileOverlayData=function(ia,ea,ca){if(0!==this.renderer.overlays.length){var Z=this.renderer.overlays[ea].extent,
fa=v.width(Z),ja=v.height(Z),la=ia[0];if(this._longitudeCyclical){la=this._longitudeCyclical.minimalMonotonic(Z[0],la);const ma=this._longitudeCyclical.minimalMonotonic(Z[0],ia[2]);la>ma&&(la=ma-(ia[2]-ia[0]))}ca.setScale(ea,v.width(ia)/fa,v.height(ia)/ja);ca.setOffset(ea,(la-Z[0])/fa,(ia[1]-Z[1])/ja)}};ka._clearTileOverlayData=function(ia,ea){ea.setScale(ia,-1,-1);ea.setOffset(ia,-1,-1)};ka.reloadShaders=function(){var ia=b._asyncToGenerator(function*(){L.removeLoadedShaderModules();yield this.renderer.reloadShaders();
this._setDrawTexturesDirty();this.runTask()});return function(){return ia.apply(this,arguments)}}();ka._dispatchAnimationUpdate=function(ia){const ea=f.Milliseconds(ia.time-this._animationTimeLast);if(ea>=this.surface.view._stage.renderView.animationTimestep||l.isSome(this.forcedAnimationTime)||this._drawTexturesDirty||this._drawTexturesAnimateDirty)this.renderer.updateAnimation({dt:ea,forcedTime:this.forcedAnimationTime,camera:this.view.state.camera})&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=
ia.time};ka._setDrawTexturesDirty=function(){this.renderer.hasOverlays?this._drawTexturesDirty=this._contentUpdated=!0:this.setPlacementDirty()};ka._intersectGroundFromView=function(ia,ea,ca,Z){ca=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(ia,aa,ea,ca);if(l.isNone(ca))return!1;ea=ca.origin;ca=h.add(Q,ca.origin,ca.direction);this._groundIntersector.reset(ea,ca,ia);this._groundIntersector.intersect([],null);this.view.basemapTerrain.intersect(this._groundIntersector,null,ea,ca);
return this._groundIntersector.results.min.getIntersectionPoint(Z)};ka._findHorizonBasedPointOfInterest=function(ia,ea){var ca=.5;ca=this.view.renderCoordsHelper.getAltitude(ia.eye);const Z=this.view.pointsOfInterest.centerOnSurfaceFrequent;var fa=w.clamp(Z.estimatedSurfaceAltitude,ia.aboveGround?-Infinity:ca+1E-5,ia.aboveGround?ca-1E-5:Infinity);ca=ia.aboveGround;if("global"===this.view.viewingMode){var ja=Q;A.closestPointOnSilhouette(A.fromRadius(z.getReferenceEllipsoid(this.view.spatialReference).radius+
fa),B.wrap(ia.eye,ia.viewForward),ja);h.subtract(ja,ja,ia.eye);fa=I.cyclicalPI.normalize(E.angleAroundAxis(ia.viewForward,ja,ia.viewRight))/ia.fovY+.5;ja=0>=fa||1<=fa?.5:.55;ca=ca?ja*fa:fa+ja*(1-fa)}else fa=t.fromValues(0,Math.tan(.5*Math.PI-Math.acos(-ia.viewForward[2])),1,0),fa=u.transformMat4(fa,fa,ia.projectionMatrix)[1],fa=w.clamp(.5+.5*fa,0,1),ca=1===fa||0===fa?.5:ca?.55*fa:1-.55*(1-fa);return this._intersectGroundFromView(ia,.5,ca,ea)?h.sqrDist(ea,ia.eye)<Z.distance*Z.distance:!1};ka._computeOverlayExtents=
function(ia,ea,ca){var Z=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,fa=m.create();this._findHorizonBasedPointOfInterest(ia,fa)||h.copy(fa,Z);var ja=Math.max(.1,h.distance(ia.eye,fa));Z=F.viewAngle(this.view.renderCoordsHelper,Z,ia.eye);const la=Math.PI/2-Math.abs(Z-Math.PI/2);G.OVERLAY_SHOW_CENTER?(l.isNone(S)&&(S=new J.PointGraphics(this.view.graphics,"red")),S.show(fa,this._renderSR)):l.isSome(S)&&S.hide();this._overlaySREqualsRenderSR||q.projectVectorToVector(fa,this._renderSR,
fa,this._spatialReference);Z=this.surface.extent;var ma=!this._isSpherical&&l.isSome(this._spatialReference)&&this._spatialReference.isGeographic,ra=ma&&l.isSome(this._spatialReference)?1/z.getReferenceEllipsoid(this._spatialReference).metersPerDegree:1;ja=ia.perRenderPixelRatio*ja*ra;ca.mapUnitsPerPixel=ja/this._worldToPCSRatio;ja=ea*ja/2;var va=!1;ma=ma?90:Infinity;this._isSpherical&&l.isSome(Z)&&l.isSome(this._spatialReference)&&(this._spatialReference.isWebMercator?(ja/=Math.cos(C.y2lat(fa[1])),
ma=Z[3]):(va=!0,ja/=z.getReferenceEllipsoid(this._spatialReference).metersPerDegree,ma=90),ja>=ma&&(ja=ma,fa[1]=0,this._spatialReference.isWebMercator&&(fa[0]=0)));ra=1;va&&(ra=1/Math.max(.2,Math.cos(Math.abs(w.deg2rad(fa[1])))),180<ja*ra&&(ra=180/ja),ca.mapUnitsPerPixel*=ra);va=Math.log(2)/12;ja=Math.exp(Math.round(Math.log(ja)/va)*va);const ya=ja*ra;va=.5*ea/(32*ya);var za=.5*ea/(32*ja);fa[0]=Math.round(fa[0]*va)/va;fa[1]=Math.round(fa[1]*za)/za;va=ca.inner;va[0]=fa[0]-ya;va[1]=fa[1]-ja;va[2]=fa[0]+
ya;va[3]=fa[1]+ja;this._isSpherical&&this._shiftExtentToFitBounds(va,Infinity,ma);za=ca.outer;6*ya>v.width(Z)?v.copy(za,l.unwrap(Z)):la<=.25*Math.PI?(za[0]=va[0]-ya,za[1]=va[1]-ja,za[2]=va[2]+ya,za[3]=va[3]+ja):(q.projectVectorToVector(ia.eye,this._renderSR,Q,this._spatialReference),p.subtract(H,fa,Q),ia=-Math.atan2(H[1],H[0])+.125*Math.PI,0>ia&&(ia+=2*Math.PI),u.scale(H,T[Math.floor(ia/(.25*Math.PI))],2*ja),H[0]*=ra,H[2]*=ra,u.add(za,va,H));this._isSpherical?(za[0]=this._longitudeCyclical.clamp(za[0]),
za[2]=this._longitudeCyclical.clamp(za[2]),za[1]=Math.max(za[1],-ma),za[3]=Math.min(za[3],ma)):(ia=v.intersection(va,Z,V),fa=v.intersection(za,Z,Y),v.contains(ia,fa)&&(za[2]=za[0],za[3]=za[1]));ea=Math.abs(va[2]-va[0])/ea;ca.mapUnitsPerPixel=Math.max(ca.mapUnitsPerPixel,ea);ca.pixelRatioAdjustment=ca.mapUnitsPerPixel/ea};ka._drawOverlayTextures=function(ia,ea,ca=this.view.state.camera){if(0!==ia.length&&(this._drawTexturesDirty||this._drawTexturesAnimateDirty)){var Z=this._drawTexturesDirty;this._drawTexturesAnimateDirty=
this._drawTexturesDirty=!1;var fa=this._drawOverlay(ia[O.OverlayIndex.INNER],ca);ia=this._drawOverlay(ia[O.OverlayIndex.OUTER],ca);fa!==M.ValidationState.CHANGED&&ia!==M.ValidationState.CHANGED||this.surface.updateTileOverlayParams(M.RenderRequestType.UPDATE);this._collectUnusedRenderTargetMemory();this.updateDrapeTargets();Z?(this.surface.requestRender(ea),ea===M.RenderRequestType.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(M.RenderRequestType.BACKGROUND)}};ka._drawOverlay=function(ia,
ea){this._longitudeCyclical?ia.setupGeometryViewsCyclical(this._longitudeCyclical):ia.setupGeometryViewsDirect();return ia.draw(this.renderer,ea.pixelRatio)};ka._collectUnusedRenderTargetMemory=function(){this._hasUnusedRenderTargets=!1;if(this.renderer.hasOverlays){const ia=performance.now();this._hasUnusedRenderTargets=this.renderer.collectUnusedRenderTargetMemory(ia)}};ka._rectanglesOverlap=function(ia,ea){return l.isNone(ia)?!1:this._longitudeCyclical?(this._longitudeCyclical.contains(ea[0],ea[2],
ia[0])||this._longitudeCyclical.contains(ea[0],ea[2],ia[2])||this._longitudeCyclical.contains(ia[0],ia[2],ea[0]))&&!(ia[1]>ea[3]||ia[3]<ea[1]):v.intersects(ia,ea)};ka._rectInsideRect=function(ia,ea){return l.isNone(ea)?!1:this._longitudeCyclical?this._longitudeCyclical.contains(ia[0],ia[2],ea[0])&&this._longitudeCyclical.contains(ia[0],ia[2],ea[2])&&ea[1]>ia[1]&&ea[3]<ia[3]:v.contains(ia,ea)};ka._pointIsInExtent=function(ia,ea){if(this._longitudeCyclical)return this._longitudeCyclical.contains(ea[0],
ea[2],ia.x)&&ia.y>=ea[1]&&ia.y<=ea[3];const ca=ia.x;ia=ia.y;return ca>ea[0]&&ca<ea[2]&&ia>ea[1]&&ia<ea[3]};ka._shiftExtentToFitBounds=function(ia,ea,ca){let Z=0,fa=0;ia[0]<-ea?Z=ia[0]+ea:ia[2]>ea&&(Z=ea-ia[2]);ia[1]<-ca?fa=ia[1]+ca:ia[3]>ca&&(fa=ca-ia[3]);v.offset(ia,Z,fa)};b._createClass(ha,[{key:"running",get:function(){return(this._placementDirty||this._layerViewsDirty)&&(0<this._drapeSources.size||0<this.view.graphics.length||G.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&
this.surface.ready}},{key:"_isSpherical",get:function(){return this.view.state.isGlobal}},{key:"_worldToPCSRatio",get:function(){return l.isSome(this._spatialReference)&&this._spatialReference.isGeographic&&!this.view.state.isLocal?z.getReferenceEllipsoid(this._spatialReference).metersPerDegree:1}},{key:"view",get:function(){return this.surface.view}},{key:"updating",get:function(){return this.running||this.renderer.updating||this._contentUpdated}},{key:"hasHighlights",get:function(){return this.renderer.hasHighlights}},
{key:"rendersOccluded",get:function(){return this.renderer.rendersOccluded}},{key:"hasOverlays",get:function(){return this.renderer.hasOverlays}},{key:"gpuMemoryUsage",get:function(){return this.renderer.gpuMemoryUsage}},{key:"test",get:function(){return{renderer:this.renderer,update:()=>this.runTask()}}}]);return ha}(d);c.__decorate([e.property()],a.OverlayManager.prototype,"_spatialReference",void 0);c.__decorate([e.property({readOnly:!0})],a.OverlayManager.prototype,"running",null);c.__decorate([e.property()],
a.OverlayManager.prototype,"_placementDirty",void 0);c.__decorate([e.property()],a.OverlayManager.prototype,"_contentUpdated",void 0);c.__decorate([e.property()],a.OverlayManager.prototype,"_layerViewsDirty",void 0);c.__decorate([e.property()],a.OverlayManager.prototype,"_isSpherical",null);c.__decorate([e.property()],a.OverlayManager.prototype,"_worldToPCSRatio",null);c.__decorate([e.property()],a.OverlayManager.prototype,"renderer",void 0);c.__decorate([e.property({constructOnly:!0})],a.OverlayManager.prototype,
"surface",void 0);c.__decorate([e.property({readOnly:!0,aliasOf:"surface.suspended"})],a.OverlayManager.prototype,"suspended",void 0);c.__decorate([e.property({readOnly:!0})],a.OverlayManager.prototype,"updating",null);c.__decorate([e.property({type:Boolean})],a.OverlayManager.prototype,"hasHighlights",null);c.__decorate([e.property({type:Boolean})],a.OverlayManager.prototype,"rendersOccluded",null);a.OverlayManager=c.__decorate([y.subclass("esri.views.3d.terrain.OverlayManager")],a.OverlayManager);
const H=t.create(),Q=m.create(),W={inner:v.create(),outer:v.create(),mapUnitsPerPixel:0,pixelRatioAdjustment:1},V=v.create(),Y=v.create(),aa=B.create();var X;(function(ba){ba[ba.NONE=0]="NONE";ba[ba.EXTENT=1]="EXTENT";ba[ba.RERENDER_ONLY=2]="RERENDER_ONLY"})(X||(X={}));Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/parts/requireUtils":function(){define(["exports"],function(a){a.removeLoadedShaderModules=function(){var b;const c=null==(b=globalThis.require)?void 0:
b.modules;if(c){b=Object.keys(c);for(const d of b)-1!==d.search(".glsl")&&delete c[d]}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/PlanarPatch":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/frustum ../../../geometry/support/spatialReferenceUtils ./PatchGeometryFactory ./Tile ../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r){let y=function(h){function m(t,q,z){var v=h.call(this)||this;v.horizontalScaleFactor=1;v.isWebmercatorOnPlateeCaree=!1;v.extentInRenderSR=l.create();void 0!==t&&v.init(t,q,z);return v}b._inheritsLoose(m,h);var u=m.prototype;u.init=function(t,q,z){h.prototype.init.call(this,t,q,z);q=z.view.renderSpatialReference;t=z.spatialReference;this.horizontalScaleFactor=z=(q=c.isSome(q)&&f.isPlateCarree(q))&&t.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this.isWebmercatorOnPlateeCaree=
q&&t.isWebMercator;t=this.extentInRenderSR;q=this.extent;if(this.isWebmercatorOnPlateeCaree)z=d.fromValues(q[0],q[1],0),g.projectVectorToVector(z,x.WebMercator,z,x.PlateCarree),q=d.fromValues(q[2],q[3],0),g.projectVectorToVector(q,x.WebMercator,q,x.PlateCarree),t[0]=z[0],t[1]=z[1],t[2]=q[0],t[3]=q[1];else for(let v=0;4>v;++v)t[v]=q[v]*z;this.centerAtSeaLevel[0]=.5*(t[0]+t[2]);this.centerAtSeaLevel[1]=.5*(t[1]+t[3]);this.centerAtSeaLevel[2]=0;this._edgeLen=Math.max(t[2]-t[0],t[3]-t[1]);this._edgeLen2=
this._edgeLen*this._edgeLen;this.updateRadiusAndCenter()};u.updateRadiusAndCenter=function(){this._updateCenter();var t=this.extentInRenderSR;const q=.5*(t[2]-t[0]);t=.5*(t[3]-t[1]);this._center[k.CenterPosition.MIDDLE][3]=Math.max(Math.sqrt(q*q+t*t),.5*(this.elevationBounds[0]-this.elevationBounds[1]))};u._isVisible=function(t){return n.intersectsAABB(t,this._aabb())};u._aabb=function(){const t=this.extentInRenderSR;return w.wrap(t[0],t[1],this.elevationBounds[0],t[2],t[3],this.elevationBounds[1])};
u.intersectsRay=function(t,q,z,v,B){p[0]=1/q[0];p[1]=1/q[1];p[2]=1/q[2];q=B*(this.extent[2]-this.extent[0])*this.horizontalScaleFactor*.1;return r.intersectAabbInvDirBefore(this._aabb(),t,p,z+q,v)};u.createGeometry=function(t,q){e.createPlanarGlobePatch(t,this.extent,q,this.horizontalScaleFactor,this.isWebmercatorOnPlateeCaree,this.renderData);this.setMemoryDirty()};u.getDefaultVerticesPerRowOnLevel=function(){return 9>this.level?3:2};return m}(k.Tile);const p=d.create();a.PlanarPatch=y;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/terrain/PatchGeometryFactory":function(){define("exports ../../../core/mathUtils ../../../core/maybe ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/Ellipsoid ../../../geometry/support/buffer/BufferPool ../support/buffer/InterleavedLayout ./ElevationData ./interfaces ./TerrainConst ../webgl-engine/lib/VertexAttribute ../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p){function h(G,J,I,O){const P=I===k.PatchType.HAS_NORTH_POLE||I===k.PatchType.HAS_BOTH_POLES,K=J+(O?1024:0)+(P?2048:0);var M=B.get(K);if(!M){{M=J-1;const S=J*J;var U=4*M;let H=6*S,Q=6*U,W=6*(2*M+M-1);O&&(H*=2,Q*=2,W*=2);U=65536<S+U?new Uint32Array(H+Q):new Uint16Array(H+Q);let V=0,Y=0,aa=H;for(let X=0;X<=M;X++){let ba=0;P&&(ba=0===X?W:X===M?-W:0);aa+=ba;for(let ha=0;ha<=M;ha++){var R=t(ha,X,M);if(c.isSome(R)){var L=0===X&&ha!==M?1:ha===M&&X!==M?M+1:X===M&&0!==
ha?-1:0===ha&&0!==X?-(M+1):0;if(0!==L){var N=V,T=S+R;R=S+(0===ha&&1===X?0:R+1);L=V+L;O?(U[aa++]=N,U[aa++]=T,U[aa++]=T,U[aa++]=R,U[aa++]=R,U[aa++]=N,U[aa++]=R,U[aa++]=L,U[aa++]=L,U[aa++]=N,U[aa++]=N,U[aa++]=R):(U[aa++]=N,U[aa++]=T,U[aa++]=R,U[aa++]=R,U[aa++]=L,U[aa++]=N)}}++V;ha<M&&X<M&&(N=X*(M+1)+ha,T=N+1,L=T+(M+1),R=L-1,O?(U[Y++]=N,U[Y++]=T,U[Y++]=T,U[Y++]=L,U[Y++]=L,U[Y++]=N,U[Y++]=L,U[Y++]=R,U[Y++]=R,U[Y++]=N,U[Y++]=N,U[Y++]=L):(U[Y++]=N,U[Y++]=T,U[Y++]=L,U[Y++]=L,U[Y++]=R,U[Y++]=N))}aa-=ba}M=
new v(U,H,Q)}B.set(K,M)}G.indices=M.values;G.numSurfaceIndices=M.numSurfaceIndices;G.numSkirtIndices=M.numSkirtIndices;G.numWithoutSkirtIndices=G.numSurfaceIndices+(I===k.PatchType.REGULAR?0:6*(J-1)*(O?2:1))}function m(G,J,I,O){G<O[0]&&(O[0]=G);G>O[3]&&(O[3]=G);J<O[1]&&(O[1]=J);J>O[4]&&(O[4]=J);I<O[2]&&(O[2]=I);I>O[5]&&(O[5]=I)}function u(G,J){const I=J>G?1:0;return 2+4*I+(1-2*I)*(G+J)}function t(G,J,I){return 0===J?G:G===I?I+J:J===I?3*I-G:0===G&&0<J?4*I-J:null}const q=f.newLayout().vec3f(y.VertexAttribute.POSITION).vec2f(y.VertexAttribute.UV0),
z=new n.BufferPool(G=>q.createBuffer(G),G=>G.count);let v=function(G,J,I){this.values=G;this.numSurfaceIndices=J;this.numSkirtIndices=I};const B=new Map,A=Array(r.MAX_PATCH_TESSELATION+1),E=Array(r.MAX_PATCH_TESSELATION+1),C=Array(r.MAX_PATCH_TESSELATION+1),D=Array(r.MAX_PATCH_TESSELATION+1),F=d.create();a.PatchGeometry=function(){this.vertexAttributes=this.indices=null;this.boundingBox=w.empty();this.skirtLength=this.numVertsPerRow=this.numWithoutSkirtIndices=this.numSkirtIndices=this.numSurfaceIndices=
0;this.uvOffsetAndScale=x.create()};a.clearCaches=function(){z.clear();B.clear()};a.createPlanarGlobePatch=function(G,J,I,O,P,K){const M=J[0],U=J[1],R=J[2]-M,L=J[3]-U,N=G.clippingArea,T=c.isSome(N)?Math.max(0,(N[0]-J[0])/R):0,S=c.isSome(N)?Math.max(0,(N[1]-J[1])/L):0,H=c.isSome(N)?Math.min(1,(N[2]-J[0])/R):1;J=c.isSome(N)?Math.min(1,(N[3]-J[1])/L):1;const Q=H>T?1/(H-T):1,W=J>S?1/(J-S):1,V=-T*Q,Y=-S*W,aa=R*O*.1,X=G.numVertsPerSide-1,ba=G.numVertsPerSide*G.numVertsPerSide,ha=z.acquire(ba+4*X),ka=ha.position.typedBuffer,
ia=ha.uv0.typedBuffer,ea=K.geometryInfo.boundingBox;w.empty(ea);let ca=0;const Z=l.earth.radius,fa=G.samplerData,ja=c.isSome(fa)&&fa.some(ya=>c.isSome(ya))?(ya,za)=>e.sampleElevation(ya,za,fa):()=>0;for(let ya=0;ya<=X;ya++){var la=ya/X;let za=Y+la*W;la=U+la*L;c.isSome(N)&&(la<N[1]?(la=N[1],za=0):la>N[3]&&(la=N[3],za=1));const pa=(P?(Math.PI/2-2*Math.atan(Math.exp(-la/Z)))*Z:la*O)-I[1];for(let wa=0;wa<=X;wa++){var ma=wa/X;let na=V+ma*Q;ma=M+ma*R;c.isSome(N)&&(ma<N[0]?(ma=N[0],na=0):ma>N[2]&&(ma=N[2],
na=1));var ra=ja(ma,la);ma=ma*O-I[0];ra-=I[2];m(ma,pa,ra,ea);var va=r.GEOMETRY_VERTEX_STRIDE*ca;ka[va+0]=ma;ka[va+1]=pa;ka[va+2]=ra;ia[va+0]=na;ia[va+1]=za;va=t(wa,ya,X);c.isSome(va)&&(va=r.GEOMETRY_VERTEX_STRIDE*(ba+va),ka[va+0]=ma,ka[va+1]=pa,ka[va+2]=ra,ia[va+0]=u(na,za),ia[va+1]=aa);++ca}}K.geometryInfo.numVertsPerRow=G.numVertsPerSide;K.geometryInfo.vertexAttributes=ha;K.geometryInfo.skirtLength=aa;g.set(K.geometryInfo.uvOffsetAndScale,T,S,H-T,J-S);h(K.geometryInfo,G.numVertsPerSide,k.PatchType.REGULAR,
G.wireframe);K.intersectionData=null;K.skirtIntersectionData=null};a.createSphericalGlobePatch=function(G,J,I,O,P,K,M,U){var R=P[0];const L=P[1];var N=P[2];P=P[3];const T=.1*M.radius*(P-L),S=G.numVertsPerSide-1,H=G.numVertsPerSide*G.numVertsPerSide,Q=K&&(U===k.PatchType.HAS_SOUTH_POLE||U===k.PatchType.HAS_BOTH_POLES),W=K&&(U===k.PatchType.HAS_NORTH_POLE||U===k.PatchType.HAS_BOTH_POLES),V=z.acquire(H+4*S),Y=V.position.typedBuffer,aa=V.uv0.typedBuffer,X=O.geometryInfo.boundingBox;w.empty(X);var ba=
J[2]-J[0];const ha=J[3]-J[1];var ka=N-R;N=I[0];const ia=I[1];I=I[2];for(var ea=0;ea<=S;ea++){var ca=ea/S,Z=R+ca*ka;A[ea]=Math.sin(Z);E[ea]=Math.cos(Z);C[ea]=ca;D[ea]=J[0]+ca*ba}R=0;const fa=G.samplerData;ba=c.isSome(fa)&&fa.some(ya=>c.isSome(ya))?(ya,za)=>e.sampleElevation(D[ya],za,fa):()=>0;for(ka=0;ka<=S;ka++){ea=ka/S;var ja=b.lerp(L,P,ea);ca=Math.cos(ja);Z=Math.sin(ja);K?(ja=M.halfSemiMajorAxis*Math.log((1+Z)/(1-Z)),ea=(ja-J[1])/ha):ja=180*ja/Math.PI;for(let ya=0;ya<=S;ya++){const za=C[ya];var la=
A[ya],ma=E[ya],ra=M.radius+ba(ya,ja);ma=ma*ca*ra-N;la=la*ca*ra-ia;ra=Z*ra-I;m(ma,la,ra,X);var va=r.GEOMETRY_VERTEX_STRIDE*R;Y[va+0]=ma;Y[va+1]=la;Y[va+2]=ra;aa[va+0]=za;aa[va+1]=ea;va=t(ya,ka,S);if(c.isSome(va)){va=r.GEOMETRY_VERTEX_STRIDE*(H+va);const pa=Q&&0===ka?-1:W&&ka===S?1:0;ma=0===pa?ma:-N;la=0===pa?la:-ia;ra=0===pa?ra:M.radius*pa-I;Y[va+0]=ma;Y[va+1]=la;Y[va+2]=ra;aa[va+0]=0===pa?u(za,ea):za;aa[va+1]=0===pa?T:ea;0!==pa&&m(ma,la,ra,X)}++R}}O.geometryInfo.numVertsPerRow=G.numVertsPerSide;O.geometryInfo.vertexAttributes=
V;O.geometryInfo.skirtLength=T;g.set(O.geometryInfo.uvOffsetAndScale,0,0,1,1);h(O.geometryInfo,G.numVertsPerSide,K?U:k.PatchType.REGULAR,G.wireframe);O.intersectionData=null;O.skirtIntersectionData=null};a.getGlobalSkirtGeometry=function(G,J,I,O,P,K){const M=O.position,U=O.uv0;O=new Map;J*=3;I=3*I-J;const R=new Uint32Array(I);let L=0;for(let T=0;T<I;++T){const S=G[T+J];if(O.has(S))R[T]=O.get(S);else{const H=L++;O.set(S,H);R[T]=H}}const N=new Float64Array(3*L);O.forEach((T,S)=>{let H=M.get(S,0),Q=
M.get(S,1),W=M.get(S,2);if(2<=U.get(S,0)){S=H+K[0];const V=Q+K[1],Y=W+K[2],aa=P/Math.sqrt(S*S+V*V+Y*Y);H+=S*aa;Q+=V*aa;W+=Y*aa}N[3*T]=H;N[3*T+1]=Q;N[3*T+2]=W});return{vertices:N,indices:R}};a.intersectSkirtsGlobal=function(G,J,I,O,P,K,M,U,R,L){const N=K.position;K=K.uv0;const T=G[0],S=G[1];G=G[2];const H=J[0]-T,Q=J[1]-S;J=J[2]-G;I*=3;for(O*=3;I<O;I+=3){var W=P[I],V=P[I+1],Y=P[I+2],aa=N.get(W,0),X=N.get(W,1),ba=N.get(W,2),ha=N.get(V,0),ka=N.get(V,1),ia=N.get(V,2),ea=N.get(Y,0),ca=N.get(Y,1),Z=N.get(Y,
2);if(2<=K.get(W,0)){W=aa+U[0];var fa=X+U[1],ja=ba+U[2];const la=M/Math.sqrt(W*W+fa*fa+ja*ja);aa+=W*la;X+=fa*la;ba+=ja*la}2<=K.get(V,0)&&(V=ha+U[0],W=ka+U[1],fa=ia+U[2],ja=M/Math.sqrt(V*V+W*W+fa*fa),ha+=V*ja,ka+=W*ja,ia+=fa*ja);2<=K.get(Y,0)&&(Y=ea+U[0],V=ca+U[1],W=Z+U[2],fa=M/Math.sqrt(Y*Y+V*V+W*W),ea+=Y*fa,ca+=V*fa,Z+=W*fa);c.isSome(R)&&([aa,X,ba]=R.applyToVertex(aa,X,ba),[ha,ka,ia]=R.applyToVertex(ha,ka,ia),[ea,ca,Z]=R.applyToVertex(ea,ca,Z));ha-=aa;ka-=X;ia-=ba;ea-=aa;ca-=X;Z-=ba;V=Q*Z-ca*J;W=
J*ea-Z*H;fa=H*ca-ea*Q;Y=ha*V+ka*W+ia*fa;if(!(Math.abs(Y)<=Number.EPSILON)){aa=T-aa;X=S-X;ba=G-ba;V=aa*V+X*W+ba*fa;if(0<Y){if(0>V||V>Y)continue}else if(0<V||V<Y)continue;W=X*ia-ka*ba;ba=ba*ha-ia*aa;X=aa*ka-ha*X;aa=H*W+Q*ba+J*X;if(0<Y){if(0>aa||V+aa>Y)continue}else if(0<aa||V+aa<Y)continue;ba=(ea*W+ca*ba+Z*X)/Y;0<=ba&&(X=p.computeNormal(ha,ka,ia,ea,ca,Z,F),L(ba,X))}}};a.intersectSkirtsLocal=function(G,J,I,O,P,K,M,U,R){const L=K.position;K=K.uv0;const N=G[0],T=G[1];G=G[2];const S=J[0]-N,H=J[1]-T;J=J[2]-
G;I*=3;for(O*=3;I<O;I+=3){var Q=P[I],W=P[I+1],V=P[I+2],Y=L.get(Q,0),aa=L.get(Q,1),X=L.get(Q,2),ba=L.get(W,0),ha=L.get(W,1),ka=L.get(W,2),ia=L.get(V,0),ea=L.get(V,1),ca=L.get(V,2);2<=K.get(Q,0)&&(X+=M);2<=K.get(W,0)&&(ka+=M);2<=K.get(V,0)&&(ca+=M);c.isSome(U)&&([Y,aa,X]=U.applyToVertex(Y,aa,X),[ba,ha,ka]=U.applyToVertex(ba,ha,ka),[ia,ea,ca]=U.applyToVertex(ia,ea,ca));Q=ba-Y;ha-=aa;ka-=X;ia-=Y;ea-=aa;ca-=X;V=H*ca-ea*J;ba=J*ia-ca*S;const Z=S*ea-ia*H;W=Q*V+ha*ba+ka*Z;if(!(Math.abs(W)<=Number.EPSILON)){Y=
N-Y;aa=T-aa;X=G-X;V=Y*V+aa*ba+X*Z;if(0<W){if(0>V||V>W)continue}else if(0<V||V<W)continue;ba=aa*ka-ha*X;X=X*Q-ka*Y;aa=Y*ha-Q*aa;Y=S*ba+H*X+J*aa;if(0<W){if(0>Y||V+Y>W)continue}else if(0<Y||V+Y<W)continue;X=(ia*ba+ea*X+ca*aa)/W;0<=X&&(Q=p.computeNormal(Q,ha,ka,ia,ea,ca,F),R(X,Q))}}};a.releaseGeometry=function(G){z.release(G.vertexAttributes);G.vertexAttributes=null;G.indices=null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/buffer/BufferPool":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers","../../../core/PooledArray"],function(a,b,c){let d=function(){function g(w,l){this._factoryCallback=w;this._lengthCallback=l;this._pool=new Map}var x=g.prototype;x.acquire=function(w){if(!g.test.disabled){var l=this._pool.get(w);if(l&&0!==l.length)return l.pop()}try{return this._factoryCallback(w)}catch(n){l=window.performance&&window.performance.memory;let f="";l&&(f=`\n  totalJSHeapSize: ${l.totalJSHeapSize}, usedJSHeapSize: ${l.usedJSHeapSize}, jsHeapSizeLimit: ${l.jsHeapSizeLimit}`);
console.log("Array allocation of size "+w+" failed: "+n+f);throw n;}};x.release=function(w){if(!g.test.disabled){var l=this._lengthCallback(w),n=this._pool.get(l);n||(n=new c({shrink:!0}),this._pool.set(l,n));n.push(w)}};x.clear=function(){this._pool.clear()};b._createClass(g,[{key:"test",get:function(){return{size:this._pool.size}}}]);return g}();d.test={disabled:!1};a.BufferPool=d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/Tile":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../core/maybe ../../../core/ObjectPool ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projectionEllipsoid ../../../geometry/support/aaBoundingRect ../../../chunks/sphere ../../2d/engine/vectorTiles/VectorTile ../support/StreamDataLoader ./ElevationBounds ./ElevationTileAgent ./interfaces ./LayerClass ./MapTileAgent ./RasterTile ./TerrainConst ./terrainUtils ./TileAgent ./TilePerLayerInfo ./TileTexture ./TileUpdate ./tileUtils ../../webgl/Util".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E,C,D,F){function G(R){R.dispose();R instanceof h.ElevationTileAgent?M.release(R):R instanceof t.MapTileAgent&&K.release(R)}const J=n.create(),I=n.create(),O=n.create();let P=function(){function R(){this.lij=[0,0,0];this._children=[null,null,null,null];this._pendingUpdates=0;this._dirty=!0;this._previouslyRendered=!1;this.extent=e.create();this._elevationBounds=w.create();this.layerInfo=[[],[]];this.extentInRadians=e.create();this.centerAtSeaLevel=
n.create();this._center=[n.create(),k.create(),n.create()];this.up=n.unitZ();this._intersectsClippingArea=this._isWithinClippingArea=!0;this._maxTesselation=0;this._usedMemory=-1;this._curvatureHeight=this._edgeLen2=this._edgeLen=this.renderOrder=this._screenDepth=this._mapDataRefCount=this._mapTileMemory=0}R.prune=function(){K.prune(0);M.prune(0);A.TilePerLayerInfo.prune()};var L=R.prototype;L.computeVisibility=function(){this._dirty=!1;const N=this._intersectsClippingArea&&this._isVisible(this.surface.frustum);
N!==this._visible&&(this._visible=N,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setNeedsRender(),this.updateAgentSuspension());return this._visible};L.init=function(N,T,S){this.lij[0]=N[0];this.lij[1]=N[1];this.lij[2]=N[2];this.ellipsoid=f.getReferenceEllipsoid(S.tilingScheme.spatialReference);S.tilingScheme.getExtent(N[0],N[1],N[2],this.extent);S.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians);this._intersectsClippingArea=this._isWithinClippingArea=
!0;this._clippingArea=null;this._mapDataRefCount=0;S.upsampleMapCache.pop(this.key);this._edgeLen2=this._edgeLen=0;this._center[a.CenterPosition.MIDDLE][3]=0;this.vlevel=N?N[0]:0;T&&T.elevationBounds?x.copy(this._elevationBounds,T.elevationBounds):x.set(this._elevationBounds,0,0);this._pendingUpdates=0;this.renderData=null;this._screenDepth=0;this._previouslyRendered=this._visible=!1;this._parent=T;this.unsetChildren();this._surface=S;this.updateVisibility();for(const H of u.LayerClasses){N=S.numLayers(H);
T=this.layerInfo[H];for(const Q of T)Q.release();T.length=N;for(let Q=0;Q<N;Q++)T[Q]=A.TilePerLayerInfo.acquire(this._surface.upsampleInfoPool),H===u.LayerClass.ELEVATION&&this.findElevationBoundsForLayer(Q,-1)}this.computeElevationBounds();this._maxTesselation=Math.min(S.tilingScheme.pixelSize,z.MAX_PATCH_TESSELATION)};L.release=function(){v.weakAssert(!this.renderData,"tile.renderData was not unloaded");this._surface.upsampleMapCache.pop(this.key);for(const N of u.LayerClasses){for(const T of this.layerInfo[N])T.release();
this.layerInfo[N].length=0}this._surface=this._parent=null;this._usedMemory=-1};L.refMapData=function(){++this._mapDataRefCount;this.isCached||this._surface.upsampleMapCache.pop(this.key)};L.unrefMapData=function(){--this._mapDataRefCount;if(this.isCached){const N=this.cachedMemory;0<N&&(this._surface.upsampleMapCache.put(this.key,this,N),this.setMemoryDirty())}};L.setMemoryDirty=function(){this._usedMemory=-1};L._updateMemoryUsed=function(){this._mapTileMemory=this._usedMemory=0;const N=this.cpuImageMemorySize;
for(const {data:T}of this.layerInfo[u.LayerClass.MAP])T instanceof E?this._mapTileMemory+=F.getGpuMemoryUsage(T.texture):T instanceof HTMLImageElement||T instanceof y.ImageWithType?this._mapTileMemory+=N:T instanceof q.RasterTile&&(this._mapTileMemory+=T.memoryUsage);for(const T of this.layerInfo[u.LayerClass.ELEVATION])this._usedMemory+=T.data?N:0;this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemory+=F.getGpuMemoryUsage(this.renderData.textureDescriptor));
this.isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this.cachedMemory)};L.getUsedMemoryForLayer=function(N,T){T=this.layerInfo[N][T];if(!T||!T.data)return 0;if(N===u.LayerClass.MAP&&!this.isCached){N=T.data;if(N instanceof E)return F.getGpuMemoryUsage(N.texture);if(N instanceof HTMLImageElement||N instanceof y.ImageWithType)return this.cpuImageMemorySize;if(N instanceof r.VectorTile||N instanceof q.RasterTile)return N.memoryUsage}else if(N===u.LayerClass.ELEVATION)return this.cpuImageMemorySize;
return 0};L.updateScreenDepth=function(N){var T=this._center[a.CenterPosition.MIDDLE];const S=T[0],H=T[1];T=T[2];const Q=N[2]*S+N[6]*H+N[10]*T+N[14];this._screenDepth=0>Q?0:Q/(N[3]*S+N[7]*H+N[11]*T+N[15])};L.shouldSplit=function(N,T,S){if(d.isSome(N.frustum)&&(!this._intersectsClippingArea||!this._isVisible(N.frustum)))return C.TileUpdate.NONE;const H=this.level;l.subtract(J,this._center[a.CenterPosition.MIDDLE],T);var Q=l.squaredLength(J);let W=a.CenterPosition.MIDDLE;l.subtract(I,this._center[a.CenterPosition.TOP],
T);var V=l.squaredLength(I);V<Q&&(Q=V,W=a.CenterPosition.TOP);l.subtract(I,this._center[a.CenterPosition.BOTTOM],T);V=l.squaredLength(I);V<Q&&(Q=V,W=a.CenterPosition.BOTTOM);if(this._edgeLen2>Q&&H<N.maxLod)return C.TileUpdate.SPLIT;Q=Math.sqrt(Q);const Y=this._edgeLen/(N.fovX*Q*2);V=()=>{const ba=H+Math.ceil(-Math.log2(N.relativeWidthLimit/Y));return ba!==this.vlevel?(this.vlevel=ba,C.TileUpdate.VSPLITMERGE):C.TileUpdate.NONE_HIT_MAXLOD};if(S===m.LODSnapping.ON&&1===this._surface.snapLevel-H)return H>=
N.maxLod?V():C.TileUpdate.SPLIT;const aa=l.dot(this.up,J);S=this._elevationBounds[1]-this._elevationBounds[0];const X=S/this.edgeLen;return N.aboveGround&&0<aa&&.001>X&&0<aa/Q-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-X?C.TileUpdate.NONE:Y<N.relativeWidthLimit?this.vlevel!==this.level?(this.vlevel=this.level,C.TileUpdate.VSPLITMERGE):C.TileUpdate.NONE:H>=N.maxLod?V():6<H&&(l.subtract(I,this._center[W],T),l.scale(O,this.up,aa),l.subtract(O,O,I),V=l.squaredLength(O),V>this.radius*
this.radius&&(l.scale(O,O,this.radius/Math.sqrt(V)),l.add(O,O,this._center[W]),l.subtract(O,T,O),Math.min(1,(Math.abs(l.dot(O,this.up))+.5*S+this._curvatureHeight)/l.length(O))*(this._edgeLen/(N.fovY*Q*2))<.1/N.angledSplitBias*N.relativeHeightLimit))?C.TileUpdate.NONE:C.TileUpdate.SPLIT};L.setChildren=function(N,T,S,H){v.weakAssert(!!(N&&T&&S&&H),"Null child passed");this._children[0]=N;this._children[1]=T;this._children[2]=S;this._children[3]=H};L.unsetChildren=function(){this._children[0]=null;
this._children[1]=null;this._children[2]=null;this._children[3]=null};L.load=function(N){this.refMapData();for(const T of u.LayerClasses)this._createOrUpdateAgents(0,T);N.loadTile(this)};L.unload=function(N){N.unloadTile(this);for(const T of u.LayerClasses){N=this.layerInfo[T];for(const S of N)S.loadingAgent&&S.loadingAgent!==B.TILE_AGENT_DONE&&(G(S.loadingAgent),S.loadingAgent=null),S.pendingUpdates=0}this.resetPendingUpdate(C.TileUpdate.GEOMETRY);this.resetPendingUpdate(C.TileUpdate.TEXTURE_NOFADING);
this.resetPendingUpdate(C.TileUpdate.TEXTURE_FADING);this.unrefMapData()};L.unloadMapData=function(){const N=this.layerInfo[u.LayerClass.MAP];for(const T of N)T.loadingAgent&&T.loadingAgent!==B.TILE_AGENT_DONE&&(G(T.loadingAgent),T.loadingAgent=null),T.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture();this.setMemoryDirty()};L.updateClippingStatus=function(N){if(e.equals(N,this._clippingArea))return!1;var T=this._intersectsClippingArea;const S=this._isWithinClippingArea;d.isSome(N)?
(this._intersectsClippingArea=this.intersectsExtent(N),this._isWithinClippingArea=this._isWithinExtent(N)):this._isWithinClippingArea=this._intersectsClippingArea=!0;this._clippingArea=N;this.updateVisibility();N=S&&this._isWithinClippingArea;T=!S&&!T&&!this._isWithinClippingArea&&!this._intersectsClippingArea;!this.renderData||N||T||this.setPendingUpdate(C.TileUpdate.GEOMETRY);return!0};L.updateVisibility=function(){this._dirty=!0;this._surface.setTileTreeDirty()};L.getLayerInfo=function(N,T){return this.layerInfo[T][N]};
L.hasLayerData=function(N,T){N=this.layerInfo[T][N];return!(!N||!N.data||N.dataInvalidated)};L._isSuspended=function(N){return this.hasPendingUpdate(C.TileUpdate.SPLIT)?!0:N===u.LayerClass.ELEVATION?!1:!this.loadable};L.hasPendingUpdate=function(N){return(this._pendingUpdates&N)===N};L.setPendingUpdate=function(N){this._pendingUpdates|=N;N===C.TileUpdate.SPLIT||N===C.TileUpdate.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate()};L.resetPendingUpdate=function(N){return this.hasPendingUpdate(N)?
(this._pendingUpdates&=~N,!0):!1};L.requestLayerData=function(N,T,S){const H=this.layerInfo[T][N];if(H.waitingAgents.has(S))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),S.tile.lij.toString(),T,N),!0;H.waitingAgents.push(S);if(H.data&&!H.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),S.tile.lij.toString(),T,N),S.dataArrived(this),!0;if(H.requestPromise)return!0;
d.abortMaybe(H.requestAbort);H.requestAbort=new AbortController;const Q=this._surface.requestTileData(this,N,T,H.requestAbort);if(!Q)return H.requestAbort=null,!1;N=()=>{H.requestPromise===Q&&(H.requestPromise=null,H.requestAbort=null)};H.requestPromise=Q;Q.then(N,N);return!0};L.hasLij=function(N){return this.lij[0]===N[0]&&this.lij[1]===N[1]&&this.lij[2]===N[2]};L.findByLij=function(N){return this.hasLij(N)?this:this.isLeaf?null:(N=this._children[0].findByLij(N)||this._children[1].findByLij(N)||
this._children[2].findByLij(N)||this._children[3].findByLij(N))?N:null};L.distanceToSquared=function(N){return l.squaredLength(l.subtract(O,this._center[a.CenterPosition.MIDDLE],N))};L.containsPoint=function(N){const T=this.extent;return N[0]>=T[0]&&N[1]>=T[1]&&N[0]<=T[2]&&N[1]<=T[3]};L.unrequestLayerData=function(N,T,S){N=this.layerInfo[T][N];T=N.waitingAgents;S=null!=T.removeUnordered(S);v.weakAssert(S,"agent has not requested this piece of map data");1>T.length&&(N.abortRequest(),this._updateMemoryUsed())};
L.dataArrived=function(N,T,S){N=this.layerInfo[T][N];N.data=S;N.dataInvalidated=!1;N.waitingAgents.forAll(H=>H.dataArrived(this));N.waitingAgents.clear();this._updateMemoryUsed()};L.dataMissing=function(N,T,S){S.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${T}/${N} error ${S}`);N=this.layerInfo[T][N];N.dataMissing=!0;N.waitingAgents.forAll(H=>H.dataMissing());N.waitingAgents.clear();this._updateMemoryUsed()};L.updateRenderData=function(N,T){switch(N){case u.LayerClass.MAP:return this._updateTexture(T);
case u.LayerClass.ELEVATION:return this._updateGeometry()}};L._updateTexture=function(N){this.renderData&&(this.resetPendingUpdate(N===m.TextureUpdate.FADING?C.TileUpdate.TEXTURE_NOFADING:C.TileUpdate.TEXTURE_FADING),this.setPendingUpdate(N===m.TextureUpdate.FADING?C.TileUpdate.TEXTURE_FADING:C.TileUpdate.TEXTURE_NOFADING))};L._updateGeometry=function(){this.setPendingUpdate(C.TileUpdate.GEOMETRY);for(const N of this.layerInfo[u.LayerClass.ELEVATION])N.pendingUpdates|=C.TileUpdate.GEOMETRY};L.invalidateLayerData=
function(N,T){this.layerInfo[T][N].invalidateSourceData();this.restartAgents(T)};L.computeElevationBounds=function(){x.set(this._elevationBounds,Number.MAX_VALUE,-Number.MAX_VALUE);const N=this.layerInfo[u.LayerClass.ELEVATION];let T=!0;for(const S of N)d.isSome(S.elevationBounds)&&(this._elevationBounds[0]=Math.min(this._elevationBounds[0],S.elevationBounds.min),this._elevationBounds[1]=Math.max(this._elevationBounds[1],S.elevationBounds.max),S.elevationBounds.hasNoDataValues||(T=!1));T&&(this._elevationBounds[0]=
Math.min(this._elevationBounds[0],0),this._elevationBounds[1]=Math.max(this._elevationBounds[1],0));this.updateRadiusAndCenter();this._surface.setTileTreeDirty()};L._updateCenter=function(){l.scale(O,this.up,.5*(this._elevationBounds[0]+this._elevationBounds[1]));l.add(this._center[a.CenterPosition.MIDDLE],this.centerAtSeaLevel,O);l.scale(O,this.up,this._elevationBounds[0]);l.add(this._center[a.CenterPosition.TOP],this.centerAtSeaLevel,O);l.scale(O,this.up,this._elevationBounds[1]);l.add(this._center[a.CenterPosition.BOTTOM],
this.centerAtSeaLevel,O)};L.findElevationBoundsForLayer=function(N,T){const S=this.layerInfo[u.LayerClass.ELEVATION][N];if(!(d.isSome(S.elevationBounds)&&S.elevationBounds.level>=T)&&(T=this._surface.layerViewByIndex(N,u.LayerClass.ELEVATION),T=v.getLayerWithExtentRange(T),D.fallsWithinLayer(this,T,!1))){T=U;var H=!1;if(S.data)N=S.data,T.min=N.bounds[0],T.max=N.bounds[1],T.hasNoDataValues=N.hasNoDataValues,T.level=this.lij[0],H=!0;else{let Q=0,W,V;for(let Y=this._parent;Y&&(!V||Q<z.getElevationDesiredResolutionLevel(this.level))&&
!(Q=this.vlevel-Y.level,W=V||W,V=Y.layerInfo[u.LayerClass.ELEVATION][N].data,!V&&W&&Q>=z.getElevationDesiredResolutionLevel(this.level));Y=Y.parent);if(V=V||W)V.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],T),Infinity!==T.min&&(T.level=V.level,H=!0)}H&&(d.isNone(S.elevationBounds)&&(S.elevationBounds=new p.ElevationBounds),S.elevationBounds.copyFrom(T))}};L.modifyLayers=function(N,T,S){S=this.layerInfo[S];for(var H of S)H.loadingAgent&&H.loadingAgent!==B.TILE_AGENT_DONE&&(G(H.loadingAgent),
H.loadingAgent=null),H.waitingAgents.clear();for(H=0;H<S.length;++H)void 0===N[H]&&S[H].release();N=Array(...S);H=T.length;S.length=H;for(let Q=0;Q<H;Q++){const W=T[Q];S[Q]=-1<W?N[W]:A.TilePerLayerInfo.acquire(this._surface.upsampleInfoPool)}this._updateMemoryUsed()};L.restartAgents=function(N){this.renderData&&(this._createOrUpdateAgents(0,N),this.updateRenderData(N,m.TextureUpdate.FADING))};L.updateAgents=function(N){if(this.renderData){const T=this.layerInfo[N];for(const S of T)S.loadingAgent===
B.TILE_AGENT_DONE&&(S.loadingAgent=null);this._createOrUpdateAgents(0,N)}};L.updateAgentSuspension=function(){for(const N of u.LayerClasses){const T=this._isSuspended(N);for(const S of this.layerInfo[N])S.loadingAgent&&S.loadingAgent!==B.TILE_AGENT_DONE&&(S.loadingAgent.setSuspension(T),S.loadingAgent===B.TILE_AGENT_DONE&&this.updateRenderData(N,m.TextureUpdate.FADING))}};L.removeLayerAgent=function(N,T){N=this.layerInfo[T][N];N.loadingAgent&&N.loadingAgent!==B.TILE_AGENT_DONE&&N.loadingAgent.dispose();
N.loadingAgent=null};L.agentDone=function(N,T){const S=this.layerInfo[T][N];S.loadingAgent=B.TILE_AGENT_DONE;S.data||S.upsampleInfo||this._createOrUpdateAgents(N+1,T)};L._createOrUpdateAgents=function(N,T){const S=this._isSuspended(T),H=this.layerInfo[T];for(;N<H.length;++N){const Y=H[N];var Q=!1;const aa=this._surface.layerViewByIndex(N,T);var W=v.getLayerWithExtentRange(aa);if(Y.loadingAgent)D.fallsWithinLayer(this,W,!1)?(Y.loadingAgent!==B.TILE_AGENT_DONE&&Y.loadingAgent.setSuspension(S),Y.loadingAgent!==
B.TILE_AGENT_DONE&&(Q=Y.loadingAgent.update())):Y.dispose();else if(D.fallsWithinLayer(this,W,!1)){{Q=N;W=T;var V=S;const X=W===u.LayerClass.ELEVATION?M.acquire():K.acquire();X.init(this,Q,W,V);Q=X}Y.loadingAgent=Q;(Q=Y.loadingAgent.startLoading())?Y.loadingAgent===B.TILE_AGENT_DONE&&this.setPendingUpdate(C.TileUpdate.GEOMETRY):(G(Y.loadingAgent),Y.loadingAgent=B.TILE_AGENT_DONE)}Y.loadingAgent===B.TILE_AGENT_DONE&&this.updateRenderData(T,m.TextureUpdate.FADING);if(Q&&aa.isOpaque)break}};L._isWithinExtent=
function(N){const T=this.extent;return T[0]>=N[0]&&N[2]>=T[2]&&T[1]>=N[1]&&N[3]>=T[3]};L.intersectsExtent=function(N){const T=this.extent;return T[2]>=N[0]&&N[2]>=T[0]&&T[3]>=N[1]&&N[3]>=T[1]};L.getElevationBasedVerticesPerRow=function(N){const T=this.vlevel-this.level;N=Math.max(this.level-N,z.getElevationDesiredResolutionLevel(this.level)-T);return c.clamp((this.maxTesselation>>N)+1,2,this.maxTesselation+1)};b._createClass(R,[{key:"usedMemory",get:function(){-1===this._usedMemory&&this._updateMemoryUsed();
return this._usedMemory+(this.isCached?0:this.mapTileMemory)}},{key:"cachedMemory",get:function(){return this.isCached?this.mapTileMemory:0}},{key:"mapTileMemory",get:function(){-1===this._usedMemory&&this._updateMemoryUsed();let N=this._mapTileMemory;for(const {data:T}of this.layerInfo[u.LayerClass.MAP])T instanceof r.VectorTile&&(N+=T.memoryUsage);return N}},{key:"isCached",get:function(){return!this.shouldLoad&&0>=this._mapDataRefCount}},{key:"maxTesselation",get:function(){return this._maxTesselation}},
{key:"isWithinClippingArea",get:function(){return this._isWithinClippingArea}},{key:"intersectsClippingArea",get:function(){return this._intersectsClippingArea}},{key:"clippingArea",get:function(){return this._clippingArea}},{key:"parent",get:function(){return this._parent}},{key:"children",get:function(){return this._children}},{key:"surface",get:function(){return this._surface}},{key:"elevationBounds",get:function(){return this._elevationBounds}},{key:"level",get:function(){return this.lij[0]}},
{key:"key",get:function(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}},{key:"edgeLen",get:function(){return this._edgeLen}},{key:"radius",get:function(){return this._center[a.CenterPosition.MIDDLE][3]}},{key:"screenDepth",get:function(){return this._screenDepth}},{key:"visible",get:function(){this._dirty&&this.computeVisibility();return this._visible}},{key:"loadable",get:function(){return this.visible||this._surface.view.state.fixedContentCamera}},{key:"rendered",get:function(){const N=
!!this.renderData;N!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=N,this._surface.renderer.setNeedsRender());return N}},{key:"shouldLoad",get:function(){if(!this.loadable)return!1;if(this._surface.lodSnapping===m.LODSnapping.ON){const N=this.level-this._surface.snapLevel;if(0===N)return!0;if(1===N)return!1}return this.isLeaf}},{key:"cpuImageMemorySize",get:function(){const N=this._surface.tilingScheme.pixelSize;return N*N*4}},{key:"updating",
get:function(){if(this.hasPendingUpdates)return!0;for(const N of u.LayerClasses){const T=this.layerInfo[N];for(const S of T)if(S.loadingAgent&&S.loadingAgent!==B.TILE_AGENT_DONE&&S.loadingAgent.updating)return!0}return!1}},{key:"hasPendingUpdates",get:function(){return 0!==this._pendingUpdates}},{key:"isLeaf",get:function(){return null==this._children[0]}},{key:"test",get:function(){return{cachedMemory:this.cachedMemory}}}]);return R}();const K=new g(t.MapTileAgent),M=new g(h.ElevationTileAgent),
U=new p.ElevationBounds;a.CenterPosition=void 0;(function(R){R[R.TOP=0]="TOP";R[R.MIDDLE=1]="MIDDLE";R[R.BOTTOM=2]="BOTTOM"})(a.CenterPosition||(a.CenterPosition={}));a.SplitLimits=function(){this.angledSplitBias=this.maxLod=this.relativeHeightLimit=this.relativeWidthLimit=this.fovY=this.fovX=0;this.aboveGround=!0};a.Tile=P;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/ElevationTileAgent":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","./TerrainConst",
"./TileAgent"],function(a,b,c,d){d=function(g){function x(){var w=g.apply(this,arguments)||this;w._scaleRangeEnabled=!1;return w}b._inheritsLoose(x,g);b._createClass(x,[{key:"_desiredMinLevelDelta",get:function(){return c.getElevationDesiredResolutionLevel(this.tile.level)-(this.tile.vlevel-this.tile.level)}},{key:"_progressiveLevelModulo",get:function(){return 0}}]);return x}(d.TileAgent);a.ElevationTileAgent=d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/TileAgent":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ./interfaces ./TerrainConst ./terrainUtils ./tileUtils".split(" "),
function(a,b,c,d,g,x,w){let l=function(){function e(){}var k=e.prototype;k.init=function(r,y,p,h){this.tile=r;this._layerIdx=y;this._layerClass=p;this._suspended=h;this._tileLayerInfo=r.getLayerInfo(y,p);this._tileRequested=null;r=this._findAncestorWithData();this._setUpsampleTile(r)};k.startLoading=function(){return this._requestNext()};k.dispose=function(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null);this._tileLayerInfo=
this.tile=null};k.setSuspension=function(r){r!==this._suspended&&((this._suspended=r)?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())};k.update=function(){const r=this._findAncestorWithData();this._setUpsampleTile(r);return this._requestNext()};k.dataArrived=function(r){this._setUpsampleTile(r);this._tileRequested=null;r===this.tile?this.tile.updateRenderData(this._layerClass,d.TextureUpdate.FADING):
this._requestNext()};k.dataMissing=function(){this._tileRequested=null;this._tileLayerInfo.data=null;this._requestNext()};k._agentDone=function(){this.tile.agentDone(this._layerIdx,this._layerClass);this.dispose()};k._requestNext=function(){if(this._suspended)return!0;const r=this._findNextDownload();if(this._tileRequested){if(r===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this);this._tileRequested=null}c.isSome(r)?r.requestLayerData(this._layerIdx,
this._layerClass,this)&&(this._tileRequested=r):this._agentDone();return!!this._tileRequested};k._findNextDownload=function(){const r=this._layerIdx,y=this._layerClass;var p=this.tile.surface.layerViewByIndex(r,y);const h=x.getLayerWithExtentRange(p),{minLevel:m,maxLevel:u}=p.dataLevelRange;p=this._desiredMinLevelDelta;const t=this._progressiveLevelModulo+p,q=this._scaleRangeEnabled?w.fallsWithinLayer:()=>!0;let z=this.tile;const v=z.level;let B;var A=this._tileLayerInfo.upsampleInfo;A=A?A.tile.level:
-1;const E=c.get(h,"tilemapCache");for(;z&&q(z,h,!1)&&z.level>=m;){const C=z.level,D=v-C,F=z.layerInfo[y][r];if(F.data&&D>=p){C>A&&this._setUpsampleTile(z);F.dataInvalidated&&(B=z);break}if((c.isNone(E)||"unavailable"!==E.getAvailability(z.lij[0],z.lij[1],z.lij[2]))&&C<=u&&!F.data&&!F.dataMissing){if(c.isNone(B)||z.level===m||0===C%g.PROGRESSIVE_LOADING_MODULO||v-B.level<p)B=z;if(D>=t)break}z=z.parent}c.isSome(B)&&v-B.level<p&&this._tileLayerInfo.upsampleInfo&&(B=null);return B};k._findAncestorWithData=
function(){const r=this.tile.vlevel,y=this._desiredMinLevelDelta;let p;for(let h=this.tile;h;h=h.parent)if(h.hasLayerData(this._layerIdx,this._layerClass)){if(r-h.level>=y)return h;p=h}return p};k._setUpsampleTile=function(r){this._tileLayerInfo.setUpsampleInfo(this.tile,r);this.tile.updateRenderData(this._layerClass,d.TextureUpdate.FADING)};b._createClass(e,[{key:"updating",get:function(){return!!this._tileRequested}},{key:"test",get:function(){return{findNextDownload:()=>this._findNextDownload(),
tileLayerInfo:this._tileLayerInfo}}}]);return e}();var n=function(e){function k(){return e.apply(this,arguments)||this}b._inheritsLoose(k,e);k.prototype.dispose=function(){};b._createClass(k,[{key:"_desiredMinLevelDelta",get:function(){throw f;}},{key:"_progressiveLevelModulo",get:function(){throw f;}}]);return k}(l);const f=Error("Abstract method called on TileAgent");n=new n;a.TILE_AGENT_DONE=n;a.TileAgent=l;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/tileUtils":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../core/PooledArray"],function(a,b,c,d){function g(n,f){f(n);if(!n.isLeaf)for(const e of n.children)g(e,f)}function x(n,f,e){n=n.screenDepth;f=f.screenDepth;return n<f?-e:n>f?e:0}let w=function(){function n(){this._queue=new d;this._last=null;this.remove=()=>{}}var f=n.prototype;f.resetOne=function(e){this._queue.clear();this._queue.push(e);this._last=null};f.reset=function(e=null){this._queue.clear();c.isSome(e)&&this._queue.pushArray(e);
this._last=null};f.skipSubtree=function(){this._last=null};f.next=function(){this._last&&!this._last.isLeaf&&this._queue.pushArray(this._last.children);return this._last=this._queue.pop()};b._createClass(n,[{key:"done",get:function(){return 0===this._queue.length&&(!this._last||this._last.isLeaf)}}]);return n}(),l=function(){function n(){this.q=new d}var f=n.prototype;f.reset=function(e){this.q.clear();if(!c.isNone(e))for(this.q.pushArray(e),e=0;e<this.q.length;++e){const k=this.q.data[e];k.isLeaf||
this.q.pushArray(k.children)}};f.next=function(){return this.q.pop()};b._createClass(n,[{key:"done",get:function(){return 0===this.q.length}}]);return n}();a.IteratorPostorder=l;a.IteratorPreorder=w;a.compareTiles=x;a.computeUpsampleInfo=function(n,f,e){let k=1,r=0,y=0;for(;n!==f;)if(k*=.5,r*=.5,y*=.5,n.lij[2]&1&&(r+=.5),0===(n.lij[1]&1)&&(y+=.5),n=n.parent,null==n)throw Error("tile was not a descendant of upsampleTile");e.init(f,r,y,k)};a.fallsWithinLayer=function(n,f,e){if(c.isNone(f)||c.isNone(f.fullExtent))return!1;
const k=f.fullExtent,r=n.extent;if(e){if(r[0]<k.xmin||r[1]<k.ymin||r[2]>k.xmax||r[3]>k.ymax)return!1}else if(k.xmin>r[2]||k.ymin>r[3]||k.xmax<r[0]||k.ymax<r[1])return!1;n=n.surface.tilingScheme.levels[n.level].scale;return 0<f.minScale&&n>1.00000001*f.minScale||0<f.maxScale&&n<.99999999*f.maxScale?!1:!0};a.hasLoadableSiblings=function(n){for(let f=0;f<n.length;f++){const e=n[f],k=e.parent;if(k)for(let r=0;4>r;r++){const y=k.children[r];if(y&&y!==e&&y.loadable)return!0}}return!1};a.sortTiles=function(n,
f){f.sort((e,k)=>x(e,k,n))};a.sortTilesByPOI=function(n,f){const e=new Map;n.forAll(k=>e.set(k.lij,k.distanceToSquared(f)));n.sort((k,r)=>e.get(k.lij)-e.get(r.lij))};a.tilesAreRelated=function(n,f){if(!n||!f||n[0]===f[0])return!1;const e=n[0]<f[0],k=e?n:f;n=e?f:n;f=1<<n[0]-k[0];return Math.floor(n[1]/f)===k[1]&&Math.floor(n[2]/f)===k[2]};a.traverseTilesPreorder=function(n,f){if(Array.isArray(n))for(let e=0;e<n.length;e++)g(n[e],f);else g(n,f)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/MapTileAgent":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers","./TerrainConst","./TileAgent"],function(a,b,c,d){d=function(g){function x(){var w=g.call(this)||this;w._scaleRangeEnabled=!0;return w}b._inheritsLoose(x,g);b._createClass(x,[{key:"_desiredMinLevelDelta",get:function(){return 0}},{key:"_progressiveLevelModulo",get:function(){return c.PROGRESSIVE_LOADING_MODULO}}]);return x}(d.TileAgent);a.MapTileAgent=d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/RasterTile":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../webgl/enums","../../webgl/rasterUtils"],function(a,b,c,d,g){const x={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};let w=function(){function l(f,e,k=null,r=null){this.type="raster-tile";this._interpolation=this._bandIds=this._symbolizerParameters=this._source=
this._memoryUsed=null;this._dirty=!1;this._transformGrid=null;this.isRendereredSource=!1;this.lij=this.rawPixelData=this.symbolizerRenderer=null;this.scale=1;this.offset=[0,0];this.opacity=1;this.lij=f;this.source=e;this.width=k||e.width;this.height=r||e.height}var n=l.prototype;n.bind=function(f){if(!(this.source&&this.source.pixels&&0<this.source.pixels.length))return!1;this._rasterTexture&&!this._dirty||this._updateRasterTexture(f,this.bandIds);this._rasterTexture&&(this._updateColormapTexture(f),
this.transformGrid&&!this._transformGridTexture&&(this._transformGridTexture=g.createTransformTexture(f,this.transformGrid)));return!0};n.getUniforms=function(){const f=g.getBasicGridUniforms(this.scale,this.offset),{symbolizerParameters:e,transformGrid:k,width:r,height:y,opacity:p}=this,h=g.getCommonUniforms(k,[r,y],[this.source.width,this.source.height],p),m=e.colormap?g.getColormapUniforms(e.colormap,e.colormapOffset):null,u="stretch"===this.symbolizerParameters.type?g.getStretchUniforms(this.symbolizerParameters):
null,t="hillshade"===this.symbolizerParameters.type?g.getShadedReliefUniforms(this.symbolizerParameters):null;return{basic:f,common:h,colormap:m,stretch:u,hillshade:t}};n.getTextures=function(){const f=[],e=[];this._rasterTexture&&(e.push(this._rasterTexture),f.push("u_image"),this._transformGridTexture&&(e.push(this._transformGridTexture),f.push("u_transformGrid")),this._colormapTexture&&(e.push(this._colormapTexture),f.push("u_colormap")));return{names:f,textures:e}};n.release=function(){this._rasterTexture=
c.disposeMaybe(this._rasterTexture);this._transformGridTexture=c.disposeMaybe(this._transformGridTexture);this._colormapTexture=c.disposeMaybe(this._colormapTexture);this.rawPixelData=this.transformGrid=this.source=null;return!0};n._updateRasterTexture=function(f,e){const k=this.source?this.source.extractBands(e):null;if(k&&k.pixels&&0<k.pixels.length){e=c.isNone(e)&&c.isNone(this.bandIds)||c.isSome(e)&&c.isSome(this.bandIds)&&e.join("")===this.bandIds.join("");if(this._rasterTexture){if(e)return;
this._rasterTexture.dispose();this._rasterTexture=null}e=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=g.createRasterTexture(f,k,e,this.isRendereredSource||this.hasStretchTypeNone())}else this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=null)};n.hasStretchTypeNone=function(){return"stretchType"in this.symbolizerParameters&&"none"===this.symbolizerParameters.stretchType&&!this.symbolizerParameters.useGamma&&"u8"===this.source.pixelType};n._getRasterTextureInterpolation=
function(f){return"lut"===this.symbolizerParameters.type||"nearest"===f||"majority"===f?"nearest":"bilinear"};n._updateColormapTexture=function(f){const e=this._colormap,k=this.symbolizerParameters.colormap;if(!k)this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormap=null;else if(!e)this._colormapTexture=g.createColormapTexture(f,k),this._colormap=k;else if(k.length!==e.length||k.some((r,y)=>r!==e[y]))this._colormapTexture&&(this._colormapTexture.dispose(),
this._colormapTexture=null),this._colormapTexture=g.createColormapTexture(f,k),this._colormap=k};b._createClass(l,[{key:"source",get:function(){return this._source},set:function(f){this._source=f;this._rasterTexture&&(this._rasterTexture.dispose(),this._memoryUsed=this._rasterTexture=null)}},{key:"symbolizerParameters",get:function(){return this.isRendereredSource?{...x,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||x},set:function(f){this._symbolizerParameters=f}},{key:"bandIds",get:function(){return this._bandIds},
set:function(f){c.isSome(f)&&0<f.length?this._bandIds&&f.every((e,k)=>this._bandIds[k]?e===this._bandIds[k]:!1)||(this._bandIds=f,this._dirty=!0):this._bandIds=null}},{key:"interpolation",get:function(){return this._interpolation||"nearest"},set:function(f){this._interpolation=f;this._rasterTexture&&(f=this._getRasterTextureInterpolation(f),this._rasterTexture.setSamplingMode("bilinear"===f?d.TextureSamplingMode.LINEAR:d.TextureSamplingMode.NEAREST))}},{key:"transformGrid",get:function(){return this._transformGrid},
set:function(f){this._transformGrid=f;this._transformGridTexture&&(this._transformGridTexture.dispose(),this._memoryUsed=this._transformGridTexture=null)}},{key:"memoryUsage",get:function(){if(c.isNone(this._memoryUsed)){const f=this.getTextures();if(null==f)return 0;this._memoryUsed=f.textures.map(e=>e.descriptor.width*e.descriptor.height*4).reduce((e,k)=>e+k,0)}return this._memoryUsed}}]);return l}();a.RasterTile=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/rasterUtils":function(){define(["exports",
"./context-util","./enums","./FramebufferObject","./Texture"],function(a,b,c,d,g){a.createColormapTexture=function(x,w){return new g.Texture(x,{width:w.length/4,height:1,target:c.TextureType.TEXTURE_2D,pixelFormat:c.PixelFormat.RGBA,internalFormat:c.PixelFormat.RGBA,dataType:c.PixelType.UNSIGNED_BYTE,samplingMode:c.TextureSamplingMode.NEAREST,wrapMode:c.TextureWrapMode.CLAMP_TO_EDGE,flipped:!1},w)};a.createFrameBuffer=function(x,w,l,n){n=new g.Texture(x,{width:w,height:l,target:c.TextureType.TEXTURE_2D,
pixelFormat:c.PixelFormat.RGBA,internalFormat:c.PixelFormat.RGBA,samplingMode:c.TextureSamplingMode.NEAREST,dataType:n?c.PixelType.UNSIGNED_BYTE:c.PixelType.FLOAT,wrapMode:c.TextureWrapMode.CLAMP_TO_EDGE,flipped:!1});return new d.FramebufferObject(x,{colorTarget:c.TargetType.TEXTURE,depthStencilTarget:c.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER,width:w,height:l},n)};a.createRasterTexture=function(x,w,l="nearest",n=!1){var f;const e=(n=!(n&&"u8"===w.pixelType))?c.PixelType.FLOAT:c.PixelType.UNSIGNED_BYTE,
k=null==w.pixels||0===w.pixels.length?null:n?w.getAsRGBAFloat():w.getAsRGBA(),r=null==(f=x.capabilities.textureFloat)?void 0:f.textureFloatLinear;return new g.Texture(x,{width:w.width,height:w.height,target:c.TextureType.TEXTURE_2D,pixelFormat:c.PixelFormat.RGBA,internalFormat:x.type===b.ContextType.WEBGL2&&n?c.SizedPixelFormat.RGBA32F:c.PixelFormat.RGBA,samplingMode:!r||"bilinear"!==l&&"cubic"!==l?c.TextureSamplingMode.NEAREST:c.TextureSamplingMode.LINEAR,dataType:e,wrapMode:c.TextureWrapMode.CLAMP_TO_EDGE,
flipped:!1},k)};a.createTransformTexture=function(x,w){const {spacing:l,offsets:n,coefficients:f,size:[e,k]}=w;var r=1<l[0];w={width:r?4*e:e,height:k,target:c.TextureType.TEXTURE_2D,pixelFormat:c.PixelFormat.RGBA,internalFormat:x.type===b.ContextType.WEBGL2?c.SizedPixelFormat.RGBA32F:c.PixelFormat.RGBA,dataType:c.PixelType.FLOAT,samplingMode:c.TextureSamplingMode.NEAREST,wrapMode:c.TextureWrapMode.CLAMP_TO_EDGE,flipped:!1};const y=new Float32Array(r?e*k*16:2*n.length);if(r)for(let p=0,h=0;p<f.length;p++)y[h++]=
f[p],2===p%3&&(y[h++]=1);else for(r=0;r<k;r++)for(let p=0;p<e;p++){const h=4*(r*e+p),m=2*(p*k+r);y[h]=n[m];y[h+1]=n[m+1];y[h+3]=-1===n[m]?0:1}return new g.Texture(x,w,y)};a.getBasicGridUniforms=function(x,w){return{u_scale:x,u_offset:w}};a.getColormapUniforms=function(x,w){return{u_colormapOffset:w||0,u_colormapMaxIndex:x?x.length/4-1:null}};a.getCommonUniforms=function(x,w,l,n=1,f=!0,e=!1){return{u_flipY:f,u_isFloatTexture:e,u_applyTransform:x?!0:!1,u_opacity:n,u_transformSpacing:x?x.spacing:null,
u_transformGridSize:x?x.size:null,u_targetImageSize:w,u_srcImageSize:l}};a.getShadedReliefUniforms=function(x){return{u_hillshadeType:x.hillshadeType,u_sinZcosAs:x.sinZcosAs,u_sinZsinAs:x.sinZsinAs,u_cosZs:x.cosZs,u_weights:x.weights,u_factor:x.factor,u_minValue:x.minValue,u_maxValue:x.maxValue}};a.getStretchUniforms=function(x){return{u_bandCount:x.bandCount,u_minOutput:x.outMin,u_maxOutput:x.outMax,u_minCutOff:x.minCutOff,u_maxCutOff:x.maxCutOff,u_factor:x.factor,u_useGamma:x.useGamma,u_gamma:x.gamma,
u_gammaCorrection:x.gammaCorrection}};a.getUniformLocationInfos=function(x,w){x=x.gl;w=w.glName;const l=x.getProgramParameter(w,x.ACTIVE_UNIFORMS),n=new Map;let f;for(let e=0;e<l;e++)(f=x.getActiveUniform(w,e))&&n.set(f.name,{location:x.getUniformLocation(w,f.name),info:f});return n};a.setTextures=function(x,w,l,n){l.length===n.length&&(n.some(f=>null==f)||l.some(f=>null==f)||l.forEach((f,e)=>{w.setUniform1i(f,e);x.bindTexture(n[e],e)}))};a.setUniforms=function(x,w,l){Object.keys(l).forEach(n=>{var f=
w.get(n)||w.get(n+"[0]");if(f){var e=l[n];if(null!==f&&null!=e)switch({info:f}=f,f.type){case c.UniformType.FLOAT:1<f.size?x.setUniform1fv(n,e):x.setUniform1f(n,e);break;case c.UniformType.FLOAT_VEC2:x.setUniform2fv(n,e);break;case c.UniformType.FLOAT_VEC3:x.setUniform3fv(n,e);break;case c.UniformType.FLOAT_VEC4:x.setUniform4fv(n,e);break;case c.UniformType.FLOAT_MAT3:x.setUniformMatrix3fv(n,e);break;case c.UniformType.FLOAT_MAT4:x.setUniformMatrix4fv(n,e);break;case c.UniformType.INT:1<f.size?x.setUniform1iv(n,
e):x.setUniform1i(n,e);break;case c.UniformType.BOOL:x.setUniform1i(n,e?1:0);break;case c.UniformType.INT_VEC2:case c.UniformType.BOOL_VEC2:x.setUniform2iv(n,e);break;case c.UniformType.INT_VEC3:case c.UniformType.BOOL_VEC3:x.setUniform3iv(n,e);break;case c.UniformType.INT_VEC4:case c.UniformType.BOOL_VEC4:x.setUniform4iv(n,e)}}})};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/TilePerLayerInfo":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../core/ObjectPool ../../../core/PooledArray ./terrainUtils ./tileUtils".split(" "),
function(a,b,c,d,g,x,w){let l=function(){function e(){this.waitingAgents=new g;this.requestAbort=this.requestPromise=this.loadingAgent=this._upsampleInfo=null;this.pendingUpdates=0}e.acquire=function(r){const y=n.acquire();y._init(r);return y};var k=e.prototype;k.release=function(){this.dispose();f.delete(this);n.release(this)};k.dispose=function(){this.loadingAgent=c.disposeMaybe(this.loadingAgent);this.abortRequest();this._unsetUpsampleInfo();this.pendingUpdates=0;this._data=x.releaseTileData(this._data)};
e.prune=function(){n.prune(0)};k._init=function(r){this.waitingAgents.clear();this._data=x.releaseTileData(this._data);this.dataInvalidated=this.dataMissing=!1;this._unsetUpsampleInfo();this.abortRequest();this.loadingAgent=null;this.pendingUpdates=0;this._pool=r;this.elevationBounds=null};k.invalidateSourceData=function(){this.dataInvalidated=!0;this.dataMissing=!1;this._unsetUpsampleInfo()};k.abortRequest=function(){this.requestAbort=c.abortMaybe(this.requestAbort);this.requestPromise=null};k._unsetUpsampleInfo=
function(){this._upsampleInfo&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)};k.setUpsampleInfo=function(r,y){if(r===y||c.isNone(y))this._unsetUpsampleInfo();else{if(null==this._upsampleInfo)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===y)return;this._upsampleInfo.tile.unrefMapData()}y.refMapData();w.computeUpsampleInfo(r,y,this._upsampleInfo)}};b._createClass(e,[{key:"upsampleInfo",get:function(){return this._upsampleInfo}},
{key:"data",get:function(){return this._data},set:function(r){x.releaseTileData(this._data);this._data=r}}]);return e}();const n=new d(l,null,()=>{}),f=new Map;a.TilePerLayerInfo=l;a.printAllocations=function(){0<f.size&&(console.log(`${f.size} live TilePerLayerInfo allocations:`),f.forEach(e=>console.log(e,"\n")))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/TileTexture":function(){define(["../../../chunks/_rollupPluginBabelHelpers"],function(a){return function(){function b(d){this._texture=
d;this.type="tile-texture";this._refCount=1}var c=b.prototype;c.retain=function(){++this._refCount};c.release=function(){--this._refCount;0===this._refCount&&this._texture.dispose()};c.generateMipmap=function(){this._texture.generateMipmap()};a._createClass(b,[{key:"texture",get:function(){return this._texture}},{key:"descriptor",get:function(){return this._texture.descriptor}}]);return b}()})},"esri/views/3d/terrain/TileUpdate":function(){define(["exports"],function(a){a.TileUpdate=void 0;var b=
a.TileUpdate||(a.TileUpdate={});b[b.NONE=0]="NONE";b[b.NONE_HIT_MAXLOD=1]="NONE_HIT_MAXLOD";b[b.SPLIT=2]="SPLIT";b[b.VSPLITMERGE=4]="VSPLITMERGE";b[b.MERGE=8]="MERGE";b[b.RENDERDATA=16]="RENDERDATA";b[b.GEOMETRY=32]="GEOMETRY";b[b.TEXTURE_NOFADING=64]="TEXTURE_NOFADING";b[b.TEXTURE_FADING=128]="TEXTURE_FADING";Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/RenderOrder":function(){define(["exports"],function(a){a.RenderOrder=void 0;var b=a.RenderOrder||(a.RenderOrder={});
b[b.BACK_TO_FRONT=-1]="BACK_TO_FRONT";b[b.NONE=0]="NONE";b[b.FRONT_TO_BACK=1]="FRONT_TO_BACK";Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/SphericalPatch":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/projectionEllipsoid ../../../geometry/support/frustum ../../../geometry/support/plane ./interfaces ./PatchGeometryFactory ./Tile".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k){k=function(p){function h(u,t,q){var z=p.call(this)||this;z.obb=Array(8);z.isWebMercator=!1;for(let v=0;8>v;v++)z.obb[v]=g.create();void 0!==u&&z.init(u,t,q);return z}b._inheritsLoose(h,p);var m=h.prototype;m.init=function(u,t,q){p.prototype.init.call(this,u,t,q);this.isWebMercator=q.tilingScheme.spatialReference.isWebMercator;t=this.ellipsoid.radius;q=this.extentInRadians[0];const z=this.extentInRadians[1],v=this.extentInRadians[2],B=this.extentInRadians[3];u=u[0];
const A=c.lerp(z,B,.5),E=c.lerp(q,v,.5);this._edgeLen=(v-q)*Math.cos(0===u?0:Math.min(Math.abs(z),Math.abs(B)))*t;this._edgeLen2=this._edgeLen*this._edgeLen;this._curvatureHeight=t-Math.sqrt(t*t-this._edgeLen2/4);x.lonLatToSphericalPCPF(this.centerAtSeaLevel,E,A,this.ellipsoid.radius,0);t=g.fromArray(this.centerAtSeaLevel);d.normalize(t,t);this.up=t;this._updateOBB();this.updateRadiusAndCenter()};m.updateRadiusAndCenter=function(){if(0===this.lij[0])d.set(this._center[a.CenterPosition.MIDDLE],0,0,
0),d.set(this._center[a.CenterPosition.TOP],0,0,0),d.set(this._center[a.CenterPosition.BOTTOM],0,0,0),this.ellipsoid||(this.ellipsoid=w.getReferenceEllipsoid(this.surface.spatialReference)),this._center[a.CenterPosition.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const u=Math.max(d.squaredDistance(this._center[a.CenterPosition.MIDDLE],this.obb[0]),d.squaredDistance(this._center[a.CenterPosition.MIDDLE],this.obb[1]));this._center[a.CenterPosition.MIDDLE][3]=Math.sqrt(u)}};
m._isVisible=function(u){if(!l.intersectsSphere(u,this._center[a.CenterPosition.MIDDLE]))return!1;if(10>this.lij[0])return!0;const t=this.obb;for(let v=0;v<l.NumPlanes.NUM;v++){var q=v===l.PlaneIndex.NEAR,z=u[v];q&&(y[0]=z[0],y[1]=z[1],y[2]=z[2],y[3]=z[3]-this.surface.view.state.camera.near);q=q?y:z;for(z=0;8>z;z++){const B=t[z];if(0>q[0]*B[0]+q[1]*B[1]+q[2]*B[2]+q[3])break}if(8===z)return!1}return!0};m.computeElevationBounds=function(){p.prototype.computeElevationBounds.call(this);this._updateOBB()};
m.createGeometry=function(u,t){const q=this._getPatchType(this.lij[1],this.lij[0]);e.createSphericalGlobePatch(u,this.extent,t,this.renderData,this.extentInRadians,this.isWebMercator,this.ellipsoid,q);this.setMemoryDirty()};m._updateOBB=function(){const u=this.extentInRadians,t=this.obb;for(let q=0;2>q;q++){const z=this.elevationBounds[q];let v=4*q;x.lonLatToSphericalPCPF(t[v++],u[0],u[1],this.ellipsoid.radius,z);x.lonLatToSphericalPCPF(t[v++],u[0],u[3],this.ellipsoid.radius,z);x.lonLatToSphericalPCPF(t[v++],
u[2],u[3],this.ellipsoid.radius,z);x.lonLatToSphericalPCPF(t[v++],u[2],u[1],this.ellipsoid.radius,z)}if(this.isWebMercator)switch(this._getPatchType(this.lij[1],this.lij[0])){case f.PatchType.HAS_NORTH_POLE:d.set(t[1],0,0,this.ellipsoid.radius);d.set(t[2],0,0,this.ellipsoid.radius);d.set(t[5],0,0,this.ellipsoid.radius);d.set(t[6],0,0,this.ellipsoid.radius);break;case f.PatchType.HAS_SOUTH_POLE:d.set(t[0],0,0,-this.ellipsoid.radius),d.set(t[3],0,0,-this.ellipsoid.radius),d.set(t[4],0,0,-this.ellipsoid.radius),
d.set(t[7],0,0,-this.ellipsoid.radius)}};m._getPatchType=function(u,t){return u===(1<<t)-1?0===u?f.PatchType.HAS_BOTH_POLES:f.PatchType.HAS_SOUTH_POLE:0===u?f.PatchType.HAS_NORTH_POLE:f.PatchType.REGULAR};m.intersectsRay=function(u,t,q,z,v){z=this._center[a.CenterPosition.MIDDLE];q=z[3]+q+.2*this.ellipsoid.radius*Math.abs(v*(this.extentInRadians[3]-this.extentInRadians[1]));var B=z[0]-u[0];v=z[1]-u[1];u=z[2]-u[2];z=(B*t[0]+v*t[1]+u*t[2])/(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);B=t[0]*z-B;v=t[1]*z-v;t=t[2]*
z-u;return B*B+v*v+t*t<q*q};m.getDefaultVerticesPerRowOnLevel=function(){return this.level<r.length?r[this.level]+1:2};return h}(k.Tile);const r=[128,64,32,16,16,8,8,4],y=n.create();a.CenterPosition=void 0;(function(p){p[p.TOP=0]="TOP";p[p.MIDDLE=1]="MIDDLE";p[p.BOTTOM=2]="BOTTOM"})(a.CenterPosition||(a.CenterPosition={}));a.SphericalPatch=k;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/TerrainRenderer":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/Accessor ../../../core/maybe ../../../core/ObjectPool ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/buffer/BufferView ../../../support/requestImageUtils ../../ViewingMode ./interfaces ./LayerClass ./Overlay ./OverlayRenderer ./PatchGeometryFactory ./PatchRenderData ./RenderOrder ./ScaleRangeQueries ./TerrainConst ./TileRenderer ./TileUpdate ./tileUtils ../webgl-engine/collections/Component/ComponentIntersectionData ../webgl-engine/core/shaderLibrary/ShaderOutputOptions ../webgl-engine/core/shaderLibrary/Slice.glsl ../webgl-engine/core/shaderLibrary/shading/ScreenSpaceReflections.glsl ../webgl-engine/core/shaderLibrary/terrain/Overlay.glsl ../webgl-engine/core/shaderLibrary/util/View.glsl ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/Intersector ../webgl-engine/lib/IntersectorInterfaces ../webgl-engine/lib/Material ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/screenSizePerspectiveUtils ../webgl-engine/lib/VertexAttribute ../webgl-engine/lib/verticalOffsetUtils ../webgl-engine/materials/internal/MaterialUtil ../webgl-engine/shaders/TerrainTechnique ../../webgl/enums".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E,C,D,F,G,J,I,O,P,K,M,U,R,L,N,T,S,H,Q,W,V,Y,aa,X,ba,ha,ka){function ia(va,ya,za){za[0]=va[0]*ya[2]+ya[0];za[1]=va[1]*ya[3]+ya[1];za[2]=va[2]*ya[2];za[3]=va[3]*ya[3]}const ea=m.create(),ca=h.create();d=function(va){function ya(pa){pa=va.call(this,pa)||this;pa.type=H.IntersectorType.TERRAIN;pa.isGround=!0;pa.tileSize=256;pa.rctx=null;pa._isTransparent=!1;pa._scaleRangeQueries=new F.ScaleRangeQueries;pa.renderDataPool=new x(C.PatchRenderData);
pa._patchGroups=new Map;pa.patchGroupsDirty=!0;pa.tileIterator=new O.IteratorPreorder;pa.highestVisibleLODTile=null;pa.visible=!0;pa._opaque=!0;pa._skirtScale=1;pa._velvetOverground=!0;pa.castShadows=!0;pa._ssrEnabled=!1;pa.emptyTex=null;pa.tileRenderer=null;pa.tileBackgroundInitialized=!1;pa.tileBackgroundUpdating=!1;pa.stencilEnabledLayerExtents=[];pa.numTilesRendered=0;pa.numTilesCulled=0;pa.numOriginsRendered=0;pa.overlayOpacity=1;pa.needsHighlight=!1;pa.renderOccludedFlags=Q.RenderOccludedFlag.Occlude;
return pa}a._inheritsLoose(ya,va);var za=ya.prototype;za.initialize=function(){this.stage.addRenderPlugin([V.RenderSlot.OPAQUE_TERRAIN,V.RenderSlot.TRANSPARENT_TERRAIN,V.RenderSlot.OCCLUDED_TERRAIN],this)};za.destroy=function(){this.stage.removeRenderPlugin(this);E.clearCaches()};za.setDebugScreenSizePerspective=function(pa){this.shaderTechniqueConfig.screenSizePerspective!==pa&&(this.shaderTechniqueConfig.screenSizePerspective=pa,this.setNeedsRender())};za.setRootTiles=function(pa){this._rootTiles=
pa;this.setNeedsRender()};za.setNeedsHighlight=function(pa){this.needsHighlight=pa;this.setNeedsRender()};za.setRenderOccludedOverlay=function(pa){this.renderOccludedFlags=pa?A.overlayRenderOccludedFlag:Q.RenderOccludedFlag.Occlude;this.setNeedsRender()};za.setStencilEnabledLayerExtents=function(pa){this.stencilEnabledLayerExtents=pa;this.setNeedsRender()};za.setTileSize=function(pa){this.tileSize=pa;this.tileRenderer&&(this.tileRenderer.tileSize=pa);this.setNeedsRender()};za.loadTile=function(pa){pa.renderData||
(pa.renderData=this.renderDataPool.acquire(),pa.renderData.init(pa),pa.renderData.localOrigin=this._getLocalOriginOfTile(pa));this.updateTileGeometry(pa);this.updateTileTexture(pa,I.TileUpdate.TEXTURE_FADING)};za.queryVisibleLevelRange=function(pa,wa,na,qa){this._scaleRangeQueries.queryVisibleLevelRange(pa,wa,na,qa);this.setNeedsRender()};za.updateTileTexture=function(pa,wa){this.tileRenderer&&this.tileBackgroundInitialized&&(this.tileRenderer.updateTileTexture(pa,wa===I.TileUpdate.TEXTURE_FADING?
z.TextureUpdate.FADING:z.TextureUpdate.UNFADED),this.setNeedsRender(),pa.resetPendingUpdate(wa))};za.updateTileGeometry=function(pa){for(const wa of pa.layerInfo[v.LayerClass.ELEVATION])wa.pendingUpdates&=~I.TileUpdate.GEOMETRY;pa.resetPendingUpdate(I.TileUpdate.GEOMETRY);pa.renderData.updateGeometry(this.rctx,this.wireframe)&&this.setNeedsRender()};za.unloadTile=function(pa){pa.renderData&&(pa.renderData.releaseGeometry()&&this.setNeedsRender(),this.renderDataPool.release(pa.renderData),pa.renderData.clear(),
pa.renderData=null,pa.setMemoryDirty(),this.setNeedsRender())};za._getLocalOriginOfTile=function(pa){const wa=Math.max(0,7*Math.floor((pa.level-3)/7));if(this.isGlobal&&0===wa)return p.ZEROS;for(;pa.parent&&pa.level>wa;)pa=pa.parent;return pa.centerAtSeaLevel};za.setVisibility=function(pa){this.visible=pa;this.setNeedsRender()};za.getStats=function(){return{numTilesRendered:this.numTilesRendered,numTilesCulled:this.numTilesCulled,numOriginsRendered:this.numOriginsRendered}};za.setNeedsRender=function(pa=
N.RenderRequestType.UPDATE){this.patchGroupsDirty=!0;this.context.requestRender(pa)};za.setTileBackground=function(pa){this.tileBackground=pa;this._updateTileBackground()};za.initializeRenderContext=function(pa){this.context=pa;this.rctx=pa.renderContext.rctx;this.shaderTechniques=pa.shaderTechniqueRepository;this.shaderTechniqueConfig=new ha.TerrainTechniqueConfiguration;this.tileRenderer=new J.TileRenderer(this.rctx,this.tileSize,this.shaderTechniques);this.tileBackground&&this._updateTileBackground();
this.emptyTex=T.createEmptyTexture(this.rctx)};za.uninitializeRenderContext=function(){null!=this.emptyTex&&(this.emptyTex.dispose(),this.emptyTex=null);this.tileRenderer&&(this.tileRenderer.dispose(),this.tileRenderer=null)};za.intersect=function(pa,wa,na,qa){if(this._rootTiles&&(!pa.options.selectOpaqueTerrainOnly||!pa.options.selectionMode||this._opaque)){var ta=ja,Fa=la;y.subtract(ta,qa,na);y.set(Fa,1/ta[0],1/ta[1],1/ta[2]);var Ha=pa.results.min,Ka=pa.results.max,La=pa.results.ground,Ra=pa.options.store===
H.StoreResults.MIN,ab=!!pa.results.ground.target,Za=X.getVerticalOffsetTerrain(pa.verticalOffset),Pa=this._skirtScale,ua=pa.tolerance,Aa,Ia=Ra&&g.isSome(Ha.dist)?Ha.dist:Infinity,Na=Ua=>{var Ya=Ua.renderData;if(null!=Ya){var $a=Ya.geometryInfo;m.set(ea,$a.boundingBox);Ya=Ya.localOrigin;g.isSome(Za)&&(Za.localOrigin=Ya,Za.applyToAabb(ea));var sa=-Pa*$a.skirtLength;if(0!==sa){var Ca=Ua.up;m.expandWithOffset(ea,sa*Ca[0],sa*Ca[1],sa*Ca[2])}ma[0]=na[0]-Ya[0];ma[1]=na[1]-Ya[1];ma[2]=na[2]-Ya[2];if(ba.intersectAabbInvDirBefore(ea,
ma,Fa,ua,Ia)){var Ma=(hb,kb,Ab)=>{hb.set(this.type,Ua,kb,Ab,r.IDENTITY);Ia=Ra&&g.isSome(Ha.dist)?Ha.dist:Infinity};Ca=(hb,kb)=>{g.isSome(kb)&&0<=hb&&(pa.options.backfacesTerrain||0>y.dot(kb,ta))&&(pa.options.invisibleTerrain||!pa.options.selectionMode||null==wa||wa(na,qa,hb))&&((null==La.dist||hb<La.dist)&&Ma(La,hb,kb),pa.options.isFiltered||(pa.options.store===H.StoreResults.ALL&&(g.isNone(Aa)?(Aa=S.newIntersectorResult(pa.ray),Ma(Aa,hb,kb),pa.results.all.push(Aa)):hb<Aa.dist&&Ma(Aa,hb,kb)),(null==
Ha.dist||hb<Ha.dist)&&Ma(Ha,hb,kb),pa.options.store!==H.StoreResults.MIN&&(null==Ka.dist||hb>Ka.dist)&&Ma(Ka,hb,kb)))};var Xa=ra;y.subtract(Xa,qa,Ya);var Va=$a.indices,eb=$a.vertexAttributes,fb={data:eb.getField(aa.VertexAttribute.POSITION,u.BufferViewVec3f).typedBuffer,size:3,stride:eb.stride/4};$a=$a.numWithoutSkirtIndices/3;if(!g.isSome(Za)&&$a>P.componentMinimalSizeForIntersectionData){var qb=Ua.renderData;g.isSome(qb.intersectionData)||(qb.intersectionData=new P.ComponentIntersectionData(Va,
0,$a,fb));qb.intersectionData.intersectRay({r0:ma,r1:Xa},Ca)}else ba.intersectTriangles(ma,Xa,0,$a,Va,fb,null,Za,Ca);if(0!==sa){const hb=Va.length/3;this.isGlobal?(fb=hb-$a,!g.isSome(Za)&&fb>P.componentMinimalSizeForIntersectionData?(qb=Ua.renderData,g.isSome(qb.skirtIntersectionData)||(Ya=E.getGlobalSkirtGeometry(Va,$a,hb,eb,sa,Ya),qb.skirtIntersectionData=new P.ComponentIntersectionData(Ya.indices,0,fb,{data:Ya.vertices,stride:3})),qb.skirtIntersectionData.intersectRay({r0:ma,r1:Xa},Ca)):E.intersectSkirtsGlobal(ma,
Xa,$a,hb,Va,eb,sa,Ya,Za,Ca)):E.intersectSkirtsLocal(ma,Xa,$a,hb,Va,eb,sa,Za,Ca)}}}},Sa=this._rootTiles;g.isSome(Sa)&&(()=>{const Ua=this.tileIterator;Ua.reset(Sa);const Ya=pa.options.invisibleTerrain;for(;!Ua.done;){const $a=Ua.next();!($a.visible||Ya&&$a.intersectsClippingArea)||!g.isSome(Za)&&!$a.intersectsRay(na,ta,ua,Ia,Pa)||ab&&this._useStencilForTile($a)?Ua.skipSubtree():Na($a)}})()}};za.prepareTechnique=function(pa){if(pa.slot===V.RenderSlot.OCCLUDED_TERRAIN){if(0===(pa.renderOccludedMask&
A.overlayRenderOccludedFlag))return null}else if(pa.slot!==(this.opaque?V.RenderSlot.OPAQUE_TERRAIN:V.RenderSlot.TRANSPARENT_TERRAIN))return null;switch(pa.pass){case W.RenderPass.MATERIAL:var wa=pa.shadowMap&&pa.shadowMap.enabled;this.shaderTechniqueConfig.receiveShadows!==wa&&(this.shaderTechniqueConfig.receiveShadows=wa);wa=this.overlayRenderer.isEmpty()?R.OverlayMode.Disabled:this.overlayRenderer.hasWater?R.OverlayMode.EnabledWithWater:R.OverlayMode.Enabled;this.shaderTechniqueConfig.overlayMode!==
wa&&(this.shaderTechniqueConfig.overlayMode=wa);return this._updateTechnique(K.ShaderOutput.Color,(pa.slot===V.RenderSlot.OCCLUDED_TERRAIN?B.OverlaySource.Occluded:B.OverlaySource.ColorAndWater)===B.OverlaySource.Occluded);case W.RenderPass.MATERIAL_DEPTH_SHADOWMAP_ALL:case W.RenderPass.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:if(this.castShadows&&1===pa.scenelightingData.globalFactor)return this._updateTechnique(K.ShaderOutput.Shadow,!1);break;case W.RenderPass.MATERIAL_DEPTH:if(!this.isTransparent||!this.overlayRenderer.isEmpty())return this._updateTechnique(K.ShaderOutput.Depth,
!1);break;case W.RenderPass.MATERIAL_NORMAL:return this._updateTechnique(K.ShaderOutput.Normal,!1);case W.RenderPass.MATERIAL_HIGHLIGHT:if(this.needsHighlight)return this._updateTechnique(K.ShaderOutput.Highlight,!1)}return null};za.render=function(pa,wa){const na=pa.pass,qa=1===pa.scenelightingData.globalFactor;this._updatePatchGroups();wa.useStencil=!1;switch(na){case W.RenderPass.MATERIAL:this._renderMaterialPass(pa,wa,pa.slot===V.RenderSlot.OCCLUDED_TERRAIN?B.OverlaySource.Occluded:B.OverlaySource.ColorAndWater);
break;case W.RenderPass.MATERIAL_DEPTH_SHADOWMAP_ALL:case W.RenderPass.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:this.castShadows&&qa&&this._renderAuxiliaryPass(pa,wa,B.OverlaySource.None);break;case W.RenderPass.MATERIAL_DEPTH:this.isTransparent&&this.overlayRenderer.isEmpty()||this._renderAuxiliaryPass(pa,wa,B.OverlaySource.None);break;case W.RenderPass.MATERIAL_NORMAL:this._renderAuxiliaryPass(pa,wa,B.OverlaySource.None);break;case W.RenderPass.MATERIAL_HIGHLIGHT:this.needsHighlight&&(this._renderAuxiliaryPass(pa,
wa,B.OverlaySource.Highlight),pa.rctx.clearSafe(ka.ClearBufferBit.DEPTH_BUFFER_BIT))}this._scaleRangeQueries.hasPendingQueries()&&this.setNeedsRender()};za._renderMaterialPass=function(pa,wa,na){const {rctx:qa,camera:ta}=pa;this._ssrEnabled=pa.ssrParams.ssrEnabled;const Fa=qa.useTechnique(wa,pa.slot);this.shaderTechniqueConfig.overlayMode!==R.OverlayMode.Disabled&&na===B.OverlaySource.ColorAndWater&&pa.ssrParams&&U.bindSSRUniforms(Fa,pa.ssrParams);pa.shadowMap.bind(Fa);pa.ssaoHelper.bind(Fa,pa.camera);
this._bindOverlayData(Fa,na);Fa.setUniformMatrix4fv("viewNormal",ta.viewInverseTransposeMatrix);L.bindProjectionMatrix(Fa,ta.projectionMatrix);pa.scenelightingData.setUniforms(Fa,!0,!1);const Ha=ta.viewMatrix;y.set(fa,Ha[12],Ha[13],Ha[14]);y.normalize(fa,fa);Fa.setUniform3fv("viewDirection",fa);this.numOriginsRendered=this.numTilesCulled=this.numTilesRendered=0;this._scaleRangeQueries.prepareQueries();this.opaque?this._renderPatchGroups(pa,wa,na):pa.offscreenRenderingHelper.renderToTargets(()=>this._renderPatchGroups(pa,
wa,na),pa.offscreenRenderingHelper.tmpColor,pa.offscreenRenderingHelper.mainDepth,[0,0,0,0]);this._scaleRangeQueries.processQueries()};za._renderAuxiliaryPass=function(pa,wa,na){const qa=pa.rctx.useTechnique(wa,pa.slot);if(pa.pass===W.RenderPass.MATERIAL_HIGHLIGHT){const ta=pa.offscreenRenderingHelper;qa.bindTexture(ta.depthTexture,"depthTex");qa.setUniform4f("highlightViewportPixelSz",0,0,1/ta.width,1/ta.height)}else qa.setUniformMatrix4fv("viewNormal",pa.camera.viewInverseTransposeMatrix),pa.pass!==
W.RenderPass.MATERIAL_DEPTH&&pa.pass!==W.RenderPass.MATERIAL_DEPTH_SHADOWMAP_ALL&&pa.pass!==W.RenderPass.MATERIAL_DEPTH_SHADOWMAP_DEFAULT||qa.setUniform2fv("nearFar",pa.camera.nearFar);this._renderPatchGroupsAuxiliary(pa,wa,na)};za._updateTileBackground=function(){if(this.tileRenderer){this.tileBackgroundUpdating=!0;var pa=()=>{this.tileBackgroundInitialized=!0;this.tileBackgroundUpdating=!1;this.shaderTechniqueConfig.useGrid=this.tileRenderer.backgroundIsGrid;this.shaderTechniqueConfig.hasBackgroundColor=
!this.tileRenderer.backgroundIsGrid&&!!g.isSome(this.tileRenderer.backgroundColor);this.allTiles.forAll(wa=>this.tileRenderer.updateTileTexture(wa,z.TextureUpdate.FADING));this.setNeedsRender()};if("string"===typeof this.tileBackground){const wa=this.tileBackground;t.requestImage(wa).then(na=>{wa===this.tileBackground&&this.tileRenderer&&(this.tileRenderer.setBackground(na,this.tileBackground===G.DEFAULT_TILE_BACKGROUND),pa())})}else{const wa=this.tileBackground?c.toUnitRGBA(this.tileBackground):
[0,0,0,0];this.tileRenderer.setBackground(wa,!1);pa()}}};za._updatePatchGroups=function(){if(this.patchGroupsDirty){this.highestVisibleLODTile=null;this._rebuildPatchGroups();if(this.renderOrder!==D.RenderOrder.NONE){const pa=Array.from(this._patchGroups.values());pa.forEach(wa=>O.sortTiles(this.renderOrder,wa));pa.sort((wa,na)=>O.compareTiles(wa[0],na[0],this.renderOrder));this._patchGroups=new Map(pa.map(wa=>[wa[0].renderData.localOrigin,wa]))}this.patchGroupsDirty=!1}};za._rebuildPatchGroups=function(){const pa=
this._rootTiles;if(!g.isNone(pa)){this._patchGroups.clear();for(const wa of pa)this._rebuildPatchGroupsForRootTile(wa)}};za._rebuildPatchGroupsForRootTile=function(pa){const wa=this.tileIterator;for(wa.resetOne(pa);!wa.done;){pa=wa.next();const na=pa.renderData;if(na&&!pa.visible)this.numTilesCulled++,wa.skipSubtree();else if(!pa.rendered)this.numTilesCulled++;else if(na){const qa=this._patchGroups.get(na.localOrigin)||[];this._patchGroups.set(na.localOrigin,qa);qa.push(pa);if(!this.highestVisibleLODTile||
pa.vlevel>this.highestVisibleLODTile.vlevel)this.highestVisibleLODTile=pa;wa.skipSubtree()}}};za._useStencilForTile=function(pa){for(const wa of this.stencilEnabledLayerExtents)if(pa.intersectsExtent(wa))return!0;return!1};za._renderPatchGroupsAuxiliary=function(pa,wa,na){wa.program.setUniformMatrix4fv("proj",pa.camera.projectionMatrix);wa.program.setUniform1f("skirtScale",this._skirtScale);na!==B.OverlaySource.None&&this._bindOverlayData(wa.program,na);const qa=0<this.stencilEnabledLayerExtents.length;
this._patchGroups.forEach(ta=>{this._bindPatchGroupData(wa.program,ta[0].renderData.localOrigin,pa.camera.eye,pa.camera.viewMatrix);for(let Fa=0;Fa<ta.length;Fa++)this._renderPatch(pa,wa,ta[Fa],ka.PrimitiveType.TRIANGLES,qa,na)});pa.rctx.bindVAO(null)};za._renderPatchGroups=function(pa,wa,na){const qa=pa.rctx,ta=pa.camera,Fa=ta.viewMatrix,Ha=wa.program;if(this.shaderTechniqueConfig.screenSizePerspective&&this.pointsOfInterest){var Ka=Y.getSettings(this.stage.viewingMode,this.ellipsoidRadius);Ka.update({distance:this.pointsOfInterest.centerOnSurfaceFrequent.distance,
fovY:ta.fovY});ba.bindScreenSizePerspective(Ka,Ha,"screenSizePerspective")}const La=0<this.stencilEnabledLayerExtents.length,Ra=na===B.OverlaySource.Occluded;Ra&&(Ha.bindTexture(this.emptyTex,"tex"),Ha.setUniform1f("blend",1),Ha.setUniform4fv("texOffsetAndScale",h.ZEROS));Ka=g.isSome(this.tileRenderer.backgroundColor)?this.tileRenderer.backgroundColor:p.ZEROS;this.shaderTechniqueConfig.hasBackgroundColor&&Ha.setUniform3fv("backgroundColor",Ka);Ha.setUniform1f("skirtScale",Ra?0:this._skirtScale);const ab=
this.wireframe?ka.PrimitiveType.LINES:ka.PrimitiveType.TRIANGLES;this.shaderTechniqueConfig.textureFadingEnabled&&Ha.bindTexture(this.emptyTex,"texNext");this._patchGroups.forEach(Za=>{var Pa=Za[0].renderData.localOrigin;this._bindPatchGroupData(Ha,Pa,ta.eye,Fa);M.bindSliceUniforms(Ha,wa.configuration,pa.sliceHelper&&pa.sliceHelper.plane,{origin:Pa});pa.shadowMap&&pa.shadowMap.bindView(Ha,Pa);this.numOriginsRendered++;for(Pa=0;Pa<Za.length;Pa++){const ua=Za[Pa],Aa=ua.renderData.textureReference;if(!g.isNone(Aa)){if(!Ra){this._scaleRangeQueries.scaleQueriesForTile(ua);
ia(ua.renderData.geometryInfo.uvOffsetAndScale,Aa.offsetAndScale,ca);Ha.setUniform4fv("texOffsetAndScale",ca);Ha.bindTexture(Aa.texture.texture,"tex");const Ia=ua.renderData.textureFadeFactor,Na=1>Ia?ua.renderData.nextTextureReference:null;this.shaderTechniqueConfig.textureFadingEnabled&&g.isSome(Na)&&1>Ia?(ia(ua.renderData.geometryInfo.uvOffsetAndScale,Na.offsetAndScale,ca),Ha.setUniform1f("fadeFactor",Ia),Ha.setUniform4fv("nextTexOffsetAndScale",ca),Ha.setUniform3fv("nextTexOpacities",Na.opacities),
Ha.bindTexture(Na.texture.texture,"texNext")):Ha.setUniform1f("fadeFactor",1);ua.renderData.textureIsFading&&this.setNeedsRender();Ha.setUniform3fv("textureOpacities",Aa.opacities)}this._renderPatch(pa,wa,ua,ab,La,na);ua.renderOrder=this.numTilesRendered;this.numTilesRendered++}}});qa.bindVAO(null)};za._renderPatch=function(pa,wa,na,qa,ta,Fa){if(!g.isNone(na.renderData.vao.indexBuffer)){var Ha=wa.program;Fa!==B.OverlaySource.None&&this._bindOverlayPatchData(Ha,na.renderData.overlay);ta&&(wa.useStencil=
this._useStencilForTile(na),wa.bindPipelineState(pa.rctx,pa.slot));wa=0===this._skirtScale?na.renderData.geometryInfo.numWithoutSkirtIndices:na.renderData.vao.indexBuffer.size;pa.rctx.bindVAO(na.renderData.vao);Ha.assertCompatibleVertexAttributeLocations(na.renderData.vao);pa.rctx.drawElements(qa,wa,na.renderData.vao.indexBuffer.indexType,0)}};za._bindPatchGroupData=function(pa,wa,na,qa){pa.setUniform3fv("origin",wa);k.translate(Z,qa,wa);pa.setUniformMatrix4fv("view",Z);pa.setUniform3f("cameraPosition",
na[0]-wa[0],na[1]-wa[1],na[2]-wa[2])};za._bindOverlayData=function(pa,wa){if(this.shaderTechniqueConfig.overlayMode!==R.OverlayMode.Disabled){pa.setUniform1f("overlayOpacity",this.overlayOpacity);var na=this.overlayRenderer.overlays;if(na.length>z.OverlayIndex.INNER){na=na[z.OverlayIndex.INNER];const qa=na.getColorTexture(wa);pa.bindTexture(g.isSome(qa)?qa:this.emptyTex,"ovColorTex");this.shaderTechniqueConfig.overlayMode===R.OverlayMode.EnabledWithWater&&(wa=na.getNormalTexture(wa),pa.bindTexture(g.isSome(wa)?
wa:this.emptyTex,"ovWaterTex"))}}};za._bindOverlayPatchData=function(pa,wa){pa.setUniform4fv("overlayTexOffset",wa.offsets);pa.setUniform4fv("overlayTexScale",wa.scales)};za._updateTechnique=function(pa,wa){this.shaderTechniqueConfig.output=pa;pa===K.ShaderOutput.Color&&(this.shaderTechniqueConfig.atmosphere=this.isGlobal&&this._velvetOverground,this.shaderTechniqueConfig.ssrEnabled=this._ssrEnabled);this.shaderTechniqueConfig.renderOccluded=wa;this.shaderTechniqueConfig.stencilEnabled=!1;return this._shaderTechnique=
this.shaderTechniques.releaseAndAcquire(ha.TerrainTechnique,this.shaderTechniqueConfig,this._shaderTechnique)};a._createClass(ya,[{key:"isGlobal",get:function(){return this.stage.viewingMode===q.ViewingMode.Global}},{key:"updating",get:function(){return!this.tileBackgroundInitialized||this.tileBackgroundUpdating}},{key:"canRender",get:function(){return this.visible&&!!this._rootTiles&&this.tileBackgroundInitialized&&!this.renderingDisabled}},{key:"renderingDisabled",set:function(pa){this._set("renderingDisabled",
!!pa);this.setNeedsRender()}},{key:"opaque",get:function(){return this._opaque&&!this.shaderTechniqueConfig.slicePlaneEnabled},set:function(pa){this._opaque!==pa&&(this._opaque=pa,this.setNeedsRender())}},{key:"needsLinearDepth",get:function(){return this.overlayRenderer.hasWater}},{key:"isTransparent",get:function(){return this._isTransparent},set:function(pa){this._isTransparent!==pa&&(this._isTransparent=pa,this.setNeedsRender())}},{key:"skirtScale",get:function(){return this._skirtScale},set:function(pa){pa!==
this._skirtScale&&(this._skirtScale=pa,this.setNeedsRender())}},{key:"renderPatchBorders",get:function(){return!!this.shaderTechniqueConfig.tileBorders},set:function(pa){this.shaderTechniqueConfig.tileBorders!==pa&&(this.shaderTechniqueConfig.tileBorders=pa,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}},{key:"cullBackFaces",get:function(){return this.shaderTechniqueConfig.backfaceCullingEnabled},set:function(pa){this.shaderTechniqueConfig.backfaceCullingEnabled!==pa&&(this.shaderTechniqueConfig.backfaceCullingEnabled=
pa,this.notifyChange("cullBackFaces"),this.setNeedsRender())}},{key:"renderOrder",set:function(pa){this._set("renderOrder",pa);this.setNeedsRender()}},{key:"velvetOverground",set:function(pa){this._velvetOverground!==pa&&(this._velvetOverground=pa,this.setNeedsRender())}},{key:"layerUid",get:function(){return X.TERRAIN_ID}},{key:"slicePlaneEnabled",get:function(){return this.shaderTechniqueConfig.slicePlaneEnabled},set:function(pa){this.shaderTechniqueConfig.slicePlaneEnabled!==pa&&(this.shaderTechniqueConfig.slicePlaneEnabled=
pa,this.setNeedsRender())}},{key:"textureFadingEnabled",set:function(pa){this.shaderTechniqueConfig.textureFadingEnabled!==pa&&(this.shaderTechniqueConfig.textureFadingEnabled=pa,this.setNeedsRender())}},{key:"wireframe",set:function(pa){this._get("wireframe")!==pa&&(this._set("wireframe",pa),this.allTiles.forAll(wa=>{var na;return null==(na=wa.renderData)?void 0:na.updateGeometry(this.rctx,pa)}),this.setNeedsRender())}},{key:"test",get:function(){return{tileRenderer:this.tileRenderer}}}]);return ya}(d);
b.__decorate([w.property()],d.prototype,"tileBackgroundInitialized",void 0);b.__decorate([w.property()],d.prototype,"tileBackgroundUpdating",void 0);b.__decorate([w.property({constructOnly:!0})],d.prototype,"overlayRenderer",void 0);b.__decorate([w.property({constructOnly:!0})],d.prototype,"stage",void 0);b.__decorate([w.property({readOnly:!0})],d.prototype,"isGlobal",null);b.__decorate([w.property({constructOnly:!0})],d.prototype,"allTiles",void 0);b.__decorate([w.property({constructOnly:!0})],d.prototype,
"ellipsoidRadius",void 0);b.__decorate([w.property({readOnly:!0})],d.prototype,"updating",null);b.__decorate([w.property({value:!1})],d.prototype,"renderingDisabled",null);b.__decorate([w.property()],d.prototype,"renderPatchBorders",null);b.__decorate([w.property()],d.prototype,"cullBackFaces",null);b.__decorate([w.property({value:D.RenderOrder.FRONT_TO_BACK})],d.prototype,"renderOrder",null);b.__decorate([w.property()],d.prototype,"wireframe",null);b=d=b.__decorate([e.subclass("esri.views.3d.terrain.TerrainRenderer")],
d);const Z=r.create(),fa=p.create(),ja=p.create(),la=p.create(),ma=p.create(),ra=p.create();return b})},"esri/views/3d/terrain/PatchRenderData":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/arrayUtils ../../../core/maybe ../../../geometry/support/aaBoundingBox ../support/buffer/glUtil ./GeometryState ./LayerClass ./PatchGeometryFactory ./TextureFader ./TileOverlayData ./tileUtils ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/BufferObject ../../webgl/VertexArrayObject".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p){let h=function(){function m(){this.geometryInfo=new n.PatchGeometry;this.skirtIntersectionData=this.intersectionData=null;this.geometryState=new w.GeometryState;this._textureRef=new f.default(()=>this.tile.surface.textureFadeDuration);this.overlay=new e}var u=m.prototype;u.init=function(t){this.tile=t;this.clear();t=this.geometryInfo;t.indices=null;t.vertexAttributes=null;g.empty(t.boundingBox);t.numSurfaceIndices=0;t.numSkirtIndices=0;t.numWithoutSkirtIndices=
0;t.numVertsPerRow=0;this.skirtIntersectionData=this.intersectionData=null;this.geometryState=new w.GeometryState;this.localOrigin=null;this.overlay.clear()};u.clear=function(){this.releaseGeometry();this.releaseTexture();this._textureRef.clear()};u.updateGeometry=function(t,q){if(!this._updateGeometryState(q))return!1;this._releaseGeometry();this._createGeometry(t);return!0};u.releaseGeometry=function(){return this._releaseGeometry()?(this.geometryState=new w.GeometryState,!0):!1};u.ensureTexture=
function(t,q){d.isSome(this._texture)&&this._texture.descriptor.width!==t&&this.releaseTexture();d.isNone(this._texture)&&(this._texture=q(),this.tile.setMemoryDirty());return this._texture};u.releaseTexture=function(){d.isSome(this._texture)&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())};u._updateGeometryState=function(t){const q=this._getElevationInfo(),z=q.samplerData?this.tile.getElevationBasedVerticesPerRow(q.maxTileLevel):this.tile.getDefaultVerticesPerRowOnLevel();
let v=this.tile.clippingArea;if(!this.tile.intersectsClippingArea||this.tile.isWithinClippingArea)v=null;const B=this.geometryState;let A=!1;B.numVertsPerSide!==z&&(B.numVertsPerSide=z,A=!0);q.changed&&(B.samplerData=q.samplerData,A=!0);c.equals(B.clippingArea,v)||(B.clippingArea=v,A=!0);B.wireframe!==t&&(B.wireframe=t,A=!0);return A};u._createGeometry=function(t){this.tile.createGeometry(this.geometryState,this.localOrigin);const q=this.geometryInfo.vertexAttributes,z=this.geometryInfo.indices,v=
t.gl;this._vao=new p.VertexArrayObject(t,r.Default3D,{geometry:x.glLayout(q.layout)},{geometry:y.BufferObject.createVertex(t,v.STATIC_DRAW,q.buffer)},y.BufferObject.createIndex(t,v.STATIC_DRAW,z))};u._releaseGeometry=function(){if(!this._vao)return!1;this._vao.dispose();this._vao=null;n.releaseGeometry(this.geometryInfo);return!0};u.setTextureReference=function(t,q=f.ActivationTime.Immediate){d.isSome(t)&&t.texture!==this._texture&&this.releaseTexture();this._textureRef.push(t,q)};u._getElevationInfo=
function(){const t=this.geometryState.samplerData,q=this.tile.layerInfo[l.LayerClass.ELEVATION],z=q.length;let v=Array(z),B=0;var A=0;let E=!1;for(let F=0;F<z;F++){var C=q[F];if(C.upsampleInfo){C=C.upsampleInfo.tile;var D=C.layerInfo[l.LayerClass.ELEVATION][F].data;D=D&&D.samplerData;t&&t[B]===D||(E=!0);v[B++]=D;A=Math.max(A,C.lij[0])}else C.data&&(D=this.tile.surface.layerViewByIndex(F,l.LayerClass.ELEVATION),k.fallsWithinLayer(this.tile,D.layer,!1)&&(A=C.data,t&&t[B]===A.samplerData||(E=!0),v[B++]=
A.samplerData,A=this.tile.level))}d.isSome(t)&&t.length!==B&&(E=!0);0<B?v.length=B:v=null;return{changed:E,samplerData:v,maxTileLevel:A}};b._createClass(m,[{key:"vao",get:function(){return this._vao}},{key:"textureReference",get:function(){return this._textureRef.current}},{key:"nextTextureReference",get:function(){return this._textureRef.next}},{key:"textureFadeFactor",get:function(){return this._textureRef.fadeFactor}},{key:"textureIsFading",get:function(){return this._textureRef.isFading}},{key:"estimatedGeometryMemoryUsage",
get:function(){const t=d.mapOr(this.intersectionData,0,q=>q.estimatedMemoryUsage)+d.mapOr(this.skirtIntersectionData,0,q=>q.estimatedMemoryUsage+q.vertexPositionBuffer.byteLength);return this.geometryInfo.indices.byteLength+this.geometryInfo.vertexAttributes.byteLength+t}},{key:"textureDescriptor",get:function(){return d.isSome(this._texture)?this._texture.descriptor:null}},{key:"test",get:function(){return{hasTexture:null!=this._texture}}}]);return m}();Object.defineProperty(a,"ActivationTime",{enumerable:!0,
get:()=>f.ActivationTime});a.PatchRenderData=h;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/GeometryState":function(){define(["exports"],function(a){a.GeometryState=function(){this.numVertsPerSide=0;this.wireframe=!1};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/TextureFader":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","./interfaces"],function(a,b,c,d){let g=function(){function x(l){this._getFadeDuration=
l;this._delayedTime=this._fadeStart=0}var w=x.prototype;w.clear=function(){this._current=c.destroyMaybe(this._current);this._next=c.destroyMaybe(this._next);this._waiting=c.destroyMaybe(this._waiting);this._delayed=c.destroyMaybe(this._delayed)};w.push=function(l,n=a.ActivationTime.Immediate){this._delayed=c.destroyMaybe(this._delayed);this._push(l,n)};w._push=function(l,n){this._isFadingEnabled||this.clear();if(c.isNone(this._current))this._current=l;else{var f=x.test.fadeMoment||performance.now();
n!==a.ActivationTime.Immediate?(this._delayed=l,this._delayedTime=f+n):c.isNone(this._next)?(this._next=l,this._fadeStart=this._alignFadeStart(f)):c.isNone(l)||(c.destroyMaybe(this._waiting),this._waiting=l)}};w._alignFadeStart=function(l){const n=this._getFadeDuration();return l+n-l%n};b._createClass(x,[{key:"current",get:function(){if(c.isNone(this._current))return null;if(!this._isFadingEnabled){var l=this._delayed||this._waiting||this._next||this._current;l!==this._current&&(this._current=null,
this.clear(),this._current=l)}l=x.test.fadeMoment;c.isSome(this._delayed)&&(l=l||performance.now(),l>=this._delayedTime&&(this._push(this._delayed,a.ActivationTime.Immediate),this._delayed=null));if(c.isSome(this._next)){l=l||performance.now();var n=this._fadeDuration;const f=c.isSome(this._current)&&this._next.texture===this._current.texture,e=this._next.type!==d.TextureUpdate.FADING;n=l-this._fadeStart>=n;if(f||e||n)c.destroyMaybe(this._current),this._current=this._next,this._next=this._waiting,
this._waiting=null,this._fadeStart=this._alignFadeStart(l)}return this._current}},{key:"next",get:function(){return this._next}},{key:"fadeFactor",get:function(){if(c.isNone(this._next))return 1;var l=x.test.fadeMoment||performance.now();l=Math.max(0,l-this._fadeStart);const n=this._fadeDuration;return l>n?0:1-l/n}},{key:"isFading",get:function(){return c.isSome(this._next)||c.isSome(this._delayed)}},{key:"_fadeDuration",get:function(){return c.isNone(this._waiting)?this._getFadeDuration():.5*this._getFadeDuration()}},
{key:"_isFadingEnabled",get:function(){return 0<this._getFadeDuration()}}]);return x}();g.test={fadeMoment:0};a.ActivationTime=void 0;(function(x){x[x.Immediate=0]="Immediate";x[x.Delayed=5E3]="Delayed"})(a.ActivationTime||(a.ActivationTime={}));a.default=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/TileOverlayData":function(){define(["../../../chunks/_rollupPluginBabelHelpers"],function(a){return function(){function b(){this._scales=[-1,-1,-1,-1];this._offsets=[-1,
-1,-1,-1]}var c=b.prototype;c.clear=function(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1;this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1};c.setScale=function(d,g,x){this._scales[2*d]=g;this._scales[2*d+1]=x};c.setOffset=function(d,g,x){this._offsets[2*d]=g;this._offsets[2*d+1]=x};a._createClass(b,[{key:"scales",get:function(){return this._scales}},{key:"offsets",get:function(){return this._offsets}}]);return b}()})},"esri/views/3d/terrain/ScaleRangeQueries":function(){define(["exports",
"../../../core/ObjectPool","../../../core/PooledArray","../../../chunks/vec4","../../../chunks/vec4f64"],function(a,b,c,d,g){let x=function(){this.extent=g.create();this.maxLevel=this.minLevel=0;this.callback=null},w=function(){function l(){this._queries=new c({initialSize:10});this._queriesInvPtr=0;this._queryQueue=new c({initialSize:30});this._queryPool=new b(x)}var n=l.prototype;n.queryVisibleLevelRange=function(f,e,k,r){const y=this._queryPool.acquire();d.copy(y.extent,f);y.minLevel=e?e:-Number.MAX_VALUE;
y.maxLevel=null!=k?k:Number.MAX_VALUE;y.callback=r;this._queryQueue.push(y)};n.hasPendingQueries=function(){return 0!==this._queryQueue.length};n.prepareQueries=function(){for(;this._queries.length<this._queries.data.length&&0<this._queryQueue.length;){const f=this._queryQueue.pop();this._queries.push(f)}this._queriesInvPtr=this._queries.length};n.processQueries=function(){for(let f=0;f<this._queries.length;f++){const e=this._queries.data[f];this._queryPool.release(e);e.callback(f>=this._queriesInvPtr);
e.callback=null}this._queries.clear()};n.scaleQueriesForTile=function(f){const e=f.level;let k=0;for(;k<this._queriesInvPtr;){const r=this._queries.data[k],y=r.extent;e>=r.minLevel&&e<=r.maxLevel&&y[0]<=f.extent[2]&&y[2]>=f.extent[0]&&y[1]<=f.extent[3]&&y[3]>=f.extent[1]?(this._queries.swapElements(k,this._queriesInvPtr-1),this._queriesInvPtr--):k++}};return l}();a.ScaleRangeQueries=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/TileRenderer":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../core/maybe ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../chunks/vec3f64 ../../../chunks/vec4f64 ../../../layers/support/layerUtils ../../2d/engine/imagery/enums ../../2d/engine/vectorTiles/VectorTileRendererHelper3D ../support/StreamDataLoader ./BlendLayersTechnique ./interfaces ./LayerClass ../../../core/arrayUtils ../../../geometry/support/aaBoundingBox ../support/buffer/glUtil ./PatchGeometryFactory ./TextureFader ../../../core/HeapSort ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/BufferObject ../../webgl/VertexArrayObject ./RasterColorizerTechnique ./terrainUtils ./TextureReference ./TileTexture ./TileUpdate ./support/FBOPool ../webgl-engine/core/shaderLibrary/output/BlendOptions ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../../webgl/enums ../../webgl/Texture ../../webgl/Util".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E,C,D,F,G,J,I,O,P,K,M,U){function R(S,H,Q){Q.layerIndex=H;const W=S.layerInfo[p.LayerClass.MAP][H];return W.data?(g.set(Q.offset,0,0),Q.tile=S,Q.scale=1,Q.sourceLod=S.lij,Q.sourceLayerInfo=W,Q):(S=W.upsampleInfo)?(H=S.tile.layerInfo[p.LayerClass.MAP][H],Q.tile=S.tile,g.copy(Q.offset,S.offset),Q.scale=S.scale,Q.sourceLod=S.tile.lij,Q.sourceLayerInfo=H,Q):null}h=function(){function S(Q,W,V){this._rctx=Q;this.tileSize=W;this._techniqueRepository=
V;this._backgroundIsGrid=!1;this._blackTex=this._backgroundColor=this._backgroundTexture=null;this._vectorTileHelper=new e.VectorTileRendererHelper3D;this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy;this._vaoQuad=P.createQuadVAO(this._rctx,O.Pos2Tex);this._blackTex=new F(P.createColorTexture(this._rctx,[0,0,0,1]));this._fboPool=new J.FBOPool(this._rctx)}var H=S.prototype;H.dispose=function(){this._fboPool&&(this._fboPool.clear(),this._fboPool=null);this._vaoQuad=d.disposeMaybe(this._vaoQuad);
this._backgroundTexture=d.releaseMaybe(this._backgroundTexture);this._blackTex=d.releaseMaybe(this._blackTex);this._blendLayersTechnique=d.releaseMaybe(this._blendLayersTechnique);this._applyOpacityTechnique=d.releaseMaybe(this._applyOpacityTechnique);this._vectorTileHelper=d.disposeMaybe(this._vectorTileHelper)};H.updateTileTexture=function(Q,W){var V=Q.layerInfo[p.LayerClass.MAP];for(var Y of V)Y.pendingUpdates&=~(G.TileUpdate.TEXTURE_NOFADING&G.TileUpdate.TEXTURE_FADING);if(Q.renderData){for(var aa=
Q.surface,X=aa.baseOpacity,ba=Y=0,ha=this.tileSize,ka=!1,ia=aa.view.pixelRatio,ea=V.length,ca=0;ca<V.length&&!ka;ca++){const Z=aa.layerViewByIndex(ca,p.LayerClass.MAP),fa=Z.fullOpacity;L[ca]=fa;n.isBaseLayer(Z.layer)&&ea>=V.length&&(ea=ca);if(0===fa)continue;++ba;const ja=R(Q,ca,N);ja&&(C.isVectorTileLayerView(Z)?ha=Math.max(ha,this.tileSize*ia):1===X&&1===fa&&(Z.isOpaque||this._dataToTexture(ja)&&ja.sourceLayerInfo.data.descriptor.isOpaque)&&(ka=!0),++Y)}this._cleanupFBOPool(ia,V.length);X=ha;ha=
c.nextHighestPowerOfTwo(X);V=ha*ha;aa=X*X;V===aa?ha=X:(X=ha/2,ha=V-aa<aa-X*X?ha:X);V=ha/this.tileSize;--ca;0===Y?this._useBackgroundTexture(Q,ba):1===Y&&(ka||this._backgroundIsGrid||d.isSome(this._backgroundColor))&&this._useLayerTexture(Q,ca,ea,L[ca])||this._composeMapLayers(Q,W,ca,ea,ka,L,ha,V)}};H._useBackgroundTexture=function(Q,W){let V=q.ActivationTime.Immediate;if(Q.surface.view.layerViewManager.updating||0<W)V=q.ActivationTime.Delayed;this._backgroundTexture&&d.isNone(Q.renderData.textureReference)&&
(V=q.ActivationTime.Immediate);Q.renderData.setTextureReference(d.isSome(this._backgroundTexture)?new D.TextureReference(this._backgroundTexture,y.TextureUpdate.FADING,T,Q.surface.baseOpacity,1,1,!1):null,V)};H._useLayerTexture=function(Q,W,V,Y){var aa=W<V;V=aa?1:Q.surface.baseOpacity;aa=aa?Q.surface.baseOpacity:1;W=R(Q,W,N);return this._dataToTexture(W)?(Q.renderData.setTextureReference(new D.TextureReference(W.sourceLayerInfo.data,y.TextureUpdate.FADING,W,V,Y,aa,!0)),!0):!1};H._composeMapLayers=
function(Q,W,V,Y,aa,X,ba,ha){const ka=this._rctx,ia=this._fboPool.acquire(ba);ka.bindFramebuffer(ia);ka.setViewport(0,0,ba,ba);ka.setClearColor(0,0,0,0);ka.setClearDepth(1);ka.clearSafe(K.ClearBufferBit.COLOR_BUFFER_BIT|K.ClearBufferBit.DEPTH_BUFFER_BIT);let ea=!1;!aa&&d.isSome(this._backgroundTexture)&&this._drawRasterData(this.blendLayersTechnique,this._backgroundTexture.texture,1,x.ZEROS);aa=Q.surface.baseOpacity;let ca=!1,Z=K.TextureSamplingMode.LINEAR_MIPMAP_LINEAR;for(;0<=V;V--){const fa=R(Q,
V,N);fa&&(V<Y&&1>aa&&!ca&&(this._drawRasterData(this.applyOpacityTechnique,this._blackTex.texture,1,x.ZEROS,aa),ca=!0),0!==X[V]&&(C.isVectorTileRenderInfo(fa)?ea=this._drawVectorData(this.blendLayersTechnique,fa,ha,X[V],ba,ia,ea):C.isImageryTileRenderInfo(fa)?(this._drawImageryTileData(fa,X[V]),this._hasNearestInterpolation(fa)&&(Z=K.TextureSamplingMode.NEAREST)):this._dataToTexture(fa)&&this._drawRasterData(this.blendLayersTechnique,fa.sourceLayerInfo.data.texture,fa.scale,fa.offset,X[V])))}Y=Q.renderData.ensureTexture(ba,
()=>this._buildTexture(ba,Z));X=ka.bindTexture(Y.texture,M.Texture.TEXTURE_UNIT_FOR_UPDATES);ha=Y.descriptor;ka.gl.copyTexImage2D(ka.gl.TEXTURE_2D,0,ha.pixelFormat,0,0,ha.width,ha.height,0);Y.generateMipmap();ka.bindTexture(X,M.Texture.TEXTURE_UNIT_FOR_UPDATES);ka.bindFramebuffer(null);this._fboPool.release(ia);Q.renderData.setTextureReference(new D.TextureReference(Y,W,T,ca?1:aa,1,1,!1))};H._drawQuad=function(Q){this._rctx.bindVAO(this._vaoQuad);Q.assertCompatibleVertexAttributeLocations(this._vaoQuad);
this._rctx.drawArrays(K.PrimitiveType.TRIANGLE_STRIP,0,U.vertexCount(this._vaoQuad,"geometry"))};H._drawRasterData=function(Q,W,V,Y,aa=1){d.isNone(W)||(Q=this._rctx.useTechnique(Q),Q.bindTexture(W,"tex"),Q.setUniform1f("scale",V),Q.setUniform2f("offset",Y[0],Y[1]),Q.setUniform1f("opacity",aa),this._drawQuad(Q))};H._hasNearestInterpolation=function(Q){Q=Q.sourceLayerInfo.data;return Q.source?"nearest"===Q.interpolation:!1};H._drawImageryTileData=function(Q,W=1){const V=Q.sourceLayerInfo.data;if(V.source){Q.tile.surface.layerViewByIndex(Q.layerIndex,
p.LayerClass.MAP).ensureSymbolizerParameters(V);var Y=this._getRasterColorizerTechnique(V),aa=this._rctx,X=aa.useTechnique(Y);if(V.bind(aa)){V.opacity=W;V.scale=Q.scale;V.offset=Q.offset;var {names:ba,textures:ha}=V.getTextures();ba.forEach((ka,ia)=>X.bindTexture(ha[ia],ka));Y.bindPass(V.getUniforms());this._drawQuad(X);aa.bindVAO()}}};H._getRasterColorizerTechnique=function(Q){const W=Q.symbolizerParameters,V=["stretch","lut","hillshade"].indexOf(W.type);d.isNone(this._rasterColorizerConfig)&&(this._rasterColorizerConfig=
new E.RasterColorizerTechniqueConfiguration,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float"));this._rasterColorizerConfig.colorizerType=V;this._rasterColorizerConfig.applyColormap=!!W.colormap;this._rasterColorizerConfig.stretchType=Q.hasStretchTypeNone()?f.RasterColorizerStretchType.Noop:f.RasterColorizerStretchType.PerBand;return this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(E.RasterColorizerTechnique,this._rasterColorizerConfig,
this._rasterColorizerTechnique)};H._drawVectorData=function(Q,W,V,Y,aa,X,ba){const ha=this._rctx,ka=W.sourceLayerInfo.data,ia=W.tile.surface.layerViewByIndex(W.layerIndex,p.LayerClass.MAP);let ea;Q.bindPipelineState(ha);1>Y?(ea=this._fboPool.acquire(aa),ha.bindFramebuffer(ea),ha.setClearColor(1,1,1,0),ha.clearSafe(K.ClearBufferBit.COLOR_BUFFER_BIT|K.ClearBufferBit.DEPTH_BUFFER_BIT)):ba&&ha.clearSafe(K.ClearBufferBit.DEPTH_BUFFER_BIT);this._vectorTileHelper.render(ha,W.sourceLod,ka,ia.painter,ia.layer.styleRepository,
ia.schemaHelper,Math.round(1/W.scale),W.offset,this.tileSize,V);return d.isSome(ea)?(ha.bindFramebuffer(X),this._drawRasterData(Q,ea.colorTexture,1,[0,0],Y),this._fboPool.release(ea),ba):!0};H._dataToTexture=function(Q){C.isRasterTileRenderInfo(Q)&&this._rasterDataToTexture(Q);return C.isTextureTileRenderInfo(Q)};H._rasterDataToTexture=function(Q){const W=Q.sourceLayerInfo;W.data=this._buildTexture(W.data);Q.tile.setMemoryDirty()};H.setBackground=function(Q,W){d.releaseMaybe(this._backgroundTexture);
this._backgroundIsGrid=W;Q instanceof HTMLImageElement?(this._backgroundTexture=this._buildTexture(Q),this._backgroundColor=null):(this._backgroundTexture=new F(P.createColorTexture(this._rctx,l.fromValues(Q[0]||0,Q[1]||0,Q[2]||0,1))),this._backgroundColor=w.fromValues(Q[0]||0,Q[1]||0,Q[2]||0))};H._buildTexture=function(Q,W=K.TextureSamplingMode.LINEAR_MIPMAP_LINEAR){if(d.isNone(Q))return null;const V={target:K.TextureType.TEXTURE_2D,pixelFormat:K.PixelFormat.RGBA,dataType:K.PixelType.UNSIGNED_BYTE,
wrapMode:K.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:W,maxAnisotropy:this._maxAnisotropy,flipped:!0,hasMipmap:!0};W=this._rctx;let Y;if("number"===typeof Q)V.width=V.height=Q,Y=new F(new M.Texture(W,V));else if(Q instanceof k.ImageWithType)V.isOpaque=Q.isOpaque,Y=new F(new M.Texture(W,V,Q.image)),Q.release();else try{Y=new F(new M.Texture(W,V,Q))}catch(aa){Y=new F(P.createEmptyTexture(W)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}Q=W.bindTexture(Y.texture,
M.Texture.TEXTURE_UNIT_FOR_UPDATES);Y.generateMipmap();W.bindTexture(Q,M.Texture.TEXTURE_UNIT_FOR_UPDATES);return Y};H._cleanupFBOPool=function(Q,W){if(Q!==this._lastPixelRatio||W!==this._lastNumLayers)this._fboPool.clear(),this._lastPixelRatio=Q,this._lastNumLayers=W};b._createClass(S,[{key:"blendLayersTechnique",get:function(){if(d.isNone(this._blendLayersTechnique)){const Q=new r.BlendLayersTechniqueConfiguration;Q.mode=I.BlendMode.OneMinusSourceAlpha;this._blendLayersTechnique=this._techniqueRepository.acquire(r.BlendLayersTechnique,
Q)}return this._blendLayersTechnique}},{key:"applyOpacityTechnique",get:function(){if(d.isNone(this._applyOpacityTechnique)){const Q=new r.BlendLayersTechniqueConfiguration;Q.mode=I.BlendMode.SourceAlpha;this._applyOpacityTechnique=this._techniqueRepository.acquire(r.BlendLayersTechnique,Q)}return this._applyOpacityTechnique}},{key:"backgroundIsGrid",get:function(){return this._backgroundIsGrid}},{key:"backgroundColor",get:function(){return this._backgroundColor}},{key:"test",get:function(){return{backgroundTexture:this._backgroundTexture}}}]);
return S}();const L=[],N={tile:null,sourceLayerInfo:null,sourceLod:null,offset:[0,0],scale:1,layerIndex:0},T={offset:[0,0],scale:1};a.TileRenderer=h;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/imagery/enums":function(){define(["exports"],function(a){a.RasterColorizerType=void 0;(function(b){b[b.Stretch=0]="Stretch";b[b.Lut=1]="Lut";b[b.Hillshade=2]="Hillshade";b[b.COUNT=3]="COUNT"})(a.RasterColorizerType||(a.RasterColorizerType={}));a.RasterColorizerStretchType=void 0;
(function(b){b[b.Noop=0]="Noop";b[b.PerBand=1]="PerBand";b[b.COUNT=2]="COUNT"})(a.RasterColorizerStretchType||(a.RasterColorizerStretchType={}));Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/VectorTileRendererHelper3D":function(){define(["exports","../../../../geometry","../../../../Viewpoint","../../ViewState","../../../../geometry/Point"],function(a,b,c,d,g){b=function(){function x(){this._renderParams={context:null,drawPhase:1,state:new d({viewpoint:new c({targetGeometry:new g(0,
0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1}}var w=x.prototype;w.dispose=function(){this._renderParams=null};w.render=function(l,n,f,e,k,r,y,p,h,m){const u=
r.adjustLevel(n[0]),t=this._renderParams;t.context=l;t.painter=e;t.glyphMosaic=e.glyphMosaic;t.spriteMosaic=e.spriteMosaic;t.pixelRatio=m;t.displayLevel=u;t.requiredLevel=u;m=r.getScale(n[0]);const [q,z]=r.getShift(n,y*m);n=.125*y*m/h;r=f.transforms.dvs;r[0]=n;r[4]=-n;r[6]=-1-q-p[0]*y*2;r[7]=1+z+(1-p[1])*y*2-2;t.state.size[0]=h;t.state.size[1]=h;f.stage||f.attachWithContext(l);f.triangleCount=0;e.drawTile(t,f,k)};return x}();a.VectorTileRendererHelper3D=b;Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/2d/ViewState":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../Viewpoint ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../chunks/common ../../chunks/mat2d ../../chunks/mat2df32 ../../chunks/mat2df64 ../../chunks/mat3 ../../chunks/mat3f32 ../../chunks/vec2 ../../chunks/vec2f32 ../../chunks/vec2f64 ../../core/libs/gl-matrix-2/types/vec2 ./viewpointUtils ../../geometry/Extent ../../geometry/Point".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B){var A;const E=[0,0];c=A=function(C){function D(G){G=C.call(this,G)||this;G._viewpoint2D={center:t.create(),rotation:0,scale:0,spatialReference:null};G.center=[0,0];G.extent=new v;G.id=0;G.inverseTransform=y.create();G.resolution=0;G.rotation=0;G.scale=0;G.transform=y.create();G.transformNoRotation=y.create();G.displayMat3=h.create();G.displayViewMat3=h.create();G.viewMat3=h.create();G.viewMat2d=r.create();G.worldScreenWidth=0;G.size=[0,0];return G}
a._inheritsLoose(D,C);var F=D.prototype;F.copy=function(G){const J=this.size,I=this.viewpoint;I&&J?(this.viewpoint=z.copy(I,G.viewpoint),this._set("size",m.copy(J,G.size))):(this.viewpoint=G.viewpoint.clone(),this._set("size",[G.size[0],G.size[1]]));this._set("pixelRatio",G.pixelRatio);return this};F.clone=function(){return new A({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})};F.toMap=function(G,J,I){if(q.isVec2(J))return m.transformMat2d(G,J,this.inverseTransform);
E[0]=J;E[1]=I;return m.transformMat2d(G,E,this.inverseTransform)};F.toScreen=function(G,J,I){if(q.isVec2(J))return m.transformMat2d(G,J,this.transform);E[0]=J;E[1]=I;return m.transformMat2d(G,E,this.transform)};F.toScreenNoRotation=function(G,J,I){if(q.isVec2(J))return m.transformMat2d(G,J,this.transformNoRotation);E[0]=J;E[1]=I;return m.transformMat2d(G,E,this.transformNoRotation)};F.getScreenTransform=function(G,J){const {center:I}=this._viewpoint2D,O=this._get("pixelRatio")||1,P=this._get("size");
z.getMatrix(G,I,P,J,0,O);return G};F._update=function(){const {center:G,spatialReference:J,scale:I,rotation:O}=this._viewpoint2D,P=this._get("pixelRatio")||1,K=this._get("size"),M=new d({targetGeometry:new B(G[0],G[1],J),scale:I,rotation:O});this._set("viewpoint",M);if(K&&J&&I){this.resolution=z.getResolution(M);this.rotation=O;this.scale=I;this.spatialReference=J;m.copy(this.center,G);p.set(this.displayMat3,0!==K[0]?2/K[0]:0,0,0,0,0!==K[1]?-2/K[1]:0,0,-1,1,1);var U=p.identity(this.viewMat3),R=u.fromValues(K[0]/
2,K[1]/2),L=u.fromValues(-K[0]/2,-K[1]/2),N=e.toRadian(O);p.translate(U,U,R);p.rotate(U,U,N);p.translate(U,U,L);p.multiply(this.displayViewMat3,this.displayMat3,U);U=k.fromTranslation(this.viewMat2d,R);k.rotate(U,U,N);k.translate(U,U,L);z.getExtent(this.extent,M,K);z.getTransform(this.transform,M,K,P);k.invert(this.inverseTransform,this.transform);z.getTransformNoRotation(this.transformNoRotation,M,K,P);this.worldScreenWidth=z.getWorldScreenWidth(this.spatialReference,this.resolution);this._set("id",
this.id+1);return this}};a._createClass(D,[{key:"pixelRatio",set:function(G){this._set("pixelRatio",G);this._update()}},{key:"size",set:function(G){this._set("size",G);this._update()}},{key:"viewpoint",set:function(G){if(G){const J=this._viewpoint2D,I=G.targetGeometry;J.center[0]=I.x;J.center[1]=I.y;J.rotation=G.rotation;J.scale=G.scale;J.spatialReference=I.spatialReference}this._update()}}]);return D}(g.JSONSupport);b.__decorate([x.property({readOnly:!0})],c.prototype,"id",void 0);b.__decorate([x.property({value:1,
json:{write:!0}})],c.prototype,"pixelRatio",null);b.__decorate([x.property({json:{write:!0}})],c.prototype,"size",null);b.__decorate([x.property()],c.prototype,"spatialReference",void 0);b.__decorate([x.property({type:d,json:{write:!0}})],c.prototype,"viewpoint",null);return c=A=b.__decorate([f.subclass("esri.views.2d.ViewState")],c)})},"esri/chunks/mat2d":function(){define(["exports","./common"],function(a,b){function c(A,E){A[0]=E[0];A[1]=E[1];A[2]=E[2];A[3]=E[3];A[4]=E[4];A[5]=E[5];return A}function d(A){A[0]=
1;A[1]=0;A[2]=0;A[3]=1;A[4]=0;A[5]=0;return A}function g(A,E,C,D,F,G,J){A[0]=E;A[1]=C;A[2]=D;A[3]=F;A[4]=G;A[5]=J;return A}function x(A,E){const C=E[0],D=E[1],F=E[2],G=E[3],J=E[4];E=E[5];let I=C*G-D*F;if(!I)return null;I=1/I;A[0]=G*I;A[1]=-D*I;A[2]=-F*I;A[3]=C*I;A[4]=(F*E-G*J)*I;A[5]=(D*J-C*E)*I;return A}function w(A){return A[0]*A[3]-A[1]*A[2]}function l(A,E,C){const D=E[0],F=E[1],G=E[2],J=E[3],I=E[4];E=E[5];const O=C[0],P=C[1],K=C[2],M=C[3],U=C[4];C=C[5];A[0]=D*O+G*P;A[1]=F*O+J*P;A[2]=D*K+G*M;A[3]=
F*K+J*M;A[4]=D*U+G*C+I;A[5]=F*U+J*C+E;return A}function n(A,E,C){const D=E[0],F=E[1],G=E[2],J=E[3],I=E[4];E=E[5];const O=Math.sin(C);C=Math.cos(C);A[0]=D*C+G*O;A[1]=F*C+J*O;A[2]=D*-O+G*C;A[3]=F*-O+J*C;A[4]=I;A[5]=E;return A}function f(A,E,C){const D=E[1],F=E[2],G=E[3],J=E[4],I=E[5],O=C[0];C=C[1];A[0]=E[0]*O;A[1]=D*O;A[2]=F*C;A[3]=G*C;A[4]=J;A[5]=I;return A}function e(A,E,C){const D=E[0],F=E[1],G=E[2],J=E[3],I=E[4];E=E[5];const O=C[0];C=C[1];A[0]=D;A[1]=F;A[2]=G;A[3]=J;A[4]=D*O+G*C+I;A[5]=F*O+J*C+
E;return A}function k(A,E){const C=Math.sin(E);E=Math.cos(E);A[0]=E;A[1]=C;A[2]=-C;A[3]=E;A[4]=0;A[5]=0;return A}function r(A,E){A[0]=E[0];A[1]=0;A[2]=0;A[3]=E[1];A[4]=0;A[5]=0;return A}function y(A,E){A[0]=1;A[1]=0;A[2]=0;A[3]=1;A[4]=E[0];A[5]=E[1];return A}function p(A){return"mat2d("+A[0]+", "+A[1]+", "+A[2]+", "+A[3]+", "+A[4]+", "+A[5]+")"}function h(A){return Math.sqrt(A[0]**2+A[1]**2+A[2]**2+A[3]**2+A[4]**2+A[5]**2+1)}function m(A,E,C){A[0]=E[0]+C[0];A[1]=E[1]+C[1];A[2]=E[2]+C[2];A[3]=E[3]+
C[3];A[4]=E[4]+C[4];A[5]=E[5]+C[5];return A}function u(A,E,C){A[0]=E[0]-C[0];A[1]=E[1]-C[1];A[2]=E[2]-C[2];A[3]=E[3]-C[3];A[4]=E[4]-C[4];A[5]=E[5]-C[5];return A}function t(A,E,C){A[0]=E[0]*C;A[1]=E[1]*C;A[2]=E[2]*C;A[3]=E[3]*C;A[4]=E[4]*C;A[5]=E[5]*C;return A}function q(A,E,C,D){A[0]=E[0]+C[0]*D;A[1]=E[1]+C[1]*D;A[2]=E[2]+C[2]*D;A[3]=E[3]+C[3]*D;A[4]=E[4]+C[4]*D;A[5]=E[5]+C[5]*D;return A}function z(A,E){return A[0]===E[0]&&A[1]===E[1]&&A[2]===E[2]&&A[3]===E[3]&&A[4]===E[4]&&A[5]===E[5]}function v(A,
E){const C=A[0],D=A[1],F=A[2],G=A[3],J=A[4];A=A[5];const I=E[0],O=E[1],P=E[2],K=E[3],M=E[4];E=E[5];return Math.abs(C-I)<=b.EPSILON*Math.max(1,Math.abs(C),Math.abs(I))&&Math.abs(D-O)<=b.EPSILON*Math.max(1,Math.abs(D),Math.abs(O))&&Math.abs(F-P)<=b.EPSILON*Math.max(1,Math.abs(F),Math.abs(P))&&Math.abs(G-K)<=b.EPSILON*Math.max(1,Math.abs(G),Math.abs(K))&&Math.abs(J-M)<=b.EPSILON*Math.max(1,Math.abs(J),Math.abs(M))&&Math.abs(A-E)<=b.EPSILON*Math.max(1,Math.abs(A),Math.abs(E))}const B=Object.freeze({__proto__:null,
copy:c,identity:d,set:g,invert:x,determinant:w,multiply:l,rotate:n,scale:f,translate:e,fromRotation:k,fromScaling:r,fromTranslation:y,str:p,frob:h,add:m,subtract:u,multiplyScalar:t,multiplyScalarAndAdd:q,exactEquals:z,equals:v,mul:l,sub:u});a.add=m;a.copy=c;a.determinant=w;a.equals=v;a.exactEquals=z;a.frob=h;a.fromRotation=k;a.fromScaling=r;a.fromTranslation=y;a.identity=d;a.invert=x;a.mat2d=B;a.mul=l;a.multiply=l;a.multiplyScalar=t;a.multiplyScalarAndAdd=q;a.rotate=n;a.scale=f;a.set=g;a.str=p;a.sub=
u;a.subtract=u;a.translate=e})},"esri/chunks/mat2df32":function(){define(["exports"],function(a){function b(){const n=new Float32Array(6);n[0]=1;n[3]=1;return n}function c(n){const f=new Float32Array(6);f[0]=n[0];f[1]=n[1];f[2]=n[2];f[3]=n[3];f[4]=n[4];f[5]=n[5];return f}function d(n,f,e,k,r,y){const p=new Float32Array(6);p[0]=n;p[1]=f;p[2]=e;p[3]=k;p[4]=r;p[5]=y;return p}function g(n,f){return new Float32Array(n,f,6)}function x(n,f,e,k){const r=f[k];f=f[k+1];n[k]=e[0]*r+e[2]*f+e[4];n[k+1]=e[1]*r+
e[3]*f+e[5]}function w(n,f,e,k=0,r=0,y=2){for(r=r||f.length/y;k<r;k++)x(n,f,e,k*y)}const l=Object.freeze({__proto__:null,create:b,clone:c,fromValues:d,createView:g,transform:x,transformMany:w});a.clone=c;a.create=b;a.createView=g;a.fromValues=d;a.mat2df32=l;a.transform=x;a.transformMany=w})},"esri/chunks/mat2df64":function(){define(["exports"],function(a){function b(){return[1,0,0,1,0,0]}function c(w){return[w[0],w[1],w[2],w[3],w[4],w[5]]}function d(w,l,n,f,e,k){return[w,l,n,f,e,k]}function g(w,l){return new Float64Array(w,
l,6)}const x=Object.freeze({__proto__:null,create:b,clone:c,fromValues:d,createView:g});a.clone=c;a.create=b;a.createView=g;a.fromValues=d;a.mat2df64=x})},"esri/core/libs/gl-matrix-2/types/vec2":function(){define(["exports"],function(a){function b(d){return d instanceof Float32Array&&2<=d.length}function c(d){return Array.isArray(d)&&2<=d.length}a.isVec2=function(d){return b(d)||c(d)};a.isVec2f32=b;a.isVec2f64=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/viewpointUtils":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../Viewpoint ../../core/Collection ../../core/maybe ../../core/unitUtils ../../chunks/common ../../chunks/mat2d ../../chunks/mat2df64 ../../chunks/vec2 ../../chunks/vec2f64 ../../geometry/Extent ../../geometry/Geometry ../../geometry/Point ../../geometry/projection ../../geometry/SpatialReference ../../geometry/support/spatialReferenceUtils".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m){function u(X,ba){return ba.type?f.set(X,ba.x,ba.y):f.copy(X,ba)}function t(X,ba){return Math.max(X.width/ba[0],X.height/ba[1])*G(X.spatialReference)}function q(X,ba,ha,ka){return z.apply(this,arguments)}function z(){z=b._asyncToGenerator(function*(X,ba,ha,ka){if(!X||Array.isArray(X)&&!X.length)return null;d.isCollection(X)&&(X=X.toArray());if(Array.isArray(X)&&X.length&&"object"===typeof X[0]){var ia=X.every(la=>"attributes"in la);var ea=X.some(la=>!la.geometry),
ca=X;if(ia&&ea&&ba&&ba.allLayerViews){ia=new Map;for(var Z of X)X=Z.layer,ea=ia.get(X)||[],ca=Z.attributes[X.objectIdField],null!=ca&&ea.push(ca),ia.set(X,ea);const la=[];ia.forEach((ma,ra)=>{const va=ba.allLayerViews.find(ya=>ya.layer.id===ra.id);if("queryFeatures"in va){const ya=ra.createQuery();ya.objectIds=ma;ya.returnGeometry=!0;la.push(va.queryFeatures(ya))}});Z=yield Promise.all(la);X=[];for(var fa of Z)if(fa&&fa.features&&fa.features.length)for(var ja of fa.features)g.isSome(ja.geometry)&&
X.push(ja.geometry);ca=X}for(const la of ca)ka=yield q(la,ba,ha,ka);return ka}if(Array.isArray(X)&&2===X.length&&"number"===typeof X[0]&&"number"===typeof X[1])ia=new y(X);else if(X instanceof r)ia=X;else if("geometry"in X)if(X.geometry)ia=X.geometry;else if(X.layer){const la=X.layer;fa=ba.allLayerViews.find(ma=>ma.layer.id===la.id);"queryFeatures"in fa&&(ja=la.createQuery(),ja.objectIds=[X.attributes[la.objectIdField]],ja.returnGeometry=!0,fa=yield fa.queryFeatures(ja),ia=g.get(fa,"features",0,"geometry"))}if(g.isNone(ia))return null;
fa="point"===ia.type?new k({xmin:ia.x,ymin:ia.y,xmax:ia.x,ymax:ia.y,spatialReference:ia.spatialReference}):ia.extent;if(!fa)return null;p.isLoaded()||p.canProjectWithoutEngine(fa.spatialReference,ha)||(yield p.load());ha=p.project(fa,ha);return ha?ka=ka?ka.union(ha):ha:null});return z.apply(this,arguments)}function v(X){if(X&&(!Array.isArray(X)||"number"!==typeof X[0])&&("object"===typeof X||Array.isArray(X)&&"object"===typeof X[0])){if("layer"in X&&X.layer&&X.layer.minScale&&X.layer.maxScale){var ba=
X.layer;return{min:ba.minScale,max:ba.maxScale}}if(Array.isArray(X)&&X.length&&X.every(ha=>"layer"in ha)){let ha=ba=0;for(const ka of X)(X=ka.layer)&&X.minScale&&X.maxScale&&(ba=X.minScale<ba?X.minScale:ba,ha=X.maxScale>ha?X.maxScale:ha);return ba&&ha?{min:ba,max:ha}:null}}}function B(X,ba){return m.equals(X.wkid?X:X.spatialReference||h.WGS84,ba)?X:p.project(X,ba)}function A(){A=b._asyncToGenerator(function*(X,ba){if(!X||!ba)return new c({targetGeometry:new y,scale:0,rotation:0});let ha=ba.spatialReference;
const {constraints:ka,padding:ia,viewpoint:ea,size:ca}=ba,Z=[ia?ca[0]-ia.left-ia.right:ca[0],ia?ca[1]-ia.top-ia.bottom:ca[1]];let fa=null;X instanceof c?fa=X:X.viewpoint?fa=X.viewpoint:X.target&&"esri.Viewpoint"===X.target.declaredClass&&(fa=X.target);let ja=null;if(fa&&fa.targetGeometry)ja=fa.targetGeometry;else if(X instanceof k)ja=X;else if(X||X&&("center"in X||"extent"in X||"target"in X))ja=(yield q(X.center,ba,ha))||(yield q(X.extent,ba,ha))||(yield q(X.target,ba,ha))||(yield q(X,ba,ha));!ja&&
ea&&ea.targetGeometry?ja=ea.targetGeometry:!ja&&ba.extent&&(ja=ba.extent);if(!ha){var la=ba.spatialReference||ba.extent||ja;ha=la.wkid?la:la.spatialReference||h.WGS84}p.isLoaded()||m.equals(ja.spatialReference,ha)||p.canProjectWithoutEngine(ja,ha)||(yield p.load());la=B(ja.center?ja.center:ja,ha);var ma=null;fa&&g.isSome(fa.targetGeometry)&&"point"===fa.targetGeometry.type?ma=fa.scale:"scale"in X&&X.scale?ma=X.scale:"zoom"in X&&-1!==X.zoom&&ka&&ka.effectiveLODs?ma=ka.zoomToScale(X.zoom):Array.isArray(ja)||
"point"===ja.type||"extent"===ja.type&&0===ja.width&&0===ja.height?(ma=B(ba.extent,ha),ma=g.isSome(ma)?t(ma,Z):ba.extent?t(ba.extent,Z):ea.scale):ma=t(B(ja.extent,ha),Z);if(ba=v(X))ba.min&&ba.min>ma?ma=ba.min:ba.max&&ba.max<ma&&(ma=ba.max);ba=0;fa?ba=fa.rotation:X.hasOwnProperty("rotation")?ba=X.rotation:ea&&(ba=ea.rotation);X=new c({targetGeometry:la,scale:ma,rotation:ba});ka&&(X=ka.fit(X),ka.constrainByGeometry(X),ka.rotationEnabled||(X.rotation=ba));return X});return A.apply(this,arguments)}function E(X,
ba){const ha=X.targetGeometry,ka=ba.targetGeometry;ha.x=ka.x;ha.y=ka.y;ha.spatialReference=ka.spatialReference;X.scale=ba.scale;X.rotation=ba.rotation;return X}function C(X,ba,ha){return ha?f.set(X,.5*(ba[0]-ha.right+ha.left),.5*(ba[1]-ha.bottom+ha.top)):f.scale(X,ba,.5)}function D(X,ba,ha,ka){U(X,ba,ha,ka);return l.invert(X,X)}function F(X){var ba=X.scale;X=X.targetGeometry;X=g.isSome(X)&&m.isValid(X.spatialReference)?1/(39.37*x.getMetersPerUnitForSR(X.spatialReference)*96):1;return ba*X}function G(X){return m.isValid(X)?
39.37*x.getMetersPerUnitForSR(X)*96:1}function J(X){return X.isWrappable?(X=m.getInfo(X),X.valid[1]-X.valid[0]):0}const I=180/Math.PI,O=function(){const X=e.create();return function(ba,ha,ka){const ia=ha.targetGeometry;u(X,ia);ha=.5*F(ha);ba.xmin=X[0]-ha*ka[0];ba.ymin=X[1]-ha*ka[1];ba.xmax=X[0]+ha*ka[0];ba.ymax=X[1]+ha*ka[1];ba.spatialReference=ia.spatialReference;return ba}}(),P=function(){const X=e.create();return function(ba,ha,ka){return f.sub(ba,f.scale(ba,ha,.5),C(X,ha,ka))}}(),K=function(){const X=
n.create(),ba=e.create();return function(ha,ka,ia,ea){const ca=F(ka);ka=w.toRadian(ka.rotation)||0;f.set(ba,ca,ca);l.fromScaling(X,ba);l.rotate(X,X,ka);l.translate(X,X,P(ba,ia,ea));l.translate(X,X,[0,ea.top-ea.bottom]);return f.set(ha,X[4],X[5])}}(),M=function(){const X=e.create(),ba=e.create(),ha=e.create();return function(ka,ia,ea,ca,Z,fa){f.negate(X,ia);f.scale(ba,ea,.5*fa);f.set(ha,1/ca*fa,-1/ca*fa);l.fromTranslation(ka,ba);Z&&l.rotate(ka,ka,Z);l.scale(ka,ka,ha);l.translate(ka,ka,X);return ka}}(),
U=function(){const X=e.create();return function(ba,ha,ka,ia){const ea=F(ha),ca=w.toRadian(ha.rotation)||0;u(X,ha.targetGeometry);return M(ba,X,ka,ea,ca,ia)}}(),R=function(){const X=e.create();return function(ba,ha,ka,ia){const ea=F(ha);u(X,ha.targetGeometry);return M(ba,X,ka,ea,0,ia)}}(),L=function(){const X=e.create(),ba=e.create(),ha=[0,0,0];return function(ka,ia,ea){f.subtract(X,ka,ia);f.normalize(X,X);f.subtract(ba,ka,ea);f.normalize(ba,ba);f.cross(ha,X,ba);ka=Math.acos(f.dot(X,ba)/(f.length(X)*
f.length(ba)))*I;0>ha[2]&&(ka=-ka);isNaN(ka)&&(ka=0);return ka}}(),N=function(){const X=e.create();return function(ba,ha,ka,ia){const ea=ba.targetGeometry;E(ba,ha);K(X,ha,ka,ia);ea.x+=X[0];ea.y+=X[1];return ba}}(),T=function(){return function(X,ba,ha){E(X,ba);ba=X.targetGeometry;ba.x=ha.x;ba.y=ha.y;ba.spatialReference=ha.spatialReference;return X}}(),S=function(){const X=e.create();return function(ba,ha,ka,ia,ea){ea||(ea="center");f.sub(X,ka,ia);f.scale(X,X,.5);ka=X[0];ia=X[1];switch(ea){case "center":f.set(X,
0,0);break;case "left":f.set(X,-ka,0);break;case "top":f.set(X,0,ia);break;case "right":f.set(X,ka,0);break;case "bottom":f.set(X,0,-ia);break;case "top-left":f.set(X,-ka,ia);break;case "bottom-left":f.set(X,-ka,-ia);break;case "top-right":f.set(X,ka,ia);break;case "bottom-right":f.set(X,ka,-ia)}aa(ba,ha,X);return ba}}(),H=function(){const X=e.create();return function(ba,ha,ka,ia,ea){E(ba,ha);isNaN(ka)||0===ka||(V(X,ia,ha,ea),ba.scale=ha.scale*ka,Y(X,X,ba,ea),aa(ba,ba,f.set(X,X[0]-ia[0],ia[1]-X[1])));
return ba}}(),Q=function(){const X=e.create();return function(ba,ha,ka,ia,ea,ca){E(ba,ha);isNaN(ka)||0===ka||(V(X,ea,ha,ca),ba.scale=ha.scale*ka,ba.rotation+=ia,Y(X,X,ba,ca),aa(ba,ba,f.set(X,X[0]-ea[0],ea[1]-X[1])));return ba}}(),W=function(){const X=e.create(),ba=e.create();return function(ha,ka,ia,ea,ca,Z,fa){P(ba,Z,fa);f.add(X,ca,ba);return ea?Q(ha,ka,ia,ea,X,Z):H(ha,ka,ia,X,Z)}}(),V=function(){const X=n.create();return function(ba,ha,ka,ia){return f.transformMat2d(ba,ha,D(X,ka,ia,1))}}(),Y=function(){const X=
n.create();return function(ba,ha,ka,ia){return f.transformMat2d(ba,ha,U(X,ka,ia,1))}}(),aa=function(){const X=e.create(),ba=n.create();return function(ha,ka,ia){E(ha,ka);const ea=F(ka),ca=ha.targetGeometry;l.fromRotation(ba,w.toRadian(ka.rotation)||0);l.scale(ba,ba,e.fromValues(ea,ea));f.transformMat2d(X,ia,ba);ca.x+=X[0];ca.y+=X[1];return ha}}();a.addPadding=N;a.angleBetween=L;a.centerAt=T;a.copy=E;a.create=function(X,ba){return A.apply(this,arguments)};a.extentToScale=t;a.getAnchor=C;a.getExtent=
O;a.getMatrix=M;a.getPaddingMapTranslation=K;a.getPaddingScreenTranslation=P;a.getResolution=F;a.getResolutionToScaleFactor=G;a.getTransform=U;a.getTransformNoRotation=R;a.getWorldScreenWidth=function(X,ba){return Math.round(J(X)/ba)};a.getWorldWidth=J;a.padAndScaleAndRotateBy=W;a.resize=S;a.rotateBy=function(X,ba,ha){E(X,ba);X.rotation+=ha;return X};a.rotateTo=function(X,ba,ha){E(X,ba);X.rotation=ha;return X};a.scaleAndRotateBy=Q;a.scaleTo=function(X,ba,ha){E(X,ba);X.scale=ha;return X};a.setExtent=
function(X,ba,ha,ka,ia){T(X,ba,ha.center);X.scale=t(ha,ka);ia&&ia.constraints&&ia.constraints.constrain(X);return X};a.toMap=V;a.toScreen=Y;a.translateBy=aa;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/BlendLayersTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../webgl-engine/core/shaderLibrary/output/BlendOptions ../../../chunks/BlendLayers.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r){l=function(y){function p(){return y.apply(this,arguments)||this}c._inheritsLoose(p,y);var h=p.prototype;h.initializeProgram=function(m){const u=p.shader.get().build();return new e.Program(m.rctx,u,f.Default3D)};h.initializePipeline=function(){const m=this.configuration.mode===g.BlendMode.OneMinusSourceAlpha?r.simpleBlendingParams(k.BlendFactor.ONE,k.BlendFactor.ONE_MINUS_SRC_ALPHA):this.configuration.mode===g.BlendMode.SourceAlpha?r.simpleBlendingParams(k.BlendFactor.ZERO,
k.BlendFactor.SRC_ALPHA):null;return r.makePipelineState({blending:m,colorWrite:r.defaultColorWriteParams})};return p}(l.ShaderTechnique);l.shader=new w.ReloadableShaderModule(x.BlendLayersShader,()=>new Promise((y,p)=>a(["../webgl-engine/core/shaderLibrary/util/BlendLayers.glsl"],y,p)));x=function(y){function p(){var h=y.apply(this,arguments)||this;h.mode=g.BlendMode.NoAlpha;return h}c._inheritsLoose(p,y);return p}(n.ShaderTechniqueConfiguration);d.__decorate([n.parameter({count:g.BlendMode.COUNT})],
x.prototype,"mode",void 0);b.BlendLayersTechnique=l;b.BlendLayersTechniqueConfiguration=x;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/BlendOptions":function(){define(["exports"],function(a){a.BlendMode=void 0;var b=a.BlendMode||(a.BlendMode={});b[b.NoAlpha=0]="NoAlpha";b[b.SourceAlpha=1]="SourceAlpha";b[b.OneMinusSourceAlpha=2]="OneMinusSourceAlpha";b[b.COUNT=3]="COUNT";Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/BlendLayers.glsl":function(){define(["exports",
"../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/lib/VertexAttribute"],function(a,b,c,d){function g(){const w=new c.ShaderBuilder;w.attributes.add(d.VertexAttribute.POSITION,"vec2");w.attributes.add(d.VertexAttribute.UV0,"vec2");w.vertex.uniforms.add("scale","float");w.vertex.uniforms.add("offset","vec2");w.varyings.add("uv","vec2");w.vertex.code.add(b.glsl`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
}`);w.fragment.uniforms.add("tex","sampler2D");w.fragment.uniforms.add("opacity","float");w.fragment.code.add(b.glsl`void main() {
vec4 color = texture2D(tex, uv);
gl_FragColor = vec4(color.xyz, 1.0) * color.a * opacity;
}`);return w}const x=Object.freeze({__proto__:null,build:g});a.BlendLayersShader=x;a.build=g})},"esri/views/3d/terrain/RasterColorizerTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/maybe ../../2d/engine/imagery/enums ../webgl-engine/core/shaderLibrary/output/BlendOptions ../../../chunks/RasterColorizer.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/rasterUtils ../../webgl/renderState".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h){f=function(m){function u(){return m.apply(this,arguments)||this}c._inheritsLoose(u,m);var t=u.prototype;t.initializeProgram=function(q){var z=u.shader.get();const v=this.configuration;z=z.build({output:v.colorizerType,applyColormap:v.applyColormap,stretchType:v.stretchType});this._context=q.rctx;return new r.Program(q.rctx,z,k.Default3D)};t.initializePipeline=function(){const q=this.configuration.mode===w.BlendMode.OneMinusSourceAlpha?h.simpleBlendingParams(y.BlendFactor.ONE,
y.BlendFactor.ONE_MINUS_SRC_ALPHA):this.configuration.mode===w.BlendMode.SourceAlpha?h.simpleBlendingParams(y.BlendFactor.ZERO,y.BlendFactor.SRC_ALPHA):null;return h.makePipelineState({blending:q,colorWrite:h.defaultColorWriteParams})};t.bindPass=function(q){p.setUniforms(this.program,this.uniformLocationInfos,q.basic);p.setUniforms(this.program,this.uniformLocationInfos,q.common);g.isSome(q.colormap)&&p.setUniforms(this.program,this.uniformLocationInfos,q.colormap);this.configuration.colorizerType===
x.RasterColorizerType.Stretch&&g.isSome(q.stretch)?p.setUniforms(this.program,this.uniformLocationInfos,q.stretch):this.configuration.colorizerType===x.RasterColorizerType.Hillshade&&g.isSome(q.hillshade)&&p.setUniforms(this.program,this.uniformLocationInfos,q.hillshade)};c._createClass(u,[{key:"uniformLocationInfos",get:function(){this._uniformLocationInfos||(this._uniformLocationInfos=p.getUniformLocationInfos(this._context,this.program));return this._uniformLocationInfos}}]);return u}(f.ShaderTechnique);
f.shader=new n.ReloadableShaderModule(l.RasterColorizerShader,()=>new Promise((m,u)=>a(["../webgl-engine/core/shaderLibrary/raster/RasterColorizer.glsl"],m,u)));l=function(m){function u(){var t=m.apply(this,arguments)||this;t.mode=w.BlendMode.OneMinusSourceAlpha;t.colorizerType=x.RasterColorizerType.Stretch;t.stretchType=x.RasterColorizerStretchType.Noop;t.applyColormap=!0;return t}c._inheritsLoose(u,m);return u}(e.ShaderTechniqueConfiguration);d.__decorate([e.parameter({count:w.BlendMode.COUNT})],
l.prototype,"mode",void 0);d.__decorate([e.parameter({count:x.RasterColorizerType.COUNT})],l.prototype,"colorizerType",void 0);d.__decorate([e.parameter({count:x.RasterColorizerStretchType.COUNT})],l.prototype,"stretchType",void 0);d.__decorate([e.parameter()],l.prototype,"applyColormap",void 0);b.RasterColorizerTechnique=f;b.RasterColorizerTechniqueConfiguration=l;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/RasterColorizer.glsl":function(){define("exports ../views/2d/engine/imagery/enums ../views/3d/webgl-engine/core/shaderLibrary/raster/BasicGrid.glsl ../views/3d/webgl-engine/core/shaderLibrary/raster/Colormap.glsl ../views/3d/webgl-engine/core/shaderLibrary/raster/Common.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,b,c,d,g,x,w,l){function n(e){const k=new l.ShaderBuilder;k.include(c.BasicGrid);k.include(g.Common);k.include(d.Colormap);if(e.output===b.RasterColorizerType.Stretch){{k.fragment.uniforms.add("u_bandCount","int");k.fragment.uniforms.add("u_minCutOff","float",3);k.fragment.uniforms.add("u_maxCutOff","float",3);k.fragment.uniforms.add("u_factor","float",3);k.fragment.uniforms.add("u_minOutput","float");k.fragment.uniforms.add("u_maxOutput","float");k.fragment.uniforms.add("u_useGamma","bool");
k.fragment.uniforms.add("u_gamma","float",3);k.fragment.uniforms.add("u_gammaCorrection","float",3);k.fragment.code.add(w.glsl`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const r=e.applyColormap?w.glsl`gl_FragColor = colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma);`:w.glsl`gl_FragColor = vec4(grayVal, grayVal, grayVal, 1.0) * currentPixel.a * u_opacity;`;k.fragment.code.add(w.glsl`
      void main() {
        vec2 pixelLocation = getPixelLocation(v_texcoord);
        if (isOutside(pixelLocation)) {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${e.stretchType===b.RasterColorizerStretchType.Noop?w.glsl`
        gl_FragColor = vec4(currentPixel.rgb, 1.0) * currentPixel.a * u_opacity;`:w.glsl`
        if (currentPixel.a == 0.0) {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${r}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          gl_FragColor = vec4(redVal, greenVal, blueVal, 1.0) * currentPixel.a * u_opacity;
        }`}
      }`)}}else e.output===b.RasterColorizerType.Lut?k.fragment.code.add(w.glsl`void main() {
vec2 pixelLocation = getPixelLocation(v_texcoord);
if (isOutside(pixelLocation)) {
gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
return;
}
vec4 currentPixel = getPixel(pixelLocation);
gl_FragColor = colormap(currentPixel, true);
}`):e.output===b.RasterColorizerType.Hillshade&&(k.fragment.uniforms.add("u_hillshadeType","int"),k.fragment.uniforms.add("u_sinZcosAs","float",6),k.fragment.uniforms.add("u_sinZsinAs","float",6),k.fragment.uniforms.add("u_cosZs","float",6),k.fragment.uniforms.add("u_weights","float",6),k.fragment.uniforms.add("u_factor","vec2"),k.fragment.uniforms.add("u_applyColormap","bool"),k.fragment.uniforms.add("u_minValue","float"),k.fragment.uniforms.add("u_maxValue","float"),k.fragment.uniforms.add("u_srcImageSize",
"vec2"),k.fragment.include(x.ColorConversion),k.fragment.code.add(w.glsl`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 rgb = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(rgb.xyz);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv) * alpha, alpha);
}`),k.fragment.code.add(w.glsl`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`),e=e.applyColormap?w.glsl`gl_FragColor = overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha);`:w.glsl`hillshade *= alpha;
gl_FragColor = vec4(hillshade, hillshade, hillshade, alpha);`,k.fragment.code.add(w.glsl`
    void main() {
      vec2 pixelLocation = getPixelLocation(v_texcoord);
      if (isOutside(pixelLocation)) {
        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture2D(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture2D(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture2D(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture2D(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture2D(u_image, pixelLocation);
      vec4 vf = texture2D(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture2D(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture2D(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture2D(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${e}
    }
  `));return k}const f=Object.freeze({__proto__:null,build:n});a.RasterColorizerShader=f;a.build=n})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/BasicGrid.glsl":function(){define(["exports","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,c){a.BasicGrid=function(d){d.attributes.add(c.VertexAttribute.POSITION,"vec2");d.attributes.add(c.VertexAttribute.UV0,"vec2");d.vertex.uniforms.add("u_scale","float");d.vertex.uniforms.add("u_offset","vec2");d.varyings.add("v_texcoord",
"vec2");d.vertex.code.add(b.glsl`void main(void) {
v_texcoord = uv0 * u_scale + u_offset;
gl_Position = vec4(position, 0.0, 1.0);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Colormap.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.Colormap=function(c){c.fragment.uniforms.add("u_colormap","sampler2D");c.fragment.uniforms.add("u_colormapOffset","float");c.fragment.uniforms.add("u_colormapMaxIndex","float");c.fragment.code.add(b.glsl`vec4 colormap(vec4 currentPixel, bool isFloat) {
float clrIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || clrIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 clrPosition = vec2((clrIndex + 0.5) / (u_colormapMaxIndex + 1.0), 0.0);
vec4 color = texture2D(u_colormap, clrPosition);
result = vec4(color.rgb, 1.0) * color.a * u_opacity;
}
return result;
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Common.glsl":function(){define(["exports","./Projection.glsl","../../shaderModules/interfaces"],function(a,b,c){a.Common=function(d){d.include(b.Projection);d.fragment.uniforms.add("u_image","sampler2D");d.fragment.uniforms.add("u_isFloatTexture","bool");d.fragment.uniforms.add("u_flipY","bool");d.fragment.uniforms.add("u_applyTransform","bool");d.fragment.uniforms.add("u_opacity","float");
d.fragment.code.add(c.glsl`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}
vec4 getPixel(vec2 pixelLocation) {
return texture2D(u_image, pixelLocation);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Projection.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.Projection=function(c){c.fragment.uniforms.add("u_transformGrid","sampler2D");c.fragment.uniforms.add("u_transformSpacing","vec2");c.fragment.uniforms.add("u_transformGridSize","vec2");c.fragment.uniforms.add("u_targetImageSize","vec2");c.fragment.code.add(b.glsl`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);
vec2 index_transform = floor(index_image / u_transformSpacing) / u_transformGridSize;
vec2 pos = fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);
vec2 srcLocation;
vec2 transform_location = index_transform + oneTransformPixel * 0.5;
if (pos.s <= pos.t) {
vec4 ll_abc = texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));
vec4 ll_def = texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));
srcLocation.s = dot(ll_abc.rgb, vec3(pos, 1.0));
srcLocation.t = dot(ll_def.rgb, vec3(pos, 1.0));
} else {
vec4 ur_abc = texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));
vec4 ur_def = texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));
srcLocation.s = dot(ur_abc.rgb, vec3(pos, 1.0));
srcLocation.t = dot(ur_def.rgb, vec3(pos, 1.0));
}
return srcLocation;;
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/TextureReference":function(){define(["exports","../../../chunks/vec3f64","../../../chunks/vec4f64"],function(a,b,c){let d=function(){function g(x,w,l,n,f,e,k){this.texture=x;this.type=w;x.retain();this.offsetAndScale=c.fromValues(l.offset[0],l.offset[1],l.scale,l.scale);this.opacities=b.fromValues(n,k?e:0,f)}g.prototype.destroy=function(){this.texture.release()};return g}();a.TextureReference=d;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/terrain/support/FBOPool":function(){define(["exports","../../../../core/ObjectPool","../../../webgl/enums","../../../webgl/FramebufferObject"],function(a,b,c,d){let g=function(){function x(l){this._rctx=l;this._pools=new Map}var w=x.prototype;w.acquire=function(l){return this._getPool(l).acquire()};w.release=function(l){this._getPool(l.width).release(l)};w.clear=function(){this._pools.forEach(l=>l.destroy());this._pools.clear()};w._getPool=function(l){var n=
this._pools.get(l);n||(n=d.FramebufferObject.bind(d.FramebufferObject,this._rctx,{colorTarget:c.TargetType.TEXTURE,depthStencilTarget:c.DepthStencilTargetType.DEPTH_RENDER_BUFFER,width:l,height:l}),n=new b(n),this._pools.set(l,n));return n};return x}();a.FBOPool=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/ComponentIntersectionData":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/vec3f64",
"../../../../../geometry/support/aaBoundingBox","../../materials/internal/MaterialUtil"],function(a,b,c,d,g){function x(m,u,t){let q=0,z=Infinity;for(let B=0;3>B;++B){var v=m[B];if(u[B]<v){if(1E-6>=t[B])return!1;q=Math.max(q,(v-u[B])/t[B])}else-1E-6>=t[B]&&(z=Math.min(z,(v-u[B])/t[B]));if(q>z)return!1;v=m[B+3];if(u[B]>v){if(-1E-6<=t[B])return!1;q=Math.max(q,(v-u[B])/t[B])}else 1E-6<=t[B]&&(z=Math.min(z,(v-u[B])/t[B]));if(q>z)return!1}return!0}function w(m,u,t,q,z,v){let B=q;for(;t<B;){var A=m[t];
u[6*A+z+3]<=v?++t:(--B,m[t]=m[B],m[B]=A)}A=t;for(B=q;A<B;)q=m[B-1],u[6*q+z]>=v?--B:(m[B-1]=m[A],m[A]=q,++A);return{next:t,mid:A}}function l(m,u,t,q){if(q<=t)return d.fromValues(NaN,NaN,NaN,NaN,NaN,NaN);var z=6*m[t];for(var v=0;3>v;++v)p[v]=u[z+0+v],h[v]=u[z+3+v];for(t+=1;t<q;++t)for(z=6*m[t],v=0;3>v;++v)p[v]=Math.min(p[v],u[z+0+v]),h[v]=Math.max(h[v],u[z+3+v]);return d.fromValues(p[0],p[1],p[2],h[0],h[1],h[2])}function n(m){var u=m[3]-m[0];const t=m[4]-m[1],q=m[5]-m[2];u=u>t?u>q?0:t>q?1:2:t>q?1:q>
u?2:0;return{axis:u,midValue:(m[u]+m[u+3])/2}}function f(m,u,t,q,z){t-=u;const v=new Float32Array(6*t);for(let A=0;A<t;++A){var B=3*(A+u);const E=m[B+0]*z,C=m[B+1]*z;B=m[B+2]*z;for(let D=0;3>D;++D){const F=q[E+D],G=q[C+D],J=q[B+D];v[6*A+D]=Math.min(F,G,J);v[6*A+3+D]=Math.max(F,G,J)}}return v}function e(m,u,t,q){const z=q-t;var v=0;for(var B=t;B<q;++B)for(var A=0;3>A;++A)v=Math.max(u[3*B+A],v);q=65535>=v?new Uint16Array(3*z):new Uint32Array(3*z);for(v=0;v<z;++v)for(B=3*(m[v]+t),A=0;3>A;++A)q[3*v+A]=
u[B+A];return q}let k=function(m,u,t,q,z){this.aabb=m;this.axis=u;this.d=t;this.midStartIndex=q;this.rightStartIndex=z},r=function(){function m(t,q,z,v){this.globalTriangleVertexIndices=t;this.firstTriangleIndex=q;this.positionAttribute=v;this.rayDirection=c.create();this.bspNodeTree=[];this.vertexPositionBuffer=v.data;this.vertexPositionStride=v.stride;const B=z-q,A=65535>=B?new Uint16Array(B):new Uint32Array(B);this.indices=A;for(let E=0;E<B;++E)A[E]=E;{const E=f(t,q,z,v.data,v.stride),C=(D,F,G)=>
{var J=l(A,E,D,F);const I=F-D;if(20>=I)return D=new k(J,void 0,0,D,F),this.bspNodeTree.push(D),D;const {axis:O,midValue:P}=n(J),K=w(A,E,D,F,O,P),M=(U,R)=>{if(!(15<G)){var L=R-U;if(!(20>L||L>=.8*I))return C(U,R,G+1)}};J=new k(J,O,P,K.next,K.mid);this.bspNodeTree.push(J);J.leftNode=M(D,K.next);J.rightNode=M(K.mid,F);return J};C(0,B,0);this.triangleVertexIndices=e(A,t,q,z)}}var u=m.prototype;u.intersectRayTriangleRange=function(t,q){{if(t>=q)return;const K=this.triangleVertexIndices,M=this.positionAttribute.data,
U=this.positionAttribute.stride;var z=this.rayOrigin;const R=z[0],L=z[1];z=z[2];var v=this.rayDirection;const N=v[0],T=v[1];v=v[2];for(let S=t,H=3*t;S<q;++S){var B=K[H]*U,A=M[B],E=M[B+1],C=M[B+2],D=K[H+1]*U;B=M[D];var F=M[D+1];D=M[D+2];var G=K[H+2]*U,J=M[G],I=M[G+1];G=M[G+2];H+=3;B-=A;F-=E;D-=C;J-=A;I-=E;G-=C;var O=T*G-I*v,P=v*J-G*N;const Q=N*I-J*T,W=B*O+F*P+D*Q;if(!(Math.abs(W)<=Number.EPSILON)){A=R-A;E=L-E;C=z-C;O=A*O+E*P+C*Q;if(0<W){if(0>O||O>W)continue}else if(0<O||O<W)continue;P=E*D-F*C;C=C*
B-D*A;E=A*F-B*E;A=N*P+T*C+v*E;if(0<W){if(0>A||O+A>W)continue}else if(0<A||O+A<W)continue;E=(J*P+I*C+G*E)/W;0<=E&&(C=this.indices[S]+this.firstTriangleIndex,B=g.computeNormal(B,F,D,J,I,G,y),this.callback(E,B,C,!1))}}}m.numFacesTested+=q-t};u.intersectRay=function(t,q){m.numFacesTested=0;var z=c.fromValues(t.r0[0],t.r0[1],t.r0[2]),v=c.fromValues(t.r1[0],t.r1[1],t.r1[2]);t=v[0]-z[0];const B=v[1]-z[1];v=v[2]-z[2];1E-6>t*t+B*B+v*v||(this.rayOrigin=z,z=this.rayDirection,z[0]=t,z[1]=B,z[2]=v,z=this.triangleVertexIndices.length/
3,this.callback=q,this.intersectRayBSP(this.bspNodeTree[0],0,z))};u.intersectRayBSP=function(t,q,z){const v=this.rayOrigin,B=this.rayDirection;if(x(t.aabb,v,B)){var A=t.axis,E=t.d;if(v[A]<E||0>B[A]){const C=t.midStartIndex;if(q<C){const D=t.leftNode;void 0!==D?this.intersectRayBSP(D,q,C):this.intersectRayTriangleRange(q,C)}}this.intersectRayTriangleRange(t.midStartIndex,t.rightStartIndex);if(v[A]>E||0<B[A])q=t.rightStartIndex,q<z&&(t=t.rightNode,void 0!==t?this.intersectRayBSP(t,q,z):this.intersectRayTriangleRange(q,
z))}};b._createClass(m,[{key:"estimatedMemoryUsage",get:function(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}}]);return m}();r.numFacesTested=0;const y=c.create(),p=[Infinity,Infinity,Infinity],h=[-Infinity,-Infinity,-Infinity];a.ComponentIntersectionData=r;a.componentMinimalSizeForIntersectionData=40;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl":function(){define(["exports","../shading/EvaluateMainLighting.glsl",
"../shading/PhysicallyBasedRenderingParameters.glsl","../shading/Water.glsl","../../shaderModules/interfaces"],function(a,b,c,d,g){a.OverlayMode=void 0;(function(x){x[x.Disabled=0]="Disabled";x[x.Enabled=1]="Enabled";x[x.EnabledWithWater=2]="EnabledWithWater";x[x.COUNT=3]="COUNT"})(a.OverlayMode||(a.OverlayMode={}));a.Overlay=function(x,w){x.extensions.add("GL_OES_standard_derivatives");w.pbrMode!==c.PBRMode.Water&&w.pbrMode!==c.PBRMode.WaterOnIntegratedMesh||x.include(d.Water,w);x.vertex.uniforms.add("overlayTexOffset",
"vec4");x.vertex.uniforms.add("overlayTexScale","vec4");x.varyings.add("vtcOverlay","vec4");x.vertex.code.add(g.glsl`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`);x.fragment.uniforms.add("ovColorTex","sampler2D");x.fragment.uniforms.add("overlayOpacity","float");x.fragment.code.add(g.glsl`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture2D(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture2D(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`);x.fragment.code.add(g.glsl`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`);if(w.pbrMode===c.PBRMode.Water||w.pbrMode===c.PBRMode.WaterOnIntegratedMesh)x.include(b.EvaluateMainLighting),x.fragment.code.add(g.glsl`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, lightingMainDirection, colorInput.rgb, lightingMainIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/TerrainTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderLibrary/terrain/Overlay.glsl ../../../../chunks/Terrain.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/DefaultVertexAttributeLocations ../lib/Program ../lib/StencilUtils ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m){f=function(u){function t(){var z=u.apply(this,arguments)||this;z.useStencil=!1;return z}c._inheritsLoose(t,u);var q=t.prototype;q.initializeProgram=function(z){var v=t.shader.get();const B=this.configuration;v=v.build({overlayMode:B.overlayMode,output:B.output,viewingMode:z.viewingMode,slicePlaneEnabled:B.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,textureFadingEnabled:B.textureFadingEnabled&&!B.renderOccluded,hasBackgroundColor:B.hasBackgroundColor,
useGrid:B.useGrid,receiveShadows:B.receiveShadows&&!B.renderOccluded,receiveAmbientOcclusion:!1,atmosphere:B.atmosphere,tileBorders:B.tileBorders,screenSizePerspective:B.screenSizePerspective,pbrMode:x.PBRMode.Disabled,ssrEnabled:B.ssrEnabled,highStepCount:!1});return new y.Program(z.rctx,v,r.Default3D)};q.initializePipeline=function(){this._stencilPipelineState=this._createPipeline(!0);return this._createPipeline(!1)};q._createPipeline=function(z){const v=this.configuration,B=v.backfaceCullingEnabled&&
!v.renderOccluded;return m.makePipelineState({blending:v.renderOccluded?m.simpleBlendingParams(h.BlendFactor.ONE,h.BlendFactor.ONE_MINUS_SRC_ALPHA):null,culling:B&&m.backFaceCullingParams,depthTest:!v.renderOccluded&&{func:h.CompareFunction.LESS},depthWrite:!v.renderOccluded&&m.defaultDepthWriteParams,colorWrite:m.defaultColorWriteParams,stencilTest:z?p.renderWhenBitIsNotSet(k.StencilBits.IntegratedMeshMaskExcluded):null})};q.getPipelineState=function(z,v){return this.useStencil?this._stencilPipelineState:
u.prototype.getPipelineState.call(this,z,v)};return t}(f.ShaderTechnique);f.shader=new n.ReloadableShaderModule(l.TerrainShader,()=>new Promise((u,t)=>a(["../core/shaderLibrary/terrain/Terrain.glsl"],u,t)));l=function(u){function t(){var q=u.apply(this,arguments)||this;q.output=g.ShaderOutput.Color;q.overlayMode=w.OverlayMode.Disabled;q.atmosphere=!1;q.receiveShadows=!1;q.slicePlaneEnabled=!1;q.backfaceCullingEnabled=!1;q.stencilEnabled=!1;q.textureFadingEnabled=!1;q.hasBackgroundColor=!1;q.useGrid=
!1;q.renderOccluded=!1;q.ssrEnabled=!1;q.tileBorders=!1;q.screenSizePerspective=!1;return q}c._inheritsLoose(t,u);return t}(e.ShaderTechniqueConfiguration);d.__decorate([e.parameter({count:g.ShaderOutput.COUNT})],l.prototype,"output",void 0);d.__decorate([e.parameter({count:w.OverlayMode.COUNT})],l.prototype,"overlayMode",void 0);d.__decorate([e.parameter()],l.prototype,"atmosphere",void 0);d.__decorate([e.parameter()],l.prototype,"receiveShadows",void 0);d.__decorate([e.parameter()],l.prototype,
"slicePlaneEnabled",void 0);d.__decorate([e.parameter()],l.prototype,"backfaceCullingEnabled",void 0);d.__decorate([e.parameter()],l.prototype,"stencilEnabled",void 0);d.__decorate([e.parameter()],l.prototype,"textureFadingEnabled",void 0);d.__decorate([e.parameter()],l.prototype,"hasBackgroundColor",void 0);d.__decorate([e.parameter()],l.prototype,"useGrid",void 0);d.__decorate([e.parameter()],l.prototype,"renderOccluded",void 0);d.__decorate([e.parameter()],l.prototype,"ssrEnabled",void 0);d.__decorate([e.parameter()],
l.prototype,"tileBorders",void 0);d.__decorate([e.parameter()],l.prototype,"screenSizePerspective",void 0);b.TerrainTechnique=f;b.TerrainTechniqueConfiguration=l;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/Terrain.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTangent.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/Skirts.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TerrainTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/HeaderComment.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m){function u(q){const z=new h.ShaderBuilder;z.include(y.HeaderComment,{name:"Terrain Shader",output:q.output});z.include(k.Skirts);z.attributes.add(m.VertexAttribute.POSITION,"vec3");z.attributes.add(m.VertexAttribute.UV0,"vec2");z.vertex.uniforms.add("proj","mat4").add("view","mat4").add("origin","vec3").add("skirtScale","float");z.fragment.uniforms.add("origin","vec3");if(q.output===b.ShaderOutput.Color){z.include(d.Transform,{linearDepth:!1});z.include(n.NormalUtils,
q);z.include(r.TerrainTexture,q);z.include(l.EvaluateSceneLighting,q);const v=q.overlayMode!==e.OverlayMode.Disabled,B=q.overlayMode===e.OverlayMode.EnabledWithWater;v&&z.include(e.Overlay,{pbrMode:f.PBRMode.Water,useCustomDTRExponentForWater:!1,ssrEnabled:q.ssrEnabled,highStepCount:q.highStepCount});B&&z.include(g.VertexTangent,q);z.varyings.add("vnormal","vec3");z.varyings.add("vpos","vec3");z.vertex.uniforms.add("viewNormal","mat4");q.receiveShadows&&z.varyings.add("linearDepth","float");q.tileBorders&&
z.varyings.add("vuv","vec2");q.atmosphere&&(z.vertex.uniforms.add("lightingMainDirection","vec3"),z.varyings.add("wnormal","vec3"),z.varyings.add("wlight","vec3"));q.screenSizePerspective&&(z.vertex.uniforms.add("screenSizePerspective","vec4"),z.varyings.add("screenSizeDistanceToCamera","float"),z.varyings.add("screenSizeCosAngle","float"));z.vertex.code.add(p.glsl`
      void main(void) {
        vpos = position;
        vnormal = getLocalUp(vpos, origin);

        vec2 uv = uv0;
        vpos = applySkirts(uv, vpos, vnormal, skirtScale);
        ${q.atmosphere?p.glsl`
        wnormal = normalize((viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz);
        wlight = normalize((view  * vec4(lightingMainDirection, 1.0)).xyz);`:""}
        ${q.tileBorders?p.glsl`vuv = uv;`:""}
        ${q.screenSizePerspective?p.glsl`
        vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
        screenSizeDistanceToCamera = length(viewPos);
        vec3 viewSpaceNormal = (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;
        screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}
        gl_Position = transformPosition(proj, view, vpos);
        ${q.receiveShadows?p.glsl`linearDepth = gl_Position.w;`:""}
        forwardTextureCoordinates(uv);
        ${v?p.glsl`setOverlayVTC(uv);`:""}
        ${B?p.glsl`forwardVertexTangent(vnormal);`:p.glsl``}
      }
    `);z.extensions.add("GL_OES_standard_derivatives");z.extensions.add("GL_EXT_shader_texture_lod");z.include(c.Slice,q);z.include(l.EvaluateSceneLighting,q);z.fragment.uniforms.add("cameraPosition","vec3").add("viewDirection","vec3").add("ssaoTex","sampler2D").add("viewportPixelSz","vec4");q.screenSizePerspective&&z.fragment.uniforms.add("screenSizePerspective","vec4");B&&(z.fragment.uniforms.add("ovWaterTex","sampler2D"),z.fragment.uniforms.add("view","mat4"));z.fragment.code.add(p.glsl`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`);z.fragment.code.add(p.glsl`
      void main() {
        ${q.receiveShadows?p.glsl`float shadow = readShadowMap(vpos, linearDepth);`:p.glsl`float shadow = 0.0;`}
        float vndl = dot(normalize(vnormal), lightingMainDirection);

        float ssao = viewportPixelSz.w < .0 ? 1.0 : texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
        vec4 tileColor = getTileColor();
        ${v?p.glsl`
            vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
            vec4 overlayColor = overlayOpacity * overlayColorOpaque;
            vec4 groundColor = tileColor;
            tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}
        if (rejectBySlice(vpos)) {
          tileColor *= sliceOpacity;
        }
        ${q.atmosphere?p.glsl`
            float ndotl = clamp(vndl, 0.0, 1.0);
            vec3 atm = vec3(clamp(1.0 - dot(-viewDirection, wnormal), 0.0, 1.0));
            atm *= clamp(1.0 - lum(tileColor.rgb) * 1.5, 0.0, 1.0); //avoid atmosphere on bright base maps
            atm *= clamp(ndotl * 2.0, 0.0, 1.0); // avoid atmosphere on dark side of the globe
            atm *= tileColor.a; // premultiply with tile alpha`:""}

        vec3 albedo = ${q.atmosphere?p.glsl`atm + tileColor.rgb;`:p.glsl`tileColor.rgb;`}
        vec3 normal = normalize(vnormal);

        // heuristic shading function used in the old terrain, now used to add ambient lighting
        float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        gl_FragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);
        ${B?p.glsl`
            vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
            float waterNormalLength = length(overlayWaterMask);
            if (waterNormalLength > 0.95) {
              mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
              vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
              vec4 viewPosition = view*vec4(vpos, 1.0);
              vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + origin);
              vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
              // un-gamma the ground color to mix in linear space
              gl_FragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w);
            }`:""}
        ${q.screenSizePerspective?p.glsl`
          float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, screenSizePerspective);
          if (perspectiveScale <= 0.25) {
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
          }
          else if (perspectiveScale <= 0.5) {
            gl_FragColor = mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
          }
          else if (perspectiveScale >= 0.99) {
            gl_FragColor = mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
          }
          else {
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
          }`:""}
        ${q.tileBorders?p.glsl`
            vec2 dVuv = fwidth(vuv);
            vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv, 1.0 - vuv));
            float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
      }
    `)}if(q.output===b.ShaderOutput.Depth||q.output===b.ShaderOutput.Shadow)z.include(d.Transform,{linearDepth:!0}),z.include(x.OutputDepth,{output:q.output}),z.include(n.NormalUtils,q),z.varyings.add("linearDepth","float"),z.vertex.uniforms.add("nearFar","vec2"),z.vertex.code.add(p.glsl`void main(void) {
vec3 normal = getLocalUp(position, origin);
vec2 uv = uv0;
vec3 vpos = applySkirts(uv, position, normal.xyz, skirtScale);
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);
}`),z.fragment.code.add(p.glsl`void main() {
outputDepth(linearDepth);
}`);q.output===b.ShaderOutput.Normal&&(z.include(d.Transform,{linearDepth:!1}),z.include(n.NormalUtils,q),z.varyings.add("vnormal","vec3"),z.varyings.add("vpos","vec3"),z.vertex.uniforms.add("viewNormal","mat4"),z.vertex.code.add(p.glsl`void main(void) {
vec3 normal = getLocalUp(position, origin);
vec2 uv = uv0;
vpos = applySkirts(uv, position, normal, skirtScale);
gl_Position = transformPosition(proj, view, vpos);
vnormal = normalize((viewNormal * vec4(normal, 1.0)).xyz);
}`),z.fragment.code.add(p.glsl`void main() {
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) {
normal = -normal;
}
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
}`));q.output===b.ShaderOutput.Highlight&&(z.include(d.Transform,{linearDepth:!1}),z.include(n.NormalUtils,q),z.include(e.Overlay,{pbrMode:f.PBRMode.Disabled}),z.vertex.code.add(p.glsl`void main() {
vec3 vnormal = getLocalUp(position, origin);
vec2 uv = uv0;
vec3 vpos = applySkirts(uv, position, vnormal, skirtScale);
setOverlayVTC(uv);
gl_Position = transformPosition(proj, view, vpos);
}`),z.include(w.OutputHighlight),z.fragment.code.add(p.glsl`void main() {
vec4 overlayColor = getCombinedOverlayColor();
if (overlayColor.a == 0.0) {
gl_FragColor = vec4(0.0);
return;
}
outputHighlight();
}`));return z}const t=Object.freeze({__proto__:null,build:u});a.TerrainShader=t;a.build=u})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTangent.glsl":function(){define(["exports","../../../../../ViewingMode","../../shaderModules/interfaces"],function(a,b,c){a.VertexTangent=function(d,g){d.varyings.add("tbnTangent","vec3");d.varyings.add("tbnBiTangent","vec3");g.viewingMode===b.ViewingMode.Global?d.vertex.code.add(c.glsl`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):d.vertex.code.add(c.glsl`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`);d.fragment.code.add(c.glsl`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/Skirts.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.Skirts=function(c){c.vertex.code.add(b.glsl`vec3 applySkirts(inout vec2 uv, vec3 vpos, vec3 vnormal, float skirtScale) {
float skirtLength = 0.0;
if (uv.x >= 2.0) {
skirtLength = uv.y * skirtScale;
vec2 x = vec2(uv.x) - vec2(3.5, 4.5);
uv = clamp(vec2(1.5) - abs(x), vec2(0.0), vec2(1.0));
}
return vpos - vnormal * skirtLength;
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TerrainTexture.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.TerrainTexture=function(c,d){c.varyings.add("vtc","vec2");c.vertex.uniforms.add("texOffsetAndScale","vec4");c.fragment.uniforms.add("tex","sampler2D");c.fragment.uniforms.add("textureOpacities","vec3");d.textureFadingEnabled&&(c.vertex.uniforms.add("nextTexOffsetAndScale","vec4"),c.varyings.add("nvtc",
"vec2"),c.fragment.uniforms.add("texNext","sampler2D"),c.fragment.uniforms.add("nextTexOpacities","vec3"),c.fragment.uniforms.add("fadeFactor","float"));c.vertex.code.add(b.glsl`
  void forwardTextureCoordinates(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${d.textureFadingEnabled?b.glsl`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:b.glsl``}
  }`);d.useGrid?(c.fragment.code.add(b.glsl`float lineFactorAtPosition(float value) {
float pos = value * 129.0;
if(pos < 0.5 || pos > 128.5) {
return 1.0;
}
pos = pos + 0.5;
float modulo = mod(pos, 16.0);
return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
}
float lineFactorAtUV(vec2 uv) {
return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
}
float lineFactor(vec2 uv) {
vec2 offset = fwidth(uv) * 0.25;
return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
}
vec4 gridColor(vec2 uv) {
float line = lineFactor(uv) * 0.1 + 0.9;
float backgroundOpacity = textureOpacities.y;
return vec4(1.0, 0.972, 0.918, 1.0) * line * backgroundOpacity;
}`),c.fragment.code.add(b.glsl`vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
if (opacities.y <= 0.0) {
return color * opacities.z * opacities.x;
}
vec4 grid = gridColor(uv);
float alpha = opacities.z * color.a;
return mix(grid, color, alpha) * opacities.x;
}`)):d.hasBackgroundColor?(c.fragment.uniforms.add("backgroundColor","vec3"),c.fragment.code.add(b.glsl`vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
if (opacities.y <= 0.0) {
return color * opacities.z * opacities.x;
}
float alpha = opacities.z * color.a;
float backgroundOpacity = opacities.y;
return mix(vec4(backgroundColor, 1.0) * backgroundOpacity, color, alpha) * opacities.x;
}`)):c.fragment.code.add(b.glsl`vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
return color;
}`);d.textureFadingEnabled?c.fragment.code.add(b.glsl`vec4 getTileColor() {
vec4 color = getColor(texture2D(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture2D(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):c.fragment.code.add(b.glsl`vec4 getTileColor() {
return getColor(texture2D(tex, vtc), vtc, textureOpacities);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/TerrainSurfacePerformanceInfo":function(){define(function(){return function(){this.numMerged=this.numSplit=this.numRendered=this.numVisible=this.numLeaves=this.numNodes=0;this.numRenderedPerLevel=[];this.numLoadedPerLevel=[]}})},"esri/views/3d/terrain/TilingSchemeLogic":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../geometry/support/aaBoundingRect ../../../geometry/support/spatialReferenceUtils ../../../layers/support/layerUtils ../../ViewingMode ./terrainUtils ./TilingScheme".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u){a.TilingSchemeLogic=function(t){function q(v){v=t.call(this,v)||this;v._handles=new g;return v}b._inheritsLoose(q,t);var z=q.prototype;z.initialize=function(){this._handles.add(this.layers.on("change",()=>this._update()));this._handles.add(this.extentHelper.watch("layerViewsExtent",()=>this._setAdHocTilingScheme()));this._update();this.tilingSchemeLocked||this._setAdHocTilingScheme()};z.destroy=function(){this._handles=x.destroyMaybe(this._handles);this._waitTask=
null};z._update=function(){this._waitTask=null;if(!this.tilingSchemeLocked){var v;this.layers.some(A=>!p.isTiledLayer(A)||A.isRejected()?!1:!A.isFulfilled()||x.isSome(m.getTiledLayerInfo(A,this.viewSpatialReference,this.viewingMode))?(v=A,!m.isVectorTileLayer(A)&&!m.isProjectableRasterLayer(A)):!1);if(v)if(v.isResolved()){var B=m.getTiledLayerInfo(v,this.viewSpatialReference,this.viewingMode);x.isSome(B)&&(B=new u.default(B.tileInfo),this._lockTilingScheme(B))}else this._updateWhen(v)}};z._updateWhen=
function(v){const B=v.when().catch(()=>{}).then(()=>{B!==this._waitTask||this.destroyed||this._update()});this._waitTask=B};z._lockTilingScheme=function(v){if(this.viewingMode===h.ViewingMode.Global){const B=v.levels.length-1;v.spatialReference.isWebMercator?v=u.default.makeWebMercatorAuxiliarySphere(B):k.canProjectToWGS84ComparableLonLat(v.spatialReference)&&(v=u.default.makeGCSWithTileSize(v.spatialReference,v.pixelSize,B))}this.tilingSchemeLocked=!0;this.tilingScheme=v;this.extentHelper.tilingScheme=
this.tilingScheme;this._updateTiledLayerExtent();this._handles.removeAll();this._handles.add(this.extentHelper.watch("tiledLayersExtent",()=>this._updateTiledLayerExtent()))};z._updateTiledLayerExtent=function(){this._set("extent",this.extentHelper.tiledLayersExtent)};z._setAdHocTilingScheme=function(){if(this.viewingMode===h.ViewingMode.Global){var v=this.extentHelper.viewSpatialReference;const B=k.canProjectToWGS84ComparableLonLat(v)||y.isMars(v)||y.isMoon(v);v.isWebMercator?this.tilingScheme=u.default.WebMercatorAuxiliarySphere:
B&&(this.tilingScheme=u.default.makeGCSWithTileSize(v,256));this._set("extent",this.extentHelper.layerViewsExtent)}else v=this.extentHelper.layerViewsExtent,x.isSome(v)&&!r.equals(v,this.extent)&&(this.tilingScheme=u.default.fromExtent(v,this.extentHelper.viewSpatialReference),this._set("extent",v))};b._createClass(q,[{key:"test",get:function(){return{lockTilingScheme:v=>this._lockTilingScheme(v),done:!this._waitTask}}}]);return q}(d);c.__decorate([w.property()],a.TilingSchemeLogic.prototype,"tilingScheme",
void 0);c.__decorate([w.property({readOnly:!0})],a.TilingSchemeLogic.prototype,"extent",void 0);c.__decorate([w.property({value:!1})],a.TilingSchemeLogic.prototype,"tilingSchemeLocked",void 0);c.__decorate([w.property({constructOnly:!0})],a.TilingSchemeLogic.prototype,"viewSpatialReference",void 0);c.__decorate([w.property({constructOnly:!0})],a.TilingSchemeLogic.prototype,"layers",void 0);c.__decorate([w.property({constructOnly:!0})],a.TilingSchemeLogic.prototype,"extentHelper",void 0);c.__decorate([w.property({constructOnly:!0})],
a.TilingSchemeLogic.prototype,"viewingMode",void 0);a.TilingSchemeLogic=c.__decorate([e.subclass("esri.views.3d.terrain.TilingSchemeLogic")],a.TilingSchemeLogic);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/UpsampleInfo":function(){define(["exports","../../../chunks/vec2f64"],function(a,b){let c=function(){function d(){this.offset=b.create();this.scale=0;this.tile=null}var g=d.prototype;g.init=function(x,w,l,n){this.tile=x;this.offset[0]=w;this.offset[1]=l;this.scale=
n};g.dispose=function(){this.tile=null;this.offset[0]=0;this.scale=this.offset[1]=0};return d}();a.UpsampleInfo=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/Stage":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/PooledArray ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../state/helpers/SceneIntersectionHelper ./lib/AutoDisposable ./lib/basicInterfaces ./lib/ChangeSet ./lib/GeometryRecord ./lib/WebGLLayer ./parts/Model ./parts/RenderView ../../support/Scheduler".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v){var B;a.Stage=B=function(A){function E(D){D=A.call(this,D)||this;D._handles=new g;D._model=new q.Model;D._layers=new w;D._changeSet=new m.ChangeSet;D._layerSyncSet=new Set;return D}b._inheritsLoose(E,A);var C=E.prototype;C.initialize=function(){this._set("renderView",new z.RenderView(this));this._frameTask=this.resourceController.scheduler.registerTask(v.TaskPriority.STAGE,this);this._handles.add(this._frameTask)};C.destroy=function(){u.GeometryRecord.pool.prune(0);
this._handles.destroy();this.dispose()};C.add=function(D){this._model.add(D);t.isWebGLLayer(D)&&(D.attachStage(this),this._addLayer(D));this.renderView.requestRender()};C.remove=function(D){x.isNone(D)||(this.renderView.requestRender(),this._model.remove(D),t.isWebGLLayer(D)&&(this._removeLayer(D),D.detachStage()))};C.addMany=function(D){x.isSome(D)&&(this._model.addMany(D),this.renderView.requestRender())};C.removeMany=function(D){x.isSome(D)&&(this._model.removeMany(D),this.renderView.requestRender())};
C.load=function(){var D=b._asyncToGenerator(function*(F){x.isNone(F)||(Array.isArray(F)||(F=[F]),yield l.all(F.filter(G=>x.isNone(G.glTexture)).map(G=>this.schedule(()=>this._model.has(G)?G.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique):null))))});return function(F){return D.apply(this,arguments)}}();C.loadImmediate=function(D){return D.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique)};C.forEachOfType=function(D,
F){this._model.forEachOfType(D,F)};C.handleEvent=function(D,F){this.destroyed||(this._model.dirtySet[D](F),this.renderView.requestRender())};C.runTask=function(D){this._frameTask.processQueue(D);D.done||this._commit()};C._commit=function(){const D=this._model.dirtySet;B.DebugSettings.logDirtySet&&console.log("Dirty set: "+D.formatDebugInfo());D.commit(this._changeSet);B.DebugSettings.logDirtySet&&(console.log("RGs add: "+this._changeSet.adds.map(F=>F.id)),console.log("RGs remove: "+this._changeSet.removes.map(F=>
F.id)));this._layerSyncSet.clear();this.renderView.modify(this._changeSet);this.renderView.requestRender()};C.schedule=function(D,F){return this._frameTask.schedule(D,F)};C.syncLayer=function(D){this._layerSyncSet.add(D);this.renderView.requestRender()};C.processSyncLayers=function(){const D=this._model.dirtySet;this._layers.forAll(F=>{if(this._layerSyncSet.has(F.id)||F.updatePolicy===h.UpdatePolicy.SYNC)D.commitLayer(F.id,this._changeSet),this._layerSyncSet.delete(F.id)});for(const F of this._layerSyncSet)D.commitLayer(F,
this._changeSet);this._layerSyncSet.clear();this.renderView.modify(this._changeSet)};C.getObject=function(D){return this._model.getObject(D)};C._addLayer=function(D){this._layers.some(F=>F===D)||this._layers.push(D)};C._removeLayer=function(D){this._commit();null!=this._layers.removeUnordered(D)&&(this._model.dirtySet.getResidentRenderGeometries(D.id,this._changeSet.removes),this.renderView.modify(this._changeSet))};C.addRenderPlugin=function(D,F,G){D=this.renderView.renderPlugins.add(D,F,G);G=()=>
{y.isIntersectionHandler(F)&&this.sceneIntersectionHelper.addIntersectionHandler(F)};if(l.isPromiseLike(D))return D.then(G);G()};C.removeRenderPlugin=function(D){y.isIntersectionHandler(D)&&this.sceneIntersectionHelper.removeIntersectionHandler(D);this.renderView.renderPlugins.remove(D)};b._createClass(E,[{key:"viewingMode",get:function(){return this.state.viewingMode}},{key:"updating",get:function(){return this._model.dirtySet.dirty||this.renderView.updating||this._frameTask.updating}},{key:"running",
get:function(){return this._model.dirtySet.dirty}},{key:"layers",get:function(){return this._layers}},{key:"performanceInfo",get:function(){return{renderView:this.renderView.performanceInfo,model:this._model.getStats()}}},{key:"test",get:function(){const D=this;return{getCount(F){return D._model.test.content.filter(G=>G.type===F).length},model:D._model}}}]);return E}(p.AutoDisposableMixin(d));a.Stage.DebugSettings={endFrameContentValidation:!1,logDirtySet:!1};c.__decorate([n.property({constructOnly:!0})],
a.Stage.prototype,"resourceController",void 0);c.__decorate([n.property({constructOnly:!0})],a.Stage.prototype,"options",void 0);c.__decorate([n.property({constructOnly:!0})],a.Stage.prototype,"state",void 0);c.__decorate([n.property({constructOnly:!0})],a.Stage.prototype,"sceneIntersectionHelper",void 0);c.__decorate([n.property({readOnly:!0})],a.Stage.prototype,"viewingMode",null);c.__decorate([n.property({constructOnly:!0})],a.Stage.prototype,"container",void 0);c.__decorate([n.property({constructOnly:!0})],
a.Stage.prototype,"renderSR",void 0);c.__decorate([n.property({constructOnly:!0})],a.Stage.prototype,"_handles",void 0);c.__decorate([n.property({readOnly:!0})],a.Stage.prototype,"updating",null);c.__decorate([n.property({constructOnly:!0})],a.Stage.prototype,"_model",void 0);c.__decorate([p.autoDispose(),n.property()],a.Stage.prototype,"renderView",void 0);a.Stage=B=c.__decorate([r.subclass("esri.views.3d.webgl-engine.Stage")],a.Stage);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/parts/Model":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../lib/ContentObjectType ../lib/GridLocalOriginFactory ../lib/ModelDirtySet ../lib/RenderGeometry ../lib/Util ../lib/WebGLLayer".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h){a.Model=function(m){function u(){var q=m.apply(this,arguments)||this;q.dirtySet=new r({model:b._assertThisInitialized(q)});q._content=new Map;q._originFactory=new k.GridLocalOriginFactory(null,75E4);return q}b._inheritsLoose(u,m);var t=u.prototype;t.getObject=function(q){return this._content.get(q)};t.add=function(q){const z=q.id;p.assert(!this._content.has(z),"Model/Stage already contains object to be added");this._content.set(z,q);h.isWebGLLayer(q)&&this.dirtySet.layerAdded(q)};
t.remove=function(q){p.assert(this._content.has(q.id),"Model/Stage doesn't contain object to be removed");this._content.delete(q.id);q.unload();h.isWebGLLayer(q)&&this.dirtySet.layerRemoved(q)};t.addMany=function(q){for(const z of q)g.isSome(z)&&(p.assert(!this._content.has(z.id),"Model/Stage already contains object to be added"),this._content.set(z.id,z))};t.removeMany=function(q){for(const z of q)p.assert(this._content.has(z.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(z.id),
z.unload()};t.has=function(q){return this._content.has(q.id)};t.forEachOfType=function(q,z){this._content.forEach(v=>{v.type===q&&z(v)})};t.getRenderGeometry=function(q,z){const {geometry:v,material:B,id:A,shaderTransformation:E,origin:C,instanceParameters:D}=z,F=new y.RenderGeometry(v,B,{id:A,boundingInfo:v.boundingInfo,calculateShaderTransformation:E,castShadow:q.castShadow});F.updateTransformation(G=>q.getCombinedStaticTransformation(z,G));F.origin=C||this._originFactory.getOrigin(F.boundingSphere);
F.instanceParameters=D;return F};t.updateRenderGeometryTransformation=function(q,z,v){if(g.isNone(q))return!1;v.updateTransformation(A=>q.getCombinedStaticTransformation(z,A));const B=this._originFactory.getOrigin(v.boundingSphere);return v.origin!==B};t.getStats=function(){const q={},z=Array.from(this._content.values());for(let v=0;v<e.ContentObjectType.COUNT;++v)q[v]=z.filter(B=>B.type===v).length;return{contentTypes:q,dirtySet:this.dirtySet.formatDebugInfo()}};b._createClass(u,[{key:"test",get:function(){return{content:Array.from(this._content.values())}}}]);
return u}(d);c.__decorate([x.property({constructOnly:!0})],a.Model.prototype,"dirtySet",void 0);a.Model=c.__decorate([f.subclass("esri.views.3d.webgl-engine.parts.Model")],a.Model);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/ModelDirtySet":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/MapUtils ../../../../core/maybe ../../../../core/uid ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ./GeometryRecord ./ModelDirtyTypes ./Util".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y){c=function(p){function h(u){u=p.call(this,u)||this;u._residentGeomRecords=new Map;u._dirtyGeomRecords=new Map;u.dirty=!1;return u}a._inheritsLoose(h,p);var m=h.prototype;m.commit=function(u){this.dirty=!1;this._dirtyGeomRecords.forEach((t,q)=>this.commitLayer(q,u))};m.commitLayer=function(u,t){const q=this._dirtyGeomRecords.get(u);q&&(q.forEach((z,v)=>{const B=this._ensureGeomRecord(u,v);z.forEach((A,E)=>{var C=A[0],D=A[1],F=A[2];A=!1;if(D&r.ModelDirty.Geometry.UPDATE){var G=
B.get(E);if(G){G=G[1];if(F&r.ModelDirty.State.TRANSFORMATION){const J=this.model.getObject(v);this.model.updateRenderGeometryTransformation(J,C,G)&&(A=!0)}A||t.updates.push({renderGeometry:G,updateType:F})}else y.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(D&r.ModelDirty.Geometry.REMOVE||A)(F=B.get(E))?(t.removes.push(F[1]),B.delete(E),F[0].disposed&&k.GeometryRecord.pool.release(F[0])):D===r.ModelDirty.Geometry.REMOVE&&y.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove");
if(D&r.ModelDirty.Geometry.ADD||A)D=this.model.getObject(v),g.isSome(D)&&(D=this.model.getRenderGeometry(D,C),C=[C,D],t.adds.push(D),B.set(E,C))});0===B.size&&this._residentGeomRecords.get(u).delete(v)}),0===this._residentGeomRecords.get(u).size&&this._residentGeomRecords.delete(u),this._dirtyGeomRecords.delete(u))};m.getResidentRenderGeometries=function(u,t){(u=this._residentGeomRecords.get(u))&&u.forEach(q=>q.forEach(z=>t.push(z[1])))};m._objectStateChanged=function(u,t){for(const q of t.geometryRecords)this._updateOrCreateDirtyRecord(t,
q,null,r.ModelDirty.Geometry.UPDATE,0,0,r.ModelDirty.Geometry.UPDATE,r.ModelDirty.Geometry.ADD|r.ModelDirty.Geometry.REMOVE,u)};m.visibilityChanged=function(u){this._objectStateChanged(r.ModelDirty.State.VISIBILITIES,u)};m.highlightChanged=function(u){this._objectStateChanged(r.ModelDirty.State.HIGHLIGHTS,u)};m.occlusionChanged=function(u){this._objectStateChanged(r.ModelDirty.State.OCCLUDEES,u)};m.vertexAttrsUpdated=function(u){this._updateOrCreateDirtyRecord(u.object,u.record,null,r.ModelDirty.Geometry.UPDATE,
0,0,r.ModelDirty.Geometry.UPDATE,r.ModelDirty.Geometry.ADD|r.ModelDirty.Geometry.REMOVE,r.ModelDirty.State.VERTEXATTRS)};m.layerAdded=function(u){u.objects.forAll(t=>this._layerObjectAdded(u,t))};m.layerRemoved=function(u){u.objects.forAll(t=>this._layerObjectRemoved(u,t))};m.layerObjectAdded=function(u){this._layerObjectAdded(u.layer,u.object)};m._layerObjectAdded=function(u,t){u=u.id;for(const q of t.geometryRecords)this._objectGeometryAdded(t,q,u)};m.layerObjectRemoved=function(u){this._layerObjectRemoved(u.layer,
u.object)};m.layerObjectsAdded=function(u){for(const t of u.objects)this._layerObjectAdded(u.layer,t)};m.layerObjectsRemoved=function(u){for(const t of u.objects)this._layerObjectRemoved(u.layer,t)};m._layerObjectRemoved=function(u,t){u=u.id;for(const q of t.geometryRecords)this._objectGeometryRemoved(t,q,u)};m.shaderTransformationChanged=function(u){(u=this._residentGeomRecords.get(u.id))&&u.forEach((t,q)=>{(q=this.model.getObject(q))&&q.hasVolativeTransformation()&&t.forEach(z=>{z[1].shaderTransformationChanged()})})};
m.objectTransformation=function(u){const t=this._getParentLayerId(u);this._ensureGeomRecord(t,u.id).forEach(q=>{this._updateOrCreateDirtyRecord(u,q[0],t,r.ModelDirty.Geometry.UPDATE,0,0,r.ModelDirty.Geometry.UPDATE,r.ModelDirty.Geometry.ADD|r.ModelDirty.Geometry.REMOVE,r.ModelDirty.State.TRANSFORMATION)})};m.objectGeometryAdded=function(u){this._objectGeometryAdded(u.object,u.record)};m._objectGeometryAdded=function(u,t,q=null){this._updateOrCreateDirtyRecord(u,t,q,r.ModelDirty.Geometry.ADD,r.ModelDirty.Geometry.REMOVE,
0,0,0)};m.objectGeometryRemoved=function(u){this._objectGeometryRemoved(u.object,u.record)};m._objectGeometryRemoved=function(u,t,q=null){this._updateOrCreateDirtyRecord(u,t,q,r.ModelDirty.Geometry.REMOVE,r.ModelDirty.Geometry.ADD,r.ModelDirty.Geometry.UPDATE,0,0)};m._updateOrCreateDirtyRecord=function(u,t,q,z,v,B,A,E,C){q=g.unwrapOr(q,this._getParentLayerId(u));const D=t.id;u=this._ensureDirtyRecord(q,u.id);(q=u.get(D))?(t=q[1],t&v?(u.delete(D),q[0].disposed&&k.GeometryRecord.pool.release(q[0])):
t&B?(q[1]=z,q[2]=C):t&A?q[2]|=C:t&E||y.assert(!1,"ModelDirtySet.objectGeometryAdded: inconsistent state")):u.set(D,[t,z,C]);this.dirty=this._hasDirtyGeometryRecords};m._ensureGeomRecord=function(u,t){let q=this._residentGeomRecords.get(u);q||(q=new Map,this._residentGeomRecords.set(u,q));u=q.get(t);u||(u=new Map,q.set(t,u));return u};m._ensureDirtyRecord=function(u,t){let q=this._dirtyGeomRecords.get(u);q||(q=new Map,this._dirtyGeomRecords.set(u,q));u=q.get(t);u||(u=new Map,q.set(t,u));return u};
m._getParentLayerId=function(u){return g.isSome(u.parentLayer)?u.parentLayer.id:x.NullUID};m.formatDebugInfo=function(){const u=["ADD","UPD",void 0,"REM"];let t="";this._dirtyGeomRecords.forEach((q,z)=>{q.forEach((v,B)=>{0<t.length&&(t+="\n");t+=z+"."+B;const A=[];v.forEach(E=>{const C=E[1];A[C]||(A[C]=[]);A[C].push(E[0].geometry.id)});for(v=0;v<A.length;v++)if(A[v])for(t+=" "+u[v-1]+": ",B=0;B<A[v].length;B++)t+=A[v][B]+", "})});return t};a._createClass(h,[{key:"_hasDirtyGeometryRecords",get:function(){return d.someMap(this._dirtyGeomRecords,
u=>d.someMap(u,t=>t&&0<t.size))}},{key:"test",get:function(){const u=this;return{get residentLayerCount(){return u._residentGeomRecords.size},get residentObjectCount(){return Array.from(u._residentGeomRecords.values()).reduce((t,q)=>t+q.size,0)}}}}]);return h}(c);b.__decorate([w.property({constructOnly:!0})],c.prototype,"model",void 0);b.__decorate([w.property()],c.prototype,"dirty",void 0);return c=b.__decorate([e.subclass("esri.views.3d.webgl-engine.lib.ModelDirtySet")],c)})},"esri/views/3d/webgl-engine/parts/RenderView":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/has ../../../../core/Logger ../../../../core/maybe ../../../../core/scheduling ../../../../core/time ../../../../core/watchUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../collections/Component/ComponentObjectCollection ../core/shaderTechnique/ShaderTechniqueRepository ../lib/AutoDisposable ../lib/basicInterfaces ../lib/CompositingHelper ../lib/depthRangeUtils ../lib/GLMaterialRepository ../lib/MagnifierHelper ../lib/Renderer ../lib/RenderingContext ../lib/TextureRepository ../materials/StippleTextureRepository ../materials/internal/WaterTextureRepository ./requireUtils ./ScreenshotManager ../../../webgl/context-util".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E,C,D,F,G,J,I){const O=w.getLogger("esri.views.3d.webgl-engine.parts.View");a.RenderView=function(M){function U(L){var N=M.call(this,{})||this;N.events=new g;N.waterTextureRepository=new F.WaterTextureRepository;N._magnifierHelper=new B.MagnifierHelper;N._needsUpdate=!0;N._needsRender=!0;N._idleSuspend=!0;N._needsWaterReflectionUpdate=!1;N._lastAnimationUpdate=0;N._container=L.container;N._initializeContext(L);e.init(N.waterTextureRepository,
"loadingState",()=>N.requestRender());N._magnifierHelper.events.on("request-render",()=>N.requestRender());N._stippleTextureRepository=new D.StippleTextureRepository(N._rctx);N._shaderTechniqueRepository=new m.ShaderTechniqueRepository({rctx:N._rctx,viewingMode:L.viewingMode,stippleTextureRepository:N._stippleTextureRepository,waterTextureRepository:N.waterTextureRepository});N._textureRepository=new C.TextureRepository(L,N._shaderTechniqueRepository,N._rctx);N._textureRepository.events.on("changed",
T=>N.requestRender(T));N._materialRepository=new v.GLMaterialRepository(N._textureRepository,N._shaderTechniqueRepository,()=>N.requestRender(),()=>N.requestRender());N._compositingHelper=new q(N._rctx,N._shaderTechniqueRepository);N._renderer=new A.Renderer(N._materialRepository,N._textureRepository,N._shaderTechniqueRepository,N._rctx,N._compositingHelper,N._magnifierHelper,T=>N.requestRender(T),(T,S)=>L.schedule(T,S),L);N._screenshotManager=new J.ScreenshotManager(N._rctx,(T,S,H)=>N._renderer.render(T,
S,S,H),T=>N.requestRender(T),L.options.screenshot.renderOverlay,T=>N.events.emit("force-camera-for-screenshot",T),()=>N._renderer.disposeOffscreenBuffers());N._registerFrameTask(L);return N}b._inheritsLoose(U,M);var R=U.prototype;R.normalizeCtorArgs=function(){return{}};R.dispose=function(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas);this._frameTask=l.removeMaybe(this._frameTask);this._shaderTechniqueRepository=l.disposeMaybe(this._shaderTechniqueRepository);
M.prototype.dispose.call(this);this._rctx=this._tmpDepthBuffer=null};R.requestRender=function(L=t.RenderRequestType.UPDATE){L===t.RenderRequestType.UPDATE?this._needsUpdate=!0:this._needsRender=!0};R.ensureEdgeView=function(){return this._renderer.ensureEdgeView()};R.updateLightSources=function(L,N,T){this._renderer.updateLightSources(L,N,T);this.requestRender()};R.setRenderParameters=function(L){void 0!==L.idleSuspend&&this._idleSuspend!==!!L.idleSuspend&&(this._idleSuspend=!!L.idleSuspend,this.requestRender());
this._renderer.setRenderParameters(L)};R.modify=function(L){this._renderer.modify(L);L.clear()};R.takeScreenshot=function(L){return this._screenshotManager.takeScreenshot(L)};R.readAccumulatedShadow=function(L){return this._renderer.readAccumulatedShadow(L[0],L[1])};R.getMinimalDepthForArea=function(L,N,T,S,H,Q=H){Q=S.constrainWindowSize(N,T,H*S.pixelRatio,Q*S.pixelRatio);const W=this._ensureDepthBuffer(Q);this._renderer.readDepthPixels(S,Q[0],Q[1],Q[2],Q[3],W);H=Number.MAX_VALUE;for(let V=0;V<Q[2]*
Q[3];V++){const Y=z.textureToDepth(4*V,W,S.nearFar);H>Y&&Y!==S.nearFar[0]&&Y!==S.nearFar[1]&&(H=Y)}l.isSome(L)&&(L=L.pickDepth(N*S.pixelRatio,T*S.pixelRatio,S),l.isSome(L)&&H>L&&L!==S.nearFar[0]&&L!==S.nearFar[1]&&(H=L));return H===Number.MAX_VALUE?void 0:H};R._ensureDepthBuffer=function(L){L=4*L[2]*L[3];if(l.isNone(this._tmpDepthBuffer)||this._tmpDepthBuffer.byteLength<L)this._tmpDepthBuffer=new Uint8Array(L);return this._tmpDepthBuffer};R.reloadShaders=function(){var L=b._asyncToGenerator(function*(){G.removeLoadedShaderModules();
yield this._shaderTechniqueRepository.reloadAll();this.requestRender()});return function(){return L.apply(this,arguments)}}();R._registerFrameTask=function(L){const N=L.state,T={viewCamera:N.camera,frameHasDecorations:!1};let S=!1,H=t.RenderRequestType.BACKGROUND,Q=!1;this._frameTask=n.addFrameTask({preRender:W=>{S=this.updating;H=this._needsUpdate?t.RenderRequestType.UPDATE:t.RenderRequestType.BACKGROUND;L.processSyncLayers();const V=f.Milliseconds(W.time-this._lastAnimationUpdate);if(V>this.animationTimestep||
l.isSome(this.forcedAnimationTime)||S||this._needsRender)this._renderer.updateAnimation({camera:N.camera,dt:V,forcedTime:this.forcedAnimationTime})&&this.requestRender(t.RenderRequestType.BACKGROUND),this._lastAnimationUpdate=W.time},render:()=>{if((this._needsUpdate||this._needsRender||!this._idleSuspend||!this._renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&0<N.camera.fullWidth&&0<N.camera.fullHeight){const W=this._needsUpdate&&this._idleSuspend&&this._renderer.isCameraFinal;this._needsWaterReflectionUpdate=
this._needsUpdate=this._needsRender=!1;this._renderer.render(null,N.camera,N.contentCamera,t.Decorations.ON);Q=!0;W&&this._renderer.hasWaterReflection&&(this.requestRender(t.RenderRequestType.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:()=>{T.viewCamera=N.camera;T.frameHasDecorations=this._renderer.hasSlicePlane||this._magnifierHelper.enabled;this._textureRepository.update();this._screenshotManager.update(T)},finish:()=>{Q&&(this._renderer.finish(H),Q=!1)}})};R._initializeContext=function(L){const N=
L.options;this._canvas=N.canvas;this._canvas||(this._canvas=document.createElement("canvas"));this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const T=I.createContextOrErrorHTML("3d",this._canvas,{alpha:N.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:null==N.stencil?!0:N.stencil,powerPreference:"high-performance"});l.isNone(T)?(L=x("esri-force-webgl"),O.error("A WebGL context with the requested version ("+L?L:"automatic) could not be created.")):(this._rctx=
this._newRenderingContext(T,L),this._loadShaderOnlyExtensions(),!N.alpha&&this._rctx.contextAttributes.alpha&&O.error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&11<=x("safari")&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas))};R._newRenderingContext=function(L,N){const T={disabledExtensions:N.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:N.options.debugWebGLExtensions||
{},maxAnisotropy:8},S=(H,Q)=>N.resourceController.memoryController.newCache(H,Q);if(P.enableContextCache){let H=K.get(L);if(H)return H.configure(T),H.newCache=S,H.ref(),H;H=new E.RenderingContext(L,T,S);K.set(L,H);H.ref();return H}return new E.RenderingContext(L,T,S)};R._loadShaderOnlyExtensions=function(){this._rctx.capabilities.enable("standardDerivatives");this._rctx.capabilities.enable("shaderTextureLOD");this._rctx.capabilities.enable("textureFloat")};b._createClass(U,[{key:"performanceInfo",
get:function(){const L=this._rctx.gl;return{renderer:this._renderer.performanceInfo,textureMemory:void 0!==L.getUsedTextureMemory?L.getUsedTextureMemory():void 0,renderbufferMemory:void 0!==L.getUsedRenderbufferMemory?L.getUsedRenderbufferMemory():void 0,VBOMemory:void 0!==L.getUsedVBOMemory?L.getUsedVBOMemory():void 0}}},{key:"updating",get:function(){return this._needsUpdate||this._needsWaterReflectionUpdate||this._renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||
this._magnifierHelper.updating}},{key:"edgeView",get:function(){return this._renderer.edgeView}},{key:"textureRepository",get:function(){return this._textureRepository}},{key:"compositingHelper",get:function(){return this._compositingHelper}},{key:"magnifier",set:function(L){this._magnifierHelper.magnifier=L}},{key:"renderingContext",get:function(){return this._rctx}},{key:"capabilities",get:function(){return this._rctx.capabilities}},{key:"canvas",get:function(){return this._canvas}},{key:"hasShadowsEnabled",
get:function(){return this._renderer.hasShadowsEnabled}},{key:"renderPlugins",get:function(){return this._renderer.renderPlugins}},{key:"test",get:function(){return{renderer:this._renderer}}},{key:"gpuMemoryUsage",get:function(){return this._renderer.gpuMemoryUsage}},{key:"animationTimestep",get:function(){return this._renderer.animationTimestep}},{key:"componentObjectCollection",get:function(){l.isNone(this._componentObjectCollection)&&(this._componentObjectCollection=new h.ComponentObjectCollection(this._renderer.renderPassManager));
return this._componentObjectCollection},set:function(L){this._componentObjectCollection=L}}]);return U}(u.AutoDisposableMixin(d));c.__decorate([k.property({type:Boolean,readOnly:!0})],a.RenderView.prototype,"updating",null);c.__decorate([u.autoDispose()],a.RenderView.prototype,"_rctx",void 0);c.__decorate([u.autoDispose()],a.RenderView.prototype,"_container",void 0);c.__decorate([u.autoDispose()],a.RenderView.prototype,"_canvas",void 0);c.__decorate([u.autoDispose()],a.RenderView.prototype,"_stippleTextureRepository",
void 0);c.__decorate([u.autoDispose(),k.property()],a.RenderView.prototype,"waterTextureRepository",void 0);c.__decorate([u.autoDispose(),k.property()],a.RenderView.prototype,"_magnifierHelper",void 0);c.__decorate([u.autoDispose(),k.property()],a.RenderView.prototype,"_textureRepository",void 0);c.__decorate([u.autoDispose()],a.RenderView.prototype,"_compositingHelper",void 0);c.__decorate([u.autoDispose()],a.RenderView.prototype,"_renderer",void 0);c.__decorate([u.autoDispose()],a.RenderView.prototype,
"_screenshotManager",void 0);c.__decorate([u.autoDispose()],a.RenderView.prototype,"componentObjectCollection",null);c.__decorate([u.autoDispose()],a.RenderView.prototype,"_componentObjectCollection",void 0);c.__decorate([k.property()],a.RenderView.prototype,"_needsUpdate",void 0);c.__decorate([k.property()],a.RenderView.prototype,"_needsWaterReflectionUpdate",void 0);a.RenderView=c.__decorate([p.subclass("esri.views.3d.webgl-engine.parts.RenderView")],a.RenderView);const P={enableContextCache:!1,
disposeContextCache:()=>{K.forEach(M=>M.dispose());K.clear()}},K=new Map;a.test=P;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/ComponentObjectCollection":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/Logger ../../../../../core/maybe ../../../../../core/PooledArray ../../../../../chunks/mat3 ../../../../../chunks/mat3f32 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../chunks/vec4 ../../../../../chunks/vec4f32 ../../../layers/support/symbolColorUtils ../../../support/orientedBoundingBox ../../../support/buffer/glUtil ../../../support/buffer/InterleavedLayout ./ComponentData ./ComponentObject ./interface ./IntersectionGeometry ./Renderable ./RenderGeometry ./RenderSubmitSystem ./SourceGeometry ./Material/ComponentMaterial ./Material/ComponentTechnique ../../core/util/TwoVectorPosition ../../lib/ComponentUtils ../../lib/Util ../../lib/VertexAttribute ../../lib/TextureBackedBuffer/BufferManager ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E,C,D,F,G,J,I,O,P){function K(T,S){return T===S?A.ComponentParameterSummary.All:0===T?A.ComponentParameterSummary.None:A.ComponentParameterSummary.Some}const M=c.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");c=function(){function T(H){this._renderManager=H;this._objects=[new g,new g];this._renderSubmit=new v.RenderSubmitSystem(this);this._renderManager.register(this._renderSubmit);this._componentBufferManager=
new J.BufferManager(H.rctx)}var S=T.prototype;S.dispose=function(){F.assert(0===this._objects[m.State.Hidden].length&&0===this._objects[m.State.Visible].length,"ObjectCollection should be empty upon disposal");this._componentBufferManager.destroy()};S.createObject=function(H){const Q=new m.ComponentObject;Q.toMapSpace=H.toMapSpace.slice();Q.transform=H.transform;Q.obb=r.clone(H.obb);Q.components=new h(this._componentBufferManager,H.geometry.componentOffsets);Q.renderable=this._createRenderable(H,
Q.components);Q.intersectionGeometry=new t(H.geometry.positionData,Q.components);this._objects[Q.visible].push(Q);return Q};S.destroyObject=function(H){this._objects[H.visible].removeUnordered(H);H.dispose();this._notifyDirty()};S.setObjectVisibility=function(H,Q){Q!==H.visible&&(this._objects[H.visible].removeUnordered(H),this._objects[Q].push(H),H.visible=Q,this._notifyDirty())};S.preSubmit=function(H){const Q=H.camera.eye;this.visibleObjects.forAll(W=>{const V=l.squaredDistance(Q,W.obb.center);
W.renderable.meta.cameraDepthSquared=V})};S.getMaterial=function(H){return H.renderable.material};S.updateMaterial=function(H,Q){H=H.renderable.material;Q(H);H.dirty&&this._notifyDirty()};S.setAllComponentVisibilities=function(H,Q){H.components.visibility.reset(Q);H.components.visibilityDirty();this._notifyDirty()};S.forEachVisibleComponent=function(H,Q){return H.components.visibility.forEachComponent(Q)};S.getComponentCount=function(H){const Q=H.components.visibility.componentCount();return{visible:Q,
invisible:H.components.count-Q}};S.setComponentData=function(H,Q){const W=H.renderable.material;if(u.isVaryingComponentParameters(Q)){H=H.components;var V=H.materialDataBuffer;const Y=H.materialDataIndices,aa={castShadows:!0,pickable:!0,externalColor:e.create(),externalColorMixMode:k.ColorMixModeEnum.Multiply};V=V.textureBuffer;const X=new Uint8Array(4),ba=new Uint32Array(X.buffer);let ha=0,ka=0,ia=0,ea=!1,ca=0;for(let Z=0;Z<H.count;Z++)Q(Z,aa),ha+=+(1>aa.externalColor[3]),ka+=+(aa.externalColorMixMode===
k.ColorMixModeEnum.Replace&&1===aa.externalColor[3]),ia+=+aa.castShadows,k.encodeSymbolColor(aa.externalColor,aa.externalColorMixMode,X),X[2]=X[2]&254|+aa.castShadows,V.setData(Y[Z],0,X[0],X[1],X[2],X[3]),ea=ea||0<Z&&ca!==ba[0],ca=ba[0],aa.pickable!==D.getVisibility(H.pickability,Z)&&(H.pickability=D.updateVisibilityWithCount(H.pickability,H.count,Z,aa.pickable));ea?(W.componentParameters=new A.ComponentParametersVarying,W.componentParameters.castShadows=K(ia,H.count),W.componentParameters.transparent=
K(ha,H.count),W.componentParameters.opaqueOverride=K(ka,H.count),W.componentParameters.texture=V,V.updateTexture()):(W.componentParameters=new A.ComponentParametersUniform,W.componentParameters.castShadows=aa.castShadows?A.ComponentParameterSummary.All:A.ComponentParameterSummary.None,W.componentParameters.externalColor=aa.externalColor,W.componentParameters.externalColorMixMode=aa.externalColorMixMode)}else W.componentParameters=new A.ComponentParametersUniform,W.componentParameters.castShadows=
Q.castShadows?A.ComponentParameterSummary.All:A.ComponentParameterSummary.None,W.componentParameters.externalColor=Q.externalColor,W.componentParameters.externalColorMixMode=Q.externalColorMixMode;this._notifyDirty()};S.getComponentAabb=function(H,Q,W){return H.intersectionGeometry.getComponentAabb(Q,W)};S.getComponentObb=function(H){return H.obb};S.getObjectTransform=function(H){return H.transform};S.getComponentPositions=function(H,Q,W){return H.intersectionGeometry.getComponentPositions(Q,W)};
S.intersect=function(H,Q,W,V,Y,aa){d.isSome(Y)&&(Y.localOrigin=H.transform.position);const X=x.invert(R,H.transform.rotationScale);l.sub(L,Q,H.transform.position);l.sub(N,W,H.transform.position);l.transformMat3(L,L,X);l.transformMat3(N,N,X);Q=x.transpose(R,X);return H.intersectionGeometry.intersect(L,N,V,Q,Y,aa)};S.addEdges=function(H,Q,W,V){const {indices:Y,positions:aa}=H.intersectionGeometry,X=H.components.offsets;return Q.addComponentObject(H,H.transform,{center:H.obb.center,radius:r.radius(H.obb)},
aa,Y,X,W,V)};S.addComponentHighlight=function(H,Q){H=H.components;d.isNone(H.highlightCounts)&&(H.highlightCounts=new Uint32Array(H.count+1));0===H.highlightCounts[Q]++&&(H.highlightsDirty(),this._notifyDirty());H.highlightCounts[H.count]++};S.removeComponentHighlight=function(H,Q){H=H.components;if(d.isNone(H.highlightCounts))M.warn("Removing non-existing highlight.");else{var W=H.highlightCounts[Q],V=H.highlightCounts[H.count];0===W?M.warn("Removing non-existing highlight."):1<W?(H.highlightCounts[Q]=
W-1,H.highlightCounts[H.count]=V-1):(H.highlightCounts[Q]=0,H.highlightsDirty(),this._notifyDirty(),1===V?H.highlightCounts=null:H.highlightCounts[H.count]=V-1)}};S.clearHighlights=function(H){H=H.components;d.isSome(H.highlightCounts)&&(H.highlightCounts=null,H.highlightsDirty(),this._notifyDirty())};S.getObjectGPUMemoryUsage=function(H){return H.renderable.meta.gpuMemoryEstimate};S._createRenderable=function(H,Q){const W=this._renderManager.rctx;var V=H.geometry,Y=V.vertices.layoutParameters,aa=
I.BufferObject.createVertex(W,O.Usage.STATIC_DRAW,V.vertices.data);const X=d.applySome(V.indices,ea=>I.BufferObject.createIndex(W,O.Usage.STATIC_DRAW,ea));var ba=y.glLayout(B.createVertexBufferLayout(Y)),ha=new Uint16Array(V.vertices.count);for(var ka=0;ka<Q.count;ka++){var ia=Q.offsets[ka];const ea=Q.offsets[ka+1],ca=Q.materialDataIndices[ka];if(d.isSome(V.indices))for(;ia<ea;ia++)ha[V.indices[ia]]=ca;else for(;ia<ea;ia++)ha[ia]=ca}V=I.BufferObject.createVertex(W,O.Usage.STATIC_DRAW,ha.buffer);ha=
new C.TwoVectorPosition(H.transform.position);ka=w.clone(H.transform.rotationScale);x.invert(ka,ka);x.transpose(ka,ka);Q=new E.ComponentDrawParameters;l.copy(Q.transformWorldFromModelTL,ha.low);l.copy(Q.transformWorldFromModelTH,ha.high);x.copy(Q.transformWorldFromModelRS,H.transform.rotationScale);x.copy(Q.transformNormalGlobalFromModel,ka);f.copy(Q.toMapSpace,H.toMapSpace);H=new A.ComponentMaterial;ba=new P.VertexArrayObject(W,H.attributeLocations,{data:ba,componentIndices:U},{data:aa,componentIndices:V},
d.unwrap(X));Y=new z.RenderGeometry(ba,O.PrimitiveType.TRIANGLES,Y,d.isSome(X));aa={cameraDepthSquared:.5,gpuMemoryEstimate:aa.byteSize+V.byteSize+(d.isSome(X)?X.byteSize:0)};return new q.Renderable(H,Q,Y,aa)};S._notifyDirty=function(){this._renderManager.notifyDirty()};b._createClass(T,[{key:"visibleObjects",get:function(){return this._objects[m.State.Visible]}}]);return T}();const U=y.glLayout(p.newLayout().u16(G.VertexAttribute.COMPONENTINDEX)),R=w.create(),L=n.create(),N=n.create();a.ComponentObjectCollection=
c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/orientedBoundingBox":function(){define("exports ../../../chunks/mat3 ../../../chunks/mat3f64 ../../../chunks/quat ../../../chunks/quatf32 ../../../chunks/quatf64 ../../../chunks/vec3 ../../../chunks/vec3f32 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/plane ./dito".split(" "),function(a,b,c,d,g,x,w,l,n,f,e,k,r,y){function p(E=[0,0,0],
C=[-1,-1,-1],D=[0,0,0,1]){return{center:n.clone(E),halfSize:l.clone(C),quaternion:g.clone(D)}}function h(E,C){const D=r.signedDistance(C,E.center);E=m(E,r.normal(C));return D>E?1:D<-E?-1:0}function m(E,C){d.conjugate(u,E.quaternion);w.transformQuat(t,C,u);E=E.halfSize;return Math.abs(t[0]*E[0])+Math.abs(t[1]*E[1])+Math.abs(t[2]*E[2])}const u=x.create(),t=n.create(),q=n.create(),z=e.create(),v=c.create(),B=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],A=(()=>{const E=new Int8Array(162);let C=0;const D=F=>
{for(let G=0;G<F.length;G++)E[C+G]=F[G];C+=6};D([6,2,3,1,5,4]);D([0,2,3,1,5,4]);D([0,2,3,7,5,4]);D([0,1,3,2,6,4]);D([0,1,3,2,0,0]);D([0,1,5,7,3,2]);D([0,1,3,7,6,4]);D([0,1,3,7,6,2]);D([0,1,5,7,6,2]);D([0,1,5,4,6,2]);D([0,1,5,4,0,0]);D([0,1,3,7,5,4]);D([0,2,6,4,0,0]);D([0,0,0,0,0,0]);D([1,3,7,5,0,0]);D([2,3,7,6,4,0]);D([2,3,7,6,0,0]);D([2,3,1,5,7,6]);D([0,1,5,7,6,2]);D([0,1,5,7,6,4]);D([0,1,3,7,6,4]);D([4,5,7,6,2,0]);D([4,5,7,6,0,0]);D([4,5,1,3,7,6]);D([0,2,3,7,5,4]);D([6,2,3,7,5,4]);D([6,2,3,1,5,
4]);return E})();a.ObbArray=function(E){this.buffer=new ArrayBuffer(56*E);this.obbs=Array(E);for(let C=0;C<E;C++)this.obbs[C]={center:n.createView(this.buffer,56*C),halfSize:l.createView(this.buffer,56*C+24),quaternion:g.createView(this.buffer,56*C+36)}};a.clone=function(E){return p(E.center,E.halfSize,E.quaternion)};a.compute=function(E,C){C=C||p();y.computeOBB(E,C);return C};a.corners=function(E,C){for(let D=0;8>D;++D){const F=C[D];F[0]=D&1?-E.halfSize[0]:E.halfSize[0];F[1]=D&2?-E.halfSize[1]:E.halfSize[1];
F[2]=D&4?-E.halfSize[2]:E.halfSize[2];w.transformQuat(F,F,E.quaternion);w.add(F,F,E.center)}};a.create=p;a.intersectLine=function(E,C,D,F=0){d.conjugate(u,E.quaternion);w.subtract(t,C,E.center);C=w.transformQuat(t,t,u);D=w.transformQuat(q,D,u);let G=-Infinity,J=Infinity;for(let I=0;3>I;I++)if(1E-6<Math.abs(D[I])){const O=(F+E.halfSize[I]-C[I])/D[I],P=(-F-E.halfSize[I]-C[I])/D[I];G=Math.max(G,Math.min(O,P));J=Math.min(J,Math.max(O,P))}else if(C[I]>E.halfSize[I]+F||C[I]<-E.halfSize[I]-F)return!1;return G<=
J};a.intersectPlane=h;a.isVisible=function(E,C){return 0>=h(E,C[0])&&0>=h(E,C[1])&&0>=h(E,C[2])&&0>=h(E,C[3])&&0>=h(E,C[4])&&0>=h(E,C[5])};a.maximumDistancePlane=function(E,C){const D=r.signedDistance(C,E.center);E=m(E,r.normal(C));return D+E};a.minimumDistancePlane=function(E,C){const D=r.signedDistance(C,E.center);E=m(E,r.normal(C));return D-E};a.projectedArea=function(E,C,D,F,G){d.conjugate(u,E.quaternion);w.sub(t,C,E.center);w.transformQuat(t,t,u);var J=t[0]<-E.halfSize[0]?-1:t[0]>E.halfSize[0]?
1:0,I=t[1]<-E.halfSize[1]?-1:t[1]>E.halfSize[1]?1:0,O=t[2]<-E.halfSize[2]?-1:t[2]>E.halfSize[2]?1:0;C=Math.abs(J)+Math.abs(I)+Math.abs(O);if(0===C)return Infinity;C=1===C?4:6;J=6*(J+3*I+9*O+13);b.fromQuat(v,E.quaternion);b.scale(v,v,E.halfSize);for(I=0;I<C;I++)O=A[J+I],w.set(t,((O&1)<<1)-1,(O&2)-1,((O&4)>>1)-1),w.transformMat3(t,t,v),w.add(z,E.center,t),z[3]=1,f.transformMat4(z,z,D),O=1/Math.max(1E-6,z[3]),B[2*I]=z[0]*O,B[2*I+1]=z[1]*O;E=2*C-2;D=B[0]*(B[3]-B[E+1])+B[E]*(B[1]-B[E-1]);for(C=2;C<E;C+=
2)D+=B[C]*(B[C+3]-B[C-1]);return Math.abs(D)*F*G*.125};a.projectedRadius=m;a.radius=function(E){return w.len(E.halfSize)};a.set=function(E,C){w.copy(C.center,E.center);w.copy(C.halfSize,E.halfSize);d.copy(C.quaternion,E.quaternion)};a.toAaBoundingBox=function(E,C){C||(C=k.create());var D=b.fromQuat(v,E.quaternion);const F=E.halfSize[0]*Math.abs(D[0])+E.halfSize[1]*Math.abs(D[3])+E.halfSize[2]*Math.abs(D[6]),G=E.halfSize[0]*Math.abs(D[1])+E.halfSize[1]*Math.abs(D[4])+E.halfSize[2]*Math.abs(D[7]);D=
E.halfSize[0]*Math.abs(D[2])+E.halfSize[1]*Math.abs(D[5])+E.halfSize[2]*Math.abs(D[8]);C[0]=E.center[0]-F;C[1]=E.center[1]-G;C[2]=E.center[2]-D;C[3]=E.center[0]+F;C[4]=E.center[1]+G;C[5]=E.center[2]+D;return C};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/quatf32":function(){define(["exports"],function(a){function b(){const w=new Float32Array(4);w[3]=1;return w}function c(w){const l=new Float32Array(4);l[0]=w[0];l[1]=w[1];l[2]=w[2];l[3]=w[3];return l}function d(w,l,n,f){const e=
new Float32Array(4);e[0]=w;e[1]=l;e[2]=n;e[3]=f;return e}function g(w,l){return new Float32Array(w,l,4)}const x=Object.freeze({__proto__:null,create:b,clone:c,fromValues:d,createView:g});a.clone=c;a.create=b;a.createView=g;a.fromValues=d;a.quatf32=x})},"esri/views/3d/support/dito":function(){define(["exports"],function(a){function b(V,Y,aa,X,ba,ha){if(!(1E-6>Y[0]*Y[0]+Y[1]*Y[1]+Y[2]*Y[2]))for(k(D,aa,Y),k(F,X,Y),k(G,ba,Y),c(V,Y,C),I[1]=C[0],J[1]=C[1],O[1]=J[1]-I[1],aa=[aa,X,ba],X=[D,F,G],ba=0;3>ba;++ba){c(V,
aa[ba],C);I[0]=C[0];J[0]=C[1];c(V,X[ba],C);I[2]=C[0];J[2]=C[1];O[0]=J[0]-I[0];O[2]=J[2]-I[2];const ka=w(O);ka<ha.quality&&(e(ha.b0,aa[ba]),e(ha.b1,Y),e(ha.b2,X[ba]),ha.quality=ka)}}function c(V,Y,aa){const {data:X,size:ba}=V;aa[0]=Number.POSITIVE_INFINITY;aa[1]=Number.NEGATIVE_INFINITY;for(V=0;V<X.length;V+=ba){const ha=X[V]*Y[0]+X[V+1]*Y[1]+X[V+2]*Y[2];aa[0]=Math.min(aa[0],ha);aa[1]=Math.max(aa[1],ha)}}function d(V,Y,aa){e(aa.center,V);f(aa.halfSize,Y,.5);aa.quaternion[0]=0;aa.quaternion[1]=0;aa.quaternion[2]=
0;aa.quaternion[3]=1}function g(V,Y,aa,X,ba,ha){c(V,Y,C);ba[0]=C[0];ha[0]=C[1];c(V,aa,C);ba[1]=C[0];ha[1]=C[1];c(V,X,C);ba[2]=C[0];ha[2]=C[1]}function x(V,Y,aa,X,ba,ha,ka){S[0]=V[0];S[1]=V[1];S[2]=V[2];S[3]=Y[0];S[4]=Y[1];S[5]=Y[2];S[6]=aa[0];S[7]=aa[1];S[8]=aa[2];var ia=ka.quaternion,ea=S,ca=ea[0]+ea[4]+ea[8];if(0<ca)ca=Math.sqrt(ca+1),ia[3]=.5*ca,ca=.5/ca,ia[0]=(ea[5]-ea[7])*ca,ia[1]=(ea[6]-ea[2])*ca,ia[2]=(ea[1]-ea[3])*ca;else{ca=0;ea[4]>ea[0]&&(ca=1);ea[8]>ea[3*ca+ca]&&(ca=2);const Z=(ca+1)%3,
fa=(ca+2)%3;let ja=Math.sqrt(ea[3*ca+ca]-ea[3*Z+Z]-ea[3*fa+fa]+1);ia[ca]=.5*ja;ja=.5/ja;ia[3]=(ea[3*Z+fa]-ea[3*fa+Z])*ja;ia[Z]=(ea[3*Z+ca]+ea[3*ca+Z])*ja;ia[fa]=(ea[3*fa+ca]+ea[3*ca+fa])*ja}l(H,X,ba);f(H,H,.5);f(ka.center,V,H[0]);f(T,Y,H[1]);l(ka.center,ka.center,T);f(T,aa,H[2]);l(ka.center,ka.center,T);f(ka.halfSize,ha,.5)}function w(V){return V[0]*V[1]+V[0]*V[2]+V[1]*V[2]}function l(V,Y,aa){V[0]=Y[0]+aa[0];V[1]=Y[1]+aa[1];V[2]=Y[2]+aa[2]}function n(V,Y,aa){V[0]=Y[0]-aa[0];V[1]=Y[1]-aa[1];V[2]=Y[2]-
aa[2]}function f(V,Y,aa){V[0]=Y[0]*aa;V[1]=Y[1]*aa;V[2]=Y[2]*aa}function e(V,Y,aa=0){V[0]=Y[aa+0];V[1]=Y[aa+1];V[2]=Y[aa+2]}function k(V,Y,aa){const X=Y[0],ba=Y[1];Y=Y[2];const ha=aa[0],ka=aa[1];aa=aa[2];V[0]=ba*aa-Y*ka;V[1]=Y*ha-X*aa;V[2]=X*ka-ba*ha}function r(V,Y){var aa=Y[0]*Y[0]+Y[1]*Y[1]+Y[2]*Y[2];0<aa&&(aa=1/Math.sqrt(aa),V[0]=Y[0]*aa,V[1]=Y[1]*aa,V[2]=Y[2]*aa)}function y(V,Y){const aa=Y[0]-V[0],X=Y[1]-V[1];V=Y[2]-V[2];return aa*aa+X*X+V*V}const p=[0,0,0],h=[0,0,0],m=[0,0,0],u=[0,0,0],t=[0,
0,0],q=[0,0,0],z=[0,0,0],v=[0,0,0],B=[0,0,0],A=[0,0,0],E=[0,0,0],C=[0,0],D=[0,0,0],F=[0,0,0],G=[0,0,0],J=[0,0,0],I=[0,0,0],O=[0,0,0],P=[0,0,0],K=[0,0,0],M=[0,0,0],U=[0,0,0],R=[0,0,0],L=[0,0,0],N=[0,0,0],T=[0,0,0],S=[1,0,0,0,1,0,0,0,1],H=[0,0,0];let Q=function(V){this.minVert=Array(7);this.maxVert=Array(7);this.buffer=new ArrayBuffer(448);var Y=0;this.minProj=new Float64Array(this.buffer,Y,7);Y+=56;this.maxProj=new Float64Array(this.buffer,Y,7);Y+=56;for(var aa=0;7>aa;++aa)this.minVert[aa]=new Float64Array(this.buffer,
Y,3),Y+=24;for(aa=0;7>aa;++aa)this.maxVert[aa]=new Float64Array(this.buffer,Y,3),Y+=24;for(Y=0;7>Y;++Y)this.minProj[Y]=Number.POSITIVE_INFINITY,this.maxProj[Y]=Number.NEGATIVE_INFINITY;Y=Array(7);aa=Array(7);const {data:X,size:ba}=V;for(V=0;V<X.length;V+=ba){var ha=X[V];ha<this.minProj[0]&&(this.minProj[0]=ha,Y[0]=V);ha>this.maxProj[0]&&(this.maxProj[0]=ha,aa[0]=V);ha=X[V+1];ha<this.minProj[1]&&(this.minProj[1]=ha,Y[1]=V);ha>this.maxProj[1]&&(this.maxProj[1]=ha,aa[1]=V);ha=X[V+2];ha<this.minProj[2]&&
(this.minProj[2]=ha,Y[2]=V);ha>this.maxProj[2]&&(this.maxProj[2]=ha,aa[2]=V);ha=X[V]+X[V+1]+X[V+2];ha<this.minProj[3]&&(this.minProj[3]=ha,Y[3]=V);ha>this.maxProj[3]&&(this.maxProj[3]=ha,aa[3]=V);ha=X[V]+X[V+1]-X[V+2];ha<this.minProj[4]&&(this.minProj[4]=ha,Y[4]=V);ha>this.maxProj[4]&&(this.maxProj[4]=ha,aa[4]=V);ha=X[V]-X[V+1]+X[V+2];ha<this.minProj[5]&&(this.minProj[5]=ha,Y[5]=V);ha>this.maxProj[5]&&(this.maxProj[5]=ha,aa[5]=V);ha=X[V]-X[V+1]-X[V+2];ha<this.minProj[6]&&(this.minProj[6]=ha,Y[6]=
V);ha>this.maxProj[6]&&(this.maxProj[6]=ha,aa[6]=V)}for(V=0;7>V;++V)ha=Y[V],e(this.minVert[V],X,ha),ha=aa[V],e(this.maxVert[V],X,ha)},W=function(){this.b0=[1,0,0];this.b1=[0,1,0];this.b2=[0,0,1];this.quality=0};a.computeOBB=function(V,Y){const {data:aa,size:X}=V;var ba=aa.length/X;if(!(0>=ba)){var ha=new Q(V);l(p,ha.minProj,ha.maxProj);f(p,p,.5);n(h,ha.maxProj,ha.minProj);var ka=w(h),ia=new W;ia.quality=ka;14>ba&&(V={data:new Float64Array(ha.buffer,112,42),size:3});var ea=[0,0,0],ca=[0,0,0],Z=[0,
0,0];ba=[0,0,0];var fa=[0,0,0],ja=[0,0,0],la=[0,0,0];var ma=V;var ra=y(ha.maxVert[0],ha.minVert[0]),va=0;for(var ya=1;7>ya;++ya){const za=y(ha.maxVert[ya],ha.minVert[ya]);za>ra&&(ra=za,va=ya)}e(ea,ha.minVert[va]);e(ca,ha.maxVert[va]);if(1E-6>y(ea,ca))ma=1;else{n(ba,ea,ca);r(ba,ba);{const {data:za,size:pa}=ma;ha=Number.NEGATIVE_INFINITY;ra=0;for(va=0;va<za.length;va+=pa)E[0]=za[va]-ea[0],E[1]=za[va+1]-ea[1],E[2]=za[va+2]-ea[2],ya=ba[0]*E[0]+ba[1]*E[1]+ba[2]*E[2],ya=E[0]*E[0]+E[1]*E[1]+E[2]*E[2]-ya*
ya/(ba[0]*ba[0]+ba[1]*ba[1]+ba[2]*ba[2]),ya>ha&&(ha=ya,ra=va);e(Z,za,ra)}1E-6>ha?ma=2:(n(fa,ca,Z),r(fa,fa),n(ja,Z,ea),r(ja,ja),k(la,fa,ba),r(la,la),b(ma,la,ba,fa,ja,ia),ma=0)}switch(ma){case 1:d(p,h,Y);return;case 2:ka=V;e(K,ba);Math.abs(ba[0])>Math.abs(ba[1])&&Math.abs(ba[0])>Math.abs(ba[2])?K[0]=0:Math.abs(ba[1])>Math.abs(ba[2])?K[1]=0:K[2]=0;1E-6>K[0]*K[0]+K[1]*K[1]+K[2]*K[2]&&(K[0]=K[1]=K[2]=1);k(M,ba,K);r(M,M);k(U,ba,M);r(U,U);g(ka,ba,M,U,R,L);n(N,L,R);x(ba,M,U,R,L,N,Y);return}ma=V;{ha=C;const {data:za,
size:pa}=ma;e(u,za);e(m,u);ha[0]=P[0]*la[0]+P[1]*la[1]+P[2]*la[2];ha[1]=ha[0];for(ra=pa;ra<za.length;ra+=pa)va=za[ra]*la[0]+za[ra+1]*la[1]+za[ra+2]*la[2],va<ha[0]&&(ha[0]=va,e(u,za,ra)),va>ha[1]&&(ha[1]=va,e(m,za,ra))}la=ea[0]*la[0]+ea[1]*la[1]+ea[2]*la[2];C[1]-1E-6<=la&&(m[0]=void 0);C[0]+1E-6>=la&&(u[0]=void 0);void 0!==m[0]&&(n(t,m,ea),r(t,t),n(q,m,ca),r(q,q),n(z,m,Z),r(z,z),k(v,q,ba),r(v,v),k(B,z,fa),r(B,B),k(A,t,ja),r(A,A),b(ma,v,ba,q,t,ia),b(ma,B,fa,z,q,ia),b(ma,A,ja,t,z,ia));void 0!==u[0]&&
(n(t,u,ea),r(t,t),n(q,u,ca),r(q,q),n(z,u,Z),r(z,z),k(v,q,ba),r(v,v),k(B,z,fa),r(B,B),k(A,t,ja),r(A,A),b(ma,v,ba,q,t,ia),b(ma,B,fa,z,q,ia),b(ma,A,ja,t,z,ia));g(V,ia.b0,ia.b1,ia.b2,R,L);V=[0,0,0];n(V,L,R);ia.quality=w(V);ia.quality<ka?x(ia.b0,ia.b1,ia.b2,R,L,V,Y):d(p,h,Y)}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/ComponentData":function(){define(["../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../../../../../core/typedArrayUtil",
"./IndexRange/ComponentRangeRunLengthEncoded","../../lib/AutoDisposable"],function(a,b,c,d,g){function x(w,l,n){const f=[],e=[];let k=n.length,r=n.length;l.forEachComponent(y=>{0<w[y]?(k!==y-1&&(f.length&&f.push(n[k+1]-f[f.length-1]),f.push(n[y])),k=y):(r!==y-1&&(e.length&&e.push(n[r+1]-e[e.length-1]),e.push(n[y])),r=y);return!0});f.length&&f.push(n[k+1]-f[f.length-1]);e.length&&e.push(n[r+1]-e[e.length-1]);return{highlightRanges:f,defaultRanges:e}}return function(w){function l(f,e){var k=w.call(this)||
this;k.pickability=null;k.highlightCounts=null;k.cachedGeometryRanges=null;k.cachedHighlightRanges=null;k.cachedDefaultRanges=null;k.offsets=c.slice(e);e=k.count;k.visibility=new d.ComponentRangeRunLengthEncoded(e);k.materialDataBuffer=f.getBuffer(e);k.materialDataIndices=new Uint16Array(e);for(f=0;f<e;f++)k.materialDataIndices[f]=k.materialDataBuffer.acquireIndex();return k}a._inheritsLoose(l,w);var n=l.prototype;n.dispose=function(){w.prototype.dispose.call(this);for(let f=0;f<this.count;f++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[f])};
n.highlightsDirty=function(){this.cachedDefaultRanges=this.cachedHighlightRanges=null};n.visibilityDirty=function(){this.cachedGeometryRanges=null;this.highlightsDirty()};n._updateCachedHighlightRanges=function(){if((b.isNone(this.cachedHighlightRanges)||b.isNone(this.cachedDefaultRanges))&&b.isSome(this.highlightCounts)){const {highlightRanges:f,defaultRanges:e}=x(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=f;this.cachedDefaultRanges=e}};a._createClass(l,[{key:"count",
get:function(){return this.offsets.length-1}},{key:"geometryRanges",get:function(){b.isNone(this.cachedGeometryRanges)&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets));return this.cachedGeometryRanges}},{key:"highlightRanges",get:function(){if(b.isNone(this.highlightCounts))return null;this._updateCachedHighlightRanges();return this.cachedHighlightRanges}},{key:"defaultShadowMapRanges",get:function(){if(b.isNone(this.highlightCounts))return this.geometryRanges;this._updateCachedHighlightRanges();
return this.cachedDefaultRanges}}]);return l}(g.AutoDisposable)})},"esri/views/3d/webgl-engine/collections/Component/IndexRange/ComponentRangeRunLengthEncoded":function(){define(["exports"],function(a){let b=function(){function c(g){this._totalCount=g;this._indexRanges=[0,g]}var d=c.prototype;d.componentCount=function(){const g=this._indexRanges;let x=0;for(let w=0;w<g.length;w+=2)x+=g[w+1];return x};d.reset=function(g){if("all"===g||g.length===this._totalCount)this._indexRanges=[0,this._totalCount];
else{{const l=[];if(0!==g.length){var x=g[0],w=1;for(let n=1;n<g.length;n++){const f=g[n];x+w===f?w+=1:(l.push(x),l.push(w),x=f,w=1)}l.push(x);l.push(w)}g=l}this._indexRanges=g}};d.forEachComponent=function(g){const x=this._indexRanges;for(let l=0;l<x.length;l+=2){var w=x[l];const n=w+x[l+1];for(;w<n;w++)if(!g(w))return!1}return!0};d.forEachComponentRange=function(g){const x=this._indexRanges;for(let w=0;w<x.length;w+=2){const l=x[w];if(!g(l,l+x[w+1]))return!1}return!0};d.computeOffsetRanges=function(g){const x=
Array(this._indexRanges.length),w=this._indexRanges;for(let n=0;n<w.length;n+=2){var l=w[n];const f=g[l];l=g[l+w[n+1]];x[n]=f;x[n+1]=l-f}return x};return c}();a.ComponentRangeRunLengthEncoded=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/ComponentObject":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/tslib.es6","../../lib/AutoDisposable"],function(a,b,c,d){let g=function(x){function w(){var l=
x.apply(this,arguments)||this;l.visible=a.State.Hidden;return l}b._inheritsLoose(w,x);return w}(d.AutoDisposable);c.__decorate([d.autoDispose()],g.prototype,"renderable",void 0);c.__decorate([d.autoDispose()],g.prototype,"components",void 0);a.State=void 0;(function(x){x[x.Hidden=0]="Hidden";x[x.Visible=1]="Visible"})(a.State||(a.State={}));a.ComponentObject=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/interface":function(){define(["exports"],
function(a){a.isVaryingComponentParameters=function(b){return"function"===typeof b};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/IntersectionGeometry":function(){define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/aaBoundingBox ../../../../../geometry/support/buffer/BufferView ./ComponentIntersectionData ../../lib/ComponentUtils ../../lib/geometryDataUtils ../../materials/internal/MaterialUtil".split(" "),
function(a,b,c,d,g,x,w,l,n,f){let e=function(){function y(h,m){this._indices=b.isSome(h.indices)?h.indices:n.generateDefaultIndexArray(h.positions.length/3);this._positions=new x.BufferViewVec3f(h.positions);this._components=m;this._componentIntersectionData=Array(m.count)}var p=y.prototype;p.getComponentAabb=function(h,m){if(b.isSome(this._perComponentAabbs)){for(let u=0;6>u;u++)m[u]=this._perComponentAabbs[6*h+u];return m}this._computePerComponentAabbs();return this.getComponentAabb(h,m)};p.getComponentPositions=
function(h,m){m.indices=this._indices;m.data=this._positions.typedBuffer;m.stride=this._positions.typedBufferStride;m.startIndex=this._components.offsets[h];m.endIndex=this._components.offsets[h+1]};p.intersect=function(h,m,u,t,q,z){const v={data:this._positions.typedBuffer,stride:this._positions.typedBufferStride,size:3},B=this._indices,A=this._components.offsets,E=f.computeInvDir(h,m,k);this._components.visibility.forEachComponent(C=>{if(!l.getVisibility(this._components.pickability,C))return!0;
var D=this.getComponentAabb(C,r);b.isSome(q)&&q.applyToAabb(D);if(!f.intersectAabbInvDir(D,h,E,u))return!0;D=A[C]/3;const F=A[C+1]/3,G=(I,O,P)=>{z(C,I,c.transformMat3(O,O,t),P)},J=F-D;b.isNone(q)&&J>w.componentMinimalSizeForIntersectionData?(null==this._componentIntersectionData[C]&&(this._componentIntersectionData[C]=new w.ComponentIntersectionData(this._indices,D,F,v)),this._componentIntersectionData[C].intersectRay({r0:h,r1:m},G)):f.intersectTriangles(h,m,D,F,B,v,void 0,q,G);return!0})};p._computePerComponentAabbs=
function(){const h=this._components.count;this._perComponentAabbs=new Float32Array(6*h);for(let m=0;m<h;m++)this._computeAABB(m)};p._computeAABB=function(h){const m=this._indices,u=this._positions;var t=this._components.offsets,q=t[h];const z=t[h+1],v=[0,0,0];t=[Infinity,Infinity,Infinity];const B=[-Infinity,-Infinity,-Infinity];for(;q<z;q++)u.getVec(m[q],v),c.min(t,t,v),c.max(B,B,v);h*=6;this._perComponentAabbs[h++]=t[0];this._perComponentAabbs[h++]=t[1];this._perComponentAabbs[h++]=t[2];this._perComponentAabbs[h++]=
B[0];this._perComponentAabbs[h++]=B[1];this._perComponentAabbs[h]=B[2]};a._createClass(y,[{key:"positions",get:function(){return this._positions}},{key:"indices",get:function(){return this._indices}}]);return y}();const k=d.create(),r=g.create();return e})},"esri/views/3d/webgl-engine/lib/ComponentUtils":function(){define(["exports"],function(a){function b(c=!0){return{isVisibleBit:!c,data:new Uint32Array(0)}}a.defaultVisibilities=b;a.getVisibility=function(c,d){if(null==c)return!0;const {isVisibleBit:g,
data:x}=c,w=8*x.BYTES_PER_ELEMENT;return d<x.length*w?(c=d/w|0,d=0!==(x[c]&1<<d-c*w)===g):!c.isVisibleBit};a.updateVisibilityWithCount=function(c,d,g,x){if(g>=d)return c;null==c&&(c=b());let w=c.data;const l=8*w.BYTES_PER_ELEMENT,n=g/l|0,f=g-l*n,e=w;x=x===c.isVisibleBit;g<e.length*l||!x||(g=Math.max(n+1,Math.ceil(1.5*e.length)),g=Math.min(g,((d-1)/l|0)+1),w=new Uint32Array(g),w.set(e));n<w.length&&(w[n]=w[n]&~(1<<f)|(x?1:0)<<f);c.data=w;return c};Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/webgl-engine/collections/Component/Renderable":function(){define(["exports"],function(a){let b=function(){function c(d,g,x,w){this.material=d;this.drawParameters=g;this.geometry=x;this.meta=w}c.prototype.dispose=function(){this.material.dispose();this.geometry.dispose()};return c}();a.Renderable=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/RenderGeometry":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers",
"../../../../../chunks/tslib.es6","../../lib/AutoDisposable"],function(a,b,c,d){let g=function(x){function w(l,n,f,e){var k=x.call(this)||this;k.primitiveType=n;k.parameters=f;k.indexed=e;k.vao=l;return k}b._inheritsLoose(w,x);return w}(d.AutoDisposable);c.__decorate([d.autoDispose()],g.prototype,"vao",void 0);a.RenderGeometry=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/RenderSubmitSystem":function(){define(["exports","./DepthRange"],function(a,
b){let c=function(){function d(x){this._objects=x}var g=d.prototype;g.submit=function(x,w){this._objects.preSubmit(w);this._objects.visibleObjects.forAll(l=>l.renderable.material.submit(x,l))};g.queryShadowCasterDepthRange=function(x){return this._objects.visibleObjects.length?b.computeDepthRange(x,this._objects.visibleObjects):null};return d}();a.RenderSubmitSystem=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/DepthRange":function(){define("exports ../../../../../core/PooledArray ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/quat ../../../../../chunks/quatf64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/plane ../../../support/orientedBoundingBox ../../lib/depthRange".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e){function k(G,J,I){return w.set(G,J.data[I+0],J.data[I+1],J.data[I+2])}function r(G,J){G.push(J[0]);G.push(J[1]);G.push(J[2])}function y(G,J,I,O){g.conjugate(B,G.quaternion);w.sub(A,J,G.center);w.transformQuat(A,A,B);const P=8*((A[0]<-G.halfSize[0]?-1:A[0]>G.halfSize[0]?1:0)+3*(A[1]<-G.halfSize[1]?-1:A[1]>G.halfSize[1]?1:0)+9*(A[2]<-G.halfSize[2]?-1:A[2]>G.halfSize[2]?1:0)+13);J=z[P];if(0===J)return J;c.fromQuat(v,G.quaternion);c.scale(v,v,G.halfSize);const K=(M,U)=>
{U=z[P+U+1];w.set(M,((U&1)<<1)-1,(U&2)-1,((U&4)>>1)-1);w.transformMat3(M,M,v);return w.add(M,G.center,M)};I.length=0;r(I,K(E,0));r(I,K(C,1));r(I,K(A,2));r(I,K(D,3));O(I);if(1===J)return J;I.length=0;r(I,E);r(I,D);r(I,K(A,4));r(I,K(F,5));O(I);if(2===J)return J;I.length=0;r(I,E);r(I,F);r(I,K(A,6));r(I,C);O(I);return J}const p=new b({allocator:G=>G||{near:Infinity,far:-Infinity,mask:0,object:null},deallocator:G=>{G.object=null;return G}}),h=e.empty(),m=l.create(),u=l.create(),t=new b({deallocator:null}),
q=new b({deallocator:null}),z=(()=>{const G=new Int8Array(216);let J=0;const I=O=>{for(let P=0;P<O.length;P++)G[J+P]=O[P];J+=8};I([3,0,6,2,3,1,5,4]);I([2,0,2,3,1,5,4,0]);I([3,1,0,2,3,7,5,4]);I([2,0,1,3,2,6,4,0]);I([1,0,1,3,2,0,0,0]);I([2,1,5,7,3,2,0,0]);I([3,2,0,1,3,7,6,4]);I([2,2,0,1,3,7,6,0]);I([3,3,0,1,5,7,6,2]);I([2,0,1,5,4,6,2,0]);I([1,0,1,5,4,0,0,0]);I([2,1,3,7,5,4,0,0]);I([1,0,2,6,4,0,0,0]);I([0,0,0,0,0,0,0,0]);I([1,1,3,7,5,0,0,0]);I([2,2,3,7,6,4,0,0]);I([1,2,3,7,6,0,0,0]);I([2,3,1,5,7,6,2,
0]);I([3,4,0,1,5,7,6,2]);I([2,5,7,6,4,0,1,0]);I([3,5,0,1,3,7,6,4]);I([2,4,5,7,6,2,0,0]);I([1,4,5,7,6,0,0,0]);I([2,5,1,3,7,6,4,0]);I([3,6,0,2,3,7,5,4]);I([2,6,2,3,7,5,4,0]);I([3,7,6,2,3,1,5,4]);return G})(),v=d.create(),B=x.create(),A=l.create(),E=l.create(),C=l.create(),D=l.create(),F=l.create();a.computeDepthRange=function(G,J){const I=e.empty(),{eye:O,frustum:P,viewForward:K}=G;J.forAll(M=>{var U=M.obb;const R=w.dot(w.sub(A,U.center,O),K),L=f.projectedRadius(U,K);if(!e.within(I,R-L)||!e.within(I,
R+L)){a:{var N=0;for(let T=0;4>T;T++){const S=f.intersectPlane(U,P[T]);if(0<S){U=-1;break a}0===S&&(N|=1<<T)}U=N}-1!==U&&(0===U?(h.far=R+L,h.near=R-L,e.union(I,h)):(N=p.pushNew(),N.near=R-L,N.far=R+L,N.mask=U,N.object=M))}});for(G=0;G<p.length;G++){const M=p.data[G];e.within(I,M.near)&&e.within(I,M.far)||(h.far=M.far,h.near=Infinity,0===y(M.object.obb,O,t,U=>{var R=q;for(var L=0;4>L&&0<U.length;L++)if(0!==(M.mask&1<<L)){{var N=P[L],T=U,S=R;S.length=0;const H=T.length-3;k(m,T,H);const Q=n.signedDistance(N,
m);0>=Q&&(S.push(m[0]),S.push(m[1]),S.push(m[2]));let W=0,V=Q;for(W;W<H;W+=3){k(u,T,W);const Y=n.signedDistance(N,u);0>V*Y&&(w.lerp(m,u,m,Y/(Y-V)),r(S,m));0>=Y&&r(S,u);V=Y;w.copy(m,u)}0>V*Q&&(k(u,T,H),w.lerp(m,u,m,Q/(Q-V)),r(S,m))}N=U;U=R;R=N}for(R=0;R<U.length;R+=3)w.set(m,U.data[R+0],U.data[R+1],U.data[R+2]),L=w.dot(w.sub(m,m,O),K),h.near=Math.min(h.near,L)})&&(h.near=0),e.union(I,h))}p.length=0;return I};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/depthRange":function(){define(["exports"],
function(a){function b(d,g){return{near:d,far:g}}function c(d,g,x){d.near=g;d.far=x;return d}a.ZERO={near:0,far:0};a.create=b;a.empty=function(d){return d?c(d,Infinity,-Infinity):b(Infinity,-Infinity)};a.set=c;a.union=function(d,g,x=d){x.near=Math.min(d.near,g.near);x.far=Math.max(d.far,g.far);return x};a.within=function(d,g){return d.near<=g&&g<=d.far};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/SourceGeometry":function(){define(["exports",
"../../../support/buffer/InterleavedLayout","../../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl","../../lib/VertexAttribute"],function(a,b,c,d){a.createVertexBufferLayout=function(g){const x=b.newLayout().vec3f(d.VertexAttribute.POSITION);g.normals&&x.vec2i16(d.VertexAttribute.NORMALCOMPRESSED,{glNormalized:!0});g.textureCoordinates===c.TextureCoordinateAttributeType.Default?x.vec2f(d.VertexAttribute.UV0):g.textureCoordinates===c.TextureCoordinateAttributeType.Atlas&&(x.vec2f(d.VertexAttribute.UV0),
x.vec4u16(d.VertexAttribute.UVREGION,{glNormalized:!0}));g.colors&&x.vec4u8(d.VertexAttribute.COLOR,{glNormalized:!0});return x.alignTo(4)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentMaterial":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/tslib.es6 ../../../../../../core/maybe ../../../../../../chunks/vec3 ../../../../../../chunks/vec3f32 ../../../../../../chunks/vec4 ../../../../../../chunks/vec4f32 ../../../../../../chunks/vec4f64 ../../../../layers/support/symbolColorUtils ./ComponentTechnique ./shader/ComponentData.glsl ../../../../../../chunks/ComponentShader.glsl ./shader/VertexDiscardByOpacity.glsl ../../../core/material/MaterialBase ../../../core/renderPasses/AllRenderPasses ../../../core/shaderLibrary/ShaderOutputOptions ../../../core/shaderLibrary/shading/Normals.glsl ../../../core/shaderLibrary/util/AlphaDiscard.glsl ../../../core/shaderLibrary/util/EllipsoidMode ../../../lib/basicInterfaces".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z){function v(D){switch(D){case h.MaterialSubPass.Color:return m.ShaderOutput.Color;case h.MaterialSubPass.Alpha:return m.ShaderOutput.Alpha;case h.MaterialSubPass.Depth:return m.ShaderOutput.Depth;case h.MaterialSubPass.Normal:return m.ShaderOutput.Normal}}let B=function(D){function F(){var J=D.apply(this,arguments)||this;J.baseColor=l.fromValues(1,1,1,1);J.usePBR=!1;J.hasParametersFromSource=!1;J.mrrFactors=x.fromValues(1,1,.5);J.emissiveFactor=x.fromValues(0,
0,0);J.baseColorTexture=null;J.metallicRoughnessTexture=null;J.emissionTexture=null;J.occlusionTexture=null;J.normalTexture=null;J.overlayTexOffset=n.fromValues(-1,-1,-1,-1);J.overlayTexScale=n.fromValues(0,0,0,0);J.overlayColor=null;J.overlayHighlight=null;J.overlayNormal=null;J.objectOpacity=1;J.commonMaterialParameters=new E;J.componentParameters=new C;J.alphaCutoff=t.defaultMaskAlphaCutoff;J.alphaDiscardMode=z.AlphaDiscardMode.Opaque;J.isIntegratedMesh=!1;J.polygonOffsetEnabled=!1;J.ellipsoidMode=
q.EllipsoidMode.Earth;J.sceneHasOcludees=!1;J._techniqueConfig=new e.ComponentTechniqueConfiguration;return J}b._inheritsLoose(F,D);var G=F.prototype;G.dispose=function(){this._technique=d.releaseMaybe(this._technique);this.normalTexture=this.occlusionTexture=this.emissionTexture=this.metallicRoughnessTexture=this.baseColorTexture=null};G.prepareTechnique=function(J,I,O){const P=this._techniqueConfig;P.hasVertexColors=O.colors;P.hasNormals=O.normals;P.vertexTextureCoordinates=O.textureCoordinates;
P.usePBR=this.usePBR;P.hasMetalnessAndRoughnessTexture=d.isSome(this.metallicRoughnessTexture);P.hasEmissionTexture=d.isSome(this.emissionTexture);P.hasOcclusionTexture=d.isSome(this.occlusionTexture);P.hasNormalTexture=d.isSome(this.normalTexture);P.transparencyPassType=I.identifier===h.RenderPassIdentifier.Material&&null!=I.transparencyPassType?I.transparencyPassType:z.TransparencyPassType.NONE;P.multipassTerrainEnabled=I.identifier===h.RenderPassIdentifier.Material&&null!=I.multipassTerrainParams?
I.multipassTerrainParams.multipassTerrainEnabled:!1;P.cullAboveGround=I.identifier===h.RenderPassIdentifier.Material&&null!=I.multipassTerrainParams?I.multipassTerrainParams.cullAboveGround:!1;P.ellipsoidMode=this.ellipsoidMode;this.dirty&&(P.componentData=this.componentParameters.type,P.cullFace=this.commonMaterialParameters.cullFace,P.doubleSidedMode=this.commonMaterialParameters.doubleSided?u.NormalsDoubleSidedMode.View:u.NormalsDoubleSidedMode.None,P.baseColorTexture=d.isSome(this.baseColorTexture),
P.isSchematic=this.hasParametersFromSource&&!d.isSome(this.baseColorTexture),O=this._computeWhichMaterialPass(),P.blendingEnabled=O===A.Transparent||O===A.OpaqueAndTransparent,P.alphaDiscardMode=this.alphaDiscardMode,P.integratedMeshMode=this.isIntegratedMesh?this.overlayColor?this.overlayNormal?e.IntegratedMeshMode.ColorOverlayWithWater:e.IntegratedMeshMode.ColorOverlay:e.IntegratedMeshMode.NoOverlay:e.IntegratedMeshMode.None,P.polygonOffsetEnabled=this.polygonOffsetEnabled,this._setClean());P.slicePlaneEnabled=
I.slicePlaneEnabled&&this.commonMaterialParameters.slicePlaneEnabled;I.identifier===h.RenderPassIdentifier.ShadowMap?(P.output=m.ShaderOutput.Shadow,P.vertexDiscardMode=y.VertexDiscardMode.None):I.identifier===h.RenderPassIdentifier.Highlight?(P.output=m.ShaderOutput.Highlight,P.vertexDiscardMode=y.VertexDiscardMode.None):(this._computeWhichMaterialPass()===A.OpaqueAndTransparent?P.vertexDiscardMode=I.transparent?y.VertexDiscardMode.Opaque:y.VertexDiscardMode.Transparent:P.vertexDiscardMode=y.VertexDiscardMode.None,
P.output=v(I.subPass),I.subPass===h.MaterialSubPass.Alpha&&(P.sceneHasOcludees=I.sceneHasOcludees),I.subPass===h.MaterialSubPass.Color?(P.receiveAmbientOcclusion=I.ambientOcclusionEnabled,P.sceneHasOcludees=I.sceneHasOcludees,P.receiveShadows=I.shadowsEnabled,P.ssrEnabled=I.ssrParams.ssrEnabled):(P.receiveAmbientOcclusion=!1,P.receiveShadows=!1));return this._technique=J.releaseAndAcquire(e.ComponentTechnique,P,this._technique)};G.submit=function(J,I){if(0!==this.objectOpacity){var O=I.renderable.geometry,
P=I.components,K=I.renderable.drawParameters;I=I.renderable.meta.cameraDepthSquared;var M=P.geometryRanges,U=P.highlightRanges;P=P.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case A.Opaque:J.materialOpaque.submitDraw(this,O,M,K,I);break;case A.Transparent:J.materialTransparent.submitDraw(this,O,M,K,I);break;case A.OpaqueAndTransparent:J.materialOpaque.submitDraw(this,O,M,K,I);J.materialTransparent.submitDraw(this,O,M,K,I);break;case A.IntegratedMesh:J.materialIntegratedMesh.submitDraw(this,
O,M,K,I),this.overlayHighlight&&J.highlightIntegratedMesh.submitDraw(this,O,M,K,I)}var R=this.componentParameters.castShadows!==a.ComponentParameterSummary.None;R&&J.shadowMap.submitDraw(this,O,M,K,I);d.isSome(U)&&(J.highlight.submitDraw(this,O,U,K,I),R&&J.highlightShadowMap.submitDraw(this,O,U,K,I));R&&d.isSome(P)&&J.defaultShadowMap.submitDraw(this,O,P,K,I)}};G._computeWhichMaterialPass=function(){return this.isIntegratedMesh?A.IntegratedMesh:1>this.objectOpacity?A.Transparent:this.componentParameters.opaqueOverride===
a.ComponentParameterSummary.All?A.Opaque:1>this.baseColor[3]||this.alphaDiscardMode===z.AlphaDiscardMode.Blend||this.alphaDiscardMode===z.AlphaDiscardMode.MaskBlend?A.Transparent:this.componentParameters.transparent===a.ComponentParameterSummary.None?A.Opaque:this.componentParameters.transparent===a.ComponentParameterSummary.All?A.Transparent:A.OpaqueAndTransparent};b._createClass(F,[{key:"attributeLocations",get:function(){return r.attributeLocations}}]);return F}(p.MaterialBase);c.__decorate([p.parameter({vectorOps:w.vec4})],
B.prototype,"baseColor",void 0);c.__decorate([p.parameter()],B.prototype,"usePBR",void 0);c.__decorate([p.parameter()],B.prototype,"hasParametersFromSource",void 0);c.__decorate([p.parameter({vectorOps:g.vec3})],B.prototype,"mrrFactors",void 0);c.__decorate([p.parameter({vectorOps:g.vec3})],B.prototype,"emissiveFactor",void 0);c.__decorate([p.parameter({dispose:!0})],B.prototype,"baseColorTexture",void 0);c.__decorate([p.parameter({dispose:!0})],B.prototype,"metallicRoughnessTexture",void 0);c.__decorate([p.parameter({dispose:!0})],
B.prototype,"emissionTexture",void 0);c.__decorate([p.parameter({dispose:!0})],B.prototype,"occlusionTexture",void 0);c.__decorate([p.parameter({dispose:!0})],B.prototype,"normalTexture",void 0);c.__decorate([p.parameter({vectorOps:{equals:w.exactEquals,copy:w.copy}})],B.prototype,"overlayTexOffset",void 0);c.__decorate([p.parameter({vectorOps:{equals:w.exactEquals,copy:w.copy}})],B.prototype,"overlayTexScale",void 0);c.__decorate([p.parameter()],B.prototype,"overlayColor",void 0);c.__decorate([p.parameter()],
B.prototype,"overlayHighlight",void 0);c.__decorate([p.parameter()],B.prototype,"overlayNormal",void 0);c.__decorate([p.parameter()],B.prototype,"objectOpacity",void 0);c.__decorate([p.parameterBlock()],B.prototype,"commonMaterialParameters",void 0);c.__decorate([p.parameterBlock()],B.prototype,"componentParameters",void 0);c.__decorate([p.parameter()],B.prototype,"alphaCutoff",void 0);c.__decorate([p.parameter()],B.prototype,"alphaDiscardMode",void 0);c.__decorate([p.parameter()],B.prototype,"isIntegratedMesh",
void 0);c.__decorate([p.parameter()],B.prototype,"polygonOffsetEnabled",void 0);c.__decorate([p.parameter()],B.prototype,"ellipsoidMode",void 0);c.__decorate([p.parameter()],B.prototype,"sceneHasOcludees",void 0);a.ShadingNormalSource=void 0;(function(D){D[D.VERTEX=0]="VERTEX";D[D.GROUND=1]="GROUND";D[D.SCREEN_DERIVATIVE=2]="SCREEN_DERIVATIVE"})(a.ShadingNormalSource||(a.ShadingNormalSource={}));var A;(function(D){D[D.Opaque=0]="Opaque";D[D.Transparent=1]="Transparent";D[D.OpaqueAndTransparent=2]=
"OpaqueAndTransparent";D[D.IntegratedMesh=3]="IntegratedMesh"})(A||(A={}));let E=function(D){function F(){var G=D.apply(this,arguments)||this;G.doubleSided=!1;G.cullFace=z.CullFaceOptions.Back;G.slicePlaneEnabled=!0;return G}b._inheritsLoose(F,D);return F}(p.MaterialParameterBlock);c.__decorate([p.parameter()],E.prototype,"doubleSided",void 0);c.__decorate([p.parameter()],E.prototype,"cullFace",void 0);c.__decorate([p.parameter()],E.prototype,"slicePlaneEnabled",void 0);let C=function(D){function F(){var G=
D.apply(this,arguments)||this;G.externalColor=l.fromValues(1,1,1,1);G.externalColorMixMode=f.ColorMixModeEnum.Multiply;G.castShadows=a.ComponentParameterSummary.All;return G}b._inheritsLoose(F,D);b._createClass(F,[{key:"transparent",get:function(){return 1>this.externalColor[3]?a.ComponentParameterSummary.All:a.ComponentParameterSummary.None}},{key:"opaqueOverride",get:function(){return this.externalColorMixMode===f.ColorMixModeEnum.Replace&&1===this.externalColor[3]?a.ComponentParameterSummary.All:
a.ComponentParameterSummary.None}},{key:"visible",get:function(){return 0<this.externalColor[3]?a.ComponentParameterSummary.All:a.ComponentParameterSummary.None}},{key:"type",get:function(){return k.ComponentDataType.Uniform}}]);return F}(p.MaterialParameterBlock);c.__decorate([p.parameter({vectorOps:w.vec4})],C.prototype,"externalColor",void 0);c.__decorate([p.parameter()],C.prototype,"externalColorMixMode",void 0);c.__decorate([p.parameter()],C.prototype,"castShadows",void 0);a.ComponentParameterSummary=
void 0;(function(D){D[D.All=0]="All";D[D.Some=1]="Some";D[D.None=2]="None"})(a.ComponentParameterSummary||(a.ComponentParameterSummary={}));g=function(D){function F(){var G=D.apply(this,arguments)||this;G.texture=null;G.transparent=a.ComponentParameterSummary.None;G.opaqueOverride=a.ComponentParameterSummary.None;G.castShadows=a.ComponentParameterSummary.None;return G}b._inheritsLoose(F,D);b._createClass(F,[{key:"type",get:function(){return k.ComponentDataType.Varying}}]);return F}(p.MaterialParameterBlock);
c.__decorate([p.parameter()],g.prototype,"texture",void 0);c.__decorate([p.parameter()],g.prototype,"transparent",void 0);c.__decorate([p.parameter()],g.prototype,"opaqueOverride",void 0);c.__decorate([p.parameter()],g.prototype,"castShadows",void 0);a.CommonMaterialParameters=E;a.ComponentMaterial=B;a.ComponentParametersUniform=C;a.ComponentParametersVarying=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentTechnique":function(){define("require exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/tslib.es6 ../../../../../../core/maybe ../../../../../../chunks/mat3f64 ../../../../../../chunks/vec4f64 ./shader/ComponentData.glsl ../../../../../../chunks/ComponentShader.glsl ./shader/VertexDiscardByOpacity.glsl ../../../core/renderPasses/AllRenderPasses ../../../core/shaderLibrary/ShaderOutputOptions ../../../core/shaderLibrary/Slice.glsl ../../../core/shaderLibrary/attributes/NormalAttribute.glsl ../../../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../../../core/shaderLibrary/attributes/VertexPosition.glsl ../../../core/shaderLibrary/output/OutputHighlight.glsl ../../../core/shaderLibrary/shading/Normals.glsl ../../../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../../core/shaderLibrary/shading/ScreenSpaceReflections.glsl ../../../core/shaderLibrary/util/DoublePrecision.glsl ../../../core/shaderLibrary/util/EllipsoidMode ../../../core/shaderTechnique/ReloadableShaderModule ../../../core/shaderTechnique/ShaderTechnique ../../../core/shaderTechnique/ShaderTechniqueConfiguration ../../../lib/basicInterfaces ../../../lib/OrderIndependentTransparency ../../../lib/Program ../../../lib/StencilUtils ../../../../../webgl/renderState".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E,C,D,F,G,J){A=function(I){function O(){return I.apply(this,arguments)||this}c._inheritsLoose(O,I);var P=O.prototype;P.bindPass=function(K){const M=this.program;h.bindViewProjTransform(M,K.viewTransform);r.bindSliceUniforms(this.program,this.configuration,K.slicePlane);K.identifier===e.RenderPassIdentifier.Material&&(void 0!==K.ssrParams&&q.bindSSRUniforms(this.program,K.ssrParams),M.setUniformMatrix3fv("transformNormalViewFromGlobal",K.transformNormalViewFromGlobal),
K.subPass===e.MaterialSubPass.Depth&&M.setUniform2fv("nearFar",K.nearFar),K.subPass===e.MaterialSubPass.Color&&K.lighting.setUniforms(this.program,K.integratedMesh,K.hasFillLights));K.identifier===e.RenderPassIdentifier.ShadowMap&&this.program.setUniform2fv("nearFar",K.nearFar)};P.bindMaterial=function(K,M){this._material=K;const U=this.program;U.setUniform4fv("baseColor",K.baseColor);U.setUniform1f("objectOpacity",K.objectOpacity);U.setUniform1f("textureAlphaCutoff",K.alphaCutoff);K.componentParameters.type===
l.ComponentDataType.Varying?K.componentParameters.texture.bind(U,"componentColorTex","componentColorTexInvDim"):(U.setUniform4fv("externalColor",K.componentParameters.externalColor),U.setUniform1i("externalColorMixMode",K.componentParameters.externalColorMixMode));g.isSome(K.baseColorTexture)&&K.baseColorTexture.bind(U,"baseColorTexture","baseColorTextureSize");if(this.configuration.output===k.ShaderOutput.Color||this.configuration.output===k.ShaderOutput.Alpha)t.bindPBRUniforms(this.program,K,this.configuration.isSchematic),
g.isSome(K.metallicRoughnessTexture)&&K.metallicRoughnessTexture.bind(U,"texMetallicRoughness","texMetallicRoughnessSize"),g.isSome(K.emissionTexture)&&K.emissionTexture.bind(U,"texEmission","texEmissionSize"),g.isSome(K.occlusionTexture)&&K.occlusionTexture.bind(U,"texOcclusion","texOcclusionSize"),g.isSome(K.normalTexture)&&K.normalTexture.bind(U,"normalTexture","normalTextureSize");K.isIntegratedMesh&&(M.identifier===e.RenderPassIdentifier.Material&&M.subPass===e.MaterialSubPass.Color?(U.bindTexture(K.overlayColor,
"ovColorTex"),U.bindTexture(K.overlayNormal,"ovNormalTex")):M.identifier===e.RenderPassIdentifier.Highlight&&U.bindTexture(K.overlayHighlight,"ovColorTex"),U.setUniform1f("overlayOpacity",1));M.identifier===e.RenderPassIdentifier.Highlight&&m.bindOutputHighlight(this.program,M);M.identifier===e.RenderPassIdentifier.Material&&M.subPass===e.MaterialSubPass.Color&&(M.ambientOcclusionEnabled&&M.bindAmbientOcclusion(U),M.shadowsEnabled&&M.bindShadowMap(U));M.identifier!==e.RenderPassIdentifier.Material||
M.subPass!==e.MaterialSubPass.Color&&M.subPass!==e.MaterialSubPass.Alpha||!M.multipassTerrainParams.multipassTerrainEnabled||(this.program.setUniform2fv("nearFar",M.nearFar),U.setUniform2fv("inverseViewport",M.inverseViewport),M.multipassTerrainParams.terrainLinearDepthTexture&&U.bindTexture(M.multipassTerrainParams.terrainLinearDepthTexture,"terrainDepthTexture"))};P.bindDraw=function(K){h.bindModelTransform(this.program,K);this.program.setUniformMatrix3fv("transformNormalGlobalFromModel",K.transformNormalGlobalFromModel);
this.program.rebindTextures();if(g.isSome(this._material)&&this._material.isIntegratedMesh){const M=this._material.overlayTexScale,U=this._material.overlayTexOffset;this.program.setUniform4fv("overlayTexOffset",[K.toMapSpace[0]*M[0]+U[0],K.toMapSpace[1]*M[1]+U[1],K.toMapSpace[0]*M[2]+U[2],K.toMapSpace[1]*M[3]+U[3]]);this.program.setUniform4fv("overlayTexScale",[K.toMapSpace[2]*M[0],K.toMapSpace[3]*M[1],K.toMapSpace[2]*M[2],K.toMapSpace[3]*M[3]])}};P.initializeProgram=function(K){const M=O.shader.get();
var U=this.configuration;U=M.build({multipassTerrainEnabled:U.multipassTerrainEnabled,cullAboveGround:U.cullAboveGround,oitEnabled:U.transparencyPassType===C.TransparencyPassType.Color,output:U.output,normalType:U.integratedMeshMode===b.IntegratedMeshMode.None?U.hasNormals?y.NormalAttributeType.CompressedAttribute:y.NormalAttributeType.ScreenDerivative:y.NormalAttributeType.Ground,attributeColor:U.hasVertexColors,attributeTextureCoordinates:U.vertexTextureCoordinates,componentData:U.componentData,
alphaDiscardMode:U.alphaDiscardMode,baseColorTexture:U.baseColorTexture,doubleSidedMode:U.doubleSidedMode,receiveAmbientOcclusion:U.receiveAmbientOcclusion,receiveShadows:U.receiveShadows,slicePlaneEnabled:U.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,viewingMode:K.viewingMode,vertexDiscardMode:U.vertexDiscardMode,pbrMode:U.integratedMeshMode===b.IntegratedMeshMode.ColorOverlayWithWater?t.PBRMode.WaterOnIntegratedMesh:U.usePBR?U.isSchematic?t.PBRMode.Schematic:t.PBRMode.Normal:
t.PBRMode.Disabled,hasMetalnessAndRoughnessTexture:U.hasMetalnessAndRoughnessTexture,hasEmissionTexture:U.hasEmissionTexture,hasOcclusionTexture:U.hasOcclusionTexture,hasNormalTexture:U.hasNormalTexture,vertexTangents:!1,supportsTextureAtlas:!0,doublePrecisionRequiresObfuscation:z.doublePrecisionRequiresObfuscation(K.rctx),overlayEnabled:U.integratedMeshMode===b.IntegratedMeshMode.ColorOverlay||U.integratedMeshMode===b.IntegratedMeshMode.ColorOverlayWithWater,ssrEnabled:U.ssrEnabled,highStepCount:!1,
ellipsoidMode:U.ellipsoidMode});return new F.Program(K.rctx,U,M.attributeLocations)};P._setPipelineState=function(K){const M=this.configuration,U=M.integratedMeshMode!==b.IntegratedMeshMode.None,R=K===C.TransparencyPassType.NONE,L=K===C.TransparencyPassType.FrontFace;return J.makePipelineState({blending:M.output!==k.ShaderOutput.Color&&M.output!==k.ShaderOutput.Alpha||!M.blendingEnabled?null:R?D.blendingDefault:D.oitBlending(K),culling:J.cullingParams(M.cullFace),depthTest:{func:D.oitDepthTest(K)},
depthWrite:R||L?J.defaultDepthWriteParams:null,colorWrite:J.defaultColorWriteParams,stencilWrite:U||M.sceneHasOcludees?G.stencilWriteMaskOn:null,stencilTest:U?G.replaceBitWhenDepthTestPasses(C.StencilBits.IntegratedMeshMaskExcluded):M.sceneHasOcludees?G.stencilBaseAllZerosParams:null,polygonOffset:R||L?M.polygonOffsetEnabled?{factor:2,units:2}:null:D.OITPolygonOffset})};P.initializePipeline=function(){return this._setPipelineState(this.configuration.transparencyPassType)};return O}(A.ShaderTechnique);
A.shader=new B.ReloadableShaderModule(n.ComponentShader,()=>new Promise((I,O)=>a(["./shader/ComponentShader.glsl"],I,O)));n=function(I){function O(){var P=I.apply(this,arguments)||this;P.transformNormalGlobalFromModel=x.create();P.toMapSpace=w.create();return P}c._inheritsLoose(O,I);return O}(h.VertexPositionModelTransform);b.PassDiscardMode=void 0;(function(I){I[I.None=0]="None";I[I.Transparent=1]="Transparent";I[I.Opaque=2]="Opaque";I[I.COUNT=3]="COUNT"})(b.PassDiscardMode||(b.PassDiscardMode={}));
b.IntegratedMeshMode=void 0;(function(I){I[I.None=0]="None";I[I.NoOverlay=1]="NoOverlay";I[I.ColorOverlay=2]="ColorOverlay";I[I.ColorOverlayWithWater=3]="ColorOverlayWithWater";I[I.COUNT=4]="COUNT"})(b.IntegratedMeshMode||(b.IntegratedMeshMode={}));B=function(I){function O(){var P=I.apply(this,arguments)||this;P.output=k.ShaderOutput.Color;P.hasVertexColors=!1;P.hasNormals=!1;P.vertexTextureCoordinates=p.TextureCoordinateAttributeType.None;P.componentData=l.ComponentDataType.Uniform;P.slicePlaneEnabled=
!1;P.cullFace=C.CullFaceOptions.Back;P.baseColorTexture=!1;P.receiveAmbientOcclusion=!0;P.receiveShadows=!0;P.vertexDiscardMode=f.VertexDiscardMode.None;P.doubleSidedMode=u.NormalsDoubleSidedMode.WindingOrder;P.blendingEnabled=!0;P.alphaDiscardMode=C.AlphaDiscardMode.Opaque;P.integratedMeshMode=b.IntegratedMeshMode.None;P.ssrEnabled=!1;P.polygonOffsetEnabled=!1;P.usePBR=!1;P.isSchematic=!1;P.hasMetalnessAndRoughnessTexture=!1;P.hasEmissionTexture=!1;P.hasOcclusionTexture=!1;P.hasNormalTexture=!1;
P.sceneHasOcludees=!1;P.transparencyPassType=C.TransparencyPassType.NONE;P.ellipsoidMode=v.EllipsoidMode.Earth;P.multipassTerrainEnabled=!1;P.cullAboveGround=!1;return P}c._inheritsLoose(O,I);return O}(E.ShaderTechniqueConfiguration);d.__decorate([E.parameter({count:k.ShaderOutput.COUNT})],B.prototype,"output",void 0);d.__decorate([E.parameter()],B.prototype,"hasVertexColors",void 0);d.__decorate([E.parameter()],B.prototype,"hasNormals",void 0);d.__decorate([E.parameter({count:p.TextureCoordinateAttributeType.COUNT})],
B.prototype,"vertexTextureCoordinates",void 0);d.__decorate([E.parameter({count:l.ComponentDataType.COUNT})],B.prototype,"componentData",void 0);d.__decorate([E.parameter()],B.prototype,"slicePlaneEnabled",void 0);d.__decorate([E.parameter({count:C.CullFaceOptions.COUNT})],B.prototype,"cullFace",void 0);d.__decorate([E.parameter()],B.prototype,"baseColorTexture",void 0);d.__decorate([E.parameter()],B.prototype,"receiveAmbientOcclusion",void 0);d.__decorate([E.parameter()],B.prototype,"receiveShadows",
void 0);d.__decorate([E.parameter({count:f.VertexDiscardMode.COUNT})],B.prototype,"vertexDiscardMode",void 0);d.__decorate([E.parameter({count:u.NormalsDoubleSidedMode.COUNT})],B.prototype,"doubleSidedMode",void 0);d.__decorate([E.parameter()],B.prototype,"blendingEnabled",void 0);d.__decorate([E.parameter({count:C.AlphaDiscardMode.COUNT})],B.prototype,"alphaDiscardMode",void 0);d.__decorate([E.parameter({count:b.IntegratedMeshMode.COUNT})],B.prototype,"integratedMeshMode",void 0);d.__decorate([E.parameter()],
B.prototype,"ssrEnabled",void 0);d.__decorate([E.parameter()],B.prototype,"polygonOffsetEnabled",void 0);d.__decorate([E.parameter()],B.prototype,"usePBR",void 0);d.__decorate([E.parameter()],B.prototype,"isSchematic",void 0);d.__decorate([E.parameter()],B.prototype,"hasMetalnessAndRoughnessTexture",void 0);d.__decorate([E.parameter()],B.prototype,"hasEmissionTexture",void 0);d.__decorate([E.parameter()],B.prototype,"hasOcclusionTexture",void 0);d.__decorate([E.parameter()],B.prototype,"hasNormalTexture",
void 0);d.__decorate([E.parameter()],B.prototype,"sceneHasOcludees",void 0);d.__decorate([E.parameter({count:C.TransparencyPassType.COUNT})],B.prototype,"transparencyPassType",void 0);d.__decorate([E.parameter({count:v.EllipsoidMode.COUNT})],B.prototype,"ellipsoidMode",void 0);d.__decorate([E.parameter()],B.prototype,"multipassTerrainEnabled",void 0);d.__decorate([E.parameter()],B.prototype,"cullAboveGround",void 0);b.ComponentDrawParameters=n;b.ComponentTechnique=A;b.ComponentTechniqueConfiguration=
B;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/ComponentData.glsl":function(){define(["exports","./DecodeSymbolColor.glsl","../../../../core/shaderModules/interfaces","../../../../lib/VertexAttribute"],function(a,b,c,d){a.ComponentDataType=void 0;(function(g){g[g.Uniform=0]="Uniform";g[g.Varying=1]="Varying";g[g.COUNT=2]="COUNT"})(a.ComponentDataType||(a.ComponentDataType={}));a.ComponentData=function(g,x){x.componentData===
a.ComponentDataType.Varying&&(g.vertex.uniforms.add("componentColorTex","sampler2D"),g.vertex.uniforms.add("componentColorTexInvDim","vec2"),g.attributes.add(d.VertexAttribute.COMPONENTINDEX,"float"),g.varyings.add("vExternalColorMixMode","mediump float"),g.varyings.add("vExternalColor","vec4"),g.include(b.DecodeSymbolColor),g.vertex.code.add(c.glsl`vec4 _readComponentColor() {
float normalizedIndex = (componentIndex + 0.5) * componentColorTexInvDim.x;
vec2 indexCoord = vec2(
mod(normalizedIndex, 1.0),
(floor(normalizedIndex) + 0.5) * componentColorTexInvDim.y
);
return texture2D(componentColorTex, indexCoord);
}
vec4 forwardExternalColor(out bool castShadows) {
vec4 componentColor = _readComponentColor() * 255.0;
float shadowFlag = mod(componentColor.b * 255.0, 2.0);
componentColor.b -= shadowFlag;
castShadows = shadowFlag >= 1.0;
int decodedColorMixMode;
vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451;
vExternalColorMixMode = float(decodedColorMixMode) + 0.5;
return vExternalColor;
}`),g.fragment.code.add(c.glsl`void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
externalColor = vExternalColor;
externalColorMixMode = int(vExternalColorMixMode);
}`));x.componentData===a.ComponentDataType.Uniform&&(g.vertex.uniforms.add("externalColor","vec4"),g.fragment.uniforms.add("externalColorMixMode","int"),g.varyings.add("vExternalColor","vec4"),g.vertex.code.add(c.glsl`vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`),g.fragment.code.add(c.glsl`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}`))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/ComponentShader.glsl":function(){define("exports ../geometry/support/Ellipsoid ../views/ViewingMode ../views/3d/webgl-engine/collections/Component/Material/shader/ComponentData.glsl ../views/3d/webgl-engine/collections/Component/Material/shader/VertexDiscardByOpacity.glsl ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeMaterialColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeShadingNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadBaseColorTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/EllipsoidMode ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E,C,D,F,G,J){function I(P){const K=new G.ShaderBuilder;K.include(r.VertexPosition,P);K.include(k.VertexNormal,P);K.include(e.VertexColor,P);K.include(f.TextureCoordinateAttribute,P);K.include(x.ForwardLinearDepth,P);K.include(d.ComponentData,P);K.include(C.DiscardOrAdjustAlpha,P);K.include(l.Slice,P);K.include(B.ReadBaseColorTexture,P);K.include(g.VertexDiscardByOpacity,P);K.fragment.uniforms.add("view","mat4");if(P.pbrMode===v.PBRMode.Normal||
P.pbrMode===v.PBRMode.Schematic)K.include(v.PhysicallyBasedRenderingParameters,P),P.hasNormalTexture&&K.include(u.ComputeNormalTexture,P);P.output===w.ShaderOutput.Shadow&&P.componentData===d.ComponentDataType.Varying?K.vertex.code.add(F.glsl`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):K.vertex.code.add(F.glsl`#define discardShadows(castShadows) {}`);const M=P.overlayEnabled&&P.output===w.ShaderOutput.Color&&P.pbrMode===v.PBRMode.WaterOnIntegratedMesh;
P.overlayEnabled&&(K.include(q.EvaluateSceneLighting,P),K.include(E.Overlay,P),P.viewingMode===c.ViewingMode.Global?K.vertex.code.add(F.glsl`
      const float invEllipsoidRadius = ${F.glsl.float(1/(P.ellipsoidMode===D.EllipsoidMode.Earth?b.earth.radius:P.ellipsoidMode===D.EllipsoidMode.Mars?b.mars.radius:b.moon.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):K.vertex.code.add(F.glsl`vec2 projectOverlay(vec3 pos) { return pos.xy; }`));M&&(K.varyings.add("tbnTangent","vec3"),K.varyings.add("tbnBiTangent","vec3"),K.varyings.add("groundNormal","vec3"),K.varyings.add("positionView","vec3"));K.vertex.code.add(F.glsl`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      if (externalColor.a < ${F.glsl.float(C.symbolAlphaCutoff)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
      forwardPosition();
      forwardNormal();
      ${M?F.glsl`
        positionView = position_view();
        ${P.viewingMode===c.ViewingMode.Global?F.glsl`
        groundNormal = normalize(positionWorld());
        tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
        tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:F.glsl`
        groundNormal = vec3(0.0, 0.0, 1.0);
        tbnTangent = vec3(1.0, 0.0, 0.0);
        tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`}
        `:""}

      ${P.overlayEnabled?F.glsl`setOverlayVTC(projectOverlay(position));`:""}
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth(); // depends on forwardPosition()
    }
  `);P.output===w.ShaderOutput.Alpha&&(K.fragment.include(h.ReadLinearDepth),P.multipassTerrainEnabled&&K.include(z.multipassTerrainTest,P),K.include(m.ComputeMaterialColor,P),K.fragment.code.add(F.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${P.multipassTerrainEnabled?F.glsl`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${P.overlayEnabled?F.glsl`
        vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
        vec4 overlayColor = overlayOpacity * overlayColorOpaque;
        materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        gl_FragColor = vec4(materialColor.a);
      }
    `));P.output===w.ShaderOutput.Color&&(K.fragment.include(h.ReadLinearDepth),P.multipassTerrainEnabled&&K.include(z.multipassTerrainTest,P),K.include(m.ComputeMaterialColor,P),K.include(t.ComputeShadingNormal,P),K.include(q.EvaluateSceneLighting,P),M&&K.fragment.uniforms.add("ovNormalTex","sampler2D"),P.receiveShadows?(K.include(A.ReadShadowMap,P),K.fragment.code.add(F.glsl`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):K.fragment.code.add(F.glsl`float evaluateShadow() { return 0.0; }`),K.fragment.code.add(F.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${P.multipassTerrainEnabled?F.glsl`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${P.overlayEnabled?F.glsl`
        vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
        vec4 overlayColor = overlayOpacity * overlayColorOpaque;
        materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}
    `),P.pbrMode===v.PBRMode.Normal||P.pbrMode===v.PBRMode.Schematic?(K.fragment.code.add(F.glsl`
        ${P.pbrMode===v.PBRMode.Normal?F.glsl`
        applyPBRFactors();
        if (int(externalColorMixMode) == 3) {
          mrr = vec3(0.0, 0.6, 0.2);
        }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * lightingMainIntensity[2];
      `),P.hasNormalTexture?K.fragment.code.add(F.glsl`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):K.fragment.code.add(F.glsl`vec3 shadingNormal = normalVertex;`),K.fragment.code.add(F.glsl`${P.viewingMode===c.ViewingMode.Global?F.glsl`vec3 normalGround = normalize(positionWorld());`:F.glsl`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),K.fragment.code.add(F.glsl`vec3 viewDir = normalize(vPositionWorldCameraRelative);
float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());
vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);`)):(P.receiveShadows?K.fragment.code.add(F.glsl`float shadow = evaluateShadow();`):P.viewingMode===c.ViewingMode.Global?K.fragment.code.add(F.glsl`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`):K.fragment.code.add(F.glsl`float shadow = 0.0;`),K.fragment.code.add(F.glsl`
      float ambientOcclusion = evaluateAmbientOcclusion();
      // At global scale we create some additional ambient light based on the main light to simulate global illumination
      vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());
      vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${M?F.glsl`
          vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
          float waterNormalLength = length(overlayWaterMask);
          if (waterNormalLength > 0.95) {
            mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
            vec4 waterOverlayColor = vec4(overlayColorOpaque.xyz, overlayColor.w);
            vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, positionView, positionWorld());
            vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
            // un-gamma the ground color to mix in linear space
            shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
          }`:""}
      `)),K.fragment.code.add(F.glsl`
        gl_FragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${P.oitEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
      }
    `));if(P.output===w.ShaderOutput.Depth||P.output===w.ShaderOutput.Shadow)K.include(y.OutputDepth,P),K.fragment.code.add(F.glsl`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`);P.output===w.ShaderOutput.Normal&&(K.include(t.ComputeShadingNormal,P),K.fragment.code.add(F.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material
        // to influence ambient occlusion, see the ssao fragment shader
        float alpha = ${P.normalType===n.NormalAttributeType.Ground?"0.0":"1.0"};
        gl_FragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `));P.output===w.ShaderOutput.Highlight&&(K.include(p.OutputHighlight),K.fragment.code.add(F.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${P.overlayEnabled?F.glsl`
        vec4 overlayColor = getCombinedOverlayColor();

        if (overlayColor.a == 0.0) {
          gl_FragColor = vec4(0.0);
          return;
        }`:""}

        outputHighlight();
      }
    `));return K}J=new Map([[J.VertexAttribute.POSITION,0],[J.VertexAttribute.NORMAL,1],[J.VertexAttribute.NORMALCOMPRESSED,1],[J.VertexAttribute.COLOR,2],[J.VertexAttribute.UV0,3],[J.VertexAttribute.UVREGION,4],[J.VertexAttribute.COMPONENTINDEX,5]]);const O=Object.freeze({__proto__:null,attributeLocations:J,build:I});a.ComponentShader=O;a.attributeLocations=J;a.build=I})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/VertexDiscardByOpacity.glsl":function(){define(["exports","../../../../core/shaderModules/interfaces"],
function(a,b){a.VertexDiscardMode=void 0;(function(c){c[c.None=0]="None";c[c.Transparent=1]="Transparent";c[c.Opaque=2]="Opaque";c[c.COUNT=3]="COUNT"})(a.VertexDiscardMode||(a.VertexDiscardMode={}));a.VertexDiscardByOpacity=function(c,d){c=c.vertex;c.code.add(b.glsl`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`);switch(d.vertexDiscardMode){case a.VertexDiscardMode.None:c.code.add(b.glsl`#define vertexDiscardByOpacity(_opacity_) {}`);break;case a.VertexDiscardMode.Opaque:c.code.add(b.glsl`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);
break;case a.VertexDiscardMode.Transparent:c.code.add(b.glsl`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`)}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeMaterialColor.glsl":function(){define(["exports","../attributes/VertexColor.glsl","../util/MixExternalColor.glsl","../../shaderModules/interfaces"],function(a,b,c,d){a.ComputeMaterialColor=
function(g,x){g.include(b.VertexColor,x);g.fragment.include(c.MixExternalColor);g=g.fragment;g.uniforms.add("baseColor","vec4");g.uniforms.add("objectOpacity","float");x.attributeColor?g.code.add(d.glsl`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):g.code.add(d.glsl`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`);g.code.add(d.glsl`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeShadingNormal.glsl":function(){define("exports ../../../../../../core/compilerUtils ../../../../../ViewingMode ../attributes/NormalAttribute.glsl ../attributes/VertexNormal.glsl ../attributes/VertexPosition.glsl ./Normals.glsl ../../shaderModules/interfaces".split(" "),function(a,b,c,d,g,x,w,l){a.ComputeShadingNormal=function(n,f){const e=n.fragment;switch(f.doubleSidedMode){case w.NormalsDoubleSidedMode.None:e.code.add(l.glsl`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case w.NormalsDoubleSidedMode.View:n.include(x.VertexPosition,f);e.code.add(l.glsl`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case w.NormalsDoubleSidedMode.WindingOrder:e.code.add(l.glsl`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:b.neverReached(f.doubleSidedMode);case w.NormalsDoubleSidedMode.COUNT:}switch(f.normalType){case d.NormalAttributeType.Attribute:case d.NormalAttributeType.CompressedAttribute:n.include(g.VertexNormal,f);e.code.add(l.glsl`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case d.NormalAttributeType.ScreenDerivative:n.extensions.add("GL_OES_standard_derivatives");n.include(x.VertexPosition,f);e.code.add(l.glsl`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case d.NormalAttributeType.Ground:f.viewingMode===c.ViewingMode.Global?(n.include(x.VertexPosition,f),e.code.add(l.glsl`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):f.viewingMode===c.ViewingMode.Local&&e.code.add(l.glsl`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`);n.extensions.add("GL_OES_standard_derivatives");e.code.add(l.glsl`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:b.neverReached(f.normalType);case d.NormalAttributeType.COUNT:}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ReadBaseColorTexture.glsl":function(){define(["exports","../attributes/TextureCoordinateAttribute.glsl","../attributes/VertexTextureCoordinates.glsl","../util/TextureAtlasLookup.glsl","../../shaderModules/interfaces"],function(a,b,c,d,g){a.ReadBaseColorTexture=function(x,w){const l=x.fragment;w.baseColorTexture?
(x.include(c.VertexTextureCoordinates,w),l.uniforms.add("baseColorTexture","sampler2D"),l.uniforms.add("baseColorTextureSize","vec2"),w.attributeTextureCoordinates===b.TextureCoordinateAttributeType.Atlas?(x.include(d.TextureAtlasLookup),l.code.add(g.glsl`vec4 readBaseColorTexture() {
return textureAtlasLookup(
baseColorTexture,
baseColorTextureSize,
vuv0,
vuvRegion
);
}`)):l.code.add(g.glsl`vec4 readBaseColorTexture() {
return texture2D(baseColorTexture, vuv0);
}`)):l.code.add(g.glsl`vec4 readBaseColorTexture() { return vec4(1.0); }`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/EllipsoidMode":function(){define(["exports","../../../../../../geometry/support/spatialReferenceUtils"],function(a,b){a.EllipsoidMode=void 0;(function(c){c[c.Earth=1]="Earth";c[c.Mars=2]="Mars";c[c.Moon=3]="Moon";c[c.COUNT=4]="COUNT"})(a.EllipsoidMode||(a.EllipsoidMode={}));a.getEllipsoidMode=function(c){return c&&b.isMars(c)?
a.EllipsoidMode.Mars:c&&b.isMoon(c)?a.EllipsoidMode.Moon:a.EllipsoidMode.Earth};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/renderPasses/AllRenderPasses":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/mat3f64 ../../../../../chunks/vec2f64 ../../../../../chunks/vec4f64 ../../../../../chunks/boundedPlane ../shaderLibrary/attributes/VertexPosition.glsl ../../lib/basicInterfaces".split(" "),function(a,b,c,d,g,x,
w,l){a.RenderPassIdentifier=void 0;(function(r){r[r.Material=0]="Material";r[r.ShadowMap=1]="ShadowMap";r[r.Highlight=2]="Highlight"})(a.RenderPassIdentifier||(a.RenderPassIdentifier={}));a.MaterialSubPass=void 0;(function(r){r[r.Color=0]="Color";r[r.Alpha=1]="Alpha";r[r.Depth=2]="Depth";r[r.Normal=3]="Normal"})(a.MaterialSubPass||(a.MaterialSubPass={}));let n=function(){this.viewTransform=new w.VertexPositionViewProjectionTransform;this.slicePlane=x.create()},f=function(r){function y(){var p=r.apply(this,
arguments)||this;p.identifier=a.RenderPassIdentifier.Material;p.slicePlaneEnabled=!0;p.transparent=!1;p.integratedMesh=!1;p.transformNormalViewFromGlobal=c.create();p.nearFar=d.create();p.inverseViewport=d.create();p.ambientOcclusionEnabled=!0;p.shadowsEnabled=!0;p.hasFillLights=!0;p.sceneHasOcludees=!1;p.transparencyPassType=l.TransparencyPassType.NONE;return p}b._inheritsLoose(y,r);return y}(n),e=function(r){function y(){var p=r.apply(this,arguments)||this;p.identifier=a.RenderPassIdentifier.ShadowMap;
p.nearFar=d.create();return p}b._inheritsLoose(y,r);return y}(n),k=function(r){function y(){var p=r.apply(this,arguments)||this;p.identifier=a.RenderPassIdentifier.Highlight;p.inverseViewport=d.create();p.viewport=g.create();return p}b._inheritsLoose(y,r);return y}(n);a.HighlightPassParameters=k;a.MaterialPassesParameters=f;a.PassParameters=n;a.ShadowMapPassParameters=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/material/MaterialBase":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function g(){this._dirty=!0}var x=g.prototype;x._setDirty=function(){this._dirty=!0};x._setClean=function(){this._dirty=!1;if(null!=this._parameterBlocks)for(const w of this._parameterBlocks)this[w]._setClean()};x._checkParameterBlocksDirty=function(){if(null==this._parameterBlocks)return!1;for(const w of this._parameterBlocks)if(this[w].dirty)return!0;return!1};b._createClass(g,[{key:"dirty",get:function(){return this._dirty||
this._checkParameterBlocksDirty()}}]);return g}(),d=function(){function g(){this._dirty=!0}var x=g.prototype;x._setDirty=function(){this._dirty=!0};x._setClean=function(){this._dirty=!1};b._createClass(g,[{key:"dirty",get:function(){return this._dirty}}]);return g}();a.MaterialBase=c;a.MaterialParameterBlock=d;a.parameter=function(g={}){return(x,w)=>{var l;const n=null!=(l=x._parameterCount)?l:0;x._parameterCount=n+1;if(g.vectorOps){const f=g.vectorOps;Object.defineProperty(x,w,{get(){return this[n]},
set(e){const k=this[n];if(null==k)this[n]=e;else{if(f.equals(k,e))return;f.copy(k,e)}this._setDirty()}})}else Object.defineProperty(x,w,{get(){return this[n]},set(f){this[n]!==f&&(g.dispose&&this[n]&&this[n].dispose(),this[n]=f,this._setDirty())}})}};a.parameterBlock=function(){return(g,x)=>{var w;const l=null!=(w=g._parameterCount)?w:0;g._parameterCount=l+1;g._parameterBlocks=g._parameterBlocks||[];g._parameterBlocks.push(l);Object.defineProperty(g,x,{get(){return this[l]},set(n){this[l]!==n&&(this[l]=
n,this._setDirty())}})}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/util/TwoVectorPosition":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/vec3","../../../../../chunks/vec3f32","../../../../../chunks/vec3f64"],function(a,b,c,d,g){let x=function(){function l(f){this._low=d.create();this._high=d.create();f&&this.set(f)}var n=l.prototype;n.set=function(f){const e=this._low,k=this._high;c.copy(e,f);c.sub(k,
f,e)};n.setElements=function(f,e,k){c.set(w,f,e,k);this.set(w)};n.get=function(f){return c.add(f,this._low,this._high)};n.getLowScaled=function(f){return c.scale(f,this._low,1)};b._createClass(l,[{key:"low",get:function(){return this._low}},{key:"high",get:function(){return this._high}}]);return l}();const w=g.create();a.TwoVectorPosition=x;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/BufferManager":function(){define(["exports","./ManagedTextureBackedBuffer"],
function(a,b){let c=function(){function d(x,w=1){this.rctx=x;this.fieldCount=w;this.buffers=[]}var g=d.prototype;g.garbageCollect=function(){this.buffers=this.buffers.filter(x=>0===x.activeCount?(x.dispose(),!1):!0)};g.destroy=function(){this.buffers.forEach(x=>x.dispose());this.buffers=[]};g.getBuffer=function(x){for(const w of this.buffers)if(w.availableCount>=x)return w;if(x>b.MAX_INDEX_COUNT)return null;x=new b.ManagedTextureBackedBuffer(this.rctx,this.fieldCount);this.buffers.push(x);return x};
g.updateTextures=function(){for(const x of this.buffers)x.textureBuffer.updateTexture()};return d}();a.BufferManager=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/ManagedTextureBackedBuffer":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./SimpleIndexManager","./TextureBackedBuffer"],function(a,b,c,d){let g=function(){function x(l,n=1){this.textureBuffer=new d.TextureBackedBuffer(l,n);this.indexManager=new c.SimpleIndexManager(65536)}
var w=x.prototype;w.dispose=function(){this.textureBuffer.dispose();this.textureBuffer=void 0};w.acquireIndex=function(){const l=this.indexManager.acquire();this.textureBuffer.resizeToFit(l);return l};w.releaseIndex=function(l){this.indexManager.release(l)};b._createClass(x,[{key:"availableCount",get:function(){return this.indexManager.availableCount}},{key:"activeCount",get:function(){return this.indexManager.activeCount}}]);return x}();a.MAX_INDEX_COUNT=65536;a.ManagedTextureBackedBuffer=g;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/SimpleIndexManager":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function d(x){this.maxCount=x;this._nextIndex=0;this.recycledIndices=[]}var g=d.prototype;g.acquire=function(){if(0<this.recycledIndices.length)return this.recycledIndices.pop();if(this.availableCount)return this._nextIndex++};g.release=function(x){this.recycledIndices.push(x)};b._createClass(d,
[{key:"activeCount",get:function(){return this._nextIndex-this.recycledIndices.length}},{key:"availableCount",get:function(){return this.recycledIndices.length+this.maxCount-this._nextIndex}}]);return d}();a.SimpleIndexManager=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/TextureBackedBuffer":function(){define(["exports","../../../../../geometry/support/buffer/BufferView","../../../../webgl/enums","../../../../webgl/Texture"],function(a,
b,c,d){let g=function(){function x(l,n=1){this.rctx=l;this.fieldCount=n;this.textureWidth=4096;this.dirty=!0;this.texture=new d.Texture(this.rctx,{target:c.TextureType.TEXTURE_2D,pixelFormat:c.PixelFormat.RGBA,dataType:c.PixelType.UNSIGNED_BYTE,samplingMode:c.TextureSamplingMode.NEAREST,wrapMode:c.TextureWrapMode.CLAMP_TO_EDGE,width:this.textureWidth,height:1,flipped:!1});this.data=new b.BufferViewVec4u8(new ArrayBuffer(4*this.textureWidth))}var w=x.prototype;w.dispose=function(){this.texture.dispose();
this.data=this.texture=void 0};w.setData=function(l,n,f,e,k,r){l=l*this.fieldCount+n;this.dirty=!0;this.data.set(l,0,f);this.data.set(l,1,e);this.data.set(l,2,k);this.data.set(l,3,r)};w.setDataElement=function(l,n,f,e){l=l*this.fieldCount+n;this.dirty=!0;this.data.set(l,f,e)};w.resizeToFit=function(l){l*=this.fieldCount;l>=this.data.count&&(l=new b.BufferViewVec4u8(new ArrayBuffer(Math.ceil((l+1)/this.textureWidth)*this.textureWidth*4)),l.typedBuffer.set(this.data.typedBuffer),this.data=l)};w.updateTexture=
function(){if(this.dirty){var l=this.texture.descriptor.width;this.data.count>l*this.texture.descriptor.height&&this.texture.resize(l,this.data.count/l);this.texture.setData(this.data.typedBuffer);this.dirty=!1}};w.bind=function(l,n,f){l.bindTexture(this.texture,n);l.setUniform2f(f,1/this.texture.descriptor.width,1/this.texture.descriptor.height)};return x}();a.TextureBackedBuffer=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/CompositingHelper":function(){define("../../../../core/maybe ../../terrain/interfaces ./glUtil3D ../../../../chunks/Compositing.glsl ../shaders/CompositingTechnique ../../../webgl/enums ../../../webgl/Util".split(" "),
function(a,b,c,d,g,x,w){let l=function(){function f(k,r){this._rctx=k;this._techniqueRepository=r}var e=f.prototype;e.dispose=function(){this._vao=a.disposeMaybe(this._vao)};e.compositeTransparent=function(k,r,y,p=1){const h=this._rctx;n.alphaMode=g.AlphaMode.Alpha;n.function=d.CompositingFunction.Transparency;n.hasOpacityFactor=1!==p;p=this._techniqueRepository.acquire(g.CompositingTechnique,n);const m=h.useTechnique(p);m.bindTexture(k,"colorTexture");m.bindTexture(r,"alphaTexture");m.bindTexture(y,
"frontFaceTexture");k=this._ensureVAO();h.bindVAO(k);h.drawArrays(x.PrimitiveType.TRIANGLE_STRIP,0,w.vertexCount(k,"geometry"));p.release()};e.composite=function(k,r=g.AlphaMode.None,y=1,p=d.CompositingFunction.Standard,h=b.OverlayIndex.INNER){const m=this._rctx;n.alphaMode=r;n.function=p;n.hasOpacityFactor=1!==y;r=this._techniqueRepository.acquire(g.CompositingTechnique,n);const u=m.useTechnique(r);u.bindTexture(k,"tex");n.hasOpacityFactor&&u.setUniform1f("opacity",y);p===d.CompositingFunction.OverlayWithTransparency&&
u.setUniform1i("overlayIdx",h);k=this._ensureVAO();m.bindVAO(k);m.drawArrays(x.PrimitiveType.TRIANGLE_STRIP,0,w.vertexCount(k,"geometry"));r.release()};e._ensureVAO=function(){a.isNone(this._vao)&&(this._vao=c.createQuadVAO(this._rctx));return this._vao};return f}();const n=new g.CompositingTechniqueConfiguration;return l})},"esri/views/3d/webgl-engine/lib/depthRangeUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/floatRGBA ../../../../core/maybe ../../../../core/PooledArray ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/support/frustum ../../../../chunks/sphere ../../support/mathUtils ./depthRange ./Octree ./Util".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h){function m(P,K){if(K.isVisible){var M=y.empty(),U=K.getSpatialQueryAccelerator();d.isSome(U)?u(M,P,U):t(M,P,K.objects);return M}}function u(P,K,M){var U=K.eye;const R=K.viewForward,L=K.frustum,N=S=>S.isVisible;var T=M.objectCount;500>T?(y.set(G,K.near,Math.min(P.near,K.far)),M.forEachInDepthRange(U,R,p.DepthOrder.FRONT_TO_BACK,G,(S,H)=>{q(P,K,S);G.far=P.near;H.setRange(G)},L,N),y.set(G,Math.max(P.far,K.near),K.far),M.forEachInDepthRange(U,R,p.DepthOrder.BACK_TO_FRONT,
G,(S,H)=>{q(P,K,S);G.near=P.far;H.setRange(G)},L,N)):(T=Math.max(Math.min(T,500),Math.ceil(.1*T)),U=M.findClosest(R,p.DepthOrder.FRONT_TO_BACK,L,N,T),M=M.findClosest(R,p.DepthOrder.BACK_TO_FRONT,L,N,T),U&&M&&(v(P,K,U.boundingVolumeWorldSpace.bounds),v(P,K,M.boundingVolumeWorldSpace.bounds)))}function t(P,K,M){J.clear();M.forAll(U=>{U.isVisible&&0!==U.geometryRecords.length&&J.add(U)});J.empty||(J.sort(K),y.set(G,K.near,Math.min(P.near,K.far)),J.forEachInDepthRange(G,p.DepthOrder.FRONT_TO_BACK,(U,
R)=>{R<P.near&&q(P,K,U)}),y.set(G,Math.max(P.far,K.near),K.far),J.forEachInDepthRange(G,p.DepthOrder.BACK_TO_FRONT,(U,R,L)=>{P.far=Math.max(P.far,L)}))}function q(P,K,M){if(M.isVisible&&e.intersectsSphere(K.frustum,M.boundingVolumeWorldSpace.bounds)){var U=M.transformation,R=F;M.geometryRecords.forEach(L=>{x.multiply(R,U,L.getShaderTransformation());const N=r.maxScale(R);z(P,K,L.geometry.boundingInfo,R,N)})}}function z(P,K,M,U,R){if(!d.isNone(M)){var L=K.eye,N=K.viewForward;l.transformMat4(D,M.center,
U);L=N[0]*(D[0]-L[0])+N[1]*(D[1]-L[1])+N[2]*(D[2]-L[2]);D[3]=M.radius*R;if(!(L-D[3]>P.near&&L+D[3]<P.far)&&e.intersectsSphere(K.frustum,D))if(100<M.radius&&M.getChildren())for(M=M.getChildren(),L=0;8>L;++L)M[L]&&z(P,K,M[L],U,R);else O.unionDepthRangeWithAABB(P,K.viewProjectionMatrix,U,M.bbMin,M.bbMax)}}function v(P,K,M){var U=K.eye;K=K.viewForward;U=(M[0]-U[0])*K[0]+(M[1]-U[1])*K[1]+(M[2]-U[2])*K[2];P.near=Math.min(P.near,U-M[3]);P.far=Math.max(P.far,U+M[3])}let B=function(){function P(){this._items=
new g({allocator:M=>M||{obj:null,distance:0,near:0,far:0},deallocator:M=>{M.obj=null;M.distance=0;M.near=0;M.far=0;return M}})}var K=P.prototype;K.clear=function(){this._items.clear()};K.add=function(M){this._items.pushNew().obj=M};K.sort=function(M){const U=M.eye,R=M.viewForward;this._items.forAll(L=>{const N=L.obj.boundingVolumeWorldSpace.bounds,T=(N[0]-U[0])*R[0]+(N[1]-U[1])*R[1]+(N[2]-U[2])*R[2];L.distance=T;L.near=T-N[3];L.far=T+N[3]});this._items.sort((L,N)=>L.distance-N.distance)};K.forEachInDepthRange=
function(M,U,R){if(U===p.DepthOrder.FRONT_TO_BACK)for(U=0;U<this._items.length;++U){var L=this._items.data[U];L.far<M.near||L.near>M.far||R(L.obj,L.near,L.far)}else for(U=this._items.length-1;0<=U;--U)L=this._items.data[U],L.far<M.near||L.near>M.far||R(L.obj,L.near,L.far)};b._createClass(P,[{key:"length",get:function(){return this._items.length}},{key:"empty",get:function(){return 0===this._items.length}}]);return P}(),A=function(){function P(){this.view=w.create();this.viewProj=w.create();this.frustum=
e.create();this.geometries=[];this.near=[];this.far=[];this.nearCandidates=[];this.farCandidates=[];this.range={near:0,far:0};this.looseRange={near:0,far:0}}var K=P.prototype;K.compute=function(M,U){this._reset();x.copy(this.view,M.viewMatrix);x.multiply(this.viewProj,M.projectionMatrix,this.view);e.copy(this.frustum,M.frustum);M=this.view;const R=M[2],L=M[6],N=M[10],T=M[14];M=this.range;let S=0;U.forEach(W=>{if(W.instanceParameters.visible&&W.castShadow){if(W.hasShaderTransformation){W.computeBoundingSphere(W.getShaderTransformation(),
D,1);var V=D}else V=W.boundingSphere;var Y=R*V[0]+L*V[1]+N*V[2]+T,aa=Y-V[3];V=Y+V[3];this.geometries[S]=W;this.near[S]=-V;this.far[S]=-aa;++S}});if(0===this.geometries.length)return M;for(U=0;U<this.geometries.length;++U)this.near[U]>M.far&&(M.far=this.near[U]),2<this.near[U]&&this.far[U]<M.near&&(M.near=this.far[U]);U=this.looseRange;U.near=Math.max(.5*M.near,2);U.far=2*M.far;var H=0;let Q=0;for(let W=0;W<this.geometries.length;++W)this.near[W]<M.near&&(this.near[W]>=U.near?M.near=this.near[W]:this.nearCandidates[H++]=
W),this.far[W]>M.far&&(this.far[W]<=U.far?M.far=this.far[W]:this.farCandidates[Q++]=W);if(0===this.nearCandidates.length&&0===this.farCandidates.length)return M;this.nearCandidates.sort((W,V)=>this.near[W]<this.near[V]?-1:this.near[W]>this.near[V]?1:0);this.farCandidates.sort((W,V)=>this.far[W]<this.far[V]?1:this.far[W]>this.far[V]?-1:0);for(U=0;U<this.nearCandidates.length;++U)H=this.nearCandidates[U],this.near[H]<M.near&&(H=this.geometries[H],this._includeNearBoundingInfoRec(H.boundingInfo,H.getShaderTransformation()));
for(U=0;U<this.farCandidates.length;++U)H=this.farCandidates[U],this.far[H]>M.far&&(H=this.geometries[H],this._includeFarBoundingInfoRec(H.boundingInfo,H.getShaderTransformation()));return M};K._reset=function(){this.geometries.length=0;this.near.length=0;this.far.length=0;this.nearCandidates.length=0;this.farCandidates.length=0;this.range.near=Number.MAX_VALUE;this.range.far=-Number.MAX_VALUE};K._includeNearBoundingInfoRec=function(M,U){if(!d.isNone(M)){var R=M.getCenter();l.transformMat4(D,R,U);
R=r.maxScale(U);var L=D[0],N=D[1],T=D[2];R*=M.getBSRadius();var S=this.frustum;if(!(S[0][0]*L+S[0][1]*N+S[0][2]*T+S[0][3]>R||S[1][0]*L+S[1][1]*N+S[1][2]*T+S[1][3]>R||S[2][0]*L+S[2][1]*N+S[2][2]*T+S[2][3]>R||S[3][0]*L+S[3][1]*N+S[3][2]*T+S[3][3]>R||(L=this.view[2]*L+this.view[6]*N+this.view[10]*T+this.view[14],N=L+R,2>-(L-R)||-N>=this.range.near)))if(-N>this.looseRange.near)this.range.near=-N;else{if(100<R&&(R=M.getChildren(),void 0!==R)){for(M=0;8>M;++M)void 0!==R[M]&&this._includeNearBoundingInfoRec(R[M],
U);return}O.unionDepthRangeWithAABB(this.range,this.viewProj,U,M.getBBMin(),M.getBBMax())}}};K._includeFarBoundingInfoRec=function(M,U){if(!d.isNone(M)){var R=M.getBSRadius(),L=M.getCenter();l.transformMat4(D,L,U);var N=r.maxScale(U);L=D[0];var T=D[1],S=D[2];R*=N;N=this.frustum;if(!(N[0][0]*L+N[0][1]*T+N[0][2]*S+N[0][3]>R||N[1][0]*L+N[1][1]*T+N[1][2]*S+N[1][3]>R||N[2][0]*L+N[2][1]*T+N[2][2]*S+N[2][3]>R||N[3][0]*L+N[3][1]*T+N[3][2]*S+N[3][3]>R||(L=this.view[2]*L+this.view[6]*T+this.view[10]*S+this.view[14]-
R,-L<=this.range.far)))if(-L<this.looseRange.far)this.range.far=-L;else{if(100<R&&(R=M.getChildren(),void 0!==R)){for(M=0;8>M;++M)void 0!==R[M]&&this._includeFarBoundingInfoRec(R[M],U);return}O.unionDepthRangeWithAABB(this.range,this.viewProj,U,M.getBBMin(),M.getBBMax())}}};return P}(),E=function(){function P(){this.modelViewProj=w.create();this.clipPosition=[f.create(),f.create(),f.create(),f.create(),f.create(),f.create(),f.create(),f.create()]}var K=P.prototype;K.unionDepthRangeWithAABB=function(M,
U,R,L,N){var T=this.modelViewProj;x.multiply(T,U,R);U=!1;for(R=0;8>R;++R){const S=this.clipPosition[R],H=0===R||3===R||4===R||7===R?L[0]:N[0],Q=0===R||1===R||4===R||5===R?L[1]:N[1],W=4>R?L[2]:N[2];S[0]=T[0]*H+T[4]*Q+T[8]*W+T[12];S[1]=T[1]*H+T[5]*Q+T[9]*W+T[13];S[2]=T[2]*H+T[6]*Q+T[10]*W+T[14];S[3]=T[3]*H+T[7]*Q+T[11]*W+T[15]}for(L=0;12>L;++L){N=this._clipTriangle(this.clipPosition[C[L][0]],this.clipPosition[C[L][1]],this.clipPosition[C[L][2]]);T=!0;for(R=0;R<N.length;++R)if(2<=N[R][3]){T=!1;break}if(!T)for(U=
!0,T=0;T<N.length;++T)R=N[T][3],R<M.near&&(M.near=R),R>M.far&&(M.far=R)}return U};K._inside=function(M,U){if(0===U)return M[0]>=-M[3];if(1===U)return M[1]>=-M[3];if(2===U)return M[0]<=M[3];if(3===U)return M[1]<=M[3];h.assert(!1)};K._intersect=function(M,U,R){let L=0;0===R?L=(-M[3]-M[0])/(U[0]-M[0]+U[3]-M[3]):1===R?L=(-M[3]-M[1])/(U[1]-M[1]+U[3]-M[3]):2===R?L=(M[3]-M[0])/(U[0]-M[0]-U[3]+M[3]):3===R&&(L=(M[3]-M[1])/(U[1]-M[1]-U[3]+M[3]));return n.lerp(f.create(),M,U,L)};K._clipTriangle=function(M,U,
R){M=[M,U,R];for(U=0;4>U;++U){R=M;M=[];for(let L=0;L<R.length;++L){const N=R[L],T=R[(L+1)%R.length];this._inside(T,U)?(this._inside(N,U)||M.push(this._intersect(N,T,U)),M.push(T)):this._inside(N,U)&&M.push(this._intersect(N,T,U))}}return M};return P}();const C=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],D=k.create(),F=w.create(),G=y.empty(),J=new B,I=new A,O=new E;a.DepthRangeFromRenderGeometries=A;a.depthRangeFromLayer=m;a.depthRangeFromScene=
function(P,K,M){if(1E4>K.size)return I.compute(P,K);const U=y.empty();M.forAll(R=>{R.isVisible&&y.union(U,m(P,R))});return U};a.textureToDepth=function(P,K,M){return c.unpackFloatRGBA(K,P)*(M[1]-M[0])+M[0]};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/MagnifierHelper":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Handles ../../../../core/mathUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/urlUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../support/requestImageUtils ./DefaultVertexBufferLayouts ./glUtil3D ./Program ./VertexAttribute ../shaders/Magnifier.glsl ../../../magnifier/resources ../../../webgl/enums ../../../webgl/renderState ../../../webgl/Texture".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E,C){a.MagnifierHelper=function(D){function F(){var J=D.apply(this,arguments)||this;J._handles=new x;J._magnifier=null;J._imageSources=null;J._imageLoadTask=null;J._resources=null;J.events=new g;J.attributeLocations=new Map([[z.VertexAttribute.POSITION,0]]);J.tmpScreenPoint=f.createScreenPointArray();J.tmpRenderPoint=f.createRenderScreenPointArray();return J}b._inheritsLoose(F,D);var G=F.prototype;G.dispose=function(){this._magnifier=null;this._handles.destroy();
l.isSome(this._imageLoadTask)&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null);this._disposeResources()};G.render=function(J,I){const O=this._validMagnifier;if(!l.isNone(O)){var P=I.camera.pixelRatio,K=Math.ceil(P*O.size);this._updateResources(J,K);if(!l.isNone(this._resources)){var M=this._resources.program;J.useProgram(M);var U=this._resources.textures,R=Math.ceil(1/this.factor*K);U.input.resize(R,R);var L=I.camera.fullWidth,N=I.camera.fullHeight;f.screenPointObjectToArray(O.position,
this.tmpScreenPoint);I=I.camera.screenToRender(this.tmpScreenPoint,this.tmpRenderPoint);var T=.5*R,S=.5*R;I[0]=w.clamp(I[0],T,L-T-1);I[1]=w.clamp(I[1],S,N-S-1);T=Math.floor(I[0]-T);S=Math.floor(I[1]-S);M.bindTexture(U.input,"textureInput");J.gl.copyTexImage2D(U.input.descriptor.target,0,U.input.descriptor.pixelFormat,T,S,R,R,0);R=-1+(I[0]+O.offset.x*P)/L*2;P=-1+(I[1]-O.offset.y*P)/N*2;L=K/L*2;K=K/N*2;J.bindVAO(this._resources.vao);M.bindTexture(U.overlay,"textureOverlay");M.bindTexture(U.mask,"textureMask");
M.setUniform4f("drawPosition",R,P,L,K);M.setUniform1b("maskEnabled",O.maskEnabled);M.setUniform1b("overlayEnabled",O.overlayEnabled);J.setPipelineState(this._resources.pipelineState);J.drawArrays(A.PrimitiveType.TRIANGLE_STRIP,0,4)}}};G._updateResourceLoading=function(){var J=this;const I=this._validMagnifier;if(!l.isNone(I)){var O=I.maskUrl,P=I.overlayUrl;!l.isSome(this._imageLoadTask)||this._imageLoadTask.maskUrl===O&&this._imageLoadTask.overlayUrl===P||(this._imageLoadTask.task.abort(),this._imageSources=
this._imageLoadTask=null);l.isSome(this._imageSources)||l.isSome(this._imageLoadTask)||(this._imageLoadTask={maskUrl:O,overlayUrl:P,task:n.createTask(function(){var K=b._asyncToGenerator(function*(M){const U=l.isNone(O)||l.isNone(P)?B.loadMagnifierResources(M):null,R=l.isSome(O)?m.requestImage(O,{signal:M}):U.then(L=>L.mask);M=l.isSome(P)?m.requestImage(P,{signal:M}):U.then(L=>L.overlay);J._imageSources={mask:yield R,overlay:yield M};J._disposeResources();J.events.emit("request-render")});return function(M){return K.apply(this,
arguments)}}())},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}};G._updateResources=function(J,I){this.enabled?l.isSome(this._resources)?this._resources.textures.size!==I&&(J=this._createTextureResources(J,I),l.isNone(J)?this._disposeResources():(this._disposeTextureResources(this._resources.textures),this._resources.textures=J)):(I=this._createTextureResources(J,I),l.isNone(I)||(this._resources={textures:I,program:this._createProgram(J),
vao:t.createQuadVAO(J,u.Pos2,this.attributeLocations,0,1),pipelineState:E.makePipelineState({blending:E.simpleBlendingParams(A.BlendFactor.ONE,A.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:E.defaultColorWriteParams})})):this._disposeResources()};G._disposeResources=function(){l.isNone(this._resources)||(this._disposeTextureResources(this._resources.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)};G._disposeTextureResources=
function(J){J.mask.dispose();J.overlay.dispose();J.input.dispose()};G._createTextureResources=function(J,I){if(l.isNone(this._imageSources))return null;this._imageSources.overlay.width=I;this._imageSources.overlay.height=I;this._imageSources.mask.width=I;this._imageSources.mask.height=I;const O=new C.Texture(J,{target:A.TextureType.TEXTURE_2D,pixelFormat:A.PixelFormat.RGBA,internalFormat:A.PixelFormat.RGBA,dataType:A.PixelType.UNSIGNED_BYTE,wrapMode:A.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:A.TextureSamplingMode.LINEAR,
flipped:!0,preMultiplyAlpha:e.isSVG(this._imageSources.overlay.src)&&J.driverTest.svgAlwaysPremultipliesAlpha?!1:!0},this._imageSources.overlay),P=new C.Texture(J,{target:A.TextureType.TEXTURE_2D,pixelFormat:A.PixelFormat.ALPHA,internalFormat:A.PixelFormat.ALPHA,dataType:A.PixelType.UNSIGNED_BYTE,wrapMode:A.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:A.TextureSamplingMode.LINEAR,flipped:!0},this._imageSources.mask);return{input:new C.Texture(J,{target:A.TextureType.TEXTURE_2D,pixelFormat:A.PixelFormat.RGBA,
internalFormat:A.PixelFormat.RGBA,dataType:A.PixelType.UNSIGNED_BYTE,wrapMode:A.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:A.TextureSamplingMode.LINEAR,flipped:!1}),mask:P,overlay:O,size:I}};G._createProgram=function(J){const I=v.build();return new q.Program(J,I,this.attributeLocations)};b._createClass(F,[{key:"updating",get:function(){return l.isNone(this._imageSources)&&l.isSome(this._imageLoadTask)&&!this._imageLoadTask.task.finished}},{key:"magnifier",get:function(){return this._magnifier},set:function(J){J!==
this._magnifier&&(this._handles.removeAll(),this._magnifier=J,J=()=>{this._updateResourceLoading();this.events.emit("request-render")},l.isSome(this._magnifier)&&this._handles.add(this._magnifier.watch("version",J)),J())}},{key:"enabled",get:function(){return l.isSome(this._validMagnifier)}},{key:"_validMagnifier",get:function(){return l.isSome(this._magnifier)&&this._magnifier.visible&&l.isSome(this._magnifier.position)&&0<this._magnifier.size?this._magnifier:null}},{key:"factor",get:function(){return l.isSome(this._magnifier)?
this._magnifier.factor||1:1}}]);return F}(d);c.__decorate([k.property()],a.MagnifierHelper.prototype,"_imageSources",void 0);c.__decorate([k.property()],a.MagnifierHelper.prototype,"_imageLoadTask",void 0);c.__decorate([k.property({readOnly:!0})],a.MagnifierHelper.prototype,"updating",null);a.MagnifierHelper=c.__decorate([h.subclass("esri/views/3d/webgl-engine/lib/MagnifierHelper")],a.MagnifierHelper);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/Magnifier.glsl":function(){define(["exports",
"../core/shaderModules/interfaces","../core/shaderModules/ShaderBuilder","../lib/VertexAttribute"],function(a,b,c,d){a.build=function(){const g=new c.ShaderBuilder;g.attributes.add(d.VertexAttribute.POSITION,"vec2");g.vertex.uniforms.add("proj","mat4");g.vertex.uniforms.add("drawPosition","vec4");g.varyings.add("vUV","vec2");g.vertex.code.add(b.glsl`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`);g.fragment.uniforms.add("textureInput","sampler2D");g.fragment.uniforms.add("textureMask","sampler2D");g.fragment.uniforms.add("textureOverlay","sampler2D");g.fragment.uniforms.add("maskEnabled","bool");g.fragment.uniforms.add("overlayEnabled","bool");g.fragment.code.add(b.glsl`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture2D(textureMask, vUV).a : 1.0;
vec4 inputColor = texture2D(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture2D(textureOverlay, vUV) : vec4(0);
gl_FragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`);return g};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/magnifier/resources":function(){define(["require","exports","../../chunks/_rollupPluginBabelHelpers","../../core/promiseUtils","../../support/requestImageUtils"],function(a,b,c,d,g){function x(){x=c._asyncToGenerator(function*(w){var l=new Promise((f,e)=>a(["./mask-svg"],k=>f(Object.freeze({__proto__:null,default:k})),e)),n=new Promise((f,e)=>a(["./overlay-svg"],k=>f(Object.freeze({__proto__:null,default:k})),e));l=g.requestImage((yield l).default,
{signal:w});n=g.requestImage((yield n).default,{signal:w});n={mask:yield l,overlay:yield n};d.throwIfAborted(w);return n});return x.apply(this,arguments)}b.loadMagnifierResources=function(w){return x.apply(this,arguments)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Renderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/MapUtils ../../../../core/maybe ../../../../core/time ../../../../core/watchUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../support/animationUtils ../../support/debugFlags ../core/renderPasses/RenderPassManager ../core/shaderLibrary/hud/HUDUniforms ./basicInterfaces ./BoundingInfo ./depthRange ./depthRangeUtils ./glUtil3D ./HighlightHelper ./Material ./OffscreenRendering ./RenderContext ./rendererUtils ./RenderPass ./RenderPluginManager ./RenderSlot ./ShadowAccumulator ./ShadowHighlightHelper ./ShadowMap ./SliceHelper ./SmaaRenderPass ./SSAOHelper ./edgeRendering/EdgeView ./edgeRendering/interfaces ../lighting/SceneLighting ../materials/renderers/MergedRenderer ../shaders/CompositingTechnique ../shaders/ShadowHighlightTechnique ../statistics/RendererPerformanceInfo ../../../webgl/enums ../../../webgl/Measurement".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E,C,D,F,G,J,I,O,P,K,M,U,R,L,N,T,S,H,Q,W,V,Y,aa,X,ba){a.Renderer=function(fa){function ja(ma,ra,va,ya,za,pa,wa,na,qa){var ta=fa.call(this,{})||this;ta._materialRepository=ma;ta._shaderTechniqueRepository=va;ta._rctx=ya;ta._compositingHelper=za;ta._magnifierHelper=pa;ta._requestRender=wa;ta._stage=qa;ta._materialRenderers=new Map;ta._needsTransparentPass=!1;ta._hasHUDElements=!1;ta._hasHighlights=!1;ta._hasOccludees=!1;ta._hasWater=!1;ta._hasOverlayWater=
!1;ta._content=new Map;ta._isRendering=!1;ta._fallbackDepthStencilTexture=null;ta.performanceInfo=new aa.RendererPerformanceInfo;ta._antialiasing=v.AntiAliasingMode.SMAA;ta._oitEnabled=!1;ta._multipassTerrain=!0;ta._opaqueTerrain=!0;ta._lighting=new Q.SceneLighting;ta._hasAnimations=!1;ta._animationTimestep=l.Milliseconds(0);ta._handles=new g;ta._renderHiddenTransparentEdges=()=>{};ta._oitUsed=!1;ta._smaaPass=new N.SmaaRenderPass(ta._rctx,va);ta._oitEnabled=ta._hasOITSupport;ta._requestRender();ta._offscreenRendering=
new G.OffscreenRendering(ta._rctx,ta._compositingHelper);ta._sliceHelper=new L;ta._shadowMap=new R(ta._rctx,qa.viewingMode,2);ta._ssaoHelper=new T.SSAOHelper(va,ta._rctx,()=>ta._requestRender());ta._highlightHelper=new D(va,ta._rctx);ta._shadowHighlightHelper=new U.ShadowHighlightHelper(ta._rctx,qa.viewingMode);ta._shadowAccumulator=new M.ShadowAccumulator(ta._rctx,va,qa,(Fa,Ha)=>{ta.renderPassManager.shadowCastingEnabled=!0;ta._renderPlugins.prepareRender(Fa,Ha);ta.renderPassManager.shadowCastingEnabled=
ta._shadowMap.enabled},(Fa,Ha,Ka,La)=>{Fa.start(Ka,Ha,La);ta._renderShadowCascades(O.RenderPass.MATERIAL_DEPTH_SHADOWMAP_ALL,Fa);Ka.setGLViewport(ta._rctx);ta._ensureCameraBindParameters(Ka)},()=>ta._requestRender());ta._bindParameters={slot:null,camera:null,inverseViewport:m.create(),shadowMap:ta._shadowMap,shadowMappingEnabled:ta._shadowMap.enabled,ssaoHelper:ta._ssaoHelper,ssaoEnabled:ta._ssaoHelper.enabled,origin:null,screenToWorldRatio:null,screenToPCSRatio:null,slicePlane:ta._sliceHelper.plane,
highlightDepthTexture:null,hasOccludees:!1,linearDepthTexture:null,terrainLinearDepthTexture:null,geometryLinearDepthTexture:null,multipassTerrainEnabled:!1,multipassGeometryEnabled:!1,cullAboveGround:!1,lastFrameColorTexture:null,reprojectionMatrix:h.IDENTITY,ssrEnabled:!1,lighting:ta._lighting,highlightColorTexture:null,cloudsCompositionParams:null,hasFillLights:!0};ta._renderContext=new J.RenderContext(ta._rctx,ta._offscreenRendering,ta._lighting,ta._shadowMap,ta._ssaoHelper,ta._sliceHelper);ta._renderContext.multipassTerrainParams=
{camera:null,multipassTerrainEnabled:!1,cullAboveGround:!1,terrainLinearDepthTexture:null};ta._renderContext.multipassGeometryParams={multipassGeometryEnabled:!1,geometryLinearDepthTexture:null};ta._renderContext.ssrParams={camera:null,linearDepthTexture:null,lastFrameColorTexture:null,reprojectionMatrix:h.IDENTITY,ssrEnabled:!1};ta._renderPlugins=new P.RenderPluginManager({renderContext:ta._renderContext,shaderTechniqueRepository:va,textureRep:ra,materialRep:ta._materialRepository,requestRender:ta._requestRender,
schedule:na});ta.renderPassManager=new q.RenderPassManager(ta._rctx,ta._shaderTechniqueRepository);ta._renderPlugins.add(ta.renderPassManager.slots(),ta.renderPassManager);ta._handles.add([n.init(t,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",Fa=>{ta._renderHiddenTransparentEdges=Fa?()=>ta._renderEdges(H.Transparency.TRANSPARENT):()=>{};ta._requestRender()}),n.init(ta._stage,"camera",()=>ta._requestRender(),!0)]);return ta}b._inheritsLoose(ja,fa);var la=ja.prototype;la.normalizeCtorArgs=function(){return{}};
la.dispose=function(){this._handles.destroy();this._smaaPass.dispose();this._materialRenderers.forEach(ma=>ma.dispose());this._materialRenderers.clear();this._edgeView=w.destroyMaybe(this._edgeView);this._offscreenRendering.dispose();this._fallbackDepthStencilTexture=w.disposeMaybe(this._fallbackDepthStencilTexture);this._shadowMap.enabled=!1;this._shadowMap.dispose();this._ssaoHelper.enabled=!1;this._ssaoHelper.dispose();this._highlightHelper.dispose();this._shadowHighlightHelper.dispose();this._shadowAccumulator.dispose();
B.BoundingInfo.prune();this._content.clear()};la.disposeOffscreenBuffers=function(){this._offscreenRendering.dispose();this._shadowMap.dispose();this._smaaPass.disable();this._ssaoHelper.disposeOffscreenBuffers()};la.ensureEdgeView=function(){w.isNone(this._edgeView)&&(this._edgeView=new S.EdgeView({rctx:this._rctx,renderSR:this._stage.renderSR,techniqueRepository:this._shaderTechniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:ma=>this._stage.resourceController.schedule(ma)}),this._handles.add(this._edgeView.watch("updating",
()=>this._requestRender(),!0)),this._requestRender());return this._edgeView};la.setRenderParameters=function(ma){const {renderPassManager:ra,_shadowMap:va,_ssaoHelper:ya}=this;void 0!==ma.screenSpaceReflectionsEnabled&&ra.screenSpaceReflectionsEnabled!==ma.screenSpaceReflectionsEnabled&&(ra.screenSpaceReflectionsEnabled=ma.screenSpaceReflectionsEnabled,this._requestRender());void 0!==ma.fillLightsEnabled&&ra.fillLightsEnabled!==ma.fillLightsEnabled&&(ra.fillLightsEnabled=ma.fillLightsEnabled,this._requestRender());
void 0===ma.shadowMap||va.enabled===ma.shadowMap&&ra.shadowCastingEnabled===ma.shadowMap||(va.enabled=ma.shadowMap,ra.shadowCastingEnabled=ma.shadowMap,this._requestRender());void 0!==ma.shadowMapMaxCascades&&va.maxCascades!==ma.shadowMapMaxCascades&&(va.maxCascades=ma.shadowMapMaxCascades,this._requestRender());void 0!==ma.ssao&&ya.enabled!==ma.ssao&&(ya.enabled=ma.ssao,this._requestRender());ma.background&&this._offscreenRendering.background!==ma.background&&(this._offscreenRendering.background=
ma.background,this._requestRender());const za=ma.antialiasingEnabled?v.AntiAliasingMode.SMAA:v.AntiAliasingMode.NONE;void 0!==ma.antialiasingEnabled&&this._antialiasing!==za&&(this._antialiasing=za,this._requestRender());void 0!==ma.highQualityTransparency&&this._multipassTerrain!==ma.highQualityTransparency&&(this._oitEnabled=(this._multipassTerrain=ma.highQualityTransparency)&&this._hasOITSupport,this._requestRender());void 0!==ma.defaultHighlightOptions&&(this._highlightHelper.setDefaultOptions(ma.defaultHighlightOptions),
this._shadowHighlightHelper.setDefaultOptions(ma.defaultHighlightOptions),this._requestRender());void 0!==ma.slicePlane&&this._sliceHelper.plane!==ma.slicePlane&&(this._sliceHelper.plane=w.unwrap(ma.slicePlane),this._requestRender());void 0!==ma.waterReflectionEnabled&&this._waterReflectionEnabled!==ma.waterReflectionEnabled&&(this._waterReflectionEnabled=ma.waterReflectionEnabled,this._requestRender());void 0!==ma.fillLightsEnabled&&this._hasFillLights!==ma.fillLightsEnabled&&(this._hasFillLights=
ma.fillLightsEnabled,this._requestRender());void 0!==ma.opaqueTerrain&&this._opaqueTerrain!==ma.opaqueTerrain&&(this._opaqueTerrain=ma.opaqueTerrain,this._requestRender());void 0!==ma.hasOverlayWater&&this._hasOverlayWater!==ma.hasOverlayWater&&(this._hasOverlayWater=ma.hasOverlayWater,this._requestRender());void 0!==ma.shadowCastOptions&&this._shadowAccumulator.setOptions(ma.shadowCastOptions)};la.modify=function(ma){this._isRendering&&console.warn("Renderer.modify called while rendering");const {adds:ra,
removes:va,updates:ya}=ma;if(0!==ra.length||0!==va.length||0!==ya.length){va.forAll(({id:pa})=>this._content.delete(pa));ra.forAll(pa=>this._content.set(pa.id,pa));var za=!1;I.splitRenderGeometryChangeSetByMaterial(ma).forEach((pa,wa)=>{let na=this._materialRenderers.get(wa);if(!na)if(0<pa.adds.length)na=new W.MergedRenderer(this._rctx,this._materialRepository,wa),this._materialRenderers.set(wa,na);else return;na.modify(pa);na.isEmpty&&(za=!0)});za&&this._materialRenderers.forEach((pa,wa)=>{pa.isEmpty&&
(this._materialRenderers.delete(wa),pa.dispose())});this._hasHighlights=x.someMap(this._materialRenderers,pa=>pa.hasHighlights);this._hasOccludees=x.someMap(this._materialRenderers,pa=>pa.hasOccludees);this._hasWater=x.someMap(this._materialRenderers,pa=>pa.hasWater);this._needsTransparentPass=x.someMap(this._materialRenderers,pa=>pa.requiresSlot(K.RenderSlot.TRANSPARENT_MATERIAL,O.RenderPass.MATERIAL));this._hasHUDElements=x.someMap(this._materialRenderers,pa=>pa.requiresSlot(K.RenderSlot.LINE_CALLOUTS_HUD_DEPTH,
O.RenderPass.MATERIAL)||pa.requiresSlot(K.RenderSlot.HUD_MATERIAL,O.RenderPass.MATERIAL)||pa.requiresSlot(K.RenderSlot.LABEL_MATERIAL,O.RenderPass.MATERIAL));this._requestRender()}};la.updateAnimation=function(ma){this._hasAnimations=!1;this._materialRenderers.forEach(ra=>this._hasAnimations=ra.updateAnimation(ma)||this._hasAnimations);return this._hasAnimations=this._renderPlugins.updateAnimation(ma)||this._hasAnimations};la.updateLightSources=function(ma,ra,va){this._lighting.groundLightingFactor=
ra;this._lighting.globalFactor=va;this._lighting.set(ma)};la.render=function(ma,ra,va,ya){this._isRendering=!0;this.performanceInfo.prerender(this._rctx);this._bindParameters.lighting=this._lighting;this._renderContext.hasOccludees=this._hasOccludees;this._renderContext.transparencyPassType=this._bindParameters.transparencyPassType=v.TransparencyPassType.NONE;this._renderContext.hasFillLights=this._bindParameters.hasFillLights=this._hasFillLights;var za=this._offscreenRendering;za.needLastFrameColorTexture=
this.hasWaterReflection;za.advanceCurrentRenderTarget();const pa=this._sliceHelper.plane;ya===v.Decorations.OFF&&(this._sliceHelper.plane=null);this._rctx.bindFramebuffer(ma);ra.setGLViewport(this._rctx);this.needsShadowCast&&(this.renderPassManager.shadowCastingEnabled=!0);this._renderPlugins.prepareRender(ra,va);this.performanceInfo.advance(aa.Statistics.Prepare);var wa=this._computeDepthRange(ra);this._renderShadowMap(ma,ra,this._lighting.lightingMainDirection,wa);this.performanceInfo.advance(aa.Statistics.Shadowmap);
za.initializeFrame(ra);this._ensureBindParameters(ra);this._renderLinearDepth();this.performanceInfo.advance(aa.Statistics.Lineardepth);this._accumulateShadows(wa,ra,va);this._renderNormal();this.performanceInfo.advance(aa.Statistics.Normals);this._ensureBindParametersSSR();this._ensureBindParametersCloudsReflections();this._ssaoHelper.computeSSAO(ra,za.linearDepthTexture,za.normalTexture);this.performanceInfo.advance(aa.Statistics.SSAO);this._renderContext.pass=O.RenderPass.MATERIAL;za.bindFramebuffer();
this._renderOpaqueGeometry();this.performanceInfo.advance(aa.Statistics.Opaque);ra=this._multipassTerrain&&!this._opaqueTerrain;this._renderTerrainLinearDepth(ra);this._setMultipassFlags(ra);this._setTerrainCulling(ra);this._renderEdges(H.Transparency.OPAQUE);this.performanceInfo.advance(aa.Statistics.OpaqueEdges);this._renderHiddenTransparentEdges();(va=this._needsTransparentPass||this._renderPlugins.needsTransparentPass)&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),
!1):this._renderTransparentGeometry());this.performanceInfo.advance(aa.Statistics.Transparent);this._renderGeometryLinearDepth(ra);wa=this._renderHUDVisibility();ra||this._renderInternalSlot(K.RenderSlot.LINE_CALLOUTS);this.performanceInfo.advance(aa.Statistics.Hudvisibility);this._renderEdges(H.Transparency.TRANSPARENT,ra);this.performanceInfo.advance(aa.Statistics.TransparentEdges);this._renderSlot(K.RenderSlot.VOXEL);this._renderTransparentTerrain();!this._opaqueTerrain&&wa&&(ra?this._renderLineCallouts(z.HUDTransparentRenderStyle.OCCLUDED):
za.compositeTransparentTerrainOntoHUDVisibility(),this._renderHUD(z.HUDTransparentRenderStyle.OCCLUDED,za.framebuffer),this.performanceInfo.advance(aa.Statistics.HudOccluded));this.performanceInfo.advance(aa.Statistics.TransparentTerrain);this._setTerrainCulling(!1);this._opaqueTerrain||(za.compositeTransparentTerrainOntoMain(),ra&&(this._renderEdges(H.Transparency.OPAQUE),this.performanceInfo.advance(aa.Statistics.OpaqueEdges),va&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),
!1):this._renderTransparentGeometry()),this.performanceInfo.advance(aa.Statistics.Transparent),this._renderEdges(H.Transparency.TRANSPARENT),this.performanceInfo.advance(aa.Statistics.TransparentEdges)));ra&&this._renderLineCallouts(z.HUDTransparentRenderStyle.NOTOCCLUDED);this._setMultipassFlags(!1);this._shadowAccumulator.render();za.renderToTargets(()=>{this._renderInternalSlot(K.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL);this._renderSlot(K.RenderSlot.POSTPROCESSING_ENVIRONMENT_TRANSPARENT);
this._renderSlot(K.RenderSlot.LASERLINES)},za.currentColorTarget,za.mainDepth);this.performanceInfo.advance(aa.Statistics.Atmosphere);this._renderPlugins.needsLaserlineWithContrastControl&&za.renderTmpAndCompositeToMain(()=>this._renderSlot(K.RenderSlot.LASERLINES_CONTRAST_CONTROL),V.AlphaMode.PremultipliedAlpha);this.performanceInfo.advance(aa.Statistics.Laserline);this._renderOccluded();this.performanceInfo.advance(aa.Statistics.Occluded);za=(ya=ya===v.Decorations.ON&&this._magnifierHelper.enabled)&&
w.isNone(ma)?this._offscreenRendering.getFramebuffer(this._offscreenRendering.tmpColor,this._offscreenRendering.tmpDepth):ma;this._rctx.bindFramebuffer(za);ra=this._offscreenRendering.colorTexture;!this._renderAntiAliasing(this._antialiasing,ra)&&w.isSome(ra)&&this._compositingHelper.composite(ra,V.AlphaMode.None);this.performanceInfo.advance(aa.Statistics.Antialiasing);this._renderHUD(z.HUDTransparentRenderStyle.NOTOCCLUDED,za);this.performanceInfo.advance(aa.Statistics.HudNotoccluded);this._renderHighlights(za,
this._bindParameters);this.performanceInfo.advance(aa.Statistics.Highlights);ya&&this._magnifierHelper.render(this._rctx,this._bindParameters);za!==ma&&(this._rctx.bindFramebuffer(ma),this._compositingHelper.composite(this._offscreenRendering.tmpColorTexture,V.AlphaMode.None));this._disposeOITBuffers();this._renderContext.lastFrameCamera.copyFrom(this._renderContext.camera);this._sliceHelper.plane=pa;this._isRendering=!1;if(this.onPostRender)this.onPostRender();this.performanceInfo.postrender()};
la.finish=function(ma){this._hasAnimations||(this._animationTimestep=l.Milliseconds(0));ma===v.RenderRequestType.BACKGROUND&&(this._rctx.gl.getError(),this._animationTimestep=l.Milliseconds(Math.max(.9*this._animationTimestep+this.performanceInfo.elapsedTime/u.MAXIMUM_ANIMATION_LOAD*(1-.9),u.MINIMUM_IDLE_ANIMATION_MS)))};la.readDepthPixels=function(ma,ra,va,ya,za,pa){const wa=this._offscreenRendering.bindTarget(this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth);this._needsLinearDepth||
(this._ensureBindParameters(ma),this._renderContext.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(X.ClearBufferBit.COLOR_BUFFER_BIT|X.ClearBufferBit.DEPTH_BUFFER_BIT|X.ClearBufferBit.STENCIL_BUFFER_BIT),this._renderGeometryAndTransparentTerrainPass(O.RenderPass.MATERIAL_DEPTH));wa.readPixels(ra,va,ya,za,X.PixelFormat.RGBA,X.PixelType.UNSIGNED_BYTE,pa)};la.readAccumulatedShadow=function(ma,ra){return this._shadowAccumulator.readAccumulatedShadow(ma,ra)};la._setMultipassFlags=
function(ma){this._renderContext.multipassTerrainParams.multipassTerrainEnabled=this._bindParameters.multipassTerrainEnabled=ma;this._renderContext.multipassGeometryParams.multipassGeometryEnabled=this._bindParameters.multipassGeometryEnabled=ma};la._setTerrainCulling=function(ma){this._renderContext.multipassTerrainParams.cullAboveGround=this._bindParameters.cullAboveGround=ma};la._renderSlot=function(ma){this._renderContext.slot=ma;this._renderPlugins.render()};la._renderEdges=function(ma,ra=!1){const va=
this._edgeView;w.isSome(va)&&va.shouldRender()&&this._offscreenRendering.renderTmpAndCompositeToMain(()=>va.render(this._bindParameters,ma),V.AlphaMode.Alpha,ra)};la._renderShadowMap=function(ma,ra,va,ya){const za=this._shadowMap;za.enabled&&(za.start(ra,va,ya),this._shadowHighlightHelper.updateParameters(ra,va),this.needsShadowHighlight?(this._renderShadowCascades(O.RenderPass.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT,this._shadowMap,pa=>za.takeCascadeSnapshotTo(pa,Y.HighlightShadowMapSlot)),za.clear(),
this._renderShadowCascades(O.RenderPass.MATERIAL_DEPTH_SHADOWMAP_DEFAULT,this._shadowMap,pa=>{za.takeCascadeSnapshotTo(pa,Y.DefaultSnapshotSlot);this._renderGeometryAndTransparentTerrainPass(O.RenderPass.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT)})):this._renderShadowCascades(O.RenderPass.MATERIAL_DEPTH_SHADOWMAP_ALL),za.finish(ma),ra.setGLViewport(this._rctx))};la._renderShadowCascades=function(ma,ra=this._shadowMap,va=ya=>{}){for(const ya of ra.getCascades())ya.camera.setGLViewport(this._rctx),this._ensureCameraBindParameters(ya.camera),
this._renderGeometryAndTransparentTerrainPass(ma),va(ya)};la._renderLinearDepth=function(){this._needsLinearDepth?this._offscreenRendering.renderToTargets(()=>this._renderGeometryAndTransparentTerrainPass(O.RenderPass.MATERIAL_DEPTH),this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.linearDepth);this._renderContext.ssrParams.linearDepthTexture=this._bindParameters.linearDepthTexture=this._offscreenRendering.linearDepthTexture};
la._renderTerrainLinearDepth=function(ma){ma?(ma=this._renderContext.pass,this._renderContext.pass=O.RenderPass.MATERIAL_DEPTH,this._offscreenRendering.renderToTargets(()=>this._renderTransparentTerrain(),this._offscreenRendering.terrainLinearDepth,this._offscreenRendering.tmpDepth,[-1E10,-1E10,-1E10,1],!0,!0),this._renderContext.pass=ma):this._offscreenRendering.disposeTarget(this._offscreenRendering.terrainLinearDepth);this._renderContext.multipassTerrainParams.terrainLinearDepthTexture=this._bindParameters.terrainLinearDepthTexture=
this._offscreenRendering.terrainLinearDepthTexture};la._renderGeometryLinearDepth=function(ma){ma?(ma=this._renderContext.pass,this._offscreenRendering.renderToTargets(()=>this._renderGeometryPass(O.RenderPass.MATERIAL_DEPTH),this._offscreenRendering.geometryLinearDepth,this._offscreenRendering.tmpDepth,[1,1,1,1],!0,!0),this._renderContext.pass=ma):this._offscreenRendering.disposeTarget(this._offscreenRendering.geometryLinearDepth);this._renderContext.multipassGeometryParams.geometryLinearDepthTexture=
this._bindParameters.geometryLinearDepthTexture=this._offscreenRendering.geometryLinearDepthTexture};la._renderNormal=function(){this.needsNormal?this._offscreenRendering.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(O.RenderPass.MATERIAL_NORMAL)},this._offscreenRendering.normal,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.normal)};la._computeDepthRange=function(ma){if(!this.needsDepthRange)return A.ZERO;const ra=
E.depthRangeFromScene(ma,this._content,this._stage.layers);A.union(ra,this.renderPlugins.queryDepthRange(ma));ra.near=Math.max(ma.near,ra.near);ra.far=Math.min(ma.far,ra.far);return ra};la._renderGeometryAndTransparentTerrainPass=function(ma){this._renderContext.pass=ma;this._renderGeometryPass(ma);this._renderTransparentTerrain()};la._renderGeometryPass=function(ma){this._renderContext.pass=ma;this._renderOpaqueGeometry();this._renderTransparentGeometry()};la._renderOpaqueGeometry=function(){this._renderSlot(K.RenderSlot.INTEGRATED_MESH);
this._renderSlot(K.RenderSlot.OPAQUE_TERRAIN);this._renderInternalSlot(K.RenderSlot.OPAQUE_MATERIAL);this._renderSlot(K.RenderSlot.OPAQUE_PLUGIN);this._renderSlot(K.RenderSlot.POSTPROCESSING_ENVIRONMENT_OPAQUE)};la._renderTransparentGeometry=function(){this._renderInternalSlot(K.RenderSlot.TRANSPARENT_MATERIAL);this._renderSlot(K.RenderSlot.TRANSPARENT_PLUGIN)};la._renderTransparentTerrain=function(){this._renderSlot(K.RenderSlot.TRANSPARENT_TERRAIN)};la._renderHUDVisibility=function(){let ma=!1;
this._renderContext.offscreenRenderingHelper&&this._renderContext.offscreenRenderingHelper.renderHUDVisibility(()=>{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper.hudVisibilityTexture;ma=this._renderInternalSlot(K.RenderSlot.OCCLUSION_PIXELS)},this._multipassTerrain&&!this._opaqueTerrain);return ma};la._renderLineCallouts=function(ma){this._bindParameters.renderTransparentlyOccludedHUD=ma;ma===z.HUDTransparentRenderStyle.OCCLUDED?this._offscreenRendering.renderToTargets(()=>
this._renderInternalSlot(K.RenderSlot.LINE_CALLOUTS),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this._renderInternalSlot(K.RenderSlot.LINE_CALLOUTS)};la._renderHUD=function(ma,ra){this._hasHUDElements&&(this._oitEnabled?(this._renderOrderIndependentTransparency(()=>this._renderHUDElements(ma),!0),this._rctx.bindFramebuffer(ra),this._compositingHelper.composite(this._offscreenRendering.hudColorTexture,V.AlphaMode.PremultipliedAlpha)):ma===z.HUDTransparentRenderStyle.OCCLUDED?
this._offscreenRendering.renderToTargets(()=>this._renderHUDElements(z.HUDTransparentRenderStyle.OCCLUDED),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this._renderHUDElements(ma))};la._renderHUDElements=function(ma){this._bindParameters.renderTransparentlyOccludedHUD=ma;this._renderInternalSlot(K.RenderSlot.LINE_CALLOUTS_HUD_DEPTH);this._renderInternalSlot(K.RenderSlot.HUD_MATERIAL);this._renderInternalSlot(K.RenderSlot.LABEL_MATERIAL)};la._renderHighlights=
function(ma,ra){if(this.needsHighlight){var va=this._highlightHelper,ya=va.profilingCallback&&ba.startMeasurement(this._renderContext.rctx);this._renderContext.highlightDepthTexture=ra.highlightDepthTexture;var za=this._offscreenRendering.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(O.RenderPass.MATERIAL_HIGHLIGHT);this._rctx.clearSafe(X.ClearBufferBit.DEPTH_BUFFER_BIT);this._renderHUDElements(z.HUDTransparentRenderStyle.BOTH)},this._offscreenRendering.highlight,this._offscreenRendering.tmpDepth,
[0,0,0,0],!0,!0);this._bindParameters.highlightColorTexture=za.colorTexture;this.needsShadowHighlight&&this._shadowHighlightHelper.render(ra,ma);va.render(this._renderContext.camera,za,ma);w.isSome(ya)&&va.profilingCallback&&ya.stop(pa=>{va.profilingCallback&&va.profilingCallback(pa)})}else this._offscreenRendering.disposeTarget(this._offscreenRendering.highlight)};la._accumulateShadows=function(ma,ra,va){this.needsShadowCast&&(this._shadowAccumulator.setAccumulationDependencies(this._offscreenRendering.linearDepthTexture,
ma,ra,va),this._shadowAccumulator.accumulateFixedSamples(),this.renderPassManager.shadowCastingEnabled=this._shadowMap.enabled)};la._renderOrderIndependentTransparency=function(ma,ra){const va=za=>{this._renderContext.transparencyPassType=za;this._bindParameters.transparencyPassType=this._renderContext.transparencyPassType;this._offscreenRendering.renderOITPass(()=>ma(),za,ra)},ya=this._renderContext.pass;this._renderContext.pass=O.RenderPass.MATERIAL_ALPHA;va(v.TransparencyPassType.Alpha);this._renderContext.pass=
O.RenderPass.MATERIAL;va(v.TransparencyPassType.Color);va(v.TransparencyPassType.FrontFace);this._offscreenRendering.compositeTransparentOntoOpaque(ra);this._renderContext.transparencyPassType=v.TransparencyPassType.NONE;this._bindParameters.transparencyPassType=this._renderContext.transparencyPassType;this._renderContext.pass=ya;this._oitUsed=!0};la._disposeOITBuffers=function(){this._oitUsed||(this._offscreenRendering.disposeTarget(this._offscreenRendering.alphaFloatTarget),this._offscreenRendering.disposeTarget(this._offscreenRendering.colorFloatTarget),
this._offscreenRendering.disposeTarget(this._offscreenRendering.frontFaceTarget));this._oitUsed=!1};la._renderOccluded=function(){let ma=0;this._materialRenderers.forEach((pa,wa)=>{wa&&wa.isVisible()&&wa.renderOccluded===F.RenderOccludedFlag.OccludeAndTransparentStencil&&(ma|=wa.renderOccluded,ka.push(wa))});const ra=this._offscreenRendering,va=(pa,wa,na,qa,ta)=>{0!==(ma&wa)&&(ra.renderToTargets(na,ra.tmpColor,ra.mainDepth,[0,0,0,0],qa,ta),ra.compositeOccludedOntoMain(pa))};0!==ka.length&&(this._renderInternalSlot(K.RenderSlot.OCCLUDER_MATERIAL,
ka),va(.5,F.RenderOccludedFlag.OccludeAndTransparentStencil,()=>this._renderInternalSlot(K.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL,ka),!1,!1),ka.length=0);this._materialRenderers.forEach((pa,wa)=>{wa&&wa.isVisible()&&(wa.renderOccluded===F.RenderOccludedFlag.OccludeAndTransparent||wa.renderOccluded===F.RenderOccludedFlag.Transparent||wa.renderOccluded===F.RenderOccludedFlag.Opaque)&&(ma|=wa.renderOccluded,ha.push(wa))});const ya=this._renderPlugins.renderOccludedFlags;if(ma|=ya){var za=pa=>{this._renderContext.renderOccludedMask=
pa;ya>F.RenderOccludedFlag.Occlude&&this._renderSlot(K.RenderSlot.OCCLUDED_TERRAIN);this._renderInternalSlot(K.RenderSlot.OPAQUE_MATERIAL,ha);this._renderInternalSlot(K.RenderSlot.TRANSPARENT_MATERIAL,ha);this._renderInternalSlot(K.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,ha);this._renderContext.resetRenderOccludedMask()};this._renderContext.pass=O.RenderPass.MATERIAL;va(.5,F.RenderOccludedFlag.OccludeAndTransparent,()=>za(F.RenderOccludedFlag.OccludeAndTransparent),!0,v.StencilBits.OutlineVisualElementMask);
va(.5,F.RenderOccludedFlag.Transparent,()=>za(F.RenderOccludedFlag.Transparent),!0,v.StencilBits.OutlineVisualElementMask);va(1,F.RenderOccludedFlag.Opaque,()=>za(F.RenderOccludedFlag.Opaque),!0,v.StencilBits.OutlineVisualElementMask);ha.length=0}};la._renderAntiAliasing=function(ma,ra){if(ma===v.AntiAliasingMode.SMAA){if(this._smaaPass.enable(()=>this._requestRender())&&w.isSome(ra))return this._smaaPass.render(ra),!0}else this._smaaPass.disable();return!1};la._ensureCameraBindParameters=function(ma){this._renderContext.camera=
ma;this._bindParameters.camera=this._renderContext.camera;this._bindParameters.inverseViewport[0]=1/this._renderContext.camera.fullViewport[2];this._bindParameters.inverseViewport[1]=1/this._renderContext.camera.fullViewport[3]};la._ensureBindParameters=function(ma){var ra;this._ensureCameraBindParameters(ma);ma=this._renderContext.offscreenRenderingHelper;this._bindParameters.shadowMap=this._renderContext.shadowMap;this._bindParameters.shadowMappingEnabled=this._renderContext.shadowMap.enabled;this._bindParameters.ssaoHelper=
this._renderContext.ssaoHelper;this._bindParameters.ssaoEnabled=this._renderContext.ssaoHelper.enabled;this._bindParameters.slicePlane=this._renderContext.sliceHelper.plane;this._bindParameters.hasOccludees=this._renderContext.hasOccludees;this._renderContext.multipassTerrainParams.camera=this._renderContext.camera;this._bindParameters.hudVisibilityTexture=ma.hudVisibilityTexture;this._bindParameters.highlightDepthTexture=null!=(ra=ma.depthTexture)?ra:this._getFallbackDepthTexture()};la._ensureBindParametersSSR=
function(){this.hasWaterReflection?(this._renderContext.lastFrameCamera.equals(this._renderContext.camera)?this._renderContext.ssrParams.reprojectionMatrix=this._reprojectionMatrix=h.IDENTITY:(p.translate(ia,this._renderContext.lastFrameCamera.viewMatrix,this._bindParameters.origin?this._bindParameters.origin:[0,0,0]),p.translate(ca,this._renderContext.camera.viewMatrix,this._bindParameters.origin?this._bindParameters.origin:[0,0,0]),p.invert(ca,ca),p.invert(ea,this._renderContext.camera.projectionMatrix),
p.multiply(Z,ca,ea),p.multiply(Z,ia,Z),p.multiply(Z,this._renderContext.lastFrameCamera.projectionMatrix,Z),this._renderContext.ssrParams.reprojectionMatrix=this._reprojectionMatrix=Z),this._renderContext.ssrParams.camera=this._renderContext.camera,this._renderContext.ssrParams.lastFrameColorTexture=this._bindParameters.lastFrameColorTexture=this._offscreenRendering.lastFrameColorTexture):this._renderContext.ssrParams.lastFrameColorTexture=this._bindParameters.lastFrameColorTexture=null;this._renderContext.ssrParams.ssrEnabled=
this._bindParameters.ssrEnabled=this.hasWaterReflection};la._ensureBindParametersCloudsReflections=function(){this._bindParameters.cloudsCompositionParams=this._renderContext.cloudsCompositionParams};la._renderInternalSlot=function(ma,ra){let va=!1;this._bindParameters.slot=ma;w.isSome(ra)?ra.forEach(ya=>{ya.shouldRender(this._renderContext)&&(ya=this._materialRenderers.get(ya),w.isSome(ya)&&(va=ya.render(ma,this._renderContext.pass,this._bindParameters)||va))}):this._materialRenderers.forEach((ya,
za)=>{za.shouldRender(this._renderContext)&&(va=ya.render(ma,this._renderContext.pass,this._bindParameters)||va)});return va};la._getFallbackDepthTexture=function(){this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=C.createEmptyDepthTexture(this._rctx));return this._fallbackDepthStencilTexture};b._createClass(ja,[{key:"hasWater",get:function(){return this._hasWater||this._hasOverlayWater}},{key:"hasWaterReflection",get:function(){return this.hasWater&&this._waterReflectionEnabled}},
{key:"updating",get:function(){return this._antialiasing===v.AntiAliasingMode.SMAA&&this._smaaPass.updating||w.isSome(this._edgeView)&&this._edgeView.updating||this._shadowAccumulator.running||!this.isCameraFinal}},{key:"edgeView",get:function(){return this._edgeView}},{key:"isCameraFinal",get:function(){return null===this._bindParameters.reprojectionMatrix||p.equals(this._bindParameters.reprojectionMatrix,h.IDENTITY)}},{key:"_reprojectionMatrix",set:function(ma){p.equals(this._bindParameters.reprojectionMatrix,
ma)||(this._bindParameters.reprojectionMatrix=ma,this.notifyChange("isCameraFinal"))}},{key:"hasShadowsEnabled",get:function(){var ma;return!(null==(ma=this._shadowMap)||!ma.enabled)}},{key:"hasSlicePlane",get:function(){return!!this._sliceHelper.plane}},{key:"renderPlugins",get:function(){return this._renderPlugins}},{key:"_hasOITSupport",get:function(){return this._rctx.driverTest.floatBufferBlendWorking}},{key:"animationTimestep",get:function(){return this._animationTimestep}},{key:"_needsLinearDepth",
get:function(){return this._ssaoHelper.enabled||this._renderPlugins.needsLinearDepth||this._hasWater&&this._waterReflectionEnabled||this.needsShadowHighlight||this.needsShadowCast}},{key:"needsNormal",get:function(){return this._ssaoHelper.enabled}},{key:"needsDepthRange",get:function(){return this._shadowMap.enabled||this.needsShadowCast}},{key:"needsHighlight",get:function(){return this._hasHighlights||this._renderPlugins.needsHighlight}},{key:"needsShadowHighlight",get:function(){return this._shadowMap.enabled&&
this._shadowHighlightHelper.isVisible&&this.needsHighlight}},{key:"needsShadowCast",get:function(){return this._shadowAccumulator.isAccumulating}},{key:"gpuMemoryUsage",get:function(){var ma,ra,va,ya,za,pa,wa,na,qa,ta;return{offscreen:null!=(ma=null==(ra=this._offscreenRendering)?void 0:ra.gpuMemoryUsage)?ma:0,highlights:(null!=(va=null==(ya=this._highlightHelper)?void 0:ya.gpuMemoryUsage)?va:0)+(null!=(za=null==(pa=this._shadowHighlightHelper)?void 0:pa.gpuMemoryUsage)?za:0),shadows:null!=(wa=null==
(na=this._shadowMap)?void 0:na.gpuMemoryUsage)?wa:0,ssao:null!=(qa=null==(ta=this._ssaoHelper)?void 0:ta.gpuMemoryUsage)?qa:0}}},{key:"test",get:function(){const ma=this;return{offscreen:this._offscreenRendering,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlightHelper,lighting:this._lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,getFramebufferTexture:ra=>{var va;switch(ra){case a.FramebufferId.Color:return ma._offscreenRendering.colorTexture;
case a.FramebufferId.LinearDepth:return ma._offscreenRendering.linearDepthTexture;case a.FramebufferId.Normals:return ma._offscreenRendering.normalTexture;case a.FramebufferId.ShadowMap:return null==(va=ma._shadowMap)?void 0:va.test.depthTexture;case a.FramebufferId.HudVisibility:return ma._offscreenRendering.hudVisibilityTexture;case a.FramebufferId.Highlight:return ma._offscreenRendering.highlightTexture}}}}}]);return ja}(d);c.__decorate([f.property()],a.Renderer.prototype,"_shadowAccumulator",
void 0);c.__decorate([f.property()],a.Renderer.prototype,"_smaaPass",void 0);c.__decorate([f.property()],a.Renderer.prototype,"_antialiasing",void 0);c.__decorate([f.property()],a.Renderer.prototype,"_edgeView",void 0);c.__decorate([f.property()],a.Renderer.prototype,"updating",null);c.__decorate([f.property()],a.Renderer.prototype,"isCameraFinal",null);a.Renderer=c.__decorate([y.subclass("esri.views.3d.webgl-engine.lib.Renderer")],a.Renderer);a.FramebufferId=void 0;(function(fa){fa[fa.Color=0]="Color";
fa[fa.LinearDepth=1]="LinearDepth";fa[fa.Normals=2]="Normals";fa[fa.ShadowMap=3]="ShadowMap";fa[fa.HudVisibility=4]="HudVisibility";fa[fa.Highlight=5]="Highlight"})(a.FramebufferId||(a.FramebufferId={}));const ha=[],ka=[],ia=h.create(),ea=h.create(),ca=h.create(),Z=h.create();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/animationUtils":function(){define(["exports","../../../core/time"],function(a,b){b=b.Milliseconds(1E3/30);a.MAXIMUM_ANIMATION_LOAD=.5;a.MINIMUM_IDLE_ANIMATION_MS=
b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/renderPasses/RenderPassManager":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/mat4 ../../../../../chunks/vec2 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../chunks/vec4 ../../../../../chunks/boundedPlane ./AllRenderPasses ./RenderPass ../util/TwoVectorPosition ../../lib/depthRange ../../lib/RenderPass ../../lib/RenderSlot".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m){let u=function(){function v(A,E){this.rctx=A;this.shaderTechniqueRepository=E;this.canRender=!0;this._materialPassParams=new k.MaterialPassesParameters;this._shadowPassParams=new k.ShadowMapPassParameters;this._highlightPassParams=new k.HighlightPassParameters;this._systems=new Set;this._passes={materialOpaque:new r.RenderPass(A,this.shaderTechniqueRepository),materialTransparent:new r.RenderPass(A,this.shaderTechniqueRepository,r.RenderPassSorting.BackToFront),
materialIntegratedMesh:new r.RenderPass(A,this.shaderTechniqueRepository),shadowMap:new r.RenderPass(A,this.shaderTechniqueRepository),highlight:new r.RenderPass(A,this.shaderTechniqueRepository),highlightIntegratedMesh:new r.RenderPass(A,this.shaderTechniqueRepository),highlightShadowMap:new r.RenderPass(A,this.shaderTechniqueRepository),defaultShadowMap:new r.RenderPass(A,this.shaderTechniqueRepository)}}var B=v.prototype;B.register=function(A){this._systems.add(A)};B.prepareRender=function(A){if(0!==
this._systems.size){for(const E of Object.values(this._passes))E.prepareSubmit();this._systems.forEach(E=>E.submit(this._passes,{camera:A}));for(const E of Object.values(this._passes))E.finishSubmit();this.shaderTechniqueRepository.frameUpdate()}};B.render=function(A){if(0!==this._systems.size)switch(this._configure(A),A.slot){case m.RenderSlot.OPAQUE_PLUGIN:switch(A.pass){case h.RenderPass.MATERIAL:return this._materialPassParams.subPass=k.MaterialSubPass.Color,this._configureMaterialColorPass(A),
this._passes.materialOpaque.dispatch(this._materialPassParams);case h.RenderPass.MATERIAL_DEPTH:return this._materialPassParams.subPass=k.MaterialSubPass.Depth,this._passes.materialOpaque.dispatch(this._materialPassParams);case h.RenderPass.MATERIAL_NORMAL:return this._materialPassParams.subPass=k.MaterialSubPass.Normal,this._passes.materialOpaque.dispatch(this._materialPassParams);case h.RenderPass.MATERIAL_HIGHLIGHT:return this._passes.highlight.dispatch(this._highlightPassParams);case h.RenderPass.MATERIAL_DEPTH_SHADOWMAP_ALL:return this._passes.shadowMap.dispatch(this._shadowPassParams);
case h.RenderPass.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT:return this._passes.highlightShadowMap.dispatch(this._shadowPassParams);case h.RenderPass.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return this._passes.defaultShadowMap.dispatch(this._shadowPassParams)}break;case m.RenderSlot.TRANSPARENT_PLUGIN:switch(A.pass){case h.RenderPass.MATERIAL:return this._materialPassParams.subPass=k.MaterialSubPass.Color,this._configureMaterialColorPass(A),this._passes.materialTransparent.dispatch(this._materialPassParams);case h.RenderPass.MATERIAL_ALPHA:return this._materialPassParams.subPass=
k.MaterialSubPass.Alpha,this._configureMaterialColorPass(A),this._passes.materialTransparent.dispatch(this._materialPassParams);case h.RenderPass.MATERIAL_DEPTH:return this._materialPassParams.subPass=k.MaterialSubPass.Depth,this._passes.materialTransparent.dispatch(this._materialPassParams);case h.RenderPass.MATERIAL_NORMAL:return this._materialPassParams.subPass=k.MaterialSubPass.Normal,this._passes.materialTransparent.dispatch(this._materialPassParams)}break;case m.RenderSlot.INTEGRATED_MESH:switch(A.pass){case h.RenderPass.MATERIAL:return this._materialPassParams.subPass=
k.MaterialSubPass.Color,this._configureMaterialColorPass(A),this._materialPassParams.ssrParams=A.ssrParams,this._passes.materialIntegratedMesh.dispatch(this._materialPassParams);case h.RenderPass.MATERIAL_DEPTH:return this._materialPassParams.subPass=k.MaterialSubPass.Depth,this._passes.materialIntegratedMesh.dispatch(this._materialPassParams);case h.RenderPass.MATERIAL_NORMAL:return this._materialPassParams.subPass=k.MaterialSubPass.Normal,this._passes.materialIntegratedMesh.dispatch(this._materialPassParams);
case h.RenderPass.MATERIAL_HIGHLIGHT:return this._passes.highlightIntegratedMesh.dispatch(this._highlightPassParams)}}};B.notifyDirty=function(){this._context.requestRender()};B.slots=function(){return[m.RenderSlot.OPAQUE_PLUGIN,m.RenderSlot.TRANSPARENT_PLUGIN,m.RenderSlot.INTEGRATED_MESH]};B.initializeRenderContext=function(A){this._context=A};B.uninitializeRenderContext=function(){};B.queryDepthRange=function(A){const E={near:Infinity,far:-Infinity};this._systems.forEach(C=>{C=C.queryShadowCasterDepthRange(A);
c.isSome(C)&&p.union(E,C,E)});return E};B._configureMaterialColorPass=function(A){this._materialPassParams.bindShadowMap=E=>{A.shadowMap.bind(E);const C=this._materialPassParams.viewTransform;l.add(t,C.transformWorldFromViewTL,C.transformWorldFromViewTH);A.shadowMap.bindView(E,t)};this._materialPassParams.bindAmbientOcclusion=E=>A.ssaoHelper.bind(E,A.camera);this._materialPassParams.ambientOcclusionEnabled=!!A.ssaoHelper&&A.ssaoHelper.ready;this._materialPassParams.sceneHasOcludees=A.hasOccludees};
B._configure=function(A){this._updateParameters(A,A.pass===h.RenderPass.MATERIAL_DEPTH_SHADOWMAP_ALL||A.pass===h.RenderPass.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT||A.pass===h.RenderPass.MATERIAL_DEPTH_SHADOWMAP_DEFAULT?this._shadowPassParams:A.pass===h.RenderPass.MATERIAL_HIGHLIGHT?this._highlightPassParams:this._materialPassParams)};B._updateParameters=function(A,E){const C=A.camera,D=C.viewInverseTransposeMatrix;l.set(t,D[3],D[7],D[11]);z.set(t);l.copy(E.viewTransform.transformWorldFromViewTH,z.high);
l.copy(E.viewTransform.transformWorldFromViewTL,z.low);d.fromMat4(E.viewTransform.transformViewFromCameraRelativeRS,C.viewMatrix);x.copy(E.viewTransform.transformProjFromView,C.projectionMatrix);E.identifier===k.RenderPassIdentifier.Material?(this._materialPassParams.transparent=A.slot===m.RenderSlot.TRANSPARENT_PLUGIN,this._materialPassParams.integratedMesh=A.slot===m.RenderSlot.INTEGRATED_MESH,this._materialPassParams.lighting=A.scenelightingData,d.transpose(q,E.viewTransform.transformViewFromCameraRelativeRS),
d.invert(E.transformNormalViewFromGlobal,q),w.copy(E.nearFar,C.nearFar)):E.identifier===k.RenderPassIdentifier.ShadowMap?w.copy(E.nearFar,C.nearFar):E.identifier===k.RenderPassIdentifier.Highlight&&(E.highlightDepthTexture=A.highlightDepthTexture,f.copy(E.viewport,C.fullViewport));if(E.identifier===k.RenderPassIdentifier.Material||E.identifier===k.RenderPassIdentifier.Highlight)E.inverseViewport[0]=1/C.fullViewport[2],E.inverseViewport[1]=1/C.fullViewport[3];e.copyWithoutVerify(A.sliceHelper.plane,
E.slicePlane);l.subtract(E.slicePlane.origin,E.slicePlane.origin,t);E.slicePlaneEnabled=A.sliceHelper.isEnabled;this._materialPassParams.slot=A.slot;this._materialPassParams.transparencyPassType=A.transparencyPassType;this._materialPassParams.multipassTerrainParams=A.multipassTerrainParams};b._createClass(v,[{key:"shadowCastingEnabled",get:function(){return this._materialPassParams.shadowsEnabled},set:function(A){this._materialPassParams.shadowsEnabled=A}},{key:"fillLightsEnabled",get:function(){return this._materialPassParams.hasFillLights},
set:function(A){this._materialPassParams.hasFillLights=A}},{key:"screenSpaceReflectionsEnabled",get:function(){return c.isSome(this._materialPassParams.ssrParams.ssrEnabled)},set:function(A){this._materialPassParams.ssrParams.ssrEnabled=!!A}},{key:"needsHighlight",get:function(){return 0<this._passes.highlight.count||0<this._passes.highlightIntegratedMesh.count}},{key:"needsTransparentPass",get:function(){return 0<this._passes.materialTransparent.count}}]);return v}();const t=n.create(),q=g.create(),
z=new y.TwoVectorPosition;a.RenderPassManager=u;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/renderPasses/RenderPass":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../core/PooledArray ../../lib/basicInterfaces ../../../../webgl/enums".split(" "),function(a,b,c,d,g,x){a.RenderPassSorting=void 0;(function(n){n[n.FrontToBack=0]="FrontToBack";n[n.BackToFront=1]="BackToFront"})(a.RenderPassSorting||
(a.RenderPassSorting={}));let w=function(){function n(e,k,r=a.RenderPassSorting.FrontToBack){this._rctx=e;this._techniqueRepository=k;this._sorting=r;this._draws=new d({initialSize:32,allocator:y=>y||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}});this._passBoundTechniques=new Set;this._previouslyBoundMaterials=new Map;this._previouslyBoundDraw=new Map}var f=n.prototype;f.submitDraw=function(e,k,r,y,p){const h=this._draws.pushNew();h.geometry=
k;h.geometryRanges=r;h.material=e;h.bindDrawParams=y;h.depthSquaredHint=p;h.indexType=k.indexed?c.unwrap(k.vao.indexBuffer).indexType:0};f.dispatch=function(e){const k=this._rctx;this._passBoundTechniques.clear();this._previouslyBoundMaterials.clear();this._previouslyBoundDraw.clear();let r=null;const y=this._draws.map(u=>u.material.prepareTechnique(this._techniqueRepository,e,u.geometry.parameters)),p=this._draws.length;for(let u=0;u<p;u++){var h=y[u];if(h!==r||h.configuration.transparencyPassType!==
g.TransparencyPassType.NONE)k.useTechnique(h,e.slot),r=h;this._passBoundTechniques.has(h)||(h.bindPass(e),this._passBoundTechniques.add(h));var m=this._draws.data[u];const t=m.geometry;k.bindVAO(t.vao);this._previouslyBoundMaterials.get(h)!==m.material&&(h.bindMaterial(m.material,e),this._previouslyBoundMaterials.set(h,m.material));this._previouslyBoundDraw.get(h)!==m.bindDrawParams&&(h.bindDraw(m.bindDrawParams),this._previouslyBoundDraw.set(h,m.bindDrawParams));h=m.geometryRanges;const q=h.length;
if(0!==m.indexType){const z=l.get(m.indexType);for(let v=0;v<q;v+=2)k.drawElements(t.primitiveType,h[v+1],m.indexType,h[v]*z)}else for(m=0;m<q;m+=2)k.drawArrays(t.primitiveType,h[m],h[m+1])}};f.prepareSubmit=function(){this._draws.clear()};f.finishSubmit=function(){const e=this._sorting===a.RenderPassSorting.FrontToBack?1:-1;this._draws.sort((k,r)=>{const y=e*(k.depthSquaredHint-r.depthSquaredHint);return 0!==y?y:k.geometry.vao.size-r.geometry.vao.size})};b._createClass(n,[{key:"count",get:function(){return this._draws.length}}]);
return n}();const l=new Map;l.set(x.DataType.UNSIGNED_BYTE,1);l.set(x.DataType.UNSIGNED_SHORT,2);l.set(x.DataType.UNSIGNED_INT,4);a.RenderPass=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/HighlightHelper":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec4 ../../../../chunks/vec4f32 ../../../../chunks/vec4f64 ../../support/debugFlags ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ./glUtil3D ../../../../chunks/HighlightComposition.glsl ../shaders/HighlightTechnique ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Util ../../../webgl/VertexArrayObject".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h){return function(){function m(t,q){this._techniqueRep=t;this._rctx=q;this.viewportToRestore=g.create();this.defaultOptions={color:d.fromValues(1,0,1,1),haloColor:d.fromValues(1,0,1,1),haloOpacity:1,fillOpacity:.2,haloOpacityOccluded:.25,fillOpacityOccluded:.05,shadowColor:d.fromValues(1,0,1,1),shadowOpacity:.15,occludedShadowOpacity:.075};this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,
viewportHeight:0}}var u=m.prototype;u._assertResources=function(){if(!this.quadVAO){this.quadVAO=n.createQuadVAO(this._rctx);var t={colorTarget:r.TargetType.TEXTURE,depthStencilTarget:r.DepthStencilTargetType.NONE,width:0,height:0},q={target:r.TextureType.TEXTURE_2D,pixelFormat:r.PixelFormat.RGBA,dataType:r.PixelType.UNSIGNED_BYTE,samplingMode:r.TextureSamplingMode.LINEAR,wrapMode:r.TextureWrapMode.CLAMP_TO_EDGE,width:0,height:0};this.blur0Fbo=new y.FramebufferObject(this._rctx,t,q);this.blur1Fbo=
new y.FramebufferObject(this._rctx,t,q);t=new e.HighlightCompositionTechniqueConfiguration;t.highlightStage=f.HighlightCompositionPass.Blur;t.gridOptimization=!1;this.blurTechnique=this._techniqueRep.acquire(e.HighlightCompositionTechnique,t);t.highlightStage=f.HighlightCompositionPass.Blur;t.gridOptimization=!0;this.blurGridTechnique=this._techniqueRep.acquire(e.HighlightCompositionTechnique,t);t.highlightStage=f.HighlightCompositionPass.Apply;t.gridOptimization=!1;this.applyTechnique=this._techniqueRep.acquire(e.HighlightCompositionTechnique,
t);t.highlightStage=f.HighlightCompositionPass.Apply;t.gridOptimization=!0;this.applyGridTechnique=this._techniqueRep.acquire(e.HighlightCompositionTechnique,t);t.highlightStage=f.HighlightCompositionPass.Downsample;t.gridOptimization=!1;this.downsampleTechnique=this._techniqueRep.acquire(e.HighlightCompositionTechnique,t)}};u.dispose=function(){if(this._grid.coverageMipmap)for(let t=1;t<this._grid.coverageMipmap.length;t++)this._grid.coverageMipmap[t].dispose();this._grid.vao&&this._grid.vao.dispose(!0);
this.quadVAO&&(this.quadVAO.dispose(!0),this.quadVAO=null);this.blur0Fbo=b.disposeMaybe(this.blur0Fbo);this.blur1Fbo=b.disposeMaybe(this.blur1Fbo)};u.setDefaultOptions=function(t){this.defaultOptions=t};u.render=function(t,q,z){var v=t.pixelRatio;const B=x.HIGHLIGHTS_GRID_OPTIMIZATION_ENABLED,A=this._rctx;this._assertResources();c.copy(this.viewportToRestore,t.fullViewport);var E=Math.ceil(t.fullWidth/v);v=Math.ceil(t.fullHeight/v);this.blur0Fbo.resize(E,v);this.blur1Fbo.resize(E,v);A.bindVAO(this.quadVAO);
t=null;const C=B?this.blurGridTechnique:this.blurTechnique,D=A.useTechnique(C);B?(this._gridUpdateResources(q,32),this._gridComputeMipmap(),t=this._grid.vao,D.bindTexture(this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,"coverageTex")):t=this.quadVAO;A.bindVAO(t);A.bindFramebuffer(this.blur0Fbo);A.setViewport(0,0,E,v);A.setClearColor(0,0,0,0);A.clear(r.ClearBufferBit.COLOR_BUFFER_BIT);D.bindTexture(q.colorTexture,"tex");D.setUniform2f("blurSize",1/E,0);A.drawArrays(C.primitiveType,
0,p.vertexCount(t,"geometry"));A.bindFramebuffer(this.blur1Fbo);A.clear(r.ClearBufferBit.COLOR_BUFFER_BIT);D.bindTexture(this.blur0Fbo.colorTexture,"tex");D.setUniform2f("blurSize",0,1/v);A.drawArrays(C.primitiveType,0,p.vertexCount(t,"geometry"));A.bindFramebuffer(z);A.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3]);z=B?this.applyGridTechnique:this.applyTechnique;E=A.useTechnique(z);E.bindTexture(this.blur1Fbo.colorTexture,"tex");
E.bindTexture(q.colorTexture,"origin");B&&E.bindTexture(this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,"coverageTex");z.bindApplyPass(this.defaultOptions);A.drawArrays(z.primitiveType,0,p.vertexCount(t,"geometry"));A.bindVAO(null)};u._gridUpdateResources=function(t,q){const z=this._rctx,v=this._grid;var B=!1;null===v.coverageMipmap&&(v.coverageMipmap=[t],B=!0);if(v.viewportWidth!==t.width||v.viewportHeight!==t.height)B=!0,v.viewportWidth=t.width,v.viewportHeight=t.height;v.coverageMipmap[0]=
t;v.cellPixelSize!==q&&(v.cellPixelSize=q,B=!0);if(B){for(q=1;q<v.coverageMipmap.length;q++)v.coverageMipmap[q].dispose();v.mipmapLevels=Math.ceil(Math.log(v.cellPixelSize)*Math.LOG2E);v.coverageMipmap.length=v.mipmapLevels+1;for(q=0;q<v.mipmapLevels;q++)B=v.coverageMipmap[q],v.coverageMipmap[q+1]=new y.FramebufferObject(z,{colorTarget:r.TargetType.TEXTURE,depthStencilTarget:r.DepthStencilTargetType.NONE,width:Math.ceil(B.width/2),height:Math.ceil(B.height/2)},{target:r.TextureType.TEXTURE_2D,pixelFormat:r.PixelFormat.RGB,
dataType:r.PixelType.UNSIGNED_SHORT_5_6_5,samplingMode:r.TextureSamplingMode.LINEAR,wrapMode:r.TextureWrapMode.CLAMP_TO_EDGE,width:Math.ceil(B.width/2),height:Math.ceil(B.height/2)})}B=Math.ceil(t.height/v.cellPixelSize);var A=Math.ceil(t.width/v.cellPixelSize);if(!v.vao||v.verticalCellCount!==B||v.horizontalCellCount!==A){v.verticalCellCount=B;v.horizontalCellCount=A;t=B+1;q=A+1;B=1/B;A=1/A;const E=new Float32Array(24*t*q);let C=0;for(let D=0;D<t;D++)for(let F=0;F<q;F++)E[C+0]=(F-.5)*A*2-1,E[C+1]=
(D-.5)*B*2-1,E[C+2]=F*A,E[C+3]=D*B,E[C+4]=(F+.5)*A*2-1,E[C+5]=(D-.5)*B*2-1,E[C+6]=F*A,E[C+7]=D*B,E[C+8]=(F-.5)*A*2-1,E[C+9]=(D+.5)*B*2-1,E[C+10]=F*A,E[C+11]=D*B,E[C+12]=(F-.5)*A*2-1,E[C+13]=(D+.5)*B*2-1,E[C+14]=F*A,E[C+15]=D*B,E[C+16]=(F+.5)*A*2-1,E[C+17]=(D-.5)*B*2-1,E[C+18]=F*A,E[C+19]=D*B,E[C+20]=(F+.5)*A*2-1,E[C+21]=(D+.5)*B*2-1,E[C+22]=F*A,E[C+23]=D*B,C+=24;v.vao&&v.vao.dispose(!0);v.vao=new h.VertexArrayObject(z,w.Default3D,{geometry:l.Pos2Tex},{geometry:k.BufferObject.createVertex(z,r.Usage.STATIC_DRAW,
E)})}};u._gridComputeMipmap=function(){const t=this._rctx,q=this._grid,z=t.useTechnique(this.downsampleTechnique);t.bindVAO(this.quadVAO);for(let v=0;v<q.mipmapLevels;v++){t.bindFramebuffer(q.coverageMipmap[v+1]);z.bindTexture(q.coverageMipmap[v].colorTexture,"tex");const B=q.coverageMipmap[v+1].width,A=q.coverageMipmap[v+1].height;z.setUniform2f("invFramebufferDim",1/B,1/A);t.setViewport(0,0,B,A);t.drawArrays(r.PrimitiveType.TRIANGLE_STRIP,0,p.vertexCount(this.quadVAO,"geometry"))}};a._createClass(m,
[{key:"profilingCallback",get:function(){return x.HIGHLIGHTS_PROFILE_TO_CONSOLE?t=>console.log(t):null}},{key:"gpuMemoryUsage",get:function(){let t=(b.isSome(this.blur0Fbo)?this.blur0Fbo.gpuMemoryUsage:0)+(b.isSome(this.blur1Fbo)?this.blur1Fbo.gpuMemoryUsage:0);if(this._grid.coverageMipmap)for(const q of this._grid.coverageMipmap)t+=q.gpuMemoryUsage;return t}},{key:"test",get:function(){return{coverage:this._grid.coverageMipmap,blur:[this.blur0Fbo,this.blur1Fbo]}}}]);return m}()})},"esri/chunks/HighlightComposition.glsl":function(){define(["exports",
"../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/lib/VertexAttribute"],function(a,b,c,d){function g(w){const l=new c.ShaderBuilder,n=l.vertex.code,f=l.fragment.code;l.attributes.add(d.VertexAttribute.POSITION,"vec2");w.highlightStage===a.HighlightCompositionPass.Downsample&&(n.add(b.glsl`void main() {
gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);
}`),l.fragment.uniforms.add("tex","sampler2D"),l.fragment.uniforms.add("invFramebufferDim","vec2"),f.add(b.glsl`void main() {
vec2 coord = gl_FragCoord.xy * invFramebufferDim;
vec4 value = texture2D(tex, coord);
float mx = floor(max(value.g, value.b));
gl_FragColor = vec4(ceil(value.r), mx, mx, 1.0);
}`));w.highlightStage===a.HighlightCompositionPass.Blur&&(l.attributes.add(d.VertexAttribute.UV0,"vec2"),w.gridOptimization?(l.vertex.uniforms.add("coverageTex","sampler2D"),l.fragment.uniforms.add("blurSize","vec2"),l.varyings.add("blurCoordinate","vec3")):(l.vertex.uniforms.add("blurSize","vec2"),l.varyings.add("blurCoordinates[5]","vec2")),n.add(b.glsl`
    void main() {
      gl_Position = vec4(position, 0.0, 1.0);
      ${w.gridOptimization?b.glsl`
      vec4 cov = texture2D(coverageTex, uv0);
      if (cov.r == 0.0) {
        gl_Position = vec4(0.0);
      }
      blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));
      `:b.glsl`
      vec2 uv = position.xy * 0.5 + vec2(0.5);
      blurCoordinates[0] = uv;
      blurCoordinates[1] = uv + blurSize * 1.407333;
      blurCoordinates[2] = uv - blurSize * 1.407333;
      blurCoordinates[3] = uv + blurSize * 3.294215;
      blurCoordinates[4] = uv - blurSize * 3.294215;
          `}
    }`),l.fragment.uniforms.add("tex","sampler2D"),f.add(b.glsl`
    void main() {
      ${w.gridOptimization?b.glsl`
          vec2 uv = blurCoordinate.xy;
          vec4 center = texture2D(tex, uv);

          // do not blur if no pixel or all pixels in neighborhood are set
          if (blurCoordinate.z == 1.0) {
            gl_FragColor = center;
          } else {
            vec4 sum = vec4(0.0);
            sum += center * 0.204164;
            sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;
            sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;
            sum += texture2D(tex, uv + blurSize * 3.294215) * 0.093913;
            sum += texture2D(tex, uv - blurSize * 3.294215) * 0.093913;
            gl_FragColor = sum;
          }`:b.glsl`
          vec4 sum = vec4(0.0);
          sum += texture2D(tex, blurCoordinates[0]) * 0.204164;
          sum += texture2D(tex, blurCoordinates[1]) * 0.304005;
          sum += texture2D(tex, blurCoordinates[2]) * 0.304005;
          sum += texture2D(tex, blurCoordinates[3]) * 0.093913;
          sum += texture2D(tex, blurCoordinates[4]) * 0.093913;
          gl_FragColor = sum;`}
    }`));w.highlightStage===a.HighlightCompositionPass.Apply&&(l.varyings.add("uv","vec2"),w.gridOptimization&&(l.attributes.add(d.VertexAttribute.UV0,"vec2"),l.vertex.uniforms.add("coverageTex","sampler2D")),n.add(b.glsl`
      void main() {
        ${w.gridOptimization?b.glsl`
            vec4 cov = texture2D(coverageTex, uv0);
            // if no highlight pixel set in this block, hide block
            if (cov.r == 0.0) {
              gl_Position = vec4(0.0);
              return;
            }`:""}
        gl_Position = vec4(position, 0.0, 1.0);
        uv = position.xy * 0.5 + vec2(0.5);
      }`),l.fragment.uniforms.add("tex","sampler2D"),l.fragment.uniforms.add("origin","sampler2D"),l.fragment.uniforms.add("uColor","vec4"),l.fragment.uniforms.add("haloColor","vec4"),l.fragment.uniforms.add("outlineSize","float"),l.fragment.uniforms.add("blurSize","float"),l.fragment.uniforms.add("opacities","vec4"),f.add(b.glsl`void main() {
vec4 blurredHighlightValue = texture2D(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture2D(origin, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - outlineSize / 9.0;
float outer = 1.0 - (outlineSize + blurSize) / 9.0;
float outlineFactor = smoothstep(outer, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
gl_FragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`));return l}a.HighlightCompositionPass=void 0;(function(w){w[w.Blur=0]="Blur";w[w.Apply=1]="Apply";w[w.Downsample=2]="Downsample";w[w.COUNT=3]="COUNT"})(a.HighlightCompositionPass||(a.HighlightCompositionPass={}));const x=Object.freeze({__proto__:null,get HighlightCompositionPass(){return a.HighlightCompositionPass},build:g});a.HighlightCompositionShader=x;a.build=g})},"esri/views/3d/webgl-engine/shaders/HighlightTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/HighlightComposition.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k){x=function(r){function y(){return r.apply(this,arguments)||this}c._inheritsLoose(y,r);var p=y.prototype;p.initializeProgram=function(h){const m=y.shader.get().build(this.configuration);return new n.Program(h.rctx,m,l.Default3D)};p.bindApplyPass=function(h){this.program.setUniform4fv("uColor",h.color);this.program.setUniform4fv("haloColor",h.haloColor);this.program.setUniform1f("outlineSize",8.6);this.program.setUniform1f("blurSize",.4);this.program.setUniform4f("opacities",
h.haloOpacity,h.haloOpacityOccluded,h.fillOpacity,h.fillOpacityOccluded)};p.initializePipeline=function(){return this.configuration.highlightStage===f.HighlightCompositionPass.Apply?k.makePipelineState({blending:k.separateBlendingParams(e.BlendFactor.SRC_ALPHA,e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA,e.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:k.defaultColorWriteParams}):k.makePipelineState({colorWrite:k.defaultColorWriteParams})};c._createClass(y,[{key:"primitiveType",get:function(){return this.configuration.gridOptimization?
e.PrimitiveType.TRIANGLES:e.PrimitiveType.TRIANGLE_STRIP}}]);return y}(x.ShaderTechnique);x.shader=new g.ReloadableShaderModule(f.HighlightCompositionShader,()=>new Promise((r,y)=>a(["./HighlightComposition.glsl"],r,y)));g=function(r){function y(){var p=r.apply(this,arguments)||this;p.highlightStage=f.HighlightCompositionPass.Blur;p.gridOptimization=!1;return p}c._inheritsLoose(y,r);return y}(w.ShaderTechniqueConfiguration);d.__decorate([w.parameter({count:f.HighlightCompositionPass.COUNT})],g.prototype,
"highlightStage",void 0);d.__decorate([w.parameter()],g.prototype,"gridOptimization",void 0);b.HighlightCompositionTechnique=x;b.HighlightCompositionTechniqueConfiguration=g;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/OffscreenRendering":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ./basicInterfaces ./RenderTargetHelper ../../../../chunks/Compositing.glsl ../shaders/CompositingTechnique ../../../webgl/context-util ../../../webgl/enums".split(" "),
function(a,b,c,d,g,x,w,l,n){let f=function(){function r(p,h){this._rctx=p;this._compositingHelper=h;this._mainColorTarget=0;this._dimensions={width:4,height:4};this._needLastFrameColorTexture=!1;this._background={type:"color",color:[0,0,0,1]};const m=p.type===l.ContextType.WEBGL2,u=this._renderTargetHelper=new g.RenderTargetHelper(p);this.mainColorTargets=[u.registerColorTarget({name:"mainColorTarget0"}),u.registerColorTarget({name:"mainColorTarget1"})];this.frontFaceTarget=u.registerColorTarget({name:"frontFaceTarget"});
p=t=>u.registerColorTarget({name:t,dataType:n.PixelType.FLOAT,internalFormat:m?n.SizedPixelFormat.RGBA32F:n.PixelFormat.RGBA,samplingMode:n.TextureSamplingMode.NEAREST});this.colorFloatTarget=p("colorFloatTarget");this.alphaFloatTarget=p("alphaFloatTarget");this.mainDepth=u.registerDepthTarget({name:"mainDepth"});this.linearDepth=u.registerColorTarget({name:"linearDepth",samplingMode:n.TextureSamplingMode.NEAREST});this.terrainLinearDepth=u.registerColorTarget({name:"terrainLinearDepth"});this.geometryLinearDepth=
u.registerColorTarget({name:"geometryLinearDepth"});this.normal=u.registerColorTarget({name:"normal"});this.highlight=u.registerColorTarget({name:"highlight",internalFormat:m?n.SizedPixelFormat.RGBA4:n.PixelFormat.RGBA,dataType:n.PixelType.UNSIGNED_SHORT_4_4_4_4});this.hudVisibility=u.registerColorTarget({name:"hudVisibility",internalFormat:m?n.SizedPixelFormat.RGBA4:n.PixelFormat.RGBA,dataType:n.PixelType.UNSIGNED_SHORT_4_4_4_4});this.tmpColor=u.registerColorTarget({name:"tmpColor"});this.tmpDepth=
u.registerDepthTarget({name:"tmpDepth"});this.hudColor=u.registerColorTarget({name:"hudColor"})}var y=r.prototype;y.dispose=function(){this._renderTargetHelper.dispose()};y.getFramebuffer=function(p,h){return this._renderTargetHelper.getFramebuffer(this._dimensions,p,h)};y.advanceCurrentRenderTarget=function(){this._mainColorTarget=0===this._mainColorTarget&&this._needLastFrameColorTexture?1:0};y.initializeFrame=function(p){const h=this._rctx;this._dimensions.width=p.fullWidth;this._dimensions.height=
p.fullHeight;this.bindTarget(this.currentColorTarget,this.mainDepth);h.setClearStencil(0);p=this._background.color;h.setClearColor(p[0]*p[3],p[1]*p[3],p[2]*p[3],p[3]);h.clearSafe(n.ClearBufferBit.COLOR_BUFFER_BIT|n.ClearBufferBit.DEPTH_BUFFER_BIT|n.ClearBufferBit.STENCIL_BUFFER_BIT)};y.composite=function(){c.isSome(this.colorTexture)&&this._compositingHelper.composite(this.colorTexture,w.AlphaMode.None)};y.renderTmpAndCompositeToMain=function(p,h,m=!1){this.renderToTargets(p,this.tmpColor,m?this.tmpDepth:
this.mainDepth,e);this._compositingHelper.composite(this._getColorTexture(this.tmpColor),h)};y.renderHUDVisibility=function(p,h=!1){this.renderToTargets(p,this.hudVisibility,h?this.tmpDepth:this.mainDepth,k)};y.compositeTransparentTerrainOntoHUDVisibility=function(){this.renderToTargets(()=>this._compositingHelper.composite(this._getColorTexture(this.tmpColor),w.AlphaMode.None,1,x.CompositingFunction.TransparentToHUDVisibility),this.hudVisibility,this.tmpDepth)};y.renderOITPass=function(p,h,m){let u,
t;switch(h){case d.TransparencyPassType.Color:u=this.colorFloatTarget;t=[0,0,0,0];break;case d.TransparencyPassType.Alpha:u=this.alphaFloatTarget;t=[1,1,1,1];break;case d.TransparencyPassType.FrontFace:u=this.frontFaceTarget,t=[0,0,0,0]}m?this.renderToTargets(p,u,this.tmpDepth,t,!0,!0):this.renderToTargets(p,u,this.mainDepth,t,!1)};y.compositeTransparentTerrainOntoMain=function(){this.bindFramebuffer();this._compositingHelper.composite(this._getColorTexture(this.tmpColor),w.AlphaMode.PremultipliedAlpha)};
y.compositeOccludedOntoMain=function(p){this.bindFramebuffer();this._compositingHelper.composite(this._getColorTexture(this.tmpColor),w.AlphaMode.PremultipliedAlpha,p)};y.compositeTransparentOntoOpaque=function(p){p?(this.bindTarget(this.hudColor,this.tmpDepth),this._rctx.setClearColor(0,0,0,1E-13),this._rctx.clearSafe(n.ClearBufferBit.COLOR_BUFFER_BIT)):this.bindFramebuffer();this._compositingHelper.compositeTransparent(this._getColorTexture(this.colorFloatTarget),this._getColorTexture(this.alphaFloatTarget),
this._getColorTexture(this.frontFaceTarget))};y.bindFramebuffer=function(){this._rctx.bindFramebuffer(this.framebuffer)};y.renderDepthDetached=function(p){this.bindTarget(this.currentColorTarget);p();this.bindTarget(this.currentColorTarget,this.mainDepth)};y.disposeTarget=function(p){this._renderTargetHelper.disposeTargetResource(p)};y.renderToTargets=function(p,h,m,u,t=!1,q=!1){const z=this._rctx;h=this.bindTarget(h,m);m=0;u&&(z.setClearColor(u[0],u[1],u[2],Math.max(1E-13,u[3])),m|=n.ClearBufferBit.COLOR_BUFFER_BIT);
t&&(m|=n.ClearBufferBit.DEPTH_BUFFER_BIT);!1===q?q=0:(!0===q&&(q=255),m|=n.ClearBufferBit.STENCIL_BUFFER_BIT);m&&z.clearSafe(m,q);p();z.gl.flush();this.bindTarget(this.currentColorTarget,this.mainDepth);return h};y.bindTarget=function(p,h){p=this._renderTargetHelper.getFramebuffer(this._dimensions,p,h);this._rctx.bindFramebuffer(p);return p};y._getColorTexture=function(p){return this._renderTargetHelper.getColorTexture(p,this._dimensions)};b._createClass(r,[{key:"width",get:function(){return this._dimensions.width}},
{key:"height",get:function(){return this._dimensions.height}},{key:"background",get:function(){return this._background},set:function(p){this._background=p}},{key:"currentColorTarget",get:function(){return this.mainColorTargets[this._mainColorTarget]}},{key:"previousColorTarget",get:function(){return this.mainColorTargets[1-this._mainColorTarget]}},{key:"framebuffer",get:function(){return this.getFramebuffer(this.currentColorTarget,this.mainDepth)}},{key:"colorTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}},
{key:"depthTexture",get:function(){return this._renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}},{key:"linearDepthTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}},{key:"terrainLinearDepthTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.terrainLinearDepth)}},{key:"geometryLinearDepthTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.geometryLinearDepth)}},{key:"lastFrameColorTexture",
get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}},{key:"normalTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.normal)}},{key:"highlightTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.highlight)}},{key:"hudVisibilityTexture",get:function(){return this._getColorTexture(this.hudVisibility)}},{key:"tmpColorTexture",get:function(){return this._getColorTexture(this.tmpColor)}},{key:"hudColorTexture",
get:function(){return this._getColorTexture(this.hudColor)}},{key:"mainColorTexture",get:function(){return this._getColorTexture(this.currentColorTarget)}},{key:"needLastFrameColorTexture",get:function(){return this._needLastFrameColorTexture},set:function(p){!p&&this._needLastFrameColorTexture&&(this._mainColorTarget=0,this.disposeTarget(this.mainColorTargets[1]));this._needLastFrameColorTexture=p}},{key:"gpuMemoryUsage",get:function(){let p=0;this._renderTargetHelper&&(p+=this._renderTargetHelper.gpuMemoryUsage);
return p}}]);return r}();const e=[0,0,0,0],k=[0,1,0,1];a.OffscreenRendering=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/RenderTargetHelper":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/uid ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Renderbuffer ../../../webgl/Texture ../../../webgl/Util".split(" "),function(a,b,c,d,g,x,w,l,n){const f={dataType:g.PixelType.UNSIGNED_BYTE,
internalFormat:g.PixelFormat.RGBA},e={};let k=function(){function r(p){this.rctx=p;this._activeTargets=new Set;this._depthTextures=new Map;this._depthBuffers=new Map;this._colorTextures=new Map;this._framebuffers=new Map;this.depthTextureSupported=p.capabilities.depthTexture}var y=r.prototype;y.dispose=function(){this._depthBuffers.forEach(p=>p.dispose());this._depthBuffers.clear();this._depthTextures.forEach(p=>p.dispose());this._depthTextures.clear();this._colorTextures.forEach(p=>p.dispose());
this._colorTextures.clear();this._framebuffers.forEach(p=>p.dispose());this._framebuffers.clear();this._activeTargets.clear()};y.disposeTargetResource=function(p){p=p.id;this._activeTargets.has(p)&&(this._activeTargets.delete(p),this._disposeWithFramebuffers(this._depthTextures,p),this._disposeWithFramebuffers(this._depthBuffers,p),this._disposeWithFramebuffers(this._colorTextures,p))};y._disposeWithFramebuffers=function(p,h){const m=p.get(h);m&&(this._framebuffers.forEach((u,t)=>{if(u.colorAttachment===
m||u.depthStencilAttachment===m)u.detachAll(),u.dispose(),this._framebuffers.delete(t)}),m.dispose(),p.delete(h))};y.getDepthTexture=function(p,h){if(!this.depthTextureSupported)return null;let m=this._depthTextures.get(p.id);!m||m.descriptor.width===h.width&&m.descriptor.height===h.height||(m.dispose(),m=null);m||(m=new l.Texture(this.rctx,{target:g.TextureType.TEXTURE_2D,pixelFormat:g.PixelFormat.DEPTH_STENCIL,dataType:g.PixelType.UNSIGNED_INT_24_8,samplingMode:g.TextureSamplingMode.NEAREST,wrapMode:g.TextureWrapMode.CLAMP_TO_EDGE,
width:h.width,height:h.height}),this._depthTextures.set(p.id,m),this._activeTargets.add(p.id));return m};y.getAllocatedDepthTexture=function(p){return this._depthTextures.get(p.id)};y.getDepthBuffer=function(p,h){if(this.depthTextureSupported)return null;let m=this._depthBuffers.get(p.id);m?m.descriptor.width===h.width&&m.descriptor.height===h.height||m.resize(h.width,h.height):(m=new w.Renderbuffer(this.rctx,{internalFormat:g.RenderbufferFormat.DEPTH_STENCIL,...h}),this._depthBuffers.set(p.id,m),
this._activeTargets.add(p.id));return m};y.getColorTexture=function(p,h){let m=this._colorTextures.get(p.id);!m||m.descriptor.width===h.width&&m.descriptor.height===h.height||(m.dispose(),m=null);m||(m=new l.Texture(this.rctx,{target:g.TextureType.TEXTURE_2D,pixelFormat:g.PixelFormat.RGBA,internalFormat:p.internalFormat,dataType:p.dataType,samplingMode:null!=p.samplingMode?p.samplingMode:g.TextureSamplingMode.LINEAR,wrapMode:g.TextureWrapMode.CLAMP_TO_EDGE,width:h.width,height:h.height}),this._colorTextures.set(p.id,
m),this._activeTargets.add(p.id));return m};y.getAllocatedColorTexture=function(p){return this._colorTextures.get(p.id)};y.registerDepthTarget=function(p={}){return{id:d.generateUID(),...e,...p}};y.registerColorTarget=function(p={}){return{id:d.generateUID(),...f,...p}};y.getFramebuffer=function(p,h,m){const u=this._getKey(h,m);let t=this._framebuffers.get(u);h=this.getColorTexture(h,p);if(this.depthTextureSupported){var q=m?this.getDepthTexture(m,p):void 0;if(!t)return t=c.isSome(m)?new x.FramebufferObject(this.rctx,
{colorTarget:g.TargetType.TEXTURE,depthStencilTarget:g.DepthStencilTargetType.DEPTH_STENCIL_TEXTURE},h,q):new x.FramebufferObject(this.rctx,{colorTarget:g.TargetType.TEXTURE,depthStencilTarget:g.DepthStencilTargetType.NONE},h),this._framebuffers.set(u,t),t;if(t.width!==p.width||t.height!==p.height||t.colorTexture!==h||t.depthStencilTexture!==q)t.detachAll(),t.resize(p.width,p.height),t.attachColorTexture(h),t.attachDepthStencilTexture(q);return t}q=m?this.getDepthBuffer(m,p):void 0;if(!t)return t=
new x.FramebufferObject(this.rctx,{colorTarget:g.TargetType.TEXTURE,depthStencilTarget:m?g.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER:g.DepthStencilTargetType.NONE},h,q),this._framebuffers.set(u,t),t;if(t.width!==p.width||t.height!==p.height||t.colorTexture!==h)t.detachAll(),t.resize(p.width,p.height),t.attachColorTexture(h),t.attachDepthStencilBuffer(q);return t};y._getKey=function(p,h){return`${p.id}_${h?h.id:"X"}_${p.name}${h?"_"+h.name:""}`};b._createClass(r,[{key:"gpuMemoryUsage",get:function(){let p=
0;const h=new Set,m=u=>{h.has(u)||(h.add(u),p+=n.getGpuMemoryUsage(u))};this._depthTextures.forEach(m);this._colorTextures.forEach(m);this._depthBuffers.forEach(m);return p}}]);return r}();a.RenderTargetHelper=k;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/RenderPluginManager":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/promiseUtils ./depthRange ./RenderSlot ./Util".split(" "),function(a,b,c,d,g,x){let w=function(){function n(e){this.context=
e;this.renderPlugins=[];this.slots=[];for(e=0;e<g.RenderSlot.MAX_SLOTS;++e)this.slots[e]=[]}var f=n.prototype;f.add=function(e,k,r){const y=()=>{this.renderPlugins.push(k);for(const p of e)this.slots[p].push(k);this.context.requestRender()};r=k.initializeRenderContext(this.context,r);if(c.isPromiseLike(r))return r.then(y);y()};f.remove=function(e){var k=this.renderPlugins.length;this.renderPlugins=this.renderPlugins.filter(r=>r!==e);x.assert(this.renderPlugins.length<k,"Removing non-added render plugin");
for(k=0;k<this.slots.length;++k)this.slots[k]=this.slots[k].filter(r=>r!==e);e.uninitializeRenderContext();this.context.requestRender()};f.prepareRender=function(e,k){for(const r of this.renderPlugins)r.prepareRender&&r.prepareRender(e,k)};f.updateAnimation=function(e){let k=!1;this.renderPlugins.forEach(r=>{r.updateAnimation&&(k=r.updateAnimation(e)||k)});return k};f.render=function(){const e=[];this.slots[this.context.renderContext.slot].filter(k=>{if(!k.canRender)return!1;if("prepareTechnique"in
k)return(k=k.prepareTechnique(this.context.renderContext))?(e.push(k),!0):!1;e.push(null);return!0}).forEach((k,r)=>k.render(this.context.renderContext,e[r]))};f.queryDepthRange=function(e){const k=l;k.near=Infinity;k.far=-Infinity;for(const r of this.renderPlugins)if(r.queryDepthRange){const y=r.queryDepthRange(e);y&&d.union(k,y,k)}return k};b._createClass(n,[{key:"needsTransparentPass",get:function(){return this.renderPlugins.some(e=>e.needsTransparentPass)}},{key:"needsHighlight",get:function(){return this.renderPlugins.some(e=>
e.needsHighlight)}},{key:"needsLinearDepth",get:function(){return this.renderPlugins.some(e=>e.needsLinearDepth)}},{key:"needsLaserlineWithContrastControl",get:function(){const e=this.slots[g.RenderSlot.LASERLINES_CONTRAST_CONTROL];return!!e&&0<e.length}},{key:"renderOccludedFlags",get:function(){let e=0;this.renderPlugins.forEach(k=>{k.renderOccludedFlags&&(e|=k.renderOccludedFlags)});return e}}]);return n}();const l={near:0,far:0};a.RenderPluginManager=w;Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/webgl-engine/lib/ShadowAccumulator":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/Handles ../../../../core/mathUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ./Camera ./depthRange ./glUtil3D ./ShadowCastRenderer ./ShadowMap ./Util ../../../../chunks/ShadowCast.glsl ../shaders/ShadowCastTechnique ../../../support/Scheduler ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Util".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E,C,D,F,G,J,I){var O;a.ShadowAccumulator=O=function(K){function M(R,L,N,T,S,H){var Q=K.call(this,{})||this;Q._rctx=R;Q._stage=N;Q._prepareForShadowMapPass=T;Q._renderToShadowMap=S;Q._requestRender=H;Q._progress=0;Q._sampleCount=0;Q._cachedCamera=new q.default;Q._contentCamera=new q.default;Q._enabled=!1;Q._cachedLightDirections=[];Q._depthRange=z.ZERO;Q._previewing=!1;Q._handles=new x;Q._cameraForcedForScreenshot=!1;Q._shadowMap=new A(R,N.viewingMode);
Q._shadowMap.enabled=!0;Q._vao=v.createQuadVAO(R);Q._fbo=new J.FramebufferObject(R,{colorTarget:G.TargetType.TEXTURE,depthStencilTarget:G.DepthStencilTargetType.NONE,width:0,height:0},{target:G.TextureType.TEXTURE_2D,pixelFormat:G.PixelFormat.RGBA,dataType:G.PixelType.UNSIGNED_BYTE,samplingMode:G.TextureSamplingMode.LINEAR,wrapMode:G.TextureWrapMode.CLAMP_TO_EDGE,width:0,height:0});Q._accumulationParams={camera:Q._cachedCamera,linearDepthTexture:null,shadowMap:Q._shadowMap,inverseViewMatrix:p.create(),
projInfo:t.create(),zScale:h.create()};Q._accumulationRenderer=new B.ShadowCastRenderer(L,R,b._assertThisInitialized(Q),H);Q._handles.add(Q._stage.resourceController.scheduler.registerTask(F.TaskPriority.SHADOW_ACCUMULATOR,b._assertThisInitialized(Q)));Q._handles.add(n.watch(()=>N.renderView,W=>{Q._handles.remove(O.renderViewHandleKey);l.isNone(W)||Q._handles.add(W.events.on("force-camera-for-screenshot",()=>Q._cameraForcedForScreenshot=!0),O.renderViewHandleKey)},n.syncAndInitial));return Q}b._inheritsLoose(M,
K);var U=M.prototype;U.normalizeCtorArgs=function(){return{}};U.runTask=function(R){for(this._prepareForShadowMapPass(this._cachedCamera,this._contentCamera);!R.done&&!this._isDoneAccumulating;)this._accumulateShadow(),R.madeProgress();this._requestRender()};U.accumulateFixedSamples=function(){if(this.isAccumulating&&this._canAccumulate){(this._previewing||0===this._progress||this._cameraForcedForScreenshot)&&this._clear();var R=this._cameraForcedForScreenshot?this._sampleCount:Math.min(O.previewSamples,
this._sampleCount-this._progress);for(let L=0;L<R;++L)this._accumulateShadow();this._cameraForcedForScreenshot=!1}};U.render=function(){this._accumulationRenderer.render()};U.dispose=function(){this._stop();this._handles.destroy();this._accumulationRenderer=l.disposeMaybe(this._accumulationRenderer);this._shadowMap=l.disposeMaybe(this._shadowMap);this._fbo=l.disposeMaybe(this._fbo);this._vao=l.disposeMaybe(this._vao);this._accumulationTechnique=l.releaseMaybe(this._accumulationTechnique);this._sampleCount=
this._cachedLightDirections.length=0};U.setOptions=function(R){void 0!==R.enabled&&this._setEnabled(R.enabled);void 0!==R.previewing&&this.setPreviewing(R.previewing);void 0!==R.lightDirections&&this.setLightDirections(R.lightDirections);this._accumulationRenderer.setOptions(R)};U.setPreviewing=function(R){this._previewing!==R&&(this._previewing=R,this._requestRenderIfEnabled())};U.setLightDirections=function(R){this._lightDirections=R};U.setAccumulationDependencies=function(R,L,N,T){this._accumulationParams.linearDepthTexture=
R;this._depthRange=L;this._updateCamera(N);this._contentCamera=T;this.notifyChange("_canAccumulate")};U.readAccumulatedShadow=function(R,L){if(!this._isActive||1>this._progress||0>R||R>this._fbo.width||0>L||L>this._fbo.height)return 0;const N=P;this._fbo.readPixels(R,L,1,1,G.PixelFormat.RGBA,G.PixelType.UNSIGNED_BYTE,N);return N[0]/this._progress};U._start=function(){this._progress=0;this._enabled=!0};U._stop=function(){this._enabled=!1};U._invalidate=function(){this._progress=0;this._requestRenderIfEnabled()};
U._clear=function(){this._rctx.bindFramebuffer(this._fbo);this._rctx.setClearColor(0,0,0,0);this._rctx.clearSafe(G.ClearBufferBit.COLOR_BUFFER_BIT);this._progress=0};U._accumulateShadow=function(){this._renderToShadowMap(this._shadowMap,this._lightDirections[this._progress],this._cachedCamera,this._depthRange);this._rctx.bindFramebuffer(this._fbo);const R=this.accumulationTechnique;this._rctx.useTechnique(R);R.bindPass(this._accumulationParams);this._rctx.bindVAO(this._vao);this._rctx.drawArrays(R.primitiveType,
0,I.vertexCount(this._vao,"geometry"));this._progress++};U._updateCamera=function(R){if(!R.equals(this._cachedCamera)){var {fullWidth:L,fullHeight:N,projectionMatrix:T,viewMatrix:S,center:H}=R;this._cachedCamera.copyFrom(R);this._fbo.resize(L,N);E.inverseProjectionInfo(T,L,N,this._projInfo,this._zScale);y.translate(this._inverseView,S,H);y.invert(this._inverseView,this._inverseView);this._opacityFromElevation=1-w.smoothstep(B.shadowCastDisableElevationMin,B.shadowCastDisableElevationMax,R.relativeElevation)}};
U._setEnabled=function(R){R!==this._enabled&&(R?this._start():this._stop())};U._requestRenderIfEnabled=function(){this._enabled&&this._requestRender()};b._createClass(M,[{key:"computedSamples",get:function(){return this._progress}},{key:"shadowCastTexture",get:function(){return this._fbo.colorTexture}},{key:"isAccumulating",get:function(){return this._isPreviewing||this._isRefining}},{key:"accumulationTechnique",get:function(){if(l.isNone(this._accumulationTechnique)){const R={rctx:this._rctx,viewingMode:this._stage.viewingMode},
L=new D.ShadowCastTechniqueConfiguration;L.pass=C.ShadowCastPass.Accumulate;this._accumulationTechnique=new D.ShadowCastTechnique(R,L)}return this._accumulationTechnique}},{key:"_isRefining",get:function(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}},{key:"_isPreviewing",get:function(){return this._isActive&&this._previewing}},{key:"_isActive",get:function(){return this._enabled&&0<this._sampleCount}},{key:"_canAccumulate",get:function(){return null!==this._accumulationParams.linearDepthTexture&&
this._depthRange!==z.ZERO&&this._opacityFromElevation>B.shadowCastDisabledElevationThreshold}},{key:"_isDoneAccumulating",get:function(){return this._progress>=this._sampleCount}},{key:"_lightDirections",get:function(){return this._cachedLightDirections},set:function(R){const L=this._cachedLightDirections;if(!g.equals(L,R,m.equals)){var N=R.length;L.length=N;this._sampleCount=Math.min(C.shadowCastMaxSamples,N);for(let T=0;T<N;++T){const S=R[T],H=L[T]||u.create();m.copy(H,S);L[T]=H}this._invalidate()}}},
{key:"_projInfo",get:function(){return this._accumulationParams.projInfo}},{key:"_zScale",get:function(){return this._accumulationParams.zScale}},{key:"_inverseView",get:function(){return this._accumulationParams.inverseViewMatrix}},{key:"_opacityFromElevation",get:function(){return this._accumulationRenderer.opacityFromElevation},set:function(R){this._accumulationRenderer.opacityFromElevation=R}},{key:"running",get:function(){return this._isRefining&&this._canAccumulate&&0<this._progress}},{key:"test",
get:function(){return{lightDirections:this._lightDirections,isDone:()=>this._isDoneAccumulating,isActive:()=>this._isActive}}}]);return M}(d);a.ShadowAccumulator.previewSamples=6;a.ShadowAccumulator.renderViewHandleKey="renderView";c.__decorate([f.property()],a.ShadowAccumulator.prototype,"_progress",void 0);c.__decorate([f.property()],a.ShadowAccumulator.prototype,"_sampleCount",void 0);c.__decorate([f.property()],a.ShadowAccumulator.prototype,"_enabled",void 0);c.__decorate([f.property()],a.ShadowAccumulator.prototype,
"_depthRange",void 0);c.__decorate([f.property()],a.ShadowAccumulator.prototype,"_previewing",void 0);c.__decorate([f.property()],a.ShadowAccumulator.prototype,"_accumulationRenderer",void 0);c.__decorate([f.property()],a.ShadowAccumulator.prototype,"_isRefining",null);c.__decorate([f.property()],a.ShadowAccumulator.prototype,"_isActive",null);c.__decorate([f.property()],a.ShadowAccumulator.prototype,"_canAccumulate",null);c.__decorate([f.property()],a.ShadowAccumulator.prototype,"_isDoneAccumulating",
null);c.__decorate([f.property()],a.ShadowAccumulator.prototype,"_opacityFromElevation",null);c.__decorate([f.property()],a.ShadowAccumulator.prototype,"running",null);a.ShadowAccumulator=O=c.__decorate([r.subclass("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],a.ShadowAccumulator);const P=new Uint8Array(4);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/ShadowCastRenderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec4 ../../../../chunks/vec4f64 ./glUtil3D ../../../../chunks/ShadowCast.glsl ../shaders/ShadowCastTechnique ../../../webgl/Util".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h){const m=k.fromValues(.01,0,.25,1),u=1/512;a.ShadowCastRenderer=function(t){function q(v,B,A,E){var C=t.call(this,{})||this;C._techniqueRepository=v;C._rctx=B;C._shadowAccumulator=A;C._requestRender=E;C._visualizationParams={shadowCastMap:C._shadowCastTexture,sampleScale:0,color:m,threshold:.5,bandSize:.1,opacityFromElevation:1};C._techniqueConfig=new p.ShadowCastTechniqueConfiguration;C._enabled=!1;C._vao=r.createQuadVAO(B);C._techniqueConfig.pass=y.ShadowCastPass.Visualize;
C._techniqueConfig.visualization=y.ShadowCastVisualization.Gradient;return C}b._inheritsLoose(q,t);var z=q.prototype;z.normalizeCtorArgs=function(){return{}};z.dispose=function(){this._stop();this._vao=g.disposeMaybe(this._vao);this._techniqueRepository.release(this._technique);this._shadowAccumulator=this._technique=null};z.render=function(){if(this._isRenderingVisualization){this._sampleScale=1/this._computedSamples;this._rctx.bindVAO(this._vao);var v=this.visualizeShadowCastTechnique;this._rctx.useTechnique(v);
v.bindPass(this._visualizationParams);this._rctx.drawArrays(v.primitiveType,0,h.vertexCount(this._vao,"geometry"))}};z.setOptions=function(v){void 0!==v.enabled&&this._setEnabled(v.enabled);void 0!==v.color&&this._setColor(v.color);void 0!==v.threshold&&(this._threshold=v.threshold);void 0!==v.visualization&&(this._visualization=v.visualization);void 0!==v.bandSize&&(this._bandSize=v.bandSize);void 0!==v.bandsEnabled&&(this._bandsEnabled=v.bandsEnabled)};z._setColor=function(v){e.exactEquals(v,this._visualizationParams.color)||
(e.copy(this._visualizationParams.color,v),this._requestRenderIfRunning())};z._setEnabled=function(v){v!==this._enabled&&(v?this._start():this._stop())};z._requestRenderIfRunning=function(){this._enabled&&this._requestRender()};z._start=function(){this._enabled=!0;this._requestRender()};z._stop=function(){this._enabled=!1;this._requestRender()};b._createClass(q,[{key:"visualizeShadowCastTechnique",get:function(){return this._technique=this._techniqueRepository.releaseAndAcquire(p.ShadowCastTechnique,
this._techniqueConfig,this._technique)}},{key:"opacityFromElevation",get:function(){return this._visualizationParams.opacityFromElevation},set:function(v){this._visualizationParams.opacityFromElevation!==v&&(this._visualizationParams.opacityFromElevation=v,this.notifyChange("opacityFromElevation"))}},{key:"_isRenderingVisualization",get:function(){return this._enabled&&0<this._computedSamples&&this.opacityFromElevation>u}},{key:"_computedSamples",get:function(){return this._shadowAccumulator.computedSamples}},
{key:"_shadowCastTexture",get:function(){return this._shadowAccumulator.shadowCastTexture}},{key:"_sampleScale",get:function(){return this._visualizationParams.sampleScale},set:function(v){this._visualizationParams.sampleScale=v}},{key:"_threshold",get:function(){return this._visualizationParams.threshold},set:function(v){this._threshold!==v&&(this._visualizationParams.threshold=v,this._requestRenderIfRunning())}},{key:"_visualization",get:function(){return this._techniqueConfig.visualization},set:function(v){v!==
this._visualization&&(this._techniqueConfig.visualization=v,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}},{key:"_bandSize",get:function(){return this._visualizationParams.bandSize},set:function(v){v!==this._bandSize&&(this._visualizationParams.bandSize=v,this._requestRenderIfRunning())}},{key:"_bandsEnabled",get:function(){return this._techniqueConfig.bandsEnabled},set:function(v){v!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=
v,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}}]);return q}(d);c.__decorate([x.property()],a.ShadowCastRenderer.prototype,"opacityFromElevation",null);a.ShadowCastRenderer=c.__decorate([f.subclass("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],a.ShadowCastRenderer);a.shadowCastDisableElevationMax=5E4;a.shadowCastDisableElevationMin=4E4;a.shadowCastDisabledElevationThreshold=u;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/ShadowCast.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,b,c,d,g,x,w,l){function n(k){const r=new l.ShaderBuilder;r.fragment.include(x.RgbaFloatEncoding);r.fragment.include(c.ReadLinearDepth);r.include(g.CameraSpace);r.include(b.ScreenSpacePass);var {pass:y}=k;if(y===a.ShadowCastPass.Visualize){const {visualization:p,bandsEnabled:h}=k;r.fragment.constants.add("inverseSampleValue","float",255);r.fragment.uniforms.add("shadowCastMap","sampler2D");r.fragment.uniforms.add("sampleScale","float");r.fragment.uniforms.add("opacityFromElevation","float");
k=p===a.ShadowCastVisualization.Gradient;y=p===a.ShadowCastVisualization.Threshold;r.fragment.uniforms.add("uColor","vec4");k?h&&r.fragment.uniforms.add("bandSize","float"):y&&r.fragment.uniforms.add("threshold","float");r.fragment.code.add(w.glsl`
      void main(void) {
        vec4 record = texture2D(shadowCastMap, uv);
        float pixelSamples = record.r * inverseSampleValue;

        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${y?w.glsl`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${k&&h?w.glsl`strength = ceil(strength / bandSize) * bandSize;`:""}

        gl_FragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${k?w.glsl`* strength`:""});
      }
    `)}else if(y===a.ShadowCastPass.Accumulate||y===a.ShadowCastPass.VisualizeCurrent)r.include(d.ReadShadowMap),r.fragment.uniforms.add("depthMap","sampler2D"),r.fragment.uniforms.add("inverseViewMatrix","mat4"),r.fragment.uniforms.add("nearFar","vec2"),y===a.ShadowCastPass.Accumulate?r.fragment.constants.add("sampleValue","float",f):r.fragment.constants.add("shadowColor","vec4",[0,0,0,.8]),r.fragment.code.add(w.glsl`
      void main(void) {

        float depth = rgba2float(texture2D(depthMap, uv));
        // 0.0 is the clear value of depthMap, which means nothing has been drawn there and we should discard
        if (depth == 0.0) {
          discard;
        }

        float currentPixelDepth = linearDepthFromFloat(depth, nearFar);

        if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
          discard;
        }

        vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
        vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;

        mat4 shadowMatrix;
        float linearDepth = -currentPixelDepth;
        int i = chooseCascade(linearDepth, shadowMatrix);

        if (i >= numCascades) {
          discard;
        }

        vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);

        // vertex completely outside? -> no shadow
        if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
          discard;
        }

        vec2 uvShadow = cascadeCoordinates(i, lvpos);

        float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
        bool shadow = depthShadow < lvpos.z;

        if (!shadow) {
          discard;
        }

        gl_FragColor = ${y===a.ShadowCastPass.Accumulate?w.glsl`vec4(sampleValue)`:w.glsl`shadowColor`};
      }
    `);return r}a.ShadowCastPass=void 0;(function(k){k[k.Accumulate=0]="Accumulate";k[k.Visualize=1]="Visualize";k[k.VisualizeCurrent=2]="VisualizeCurrent";k[k.COUNT=3]="COUNT"})(a.ShadowCastPass||(a.ShadowCastPass={}));a.ShadowCastVisualization=void 0;(function(k){k[k.Gradient=0]="Gradient";k[k.Threshold=1]="Threshold"})(a.ShadowCastVisualization||(a.ShadowCastVisualization={}));const f=1/255,e=Object.freeze({__proto__:null,get ShadowCastPass(){return a.ShadowCastPass},get ShadowCastVisualization(){return a.ShadowCastVisualization},
shadowCastMaxSamples:255,build:n});a.ShadowCast=e;a.build=n;a.shadowCastMaxSamples=255})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.CameraSpace=function(c){c.fragment.uniforms.add("projInfo","vec4");c.fragment.uniforms.add("zScale","vec2");c.fragment.code.add(b.glsl`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/ShadowCastTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../../../../chunks/ShadowCast.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r){x=function(y){function p(m,u){var t;return t=y.call(this,m,u,()=>t.destroy())||this}c._inheritsLoose(p,y);var h=p.prototype;h.initializeProgram=function(m){const u=p.shader.get().build(this.configuration);return new f.Program(m.rctx,u,l.Default3D)};h.initializePipeline=function(m){switch(this.configuration.pass){case e.ShadowCastPass.Accumulate:return r.makePipelineState({blending:r.separateBlendingParams(k.BlendFactor.ONE,k.BlendFactor.ONE,k.BlendFactor.ONE,k.BlendFactor.ONE),
colorWrite:r.defaultColorWriteParams,depthTest:null,depthWrite:null});case e.ShadowCastPass.Visualize:case e.ShadowCastPass.VisualizeCurrent:return r.makePipelineState({blending:n.blendingDefault,colorWrite:r.defaultColorWriteParams,depthTest:null,depthWrite:null})}return r.makePipelineState({})};h.bindPass=function(m){this.configuration.pass===e.ShadowCastPass.Accumulate||this.configuration.pass===e.ShadowCastPass.VisualizeCurrent?(this.program.bindTexture(m.linearDepthTexture,"depthMap"),m.shadowMap.bind(this.program),
m.shadowMap.bindView(this.program,m.camera.center),this.program.setUniform2fv("nearFar",m.camera.nearFar),this.program.setUniformMatrix4fv("inverseViewMatrix",m.inverseViewMatrix),this.program.setUniform4fv("projInfo",m.projInfo),this.program.setUniform2fv("zScale",m.zScale)):this.configuration.pass===e.ShadowCastPass.Visualize&&(this.program.bindTexture(m.shadowCastMap,"shadowCastMap"),this.program.setUniform1f("sampleScale",m.sampleScale),this.program.setUniform1f("opacityFromElevation",m.opacityFromElevation),
this.program.setUniform4fv("uColor",m.color),this.configuration.visualization===e.ShadowCastVisualization.Gradient&&this.configuration.bandsEnabled?this.program.setUniform1f("bandSize",m.bandSize):this.configuration.visualization===e.ShadowCastVisualization.Threshold&&this.program.setUniform1f("threshold",m.threshold))};c._createClass(p,[{key:"primitiveType",get:function(){return k.PrimitiveType.TRIANGLE_STRIP}}]);return p}(x.ShaderTechnique);x.shader=new g.ReloadableShaderModule(e.ShadowCast,()=>
new Promise((y,p)=>a(["./ShadowCast.glsl"],y,p)));g=function(y){function p(){var h=y.apply(this,arguments)||this;h.pass=e.ShadowCastPass.Accumulate;h.visualization=e.ShadowCastVisualization.Gradient;h.bandsEnabled=!1;return h}c._inheritsLoose(p,y);return p}(w.ShaderTechniqueConfiguration);d.__decorate([w.parameter({count:e.ShadowCastPass.COUNT})],g.prototype,"pass",void 0);d.__decorate([w.parameter()],g.prototype,"visualization",void 0);d.__decorate([w.parameter()],g.prototype,"bandsEnabled",void 0);
b.ShadowCastTechnique=x;b.ShadowCastTechniqueConfiguration=g;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/ShadowMap":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../ViewingMode ./Camera ./Util ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t){function q(ea,ca){w.set(ha,ea[ca],ea[ca+3]);return ha}let z=function(){this.camera=new y.default;this.lightMat=x.create()},v=function(){function ea(Z,fa,ja=0){this.rctx=Z;this.viewingMode=fa;this._enabled=!1;this._snapshots=[];this.maxTextureSize=this.textureSize=0;this.numCascades=1;this.maxNumCascades=4;this.splitSchemeLambda=0;this.warp=!0;this.cascadeDistances=[0,0,0,0,0];this.cascades=[];this.maxTextureSize=this.rctx.parameters.maxTextureSize;for(Z=
0;4>Z;++Z)this.cascades.push(new z);this.snapshotCount=ja}var ca=ea.prototype;ca.dispose=function(){this._discardDepthTexture();this._discardAllSnapshots()};ca.getSnapshot=function(Z){return this.enabled?this._snapshots[Z]:null};ca.getCascades=function(){for(let Z=0;Z<this.numCascades;++Z)R[Z]=this.cascades[Z];R.length=this.numCascades;return R};ca.start=function(Z,fa,ja){p.assert(this.enabled);this.textureSize=this._computeTextureSize(Z.fullWidth,Z.fullHeight);this._ensureDepthTexture();const {near:la,
far:ma}=this._clampNearFar(ja);this._computeCascadeDistances(ma,la);this._setupMatrices(Z,fa);ja=Z.viewMatrix;Z=Z.projectionMatrix;for(let ra=0;ra<this.numCascades;++ra)this._constructCascade(ra,Z,ja,fa);this.lastOrigin=null;this.clear()};ca.finish=function(Z){p.assert(this.enabled);this.rctx.bindFramebuffer(Z)};ca.bind=function(Z){this.enabled?(this._depthTextureUnit=Z.bindTexture(this._depthTexture,"shadowMapTex"),Z.setUniform1f("depthHalfPixelSz",.5/this.textureSize),Z.setUniform1i("numCascades",
this.numCascades),Z.setUniform4f("cascadeDistances",this.cascadeDistances[0],1<this.numCascades?this.cascadeDistances[1]:Infinity,2<this.numCascades?this.cascadeDistances[2]:Infinity,3<this.numCascades?this.cascadeDistances[3]:Infinity)):Z.setUniform1f("depthHalfPixelSz",-1)};ca.bindView=function(Z,fa){if(this.enabled){var ja=this.lastOrigin;if(!ja||ja[0]!==fa[0]||ja[1]!==fa[1]||ja[2]!==fa[2])for(this.lastOrigin=this.lastOrigin||f.create(),n.copy(this.lastOrigin,fa),ja=0;ja<this.numCascades;++ja){g.translate(L,
this.cascades[ja].lightMat,fa);for(let la=0;16>la;++la)N[16*ja+la]=L[la]}Z.setUniformMatrix4fv("shadowMapMatrix",N)}};ca.takeCascadeSnapshotTo=function(Z,fa){p.assert(this.enabled);this._ensureSnapshot(fa);this._bindFbo();const ja=this.rctx;fa=ja.bindTexture(this._snapshots[fa],u.Texture.TEXTURE_UNIT_FOR_UPDATES);ja.gl.copyTexSubImage2D(h.TextureType.TEXTURE_2D,0,Z.camera.viewport[0],Z.camera.viewport[1],Z.camera.viewport[0],Z.camera.viewport[1],Z.camera.viewport[2],Z.camera.viewport[3]);ja.bindTexture(fa,
u.Texture.TEXTURE_UNIT_FOR_UPDATES)};ca.clear=function(){const Z=this.rctx;this._bindFbo();Z.setClearColor(1,1,1,1);Z.clearSafe(h.ClearBufferBit.COLOR_BUFFER_BIT|h.ClearBufferBit.DEPTH_BUFFER_BIT)};ca._computeTextureSize=function(Z,fa){return Math.min(this.maxTextureSize,2*2**Math.round(.5*Math.log(Z*Z+fa*fa)*Math.LOG2E+.35))};ca._ensureDepthTexture=function(){if(null==this._depthTexture||this._depthTexture.descriptor.width!==this.textureSize)this._discardDepthTexture(),this._depthTexture=new u.Texture(this.rctx,
{target:h.TextureType.TEXTURE_2D,pixelFormat:h.PixelFormat.RGBA,dataType:h.PixelType.UNSIGNED_BYTE,wrapMode:h.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:h.TextureSamplingMode.NEAREST,flipped:!0,width:this.textureSize,height:this.textureSize}),this.fbo=new m.FramebufferObject(this.rctx,{colorTarget:h.TargetType.TEXTURE,depthStencilTarget:h.DepthStencilTargetType.DEPTH_RENDER_BUFFER,width:this.textureSize,height:this.textureSize},this._depthTexture)};ca._ensureSnapshot=function(Z){const fa=this._snapshots[Z];
c.isSome(fa)&&fa.descriptor.width===this.textureSize||(this._discardSnapshot(Z),this._snapshots[Z]=new u.Texture(this.rctx,{target:h.TextureType.TEXTURE_2D,pixelFormat:h.PixelFormat.RGBA,dataType:h.PixelType.UNSIGNED_BYTE,wrapMode:h.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:h.TextureSamplingMode.NEAREST,flipped:!0,width:this.textureSize,height:this.textureSize}))};ca._discardDepthTexture=function(){this.fbo=c.disposeMaybe(this.fbo);this._depthTexture=c.disposeMaybe(this._depthTexture)};ca._discardSnapshot=
function(Z){this._snapshots[Z]=c.disposeMaybe(this._snapshots[Z])};ca._discardAllSnapshots=function(){for(let Z=0;Z<this.snapshotCount;++Z)this._discardSnapshot(Z)};ca._bindFbo=function(){const Z=this.rctx;c.isSome(this._depthTextureUnit)&&(Z.bindTexture(null,this._depthTextureUnit),this._depthTextureUnit=null);Z.bindFramebuffer(this.fbo)};ca._constructCascade=function(Z,fa,ja,la){const ma=this.cascades[Z];var ra=-this.cascadeDistances[Z],va=-this.cascadeDistances[Z+1];ra=(fa[10]*ra+fa[14])/Math.abs(fa[11]*
ra+fa[15]);fa=(fa[10]*va+fa[14])/Math.abs(fa[11]*va+fa[15]);p.assert(ra<fa);for(va=0;8>va;++va){e.set(C,0===va%4||3===va%4?-1:1,0===va%4||1===va%4?-1:1,4>va?ra:fa,1);e.transformMat4(D[va],C,E);for(let ya=0;3>ya;++ya)D[va][ya]/=D[va][3]}n.negate(U,D[0]);g.translate(B,M,U);ma.camera.viewMatrix=B;for(ra=0;8>ra;++ra)n.transformMat4(D[ra],D[ra],ma.camera.viewMatrix);n.copy(F,D[0]);n.copy(G,D[0]);for(ra=1;8>ra;++ra)for(fa=0;3>fa;++fa)F[fa]=Math.min(F[fa],D[ra][fa]),G[fa]=Math.max(G[fa],D[ra][fa]);F[2]-=
200;G[2]+=200;ma.camera.near=-G[2];ma.camera.far=-F[2];this.warp?this._constructTrapezoidalProjection(ja,la,ma):this._constructOrthogonalProjection(ma);g.multiply(ma.lightMat,ma.camera.projectionMatrix,ma.camera.viewMatrix);ja=this.textureSize/2;ma.camera.viewport[0]=0===Z%2?0:ja;ma.camera.viewport[1]=0===Math.floor(Z/2)?0:ja;ma.camera.viewport[2]=ja;ma.camera.viewport[3]=ja};ca._constructOrthogonalProjection=function(Z){g.ortho(Z.camera.projectionMatrix,F[0],G[0],F[1],G[1],Z.camera.near,Z.camera.far)};
ca._constructTrapezoidalProjection=function(Z,fa,ja){var la=1/D[0][3],ma=1/D[4][3];p.assert(la<ma);la+=Math.sqrt(la*ma);var ra=Math.sin(b.acosClamped(Z[2]*fa[0]+Z[6]*fa[1]+Z[10]*fa[2]));Z=D;var va=la/ra;fa=J;var ya=I,za=O;ma=P;la=K;w.set(T,0,0);for(var pa=0;4>pa;++pa)w.add(T,T,Z[pa]);w.scale(T,T,.25);w.set(S,0,0);for(pa=4;8>pa;++pa)w.add(S,S,Z[pa]);w.scale(S,S,.25);w.lerp(H[0],Z[4],Z[5],.5);w.lerp(H[1],Z[5],Z[6],.5);w.lerp(H[2],Z[6],Z[7],.5);w.lerp(H[3],Z[7],Z[4],.5);pa=0;var wa=w.squaredDistance(H[0],
T);for(var na=1;4>na;++na){var qa=w.squaredDistance(H[na],T);qa<wa&&(wa=qa,pa=na)}w.subtract(Q,H[pa],Z[pa+4]);pa=Q[0];Q[0]=-Q[1];Q[1]=pa;w.subtract(W,S,T);0>w.dot(W,Q)&&w.negate(Q,Q);w.lerp(Q,Q,W,ra);w.normalize(Q,Q);ra=pa=w.dot(w.subtract(V,Z[0],T),Q);for(wa=1;8>wa;++wa)na=w.dot(w.subtract(V,Z[wa],T),Q),na<ra?ra=na:na>pa&&(pa=na);w.copy(fa,T);w.scale(V,Q,ra-va);w.add(fa,fa,V);na=-1;qa=1;va=wa=0;for(let ta=0;8>ta;++ta){w.subtract(Y,Z[ta],fa);w.normalize(Y,Y);const Fa=Q[0]*Y[1]-Q[1]*Y[0];0<Fa?Fa>na&&
(na=Fa,wa=ta):Fa<qa&&(qa=Fa,va=ta)}p.verify(0<na,"leftArea");p.verify(0>qa,"rightArea");w.scale(aa,Q,ra);w.add(aa,aa,T);w.scale(X,Q,pa);w.add(X,X,T);ba[0]=-Q[1];ba[1]=Q[0];ya=p.rayRay2D(fa,Z[va],X,w.add(V,X,ba),1,ya);za=p.rayRay2D(fa,Z[wa],X,V,1,za);ma=p.rayRay2D(fa,Z[wa],aa,w.add(V,aa,ba),1,ma);Z=p.rayRay2D(fa,Z[va],aa,V,1,la);p.verify(ya,"rayRay");p.verify(za,"rayRay");p.verify(ma,"rayRay");p.verify(Z,"rayRay");za=J;Z=I;fa=P;ma=K;la=ja.camera.projectionMatrix;w.subtract(ka,fa,ma);w.scale(ka,ka,
.5);ia[0]=ka[0];ia[1]=ka[1];ia[2]=0;ia[3]=ka[1];ia[4]=-ka[0];ia[5]=0;ia[6]=ka[0]*ka[0]+ka[1]*ka[1];ia[7]=ka[0]*ka[1]-ka[1]*ka[0];ia[8]=1;ia[6]=-w.dot(q(ia,0),za);ia[7]=-w.dot(q(ia,1),za);za=w.dot(q(ia,0),fa)+ia[6];ya=w.dot(q(ia,1),fa)+ia[7];va=w.dot(q(ia,0),ma)+ia[6];ma=w.dot(q(ia,1),ma)+ia[7];za=-(za+va)/(ya+ma);ia[0]+=ia[1]*za;ia[3]+=ia[4]*za;ia[6]+=ia[7]*za;za=1/(w.dot(q(ia,0),fa)+ia[6]);ya=1/(w.dot(q(ia,1),fa)+ia[7]);ia[0]*=za;ia[3]*=za;ia[6]*=za;ia[1]*=ya;ia[4]*=ya;ia[7]*=ya;ia[2]=ia[1];ia[5]=
ia[4];ia[8]=ia[7];ia[7]+=1;za=w.dot(q(ia,1),Z)+ia[7];ya=w.dot(q(ia,2),Z)+ia[8];va=w.dot(q(ia,1),fa)+ia[7];ma=w.dot(q(ia,2),fa)+ia[8];za=-.5*(za/ya+va/ma);ia[1]+=ia[2]*za;ia[4]+=ia[5]*za;ia[7]+=ia[8]*za;za=w.dot(q(ia,1),Z)+ia[7];ya=w.dot(q(ia,2),Z)+ia[8];va=-ya/za;ia[1]*=va;ia[4]*=va;ia[7]*=va;la[0]=ia[0];la[1]=ia[1];la[2]=0;la[3]=ia[2];la[4]=ia[3];la[5]=ia[4];la[6]=0;la[7]=ia[5];la[8]=0;la[9]=0;la[10]=1;la[11]=0;la[12]=ia[6];la[13]=ia[7];la[14]=0;la[15]=ia[8];ja.camera.projectionMatrix[10]=2/(F[2]-
G[2]);ja.camera.projectionMatrix[14]=-(F[2]+G[2])/(F[2]-G[2])};ca._setupMatrices=function(Z,fa){g.multiply(A,Z.projectionMatrix,Z.viewMatrix);g.invert(E,A);Z=this.viewingMode===r.ViewingMode.Global?Z.eye:n.set(U,0,0,1);g.lookAt(M,[0,0,0],[-fa[0],-fa[1],-fa[2]],Z)};ca._clampNearFar=function(Z){let {near:fa,far:ja}=Z;2>fa&&(fa=2);2>ja&&(ja=2);fa>=ja&&(fa=2,ja=4);return{near:fa,far:ja}};ca._computeCascadeDistances=function(Z,fa){this.numCascades=Math.min(1+Math.floor(p.logWithBase(Z/fa,4)),this.maxNumCascades);
const ja=(Z-fa)/this.numCascades;Z=(Z/fa)**(1/this.numCascades);let la=fa;for(let ma=0;ma<this.numCascades+1;++ma)this.cascadeDistances[ma]=b.lerp(la,fa,this.splitSchemeLambda),la*=Z,fa+=ja};a._createClass(ea,[{key:"maxCascades",get:function(){return this.maxNumCascades},set:function(Z){this.maxNumCascades=b.clamp(Math.floor(Z),1,4)}},{key:"enabled",get:function(){return this._enabled},set:function(Z){this._enabled=Z;Z||(this._discardDepthTexture(),this._discardAllSnapshots())}},{key:"snapshotCount",
get:function(){return this._snapshots.length},set:function(Z){var fa=this._snapshots.length;if(Z>fa){var ja=Z-fa;this._snapshots.length=Z;for(Z=0;Z<ja;++Z)this._snapshots[fa+Z]=null}else if(Z<this.snapshotCount){fa-=Z;for(ja=0;ja<fa;++ja)this._discardSnapshot(Z+ja);this._snapshots.length=Z}}},{key:"gpuMemoryUsage",get:function(){var Z,fa;return this._snapshots.reduce((ja,la)=>ja+t.getGpuMemoryUsage(la),null!=(Z=null==(fa=this.fbo)?void 0:fa.gpuMemoryUsage)?Z:0)}},{key:"test",get:function(){const Z=
this;return{maxNumCascades:this.maxNumCascades,cascades:this.cascades,textureSize:this.textureSize,depthTexture:this._depthTexture,set splitSchemeLambda(fa){Z.splitSchemeLambda=fa},get splitSchemeLambda(){return Z.splitSchemeLambda},set warp(fa){Z.warp=fa},get warp(){return Z.warp}}}}]);return ea}();const B=x.create(),A=x.create(),E=x.create(),C=k.create(),D=[];for(let ea=0;8>ea;++ea)D.push(k.create());const F=f.create(),G=f.create(),J=l.create(),I=l.create(),O=l.create(),P=l.create(),K=l.create(),
M=x.create(),U=f.create(),R=[],L=x.create(),N=new Float32Array(64),T=l.create(),S=l.create(),H=[l.create(),l.create(),l.create(),l.create()],Q=l.create(),W=l.create(),V=l.create(),Y=l.create(),aa=l.create(),X=l.create(),ba=l.create(),ha=l.create(),ka=l.create(),ia=d.create();return v})},"esri/views/3d/webgl-engine/lib/ShadowHighlightHelper":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f32 ../../../ViewingMode ./glUtil3D ../shaders/ShadowHighlightTechnique ../../../webgl/Util".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e){let k=function(){function y(h,m){this._rctx=h;this._viewingMode=m;this._maxOpacity=1;this._parameters={shadowColor:w.fromValues(1,0,1,1),shadowOpacity:.2,occludedShadowOpacity:.1,opacityElevation:1,dayNightTerminator:1};this._vao=n.createQuadVAO(this._rctx)}var p=y.prototype;p.render=function(h,m){if(h.shadowMap.enabled&&h.linearDepthTexture&&this.isVisible){var u=this.technique;this._rctx.bindFramebuffer(m);this._rctx.useTechnique(u);u.bindPass(this._parameters,h);
this._rctx.bindVAO(this._vao);this._rctx.drawArrays(u.primitiveType,0,e.vertexCount(this._vao,"geometry"))}};p.setDefaultOptions=function(h){this._parameters={...this._parameters,...h};this._updateMaxOpacity()};p.updateParameters=function(h,m){this._parameters.opacityElevation=1-c.smoothstep(4E4,5E4,h.relativeElevation);h=this._viewingMode===l.ViewingMode.Global?g.normalize(r,h.center):g.set(r,0,0,1);m=g.dot(h,m);this._parameters.dayNightTerminator=c.smoothstep(0,1,c.clamp(30*m,0,1))};p.dispose=function(){this._vao=
d.disposeMaybe(this._vao);this._technique=d.releaseMaybe(this._technique)};p._updateMaxOpacity=function(){const h=this._parameters;this._maxOpacity=Math.max(h.shadowOpacity,h.occludedShadowOpacity)*h.shadowColor[3]};b._createClass(y,[{key:"technique",get:function(){d.isNone(this._technique)&&(this._technique=new f.ShadowHighlightTechnique({rctx:this._rctx,viewingMode:this._viewingMode}));return this._technique}},{key:"gpuMemoryUsage",get:function(){var h,m;return null!=(h=null==(m=this._vao)?void 0:
m.size)?h:0}},{key:"isVisible",get:function(){const {opacityElevation:h,dayNightTerminator:m}=this._parameters;return.001953125<=this._maxOpacity*h*m}}]);return y}();const r=x.create();a.ShadowHighlightHelper=k;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/ShadowHighlightTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../lib/Util ../../../../chunks/ShadowHighlight.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u){k=function(B){function A(C){var D;return D=B.call(this,C,null,()=>D.destroy())||this}c._inheritsLoose(A,B);var E=A.prototype;E.initializeProgram=function(C){const D=A.shader.get().build({highlightedThreshold:.99999,selfShadowThreshold:.025});return new y.Program(C.rctx,D,r.Default3D)};E.initializePipeline=function(C){return u.makePipelineState({blending:u.separateBlendingParams(m.BlendFactor.SRC_ALPHA,m.BlendFactor.ONE,m.BlendFactor.ONE_MINUS_SRC_ALPHA,
m.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:u.defaultColorWriteParams,depthTest:null,depthWrite:null})};E.bindPass=function(C,D){d.isNone(D.linearDepthTexture)||(this.program.bindTexture(D.linearDepthTexture,"depthMap"),this.program.bindTexture(D.highlightColorTexture,"highlightMap"),l.transformMat4(t,D.lighting.lightingMainDirection,D.camera.viewInverseTransposeMatrix),l.normalize(t,t),p.inverseProjectionInfo(D.camera.projectionMatrix,D.camera.fullWidth,D.camera.fullHeight,z,q),g.translate(v,D.camera.viewMatrix,
D.camera.center),g.invert(v,v),this.program.setUniform4fv("uColor",C.shadowColor),this.program.setUniform1f("opacity",C.shadowOpacity),this.program.setUniform1f("occludedOpacity",C.occludedShadowOpacity),this.program.setUniform1f("terminationFactor",C.opacityElevation*C.dayNightTerminator),this.program.setUniform2fv("nearFar",D.camera.nearFar),this.program.setUniformMatrix4fv("inverseViewMatrix",v),this.program.setUniform4fv("projInfo",z),this.program.setUniform2fv("zScale",q),this.program.setUniform3fv("lightingMainDirectionView",
t),this.program.setUniform2f("texelSize",1/D.linearDepthTexture.descriptor.width,1/D.linearDepthTexture.descriptor.height),D.shadowMap.bind(this.program),D.shadowMap.bindView(this.program,D.camera.center),C=D.shadowMap.getSnapshot(0),d.isSome(C)&&this.program.bindTexture(C,"highlightDepthTex"),C=D.shadowMap.getSnapshot(1),d.isSome(C)&&this.program.bindTexture(C,"defaultDepthTex"))};c._createClass(A,[{key:"primitiveType",get:function(){return m.PrimitiveType.TRIANGLE_STRIP}}]);return A}(k.ShaderTechnique);
k.shader=new e.ReloadableShaderModule(h.ShadowHighlightShader,()=>new Promise((B,A)=>a(["./ShadowHighlight.glsl"],B,A)));const t=n.create(),q=w.create(),z=f.create(),v=x.create();b.DefaultSnapshotSlot=1;b.HighlightShadowMapSlot=0;b.ShadowHighlightTechnique=k;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/ShadowHighlight.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,b,c,d,g,x,w,l,n){function f(k){const r=new n.ShaderBuilder;r.include(g.ReadShadowMap);r.fragment.include(w.RgbaFloatEncoding);r.fragment.include(d.ReadLinearDepth);r.include(x.CameraSpace);r.include(b.ScreenSpacePass);r.fragment.uniforms.add("defaultDepthTex","sampler2D").add("highlightDepthTex","sampler2D").add("depthMap","sampler2D").add("highlightMap","sampler2D").add("uColor","vec4").add("nearFar","vec2").add("opacity","float").add("occludedOpacity","float").add("terminationFactor",
"float").add("inverseViewMatrix","mat4").add("lightingMainDirectionView","vec3").add("texelSize","vec2");r.fragment.constants.add("unoccludedHighlightFlag","vec4",c.unoccludedHighlightFlag).add("highlightedThreshold","float",k.highlightedThreshold).add("selfShadowThreshold","float",k.selfShadowThreshold);r.fragment.code.add(l.glsl`vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, vec2 uv, vec2 texelSize, sampler2D depthMap, vec2 nearFar) {
float leftPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(-1.0, 0.0) * texelSize, nearFar);
float rightPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(1.0, 0.0) * texelSize, nearFar);
float bottomPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, -1.0) * texelSize, nearFar);
float topPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, 1.0) * texelSize, nearFar);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`);r.fragment.code.add(l.glsl`void main(void) {
vec4 highlightInfo = texture2D(highlightMap, uv);
float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
if (visiblyHighlighted > highlightedThreshold) {
discard;
}
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
bool shadowHighlight = depthHighlight < lvpos.z;
if (!shadowHighlight) {
discard;
}
float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
bool shadowDefault = depthDefault < lvpos.z;
vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, uv, texelSize, depthMap, nearFar);
bool shaded = dot(normal, lightingMainDirectionView) < selfShadowThreshold;
float differenceOpacity = opacity;
float bothOpacity = occludedOpacity;
float fragOpacity = (shadowDefault || shaded) ? bothOpacity : differenceOpacity;
gl_FragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
}`);return r}const e=Object.freeze({__proto__:null,build:f});a.ShadowHighlightShader=e;a.build=f})},"esri/views/3d/webgl-engine/lib/SliceHelper":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/boundedPlane"],function(a,b){const c=b.create();return function(){function d(){this._worldPlane=c}a._createClass(d,[{key:"isEnabled",get:function(){return this.plane!==c}},{key:"plane",get:function(){return this._worldPlane},set:function(g){this._worldPlane=g?g:c}}]);return d}()})},
"esri/views/3d/webgl-engine/lib/SmaaRenderPass":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../support/requestImageUtils ./glUtil3D ./SMAATechnique ../../../../chunks/SMAA.glsl ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t){b.SmaaRenderPass=function(q){function z(B,A){var E=q.call(this,{})||this;E.rctx=B;E._techniqueRep=A;E._isEnabled=!1;return E}c._inheritsLoose(z,q);var v=z.prototype;v.normalizeCtorArgs=function(){return{}};v.dispose=function(){this._abortController=x.abortMaybe(this._abortController);this.disable()};v._loadResources=function(B){if(x.isSome(this._abortController))return!1;if(x.isSome(this._searchTexture))return!0;this._abortController=new AbortController;
const A=this._abortController.signal;(new Promise((E,C)=>a(["./SmaaRenderPassData"],E,C))).then(E=>this._loadTextures(E,A)).then(()=>B()).finally(()=>this._abortController=null);return!1};v._loadTextures=function(B,A){w.throwIfAborted(A);return Promise.all([this._loadTextureFromBase64(B.areaTexture,m.TextureSamplingMode.LINEAR,m.PixelFormat.RGB),this._loadTextureFromBase64(B.searchTexure,m.TextureSamplingMode.NEAREST,m.PixelFormat.LUMINANCE)]).then(([E,C])=>{w.isAborted(A)?(E.dispose(),C.dispose(),
w.throwIfAborted(A)):(this._areaTexture=E,this._searchTexture=C)})};v.enable=function(B){if(this._isEnabled)return!0;if(!this._edgeDetectTechnique||!this._blendWeightsTechnique||!this._blurTechnique){const A=new p.SMAATechniqueConfiguration,E=(C,D)=>this._techniqueRep.releaseAndAcquire(p.SMAATechnique,C,D);A.output=h.SMAAOutput.EdgeDetector;this._edgeDetectTechnique=E(A,this._edgeDetectTechnique);A.output=h.SMAAOutput.BlendWeight;this._blendWeightsTechnique=E(A,this._blendWeightsTechnique);A.output=
h.SMAAOutput.Blur;this._blurTechnique=E(A,this._blurTechnique)}if(!this._loadResources(B))return!1;this._vao=y.createScreenSizeTriangleVAO(this.rctx);this._edges=new u.FramebufferObject(this.rctx,{colorTarget:m.TargetType.TEXTURE,depthStencilTarget:m.DepthStencilTargetType.NONE},{target:m.TextureType.TEXTURE_2D,pixelFormat:m.PixelFormat.RGB,dataType:m.PixelType.UNSIGNED_BYTE,samplingMode:m.TextureSamplingMode.LINEAR,wrapMode:m.TextureWrapMode.CLAMP_TO_EDGE,width:4,height:4});this._blend=new u.FramebufferObject(this.rctx,
{colorTarget:m.TargetType.TEXTURE,depthStencilTarget:m.DepthStencilTargetType.NONE},{target:m.TextureType.TEXTURE_2D,pixelFormat:m.PixelFormat.RGBA,dataType:m.PixelType.UNSIGNED_BYTE,samplingMode:m.TextureSamplingMode.LINEAR,wrapMode:m.TextureWrapMode.CLAMP_TO_EDGE,width:4,height:4});return this._isEnabled=!0};v.disable=function(){this._isEnabled&&(this._vao=x.disposeMaybe(this._vao),this._areaTexture=x.disposeMaybe(this._areaTexture),this._searchTexture=x.disposeMaybe(this._searchTexture),this._blend=
x.disposeMaybe(this._blend),this._edges=x.disposeMaybe(this._edges),this._isEnabled=!1)};v.render=function(B){if(this._isEnabled){var A=this.rctx,E=A.getBoundFramebufferObject(),C=B.descriptor.width,D=B.descriptor.height;A.bindVAO(this._vao);A.setViewport(0,0,C,D);this._edges.resize(C,D);A.bindFramebuffer(this._edges);A.setClearColor(0,0,0,1);A.clear(m.ClearBufferBit.COLOR_BUFFER_BIT);var F=A.useTechnique(this._edgeDetectTechnique);F.bindTexture(B,"tColor");F.setUniform4f("resolution",1/C,1/D,C,D);
A.drawArrays(m.PrimitiveType.TRIANGLES,0,3);this._blend.resize(C,D);A.bindFramebuffer(this._blend);A.setClearColor(0,0,1,1);A.clear(m.ClearBufferBit.COLOR_BUFFER_BIT);F=A.useTechnique(this._blendWeightsTechnique);F.setUniform4f("resolution",1/C,1/D,C,D);F.bindTexture(this._searchTexture,"tSearch");F.bindTexture(this._areaTexture,"tArea");F.bindTexture(this._edges.colorTexture,"tEdges");A.drawArrays(m.PrimitiveType.TRIANGLES,0,3);A.bindFramebuffer(E);A.setClearColor(0,1,0,1);A.clear(m.ClearBufferBit.COLOR_BUFFER_BIT);
E=A.useTechnique(this._blurTechnique);E.setUniform4f("resolution",1/C,1/D,C,D);E.bindTexture(B,"tColor");E.bindTexture(this._blend.colorTexture,"tBlendWeights");A.drawArrays(m.PrimitiveType.TRIANGLES,0,3)}};v._loadTextureFromBase64=function(B,A,E){const C=new t.Texture(this.rctx,{pixelFormat:E,dataType:m.PixelType.UNSIGNED_BYTE,wrapMode:m.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:A},null);return r.requestImage(B).then(D=>{C.resize(D.width,D.height);C.setData(D);return C})};c._createClass(z,[{key:"updating",
get:function(){return x.isSome(this._abortController)}}]);return z}(g);d.__decorate([l.property()],b.SmaaRenderPass.prototype,"_abortController",void 0);d.__decorate([l.property({readOnly:!0})],b.SmaaRenderPass.prototype,"updating",null);b.SmaaRenderPass=d.__decorate([k.subclass("esri.views.3d.webgl-engine.lib.SmaaRenderPass")],b.SmaaRenderPass);Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/SMAATechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ./DefaultVertexAttributeLocations ./Program ../../../../chunks/SMAA.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e){x=function(k){function r(){return k.apply(this,arguments)||this}c._inheritsLoose(r,k);var y=r.prototype;y.initializeProgram=function(p){const h=r.shader.get().build({output:this.configuration.output,threshold:.05,localConstrastAdaption:2,maxSearchSteps:8,maxDistanceAreaTex:16});return new n.Program(p.rctx,h,l.Default3D)};y.initializePipeline=function(){return e.makePipelineState({colorWrite:e.defaultColorWriteParams})};return r}(x.ShaderTechnique);x.shader=new g.ReloadableShaderModule(f.SMAAShader,
()=>new Promise((k,r)=>a(["../shaders/SMAA.glsl"],k,r)));g=function(k){function r(){var y=k.apply(this,arguments)||this;y.output=f.SMAAOutput.EdgeDetector;return y}c._inheritsLoose(r,k);return r}(w.ShaderTechniqueConfiguration);d.__decorate([w.parameter({count:f.SMAAOutput.COUNT})],g.prototype,"output",void 0);b.SMAATechnique=x;b.SMAATechniqueConfiguration=g;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/SMAA.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderModules/interfaces",
"../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/lib/VertexAttribute"],function(a,b,c,d){function g(w){const l=new c.ShaderBuilder;w.output===a.SMAAOutput.EdgeDetector&&(l.attributes.add(d.VertexAttribute.POSITION,"vec2"),l.vertex.uniforms.add("resolution","vec4"),l.varyings.add("fTexCoord","vec2"),l.varyings.add("fOffset[3]","vec4"),l.vertex.code.add(b.glsl`void SMAAEdgeDetectionVS( vec2 texcoord ) {
fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );
fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );
fOffset[2] = texcoord.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );
}
void main() {
fTexCoord = (position + 1.0 ) * 0.5;
gl_Position = vec4(position, 0, 1);
SMAAEdgeDetectionVS( fTexCoord );
}`),l.fragment.uniforms.add("tColor","sampler2D"),l.fragment.code.add(b.glsl`
      vec4 SMAAColorEdgeDetectionPS( vec2 texcoord, vec4 offset[3], sampler2D colorTex ) {
        vec2 threshold = vec2( ${b.glsl.float(w.threshold)} );

        // Calculate color deltas:
        vec4 delta;
        vec3 C = texture2D( colorTex, texcoord ).rgb;

        vec3 Cleft = texture2D( colorTex, offset[0].xy ).rgb;
        vec3 t = abs( C - Cleft );
        delta.x = max( max( t.r, t.g ), t.b );

        vec3 Ctop = texture2D( colorTex, offset[0].zw ).rgb;
        t = abs( C - Ctop );
        delta.y = max( max( t.r, t.g ), t.b );

        // We do the usual threshold:
        vec2 edges = step( threshold, delta.xy );

        // Then discard if there is no edge:
        if ( dot( edges, vec2( 1.0, 1.0 ) ) == 0.0 )
            discard;

        // Calculate right and bottom deltas:
        vec3 Cright = texture2D( colorTex, offset[1].xy ).rgb;
        t = abs( C - Cright );
        delta.z = max( max( t.r, t.g ), t.b );

        vec3 Cbottom  = texture2D( colorTex, offset[1].zw ).rgb;
        t = abs( C - Cbottom );
        delta.w = max( max( t.r, t.g ), t.b );

        // Calculate the maximum delta in the direct neighborhood:
        float maxDelta = max( max( max( delta.x, delta.y ), delta.z ), delta.w );

        // Calculate left-left and top-top deltas:
        vec3 Cleftleft  = texture2D( colorTex, offset[2].xy ).rgb;
        t = abs( C - Cleftleft );
        delta.z = max( max( t.r, t.g ), t.b );

        vec3 Ctoptop = texture2D( colorTex, offset[2].zw ).rgb;
        t = abs( C - Ctoptop );
        delta.w = max( max( t.r, t.g ), t.b );

        // Calculate the final maximum delta:
        maxDelta = max( max( maxDelta, delta.z ), delta.w );

        // Local contrast adaptation in action:
        edges.xy *= step( maxDelta, float(${b.glsl.float(w.localConstrastAdaption)}) * delta.xy );

        return vec4( edges, 0.0, 0.0 );
      }

      void main() {
        gl_FragColor = SMAAColorEdgeDetectionPS( fTexCoord, fOffset, tColor );
      }
    `));w.output===a.SMAAOutput.BlendWeight&&(l.attributes.add(d.VertexAttribute.POSITION,"vec2"),l.vertex.uniforms.add("resolution","vec4"),l.varyings.add("fTexCoord","vec2"),l.varyings.add("fOffset[3]","vec4"),l.varyings.add("fPixCoord","vec2"),l.vertex.code.add(b.glsl`
      void SMAABlendingWeightCalculationVS( vec2 texcoord ) {
        fPixCoord = texcoord * resolution.zw;
        fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        fOffset[2] = vec4( fOffset[0].xz, fOffset[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${b.glsl.int(w.maxSearchSteps)} );
      }

      void main() {
        fTexCoord = (position + 1.0 ) * 0.5;
        gl_Position = vec4(position, 0, 1);
        SMAABlendingWeightCalculationVS( fTexCoord );
      }
    `),l.fragment.uniforms.add("tEdges","sampler2D").add("tArea","sampler2D").add("tSearch","sampler2D").add("tColor","sampler2D").add("resolution","vec4"),l.fragment.code.add(b.glsl`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 SMAASampleLevelZeroOffset(sampler2D tex, vec2 coord, vec2 offset) {
        return texture2D( tex, coord + offset.x * resolution.xy, 0.0 );
      }

      vec2 round( vec2 x ) {
        return sign( x ) * floor( abs( x ) + 0.5 );
      }

      float SMAASearchLength( sampler2D searchTex, vec2 e, float bias, float scale ) {
        e.r = bias + e.r * scale;
        return 255.0 * texture2D( searchTex, e, 0.0 ).r;
      }

      float SMAASearchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${b.glsl.int(w.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * SMAASearchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float SMAASearchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${b.glsl.int(w.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float SMAASearchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${b.glsl.int(w.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * SMAASearchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float SMAASearchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${b.glsl.int(w.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * SMAASearchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 SMAAArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${b.glsl.int(w.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture2D( areaTex, texcoord, 0.0 ).rg;
      }

      vec4 SMAABlendingWeightCalculationPS( vec2 texcoord, vec2 pixcoord, vec4 offset[ 3 ], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices ) {
        vec4 weights = vec4( 0.0, 0.0, 0.0, 0.0 );
        vec2 e = texture2D( edgesTex, texcoord ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = SMAASearchXLeft( edgesTex, searchTex, offset[ 0 ].xy, offset[ 2 ].x );
          coords.y = offset[ 1 ].y;
          d.x = coords.x;
          float e1 = texture2D( edgesTex, coords, 0.0 ).r;
          coords.x = SMAASearchXRight( edgesTex, searchTex, offset[ 0 ].zw, offset[ 2 ].y );
          d.y = coords.x;
          d = d * resolution.z - pixcoord.x;
          vec2 sqrt_d = sqrt( abs( d ) );
          coords.y -= 1.0 * resolution.y;
          float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, vec2( 1.0, 0.0 ) ).r;
          weights.rg = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = SMAASearchYUp( edgesTex, searchTex, offset[ 1 ].xy, offset[ 2 ].z );
          coords.x = offset[ 0 ].x;
          d.x = coords.y;
          float e1 = texture2D( edgesTex, coords, 0.0 ).g;
          coords.y = SMAASearchYDown( edgesTex, searchTex, offset[ 1 ].zw, offset[ 2 ].w );
          d.y = coords.y;
          d = d * resolution.w - pixcoord.y;
          vec2 sqrt_d = sqrt( abs( d ) );
          coords.y -= 1.0 * resolution.y;
          float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, vec2( 0.0, 1.0 ) ).g;
          weights.ba = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offset[ 0 ]+offset[ 1 ]+offset[ 2 ] + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0,1,0,1),dbg);
        }
        return weights;
      }

      void main() {
        gl_FragColor = SMAABlendingWeightCalculationPS( fTexCoord, fPixCoord, fOffset, tEdges, tArea, tSearch, ivec4( 0.0 ) );
      }
    `));w.output===a.SMAAOutput.Blur&&(l.attributes.add(d.VertexAttribute.POSITION,"vec2"),l.vertex.uniforms.add("resolution","vec4"),l.varyings.add("fTexCoord","vec2"),l.varyings.add("fOffset[2]","vec4"),l.vertex.code.add(b.glsl`void SMAANeighborhoodBlendingVS( vec2 texcoord ) {
fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );
fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );
}
void main() {
fTexCoord = (position + 1.0 ) * 0.5;
gl_Position = vec4(position, 0, 1);
SMAANeighborhoodBlendingVS(fTexCoord);
}`),l.fragment.uniforms.add("tBlendWeights","sampler2D"),l.fragment.uniforms.add("tColor","sampler2D"),l.fragment.uniforms.add("resolution","vec4"),l.fragment.code.add(b.glsl`vec4 SMAANeighborhoodBlendingPS( vec2 texcoord, vec4 offset[ 2 ], sampler2D colorTex, sampler2D blendTex ) {
vec4 a;
a.xz = texture2D( blendTex, texcoord ).xz;
a.y = texture2D( blendTex, offset[ 1 ].zw ).g;
a.w = texture2D( blendTex, offset[ 1 ].xy ).a;
if ( dot(a, vec4( 1.0, 1.0, 1.0, 1.0 )) < 1e-5 ) {
return texture2D( colorTex, texcoord, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture2D( colorTex, texcoord, 0.0 );
texcoord += sign( offset ) * resolution.xy;
vec4 Cop = texture2D( colorTex, texcoord, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
vec4 mixed = mix(C, Cop, s);
return mixed;
}
}
void main() {
gl_FragColor = SMAANeighborhoodBlendingPS( fTexCoord, fOffset, tColor, tBlendWeights );
}`));return l}a.SMAAOutput=void 0;(function(w){w[w.EdgeDetector=0]="EdgeDetector";w[w.BlendWeight=1]="BlendWeight";w[w.Blur=2]="Blur";w[w.COUNT=3]="COUNT"})(a.SMAAOutput||(a.SMAAOutput={}));const x=Object.freeze({__proto__:null,get SMAAOutput(){return a.SMAAOutput},build:g});a.SMAAShader=x;a.build=g})},"esri/views/3d/webgl-engine/lib/SSAOHelper":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec4f64 ../../../../support/requestImageUtils ./glUtil3D ./SSAOTechnique ./Util ../../../../chunks/SSAO.glsl ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h){let m=function(){function q(v,B,A){this._techniqueRep=v;this._rctx=B;this._requestRender=A;this._enabled=!1;this._ssaoTechniqueConfig=new f.SSAOTechniqueConfiguration;this.quadVAO=null;this._blurSizePx=2;this._attenuation=.5}var z=q.prototype;z.dispose=function(){this.quadVAO=d.disposeMaybe(this.quadVAO)};z.disposeOffscreenBuffers=function(){d.applySome(this._ssaoFBO,v=>v.resize(0,0));d.applySome(this._blur0FBO,v=>v.resize(0,0));d.applySome(this._blur1FBO,
v=>v.resize(0,0))};z.computeSSAO=function(v,B,A){if(!(!this.enabled||d.isNone(B)||d.isNone(A)||d.isNone(this._noiseTexture)||d.isNone(this._ssaoFBO)||d.isNone(this._blur0FBO)||d.isNone(this._blur1FBO))){var E=this._rctx,C=v.fullViewport,D=C[2],F=C[3],G=D/this._blurSizePx,J=F/this._blurSizePx;this._ssaoFBO.resize(D,F);this._blur0FBO.resize(G,J);this._blur1FBO.resize(G,J);G=1*D;J=1*F;E.bindFramebuffer(this._ssaoFBO);E.setViewport(0,0,D,F);var I=E.useTechnique(this._ssaoTechnique);I.setUniform2f("rnmScale",
D/this._noiseTexture.descriptor.width,F/this._noiseTexture.descriptor.height);e.inverseProjectionInfo(v.projectionMatrix,v.fullWidth,v.fullHeight,t,u);I.setUniform4fv("projInfo",t);I.setUniform2fv("zScale",u);I.setUniform2fv("nearFar",v.nearFar);D=1/v.computeRenderPixelSizeAtDist(1);I.setUniform1f("projScale",1*D);I.setUniform2f("screenDimensions",G,J);F=x.distance(v.eye,v.center);var O=20*v.computeRenderPixelSizeAtDist(F);O=Math.max(.1,O);I.setUniform1f("radius",O);I.setUniform1f("intensity",4*this._attenuation/
O**6);I.bindTexture(this._noiseTexture,"rnm");I.bindTexture(A,"normalMap");I.bindTexture(B,"depthMap");d.isNone(this.quadVAO)&&(this.quadVAO=n.createQuadVAO(this._rctx));E.bindVAO(this.quadVAO);E.drawArrays(r.PrimitiveType.TRIANGLE_STRIP,0,h.vertexCount(this.quadVAO,"geometry"));I=E.useTechnique(this._blurTechnique);I.bindTexture(this._ssaoFBO.colorTexture,"tex");I.bindTexture(A,"normalMap");I.bindTexture(B,"depthMap");E.setViewport(0,0,G/this._blurSizePx,J/this._blurSizePx);E.bindFramebuffer(this._blur0FBO);
I.setUniform2f("screenDimensions",G,J);I.setUniform2f("blurSize",0,1*this._blurSizePx/J);I.setUniform2fv("nearFar",v.nearFar);5E4<F&&(D=Math.max(0,D-(F-5E4)));I.setUniform1f("projScale",D);E.drawArrays(r.PrimitiveType.TRIANGLE_STRIP,0,h.vertexCount(this.quadVAO,"geometry"));I.setUniform2f("blurSize",1*this._blurSizePx/G,0);E.bindFramebuffer(this._blur1FBO);I.bindTexture(this._blur0FBO.colorTexture,"tex");E.drawArrays(r.PrimitiveType.TRIANGLE_STRIP,0,h.vertexCount(this.quadVAO,"geometry"));E.setViewport(C[0],
C[1],C[2],C[3])}};z.bind=function(v,B){this.enabled&&d.isSome(this._blur1FBO)&&d.isSome(this._ssaoFBO)?(v.bindTexture(this._blur1FBO.colorTexture,"ssaoTex"),v.setUniform4f("viewportPixelSz",B.fullViewport[0],B.fullViewport[1],1/this._ssaoFBO.width,1/this._ssaoFBO.height)):v.setUniform4f("viewportPixelSz",-1,-1,-1,-1)};z._selectPrograms=function(){this._ssaoTechniqueConfig.output=k.SSAOOutput.SSAO;this._ssaoTechnique=this._techniqueRep.releaseAndAcquire(f.SSAOTechnique,this._ssaoTechniqueConfig,this._ssaoTechnique);
this._ssaoTechniqueConfig.output=k.SSAOOutput.Blur;this._blurTechnique=this._techniqueRep.releaseAndAcquire(f.SSAOTechnique,this._ssaoTechniqueConfig,this._blurTechnique)};z._enable=function(){this.enabled||(this._enabled=!0,this._loadResources(()=>{this._enabled&&this._initialize()}))};z._loadResources=function(v){this._data?v():(new Promise((B,A)=>a(["./SSAOHelperData"],B,A))).then(B=>{this._data=B;v()})};z._initialize=function(){const v={target:r.TextureType.TEXTURE_2D,pixelFormat:r.PixelFormat.RGBA,
dataType:r.PixelType.UNSIGNED_BYTE,samplingMode:r.TextureSamplingMode.LINEAR,wrapMode:r.TextureWrapMode.CLAMP_TO_EDGE,width:0,height:0},B={colorTarget:r.TargetType.TEXTURE,depthStencilTarget:r.DepthStencilTargetType.NONE};l.requestImage(this._data.noiseTexture).then(A=>{this._enabled&&(this._ssaoFBO=new y.FramebufferObject(this._rctx,B,v),this._blur0FBO=new y.FramebufferObject(this._rctx,B,v),this._blur1FBO=new y.FramebufferObject(this._rctx,B,v),this._noiseTexture=new p.Texture(this._rctx,{target:r.TextureType.TEXTURE_2D,
pixelFormat:r.PixelFormat.RGBA,dataType:r.PixelType.UNSIGNED_BYTE,hasMipmap:!0,width:A.width,height:A.height},A),this._requestRender())});this._selectPrograms()};z._disable=function(){this._enabled=!1;this._noiseTexture=d.disposeMaybe(this._noiseTexture);this._blur1FBO=d.disposeMaybe(this._blur1FBO);this._blur0FBO=d.disposeMaybe(this._blur0FBO);this._ssaoFBO=d.disposeMaybe(this._ssaoFBO)};c._createClass(q,[{key:"enabled",get:function(){return this._enabled},set:function(v){v?this._enable():this._disable()}},
{key:"ready",get:function(){return this.enabled&&d.isSome(this._noiseTexture)&&d.isSome(this._ssaoFBO)&&d.isSome(this._blur0FBO)&&d.isSome(this._blur1FBO)}},{key:"gpuMemoryUsage",get:function(){return(d.isSome(this._blur0FBO)?this._blur0FBO.gpuMemoryUsage:0)+(d.isSome(this._blur1FBO)?this._blur1FBO.gpuMemoryUsage:0)+(d.isSome(this._ssaoFBO)?this._ssaoFBO.gpuMemoryUsage:0)}},{key:"test",get:function(){return{ssao:this._ssaoFBO,blur:this._blur1FBO}}}]);return q}();const u=g.create(),t=w.create();b.SSAOHelper=
m;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/SSAOTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ./DefaultVertexAttributeLocations ./Program ../../../../chunks/SSAO.glsl ../../../webgl/renderState".split(" "),function(a,b,c,d,g,x,w,l,n,f,e){x=function(k){function r(){return k.apply(this,
arguments)||this}c._inheritsLoose(r,k);var y=r.prototype;y.initializeProgram=function(p){var h=r.shader.get();const m=(r.filterRadius+1)/2;h=h.build({output:this.configuration.output,samples:r.samples,filterRadius:r.filterRadius,blurFalloff:1/(2*m*m)});return new n.Program(p.rctx,h,l.Default3D)};y.initializePipeline=function(){return e.makePipelineState({colorWrite:e.defaultColorWriteParams})};return r}(x.ShaderTechnique);x.shader=new g.ReloadableShaderModule(f.SSAOShader,()=>new Promise((k,r)=>a(["../shaders/SSAO.glsl"],
k,r)));x.samples=16;x.filterRadius=4;g=function(k){function r(){var y=k.apply(this,arguments)||this;y.output=f.SSAOOutput.SSAO;return y}c._inheritsLoose(r,k);return r}(w.ShaderTechniqueConfiguration);d.__decorate([w.parameter({count:f.SSAOOutput.COUNT})],g.prototype,"output",void 0);b.SSAOTechnique=x;b.SSAOTechniqueConfiguration=g;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/SSAO.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,b,c,d,g,x){function w(n){const f=new x.ShaderBuilder;f.include(b.ScreenSpacePass);n.output===a.SSAOOutput.Blur&&(f.fragment.include(c.ReadLinearDepth),f.fragment.uniforms.add("normalMap","sampler2D").add("depthMap","sampler2D").add("tex","sampler2D").add("blurSize","vec2").add("projScale","float").add("nearFar","vec2"),f.fragment.code.add(g.glsl`
      void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
        float c = texture2D(tex, uv).r;
        float d = linearDepthFromTexture(depthMap, uv, nearFar);

        float ddiff = d - center_d;

        float w = exp(-r * r * ${g.glsl.float(n.blurFalloff)} - ddiff * ddiff * sharpness);
        wTotal += w;
        bTotal += w * c;
      }
    `),f.fragment.code.add(g.glsl`
      void main(void) {
        float b = 0.0;
        float w_total = 0.0;

        float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

        float sharpness = -0.05 * projScale/center_d;
        for (int r = -${g.glsl.int(n.filterRadius)}; r <= ${g.glsl.int(n.filterRadius)}; ++r) {
          float rf = float(r);
          vec2 uvOffset = uv + rf * blurSize;
          blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
        }

        gl_FragColor = vec4(b / w_total);
      }
    `));n.output===a.SSAOOutput.SSAO&&(f.fragment.include(c.ReadLinearDepth),f.include(d.CameraSpace),f.fragment.uniforms.add("normalMap","sampler2D").add("depthMap","sampler2D").add("intensity","float").add("projScale","float").add("radius","float").add("nearFar","vec2").add("screenDimensions","vec2").add("rnmScale","vec2").add("rnm","sampler2D"),f.fragment.code.add(g.glsl`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn-bias, 0.0);
}`),f.fragment.code.add(g.glsl`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),f.fragment.code.add(g.glsl`
      void main(void) {
        fillSphere();
        vec3 fres = normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));
        float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

        if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
          gl_FragColor = vec4(0.0);
          return;
        }

        vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

        // get the normal of current fragment
        vec4 norm4 = texture2D(normalMap, uv);
        vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
        bool isTerrain = norm4.w<0.5;

        float sum = .0;
        vec3 tapPixelPos;

        // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
        // bug or deviation from CE somewhere else?
        float ps = projScale/(2.0 * currentPixelPos.z * zScale.x + zScale.y);

        for(int i = 0; i < ${g.glsl.int(n.samples)}; ++i) {
          vec2 unitOffset = reflect(sphere[i], fres).xy;
          vec2 offset = vec2(-unitOffset * radius * ps);

          //don't use current or very nearby samples
          if ( abs(offset.x)<2.0 || abs(offset.y)<2.0) continue;

          vec2 tc = vec2(gl_FragCoord.xy + offset);
          if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenDimensions.x || tc.y > screenDimensions.y) continue;
          vec2 tcTap = tc/screenDimensions;
          float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

          if (isTerrain) {
            bool isTerrainTap = texture2D(normalMap, tcTap).w<0.5;
            if (isTerrainTap) {
              continue;
            }
          }

          tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

          sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
        }

        // output the result
        float A = max(1.0-sum*intensity/float(${g.glsl.int(n.samples)}),0.0);

        // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4)/2.2
        A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;
        gl_FragColor = vec4(A);
      }
    `));return f}a.SSAOOutput=void 0;(function(n){n[n.SSAO=0]="SSAO";n[n.Blur=1]="Blur";n[n.COUNT=2]="COUNT"})(a.SSAOOutput||(a.SSAOOutput={}));const l=Object.freeze({__proto__:null,get SSAOOutput(){return a.SSAOOutput},build:w});a.SSAOShader=l;a.build=w})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeView":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/Accessor ../../../../../core/arrayUtils ../../../../../core/Logger ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../chunks/sphere ../../../../../chunks/vec33 ../../core/shaderLibrary/attributes/VertexPosition.glsl ../../core/util/TwoVectorPosition ../GridLocalOriginFactory ../localOriginHelper ../LocalOriginManager ../Object3D ../VertexAttribute ./bufferLayouts ./edgeBufferWriters ./edgePreprocessing ./EdgeRenderer ./EdgeWorkerHandle ./interfaces ./strokes ./util ../TextureBackedBuffer/BufferManager ../../../../support/WatchUpdatingTracking ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A,E,C,D,F,G,J,I,O,P,K,M,U,R,L,N,T){function S(W){let V=null,Y=null;for(let X=0;X<W.geometries.length;X++){var aa;const ba=W.geometryRecords[X];if(ba.material.supportsEdges){if(!V)V=ba.transformation;else if(!g.equals(V,ba.transformation))return!1;if(!Y&&l.isSome(ba.origin))Y=ba;else if(l.isSome(null==(aa=Y)?void 0:aa.origin)&&l.isSome(ba.origin)&&Y.origin.id!==ba.origin.id)return!1}}return!0}const H=x.getLogger("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView");
a.EdgeView=function(W){function V(aa){var X=W.call(this,aa)||this;X.updatingHandles=new R.WatchUpdatingTracking;X.perObjectData=new Map;X.perObjectDataEvictionCache=new Set;X.renderers=new Map;X.numberOfRenderedEdges={[P.Transparency.TRANSPARENT]:0,[P.Transparency.OPAQUE]:0};X.gpuMemoryUsage=0;X.workerAbort=new AbortController;X.tmpModelPosition=u.create();X.localOrigins=new E.LocalOriginManager(new B.GridLocalOriginFactory(aa.renderSR));return X}b._inheritsLoose(V,W);var Y=V.prototype;Y.initialize=
function(){this.worker=new O(this.schedule);this.componentColorManager=new U.BufferManager(this.rctx,2);const aa=F.VertexLayout.createBuffer(4);for(let X=0;4>X;X++)aa.sideness.set(X,0,0===X||3===X?0:1),aa.sideness.set(X,1,0===X||1===X?0:1);this.verticesBufferObject=L.BufferObject.createVertex(this.rctx,N.Usage.STATIC_DRAW,aa.buffer)};Y.destroy=function(){this.destroyed||(this.perObjectData.forEach(aa=>this._discardObjectEntry(aa)),this.perObjectData.clear(),this.strokesTexture=l.disposeMaybe(this.strokesTexture),
this.componentColorManager=l.destroyMaybe(this.componentColorManager),this.workerAbort.abort(),this.worker.destroy(),this.verticesBufferObject=l.disposeMaybe(this.verticesBufferObject),this.renderers.clear(),this.updatingHandles.destroy())};Y.shouldRender=function(){return 0<this.renderers.size};Y.addComponentObject=function(){var aa=b._asyncToGenerator(function*(X,ba,ha,ka,ia,ea,ca,Z){if(this.hasObject(X))return this.getObjectMemoryUsage(X);let fa;ha=new Q(new Promise(ja=>fa=ja),ha.center,ha.radius);
this.perObjectData.set(X,ha);X=yield this.updatingHandles.addPromise(this._addComponentGeometry(ba,ha,ka,ia,ea,ca,Z));this.setNeedsRender();fa();return X});return function(X,ba,ha,ka,ia,ea,ca,Z){return aa.apply(this,arguments)}}();Y.addOrUpdateObject3D=function(){var aa=b._asyncToGenerator(function*(X,ba,ha,ka){if(this.destroyed)H.warn("Attempt to add an object to a destroyed instance");else{var ia=this.perObjectData.get(X);0<(null==ia?void 0:ia.renderables.length)&&this.perObjectDataEvictionCache.add(ia);
var ea,ca=X.boundingVolumeWorldSpace.bounds;ca=new Q(new Promise(fa=>ea=fa),t.getCenter(ca),t.getRadius(ca));this.perObjectData.set(X,ca);var Z=[];if(ha.mergeGeometries&&1<X.geometries.length&&S(X))Z.push(this._addObjectMergedGeometries(X,ca,ba,ha,ka));else for(let fa=0;fa<X.geometries.length;fa++){const ja=X.geometryRecords[fa];ja.material.supportsEdges&&Z.push(this._addGeometry(X,ca,X.geometries[fa],ja,ba[0],ha,ka))}yield this.updatingHandles.addPromise(Promise.all(Z));this.perObjectDataEvictionCache.delete(ca);
this._discardObjectEntry(ia);this.setNeedsRender();ea()}});return function(X,ba,ha,ka){return aa.apply(this,arguments)}}();Y._discardObjectEntry=function(aa){aa&&(aa.renderables.length&&(aa.renderables.forEach(X=>this._removeRenderable(X)),this.setNeedsRender()),aa.loaded=null)};Y.hasObject=function(aa){return this.perObjectData.has(aa)};Y.updateAllComponentOpacities=function(){var aa=b._asyncToGenerator(function*(X,ba){const ha=ba instanceof Array?ka=>ba[ka]:()=>ba;(yield this.updatingHandles.addPromise(this._getObjectEntry(X))).renderables.forEach(ka=>
{const ia=ka.components.meta.length;for(let ea=0;ea<ia;ea++){const ca=ha(ea),Z=ka.components.meta[ea],fa=Z.index;Z.material.opacity=ca;ka.components.buffer.textureBuffer.setDataElement(fa,1,3,255*ca)}this._updateTransparency(ka)});this.setNeedsRender()});return function(X,ba){return aa.apply(this,arguments)}}();Y.getObjectMemoryUsage=function(){var aa=b._asyncToGenerator(function*(X){return(yield this._getObjectEntry(X)).renderables.reduce((ba,ha)=>ba+ha.statistics.gpuMemoryUsage,0)});return function(X){return aa.apply(this,
arguments)}}();Y.updateAllComponentMaterials=function(){var aa=b._asyncToGenerator(function*(X,ba,ha,ka){const ia=X instanceof C.Object3D,ea=!!ha.slicePlaneEnabled,ca=M.determineRendererType(ba),Z=I.EdgeRenderer.getKey(ca,ea,ia);(yield this.updatingHandles.addPromise(this._getObjectEntry(X))).renderables.forEach(fa=>{if(Z!==fa.rendererKey){var ja=this.renderers.get(fa.rendererKey);const la=this._acquireRenderer(ca,ea,ia);ja.removeRenderable(fa);ja.refCount.decrement();fa.rendererKey=Z;la.addRenderable(fa)}for(ja=
0;ja<ba.length;ja++)fa.components.meta[ja].material=ba[ja];ka&&this._updateComponentBuffer(fa.components);this._updateTransparency(fa)});this.setNeedsRender()});return function(X,ba,ha,ka){return aa.apply(this,arguments)}}();Y.updateObjectVisibility=function(){var aa=b._asyncToGenerator(function*(X,ba){(yield this.updatingHandles.addPromise(this._getObjectEntry(X))).renderables.forEach(ha=>ha.visible=ba);this.setNeedsRender()});return function(X,ba){return aa.apply(this,arguments)}}();Y.removeObject=
function(aa){const X=this.perObjectData.get(aa);X&&(this.perObjectData.delete(aa),this._discardObjectEntry(X))};Y._getObjectEntry=function(){var aa=b._asyncToGenerator(function*(X){X=this.perObjectData.get(X);if(!X)throw"no object";yield X.loaded;return X});return function(X){return aa.apply(this,arguments)}}();Y.removeAll=function(){this.perObjectData.forEach((aa,X)=>this.removeObject(X))};Y.render=function(aa,X){this.numberOfRenderedEdges[X]=0;if(!l.isNone(this.componentColorManager)){this.localOrigins.updateViewMatrices(aa.camera.viewMatrix);
var ba=aa.camera.viewInverseTransposeMatrix,ha=u.create(),ka=new v.TwoVectorPosition,ia=new z.VertexPositionViewProjectionTransform,ea=y.create();m.set(ha,ba[3],ba[7],ba[11]);ka.set(ha);m.copy(ia.transformWorldFromViewTH,ka.high);m.copy(ia.transformWorldFromViewTL,ka.low);r.fromMat4(ia.transformViewFromCameraRelativeRS,aa.camera.viewMatrix);p.copy(ia.transformProjFromView,aa.camera.projectionMatrix);ba=y.create();r.transpose(ba,ia.transformViewFromCameraRelativeRS);r.invert(ea,ba);var ca=0,Z=0;this.renderers.forEach(ja=>
{0===ja.refCount.value?(this.renderers.delete(ja.key),ja.dispose()):ja.forEachRenderable(la=>{la.visible&&(ca+=la.statistics.averageEdgeLength,Z++)},X)});this.componentColorManager.garbageCollect();this.componentColorManager.updateTextures();if(0!==Z){var fa={distanceFalloffFactor:40*ca/Z,minimumEdgeLength:aa.camera.perScreenPixelRatio,transparency:X,viewProjectionTransform:ia,transformNormalViewFromGlobal:ea};this._updateObjectCameraDistances(aa);this.renderers.forEach(ja=>{this._renderRegularEdges(ja,
aa,fa);this._renderSilhouetteEdges(ja,aa,fa)})}}};Y._updateTransparency=function(aa){const X=M.determineEdgeTransparency(aa.components.meta),ba=M.determineObjectTransparency(aa.components.meta);if(X!==aa.edgeTransparency||ba!==aa.objectTransparency)aa.edgeTransparency=X,aa.objectTransparency=ba,this.renderers.get(aa.rendererKey).setRenderablesDirty()};Y._computeModelTransformWithLocalOrigin=function(aa,X,ba){aa.getCombinedStaticTransformation(X,ba);l.isSome(X.origin)?this.localOrigins.register(X.origin):
(aa=m.set(this.tmpModelPosition,ba[12],ba[13],ba[14]),X.origin=this.localOrigins.acquire(aa));A.applyToModelMatrix(X.origin.vec3,ba);return X.origin};Y._updateComponentBuffer=function(aa){const {meta:X,buffer:ba}=aa;for(aa=0;aa<X.length;aa++){var ha=X[aa].material;const ka=X[aa].index,ia=w.clamp(Math.round(ha.size*I.LINE_WIDTH_FRACTION_FACTOR),0,255),ea=w.clamp(ha.extensionLength,-I.EXTENSION_LENGTH_OFFSET,255-I.EXTENSION_LENGTH_OFFSET)+I.EXTENSION_LENGTH_OFFSET,ca="solid"===ha.type?J.EdgeType.SOLID:
J.EdgeType.SKETCH,Z=255*ha.opacity;ha=ha.color;ba.textureBuffer.setData(ka,0,255*ha[0],255*ha[1],255*ha[2],255*ha[3]);ba.textureBuffer.setData(ka,1,ia,ea,ca,Z)}};Y._createComponentBuffers=function(aa){if(l.isNone(this.componentColorManager))return null;const X=[],ba=this.componentColorManager.getBuffer(aa.length);for(let ha=0;ha<aa.length;ha++){const ka=aa[ha],ia=ba.acquireIndex();X.push({index:ia,material:ka})}aa={meta:X,buffer:ba};this._updateComponentBuffer(aa);return aa};Y._extractEdges=function(aa,
X,ba,ha,ka,ia=ka.length){return this.worker.process({data:X,indices:ka,indicesLength:ia,writerSettings:aa,skipDeduplicate:ba},this.workerAbort.signal,ha)};Y._createEdgeResources=function(aa){const X={};if(l.isNone(this.verticesBufferObject))return X;if(0<aa.regular.lodInfo.lengths.length){var ba=new T.VertexArrayObject(this.rctx,F.EdgeShaderAttributeLocations,{vertices:F.glVertexLayout,instances:G.RegularEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:L.BufferObject.createVertex(this.rctx,
N.Usage.STATIC_DRAW,aa.regular.instancesData.buffer)});X.regular={vao:ba,lod:aa.regular.lodInfo}}0<aa.silhouette.lodInfo.lengths.length&&(ba=new T.VertexArrayObject(this.rctx,F.EdgeShaderAttributeLocations,{vertices:F.glVertexLayout,instances:G.SilhouetteEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:L.BufferObject.createVertex(this.rctx,N.Usage.STATIC_DRAW,aa.silhouette.instancesData.buffer)}),X.silhouette={vao:ba,lod:aa.silhouette.lodInfo});return X};Y._addGeometry=function(){var aa=
b._asyncToGenerator(function*(X,ba,ha,ka,ia,ea,ca){const Z=ha.vertexAttributes.get(D.VertexAttribute.POSITION),fa=ha.indices.get(D.VertexAttribute.POSITION),ja=h.create();X=this._computeModelTransformWithLocalOrigin(X,ka,ja);return this._addPositionData(ba,{position:Z,indices:fa,modelTransform:ja,origin:X},ha.edgeIndicesLength,ia,ea,ca)});return function(X,ba,ha,ka,ia,ea,ca){return aa.apply(this,arguments)}}();Y._addPositionData=function(){var aa=b._asyncToGenerator(function*(X,ba,ha,ka,ia,ea=!1){if(null!=
X.loaded){var ca=this._createComponentBuffers([ka]);if(!(l.isNone(ca)||0>=ha)){ka=this._acquireRenderer(ka.type,!!ia.slicePlaneEnabled);var {modelTransform:Z,origin:fa}=ba;ia=ba.indices;ba=ba.position;var ja=ba.data.length/ba.size,la=F.EdgeInputBufferLayout.createBuffer(ja);for(let va=0;va<ja;va++)la.position.set(va,0,ba.data[va*ba.size]),la.position.set(va,1,ba.data[va*ba.size+1]),la.position.set(va,2,ba.data[va*ba.size+2]);M.fillComponenBufferIndices(ca.meta,[0,la.componentIndex.count],la.componentIndex);
ea=yield this.updatingHandles.addPromise(this._extractEdges(ka.writerSettings,la,!1,ea,ia,ha));if(null!=X.loaded){var {regular:ma,silhouette:ra}=this._createEdgeResources(ea);ha=(ma?ma.vao.size:0)+(ra?ra.vao.size:0);ca={regular:ma,silhouette:ra,transform:{modelMatrix:Z,origin:fa},statistics:{gpuMemoryUsage:ha,externalMemoryUsage:!1,averageEdgeLength:ea.averageEdgeLength},components:ca,visible:!0,edgeTransparency:M.determineEdgeTransparency(ca.meta),objectTransparency:M.determineObjectTransparency(ca.meta),
distanceToCamera:0,rendererKey:ka.key};X.renderables.push(ca);ka.addRenderable(ca);this.gpuMemoryUsage+=ha}}}});return function(X,ba,ha,ka,ia){return aa.apply(this,arguments)}}();Y._addComponentGeometry=function(){var aa=b._asyncToGenerator(function*(X,ba,ha,ka,ia,ea,ca){if(null==ba.loaded)return 0;const Z=this._createComponentBuffers(ea);if(l.isNone(Z))return 0;ea=M.determineRendererType(ea);ca=this._acquireRenderer(ea,ca.slicePlaneEnabled||!1,!1);ea=F.EdgeInputBufferLayout.createBuffer(ha.count);
q.copy(ea.position,ha);M.fillComponenBufferIndices(Z.meta,ia,ea.componentIndex,ka);ka=yield this.updatingHandles.addPromise(this._extractEdges(ca.writerSettings,ea,!0,!1,ka));if(null==ba.loaded)return 0;const {regular:fa,silhouette:ja}=this._createEdgeResources(ka);ha=(fa?fa.vao.size:0)+(ja?ja.vao.size:0);X={regular:fa,silhouette:ja,transform:X,statistics:{gpuMemoryUsage:ha,externalMemoryUsage:!0,averageEdgeLength:ka.averageEdgeLength},components:Z,visible:!0,edgeTransparency:M.determineEdgeTransparency(Z.meta),
objectTransparency:M.determineObjectTransparency(Z.meta),distanceToCamera:0,rendererKey:ca.key};ba.renderables.push(X);ca.addRenderable(X);return ha});return function(X,ba,ha,ka,ia,ea,ca){return aa.apply(this,arguments)}}();Y._addObjectMergedGeometries=function(){var aa=b._asyncToGenerator(function*(X,ba,ha,ka,ia){var ea=new Map,ca=0,Z=null,fa=0;for(var ja=0;ja<X.geometries.length;ja++){var la=X.geometries[ja],ma=X.geometryRecords[ja];ma.material.supportsEdges&&(!Z&&ma.origin&&(Z=ma),ma=la.vertexAttributes.get(D.VertexAttribute.POSITION),
fa+=ma.data.length/ma.size,ca+=la.edgeIndicesLength)}fa=65536<=fa?Uint32Array:Uint16Array;ca=ca?new fa(ca):null;fa=[];ja=0;for(la=0;la<X.geometries.length;la++){ma=X.geometries[la];if(!X.geometryRecords[la].material.supportsEdges)continue;var ra=ma.vertexAttributes.get(D.VertexAttribute.POSITION);const va=ma.indices.get(D.VertexAttribute.POSITION);let ya=ea.get(ra.data);if(null==ya){ya=fa.length/3;for(let za=0;za<ra.data.length;za+=ra.size)fa.push(ra.data[za+0]),fa.push(ra.data[za+1]),fa.push(ra.data[za+
2]);ea.set(ra.data,ya)}if(va)for(ra=0;ra<ma.edgeIndicesLength;ra++)ca[ja++]=ya+va[ra]}Z=Z||X.geometryRecords[0];ea=h.create();Z=this._computeModelTransformWithLocalOrigin(X,Z,ea);for(ja=0;ja<X.geometryRecords.length;ja++)X.geometryRecords[ja].origin=Z;yield this.updatingHandles.addPromise(this._addPositionData(ba,{position:{data:fa,size:3},indices:ca,modelTransform:ea,origin:Z},ca.length,ha[0],ka,ia))});return function(X,ba,ha,ka,ia){return aa.apply(this,arguments)}}();Y._acquireRenderer=function(aa,
X,ba=!0){const ha=I.EdgeRenderer.getKey(aa,X,ba);let ka=this.renderers.get(ha);l.isNone(this.strokesTexture)&&(this.strokesTexture=K.generateStrokesTexture(this.rctx));ka||(ka=new I.EdgeRenderer(this.rctx,this.techniqueRepository,{type:aa,slicePlaneEnabled:X,strokesTexture:this.strokesTexture,legacy:ba}),this.renderers.set(ha,ka));ka.refCount.increment();return ka};Y._removeRenderable=function(aa){aa.regular&&(aa.regular.vao.vertexBuffers.instances.dispose(),aa.regular.vao.dispose(!1),aa.regular.vao=
null);aa.silhouette&&(aa.silhouette.vao.vertexBuffers.instances.dispose(),aa.silhouette.vao.dispose(!1),aa.silhouette.vao=null);const X=this.renderers.get(aa.rendererKey);if(X){X.removeRenderable(aa);X.refCount.decrement();"origin"in aa.transform&&this.localOrigins.release(aa.transform.origin);this.gpuMemoryUsage-=aa.statistics.externalMemoryUsage?0:aa.statistics.gpuMemoryUsage;for(const ba of aa.components.meta)aa.components.buffer.releaseIndex(ba.index)}};Y._updateObjectCameraDistances=function(aa){const X=
aa.camera.eye,ba=aa.camera.viewForward,ha=u.create();aa=ka=>{const {center:ia,radius:ea}=ka;m.sub(ha,ia,X);const ca=m.dot(ha,ba),Z=ca<-ea?Infinity:ca<ea?0:ca-ea;ka.renderables.forEach(fa=>fa.distanceToCamera=Z)};this.perObjectData.forEach(aa);this.perObjectDataEvictionCache.forEach(aa)};Y._renderRegularEdges=function(aa,X,ba){aa.bindRegularEdges(X,ba);const ha=ba.transparency;aa.forEachRenderable(ka=>{if(ka.visible&&ka.regular){var ia=M.computeEdgeCount(ka.regular.lod.lengths,ka.distanceToCamera,
ba);"origin"in ka.transform&&(X.localViewMatrixForEdges=this.localOrigins.getViewMatrix(ka.transform.origin));aa.renderRegularEdges(ka,X,ia);this.numberOfRenderedEdges[ha]+=ia}},ha)};Y._renderSilhouetteEdges=function(aa,X,ba){aa.bindSilhouetteEdges(X,ba);const ha=ba.transparency;aa.forEachRenderable(ka=>{if(ka.visible&&ka.silhouette){var ia=M.computeEdgeCount(ka.silhouette.lod.lengths,ka.distanceToCamera,ba);"origin"in ka.transform&&(X.localViewMatrixForEdges=this.localOrigins.getViewMatrix(ka.transform.origin));
aa.renderSilhouetteEdges(ka,X,ia);this.numberOfRenderedEdges[ha]+=ia}},ha)};b._createClass(V,[{key:"updating",get:function(){return this.updatingHandles.updating}},{key:"usedMemory",get:function(){return this.gpuMemoryUsage}},{key:"numberOfRenderedPrimitives",get:function(){return this.numberOfRenderedEdges[P.Transparency.TRANSPARENT]+this.numberOfRenderedEdges[P.Transparency.OPAQUE]}}]);return V}(d);c.__decorate([n.property({constructOnly:!0})],a.EdgeView.prototype,"rctx",void 0);c.__decorate([n.property({constructOnly:!0})],
a.EdgeView.prototype,"renderSR",void 0);c.__decorate([n.property({constructOnly:!0})],a.EdgeView.prototype,"techniqueRepository",void 0);c.__decorate([n.property({constructOnly:!0})],a.EdgeView.prototype,"setNeedsRender",void 0);c.__decorate([n.property({constructOnly:!0})],a.EdgeView.prototype,"schedule",void 0);c.__decorate([n.property({readOnly:!0})],a.EdgeView.prototype,"updatingHandles",void 0);c.__decorate([n.property({readOnly:!0})],a.EdgeView.prototype,"updating",null);a.EdgeView=c.__decorate([k.subclass("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],
a.EdgeView);let Q=function(W,V,Y){this.center=V;this.radius=Y;this.renderables=[];this.loaded=W;this.loaded.then(()=>{null!=this.loaded&&(this.loaded=!0)})};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/localOriginHelper":function(){define(["exports"],function(a){a.applyToModelMatrix=function(b,c){const d=-b[0],g=-b[1];b=-b[2];const x=c[3],w=c[7],l=c[11],n=c[15];c[0]+=x*d;c[1]+=x*g;c[2]+=x*b;c[4]+=w*d;c[5]+=w*g;c[6]+=w*b;c[8]+=l*d;c[9]+=l*g;c[10]+=l*b;c[12]+=
n*d;c[13]+=n*g;c[14]+=n*b};a.applyToViewMatrix=function(b,c){const d=b[0],g=b[1];b=b[2];c[12]+=d*c[0]+g*c[4]+b*c[8];c[13]+=d*c[1]+g*c[5]+b*c[9];c[14]+=d*c[2]+g*c[6]+b*c[10];c[14]+=d*c[3]+g*c[7]+b*c[11]};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/LocalOriginManager":function(){define(["exports","../../../../chunks/mat4","../../../../chunks/mat4f64","./localOriginHelper"],function(a,b,c,d){let g=function(){function x(l){this.factory=l;this.originData=new Map}
var w=x.prototype;w.acquire=function(l){return this.register(this.factory.getOrigin(l))};w.register=function(l){const n=this.originData.get(l.id);if(n)return n.refCount++,n.origin;this.originData.set(l.id,{refCount:1,viewMatrix:c.create(),origin:l});return l};w.release=function(l){const n=this.originData.get(l.id);n&&(n.refCount--,0===n.refCount&&this.originData.delete(l.id))};w.updateViewMatrices=function(l){this.originData.forEach(n=>{b.copy(n.viewMatrix,l);d.applyToViewMatrix(n.origin.vec3,n.viewMatrix)})};
w.getViewMatrix=function(l){return this.originData.get(l.id).viewMatrix};return x}();a.LocalOriginManager=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/bufferLayouts":function(){define(["exports","../../../support/buffer/glUtil","../../../support/buffer/InterleavedLayout","../VertexAttribute"],function(a,b,c,d){const g=c.newLayout().vec3f(d.VertexAttribute.POSITION).u16(d.VertexAttribute.COMPONENTINDEX).u16(d.VertexAttribute.U16PADDING),x=c.newLayout().vec2u8(d.VertexAttribute.SIDENESS);
b=b.glLayout(x);c=c.newLayout().vec3f(d.VertexAttribute.POSITION0).vec3f(d.VertexAttribute.POSITION1).u16(d.VertexAttribute.COMPONENTINDEX).u8(d.VertexAttribute.VARIANTOFFSET,{glNormalized:!0}).u8(d.VertexAttribute.VARIANTSTROKE).u8(d.VertexAttribute.VARIANTEXTENSION,{glNormalized:!0}).u8(d.VertexAttribute.U8PADDING,{glPadding:!0}).u16(d.VertexAttribute.U16PADDING,{glPadding:!0});const w=c.clone().vec3f(d.VertexAttribute.NORMAL),l=c.clone().vec3f(d.VertexAttribute.NORMALA).vec3f(d.VertexAttribute.NORMALB);
d=new Map([[d.VertexAttribute.POSITION0,0],[d.VertexAttribute.POSITION1,1],[d.VertexAttribute.COMPONENTINDEX,2],[d.VertexAttribute.VARIANTOFFSET,3],[d.VertexAttribute.VARIANTSTROKE,4],[d.VertexAttribute.VARIANTEXTENSION,5],[d.VertexAttribute.NORMAL,6],[d.VertexAttribute.NORMALA,6],[d.VertexAttribute.NORMALB,7],[d.VertexAttribute.SIDENESS,8]]);a.CommonInstancesLayout=c;a.EdgeInputBufferLayout=g;a.EdgeShaderAttributeLocations=d;a.RegularEdgeInstancesLayout=w;a.SilhouetteEdgeInstancesLayout=l;a.VertexLayout=
x;a.glVertexLayout=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgeBufferWriters":function(){define("exports ../../../../../core/RandomLCG ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../support/buffer/glUtil ./bufferLayouts".split(" "),function(a,b,c,d,g,x){function w(u){const t=e;t[0]=u.position0[0];t[1]=u.position0[1];t[2]=u.position0[2];t[3]=u.position1[0];t[4]=u.position1[1];t[5]=u.position1[2];r[0]=5381;for(u=0;u<k.length;u++)r[0]=
31*r[0]+k[u];return r[0]}function l(u){const t=e;t[0]=n(u.position0[0]);t[1]=n(u.position0[1]);t[2]=n(u.position0[2]);t[3]=n(u.position1[0]);t[4]=n(u.position1[1]);t[5]=n(u.position1[2]);r[0]=5381;for(u=0;u<k.length;u++)r[0]=31*r[0]+k[u];return r[0]}function n(u){return Math.round(1E4*u)/1E4}let f=function(){function u(){}var t=u.prototype;t.updateSettings=function(q){this.settings=q;this.edgeHashFunction=q.reducedPrecision?l:w};t.write=function(q,z,v){var B=this.edgeHashFunction(v);m.seed=B;B=m.getIntRange(0,
255);const A=m.getIntRange(0,this.settings.variants-1);var E=m.getFloat();E=-(1-Math.min(E/.7,1))+Math.max(0,E-.7)/(1-.7);E=255*(Math.abs(E)**1.2*(0>E?-1:1)*.5+.5);q.position0.setVec(z,v.position0);q.position1.setVec(z,v.position1);q.componentIndex.set(z,v.componentIndex);q.variantOffset.set(z,B);q.variantStroke.set(z,A);q.variantExtension.set(z,E)};t.trim=function(q,z){return q.slice(0,z)};return u}();const e=new Float32Array(6),k=new Uint32Array(e.buffer),r=new Uint32Array(1);let y=function(){function u(){this.commonWriter=
new f}var t=u.prototype;t.updateSettings=function(q){this.commonWriter.updateSettings(q)};t.allocate=function(q){return x.RegularEdgeInstancesLayout.createBuffer(q)};t.write=function(q,z,v){this.commonWriter.write(q,z,v);c.add(h,v.faceNormal0,v.faceNormal1);c.normalize(h,h);q.normal.setVec(z,h)};t.trim=function(q,z){return this.commonWriter.trim(q,z)};return u}();y.Layout=x.RegularEdgeInstancesLayout;y.glLayout=g.glLayout(x.RegularEdgeInstancesLayout,1);let p=function(){function u(){this.commonWriter=
new f}var t=u.prototype;t.updateSettings=function(q){this.commonWriter.updateSettings(q)};t.allocate=function(q){return x.SilhouetteEdgeInstancesLayout.createBuffer(q)};t.write=function(q,z,v){this.commonWriter.write(q,z,v);q.normalA.setVec(z,v.faceNormal0);q.normalB.setVec(z,v.faceNormal1)};t.trim=function(q,z){return this.commonWriter.trim(q,z)};return u}();p.Layout=x.SilhouetteEdgeInstancesLayout;p.glLayout=g.glLayout(x.SilhouetteEdgeInstancesLayout,1);const h=d.create(),m=new b;a.CommonBufferWriter=
f;a.RegularEdgeBufferWriter=y;a.SilhouetteEdgeBufferWriter=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgePreprocessing":function(){define("exports ../../../../../core/arrayUtils ../../../../../core/mathUtils ../../../../../core/typedArrayUtil ../../../../../chunks/vec3 ../../../../../chunks/vec3f64".split(" "),function(a,b,c,d,g,x){function w(r,y){const p=c.acosClamped(r.cosAngle),h=f.fwd,m=f.ortho;g.direction(h,r.position1,r.position0);r=
0<g.dot(g.cross(m,r.faceNormal0,r.faceNormal1),h)?-1:1;return p*r>y}function l(r){const y=r.faces.length/3,p=r.faces;r=r.neighbors;var h=0;for(var m=0;m<y;m++){var u=r[3*m+1],t=r[3*m+2],q=p[3*m],z=p[3*m+1],v=p[3*m+2];h+=-1===r[3*m]||q<z?1:0;h+=-1===u||z<v?1:0;h+=-1===t||v<q?1:0}h=new Int32Array(4*h);m=0;for(u=0;u<y;u++){t=r[3*u];q=r[3*u+1];z=r[3*u+2];v=p[3*u];const B=p[3*u+1],A=p[3*u+2];if(-1===t||v<B)h[m++]=v,h[m++]=B,h[m++]=u,h[m++]=t;if(-1===q||B<A)h[m++]=B,h[m++]=A,h[m++]=u,h[m++]=q;if(-1===z||
A<v)h[m++]=A,h[m++]=v,h[m++]=u,h[m++]=z}return h}function n(r){const y=r.faces.length/3,p=r.vertices.position;r=r.faces;const h=e.v0,m=e.v1,u=e.v2,t=new Float32Array(3*y);for(let q=0;q<y;q++){const z=r[3*q+1],v=r[3*q+2];p.getVec(r[3*q],h);p.getVec(z,m);p.getVec(v,u);g.subtract(m,m,h);g.subtract(u,u,h);g.cross(h,m,u);g.normalize(h,h);t[3*q]=h[0];t[3*q+1]=h[1];t[3*q+2]=h[2]}return t}a.EdgeType=void 0;(function(r){r[r.SOLID=0]="SOLID";r[r.SKETCH=1]="SKETCH"})(a.EdgeType||(a.EdgeType={}));const f={edge:{position0:x.create(),
position1:x.create(),faceNormal0:x.create(),faceNormal1:x.create(),componentIndex:0,cosAngle:0},ortho:x.create(),fwd:x.create()},e={v0:x.create(),v1:x.create(),v2:x.create()},k={anglePlanar:4,angleSignificantEdge:35};a.extractEdges=function(r,y,p,h=k){const m=r.vertices.position;var u=r.vertices.componentIndex,t=c.deg2rad(h.anglePlanar);h=c.deg2rad(h.angleSignificantEdge);const q=Math.cos(h),z=Math.cos(t),v=f.edge,B=v.position0,A=v.position1,E=v.faceNormal0,C=v.faceNormal1,D=n(r),F=l(r),G=F.length/
4;r=y.allocate(G);h=0;const J=p.allocate(G);let I=0,O=0,P=0;const K=b.range(0,G),M=new Float32Array(G);d.forEach(M,(N,T,S)=>{m.getVec(F[4*T],B);m.getVec(F[4*T+1],A);S[T]=g.distance(B,A)});K.sort((N,T)=>M[T]-M[N]);const U=[],R=[];for(let N=0;N<G;N++){var L=K[N];const T=M[L],S=F[4*L],H=F[4*L+1],Q=F[4*L+2];L=F[4*L+3];const W=-1===L;m.getVec(S,B);m.getVec(H,A);if(W)g.set(E,D[3*Q],D[3*Q+1],D[3*Q+2]),g.copy(C,E),v.componentIndex=u.get(S),v.cosAngle=g.dot(E,C);else{g.set(E,D[3*Q],D[3*Q+1],D[3*Q+2]);g.set(C,
D[3*L],D[3*L+1],D[3*L+2]);v.componentIndex=u.get(S);v.cosAngle=g.dot(E,C);if(v.cosAngle>z)continue;-.9999>v.cosAngle&&g.copy(C,E)}O+=T;P++;W||v.cosAngle<q?(y.write(r,h++,v),U.push(T)):w(v,t)&&(p.write(J,I++,v),R.push(T))}u=new Float32Array(U.reverse());t=new Float32Array(R.reverse());return{regular:{instancesData:y.trim(r,h),lodInfo:{lengths:u}},silhouette:{instancesData:p.trim(J,I),lodInfo:{lengths:t}},averageEdgeLength:O/P}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeRenderer":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../core/PooledArray ../../../../../chunks/mat3 ../../../../../chunks/mat3f32 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../support/debugFlags ../../collections/Component/Material/ComponentTechnique ../../core/shaderLibrary/Slice.glsl ../../core/shaderLibrary/attributes/VertexPosition.glsl ../../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../../core/shaderLibrary/util/DoublePrecision.glsl ../../core/util/TwoVectorPosition ./EdgeShaderTechnique ./interfaces ../../shaders/sources/edgeRenderer/EdgeUtil.glsl ../../../../webgl/enums".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t){const q={type:"uber",slicePlaneEnabled:!1,sliceHighlightDisabled:!1,strokesTexture:null,legacy:!0};let z=function(){function E(){this._value=0}var C=E.prototype;C.increment=function(){this._value++};C.decrement=function(){this._value--};b._createClass(E,[{key:"value",get:function(){return this._value}}]);return E}();const v={solid:u.EdgeUtilMode.SOLID,sketch:u.EdgeUtilMode.SKETCH,uber:u.EdgeUtilMode.MIXED};u=function(){function E(D,F,G){this.rctx=D;
this.shaderTechniqueRepository=F;this.config=new h.EdgeShaderTechniqueConfiguration;this.technique=null;this.refCount=new z;this.renderables=new Set;this.sortedRenderables={[m.Transparency.TRANSPARENT]:{[m.Transparency.TRANSPARENT]:new d,[m.Transparency.OPAQUE]:new d},[m.Transparency.OPAQUE]:{[m.Transparency.TRANSPARENT]:new d,[m.Transparency.OPAQUE]:new d}};this.renderablesDirty=!1;this.settings={...q,...G};this.key=E.getKey(this.settings.type,this.settings.slicePlaneEnabled,this.settings.legacy);
this.writerSettings={variants:this.settings.strokesTexture.variants,reducedPrecision:n.TESTS_DISABLE_OPTIMIZATIONS};this.config.legacy=this.settings.legacy;this.config.mode=v[this.settings.type];this.config.silhouette=!1;this.config.antialiasing=!!this.rctx.capabilities.blendMinMax;this.config.slicePlaneEnabled=this.settings.slicePlaneEnabled;this.config.doublePrecisionRequiresObfuscation=y.doublePrecisionRequiresObfuscation(D)}var C=E.prototype;C.dispose=function(){this.technique=c.releaseMaybe(this.technique)};
C.addRenderable=function(D){this.renderables.add(D);this.renderablesDirty=!0};C.removeRenderable=function(D){this.renderables.delete(D);this.renderablesDirty=!0};C.setRenderablesDirty=function(){this.renderablesDirty=!0};C.forEachRenderable=function(D,F){this.renderablesDirty&&this._sortRenderables();this.sortedRenderables[F][m.Transparency.TRANSPARENT].forAll(D);this.sortedRenderables[F][m.Transparency.OPAQUE].forAll(D)};C.setMultipassParameters=function(D){this.config.multipassTerrainEnabled=D.multipassTerrainEnabled?
D.multipassTerrainEnabled:!1;this.config.cullAboveGround=D.cullAboveGround?D.cullAboveGround:!1};C.bindRegularEdges=function(D,F){this.setMultipassParameters(D);this.config.silhouette=!1;this.technique=this.shaderTechniqueRepository.releaseAndAcquire(h.EdgeShaderTechnique,this.config,this.technique);this.rctx.useTechnique(this.technique,D.slot);this.technique.bindPass({bindParameters:D,edgeRenderParameters:F})};C.bindSilhouetteEdges=function(D,F){this.setMultipassParameters(D);this.config.silhouette=
!0;this.technique=this.shaderTechniqueRepository.releaseAndAcquire(h.EdgeShaderTechnique,this.config,this.technique);this.rctx.useTechnique(this.technique,D.slot);this.technique.bindPass({bindParameters:D,edgeRenderParameters:F})};C.renderRegularEdges=function(D,F,G){this._render(D,D.regular.vao,F,G)};C.renderSilhouetteEdges=function(D,F,G){this._render(D,D.silhouette.vao,F,G)};C._render=function(D,F,G,J){this._setUniforms(D,G);this.rctx.bindVAO(F);this.rctx.capabilities.instancing.drawArraysInstanced(t.PrimitiveType.TRIANGLE_FAN,
0,4,J)};C._setUniforms=function(D,F){const G=this.technique.program;D.components.buffer.textureBuffer.bind(G,"componentDataTex","componentDataTexInvDim");F.multipassTerrainEnabled&&(G.setUniform2fv("nearFar",F.camera.nearFar),G.setUniform2fv("inverseViewport",F.inverseViewport),r.bindMultipassTerrainTexture(G,F));if("origin"in D.transform)G.setUniformMatrix4fv("view",F.localViewMatrixForEdges),G.setUniformMatrix4fv("model",D.transform.modelMatrix),e.bindSliceUniforms(G,this.settings,F.slicePlane,
{origin:D.transform.origin.vec3});else{const J=new p.TwoVectorPosition(D.transform.position),I=g.transpose(B,g.invert(B,D.transform.rotationScale)),O=new f.ComponentDrawParameters;w.copy(O.transformWorldFromModelTL,J.low);w.copy(O.transformWorldFromModelTH,J.high);g.copy(O.transformWorldFromModelRS,D.transform.rotationScale);g.copy(O.transformNormalGlobalFromModel,I);k.bindModelTransform(G,O);G.setUniformMatrix3fv("transformNormalGlobalFromModel",O.transformNormalGlobalFromModel);D=F.camera.viewInverseTransposeMatrix;
D=w.set(A,D[3],D[7],D[11]);e.bindSliceUniforms(G,this.settings,F.slicePlane,{origin:D})}"uber"!==this.settings.type&&"sketch"!==this.settings.type||this._setSketchUniforms(G)};C._setSketchUniforms=function(D){const F=this.settings.strokesTexture,G=F.texture;c.isNone(G)||(D.bindTexture(G,"strokesTexture"),D.setUniform2f("strokesTextureScale",1/G.descriptor.width,1/G.descriptor.height),D.setUniform1f("strokesLog2Resolution",Math.log2(F.resolution)),D.setUniform1f("strokesNormalizationScale",F.normalizationScale),
D.setUniform1f("strokesAmplitude",F.amplitude),D.setUniform1f("strokeVariants",F.variants))};C._sortRenderables=function(){this.renderablesDirty=!1;this.sortedRenderables[m.Transparency.TRANSPARENT][m.Transparency.TRANSPARENT].clear();this.sortedRenderables[m.Transparency.TRANSPARENT][m.Transparency.OPAQUE].clear();this.sortedRenderables[m.Transparency.OPAQUE][m.Transparency.TRANSPARENT].clear();this.sortedRenderables[m.Transparency.OPAQUE][m.Transparency.OPAQUE].clear();this.renderables.forEach(F=>
{F.objectTransparency!==m.Transparency.INVISIBLE&&F.edgeTransparency!==m.Transparency.INVISIBLE&&this.sortedRenderables[F.objectTransparency][F.edgeTransparency].push(F)});const D=(F,G)=>"origin"in F.transform&&"origin"in G.transform?F.transform.origin.id<G.transform.origin.id?-1:F.transform.origin.id>G.transform.origin.id?1:0:0;this.sortedRenderables[m.Transparency.TRANSPARENT][m.Transparency.TRANSPARENT].sort(D);this.sortedRenderables[m.Transparency.TRANSPARENT][m.Transparency.OPAQUE].sort(D);this.sortedRenderables[m.Transparency.OPAQUE][m.Transparency.TRANSPARENT].sort(D);
this.sortedRenderables[m.Transparency.OPAQUE][m.Transparency.OPAQUE].sort(D)};E.getKey=function(D,F,G){return`edges-t:${D}:${F}:${G}`};return E}();const B=x.create(),A=l.create();a.EXTENSION_LENGTH_OFFSET=128;a.EdgeRenderer=u;a.LINE_WIDTH_FRACTION_FACTOR=8;a.componentDataInvDimName="componentDataTexInvDim";a.componentDataTexName="componentDataTex";Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeShaderTechnique":function(){define("require exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../core/shaderLibrary/attributes/VertexPosition.glsl ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../core/shaderTechnique/ShaderTechniqueConfiguration ../Program ./bufferLayouts ../../../../../chunks/EdgeShaderProgram.glsl ../../shaders/sources/edgeRenderer/EdgeUtil.glsl ../../../../webgl/enums ../../../../webgl/renderState".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y){w=function(p){function h(){return p.apply(this,arguments)||this}c._inheritsLoose(h,p);var m=h.prototype;m.bindPass=function(u){const t=this.program,{edgeRenderParameters:q,bindParameters:z}=u;g.bindViewProjTransform(t,q.viewProjectionTransform);t.setUniformMatrix3fv("transformNormalViewFromGlobal",q.transformNormalViewFromGlobal);t.setUniformMatrix4fv("proj",z.camera.projectionMatrix);t.setUniform2f("depthBias",.5,-4E-4);t.setUniform2f("pixelToNDC",2/z.camera.fullViewport[2],
2/z.camera.fullViewport[3]);t.setUniform2f("ndcToPixel",z.camera.fullViewport[2]/2,z.camera.fullViewport[3]/2);t.setUniform1f("distanceFalloffFactor",q.distanceFalloffFactor);t.setUniform2f("inverseViewport",1/z.camera.fullViewport[2],1/z.camera.fullViewport[3]);t.setUniform1f("pixelRatio",z.camera.pixelRatio||1)};m.initializeProgram=function(u){var t=h.shader.get();const q=this.configuration;t=t.build({slicePlaneEnabled:q.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,
silhouette:q.silhouette,legacy:q.legacy,antialiasing:q.antialiasing,mode:q.mode,doublePrecisionRequiresObfuscation:q.doublePrecisionRequiresObfuscation,multipassTerrainEnabled:q.multipassTerrainEnabled,cullAboveGround:q.cullAboveGround});return new n.Program(u.rctx,t,f.EdgeShaderAttributeLocations)};m.initializePipeline=function(u){return(u=u.rctx.capabilities.blendMinMax)?y.makePipelineState({blending:y.separateBlendingParams(r.BlendFactor.ONE,r.BlendFactor.ONE,r.BlendFactor.ZERO,r.BlendFactor.ONE,
r.BlendOperation.ADD,u.MAX),depthTest:{func:r.CompareFunction.LEQUAL},colorWrite:y.defaultColorWriteParams}):y.makePipelineState({depthTest:{func:r.CompareFunction.LEQUAL},depthWrite:y.defaultDepthWriteParams,colorWrite:y.defaultColorWriteParams})};return h}(w.ShaderTechnique);w.shader=new x.ReloadableShaderModule(e.EdgeShaderProgram,()=>new Promise((p,h)=>a(["../../shaders/sources/edgeRenderer/EdgeShaderProgram.glsl"],p,h)));x=function(p){function h(){var m=p.apply(this,arguments)||this;m.slicePlaneEnabled=
!1;m.silhouette=!1;m.legacy=!1;m.antialiasing=!1;m.mode=k.EdgeUtilMode.SOLID;m.doublePrecisionRequiresObfuscation=!1;m.multipassTerrainEnabled=!1;m.cullAboveGround=!1;return m}c._inheritsLoose(h,p);return h}(l.ShaderTechniqueConfiguration);d.__decorate([l.parameter()],x.prototype,"slicePlaneEnabled",void 0);d.__decorate([l.parameter()],x.prototype,"silhouette",void 0);d.__decorate([l.parameter()],x.prototype,"legacy",void 0);d.__decorate([l.parameter()],x.prototype,"antialiasing",void 0);d.__decorate([l.parameter({count:k.EdgeUtilMode.COUNT})],
x.prototype,"mode",void 0);d.__decorate([l.parameter()],x.prototype,"doublePrecisionRequiresObfuscation",void 0);d.__decorate([l.parameter()],x.prototype,"multipassTerrainEnabled",void 0);d.__decorate([l.parameter()],x.prototype,"cullAboveGround",void 0);b.EdgeShaderTechnique=w;b.EdgeShaderTechniqueConfiguration=x;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/EdgeShaderProgram.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/shaders/sources/edgeRenderer/AdjustProjectedPosition.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardByCoverage.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardNonSilhouetteEdges.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardShortEdges.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/EdgeUtil.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/LineAmplitude.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/LineOffset.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/UnpackAttributes.glsl".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p){function h(u){const t=new x.ShaderBuilder,q=t.vertex,z=t.fragment;u.legacy&&q.uniforms.add("model","mat4");u.antialiasing&&(q.code.add(g.glsl`#define ANTIALIASING 1`),z.code.add(g.glsl`#define ANTIALIASING 1`));t.include(l.AdjustProjectedPosition,u);t.include(r.LineAmplitude,u);t.include(k.EdgeUtil,u);t.include(p.UnpackAttributes,u);t.include(y.LineOffset,u);t.include(b.Slice,u);t.include(f.DiscardNonSilhouetteEdges,u);t.include(n.DiscardByCoverage,u);t.include(e.DiscardShortEdges,
u);t.varyings.add("vColor","vec4");t.varyings.add("vRadius","float");t.varyings.add("vPosition","vec3");t.varyings.add("vWorldPosition","vec3");t.varyings.add("vViewPos","vec3");t.varyings.add("vLineLengthPixels","float");t.varyings.add("vSizeFalloffFactor","float");q.uniforms.add("pixelToNDC","vec2");q.uniforms.add("ndcToPixel","vec2");q.uniforms.add("pixelRatio","float");t.attributes.add(w.VertexAttribute.POSITION0,"vec3");t.attributes.add(w.VertexAttribute.POSITION1,"vec3");t.attributes.add(w.VertexAttribute.VARIANTOFFSET,
"float");t.attributes.add(w.VertexAttribute.VARIANTSTROKE,"float");t.attributes.add(w.VertexAttribute.VARIANTEXTENSION,"float");q.code.add(g.glsl`const float opaqueCutoff = 1.0 / 255.0;
void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
vec2 sideness = unpackedAttributes.sideness;
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;
vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
vViewPos = viewPos;
vec4 projPosV0 = projFromViewPosition(viewPosV0);
vec4 projPosV1 = projFromViewPosition(viewPosV1);
vec4 projPos = projFromViewPosition(viewPos);
vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
float lineLengthPixels = length(screenSpaceLinePixels);
float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;
float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;
float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;
vSizeFalloffFactor = falloffFactor;
float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;
#ifdef ANTIALIASING
const float aaPaddingPixels = 1.0;
float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;
#else
float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;
#endif
vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;
vec2 ndcOffset = (
screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
+ perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
);
projPos.xy += ndcOffset * projPos.w;
projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;
projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));
float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;
float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;
vPosition = vec3(
halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
pixelPositionAlongLine,
pixelPositionAlongLine / extendedLineLengthPixels
);
vRadius = lineWidthPixels * 0.5;
vLineLengthPixels = extendedLineLengthPixels;
discardShortEdges(unpackedAttributes, lineLengthPixels);
gl_Position = projPos;
}
void main() {
ComponentData component = readComponentData();
UnpackedAttributes unpackedAttributes = unpackAttributes(component);
vec3 worldPosV0 = worldFromModelPosition(position0);
vec3 worldPosV1 = worldFromModelPosition(position1);
vec3 viewPosV0 = viewFromModelPosition(position0);
vec3 viewPosV1 = viewFromModelPosition(position1);
vColor = component.color;
if (vColor.a < opaqueCutoff) {
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return;
}
if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
return;
}
calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);
calculateStyleOutputs(unpackedAttributes);
}`);u.multipassTerrainEnabled&&(t.fragment.include(c.ReadLinearDepth),t.include(d.multipassTerrainTest,u));t.fragment.code.add(g.glsl`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float lineOffset = calculateLineOffset();
      float positionX = position.x - lineOffset;

      if (radius < 1.0) {
        // Handle this specifically for subpixel sizes:
        // 1. Compute correct coverage (note coverage is computed by
        //    0.5 - dist, so we make sure that that will lead to correct
        //    subpixel coverage
        // 2. Ignore rounded caps
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);

        float coverage = min(coverageX, coverageY);

        return vec2(0.5 - coverage, 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${u.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      float alpha = vColor.a * coverage;

      gl_FragColor = vec4(vColor.rgb, alpha);

    }
  `);return t}const m=Object.freeze({__proto__:null,build:h});a.EdgeShaderProgram=m;a.build=h})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/AdjustProjectedPosition.glsl":function(){define(["exports","../../../core/shaderLibrary/attributes/VertexPosition.glsl","../../../core/shaderLibrary/util/IsNaN.glsl","../../../core/shaderModules/interfaces"],function(a,b,c,d){a.AdjustProjectedPosition=function(g,x){g.vertex.include(c.IsNaN);g.include(b.VertexPosition,x);g=g.vertex;g.uniforms.add("depthBias",
"vec2");g.uniforms.add("inverseViewport","vec2");x.legacy?(g.uniforms.add("view","mat4"),g.uniforms.add("proj","mat4")):g.uniforms.add("transformNormalViewFromGlobal","mat3");x.legacy?g.code.add(d.glsl`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
float offsetZ  = depthBias.y;
vec4 projNormal = proj * view * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`):g.code.add(d.glsl`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
float offsetZ  = depthBias.y;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`);g.code.add(d.glsl`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/IsNaN.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.IsNaN=function(c){const d=b.glsl`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;c.code.add(d)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardByCoverage.glsl":function(){define(["exports","../../../core/shaderModules/interfaces"],function(a,b){a.DiscardByCoverage=function(c,d){c=c.fragment;c.constants.add("coverageTestThreshold","float",.01);d.antialiasing?c.code.add(b.glsl`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):c.code.add(b.glsl`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)};
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardNonSilhouetteEdges.glsl":function(){define(["exports","../../../core/shaderModules/interfaces"],function(a,b){a.DiscardNonSilhouetteEdges=function(c,d){c=c.vertex;d.silhouette?(c.code.add(b.glsl`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),d.legacy?c.code.add(b.glsl`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):c.code.add(b.glsl`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):c.code.add(b.glsl`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardShortEdges.glsl":function(){define(["exports","../../../core/shaderModules/interfaces","./EdgeUtil.glsl"],function(a,b,c){a.DiscardShortEdges=function(d,g){d=d.vertex;switch(g.mode){case c.EdgeUtilMode.SKETCH:d.code.add(b.glsl`#define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}`);
break;case c.EdgeUtilMode.MIXED:d.code.add(b.glsl`#define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (unpackedAttributes.type <= 0.0 && lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}`);break;case c.EdgeUtilMode.SOLID:d.code.add(b.glsl`#define discardShortEdges(unpackedAttributes, lineLengthPixels) {}`)}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/EdgeUtil.glsl":function(){define(["exports",
"../../../core/shaderLibrary/util/DoublePrecision.glsl","../../../core/shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,c,d){a.EdgeUtilMode=void 0;(function(g){g[g.SOLID=0]="SOLID";g[g.SKETCH=1]="SKETCH";g[g.MIXED=2]="MIXED";g[g.COUNT=3]="COUNT"})(a.EdgeUtilMode||(a.EdgeUtilMode={}));a.EdgeUtil=function(g,x){const w=g.vertex;w.uniforms.add("distanceFalloffFactor","float");w.code.add(c.glsl`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`);w.uniforms.add("componentDataTex","sampler2D");w.uniforms.add("componentDataTexInvDim","vec2");g.attributes.add(d.VertexAttribute.COMPONENTINDEX,"float");w.constants.add("componentColorFieldOffset","float",0);w.constants.add("componentOtherFieldOffset","float",1);w.constants.add("componentFieldCount","float",2);w.constants.add("lineWidthFractionFactor","float",8);w.constants.add("extensionLengthOffset","float",128);w.constants.add("componentTexWidth","float",4096);w.code.add(c.glsl`vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
float rowIndex = floor(fieldIndex / componentTexWidth);
float colIndex = mod(fieldIndex, componentTexWidth);
vec2 linearIndex = vec2(
(colIndex + 0.5) / componentTexWidth,
(rowIndex + 0.5) * componentDataTexInvDim.y
);
return linearIndex;
}
struct ComponentData {
vec4 color;
float lineWidth;
float extensionLength;
float type;
};
ComponentData readComponentData() {
vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
vec4 colorValue = texture2D(componentDataTex, colorIndex);
vec4 otherValue = texture2D(componentDataTex, otherIndex);
return ComponentData(
vec4(colorValue.rgb, colorValue.a * otherValue.w),
otherValue.x * (255.0 / lineWidthFractionFactor),
otherValue.y * 255.0 - extensionLengthOffset,
-(otherValue.z * 255.0) + 0.5
);
}`);x.legacy?w.code.add(c.glsl`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (view * model * vec4(normal, 0.0)).xyz;
}`):(w.uniforms.add("transformNormalGlobalFromModel","mat3"),w.code.add(c.glsl`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`));x.silhouette?(g.attributes.add(d.VertexAttribute.NORMALA,"vec3"),g.attributes.add(d.VertexAttribute.NORMALB,"vec3"),w.code.add(c.glsl`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(g.attributes.add(d.VertexAttribute.NORMAL,"vec3"),w.code.add(c.glsl`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`));x.legacy?w.code.add(c.glsl`vec3 worldFromModelPosition(vec3 position) {
return (model * vec4(position, 1.0)).xyz;
}
vec3 viewFromModelPosition(vec3 position) {
return (view * vec4(worldFromModelPosition(position), 1.0)).xyz;
}
vec4 projFromViewPosition(vec3 position) {
return proj * vec4(position, 1.0);
}`):(g.vertex.include(b.DoublePrecision,x),w.code.add(c.glsl`vec3 worldFromModelPosition(vec3 position) {
vec3 rotatedModelPosition = transformWorldFromModelRS * position;
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}
vec3 viewFromModelPosition(vec3 position) {
return transformViewFromCameraRelativeRS * worldFromModelPosition(position);
}
vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`));w.code.add(c.glsl`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)};a.usesSketchLogic=function(g){return g.mode===a.EdgeUtilMode.SKETCH||g.mode===a.EdgeUtilMode.MIXED};a.usesSolidLogic=function(g){return g.mode===a.EdgeUtilMode.SOLID||g.mode===a.EdgeUtilMode.MIXED};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/LineAmplitude.glsl":function(){define(["exports","../../../core/shaderModules/interfaces","./EdgeUtil.glsl","./UnpackAttributes.glsl"],function(a,b,c,d){a.LineAmplitude=function(g,x){const w=
g.vertex;g.include(d.UnpackAttributes,x);c.usesSketchLogic(x)&&w.uniforms.add("strokesAmplitude","float");switch(x.mode){case c.EdgeUtilMode.SOLID:w.code.add(b.glsl`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case c.EdgeUtilMode.SKETCH:w.code.add(b.glsl`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case c.EdgeUtilMode.MIXED:w.code.add(b.glsl`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/UnpackAttributes.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../../../core/shaderModules/interfaces","../../../lib/VertexAttribute","./EdgeUtil.glsl"],function(a,b,c,d,g){a.UnpackAttributes=function(x,w){const l=x.vertex;x.include(g.EdgeUtil,w);x.attributes.add(d.VertexAttribute.SIDENESS,"vec2");w.mode===g.EdgeUtilMode.MIXED?l.code.add(c.glsl`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):l.code.add(c.glsl`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`);switch(w.mode){case g.EdgeUtilMode.MIXED:l.code.add(c.glsl`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case g.EdgeUtilMode.SKETCH:l.code.add(c.glsl`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case g.EdgeUtilMode.SOLID:l.code.add(c.glsl`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case g.EdgeUtilMode.COUNT:break;default:b.neverReached(w.mode)}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/LineOffset.glsl":function(){define(["exports","../../../core/shaderLibrary/util/RgbaFloatEncoding.glsl","../../../core/shaderModules/interfaces","./EdgeUtil.glsl","./UnpackAttributes.glsl"],function(a,b,c,d,g){a.LineOffset=function(x,w){const l=x.vertex;x.include(g.UnpackAttributes,w);const n=x.fragment;d.usesSketchLogic(w)&&
(l.uniforms.add("strokesTextureScale","vec2"),l.uniforms.add("strokesLog2Resolution","float"),l.uniforms.add("strokeVariants","float"),x.varyings.add("vStrokeUV","vec2"),n.uniforms.add("strokesTexture","sampler2D"),n.uniforms.add("strokesNormalizationScale","float"),l.code.add(c.glsl`void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);
vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) * strokesTextureScale;
vStrokeUV.x += variantOffset;
}`),x.fragment.include(b.RgbaFloatEncoding),n.code.add(c.glsl`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture2D(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture2D(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`));switch(w.mode){case d.EdgeUtilMode.SOLID:l.code.add(c.glsl`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`);n.code.add(c.glsl`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case d.EdgeUtilMode.SKETCH:l.code.add(c.glsl`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`);n.code.add(c.glsl`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case d.EdgeUtilMode.MIXED:x.varyings.add("vType","float"),l.code.add(c.glsl`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),n.code.add(c.glsl`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeWorkerHandle":function(){define(["../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/typedArrayUtil","../../../../../core/workers/WorkerHandle","../../../support/buffer/workerHelper","./EdgeProcessingWorker"],function(a,b,c,d,g){return function(x){function w(n){return x.call(this,"EdgeProcessingWorker","wrappedWork",n)||this}a._inheritsLoose(w,x);var l=w.prototype;l.process=
function(){var n=a._asyncToGenerator(function*(f,e,k){if(k)return g.work(f);f=this._packInput(f);e=yield this.invoke(f,e);return this._unpackOutput(e)});return function(f,e,k){return n.apply(this,arguments)}}();l.getTransferList=function(n){return[n.dataBuffer]};l._packInput=function(n){return{dataBuffer:n.data.buffer,writerSettings:n.writerSettings,skipDeduplicate:n.skipDeduplicate,indicesBuffer:n.indices.buffer,indicesType:b.isUint32Array(n.indices)?"Uint32Array":"Uint16Array",indicesLength:n.indicesLength}};
l._unpackOutput=function(n){return{regular:{instancesData:d.unpackInterleavedBuffer(n.regular.instancesData),lodInfo:{lengths:new Float32Array(n.regular.lodInfo.lengths)}},silhouette:{instancesData:d.unpackInterleavedBuffer(n.silhouette.instancesData),lodInfo:{lengths:new Float32Array(n.silhouette.lodInfo.lengths)}},averageEdgeLength:n.averageEdgeLength}};return w}(c.WorkerHandle)})},"esri/views/3d/support/buffer/workerHelper":function(){define(["exports","../../../../geometry/support/buffer/BufferView",
"./InterleavedLayout"],function(a,b,c){function d(w){const l=[];w.fields.forEach((n,f)=>{var e=n.constructor;l.push([f,{...n,constructor:`${e.ElementType}_${e.ElementCount}`}])});return{stride:w.stride,fields:l,fieldNames:w.fieldNames}}function g(w){const l=c.newLayout();l.stride=w.stride;l.fieldNames=w.fieldNames;w.fields.forEach(n=>l.fields.set(n[0],{...n[1],constructor:x.get(n[1].constructor)}));return l}b=[b.BufferViewFloat,b.BufferViewVec2f,b.BufferViewVec3f,b.BufferViewVec4f,b.BufferViewMat3f,
b.BufferViewMat4f,b.BufferViewFloat64,b.BufferViewVec2f64,b.BufferViewVec3f64,b.BufferViewVec4f64,b.BufferViewMat3f64,b.BufferViewMat4f64,b.BufferViewUint8,b.BufferViewVec2u8,b.BufferViewVec3u8,b.BufferViewVec4u8,b.BufferViewUint16,b.BufferViewVec2u16,b.BufferViewVec3u16,b.BufferViewVec4u16,b.BufferViewUint32,b.BufferViewVec2u32,b.BufferViewVec3u32,b.BufferViewVec4u32,b.BufferViewInt8,b.BufferViewVec2i8,b.BufferViewVec3i8,b.BufferViewVec4i8,b.BufferViewInt16,b.BufferViewVec2i16,b.BufferViewVec3i16,
b.BufferViewVec4i16,b.BufferViewInt32,b.BufferViewVec2i32,b.BufferViewVec3i32,b.BufferViewVec4i32];const x=new Map;b.forEach(w=>x.set(`${w.ElementType}_${w.ElementCount}`,w));a.packInterleavedBuffer=function(w,l){l.push(w.buffer);return{buffer:w.buffer,layout:d(w.layout)}};a.packLayout=d;a.unpackInterleavedBuffer=function(w){return g(w.layout).createView(w.buffer)};a.unpackLayout=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../geometry/support/meshUtils/deduplicate ../../../support/meshProcessing ../../../support/buffer/workerHelper ./bufferLayouts ./edgeBufferWriters ./edgePreprocessing".split(" "),
function(a,b,c,d,g,x,w,l){function n(){n=b._asyncToGenerator(function*(r){var y={data:x.EdgeInputBufferLayout.createView(r.dataBuffer),indices:"Uint32Array"===r.indicesType?new Uint32Array(r.indicesBuffer):"Uint16Array"===r.indicesType?new Uint16Array(r.indicesBuffer):void 0,indicesLength:r.indicesLength,writerSettings:r.writerSettings,skipDeduplicate:r.skipDeduplicate};r=f(y);y=[y.data.buffer];y.push(r.regular.lodInfo.lengths.buffer);y.push(r.silhouette.lodInfo.lengths.buffer);return{result:{regular:{instancesData:g.packInterleavedBuffer(r.regular.instancesData,
y),lodInfo:{lengths:r.regular.lodInfo.lengths.buffer}},silhouette:{instancesData:g.packInterleavedBuffer(r.silhouette.instancesData,y),lodInfo:{lengths:r.silhouette.lodInfo.lengths.buffer}},averageEdgeLength:r.averageEdgeLength},transferList:y}});return n.apply(this,arguments)}function f(r){var y=r.data,p=r.indices;var h=r.indicesLength;if(r.skipDeduplicate){const m=d.computeNeighbors(p,h,y.count);h={faces:p,facesLength:h,neighbors:m,vertices:y}}else y=c.deduplicate(y.buffer,y.stride/4,{originalIndices:p,
originalIndicesLength:h}),h=d.computeNeighbors(y.indices,h,y.uniqueCount),h={faces:y.indices,facesLength:y.indices.length,neighbors:h,vertices:x.EdgeInputBufferLayout.createView(y.buffer)};e.updateSettings(r.writerSettings);k.updateSettings(r.writerSettings);return l.extractEdges(h,e,k)}const e=new w.RegularEdgeBufferWriter,k=new w.SilhouetteEdgeBufferWriter;a.work=f;a.wrappedWork=function(r){return n.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/meshProcessing":function(){define(["exports"],
function(a){a.computeNeighbors=function(b,c,d){c/=3;const g=new Uint32Array(d+1),x=new Uint32Array(d+1);var w=(h,m)=>{h<m?g[h+1]++:x[m+1]++};for(var l=0;l<c;l++){var n=b[3*l],f=b[3*l+1],e=b[3*l+2];w(n,f);w(f,e);w(e,n)}l=w=0;for(n=0;n<d;n++)f=g[n+1],e=x[n+1],g[n+1]=w,x[n+1]=l,w+=f,l+=e;const k=new Uint32Array(6*c),r=g[d];w=(h,m,u)=>{h<m?(h=g[h+1]++,k[2*h]=m,k[2*h+1]=u):(m=x[m+1]++,k[2*r+2*m]=h,k[2*r+2*m+1]=u)};for(l=0;l<c;l++)n=b[3*l],f=b[3*l+1],e=b[3*l+2],w(n,f,l),w(f,e,l),w(e,n,l);w=(h,m)=>{const u=
2*h;h=m-h;for(m=1;m<h;m++){const t=k[u+2*m],q=k[u+2*m+1];let z=m-1;for(z;0<=z&&k[u+2*z]>t;z--)k[u+2*z+2]=k[u+2*z],k[u+2*z+3]=k[u+2*z+1];k[u+2*z+2]=t;k[u+2*z+3]=q}};for(l=0;l<d;l++)w(g[l],g[l+1]),w(r+x[l],r+x[l+1]);const y=new Int32Array(3*c),p=(h,m)=>h===b[3*m]?0:h===b[3*m+1]?1:h===b[3*m+2]?2:-1;c=(h,m)=>{h=p(h,m);y[3*m+h]=-1};w=(h,m,u,t)=>{h=p(h,m);y[3*m+h]=t;u=p(u,t);y[3*t+u]=m};for(l=0;l<d;l++){n=g[l];f=g[l+1];e=x[l];const h=x[l+1];for(;n<f&&e<h;){const m=k[2*n],u=k[2*r+2*e];m===u?(w(l,k[2*n+1],
u,k[2*r+2*e+1]),n++,e++):m<u?(c(l,k[2*n+1]),n++):(c(u,k[2*r+2*e+1]),e++)}for(;n<f;)c(l,k[2*n+1]),n++;for(;e<h;)c(k[2*r+2*e],k[2*r+2*e+1]),e++}return y};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/strokes":function(){define("exports ../../../../../core/floatRGBA ../../../../../core/mathUtils ../../../../../core/maybe ../../../../webgl/enums ../../../../webgl/Texture".split(" "),function(a,b,c,d,g,x){function w(e,k){if(!e)return null;var r=e.length/
2;const y=.1*r;r=Array(r);let p=0;k=k===l.PRESSURE;for(let h=0;h<e.length;h+=2){const m=(e[h]+e[h+1])/2;k?r[p++]=Math.min(y,1-.5*(1-m)):r[p++]=Math.min(y,.5*m)}return r}var l;(function(e){e[e.DISTANCE=0]="DISTANCE";e[e.PRESSURE=1]="PRESSURE"})(l||(l={}));let n=function(){function e(k,r,y,p,h){this.resolution=k;this.normalizationScale=r;this.amplitude=y;this.variants=p;this.texture=h}e.prototype.dispose=function(){this.texture=d.disposeMaybe(this.texture)};return e}();const f={amplitude:8,resolution:256,
strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,
-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,
.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,
-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,
.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,
.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,
.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,
-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,
-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,
1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,
.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,
-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,
.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,
.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,
.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,
.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,
4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,
3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,
1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-7.6E-4,2.7E-4,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,
.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,
.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,
.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,
.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,
1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,
-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,
.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,
2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,
.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,
.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,
.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,
-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,
.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,
.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,
-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,
.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,
.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,
.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,
.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,
5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,
.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,
-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,
3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,
.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,
.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,
.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};a.StrokesTexture=n;a.generateStrokesTexture=function(e){const k=f.resolution;var r=k/2;const y=new Uint8Array(4*k*k),p=4*k*r;r=
f.amplitude;const h=2*r,m=4*k,u=Math.log2(k)+1,t=f.strokes.length;let q=(u-1)*t*m;for(const {distance:z,pressure:v}of f.strokes){let B=z,A=v,E=q;for(let C=0;C<u;C++){0!==C&&(B=w(B,l.DISTANCE),A=w(A,l.PRESSURE));for(let D=0;D<f.resolution;D++){const F=A?A[D%A.length]:1;b.packFloatRGBA((B?B[D%B.length]/h:0)+.5,y,E);b.packFloatRGBA(F,y,E+p);E+=4}E-=m*(t+1)}q+=m}e=new x.Texture(e,{pixelFormat:g.PixelFormat.RGBA,dataType:g.PixelType.UNSIGNED_BYTE,hasMipmap:!1,samplingMode:g.TextureSamplingMode.LINEAR,
width:k,height:k,wrapMode:g.TextureWrapMode.REPEAT},y);return new n(k,h,r,t,e)};a.rasterizeStrokes=function(){var e=f.resolution;const k=Math.log2(e)+1;var r=f.strokes.length;const y=f.amplitude,p=Math.ceil(2*y+.5);var h;for(h=0;1<=e;)h+=e,e/=2;h+=6*(k+1);r*=p;e=new Uint8ClampedArray(4*h*r);const m=4*h;e.fill(255);let u=24;for(const {distance:t,pressure:q}of f.strokes){let z=t,v=q,B=u;for(let A=0;A<k;A++){0!==A&&(z=w(z,l.DISTANCE),v=w(v,l.PRESSURE));for(let E=0;E<z.length;E++){const C=z?z[E]:0,D=
v?c.clamp(v[E],0,1):1;let F=B;for(let G=-y;G<p-y;G++){const J=255-255*c.clamp(1-(Math.abs(G-C+.5)-.5*D),0,1);e[F+0]=J;e[F+1]=J;e[F+2]=J;e[F+3]=255;F+=m}B+=4}B+=24}u+=p*m}return new ImageData(e,h,r)};a.strokesDefinition=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/util":function(){define(["exports","../../../../../core/arrayUtils","../../../../../core/maybe","./interfaces"],function(a,b,c,d){a.computeEdgeCount=function(g,x,w){const l=g.length;
x*=w.minimumEdgeLength;w=b.binaryIndexOf(g,x,!0);g=-1===w?x<g[0]?0:g.length:w;return l-g};a.determineEdgeTransparency=function(g){let x=d.Transparency.INVISIBLE;for(const {material:w}of g)if(0<w.size*w.color[3]*w.opacity){if(1>w.color[3]*w.opacity)return d.Transparency.TRANSPARENT;x=d.Transparency.OPAQUE}return x};a.determineObjectTransparency=function(g){let x=d.Transparency.INVISIBLE;for(const {material:w}of g)if(0<w.size*w.color[3]*w.opacity){switch(w.objectTransparency){case d.Transparency.TRANSPARENT:case d.Transparency.INVISIBLE:return d.Transparency.TRANSPARENT;
case d.Transparency.OPAQUE:if(1>w.opacity)return d.Transparency.TRANSPARENT}x=d.Transparency.OPAQUE}return x};a.determineRendererType=function(g){let x=null;for(const w of g)if(g=w.type,0<w.size*w.color[3])if(c.isNone(x))x=g;else if(x!==g)return"uber";return c.isSome(x)?x:"uber"};a.estimateLengthAtDistance=function(g,x,w,l){return l/g*w*2*Math.tan(.5*x)};a.fillComponenBufferIndices=function(g,x,w,l){for(let f=0;f<g.length;f++){const e=g[f].index;var n=x[f];const k=x[f+1];if(l)for(;n<k;n++)w.set(l[n],
e);else for(;n<k;n++)w.set(n,e)}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/statistics/RendererPerformanceInfo":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/PerformanceSampler ../../../../core/time ../../../../core/accessorSupport/utils ../../../webgl/Measurement".split(" "),function(a,b,c,d,g,x,w){a.Statistics=void 0;(function(e){e[e.Prepare=0]="Prepare";e[e.Shadowmap=1]="Shadowmap";e[e.Lineardepth=
2]="Lineardepth";e[e.Normals=3]="Normals";e[e.SSAO=4]="SSAO";e[e.Opaque=5]="Opaque";e[e.OpaqueEdges=6]="OpaqueEdges";e[e.Transparent=7]="Transparent";e[e.TransparentEdges=8]="TransparentEdges";e[e.Hudvisibility=9]="Hudvisibility";e[e.TransparentTerrain=10]="TransparentTerrain";e[e.Atmosphere=11]="Atmosphere";e[e.Laserline=12]="Laserline";e[e.Occluded=13]="Occluded";e[e.Antialiasing=14]="Antialiasing";e[e.Highlights=15]="Highlights";e[e.HudOccluded=16]="HudOccluded";e[e.HudNotoccluded=17]="HudNotoccluded"})(a.Statistics||
(a.Statistics={}));const l="prepare;shadowmap;lineardepth;normals;ssao;opaque;opaque edges;transparent;transparent edges;hudvisibility;transparent terrain;atmosphere;laserline;occluded;antialiasing;highlights;hudOccluded;hudNotoccluded".split(";");let n=function(e){function k(){var r=e.call(this,"total")||this;r.total=0;r.frameCount=0;return r}b._inheritsLoose(k,e);return k}(d),f=function(){function e(){this._startTime=g.Milliseconds(0);this._lastSample=g.Milliseconds(0);this._enableGPUTimer=0;this.totalTime=
new n;this.gpuTime=new d("gpu",9);this.renderPassTimings=l.map(r=>new d(r))}var k=e.prototype;k.enableGPUTimer=function(){++this._enableGPUTimer;return{remove:x.once(()=>--this._enableGPUTimer)}};k.prerender=function(r){this._startTime=this._lastSample=g.Milliseconds(performance.now());this._enableGPUTimer&&(this._gpuTimer=w.startMeasurement(r))};k.advance=function(r){const y=g.Milliseconds(performance.now());this.renderPassTimings[r].record(y-this._lastSample);this._lastSample=y};k.postrender=function(){c.isSome(this._gpuTimer)&&
(this._gpuTimer.stop(y=>c.isSome(y)&&this.gpuTime.record(y),16),this._gpuTimer=null);const r=performance.now()-this._startTime;this.totalTime.record(r);this.totalTime.total+=r;this.totalTime.frameCount++};b._createClass(e,[{key:"elapsedTime",get:function(){return g.Milliseconds(performance.now()-this._startTime)}}]);return e}();a.RenderTime=n;a.RendererPerformanceInfo=f;a.performanceStatsCategories=l;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/Measurement":function(){define(["exports",
"../../core/maybe"],function(a,b){let c=function(){function x(l){this.timer=l;this.start=l.createQuery();l.createTimestamp(this.start)}var w=x.prototype;w.stop=function(l,n=50){this.end=this.timer.createQuery();this.timer.createTimestamp(this.end);this._checkQueryResult(l,n)};w._checkQueryResult=function(l,n){if(this.timer.resultAvailable(this.end))if(this.timer.disjoint())l(null);else{var f=this.timer.getResult(this.start),e=this.timer.getResult(this.end);l((e-f)/1E6)}else setTimeout(()=>this._checkQueryResult(l,
n),n)};return x}(),d=function(){function x(l){this.timer=l;this.query=l.createQuery();g=!0;this.timer.beginTimeElapsed(this.query)}var w=x.prototype;w.stop=function(l,n=50){this.timer.endTimeElapsed();g=!1;this._checkQueryResult(l,n)};w._checkQueryResult=function(l,n){var f=this.timer.resultAvailable(this.query);const e=this.timer.disjoint();f&&!e?(f=this.timer.getResult(this.query),l(f/1E6)):e?l(null):setTimeout(()=>this._checkQueryResult(l,n),n)};return x}(),g=!1;a.startMeasurement=function(x){x=
x.capabilities.disjointTimerQuery;return b.isNone(x)?null:0<x.timestampBits()?new c(x):g?null:new d(x)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/RenderingContext":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../webgl/RenderingContext"],function(a,b,c){c=function(d){function g(w,l,n){w=d.call(this,w,l)||this;w.newCache=n;w._refCount=1;return w}b._inheritsLoose(g,d);var x=g.prototype;x.dispose=function(){0<--this._refCount||
d.prototype.dispose.call(this)};x.ref=function(){++this._refCount};x.useTechnique=function(w,l=null,n){this.useProgram(w.program);w.bindPipelineState(this,l,n);return w.program};x.isTechniqueCompiled=function(w){return w.program.isCompiled};b._createClass(g,[{key:"test",get:function(){return this.programCache.test}}]);return g}(c.RenderingContext);a.RenderingContext=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/RenderingContext":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/maybe ../../core/promiseUtils ../../core/time ./BufferObject ./FramebufferObject ../../core/has ./checkWebGLError ./context-util ./enums ./ShaderTranspiler ./ProgramCache ./Texture ./VertexArrayObject ./ContextState ./InstanceCounter ./renderState ./Util ./WebGLDriverTest ./capabilities/Capabilities ./capabilities/isWebGL2Context".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v){function B(E,C,D,F){C?F!==C&&E.bindBuffer(D,C.glName):E.bindBuffer(D,null);return C}function A(E,C){switch(E){case e.PrimitiveType.POINTS:return 2*C;case e.PrimitiveType.TRIANGLES:return C/3;case e.PrimitiveType.TRIANGLE_STRIP:return C-2;case e.PrimitiveType.TRIANGLE_FAN:return C-2;default:return 0}}x=function(){function E(D,F){this.gl=D;this.instanceCounter=new m.InstanceCounter;this.programCache=new r.ProgramCache(this);this._state=new h.ContextState;
this._numOfTriangles=this._numOfDrawCalls=0;this.type=v(D)?f.ContextType.WEBGL2:f.ContextType.WEBGL1;this._loadExtensions();this.configure(F)}var C=E.prototype;C.configure=function(D){this._capabilities=new z.Capabilities(this.gl,D);this._parameters=this._loadParameters(D);D=this.gl.getParameter(this.gl.VIEWPORT);this._state=new h.ContextState;this._state.viewport={x:D[0],y:D[1],width:D[2],height:D[3]};this._stateTracker=new u.StateTracker({setBlending:F=>{F?(this.setBlendingEnabled(!0),this.setBlendEquationSeparate(F.opRgb,
F.opAlpha),this.setBlendFunctionSeparate(F.srcRgb,F.dstRgb,F.srcAlpha,F.dstAlpha),F=F.color,this.setBlendColor(F.r,F.g,F.b,F.a)):this.setBlendingEnabled(!1)},setCulling:F=>{F?(this.setFaceCullingEnabled(!0),this.setCullFace(F.face),this.setFrontFace(F.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:F=>{F?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(F.factor,F.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:F=>{F?(this.setDepthTestEnabled(!0),this.setDepthFunction(F.func)):
this.setDepthTestEnabled(!1)},setStencilTest:F=>{if(F){this.setStencilTestEnabled(!0);const G=F.function;this.setStencilFunction(G.func,G.ref,G.mask);F=F.operation;this.setStencilOp(F.fail,F.zFail,F.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:F=>{F?(this.setDepthWriteEnabled(!0),this.setDepthRange(F.zNear,F.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:F=>{F?this.setColorMask(F.r,F.g,F.b,F.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:F=>{F?this.setStencilWriteMask(F.mask):
this.setStencilWriteMask(0)}});this.enforceState();this._driverTest=new q.WebGLDriverTest(this)};C.dispose=function(){this.programCache.dispose();this.bindVAO(null);this.unbindBuffer(e.BufferType.ARRAY_BUFFER);this.unbindBuffer(e.BufferType.ELEMENT_ARRAY_BUFFER);v(this.gl)&&(this.unbindBuffer(e.BufferType.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(e.BufferType.PIXEL_PACK_BUFFER),this.unbindBuffer(e.BufferType.PIXEL_UNPACK_BUFFER),this.unbindBuffer(e.BufferType.COPY_READ_BUFFER),
this.unbindBuffer(e.BufferType.COPY_WRITE_BUFFER));this._state.textureUnitMap.length=0;n.webglDebugEnabled()&&this.instanceCounter.printResourceCount()};C.setPipelineState=function(D){this._stateTracker.setPipeline(D)};C.setBlendingEnabled=function(D){this._state.blend!==D&&(!0===D?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=D,this._stateTracker.invalidateBlending())};C.externalProgramUpdate=function(){var D;null==(D=this._state.program)?void 0:D.stop();this._state.program=
null};C.externalTextureUnitUpdate=function(D,F){for(let G=0;G<D.length;++G)this._state.textureUnitMap[D[G]]=null;0<=F&&(this._state.activeTexture=F)};C.externalVertexArrayObjectUpdate=function(){const D=this.capabilities.vao;D&&(D.bindVertexArray(null),this._state.vertexArrayObject=null);this._state.vertexBuffer=null;this._state.indexBuffer=null};C.externalVertexBufferUpdate=function(){this._state.vertexBuffer=null};C.externalIndexBufferUpdate=function(){this._state.indexBuffer=null};C.setBlendColor=
function(D,F,G,J){if(D!==this._state.blendColor.r||F!==this._state.blendColor.g||G!==this._state.blendColor.b||J!==this._state.blendColor.a)this.gl.blendColor(D,F,G,J),this._state.blendColor.r=D,this._state.blendColor.g=F,this._state.blendColor.b=G,this._state.blendColor.a=J,this._stateTracker.invalidateBlending()};C.setBlendFunction=function(D,F){if(D!==this._state.blendFunction.srcRGB||F!==this._state.blendFunction.dstRGB)this.gl.blendFunc(D,F),this._state.blendFunction.srcRGB=D,this._state.blendFunction.srcAlpha=
D,this._state.blendFunction.dstRGB=F,this._state.blendFunction.dstAlpha=F,this._stateTracker.invalidateBlending()};C.setBlendFunctionSeparate=function(D,F,G,J){if(this._state.blendFunction.srcRGB!==D||this._state.blendFunction.srcAlpha!==G||this._state.blendFunction.dstRGB!==F||this._state.blendFunction.dstAlpha!==J)this.gl.blendFuncSeparate(D,F,G,J),this._state.blendFunction.srcRGB=D,this._state.blendFunction.srcAlpha=G,this._state.blendFunction.dstRGB=F,this._state.blendFunction.dstAlpha=J,this._stateTracker.invalidateBlending()};
C.setBlendEquation=function(D){this._state.blendEquation.mode!==D&&(this.gl.blendEquation(D),this._state.blendEquation.mode=D,this._state.blendEquation.modeAlpha=D,this._stateTracker.invalidateBlending())};C.setBlendEquationSeparate=function(D,F){if(this._state.blendEquation.mode!==D||this._state.blendEquation.modeAlpha!==F)this.gl.blendEquationSeparate(D,F),this._state.blendEquation.mode=D,this._state.blendEquation.modeAlpha=F,this._stateTracker.invalidateBlending()};C.setColorMask=function(D,F,
G,J){if(this._state.colorMask.r!==D||this._state.colorMask.g!==F||this._state.colorMask.b!==G||this._state.colorMask.a!==J)this.gl.colorMask(D,F,G,J),this._state.colorMask.r=D,this._state.colorMask.g=F,this._state.colorMask.b=G,this._state.colorMask.a=J,this._stateTracker.invalidateColorWrite()};C.setClearColor=function(D,F,G,J){if(this._state.clearColor.r!==D||this._state.clearColor.g!==F||this._state.clearColor.b!==G||this._state.clearColor.a!==J)this.gl.clearColor(D,F,G,J),this._state.clearColor.r=
D,this._state.clearColor.g=F,this._state.clearColor.b=G,this._state.clearColor.a=J};C.setFaceCullingEnabled=function(D){this._state.faceCulling!==D&&(!0===D?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=D,this._stateTracker.invalidateCulling())};C.setPolygonOffsetFillEnabled=function(D){this._state.polygonOffsetFill!==D&&(!0===D?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=D,this._stateTracker.invalidatePolygonOffset())};
C.setPolygonOffset=function(D,F){if(this._state.polygonOffset[0]!==D||this._state.polygonOffset[1]!==F)this._state.polygonOffset[0]=D,this._state.polygonOffset[1]=F,this.gl.polygonOffset(D,F),this._stateTracker.invalidatePolygonOffset()};C.setCullFace=function(D){this._state.cullFace!==D&&(this.gl.cullFace(D),this._state.cullFace=D,this._stateTracker.invalidateCulling())};C.setFrontFace=function(D){this._state.frontFace!==D&&(this.gl.frontFace(D),this._state.frontFace=D,this._stateTracker.invalidateCulling())};
C.setScissorTestEnabled=function(D){this._state.scissorTest!==D&&(!0===D?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=D)};C.setScissorRect=function(D,F,G,J){if(this._state.scissorRect.x!==D||this._state.scissorRect.y!==F||this._state.scissorRect.width!==G||this._state.scissorRect.height!==J)this.gl.scissor(D,F,G,J),this._state.scissorRect.x=D,this._state.scissorRect.y=F,this._state.scissorRect.width=G,this._state.scissorRect.height=J};C.setDepthTestEnabled=
function(D){this._state.depthTest!==D&&(!0===D?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=D,this._stateTracker.invalidateDepthTest())};C.setClearDepth=function(D){this._state.clearDepth!==D&&(this.gl.clearDepth(D),this._state.clearDepth=D)};C.setDepthFunction=function(D){this._state.depthFunction!==D&&(this.gl.depthFunc(D),this._state.depthFunction=D,this._stateTracker.invalidateDepthTest())};C.setDepthWriteEnabled=function(D){this._state.depthWrite!==
D&&(this.gl.depthMask(D),this._state.depthWrite=D,this._stateTracker.invalidateDepthWrite())};C.setDepthRange=function(D,F){if(this._state.depthRange.zNear!==D||this._state.depthRange.zFar!==F)this.gl.depthRange(D,F),this._state.depthRange.zNear=D,this._state.depthRange.zFar=F,this._stateTracker.invalidateDepthWrite()};C.setStencilTestEnabled=function(D){this._state.stencilTest!==D&&(!0===D?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=D,this._stateTracker.invalidateStencilTest())};
C.setClearStencil=function(D){D!==this._state.clearStencil&&(this.gl.clearStencil(D),this._state.clearStencil=D)};C.setStencilFunction=function(D,F,G){if(this._state.stencilFunction.func!==D||this._state.stencilFunction.ref!==F||this._state.stencilFunction.mask!==G)this.gl.stencilFunc(D,F,G),this._state.stencilFunction.face=e.Face.FRONT_AND_BACK,this._state.stencilFunction.func=D,this._state.stencilFunction.ref=F,this._state.stencilFunction.mask=G,this._stateTracker.invalidateStencilTest()};C.setStencilFunctionSeparate=
function(D,F,G,J){if(this._state.stencilFunction.face!==D||this._state.stencilFunction.func!==F||this._state.stencilFunction.ref!==G||this._state.stencilFunction.mask!==J)this.gl.stencilFuncSeparate(D,F,G,J),this._state.stencilFunction.face=D,this._state.stencilFunction.func=F,this._state.stencilFunction.ref=G,this._state.stencilFunction.mask=J,this._stateTracker.invalidateStencilTest()};C.setStencilWriteMask=function(D){this._state.stencilWriteMask!==D&&(this.gl.stencilMask(D),this._state.stencilWriteMask=
D,this._stateTracker.invalidateStencilWrite())};C.setStencilOp=function(D,F,G){if(this._state.stencilOperation.face!==e.Face.FRONT_AND_BACK||this._state.stencilOperation.fail!==D||this._state.stencilOperation.zFail!==F||this._state.stencilOperation.zPass!==G)this.gl.stencilOp(D,F,G),this._state.stencilOperation.face=e.Face.FRONT_AND_BACK,this._state.stencilOperation.fail=D,this._state.stencilOperation.zFail=F,this._state.stencilOperation.zPass=G,this._stateTracker.invalidateStencilTest()};C.setStencilOpSeparate=
function(D,F,G,J){if(this._state.stencilOperation.face!==D||this._state.stencilOperation.fail!==F||this._state.stencilOperation.zFail!==G||this._state.stencilOperation.zPass!==J)this.gl.stencilOpSeparate(D,F,G,J),this._state.stencilOperation.face=D,this._state.stencilOperation.fail=F,this._state.stencilOperation.zFail=G,this._state.stencilOperation.zPass=J,this._stateTracker.invalidateStencilTest()};C.setActiveTexture=function(D,F=!1){const G=this._state.activeTexture;0<=D&&(F||D!==this._state.activeTexture)&&
(this.gl.activeTexture(e.BASE_TEXTURE_UNIT+D),this._state.activeTexture=D);return G};C.clear=function(D){D&&this.gl.clear(D)};C.clearSafe=function(D,F=255){D&&(D&e.ClearBufferBit.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),D&e.ClearBufferBit.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),D&e.ClearBufferBit.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(F),this.gl.clear(D))};C.drawArrays=function(D,F,G){n.webglDebugEnabled()&&(this._numOfDrawCalls++,this._numOfTriangles+=A(D,G));this.gl.drawArrays(D,
F,G);n.webglDebugEnabled()&&(D=t.getErrorString(this))&&console.error("drawArrays:",D)};C.drawElements=function(D,F,G,J){n.webglDebugEnabled()&&(this._numOfDrawCalls++,this._numOfTriangles+=A(D,F));this.gl.drawElements(D,F,G,J);if(n.webglDebugEnabled()){const K=t.getErrorString(this);if(K){var I,O=this.getBoundVAO(),P=null==O?void 0:O.indexBuffer;O={indexBuffer:P,vertexBuffers:null==O?void 0:O.vertexBuffers};D={mode:D,count:F,type:G,offset:J};P=null!=(I=c.applySome(P,M=>M.size))?I:0;F=J+F;console.error(`drawElements: ${K}${P<
F?`. Buffer is too small. Attempted to draw index ${F} of ${P}`:""}`,{args:D,vao:O})}}};C.logIno=function(){n.webglDebugEnabled()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)};C.setViewport=function(D,F,G,J){G=Math.max(Math.round(G),1);J=Math.max(Math.round(J),1);const I=this._state.viewport;if(I.x!==D||I.y!==F||I.width!==G||I.height!==J)I.x=D,I.y=F,I.width=G,I.height=J,this.gl.viewport(D,F,G,J)};C.getViewport=function(){return{x:this._state.viewport.x,y:this._state.viewport.y,
width:this._state.viewport.width,height:this._state.viewport.height}};C.useProgram=function(D){var F,G;this._state.program!==D&&(null==(F=this._state.program)?void 0:F.stop(),this._state.program=D,this.gl.useProgram(null!=(G=null==D?void 0:D.glName)?G:null))};C.bindTexture=function(D,F,G=!1){(F>=this.parameters.maxTextureImageUnits||0>F)&&console.error("Input texture unit is out of range of available units!");const J=this._state.textureUnitMap[F];if(c.isNone(D)||null==D.glName)return c.isSome(J)&&
(this.setActiveTexture(F,G),this.gl.bindTexture(J.descriptor.target,null)),this._state.textureUnitMap[F]=null,J;if(!G&&J===D)return D.isDirty&&(this.setActiveTexture(F,G),D.applyChanges()),J;this.setActiveTexture(F,G);this.gl.bindTexture(D.descriptor.target,D.glName);D.applyChanges();this._state.textureUnitMap[F]=D;return J};C.unbindTextureAllUnits=function(D){for(let F=0;F<this.parameters.maxTextureImageUnits;F++)this._state.textureUnitMap[F]===D&&(this.bindTexture(null,F),this._state.textureUnitMap[F]=
null)};C.bindFramebuffer=function(D,F=!1){if(F||this._state.readFramebuffer!==D||this._state.drawFramebuffer!==D)c.isNone(D)?(this.gl.bindFramebuffer(e.FramebufferTarget.FRAMEBUFFER,null),this._state.readFramebuffer=null,this._state.drawFramebuffer=null):(D.initializeAndBind(e.FramebufferTarget.FRAMEBUFFER),this._state.readFramebuffer=D,this._state.drawFramebuffer=D)};C.bindFramebufferSeparate=function(D,F,G=!1){const J=F===e.FramebufferTarget.READ_FRAMEBUFFER,I=J?this._state.readFramebuffer:this._state.drawFramebuffer;
if(G||I!==D)c.isNone(D)?this.gl.bindFramebuffer(F,null):D.initializeAndBind(F),J?this._state.readFramebuffer=c.unwrapOr(D,null):this._state.drawFramebuffer=c.unwrapOr(D,null)};C.blitFramebuffer=function(D,F,G=0,J=0,I=D.width,O=D.height,P=0,K=0,M=F.width,U=F.height,R=e.ClearBufferBit.COLOR_BUFFER_BIT,L=e.TextureSamplingMode.NEAREST){this.bindFramebufferSeparate(D,e.FramebufferTarget.READ_FRAMEBUFFER);this.bindFramebufferSeparate(F,e.FramebufferTarget.DRAW_FRAMEBUFFER);this.gl.blitFramebuffer(G,J,I,
O,P,K,M,U,R,L)};C.bindBuffer=function(D,F){if(D){var G;null!=(G=F)?G:F=D.bufferType;switch(F){case e.BufferType.ARRAY_BUFFER:this._state.vertexBuffer=B(this.gl,D,F,this._state.vertexBuffer);break;case e.BufferType.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=B(this.gl,D,F,this._state.indexBuffer);break;case e.BufferType.UNIFORM_BUFFER:this._state.uniformBuffer=B(this.gl,D,F,this._state.uniformBuffer);break;case e.BufferType.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=B(this.gl,D,F,this._state.pixelPackBuffer);
break;case e.BufferType.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=B(this.gl,D,F,this._state.pixelUnpackBuffer);break;case e.BufferType.COPY_READ_BUFFER:this._state.copyReadBuffer=B(this.gl,D,F,this._state.copyReadBuffer);break;case e.BufferType.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=B(this.gl,D,F,this._state.copyWriteBuffer)}}};C.bindRenderbuffer=function(D){const F=this.gl;D||(F.bindRenderbuffer(F.RENDERBUFFER,null),this._state.renderbuffer=null);this._state.renderbuffer!==D&&(F.bindRenderbuffer(F.RENDERBUFFER,
D.glName),this._state.renderbuffer=D)};C._getBufferBinding=function(D,F){if(F>=this.parameters.maxUniformBufferBindings||0>F)return console.error("Uniform buffer binding point is out of range!"),null;D=this._state.uniformBufferBindingPoints;let G=D[F];c.isNone(G)&&(G={buffer:null,offset:0,size:0},D[F]=G);return G};C.bindBufferBase=function(D,F,G){const J=this._getBufferBinding(D,F);c.isNone(J)||J.buffer===G&&0===J.offset&&0===J.size||(this.gl.bindBufferBase(D,F,G?G.glName:null),J.buffer=G,J.offset=
0,J.size=0)};C.bindBufferRange=function(D,F,G,J,I){const O=this._getBufferBinding(D,F);c.isNone(O)||O.buffer===G&&O.offset===J&&O.size===I||(0!==J%this._parameters.uniformBufferOffsetAlignment?console.error("Uniform buffer binding offset is not a multiple of the context offset alignment"):(this.gl.bindBufferRange(D,F,G.glName,J,I),O.buffer=G,O.offset=J,O.size=I))};C.bindUBO=function(D,F,G,J){c.isNone(F)?this.bindBufferBase(e.BufferType.UNIFORM_BUFFER,D,null):(n.webglDebugEnabled()&&(null!=J?J:F.byteLength)>
this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),F.initialize(),void 0!==G&&void 0!==J?this.bindBufferRange(e.BufferType.UNIFORM_BUFFER,D,F.buffer,G,J):this.bindBufferBase(e.BufferType.UNIFORM_BUFFER,D,F.buffer))};C.unbindUBO=function(D){for(let F=0,G=this._state.uniformBufferBindingPoints.length;F<G;F++){const J=this._state.uniformBufferBindingPoints[F];c.isSome(J)&&J.buffer===D.buffer&&this.bindBufferBase(e.BufferType.UNIFORM_BUFFER,
F,null)}};C.unbindBuffer=function(D){switch(D){case e.BufferType.ARRAY_BUFFER:this._state.vertexBuffer=B(this.gl,null,D,this._state.vertexBuffer);break;case e.BufferType.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=B(this.gl,null,D,this._state.indexBuffer);break;case e.BufferType.UNIFORM_BUFFER:this._state.uniformBuffer=B(this.gl,null,D,this._state.uniformBuffer);break;case e.BufferType.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=B(this.gl,null,D,this._state.pixelPackBuffer);break;case e.BufferType.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=
B(this.gl,null,D,this._state.pixelUnpackBuffer);break;case e.BufferType.COPY_READ_BUFFER:this._state.copyReadBuffer=B(this.gl,null,D,this._state.copyReadBuffer);break;case e.BufferType.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=B(this.gl,null,D,this._state.copyWriteBuffer)}};C.bindVAO=function(D=null){c.isNone(D)?this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null):this._state.vertexArrayObject!==D&&(D.bind(),this._state.vertexArrayObject=D)};
C.clientWaitAsync=function(){var D=b._asyncToGenerator(function*(F=g.Milliseconds(10)){const G={};this.instanceCounter.increment(e.ResourceType.Sync,G);const J=this.gl,I=J.fenceSync(e.SyncCondition.SYNC_GPU_COMMANDS_COMPLETE,0);J.flush();let O;do yield d.after(F),O=J.clientWaitSync(I,0,0);while(O===e.ClientWaitSyncStatus.TIMEOUT_EXPIRED);J.deleteSync(I);this.instanceCounter.decrement(e.ResourceType.Sync,G);if(O===e.ClientWaitSyncStatus.WAIT_FAILED)throw Error("Client wait failed");});return function(){return D.apply(this,
arguments)}}();C.getBoundFramebufferObject=function(D=e.FramebufferTarget.FRAMEBUFFER){return D===e.FramebufferTarget.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer};C.getBoundVAO=function(){return this._state.vertexArrayObject};C.resetState=function(){this.useProgram(null);this.bindVAO(null);this.bindFramebuffer(null,!0);this.unbindBuffer(e.BufferType.ARRAY_BUFFER);this.unbindBuffer(e.BufferType.ELEMENT_ARRAY_BUFFER);v(this.gl)&&(this.unbindBuffer(e.BufferType.UNIFORM_BUFFER),
this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(e.BufferType.PIXEL_PACK_BUFFER),this.unbindBuffer(e.BufferType.PIXEL_UNPACK_BUFFER),this.unbindBuffer(e.BufferType.COPY_READ_BUFFER),this.unbindBuffer(e.BufferType.COPY_WRITE_BUFFER));for(let D=0;D<this.parameters.maxTextureImageUnits;++D)this.bindTexture(null,D);this.setBlendingEnabled(!1);this.setBlendFunction(e.BlendFactor.ONE,e.BlendFactor.ZERO);this.setBlendEquation(e.BlendOperation.ADD);this.setBlendColor(0,0,0,0);this.setFaceCullingEnabled(!1);
this.setCullFace(e.Face.BACK);this.setFrontFace(e.CullMode.CCW);this.setPolygonOffsetFillEnabled(!1);this.setPolygonOffset(0,0);this.setScissorTestEnabled(!1);this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height);this.setDepthTestEnabled(!1);this.setDepthFunction(e.CompareFunction.LESS);this.setDepthRange(0,1);this.setStencilTestEnabled(!1);this.setStencilFunction(e.CompareFunction.ALWAYS,0,0);this.setStencilOp(e.StencilOperation.KEEP,e.StencilOperation.KEEP,e.StencilOperation.KEEP);
this.setClearColor(0,0,0,0);this.setClearDepth(1);this.setClearStencil(0);this.setColorMask(!0,!0,!0,!0);this.setStencilWriteMask(4294967295);this.setDepthWriteEnabled(!0);this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)};C.enforceState=function(){var D,F;const G=this.gl;var J=this.capabilities.vao;J&&J.bindVertexArray(null);for(let M=0;M<this.parameters.maxVertexAttributes;M++)G.disableVertexAttribArray(M);this._state.vertexBuffer?G.bindBuffer(this._state.vertexBuffer.bufferType,
this._state.vertexBuffer.glName):G.bindBuffer(e.BufferType.ARRAY_BUFFER,null);this._state.indexBuffer?G.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):G.bindBuffer(e.BufferType.ELEMENT_ARRAY_BUFFER,null);if(v(G)){var I,O;this._state.uniformBuffer?G.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):G.bindBuffer(e.BufferType.UNIFORM_BUFFER,null);for(var P=0;P<this._parameters.maxUniformBufferBindings;P++){var K=this._state.uniformBufferBindingPoints[P];
if(c.isSome(K)&&null!==K.buffer){const {buffer:M,offset:U,size:R}=K;0===U&&0===R?G.bindBufferBase(e.BufferType.UNIFORM_BUFFER,P,M.glName):G.bindBufferRange(e.BufferType.UNIFORM_BUFFER,P,M.glName,U,R)}else G.bindBufferBase(e.BufferType.UNIFORM_BUFFER,P,null)}this._state.pixelPackBuffer?G.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):G.bindBuffer(e.BufferType.PIXEL_PACK_BUFFER,null);this._state.pixelUnpackBuffer?G.bindBuffer(this._state.pixelUnpackBuffer.bufferType,
this._state.pixelUnpackBuffer.glName):G.bindBuffer(e.BufferType.PIXEL_UNPACK_BUFFER,null);this._state.copyReadBuffer?G.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):G.bindBuffer(e.BufferType.COPY_READ_BUFFER,null);this._state.copyWriteBuffer?G.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):G.bindBuffer(e.BufferType.COPY_WRITE_BUFFER,null);G.bindFramebuffer(e.FramebufferTarget.READ_FRAMEBUFFER,null);G.readBuffer(G.BACK);this._state.readFramebuffer&&
(G.bindFramebuffer(e.FramebufferTarget.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),G.readBuffer(e.ColorAttachment.COLOR_ATTACHMENT0));G.bindFramebuffer(e.FramebufferTarget.DRAW_FRAMEBUFFER,null!=(I=null==(O=this._state.drawFramebuffer)?void 0:O.glName)?I:null)}else this._state.readFramebuffer=this._state.drawFramebuffer,G.bindFramebuffer(e.FramebufferTarget.FRAMEBUFFER,null!=(P=null==(K=this._state.drawFramebuffer)?void 0:K.glName)?P:null);if(J&&this._state.vertexArrayObject){if(J=this._state.vertexArrayObject)this._state.vertexArrayObject.unbind(),
this._state.vertexArrayObject=null;this.bindVAO(J)}G.useProgram(null!=(D=null==(F=this._state.program)?void 0:F.glName)?D:null);G.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a);G.bindRenderbuffer(G.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null);!0===this._state.blend?G.enable(this.gl.BLEND):G.disable(this.gl.BLEND);G.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha);
G.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha);G.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a);G.clearDepth(this._state.clearDepth);G.clearStencil(this._state.clearStencil);G.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a);G.cullFace(this._state.cullFace);G.depthFunc(this._state.depthFunction);
G.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar);!0===this._state.depthTest?G.enable(G.DEPTH_TEST):G.disable(G.DEPTH_TEST);G.depthMask(this._state.depthWrite);G.frontFace(this._state.frontFace);G.lineWidth(1);!0===this._state.faceCulling?G.enable(G.CULL_FACE):G.disable(G.CULL_FACE);G.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]);!0===this._state.polygonOffsetFill?G.enable(G.POLYGON_OFFSET_FILL):G.disable(G.POLYGON_OFFSET_FILL);G.scissor(this._state.scissorRect.x,
this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height);!0===this._state.scissorTest?G.enable(G.SCISSOR_TEST):G.disable(G.SCISSOR_TEST);G.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask);G.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass);!0===this._state.stencilTest?G.enable(G.STENCIL_TEST):G.disable(G.STENCIL_TEST);
G.stencilMask(this._state.stencilWriteMask);for(D=0;D<this.parameters.maxTextureImageUnits;D++)G.activeTexture(e.BASE_TEXTURE_UNIT+D),G.bindTexture(e.TextureType.TEXTURE_2D,null),G.bindTexture(e.TextureType.TEXTURE_CUBE_MAP,null),v(G)&&(G.bindTexture(e.TextureType.TEXTURE_3D,null),G.bindTexture(e.TextureType.TEXTURE_2D_ARRAY,null)),F=this._state.textureUnitMap[D],c.isSome(F)&&G.bindTexture(F.descriptor.target,F.glName);G.activeTexture(e.BASE_TEXTURE_UNIT+this._state.activeTexture);G.viewport(this._state.viewport.x,
this._state.viewport.y,this._state.viewport.width,this._state.viewport.height);n.webglDebugEnabled()&&(this._numOfTriangles=this._numOfDrawCalls=0)};C._loadExtensions=function(){this.type===f.ContextType.WEBGL1&&this.gl.getExtension("OES_element_index_uint");this.gl.getExtension("KHR_parallel_shader_compile")};C._loadParameters=function(D){var F,G=this.capabilities.textureFilterAnisotropic;D=null!=(F=D.maxAnisotropy)?F:Infinity;F=v(this.gl);const J=this.gl;G={versionString:this.gl.getParameter(this.gl.VERSION),
maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:G?Math.min(this.gl.getParameter(G.MAX_TEXTURE_MAX_ANISOTROPY),D):1,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),maxTextureSize:this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE),maxUniformBufferBindings:F?J.getParameter(J.MAX_UNIFORM_BUFFER_BINDINGS):0,maxVertexUniformBlocks:F?J.getParameter(J.MAX_VERTEX_UNIFORM_BLOCKS):
0,maxFragmentUniformBlocks:F?J.getParameter(J.MAX_FRAGMENT_UNIFORM_BLOCKS):0,maxUniformBlockSize:F?J.getParameter(J.MAX_UNIFORM_BLOCK_SIZE):0,uniformBufferOffsetAlignment:F?J.getParameter(J.UNIFORM_BUFFER_OFFSET_ALIGNMENT):1,maxArrayTextureLayers:F?J.getParameter(J.MAX_ARRAY_TEXTURE_LAYERS):1,maxSamples:F?J.getParameter(J.MAX_SAMPLES):1};y.Texture.TEXTURE_UNIT_FOR_UPDATES=G.maxTextureImageUnits-1;return G};b._createClass(E,[{key:"driverTest",get:function(){return this._driverTest}},{key:"contextAttributes",
get:function(){return this.gl.getContextAttributes()}},{key:"parameters",get:function(){return this._parameters}},{key:"capabilities",get:function(){return this._capabilities}}]);return E}();a.RenderingContext=x;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/ShaderTranspiler":function(){define(["exports","../../core/has","../../core/maybe","./enums","./reservedWordsGLSL3"],function(a,b,c,d,g){function x(){function q(S){S.length&&P.push({type:h[G],data:S,position:U,line:K,column:M})}
function z(){O=O.length?[]:O;if("/"===I&&"*"===J)return U=F+D-1,G=0,I=J,D+1;if("/"===I&&"/"===J)return U=F+D-1,G=1,I=J,D+1;if("#"===J)return G=2,U=F+D,D;if(/\s/.test(J))return G=9,U=F+D,D;R=/\d/.test(J);L=/[^\w_]/.test(J);U=F+D;G=R?4:L?3:9999;return D}function v(){if(("\r"===J||"\n"===J)&&"\\"!==I)return q(O.join("")),G=999,D;O.push(J);I=J;return D+1}function B(){if("."===I&&/\d/.test(J))return G=5,D;if("/"===I&&"*"===J)return G=0,D;if("/"===I&&"/"===J)return G=1,D;if("."===J&&O.length){for(;A(O););
G=5;return D}if(";"===J||")"===J||"("===J){if(O.length)for(;A(O););q(J);G=999;return D+1}var S=2===O.length&&"\x3d"!==J;if(/[\w_\d\s]/.test(J)||S){for(;A(O););G=999;return D}O.push(J);I=J;return D+1}function A(S){var H=0;do{var Q=y.indexOf(S.slice(0,S.length+H).join(""));var W=y[Q];if(-1===Q){if(0<H--+S.length)continue;W=S.slice(0,1).join("")}q(W);U+=W.length;O=O.slice(W.length);return O.length}while(1)}function E(){if("."===J||/[eE]/.test(J))return O.push(J),G=5,I=J,D+1;if("x"===J&&1===O.length&&
"0"===O[0])return G=11,O.push(J),I=J,D+1;if(/[^\d]/.test(J))return q(O.join("")),G=999,D;O.push(J);I=J;return D+1}function C(){"f"===J&&(O.push(J),I=J,D+=1);if(/[eE]/.test(J)||"-"===J&&/[eE]/.test(I))return O.push(J),I=J,D+1;if(/[^\d]/.test(J))return q(O.join("")),G=999,D;O.push(J);I=J;return D+1}var D=0,F=0,G=999,J,I,O=[],P=[],K=1,M=0,U=0,R=!1,L=!1,N="",T;return function(S){P=[];if(null!==S){S=S.replace?S.replace(/\r\n/g,"\n"):S;D=0;N+=S;for(T=N.length;J=N[D],D<T;){S=D;switch(G){case 0:"/"===J&&
"*"===I?(O.push(J),q(O.join("")),G=999):(O.push(J),I=J);D+=1;break;case 1:D=v();break;case 2:D=v();break;case 3:D=B();break;case 4:D=E();break;case 11:/[^a-fA-F0-9]/.test(J)?(q(O.join("")),G=999):(O.push(J),I=J,D+=1);break;case 5:D=C();break;case 9999:if(/[^\d\w_]/.test(J)){var H=O.join("");G=-1<r.indexOf(H)?8:-1<p.indexOf(H)?7:6;q(O.join(""));G=999}else O.push(J),I=J,D+=1;break;case 9:/[^\s]/g.test(J)?(q(O.join("")),G=999):(O.push(J),I=J,D+=1);break;case 999:D=z()}if(S!==D)switch(N[S]){case "\n":M=
0;++K;break;default:++M}}F+=D;N=N.slice(D);return P}O.length&&q(O.join(""));G=10;q("(eof)");return P}}function w(q){return q.map(z=>"eof"!==z.type?z.data:"").join("")}function l(q,z="100",v="300 es"){const B=/^\s*#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const A of q)if("preprocessor"===A.type){const E=B.exec(A.data);if(E){q=E[1].replace(/\s\s+/g," ");if(q===v)return q;if(q===z)return A.data="#version "+v,z;throw Error("unknown glsl version: "+q);}}q.splice(0,0,{type:"preprocessor",data:"#version "+
v},{type:"whitespace",data:"\n"});return null}function n(q,z,v,B){B=B||v;for(const A of q)if("ident"===A.type&&A.data===v)return B in z?z[B]++:z[B]=0,n(q,z,B+"_"+z[B],B);return v}function f(q,z,v="afterVersion"){const B={data:"\n",type:"whitespace"},A=C=>C<q.length?/[^\r\n]$/.test(q[C].data):!1;let E=function(C){let D=-1,F=0,G=-1;for(let I=0;I<C.length;I++){var J=C[I];"preprocessor"===J.type&&(J.data.match(/#(if|ifdef|ifndef)\s+.+/)?++F:J.data.match(/#endif\s*.*/)&&--F);("afterVersion"===v||"afterPrecision"===
v)&&"preprocessor"===J.type&&/^#version/.test(J.data)&&(G=Math.max(G,I));if("afterPrecision"===v&&"keyword"===J.type&&"precision"===J.data){a:{for(J=I;J<C.length;J++){const O=C[J];if("operator"===O.type&&";"===O.data)break a}J=null}if(null===J)throw Error("precision statement not followed by any semicolons!");G=Math.max(G,J)}D<G&&0===F&&(D=I)}return D+1}(q);A(E-1)&&q.splice(E++,0,B);for(const C of z)q.splice(E++,0,C);A(E-1)&&A(E)&&q.splice(E,0,B)}function e(q,z,v,B="lowp"){f(q,[{type:"keyword",data:"out"},
{type:"whitespace",data:" "},{type:"keyword",data:B},{type:"whitespace",data:" "},{type:"keyword",data:v},{type:"whitespace",data:" "},{type:"ident",data:z},{type:"operator",data:";"}],"afterPrecision")}function k(q,z,v,B,A="lowp"){f(q,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"\x3d"},{type:"whitespace",data:" "},{type:"integer",data:B.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},
{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:A},{type:"whitespace",data:" "},{type:"keyword",data:v},{type:"whitespace",data:" "},{type:"ident",data:z},{type:"operator",data:";"}],"afterPrecision")}b={exports:{}};(function(q){(function(z){z=z();void 0!==z&&(q.exports=z)})(function(){return"precision highp mediump lowp attribute const uniform varying break continue do for while if else in out inout float int void bool true false discard return mat2 mat3 mat4 vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 sampler1D sampler2D sampler3D samplerCube sampler1DShadow sampler2DShadow struct asm class union enum typedef template this packed goto switch default inline noinline volatile public static extern external interface long short double half fixed unsigned input output hvec2 hvec3 hvec4 dvec2 dvec3 dvec4 fvec2 fvec3 fvec4 sampler2DRect sampler3DRect sampler2DRectShadow sizeof cast namespace using".split(" ")})})(b);
const r=b.exports;b={exports:{}};(function(q){(function(z){z=z();void 0!==z&&(q.exports=z)})(function(){"use strict;";return"\x3c\x3c\x3d \x3e\x3e\x3d ++ -- \x3c\x3c \x3e\x3e \x3c\x3d \x3e\x3d \x3d\x3d !\x3d \x26\x26 || +\x3d -\x3d *\x3d /\x3d %\x3d \x26\x3d ^^ ^\x3d |\x3d ( ) [ ] . ! ~ * / % + - \x3c \x3e \x26 ^ | ? : \x3d , ; { }".split(" ")})})(b);const y=b.exports;b={exports:{}};(function(q){(function(z){z=z();void 0!==z&&(q.exports=z)})(function(){return"abs acos all any asin atan ceil clamp cos cross dFdx dFdy degrees distance dot equal exp exp2 faceforward floor fract gl_BackColor gl_BackLightModelProduct gl_BackLightProduct gl_BackMaterial gl_BackSecondaryColor gl_ClipPlane gl_ClipVertex gl_Color gl_DepthRange gl_DepthRangeParameters gl_EyePlaneQ gl_EyePlaneR gl_EyePlaneS gl_EyePlaneT gl_Fog gl_FogCoord gl_FogFragCoord gl_FogParameters gl_FragColor gl_FragCoord gl_FragData gl_FragDepth gl_FragDepthEXT gl_FrontColor gl_FrontFacing gl_FrontLightModelProduct gl_FrontLightProduct gl_FrontMaterial gl_FrontSecondaryColor gl_LightModel gl_LightModelParameters gl_LightModelProducts gl_LightProducts gl_LightSource gl_LightSourceParameters gl_MaterialParameters gl_MaxClipPlanes gl_MaxCombinedTextureImageUnits gl_MaxDrawBuffers gl_MaxFragmentUniformComponents gl_MaxLights gl_MaxTextureCoords gl_MaxTextureImageUnits gl_MaxTextureUnits gl_MaxVaryingFloats gl_MaxVertexAttribs gl_MaxVertexTextureImageUnits gl_MaxVertexUniformComponents gl_ModelViewMatrix gl_ModelViewMatrixInverse gl_ModelViewMatrixInverseTranspose gl_ModelViewMatrixTranspose gl_ModelViewProjectionMatrix gl_ModelViewProjectionMatrixInverse gl_ModelViewProjectionMatrixInverseTranspose gl_ModelViewProjectionMatrixTranspose gl_MultiTexCoord0 gl_MultiTexCoord1 gl_MultiTexCoord2 gl_MultiTexCoord3 gl_MultiTexCoord4 gl_MultiTexCoord5 gl_MultiTexCoord6 gl_MultiTexCoord7 gl_Normal gl_NormalMatrix gl_NormalScale gl_ObjectPlaneQ gl_ObjectPlaneR gl_ObjectPlaneS gl_ObjectPlaneT gl_Point gl_PointCoord gl_PointParameters gl_PointSize gl_Position gl_ProjectionMatrix gl_ProjectionMatrixInverse gl_ProjectionMatrixInverseTranspose gl_ProjectionMatrixTranspose gl_SecondaryColor gl_TexCoord gl_TextureEnvColor gl_TextureMatrix gl_TextureMatrixInverse gl_TextureMatrixInverseTranspose gl_TextureMatrixTranspose gl_Vertex greaterThan greaterThanEqual inversesqrt length lessThan lessThanEqual log log2 matrixCompMult max min mix mod normalize not notEqual pow radians reflect refract sign sin smoothstep sqrt step tan texture2D texture2DLod texture2DProj texture2DProjLod textureCube textureCubeLod texture2DLodEXT texture2DProjLodEXT textureCubeLodEXT texture2DGradEXT texture2DProjGradEXT textureCubeGradEXT".split(" ")})})(b);
const p=b.exports;var h="block-comment line-comment preprocessor operator integer float ident builtin keyword whitespace eof integer".split(" ");const m=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"],u={enableCache:!1},t=new Map;a.test=u;a.transpileShader=function(q,z){var v=u.enableCache?t.get(q):null;if(c.isSome(v))return v;v=x();var B=[];B=B.concat(v(q));v=B=B.concat(v(null));if("300 es"===l(v,"100","300 es"))return q;var A=B=null;const E=
{},C={};for(let J=0;J<v.length;++J){const I=v[J];switch(I.type){case "keyword":z===d.ShaderType.VERTEX_SHADER&&"attribute"===I.data?I.data="in":"varying"===I.data&&(I.data=z===d.ShaderType.VERTEX_SHADER?"out":"in");break;case "builtin":/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(I.data.trim())&&(I.data=I.data.replace(/(2D|Cube|EXT)/g,""));z===d.ShaderType.FRAGMENT_SHADER&&"gl_FragColor"===I.data&&(B||(B=n(v,E,"fragColor"),e(v,B,"vec4")),I.data=B);if(z===d.ShaderType.FRAGMENT_SHADER&&"gl_FragData"===
I.data){{var D=void 0;let O=void 0;var F=v;var G=J+1;let P=-1;for(;G<F.length;G++){const K=F[G];if("operator"===K.type&&("["===K.data&&(O=G),"]"===K.data)){D=G;break}"integer"===K.type&&(P=parseInt(K.data,10))}O&&D&&F.splice(O,D-O+1);F=P}D=n(v,E,"fragData");k(v,D,"vec4",F,"mediump");I.data=D}else z===d.ShaderType.FRAGMENT_SHADER&&"gl_FragDepthEXT"===I.data&&(A||(A=n(v,E,"gl_FragDepth")),I.data=A);break;case "ident":if(0<=g.indexOf(I.data)){if(F=z===d.ShaderType.VERTEX_SHADER)a:{for(F=J-1;0<=F;F--)if(D=
v[F],"whitespace"!==D.type&&"block-comment"!==D.type)if("keyword"===D.type){if("attribute"===D.data||"in"===D.data){F=!0;break a}}else break;F=!1}if(F)throw Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");I.data in C||(C[I.data]=n(v,E,I.data));I.data=C[I.data]}}}for(z=v.length-1;0<=z;--z)B=v[z],"preprocessor"===B.type&&((A=B.data.match(/#extension\s+(.*):/))&&A[1]&&0<=m.indexOf(A[1].trim())&&(A=v[z+1],v.splice(z,A&&"whitespace"===A.type?2:1)),(A=B.data.match(/#ifdef\s+(.*)/))&&
A[1]&&0<=m.indexOf(A[1].trim())&&(B.data="#if 1"),(A=B.data.match(/#ifndef\s+(.*)/))&&A[1]&&0<=m.indexOf(A[1].trim())&&(B.data="#if 0"));v=w(v);u.enableCache&&t.set(q,v);return v};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/reservedWordsGLSL3":function(){define(function(){return"layout centroid smooth case mat2x2 mat2x3 mat2x4 mat3x2 mat3x3 mat3x4 mat4x2 mat4x3 mat4x4 uint uvec2 uvec3 uvec4 samplerCubeShadow sampler2DArray sampler2DArrayShadow isampler2D isampler3D isamplerCube isampler2DArray usampler2D usampler3D usamplerCube usampler2DArray coherent restrict readonly writeonly resource atomic_uint noperspective patch sample subroutine common partition active filter image1D image2D image3D imageCube iimage1D iimage2D iimage3D iimageCube uimage1D uimage2D uimage3D uimageCube image1DArray image2DArray iimage1DArray iimage2DArray uimage1DArray uimage2DArray image1DShadow image2DShadow image1DArrayShadow image2DArrayShadow imageBuffer iimageBuffer uimageBuffer sampler1DArray sampler1DArrayShadow isampler1D isampler1DArray usampler1D usampler1DArray isampler2DRect usampler2DRect samplerBuffer isamplerBuffer usamplerBuffer sampler2DMS isampler2DMS usampler2DMS sampler2DMSArray isampler2DMSArray usampler2DMSArray trunc round roundEven isnan isinf floatBitsToInt floatBitsToUint intBitsToFloat uintBitsToFloat packSnorm2x16 unpackSnorm2x16 packUnorm2x16 unpackUnorm2x16 packHalf2x16 unpackHalf2x16 outerProduct transpose determinant inverse texture textureSize textureProj textureLod textureOffset texelFetch texelFetchOffset textureProjOffset textureLodOffset textureProjLod textureProjLodOffset textureGrad textureGradOffset textureProjGrad textureProjGradOffset".split(" ")})},
"esri/views/webgl/ProgramCache":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/maybe","../../core/NestedMap","./Program"],function(a,b,c,d,g){let x=function(){function w(n){this._rctx=n;this._store=new d.NestedMap}var l=w.prototype;l.dispose=function(){this._store.forEach(n=>n.forEach(f=>f.dispose()));this._store.clear()};l.acquire=function(n,f,e,k){const r=this._store.get(n,f);if(c.isSome(r))return r.ref(),r;e=new g.Program(this._rctx,n,f,e,k);e.ref();this._store.set(n,
f,e);return e};b._createClass(w,[{key:"test",get:function(){let n=0;this._store.forEach(f=>f.forEach(e=>n+=e.hasGLName?2:1));return{cachedWebGLObjects:n}}}]);return w}();a.ProgramCache=x;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/Program":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/has ../../core/maybe ./checkWebGLError ./context-util ./enums ./ShaderTranspiler".split(" "),function(a,b,c,d,g,x,w,l){function n(r,y){if(d.isNone(r)||r.length!==
y.length)return!0;for(let p=0;p<r.length;++p)if(r[p]!==y[p])return!0;return!1}function f(r,y,p){const h=r.gl,m=h.createShader(y);h.shaderSource(m,p);h.compileShader(m);g.webglValidateShadersEnabled()&&!h.getShaderParameter(m,h.COMPILE_STATUS)&&(console.error("Compile error in ".concat(y===w.ShaderType.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(h.getShaderInfoLog(m)),console.error(e(p)),r.type===x.ContextType.WEBGL2&&(console.log("Shader source before transpilation:"),console.log(p)));
return m}function e(r){let y=2;return r.replace(/\n/g,()=>{var p=y++;p=1E3<=p?p.toString():("  "+p).slice(-3);return"\n"+p+":"})}function k(r,y){for(let p=0;p<r.length;++p)y[p]=r[p]}c=function(){function r(p,h,m,u,t=new Map){this._context=p;this._locations=u;this._uniformBlockBindings=t;this._refCount=1;this._compiled=!1;this._nameToUniformLocation={};this._nameToUniform1={};this._nameToUniform1v={};this._nameToUniform2={};this._nameToUniform3={};this._nameToUniform4={};this._nameToUniformMatrix3=
{};this._nameToUniformMatrix4={};p||console.error("RenderingContext isn't initialized!");0===h.length&&console.error("Shaders source should not be empty!");this._context.type===x.ContextType.WEBGL2&&(h=l.transpileShader(h,w.ShaderType.VERTEX_SHADER),m=l.transpileShader(m,w.ShaderType.FRAGMENT_SHADER));this._vShader=f(this._context,w.ShaderType.VERTEX_SHADER,h);this._fShader=f(this._context,w.ShaderType.FRAGMENT_SHADER,m);this._vShader&&this._fShader||console.error("Error loading shaders!");this._context.instanceCounter.increment(w.ResourceType.Shader,
this);g.webglValidateShadersEnabled()&&(this.vertexShader=h,this.fragmentShader=m)}var y=r.prototype;y.dispose=function(){if(!(0<--this._refCount)){var p=this._context.gl;this._vShader&&(p.deleteShader(this._vShader),this._vShader=null,this._context.instanceCounter.decrement(w.ResourceType.Shader,this));this._fShader&&(p.deleteShader(this._fShader),this._fShader=null);this._glName&&(p.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(w.ResourceType.Program,this))}};
y.ref=function(){++this._refCount};y._getUniformLocation=function(p){void 0===this._nameToUniformLocation[p]&&(this._nameToUniformLocation[p]=this._context.gl.getUniformLocation(this.glName,p));return this._nameToUniformLocation[p]};y.hasUniform=function(p){return null!==this._getUniformLocation(p)};y.setUniform1i=function(p,h){const m=this._nameToUniform1[p];if(void 0===m||h!==m)this._context.gl.uniform1i(this._getUniformLocation(p),h),this._nameToUniform1[p]=h};y.setUniform1iv=function(p,h){const m=
this._nameToUniform1v[p];n(m,h)&&(this._context.gl.uniform1iv(this._getUniformLocation(p),h),void 0===m?this._nameToUniform1v[p]=Array.from(h):k(h,m))};y.setUniform2iv=function(p,h){const m=this._nameToUniform2[p];n(m,h)&&(this._context.gl.uniform2iv(this._getUniformLocation(p),h),void 0===m?this._nameToUniform2[p]=Array.from(h):k(h,m))};y.setUniform3iv=function(p,h){const m=this._nameToUniform3[p];n(m,h)&&(this._context.gl.uniform3iv(this._getUniformLocation(p),h),void 0===m?this._nameToUniform3[p]=
Array.from(h):k(h,m))};y.setUniform4iv=function(p,h){const m=this._nameToUniform4[p];n(m,h)&&(this._context.gl.uniform4iv(this._getUniformLocation(p),h),void 0===m?this._nameToUniform4[p]=Array.from(h):k(h,m))};y.setUniform1f=function(p,h){const m=this._nameToUniform1[p];if(void 0===m||h!==m)this._context.gl.uniform1f(this._getUniformLocation(p),h),this._nameToUniform1[p]=h};y.setUniform1fv=function(p,h){const m=this._nameToUniform1v[p];n(m,h)&&(this._context.gl.uniform1fv(this._getUniformLocation(p),
h),void 0===m?this._nameToUniform1v[p]=Array.from(h):k(h,m))};y.setUniform2f=function(p,h,m){const u=this._nameToUniform2[p];if(void 0===u||h!==u[0]||m!==u[1])this._context.gl.uniform2f(this._getUniformLocation(p),h,m),void 0===u?this._nameToUniform2[p]=[h,m]:(u[0]=h,u[1]=m)};y.setUniform2fv=function(p,h){const m=this._nameToUniform2[p];n(m,h)&&(this._context.gl.uniform2fv(this._getUniformLocation(p),h),void 0===m?this._nameToUniform2[p]=Array.from(h):k(h,m))};y.setUniform3f=function(p,h,m,u){const t=
this._nameToUniform3[p];if(void 0===t||h!==t[0]||m!==t[1]||u!==t[2])this._context.gl.uniform3f(this._getUniformLocation(p),h,m,u),void 0===t?this._nameToUniform3[p]=[h,m,u]:(t[0]=h,t[1]=m,t[2]=u)};y.setUniform3fv=function(p,h){const m=this._nameToUniform3[p];n(m,h)&&(this._context.gl.uniform3fv(this._getUniformLocation(p),h),void 0===m?this._nameToUniform3[p]=Array.from(h):k(h,m))};y.setUniform4f=function(p,h,m,u,t){const q=this._nameToUniform4[p];if(void 0===q||h!==q[0]||m!==q[1]||u!==q[2]||t!==
q[3])this._context.gl.uniform4f(this._getUniformLocation(p),h,m,u,t),void 0===q?this._nameToUniform4[p]=[h,m,u,t]:(q[0]=h,q[1]=m,q[2]=u,q[3]=t)};y.setUniform4fv=function(p,h){const m=this._nameToUniform4[p];n(m,h)&&(this._context.gl.uniform4fv(this._getUniformLocation(p),h),void 0===m?this._nameToUniform4[p]=Array.from(h):k(h,m))};y.setUniformMatrix3fv=function(p,h,m=!1){const u=this._nameToUniformMatrix3[p];var t=d.isNone(u)?!0:9!==u.length?n(u,h):9!==u.length||u[0]!==h[0]||u[1]!==h[1]||u[2]!==h[2]||
u[3]!==h[3]||u[4]!==h[4]||u[5]!==h[5]||u[6]!==h[6]||u[7]!==h[7]||u[8]!==h[8];t&&(this._context.gl.uniformMatrix3fv(this._getUniformLocation(p),m,h),void 0===u?this._nameToUniformMatrix3[p]=Array.from(h):k(h,u))};y.setUniformMatrix4fv=function(p,h,m=!1){const u=this._nameToUniformMatrix4[p];var t=d.isNone(u)?!0:16!==u.length?n(u,h):16!==u.length||u[0]!==h[0]||u[1]!==h[1]||u[2]!==h[2]||u[3]!==h[3]||u[4]!==h[4]||u[5]!==h[5]||u[6]!==h[6]||u[7]!==h[7]||u[8]!==h[8]||u[9]!==h[9]||u[10]!==h[10]||u[11]!==
h[11]||u[12]!==h[12]||u[13]!==h[13]||u[14]!==h[14]||u[15]!==h[15];t&&(this._context.gl.uniformMatrix4fv(this._getUniformLocation(p),m,h),void 0===u?this._nameToUniformMatrix4[p]=Array.from(h):k(h,u))};y.stop=function(){};b._createClass(r,[{key:"glName",get:function(){if(d.isSome(this._glName))return this._glName;if(d.isNone(this._vShader))return null;const p=this._context.gl,h=p.createProgram();p.attachShader(h,this._vShader);p.attachShader(h,this._fShader);this._locations.forEach((m,u)=>p.bindAttribLocation(h,
m,u));p.linkProgram(h);g.webglValidateShadersEnabled()&&!p.getProgramParameter(h,p.LINK_STATUS)&&console.error("Could not link shader\n"+`validated: ${p.getProgramParameter(h,p.VALIDATE_STATUS)}`+`, gl error ${p.getError()}`+`, vertex: ${p.getShaderParameter(this._vShader,p.COMPILE_STATUS)}`+`, fragment: ${p.getShaderParameter(this._fShader,p.COMPILE_STATUS)}`+`, info log: ${p.getProgramInfoLog(h)}`+`, vertex source: ${this.vertexShader}`+`, fragment source: ${this.fragmentShader}`);if(this._context.type===
x.ContextType.WEBGL2)for(const [m,u]of this._uniformBlockBindings){const t=p.getUniformBlockIndex(h,m);4294967295>t&&p.uniformBlockBinding(h,t,u)}this._glName=h;this._context.instanceCounter.increment(w.ResourceType.Program,this);return h}},{key:"hasGLName",get:function(){return d.isSome(this._glName)}},{key:"isCompiled",get:function(){if(this._compiled)return!0;const p=this._context.gl.getExtension("KHR_parallel_shader_compile");return null==p?this._compiled=!0:this._compiled=!!this._context.gl.getProgramParameter(this.glName,
p.COMPLETION_STATUS_KHR)}}]);return r}();a.Program=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/ContextState":function(){define(["exports","./enums"],function(a,b){a.ContextState=function(){this.blend=!1;this.blendColor={r:0,g:0,b:0,a:0};this.blendFunction={srcRGB:b.BlendFactor.ONE,dstRGB:b.BlendFactor.ZERO,srcAlpha:b.BlendFactor.ONE,dstAlpha:b.BlendFactor.ZERO};this.blendEquation={mode:b.BlendOperation.ADD,modeAlpha:b.BlendOperation.ADD};this.colorMask={r:!0,g:!0,b:!0,
a:!0};this.faceCulling=!1;this.cullFace=b.Face.BACK;this.frontFace=b.CullMode.CCW;this.scissorTest=!1;this.scissorRect={x:0,y:0,width:0,height:0};this.depthTest=!1;this.depthFunction=b.CompareFunction.LESS;this.clearDepth=1;this.depthWrite=!0;this.depthRange={zNear:0,zFar:1};this.viewport=null;this.polygonOffsetFill=this.stencilTest=!1;this.polygonOffset=[0,0];this.stencilFunction={face:b.Face.FRONT_AND_BACK,func:b.CompareFunction.ALWAYS,ref:0,mask:1};this.clearStencil=0;this.stencilWriteMask=1;this.stencilOperation=
{face:b.Face.FRONT_AND_BACK,fail:b.StencilOperation.KEEP,zFail:b.StencilOperation.KEEP,zPass:b.StencilOperation.KEEP};this.clearColor={r:0,g:0,b:0,a:0};this.copyWriteBuffer=this.copyReadBuffer=this.pixelUnpackBuffer=this.pixelPackBuffer=this.uniformBuffer=this.indexBuffer=this.vertexBuffer=this.program=null;this.uniformBufferBindingPoints=[];this.renderbuffer=this.drawFramebuffer=this.readFramebuffer=null;this.activeTexture=0;this.textureUnitMap=[]};Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/webgl/InstanceCounter":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../support/AllocationTracer","./enums"],function(a,b,c,d){const g=new function(){this.RECORD_ALLOCATIONS=!1};let x=function(){function w(){this._current=[];this._max=[];for(this._allocations=new c.AllocationTracer(g.RECORD_ALLOCATIONS);this._current.length<d.ResourceType.COUNT;)this._current.push(0),this._max.push(0)}var l=w.prototype;l.resetMax=function(){for(this._max.length=0;this._max.length<
this._current.length;)this._max.push(0)};l.increment=function(n,f){const e=++this._current[n];this._max[n]=Math.max(e,this._max[n]);this._allocations.add(f)};l.decrement=function(n,f){--this._current[n];this._allocations.remove(f)};l.printResourceCount=function(){if(0<this.total){console.log("Live objects:");for(let n=0;n<d.ResourceType.COUNT;++n){const f=this._current[n];0<f&&console.log(`${d.ResourceType[n]}: ${f}`)}}this._allocations.print()};b._createClass(w,[{key:"max",get:function(){return this._max}},
{key:"current",get:function(){return this._current}},{key:"total",get:function(){return this.current.reduce((n,f)=>n+f,0)}}]);return w}();a.InstanceCounter=x;a.test=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/support/AllocationTracer":function(){define(["exports"],function(a){let b=function(){function c(g){this._allocations=new Map;g?Error.stackTraceLimit=Infinity:(this.add=()=>{},this.remove=()=>{})}var d=c.prototype;d.add=function(g){this._allocations.set(g,Error().stack)};
d.remove=function(g){this._allocations.delete(g)};d.print=function(){if(0<this._allocations.size){console.log(`${this._allocations.size} live object allocations:`);const g=new Map;this._allocations.forEach(x=>{var w;g.set(x,(null!=(w=g.get(x))?w:0)+1)});g.forEach((x,w)=>{w=w.split("\n");w.shift();w.shift();console.log(`${x}: ${w.shift()}`);w.forEach(l=>console.log("   ",l))})}};return c}();a.AllocationTracer=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/WebGLDriverTest":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/maybe ./testDoublePrecisionArithmetic ./testFloatBufferBlend ./testSamplerPrecision ./testSVGPremultipliedAlpha".split(" "),
function(a,b,c,d,g,x,w){let l=function(){function n(f){this.context=f;this._floatBufferBlendWorking=g.testFloatBufferBlend(f);w.testSVGPremultipliedAlpha(f).then(e=>this._svgAlwaysPremultipliesAlpha=!e)}b._createClass(n,[{key:"floatBufferBlendWorking",get:function(){if(c.isNone(this._floatBufferBlendWorking))throw Error("floatBufferBlendWorking test not yet available");return this._floatBufferBlendWorking}},{key:"svgAlwaysPremultipliesAlpha",get:function(){if(c.isNone(this._svgAlwaysPremultipliesAlpha))throw Error("svgAlwaysPremultipliesAlpha test not yet available");
return this._svgAlwaysPremultipliesAlpha}},{key:"doublePrecisionRequiresObfuscation",get:function(){if(c.isNone(this._doublePrecisionRequiresObfuscation)){const f=d.testDoublePrecisionArithmetic(this.context,!1),e=d.testDoublePrecisionArithmetic(this.context,!0);this._doublePrecisionRequiresObfuscation=0!==f&&(0===e||5<f/e)}return this._doublePrecisionRequiresObfuscation}},{key:"ignoresSamplerPrecision",get:function(){c.isNone(this._ignoresSamplerPrecision)&&(this._ignoresSamplerPrecision=x.testSamplerPrecision(this.context));
return this._ignoresSamplerPrecision}}]);return n}();a.WebGLDriverTest=l;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/testDoublePrecisionArithmetic":function(){define("exports ../../core/floatRGBA ../../chunks/vec3f64 ./BufferObject ./doublePrecisionUtils ./enums ./FramebufferObject ./VertexArrayObject ./VertexElementDescriptor".split(" "),function(a,b,c,d,g,x,w,l,n){a.testDoublePrecisionArithmetic=function(f,e){var k=new w.FramebufferObject(f,{colorTarget:x.TargetType.TEXTURE,
depthStencilTarget:x.DepthStencilTargetType.NONE},{target:x.TextureType.TEXTURE_2D,wrapMode:x.TextureWrapMode.CLAMP_TO_EDGE,pixelFormat:x.PixelFormat.RGBA,dataType:x.PixelType.UNSIGNED_BYTE,samplingMode:x.TextureSamplingMode.NEAREST,width:1,height:1});const r=d.BufferObject.createVertex(f,x.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),y=new l.VertexArrayObject(f,new Map([["position",0]]),{geometry:[new n.VertexElementDescriptor("position",2,x.DataType.UNSIGNED_SHORT,0,4)]},{geometry:r}),
p=c.fromValues(5633261.287538229,2626832.878767164,1434988.0495278358),h=c.fromValues(5633271.46742708,2626873.6381334523,1434963.231608387);e=f.programCache.acquire(`\n\n  precision highp float;\n\n  attribute vec2 position;\n\n  uniform vec3 u_highA;\n  uniform vec3 u_lowA;\n  uniform vec3 u_highB;\n  uniform vec3 u_lowB;\n\n  varying vec4 v_color;\n\n  ${e?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}\n\n  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION\n\n  vec3 dpPlusFrc(vec3 a, vec3 b) {\n    return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n  }\n\n  vec3 dpMinusFrc(vec3 a, vec3 b) {\n    return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n  }\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = dpPlusFrc(hiA, hiB);\n    vec3 e = dpMinusFrc(t1, hiA);\n    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n    return t1 + t2;\n  }\n\n  #else\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = hiA + hiB;\n    vec3 e = t1 - hiA;\n    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n    return t1 + t2;\n  }\n\n  #endif\n\n  const float MAX_RGBA_FLOAT =\n    255.0 / 256.0 +\n    255.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n  vec4 float2rgba(const float value) {\n    // Make sure value is in the domain we can represent\n    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n    // Decompose value in 32bit fixed point parts represented as\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\n    // by a power of 256 (this removes the bits that are represented in the previous\n    // component) and then converts the fractional part to 8bits.\n    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n    // Convert uint8 values (from 0 to 255) to floating point representation for\n    // the shader\n    const float toU8AsFloat = 1.0 / 255.0;\n\n    return fixedPointU8 * toU8AsFloat;\n  }\n\n  void main() {\n    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);\n\n    v_color = float2rgba(val.z / 25.0);\n\n    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);\n  }\n  `,
"\n  precision highp float;\n\n  varying vec4 v_color;\n\n  void main() {\n    gl_FragColor \x3d v_color;\n  }\n  ",new Map([["position",0]]));var m=new Float32Array(6);g.encodeDoubleArray(p,m,3);var u=new Float32Array(6);g.encodeDoubleArray(h,u,3);f.useProgram(e);e.setUniform3f("u_highA",m[0],m[2],m[4]);e.setUniform3f("u_lowA",m[1],m[3],m[5]);e.setUniform3f("u_highB",u[0],u[2],u[4]);e.setUniform3f("u_lowB",u[1],u[3],u[5]);m=e;u=f.getBoundFramebufferObject();const {x:t,y:q,width:z,height:v}=f.getViewport();
f.bindFramebuffer(k);f.setViewport(0,0,1,1);f.bindVAO(y);f.drawArrays(x.PrimitiveType.TRIANGLE_STRIP,0,4);e=new Uint8Array(4);k.readPixels(0,0,1,1,x.PixelFormat.RGBA,x.PixelType.UNSIGNED_BYTE,e);m.dispose();y.dispose(!1);r.dispose();k.dispose();f.setViewport(t,q,z,v);f.bindFramebuffer(u);f=(p[2]-h[2])/25;k=b.unpackFloatRGBA(e);return Math.abs(f-k)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/testFloatBufferBlend":function(){define("exports ../3d/webgl-engine/lib/OrderIndependentTransparency ./BufferObject ./context-util ./enums ./FramebufferObject ./renderState ./VertexArrayObject ./VertexElementDescriptor".split(" "),
function(a,b,c,d,g,x,w,l,n){var f={exports:{}};(function(e){(function(k){k=k();void 0!==k&&(e.exports=k)})(function(){function k(v){if(null==q){q={};z={};for(var B in v)"number"==typeof v[B]&&(q[v[B]]=B,z[B]=v[B])}}function r(){if(null==q)throw"WebGLDebugUtils.init(ctx) not called";}function y(v){r();var B=q[v];return void 0!==B?"gl."+B:"/*UNKNOWN WebGL ENUM*/ 0x"+v.toString(16)}function p(v,B,A,E){v=t[v];if(void 0!==v&&(v=v[B],void 0!==v&&v[A])){if("object"===typeof v[A]&&void 0!==v[A].enumBitwiseOr){B=
v[A].enumBitwiseOr;A=0;v=[];for(var C=0;C<B.length;++C){var D=z[B[C]];0!==(E&D)&&(A|=D,v.push(y(D)))}return A===E?v.join(" | "):y(E)}return y(E)}return null===E?"null":void 0===E?"undefined":E.toString()}function h(v,B,A){v.__defineGetter__(A,function(){return B[A]});v.__defineSetter__(A,function(E){B[A]=E})}function m(v,B,A,E){function C(I,O){return function(){A&&A(O,arguments);var P=I[O].apply(I,arguments),K=E.getError();0!=K&&(D[K]=!0,B(K,O,arguments));return P}}E=E||v;k(v);B=B||function(I,O,P){for(var K=
"",M=P.length,U=0;U<M;++U)K+=(0==U?"":", ")+p(O,M,U,P[U]);I="WebGL error "+y(I)+" in "+O+"("+K+")";window.console&&window.console.error?window.console.error(I):window.console&&window.console.log&&window.console.log(I)};var D={},F={},G;for(G in v)if("function"==typeof v[G])if("getExtension"!=G)F[G]=C(v,G);else{var J=C(v,G);F[G]=function(){var I=J.apply(v,arguments);return m(I,B,A,E)}}else h(F,v,G);F.getError=function(){for(var I in D)if(D.hasOwnProperty(I)&&D[I])return D[I]=!1,I;return v.NO_ERROR};
return F}function u(v){var B=v.getParameter(v.MAX_VERTEX_ATTRIBS),A=v.createBuffer();v.bindBuffer(v.ARRAY_BUFFER,A);for(var E=0;E<B;++E)v.disableVertexAttribArray(E),v.vertexAttribPointer(E,4,v.FLOAT,!1,0,0),v.vertexAttrib1f(E,0);v.deleteBuffer(A);B=v.getParameter(v.MAX_TEXTURE_IMAGE_UNITS);for(E=0;E<B;++E)v.activeTexture(v.TEXTURE0+E),v.bindTexture(v.TEXTURE_CUBE_MAP,null),v.bindTexture(v.TEXTURE_2D,null);v.activeTexture(v.TEXTURE0);v.useProgram(null);v.bindBuffer(v.ARRAY_BUFFER,null);v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,
null);v.bindFramebuffer(v.FRAMEBUFFER,null);v.bindRenderbuffer(v.RENDERBUFFER,null);v.disable(v.BLEND);v.disable(v.CULL_FACE);v.disable(v.DEPTH_TEST);v.disable(v.DITHER);v.disable(v.SCISSOR_TEST);v.blendColor(0,0,0,0);v.blendEquation(v.FUNC_ADD);v.blendFunc(v.ONE,v.ZERO);v.clearColor(0,0,0,0);v.clearDepth(1);v.clearStencil(-1);v.colorMask(!0,!0,!0,!0);v.cullFace(v.BACK);v.depthFunc(v.LESS);v.depthMask(!0);v.depthRange(0,1);v.frontFace(v.CCW);v.hint(v.GENERATE_MIPMAP_HINT,v.DONT_CARE);v.lineWidth(1);
v.pixelStorei(v.PACK_ALIGNMENT,4);v.pixelStorei(v.UNPACK_ALIGNMENT,4);v.pixelStorei(v.UNPACK_FLIP_Y_WEBGL,!1);v.pixelStorei(v.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);v.UNPACK_COLORSPACE_CONVERSION_WEBGL&&v.pixelStorei(v.UNPACK_COLORSPACE_CONVERSION_WEBGL,v.BROWSER_DEFAULT_WEBGL);v.polygonOffset(0,0);v.sampleCoverage(1,!1);v.scissor(0,0,v.canvas.width,v.canvas.height);v.stencilFunc(v.ALWAYS,0,4294967295);v.stencilMask(4294967295);v.stencilOp(v.KEEP,v.KEEP,v.KEEP);v.viewport(0,0,v.canvas.width,v.canvas.height);
for(v.clear(v.COLOR_BUFFER_BIT|v.DEPTH_BUFFER_BIT|v.STENCIL_BUFFER_BIT);v.getError(););}var t={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},
texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},
bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,
1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},q=null,z=null;return{init:k,mightBeEnum:function(v){r();return void 0!==q[v]},glEnumToString:y,glFunctionArgToString:p,glFunctionArgsToString:function(v,B){for(var A="",E=B.length,
C=0;C<E;++C)A+=(0==C?"":", ")+p(v,E,C,B[C]);return A},makeDebugContext:m,makeLostContextSimulatingCanvas:function(v){function B(S){return"function"==typeof S?S:function(H){S.handleEvent(H)}}function A(){for(var S=Object.keys(T),H=0;H<S.length;++H)delete T[S]}function E(){++R;K||U==R&&v.loseContext()}function C(S,H){var Q=S[H];return function(){E();if(!K)return Q.apply(S,arguments)}}function D(S){return{statusMessage:S,preventDefault:function(){L=!0}}}function F(S){for(var H in S)"function"==typeof S[H]?
O[H]=C(S,H):h(O,S,H);O.getError=function(){E();if(!K)for(var V;V=G.getError();)T[V]=!0;for(V in T)if(T[V])return delete T[V],V;return O.NO_ERROR};var Q="createBuffer createFramebuffer createProgram createRenderbuffer createShader createTexture".split(" ");for(H=0;H<Q.length;++H){var W=Q[H];O[W]=function(V){return function(){E();if(K)return null;var Y=V.apply(S,arguments);Y.__webglDebugContextLostId__=P;M.push(Y);return Y}}(S[W])}Q="getActiveAttrib getActiveUniform getBufferParameter getContextAttributes getAttachedShaders getFramebufferAttachmentParameter getParameter getProgramParameter getProgramInfoLog getRenderbufferParameter getShaderParameter getShaderInfoLog getShaderSource getTexParameter getUniform getUniformLocation getVertexAttrib".split(" ");
for(H=0;H<Q.length;++H)W=Q[H],O[W]=function(V){return function(){E();return K?null:V.apply(S,arguments)}}(O[W]);Q="isBuffer isEnabled isFramebuffer isProgram isRenderbuffer isShader isTexture".split(" ");for(H=0;H<Q.length;++H)W=Q[H],O[W]=function(V){return function(){E();return K?!1:V.apply(S,arguments)}}(O[W]);O.checkFramebufferStatus=function(V){return function(){E();return K?O.FRAMEBUFFER_UNSUPPORTED:V.apply(S,arguments)}}(O.checkFramebufferStatus);O.getAttribLocation=function(V){return function(){E();
return K?-1:V.apply(S,arguments)}}(O.getAttribLocation);O.getVertexAttribOffset=function(V){return function(){E();return K?0:V.apply(S,arguments)}}(O.getVertexAttribOffset);O.isContextLost=function(){return K};return O}var G,J=[],I=[];var O={};var P=1,K=!1,M=[],U=0,R=0,L=!1,N=0,T={};v.getContext=function(S){return function(){var H=S.apply(v,arguments);if(H instanceof WebGLRenderingContext){if(H!=G){if(G)throw"got different context";G=H;O=F(G)}return O}return H}}(v.getContext);(function(S){var H=S.addEventListener;
S.addEventListener=function(Q,W,V){switch(Q){case "webglcontextlost":J.push(B(W));break;case "webglcontextrestored":I.push(B(W));break;default:H.apply(S,arguments)}}})(v);v.loseContext=function(){if(!K){K=!0;U=0;for(++P;G.getError(););A();T[G.CONTEXT_LOST_WEBGL]=!0;var S=D("context lost"),H=J.slice();setTimeout(function(){for(var Q=0;Q<H.length;++Q)H[Q](S);0<=N&&setTimeout(function(){v.restoreContext()},N)},0)}};v.restoreContext=function(){K&&I.length&&setTimeout(function(){if(!L)throw"can not restore. webglcontestlost listener did not call event.preventDefault";
for(var S=0;S<M.length;++S){var H=M[S];H instanceof WebGLBuffer?G.deleteBuffer(H):H instanceof WebGLFramebuffer?G.deleteFramebuffer(H):H instanceof WebGLProgram?G.deleteProgram(H):H instanceof WebGLRenderbuffer?G.deleteRenderbuffer(H):H instanceof WebGLShader?G.deleteShader(H):H instanceof WebGLTexture&&G.deleteTexture(H)}u(G);K=!1;R=0;L=!1;S=I.slice();H=D("context restored");for(var Q=0;Q<S.length;++Q)S[Q](H)},0)};v.loseContextInNCalls=function(S){if(K)throw"You can not ask a lost contet to be lost";
U=R+S};v.getNumCalls=function(){return R};v.setRestoreTimeout=function(S){N=S};return v},resetToInitialState:u}})})(f);a.testFloatBufferBlend=function(e){var k,r,y;if(!e.gl)return!1;if(e.type===d.ContextType.WEBGL1){var p,h;return!(null==(p=e.capabilities.textureFloat)||!p.textureFloat||null==(h=e.capabilities.colorBufferFloat)||!h.textureFloat)}if(!((null==(k=e.capabilities.textureFloat)?0:k.textureFloat)&&(null==(r=e.capabilities.colorBufferFloat)?0:r.textureFloat)&&(null==(y=e.capabilities.colorBufferFloat)?
0:y.floatBlend)))return!1;k=new x.FramebufferObject(e,{colorTarget:g.TargetType.TEXTURE,depthStencilTarget:g.DepthStencilTargetType.NONE},{target:g.TextureType.TEXTURE_2D,wrapMode:g.TextureWrapMode.CLAMP_TO_EDGE,pixelFormat:g.PixelFormat.RGBA,dataType:g.PixelType.FLOAT,internalFormat:g.SizedPixelFormat.RGBA32F,samplingMode:g.TextureSamplingMode.NEAREST,width:1,height:1});r=c.BufferObject.createVertex(e,g.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1]));y=new l.VertexArrayObject(e,new Map([["a_pos",
0]]),{geometry:[new n.VertexElementDescriptor("a_pos",2,g.DataType.UNSIGNED_SHORT,0,4)]},{geometry:r});p=e.programCache.acquire("\n  precision highp float;\n  attribute vec2 a_pos;\n\n  void main() {\n    gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n  }\n  ","\n   precision highp float;\n\n   void main() {\n    gl_FragColor \x3d vec4(0.5, 0.5, 0.5, 0.5);\n   }\n  ",new Map([["a_pos",0]]));e.useProgram(p);h=e.getBoundFramebufferObject();const {x:m,y:u,width:t,height:q}=e.getViewport();e.bindFramebuffer(k);
e.setViewport(0,0,1,1);e.bindVAO(y);e.drawArrays(g.PrimitiveType.TRIANGLE_STRIP,0,4);var z=w.makePipelineState({blending:b.blendingAlpha});e.setPipelineState(z);e.drawArrays(g.PrimitiveType.TRIANGLE_STRIP,0,4);f.exports.init(e);z=e.gl.getError();e.setViewport(m,u,t,q);e.bindFramebuffer(h);p.dispose();y.dispose(!1);r.dispose();k.dispose();return 1282===z?(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1):!0};Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/webgl/testSamplerPrecision":function(){define("exports ../../core/Logger ./BufferObject ./enums ./FramebufferObject ./Texture ./VertexArrayObject ./VertexElementDescriptor".split(" "),function(a,b,c,d,g,x,w,l){const n=b.getLogger("esri.views.WebGLDriverTest");a.testSamplerPrecision=function(f){var e=new g.FramebufferObject(f,{colorTarget:d.TargetType.TEXTURE,depthStencilTarget:d.DepthStencilTargetType.NONE},{target:d.TextureType.TEXTURE_2D,wrapMode:d.TextureWrapMode.CLAMP_TO_EDGE,
pixelFormat:d.PixelFormat.RGBA,dataType:d.PixelType.UNSIGNED_BYTE,samplingMode:d.TextureSamplingMode.NEAREST,width:1,height:1});const k=new Uint8Array(4),r=c.BufferObject.createVertex(f,d.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),y=new w.VertexArrayObject(f,new Map([["a_position",0]]),{geometry:[new l.VertexElementDescriptor("a_position",2,d.DataType.SHORT,0,4)]},{geometry:r}),p=f.programCache.acquire("\nprecision highp float;\nattribute vec2 a_pos;\nuniform highp sampler2D u_texture;\nvarying vec4 v_color;\n\nfloat getBit(in float bitset, in int bitIndex) {\n  float offset \x3d pow(2.0, float(bitIndex));\n  return mod(floor(bitset / offset), 2.0);\n}\n\nvoid main() {\n  vec4 value \x3d texture2D(u_texture, vec2(0.0));\n  float bit \x3d getBit(value.x * 255.0, 1);\n\n  v_color \x3d bit * vec4(1.0);\n  gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n}\n",
"\nprecision highp float;\nvarying vec4 v_color;\n\nvoid main() {\n  gl_FragColor \x3d v_color;\n}\n",new Map([["a_pos",0]]));f.useProgram(p);var h=new x.Texture(f,{target:d.TextureType.TEXTURE_2D,wrapMode:d.TextureWrapMode.CLAMP_TO_EDGE,pixelFormat:d.PixelFormat.RGBA,dataType:d.PixelType.UNSIGNED_BYTE,samplingMode:d.TextureSamplingMode.NEAREST,width:1,height:1},new Uint8Array([2,255,0,0]));p.setUniform1i("u_texture",0);f.bindTexture(h,0);h=f.getBoundFramebufferObject();f.bindFramebuffer(e);f.useProgram(p);
const {x:m,y:u,width:t,height:q}=f.getViewport();f.setViewport(0,0,1,1);f.bindVAO(y);f.drawArrays(d.PrimitiveType.TRIANGLE_STRIP,0,4);f.setViewport(m,u,t,q);e.readPixels(0,0,1,1,d.PixelFormat.RGBA,d.PixelType.UNSIGNED_BYTE,k);p.dispose();y.dispose(!1);r.dispose();e.dispose();(e=255!==k[0]||255!==k[1]||255!==k[2]||255!==k[3])&&n.warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${k[0]}.${k[1]}.${k[2]}.${k[3]}]`);
f.bindFramebuffer(h);return e};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/testSVGPremultipliedAlpha":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../2d/engine/webgl/DefaultVertexAttributeLayouts ./BufferObject ./enums ./FramebufferObject ./Texture ./VertexArrayObject".split(" "),function(a,b,c,d,g,x,w,l){function n(){n=b._asyncToGenerator(function*(f){const e=new Image;e.src="data:image/svg+xml,%3C%3Fxml version\x3d'1.0' encoding\x3d'UTF-8'%3F%3E%3Csvg width\x3d'5' height\x3d'5' version\x3d'1.1' viewBox\x3d'0 0 5 5' xmlns\x3d'http://www.w3.org/2000/svg'%3E%3Crect width\x3d'5' height\x3d'5' fill\x3d'%23f00' fill-opacity\x3d'.5'/%3E%3C/svg%3E%0A";
e.width=5;e.height=5;yield e.decode();if(!f.gl)return!0;const k=new x.FramebufferObject(f,{colorTarget:g.TargetType.TEXTURE,depthStencilTarget:g.DepthStencilTargetType.NONE},{target:g.TextureType.TEXTURE_2D,wrapMode:g.TextureWrapMode.CLAMP_TO_EDGE,pixelFormat:g.PixelFormat.RGBA,dataType:g.PixelType.UNSIGNED_BYTE,samplingMode:g.TextureSamplingMode.NEAREST,width:1,height:1}),r=d.BufferObject.createVertex(f,g.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),y=new l.VertexArrayObject(f,new Map([["a_pos",
0]]),c.Pos2us,{geometry:r}),p=f.programCache.acquire("\n  precision highp float;\n\n  attribute vec2 a_pos;\n  varying vec2 v_uv;\n\n  void main() {\n    v_uv \x3d a_pos;\n    gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n  }\n  ","\n  precision highp float;\n\n  varying vec2 v_uv;\n  uniform sampler2D u_texture;\n\n  void main() {\n    gl_FragColor \x3d texture2D(u_texture, v_uv);\n  }\n  ",new Map([["a_pos",0]]));f.useProgram(p);const h=new w.Texture(f,{dataType:g.PixelType.UNSIGNED_BYTE,
pixelFormat:g.PixelFormat.RGBA,preMultiplyAlpha:!1,wrapMode:g.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:g.TextureSamplingMode.LINEAR},e);f.bindTexture(h,0);p.setUniform1i("u_texture",0);const m=f.getBoundFramebufferObject(),{x:u,y:t,width:q,height:z}=f.getViewport();f.bindFramebuffer(k);f.setViewport(0,0,1,1);f.setClearColor(0,0,0,0);f.setBlendingEnabled(!1);f.clearSafe(g.ClearBufferBit.COLOR_BUFFER_BIT);f.bindVAO(y);f.drawArrays(g.PrimitiveType.TRIANGLE_STRIP,0,4);const v=new Uint8Array(4);k.readPixels(0,
0,1,1,g.PixelFormat.RGBA,g.PixelType.UNSIGNED_BYTE,v);p.dispose();y.dispose(!1);r.dispose();k.dispose();h.dispose();f.setViewport(u,t,q,z);f.bindFramebuffer(m);e.src="";return 255===v[0]});return n.apply(this,arguments)}a.testSVGPremultipliedAlpha=function(f){return n.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/webgl/DefaultVertexAttributeLayouts":function(){define(["exports","../../../webgl/enums","../../../webgl/VertexElementDescriptor"],function(a,
b,c){const d={geometry:[new c.VertexElementDescriptor("a_pos",2,b.DataType.BYTE,0,2)]},g={geometry:[new c.VertexElementDescriptor("a_pos",2,b.DataType.BYTE,0,4),new c.VertexElementDescriptor("a_tex",2,b.DataType.BYTE,2,4)]};b={geometry:[new c.VertexElementDescriptor("a_pos",2,b.DataType.UNSIGNED_SHORT,0,4)]};a.Pos2b=d;a.Pos2us=b;a.PosTex2b=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/capabilities/Capabilities":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ./DisjointTimerQuery ./DrawBuffers ./Instancing ./load ./LoseContext ./VertexArrayObjects".split(" "),
function(a,b,c,d,g,x,w,l){let n=function(){function f(e,k){this.gl=e;this._fragDepth=this._shaderTextureLOD=this._standardDerivatives=this._depthTexture=null;this._disabledExtensions=k.disabledExtensions||{};this._debugWebGLExtensions=k.debugWebGLExtensions||{}}f.prototype.enable=function(e){return this[e]};b._createClass(f,[{key:"drawBuffers",get:function(){this._drawBuffers||(this._drawBuffers=d.load(this.gl,this._disabledExtensions));return this._drawBuffers}},{key:"instancing",get:function(){this._instancing||
(this._instancing=g.load(this.gl));return this._instancing}},{key:"vao",get:function(){this._vertexArrayObject||(this._vertexArrayObject=l.load(this.gl,this._disabledExtensions));return this._vertexArrayObject}},{key:"compressedTextureETC",get:function(){this._compressedTextureETC||(this._compressedTextureETC=x.loadCompressedTextureETC(this.gl,this._disabledExtensions));return this._compressedTextureETC}},{key:"compressedTextureS3TC",get:function(){this._compressedTextureS3TC||(this._compressedTextureS3TC=
x.loadCompressedTextureS3TC(this.gl,this._disabledExtensions));return this._compressedTextureS3TC}},{key:"textureFilterAnisotropic",get:function(){this._textureFilterAnisotropic||(this._textureFilterAnisotropic=x.loadTextureFilterAnisotropicCapability(this.gl,this._disabledExtensions));return this._textureFilterAnisotropic}},{key:"disjointTimerQuery",get:function(){this._disjointTimerQuery||(this._disjointTimerQuery=c.createDisjointTimerQuery(this.gl,this._disabledExtensions));return this._disjointTimerQuery}},
{key:"textureFloat",get:function(){this._textureFloat||(this._textureFloat=x.loadTextureFloat(this.gl,this._disabledExtensions));return this._textureFloat}},{key:"colorBufferFloat",get:function(){this._colorBufferFloat||(this._colorBufferFloat=x.loadColorBufferFloat(this.gl,this._disabledExtensions));return this._colorBufferFloat}},{key:"blendMinMax",get:function(){this._minMaxBlending||(this._minMaxBlending=x.loadMinMaxBlending(this.gl,this._disabledExtensions));return this._minMaxBlending}},{key:"depthTexture",
get:function(){null===this._depthTexture&&(this._depthTexture=x.loadBooleanExtension(this.gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]));return this._depthTexture}},{key:"standardDerivatives",get:function(){null===this._standardDerivatives&&(this._standardDerivatives=x.loadBooleanExtension(this.gl,this._disabledExtensions,"standardDerivatives",!0,["OES_standard_derivatives"]));return this._standardDerivatives}},{key:"shaderTextureLOD",
get:function(){null===this._shaderTextureLOD&&(this._shaderTextureLOD=x.loadBooleanExtension(this.gl,this._disabledExtensions,"shaderTextureLOD",!0,["EXT_shader_texture_lod"]));return this._shaderTextureLOD}},{key:"fragDepth",get:function(){null===this._fragDepth&&(this._fragDepth=x.loadBooleanExtension(this.gl,this._disabledExtensions,"fragDepth",!0,["EXT_frag_depth"]));return this._fragDepth}},{key:"loseContext",get:function(){this._loseContext||(this._loseContext=w.load(this.gl,this._debugWebGLExtensions));
return this._loseContext}},{key:"textureNorm16",get:function(){this._textureNorm16||(this._textureNorm16=x.loadTextureNorm16(this.gl,this._disabledExtensions));return this._textureNorm16}}]);return f}();a.Capabilities=n;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/capabilities/DisjointTimerQuery":function(){define(["exports","./isWebGL2Context"],function(a,b){let c=function(d,g,x,w,l,n,f,e){this.createQuery=d;this.resultAvailable=g;this.getResult=x;this.disjoint=w;this.beginTimeElapsed=
l;this.endTimeElapsed=n;this.createTimestamp=f;this.timestampBits=e};a.DisjointTimerQuery=c;a.createDisjointTimerQuery=function(d,g){if(g.disjointTimerQuery)return null;let x=d.getExtension("EXT_disjoint_timer_query_webgl2");return x&&b(d)?new c(()=>d.createQuery(),w=>d.getQueryParameter(w,d.QUERY_RESULT_AVAILABLE),w=>d.getQueryParameter(w,d.QUERY_RESULT),()=>d.getParameter(x.GPU_DISJOINT_EXT),w=>d.beginQuery(x.TIME_ELAPSED_EXT,w),()=>d.endQuery(x.TIME_ELAPSED_EXT),w=>x.queryCounterEXT(w,x.TIMESTAMP_EXT),
()=>d.getQuery(x.TIMESTAMP_EXT,x.QUERY_COUNTER_BITS_EXT)):(x=d.getExtension("EXT_disjoint_timer_query"))?new c(()=>x.createQueryEXT(),w=>x.getQueryObjectEXT(w,x.QUERY_RESULT_AVAILABLE_EXT),w=>x.getQueryObjectEXT(w,x.QUERY_RESULT_EXT),()=>d.getParameter(x.GPU_DISJOINT_EXT),w=>x.beginQueryEXT(x.TIME_ELAPSED_EXT,w),()=>x.endQueryEXT(x.TIME_ELAPSED_EXT),w=>x.queryCounterEXT(w,x.TIMESTAMP_EXT),()=>x.getQueryEXT(x.TIMESTAMP_EXT,x.QUERY_COUNTER_BITS_EXT)):null};Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/webgl/capabilities/DrawBuffers":function(){define(["exports","./isWebGL2Context"],function(a,b){a.load=function(c,d){return d.disjointTimerQuery?null:b(c)?{drawBuffers:c.drawBuffers.bind(c),MAX_DRAW_BUFFERS:c.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:c.MAX_COLOR_ATTACHMENTS}:d.drawBuffers?null:(c=c.getExtension("WEBGL_draw_buffers"))?{drawBuffers:c.drawBuffersWEBGL.bind(c),MAX_DRAW_BUFFERS:c.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:c.MAX_COLOR_ATTACHMENTS_WEBGL}:null};Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/webgl/capabilities/Instancing":function(){define(["exports","./isWebGL2Context"],function(a,b){a.load=function(c){return b(c)?{drawArraysInstanced:c.drawArraysInstanced.bind(c),drawElementsInstanced:c.drawElementsInstanced.bind(c),vertexAttribDivisor:c.vertexAttribDivisor.bind(c)}:(c=c.getExtension("ANGLE_instanced_arrays"))?{drawArraysInstanced:c.drawArraysInstancedANGLE.bind(c),drawElementsInstanced:c.drawElementsInstancedANGLE.bind(c),vertexAttribDivisor:c.vertexAttribDivisorANGLE.bind(c)}:
null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/capabilities/load":function(){define(["exports","./isWebGL2Context"],function(a,b){a.loadBooleanExtension=function(c,d,g,x,w){if(x&&b(c))return!0;if(d[g])return!1;for(const l of w)if(c.getExtension(l))return!0;return!1};a.loadColorBufferFloat=function(c,d){if(b(c)){var g=!d.colorBufferFloat&&c.getExtension("EXT_color_buffer_half_float"),x=!d.colorBufferFloat&&c.getExtension("EXT_color_buffer_float");d=!d.floatBlend&&!d.colorBufferFloat&&
c.getExtension("EXT_float_blend");return g||x||d?{textureFloat:!!x,textureHalfFloat:!!g,floatBlend:!!d,R16F:c.R16F,RG16F:c.RG16F,RGBA16F:c.RGBA16F,R32F:c.R32F,RG32F:c.RG32F,RGBA32F:c.RGBA32F,R11F_G11F_B10F:c.R11F_G11F_B10F,RGB16F:c.RGB16F}:null}return c instanceof WebGLRenderingContext?(g=!d.colorBufferFloat&&c.getExtension("EXT_color_buffer_half_float"),x=!d.colorBufferFloat&&c.getExtension("WEBGL_color_buffer_float"),c=!d.floatBlend&&!d.colorBufferFloat&&c.getExtension("EXT_float_blend"),g||x||
c?{textureFloat:!!x,textureHalfFloat:!!g,floatBlend:!!c,RGBA16F:g?g.RGBA16F_EXT:void 0,RGB16F:g?g.RGB16F_EXT:void 0,RGBA32F:x?x.RGBA32F_EXT:void 0}:null):null};a.loadCompressedTextureETC=function(c,d){return d.compressedTextureETC?null:(c=c.getExtension("WEBGL_compressed_texture_etc"))?{COMPRESSED_R11_EAC:c.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:c.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:c.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:c.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:c.COMPRESSED_RGB8_ETC2,
COMPRESSED_SRGB8_ETC2:c.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:c.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:c.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:c.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:c.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null};a.loadCompressedTextureS3TC=function(c,d){return d.compressedTextureS3TC?null:(c=c.getExtension("WEBGL_compressed_texture_s3tc"))?{COMPRESSED_RGB_S3TC_DXT1:c.COMPRESSED_RGB_S3TC_DXT1_EXT,
COMPRESSED_RGBA_S3TC_DXT1:c.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:c.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:c.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null};a.loadMinMaxBlending=function(c,d){return b(c)?{MIN:c.MIN,MAX:c.MAX}:d.blendMinMax?null:(c=c.getExtension("EXT_blend_minmax"))?{MIN:c.MIN_EXT,MAX:c.MAX_EXT}:null};a.loadTextureFilterAnisotropicCapability=function(c,d){return d.textureFilterAnisotropic?null:(c=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||
c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"))?{MAX_TEXTURE_MAX_ANISOTROPY:c.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:c.TEXTURE_MAX_ANISOTROPY_EXT}:null};a.loadTextureFloat=function(c,d){if(b(c))return{textureFloat:!0,textureFloatLinear:!d.textureFloatLinear&&!!c.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!d.textureHalfFloatLinear&&!!c.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:c.HALF_FLOAT,R16F:c.R16F,RG16F:c.RG16F,RGBA16F:c.RGBA16F,
R32F:c.R32F,RG32F:c.RG32F,RGBA32F:c.RGBA32F,R11F_G11F_B10F:c.R11F_G11F_B10F,RGB16F:c.RGB16F};if(c instanceof WebGLRenderingContext){const g=!d.textureHalfFloat&&c.getExtension("OES_texture_half_float");return{textureFloat:!d.textureFloat&&!!c.getExtension("OES_texture_float"),textureFloatLinear:!d.textureFloatLinear&&!!c.getExtension("OES_texture_float_linear"),textureHalfFloat:!!g,textureHalfFloatLinear:!d.textureHalfFloatLinear&&!!c.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:g?g.HALF_FLOAT_OES:
void 0}}return null};a.loadTextureNorm16=function(c,d){return!b(c)||d.textureNorm16?null:(c=c.getExtension("EXT_texture_norm16"))?{R16:c.R16_EXT,RG16:c.RG16_EXT,RGB16:c.RGB16_EXT,RGBA16:c.RGBA16_EXT,R16_SNORM:c.R16_SNORM_EXT,RG16_SNORM:c.RG16_SNORM_EXT,RGB16_SNORM:c.RGB16_SNORM_EXT,RGBA16_SNORM:c.RGBA16_SNORM_EXT}:null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/capabilities/LoseContext":function(){define(["exports"],function(a){a.load=function(b,c){const d=c.loseContext&&
b.getExtension("WEBGL_lose_context");return d?{loseRenderingContext:()=>d.loseContext()}:null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/capabilities/VertexArrayObjects":function(){define(["exports","./isWebGL2Context"],function(a,b){a.load=function(c,d){return b(c)?{createVertexArray:c.createVertexArray.bind(c),deleteVertexArray:c.deleteVertexArray.bind(c),bindVertexArray:c.bindVertexArray.bind(c)}:d.vao?null:(c=c.getExtension("OES_vertex_array_object")||c.getExtension("MOZ_OES_vertex_array_object")||
c.getExtension("WEBKIT_OES_vertex_array_object"))?{createVertexArray:c.createVertexArrayOES.bind(c),deleteVertexArray:c.deleteVertexArrayOES.bind(c),bindVertexArray:c.bindVertexArrayOES.bind(c)}:null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextureRepository":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ./basicInterfaces ./ContentObjectType ./TextureTechnique ./Util ../../../support/Scheduler".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u){const t=x.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository");a.TextureRepository=function(z){function v(A,E,C){var D=z.call(this,{})||this;D._stage=A;D._techniqueRepository=E;D._rctx=C;D._textures=new Map;D._loadingCount=0;D._frameUpdates=new Map;D.events=new g;D._frameTask=A.resourceController.scheduler.registerTask(u.TaskPriority.TEXTURE_UNLOAD);return D}b._inheritsLoose(v,z);var B=v.prototype;B.normalizeCtorArgs=function(){return{}};B.dispose=
function(){this._frameTask.remove();this._stage.forEachOfType(p.ContentObjectType.Texture,A=>A.unload())};B.acquire=function(A){const E=this._textures.get(A);return E?(E.ref(),w.unwrapOr(E.loadingPromise,E)):this._createNewRef(A)};B.update=function(){let A=!1;this._frameUpdates.forEach(E=>{const C=E.texture.frameUpdate(this._rctx,this.textureTechnique,E.previousToken);0<=C&&C!==E.previousToken&&(E.previousToken=C,A=!0)});A&&this.events.emit("changed",y.RenderRequestType.BACKGROUND)};B._createNewRef=
function(A){const E=this._stage.getObject(A);if(w.isNone(E))return m.assert(void 0!==E),null;const C=E.events.on("unloaded",()=>{C.remove();this._onTextureUnloaded(A)}),D=new q(A,()=>{this._frameTask.schedule(()=>{D.isUnreferenced&&E.unload()})});this._textures.set(A,D);D.ref();if(w.isSome(E.glTexture))return this._updateGLTexture(D,E.glTexture),E.requiresFrameUpdates&&this._frameUpdates.set(A,{texture:E,previousToken:-1}),D;this._loadingCount++;D.loadingPromise=this._stage.schedule(()=>{const F=
E.load(this._rctx,()=>this.textureTechnique),G=I=>{this._loadingCount--;D.loadingPromise=null;this._updateGLTexture(D,I);E.requiresFrameUpdates&&this._frameUpdates.set(A,{texture:E,previousToken:-1});return D},J=I=>{this._loadingCount--;D.loadingPromise=null;l.isAbortError(I)||t.error(I);return null};return l.isPromiseLike(F)?F.then(G,J):G(F)});return D.loadingPromise};B._updateGLTexture=function(A,E){A.glTexture=E;this.events.emit("changed",y.RenderRequestType.UPDATE)};B._onTextureUnloaded=function(A){this._textures.delete(A);
this._frameUpdates.delete(A)};b._createClass(v,[{key:"updating",get:function(){return 0<this._loadingCount||this._frameTask.updating}},{key:"textureTechnique",get:function(){w.isNone(this._textureTechnique)&&(this._textureTechnique=this._techniqueRepository.acquire(h.TextureTechnique,new h.TextureTechniqueConfiguration));return this._textureTechnique}}]);return v}(d);c.__decorate([n.property()],a.TextureRepository.prototype,"_loadingCount",void 0);c.__decorate([n.property()],a.TextureRepository.prototype,
"_frameTask",void 0);c.__decorate([n.property()],a.TextureRepository.prototype,"updating",null);a.TextureRepository=c.__decorate([r.subclass("esri.views.3d.webgl-engine.lib.TextureRepository")],a.TextureRepository);let q=function(){function z(B,A){this.id=B;this._release=A;this._refCount=0}var v=z.prototype;v.ref=function(){++this._refCount};v.release=function(){--this._refCount;0<this._refCount||(0===this._refCount?this._release():(t.error("Cannot dereference texture that has no references!"),this._refCount=
0))};b._createClass(z,[{key:"isUnreferenced",get:function(){return 0===this._refCount}}]);return z}();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/internal/WaterTextureRepository":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../assets ../../../../../core/Accessor ../../../../../core/Logger ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../support/requestImageUtils ../../lib/basicInterfaces ../../../../webgl/enums ../../../../webgl/Texture".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p){const h=x.getLogger("esri.views.3d.webgl-engine.materials.internal.waterMaterialUtils");a.WaterTextureRepository=function(m){function u(){var q=m.apply(this,arguments)||this;q._data=[];q.loadingState=r.ResourceState.NOT_LOADED;return q}b._inheritsLoose(u,m);var t=u.prototype;t.dispose=function(){this.loadingState=r.ResourceState.NOT_LOADED;this._data.forEach(q=>q.dispose());this._data.length=0};t.loadTextures=function(q){const z=[d.getAssetUrl("esri/images/materials/water/normals.jpg"),
d.getAssetUrl("esri/images/materials/water/perturbation.jpg")];this.loadingState=r.ResourceState.LOADING;Promise.all(z.map(v=>k.requestImage(v))).then(v=>{v.forEach(B=>this._data.push(new p.Texture(q,{target:y.TextureType.TEXTURE_2D,pixelFormat:y.PixelFormat.RGBA,dataType:y.PixelType.UNSIGNED_BYTE,wrapMode:y.TextureWrapMode.REPEAT,samplingMode:y.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,maxAnisotropy:8,width:B.width,height:B.height},B)));this.loadingState=r.ResourceState.LOADED}).catch(v=>
{h.error("Failed to load textures for water material.",v);this.loadingState=r.ResourceState.NOT_LOADED})};t.bind=function(q){this.ready&&(q.bindTexture(this._data[0],"texWaveNormal"),q.bindTexture(this._data[1],"texWavePerturbation"))};b._createClass(u,[{key:"updating",get:function(){return this.loadingState===r.ResourceState.LOADING}},{key:"ready",get:function(){return this.loadingState===r.ResourceState.LOADED}}]);return u}(g);c.__decorate([w.property()],a.WaterTextureRepository.prototype,"loadingState",
void 0);c.__decorate([w.property({type:Boolean,readOnly:!0})],a.WaterTextureRepository.prototype,"updating",null);a.WaterTextureRepository=c.__decorate([e.subclass("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],a.WaterTextureRepository);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/parts/ScreenshotManager":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/promiseUtils ../../../../chunks/vec4f64 ../lib/AutoDisposable ../lib/basicInterfaces ../../../support/screenshotUtils ../../../webgl/enums ../../../webgl/FramebufferObject".split(" "),
function(a,b,c,d,g,x,w,l,n,f){x=function(e){function k(y,p,h,m,u,t){var q=e.call(this)||this;q._rctx=y;q._renderScene=p;q._requestRenderScene=h;q._renderOverlay=m;q._forceCameraHook=u;q._disposeOffscreenBuffers=t;q.supersample=!0;q._screenshotQueue=[];return q}b._inheritsLoose(k,e);var r=k.prototype;r.dispose=function(){this._rctx=null};r.takeScreenshot=function(y){this._requestRenderScene(w.RenderRequestType.BACKGROUND);const p=d.createResolver();this._screenshotQueue.push({settings:y,resolver:p});
return p.promise};r.update=function(y){for(const h of this._screenshotQueue){if(this.isDisposed){h.resolver.reject();continue}var p={...h.settings,pixelRatio:h.settings.pixelRatio*y.viewCamera.pixelRatio};const m=this._ensureScreenshotEncodeCanvas(),u=this._renderScreenshot(y,p);p=l.encodeResult(u,p,m,{flipY:!0,premultipliedAlpha:!0});h.resolver(p)}this._screenshotQueue.length=0};r._renderScreenshotOverlay=function(y,p,h){if(c.isNone(this._renderOverlay))return p;y.width=p.width;y.height=p.height;
const m=y.getContext("2d"),u=h.pixelRatio;m.save();m.translate(0,p.height);m.scale(1,-1);h.region&&m.translate(-h.region.x,-h.region.y);m.scale(u,u);p=this._renderOverlay(y,p);m.restore();return p};r._readbackScreenshot=function(y,p){return y.resample?this._readbackScreenshotResampled(y,p):this._readbackScreenshotImmediate(y,p)};r._readbackScreenshotResampled=function(y,p){const {framebufferWidth:h,framebufferHeight:m,region:u,resample:t}=y,q=this._ensureScreenshotEncodeCanvas();let z=l.createEmptyImageData(h,
m,q);this._rctx.gl.readPixels(0,0,h,m,n.PixelFormat.RGBA,n.DataType.UNSIGNED_BYTE,new Uint8Array(z.data.buffer));p();z=this._renderScreenshotOverlay(q,z,{...y,region:null});y=l.createEmptyImageData(u.width,u.height,q);return l.resampleHermite(z,y,!0,t.region.x,m-(t.region.y+t.region.height),t.region.width,t.region.height)};r._readbackScreenshotImmediate=function(y,p){const {framebufferHeight:h,region:m}=y,u=this._ensureScreenshotEncodeCanvas(),t=l.createEmptyImageData(m.width,m.height,u);this._rctx.gl.readPixels(m.x,
h-(m.y+m.height),m.width,m.height,n.PixelFormat.RGBA,n.DataType.UNSIGNED_BYTE,new Uint8Array(t.data.buffer));p();return this._renderScreenshotOverlay(u,t,y)};r._renderScreenshot=function(y,p){let h=null;const m=y.viewCamera,{framebufferWidth:u,framebufferHeight:t}=p;var q=!1;y=p.disableDecorations&&y.frameHasDecorations;var z=p.ignorePadding&&m.pixelRatio!==p.pixelRatio;if(y=u!==m.fullWidth||t!==m.fullHeight||y||z){z=m.clone();if(p.ignorePadding){q=g.clone(z.padding);for(var v=0;4>v;v++)q[v]=Math.round(q[v]/
z.pixelRatio*p.pixelRatio);z.padding=q}z.fullWidth=u;z.fullHeight=t;z.pixelRatio=p.pixelRatio;q=m.fovX-z.fovX;v=m.fovY-z.fovY;0>q&&q<v?z.fovX=m.fovX:0>v&&v<q&&(z.fovY=m.fovY);this._forceCameraHook(z);q=!0;h=new f.FramebufferObject(this._rctx,{width:z.fullWidth,height:z.fullHeight,colorTarget:n.TargetType.TEXTURE,depthStencilTarget:n.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER});this._renderScene(h,z,p.disableDecorations?w.Decorations.OFF:w.Decorations.ON);this._disposeOffscreenBuffers()}z=
()=>{this._rctx.bindFramebuffer(null);c.disposeMaybe(h)};p=this._readbackScreenshot(p,z);z();if(y&&!this._rctx.contextAttributes.alpha)for(y=3;y<p.data.length;y+=4)p.data[y]=255;q&&this._forceCameraHook(m);return p};r._ensureScreenshotEncodeCanvas=function(){this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas"));return this._screenshotEncodeCanvas};return k}(x.AutoDisposable);a.ScreenshotManager=x;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/intersectorUtilsConversions":function(){define("exports ../../../../core/maybe ../../layers/i3s/Intersector ../../terrain/Intersector ./intersectorUtils ./lodRendering/Intersector".split(" "),
function(a,b,c,d,g,x){function w(f,e){if(b.isNone(f)||b.isNone(f.graphicUid))return null;const k=n(f,e);return b.isNone(k)?null:k===e.graphics?b.isSome(e.graphicsView)?e.graphicsView.getGraphicFromGraphicUid(f.graphicUid):null:(e=e.allLayerViews.find(r=>r.layer===k))&&!e.suspended&&"getGraphicFromGraphicUid"in e&&b.isSome(f.graphicUid)?e.getGraphicFromGraphicUid(f.graphicUid):null}function l(f,e){const k=n(f,e);return b.isNone(k)?null:(e=e.allLayerViews.find(r=>r.layer===k))&&!e.suspended&&"getGraphicFromIntersectorTarget"in
e?e.getGraphicFromIntersectorTarget(f):null}function n(f,e){return b.isNone(f.layerUid)?null:b.isSome(e.graphicsView)&&f.layerUid===e.graphicsView.processor.layer.id?e.graphics:e.map.findLayerByUid(f.layerUid)}a.toGraphic=function(f,e){return g.isObjectIntersectorResult(f)||g.isHudIntersectorResult(f)?w(f.target.object.metadata,e):c.isPclIntersectorResult(f)?f.target.createGraphic():d.isOverlayIntersectorResult(f)||x.isLodIntersectorResult(f)?w(f.target,e):c.isI3sIntersectorResult(f)?l(f.target,e):
null};a.toOwner=function(f,e){if(g.isObjectIntersectorResult(f)||g.isHudIntersectorResult(f))return n(f.target.object.metadata,e);if(d.isTerrainIntersectorResult(f)){var k;return null==(k=e.map)?void 0:k.ground}return c.isPclIntersectorResult(f)||c.isI3sIntersectorResult(f)||d.isOverlayIntersectorResult(f)?n(f.target,e):null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/Intersector":function(){define(["exports","../../webgl-engine/lib/IntersectorInterfaces","../../webgl-engine/lib/intersectorUtils"],
function(a,b,c){a.isI3sIntersectorResult=function(d){return c.isValidIntersectorResult(d)&&d.intersector===b.IntersectorType.I3S&&!!d.target};a.isPclIntersectorResult=function(d){return c.isValidIntersectorResult(d)&&d.intersector===b.IntersectorType.PCL&&!!d.target};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/Intersector":function(){define(["exports","../webgl-engine/lib/IntersectorInterfaces","../webgl-engine/lib/intersectorUtils"],function(a,b,c){a.isOverlayIntersectorResult=
function(d){return c.isValidIntersectorResult(d)&&d.intersector===b.IntersectorType.OVERLAY&&!!d.target};a.isTerrainIntersectorResult=function(d){return c.isValidIntersectorResult(d)&&d.intersector===b.IntersectorType.TERRAIN&&!!d.target};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/Intersector":function(){define(["exports","../IntersectorInterfaces","../intersectorUtils"],function(a,b,c){a.isLodIntersectorResult=function(d){return c.isValidIntersectorResult(d)&&
d.intersector===b.IntersectorType.LOD&&!!d.target};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/support/hitTestSelectUtils":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(a,b){function c(){c=b._asyncToGenerator(function*(d,g){if("2d"===d.type)return d.hitTest(g);d=yield d.hitTest(g);const x=d.results[0];g=d.results.findIndex(w=>w.distance!==x.distance);-1!==g&&(d.results=d.results.slice(0,g));return d});return c.apply(this,arguments)}a.hitTestSelectSameDistance=
function(d,g){return c.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/support/WebGLRequirements":function(){define(["exports","../../core/Error","../webgl/capabilities","../webgl/context-util"],function(a,b,c,d){a.check=function(g){var x;a:{for(x=d.getContextTypes(g);1<x.length;){const w=c.getWebGLCapabilities(x.shift());if(w.available){x=w;break a}}x=c.getWebGLCapabilities(x.shift())}if(!x.available)return new b("webgl:required","WebGL is required but not supported.");
if("3d"===g&&x.majorPerformanceCaveat)return new b("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!x.supportsHighPrecisionFragment)return new b("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported.");if(!x.supportsVertexShaderSamplers)return new b("webgl:vertex-shader-samplers-required",
"WebGL support for vertex shader samplers is required but not supported.");if(x.type===d.ContextType.WEBGL1){if(!x.supportsElementIndexUint)return new b("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.");if(!x.supportsStandardDerivatives)return new b("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported.");if(!x.supportsInstancedArrays)return new b("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null};
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/capabilities":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/maybe","./context-util"],function(a,b,c,d){function g(){if(!l){{const r=new e,y=w(d.ContextType.WEBGL1,r);c.isNone(y)||(r.supportsElementIndexUint=null!==y.getExtension("OES_element_index_uint"),r.supportsStandardDerivatives=null!==y.getExtension("OES_standard_derivatives"),r.supportsInstancedArrays=null!==y.getExtension("ANGLE_instanced_arrays"),
r.supportsTextureFloat=null!==y.getExtension("OES_texture_float"));l=r}}return l}function x(){if(!n){{const r=new k,y=w(d.ContextType.WEBGL2,r);c.isNone(y);n=r}}return n}function w(r,y){const p=document.createElement("canvas");if(!p)return null;let h=d.createContext(p,r,{failIfMajorPerformanceCaveat:!0});c.isNone(h)&&(h=d.createContext(p,r),c.isSome(h)&&(y.majorPerformanceCaveat=!0));if(c.isNone(h))return h;if(r===d.ContextType.WEBGL1){if(r=h.getParameter(h.VERSION),r=null==r?void 0:r.match(/^WebGL\s+([\d.]*)/))r=
parseFloat(r[1]),y.available=.94<=r}else y.available=!0;y.maxTextureSize=h.getParameter(h.MAX_TEXTURE_SIZE);y.supportsVertexShaderSamplers=0<h.getParameter(h.MAX_VERTEX_TEXTURE_IMAGE_UNITS);if(r=h.getShaderPrecisionFormat(h.FRAGMENT_SHADER,h.HIGH_FLOAT))y.supportsHighPrecisionFragment=0<r.precision;return h}let l,n,f=function(){this.majorPerformanceCaveat=this.available=!1;this.maxTextureSize=0;this.supportsHighPrecisionFragment=this.supportsVertexShaderSamplers=!1},e=function(r){function y(){var p=
r.apply(this,arguments)||this;p.type=d.ContextType.WEBGL1;p.supportsElementIndexUint=!1;p.supportsStandardDerivatives=!1;p.supportsInstancedArrays=!1;p.supportsTextureFloat=!1;return p}b._inheritsLoose(y,r);return y}(f),k=function(r){function y(){var p=r.apply(this,arguments)||this;p.type=d.ContextType.WEBGL2;return p}b._inheritsLoose(y,r);return y}(f);a.WebGL1Capabilities=e;a.WebGL2Capabilities=k;a.getWebGL1Capabilities=g;a.getWebGL2Capabilities=x;a.getWebGLCapabilities=function(r){switch(r){case d.ContextType.WEBGL1:return g();
case d.ContextType.WEBGL2:return x()}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/ui/3d/DefaultUI3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../DefaultUI".split(" "),function(a,b,c,d,g,x,w,l){d=function(n){function f(e){e=n.call(this,e)||this;e.components=
["attribution","zoom","navigation-toggle","compass"];return e}a._inheritsLoose(f,n);return f}(l);b.__decorate([c.property()],d.prototype,"components",void 0);return d=b.__decorate([w.subclass("esri.views.ui.3d.DefaultUI3D")],d)})},"esri/views/ui/DefaultUI":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ./Component ./UI ../../widgets/Attribution ../../widgets/Compass ../../widgets/NavigationToggle ../../widgets/Zoom".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p){d.getLogger("esri.views.ui.DefaultUI");c=function(h){function m(t){t=h.call(this,t)||this;t._defaultPositionLookup={attribution:"manual",compass:"top-leading","navigation-toggle":"top-leading",zoom:"top-leading"};t.components=[];return t}a._inheritsLoose(m,h);var u=m.prototype;u.initialize=function(){this._handles.add([g.watch(()=>this.components,this._componentsWatcher.bind(this),g.initial),g.watch(()=>this.view,this._updateViewAwareWidgets.bind(this),g.initial)])};
u._add=function(t,q,z,v){if("string"===typeof t&&this._defaultPositionLookup[t]){if(this._find(t))return;t=this._createComponent(t)}h.prototype._add.call(this,t,q,z,v)};u._removeComponents=function(t){t.forEach(q=>{if(q=this._find(q))this.remove(q),q.destroy()})};u._updateViewAwareWidgets=function(t){this.components.forEach(q=>{(q=(q=this._find(q))&&q.widget)&&void 0!==q.view&&(q.view=t)})};u._componentsWatcher=function(t,q){this._removeComponents(q);this._addComponents(t);this._adjustPadding(t)};
u._adjustPadding=function(t){-1!==t.indexOf("attribution")||this._isOverridden("padding")||({top:t}=this.padding,this.padding=t)};u._addComponents=function(t){this.initialized&&t.forEach(q=>this.add(this._createComponent(q),this._defaultPositionLookup[q]))};u._createComponent=function(t){const q=this._createWidget(t);if(q)return new f({id:t,node:q})};u._createWidget=function(t){if("attribution"===t)return this._createAttribution();if("compass"===t)return this._createCompass();if("navigation-toggle"===
t)return this._createNavigationToggle();if("zoom"===t)return this._createZoom()};u._createAttribution=function(){return new k({view:this.view})};u._createCompass=function(){return new r({view:this.view})};u._createNavigationToggle=function(){return new y({view:this.view})};u._createZoom=function(){return new p({view:this.view})};return m}(e);b.__decorate([x.property()],c.prototype,"components",void 0);return c=b.__decorate([n.subclass("esri.views.ui.DefaultUI")],c)})},"esri/views/ui/Component":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/domUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,d,g,x,w,l,n){c=function(f){function e(){var r=f.apply(this,arguments)||this;r.widget=null;return r}a._inheritsLoose(e,f);var k=e.prototype;k.destroy=function(){this.widget&&this.widget.destroy();this.node=null};k.castNode=function(r){if(!r)return this._set("widget",null),null;if("string"===typeof r||r&&"nodeType"in r)return this._set("widget",null),d.byId(r);r&&"function"===typeof r.render&&!r.domNode&&(r.domNode=document.createElement("div"));this._set("widget",r);return r.domNode};
a._createClass(e,[{key:"id",get:function(){return this.get("widget.id")||this.get("node.id")}},{key:"node",set:function(r){const y=this._get("node");r!==y&&(r&&r.classList.add("esri-component"),y&&y.classList.remove("esri-component"),this._set("node",r))}}]);return e}(c);b.__decorate([g.property({dependsOn:[]})],c.prototype,"id",null);b.__decorate([g.property()],c.prototype,"node",null);b.__decorate([l.cast("node")],c.prototype,"castNode",null);b.__decorate([g.property({readOnly:!0})],c.prototype,
"widget",void 0);return c=b.__decorate([n.subclass("esri.views.ui.Component")],c)})},"esri/views/ui/UI":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/domUtils ../../core/Evented ../../core/Handles ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ./Component ../../widgets/support/widgetUtils ../../core/Logger ../../widgets/support/widgetThemeUtils".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p){function h(q){const z="object"===typeof q&&null!==q&&Object.getPrototypeOf(q);return null!==z&&z!==Object.prototype||!("component"in q||"index"in q||"position"in q)?null:q}function m(q,{top:z,bottom:v,left:B,right:A}){q.style.top=z;q.style.bottom=v;q.style.left=B;q.style.right=A}const u={left:0,top:0,bottom:0,right:0},t={bottom:30,top:15,right:15,left:15};d=function(q){function z(B){var A=q.call(this,B)||this;A._cornerNameToContainerLookup={};A._positionNameToContainerLookup=
{};A._components=[];A._componentToKey=new Map;A._handles=new g;A.view=null;A._applyViewPadding=()=>{const E=A.container;E&&m(E,A._toPxPosition(A._getViewPadding()))};A._applyUIPadding=()=>{const E=A._innerContainer;E&&m(E,A._toPxPosition(A.padding))};A._initContainers();return A}a._inheritsLoose(z,q);var v=z.prototype;v.initialize=function(){this._handles.add([x.watch(()=>{var B;return[null==(B=this.view)?void 0:B.padding,this.container]},this._applyViewPadding,x.initial),x.watch(()=>this.padding,
this._applyUIPadding,x.initial)])};v.destroy=function(){this.container=null;for(const B of this._components)B.destroy();this._components.length=0;this._handles.destroy();this._componentToKey.clear()};v.castPadding=function(B){return"number"===typeof B?{bottom:B,top:B,right:B,left:B}:{...t,...B}};v.add=function(B,A){let E,C;if(Array.isArray(B))B.forEach(F=>this.add(F,A));else{var D=h(B);D&&({index:E,position:A,component:B,key:C}=D);A&&"object"===typeof A&&({index:E,key:C,position:A}=A);!B||A&&!this._isValidPosition(A)||
this._add(B,A,E,C)}};v.remove=function(B,A){if(B){if(Array.isArray(B))return B.map(D=>this.remove(D,A));var E=this._find(B);if(E){var C=this._componentToKey;if(!C.has(B)||C.get(B)===A)return C=this._components.indexOf(E),E.node.parentNode&&E.node.parentNode.removeChild(E.node),this._componentToKey.delete(B),this._components.splice(C,1)[0]}}};v.empty=function(B){if(Array.isArray(B))return B.map(A=>this.empty(A)).reduce((A,E)=>A.concat(E));B=B||"manual";return"manual"===B?Array.prototype.slice.call(this._manualContainer.children).filter(A=>
!A.classList.contains("esri-ui-corner")).map(A=>this.remove(A)):this._isValidPosition(B)?Array.prototype.slice.call(this._cornerNameToContainerLookup[B].children).map(this.remove,this):null};v.move=function(B,A){Array.isArray(B)&&B.forEach(D=>this.move(D,A));if(B){var E=h(B)||h(A);if(E){var C=E.index;A=E.position;B=E.component||B}(!A||this._isValidPosition(A))&&(B=this.remove(B))&&this.add(B,{position:A,index:C})}};v.find=function(B){return B?(B=this._findById(B))&&(B.widget||B.node):null};v.getPosition=
function(B){for(const A in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[A].contains(B))return A;return null};v._add=function(B,A,E,C){B instanceof k||(B=new k({node:B}));this._place({component:B,position:A,index:E});this._components.push(B);C&&this._componentToKey.set(B,C)};v._find=function(B){return B?B instanceof k?this._findByComponent(B):"string"===typeof B?this._findById(B):this._findByNode(B.domNode||B):null};v._getViewPadding=function(){return this.get("view.padding")||
u};v._attachContainers=function(B){B.appendChild(this._innerContainer);B.appendChild(this._manualContainer)};v._initContainers=function(){var B=document.createElement("div");B.classList.add("esri-ui-inner-container");B.classList.add("esri-ui-corner-container");const A=document.createElement("div");A.classList.add("esri-ui-inner-container");A.classList.add("esri-ui-manual-container");const E=document.createElement("div");E.classList.add("esri-ui-top-left");E.classList.add("esri-ui-corner");B.appendChild(E);
const C=document.createElement("div");C.classList.add("esri-ui-top-right");C.classList.add("esri-ui-corner");B.appendChild(C);const D=document.createElement("div");D.classList.add("esri-ui-bottom-left");D.classList.add("esri-ui-corner");B.appendChild(D);const F=document.createElement("div");F.classList.add("esri-ui-bottom-right");F.classList.add("esri-ui-corner");B.appendChild(F);this._innerContainer=B;this._manualContainer=A;B=r.isRTL();this._cornerNameToContainerLookup={"top-left":E,"top-right":C,
"bottom-left":D,"bottom-right":F,"top-leading":B?C:E,"top-trailing":B?E:C,"bottom-leading":B?F:D,"bottom-trailing":B?D:F};this._positionNameToContainerLookup={manual:A,...this._cornerNameToContainerLookup}};v._isValidPosition=function(B){return!!this._positionNameToContainerLookup[B]};v._place=function(B){const A=B.component,E=B.index;B=this._positionNameToContainerLookup[B.position||"manual"];var C=-1<E,D=A.widget;D&&!D._started&&"function"===typeof D.postMixInProperties&&"function"===typeof D.buildRendering&&
"function"===typeof D.postCreate&&"function"===typeof D.startup&&A.widget.startup();C?(C=Array.prototype.slice.call(B.children),0===E?B.firstChild?c.insertBefore(A.node,B.firstChild):B.appendChild(A.node):E>=C.length?B.appendChild(A.node):c.insertBefore(A.node,C[E])):B.appendChild(A.node)};v._toPxPosition=function(B){return{top:this._toPxUnit(B.top),left:this._toPxUnit(B.left),right:this._toPxUnit(B.right),bottom:this._toPxUnit(B.bottom)}};v._toPxUnit=function(B){return 0===B?"0":B+"px"};v._findByComponent=
function(B){let A=null,E;this._components.some(C=>{(E=C===B)&&(A=C);return E});return A};v._findById=function(B){let A=null,E;this._components.some(C=>{(E=C.id===B)&&(A=C);return E});return A};v._findByNode=function(B){let A=null,E;this._components.some(C=>{(E=C.node===B)&&(A=C);return E});return A};a._createClass(z,[{key:"container",set:function(B){const A=this._get("container");B!==A&&(B&&(B.classList.add("esri-ui"),B.classList.add(p.getCalciteThemeClass()),this._attachContainers(B)),A&&(A.classList.remove("esri-ui"),
m(A,{top:"",bottom:"",left:"",right:""}),c.empty(A)),this._set("container",B))}},{key:"height",get:function(){const B=this.get("view.height")||0;if(0===B)return B;const A=this._getViewPadding();return Math.max(B-(A.top+A.bottom),0)}},{key:"padding",get:function(){return this._get("padding")},set:function(B){B?this._override("padding",B):this._clearOverride("padding")}},{key:"width",get:function(){const B=this.get("view.width")||0;if(0===B)return B;const A=this._getViewPadding();return Math.max(B-
(A.left+A.right),0)}}]);return z}(d.EventedAccessor);b.__decorate([w.property()],d.prototype,"container",null);b.__decorate([w.property()],d.prototype,"height",null);b.__decorate([w.property({value:t})],d.prototype,"padding",null);b.__decorate([f.cast("padding")],d.prototype,"castPadding",null);b.__decorate([w.property()],d.prototype,"view",void 0);b.__decorate([w.property()],d.prototype,"width",null);return d=b.__decorate([e.subclass("esri.views.ui.UI")],d)})},"esri/widgets/Attribution":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/watchUtils ../core/accessorSupport/decorators/aliasOf ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Widget ./Attribution/AttributionViewModel ./support/decorators/accessibleHandler ./support/decorators/messageBundle ../core/Logger ./support/jsxFactory ./support/widgetUtils".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h){g=function(m){function u(q,z){q=m.call(this,q,z)||this;q._isOpen=!1;q._attributionTextOverflowed=!1;q._prevSourceNodeHeight=0;q.iconClass="esri-icon-description";q.itemDelimiter=" | ";q.label=void 0;q.messages=null;q.view=null;q.viewModel=new e;return q}a._inheritsLoose(u,m);var t=u.prototype;t.initialize=function(){this.own(c.on(this,"viewModel.items","change",()=>this.scheduleRender()))};t.render=function(){return p.tsx("div",{bind:this,class:this.classes("esri-attribution esri-widget",
{["esri-attribution--open"]:this._isOpen}),onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())};t.renderPoweredBy=function(){return p.tsx("div",{class:"esri-attribution__powered-by"},"Powered by"," ",p.tsx("a",{class:"esri-attribution__link",href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))};t.renderSourcesNode=function(){const q=this._isOpen,z=this._isInteractive,v=z?0:-1,{attributionText:B}=this,A=z?"button":void 0;return p.tsx("div",
{afterCreate:this._afterSourcesNodeCreate,afterUpdate:this._afterSourcesNodeUpdate,bind:this,class:this.classes("esri-attribution__sources",{["esri-attribution__sources--open"]:q,["esri-interactive"]:z}),innerHTML:B,role:A,tabIndex:v})};t._afterSourcesNodeCreate=function(q){this._prevSourceNodeHeight=q.clientWidth};t._afterSourcesNodeUpdate=function(q){let z=!1;const {clientHeight:v,clientWidth:B,scrollWidth:A}=q;q=A>=B;const E=this._attributionTextOverflowed!==q;this._attributionTextOverflowed=q;
E&&(z=!0);this._isOpen&&(q=v<this._prevSourceNodeHeight,this._prevSourceNodeHeight=v,q&&(this._isOpen=!1,z=!0));z&&this.scheduleRender()};t._toggleState=function(){this._isInteractive&&(this._isOpen=!this._isOpen)};a._createClass(u,[{key:"_isInteractive",get:function(){return this._isOpen||this._attributionTextOverflowed}},{key:"attributionText",get:function(){return this.viewModel.items.reduce((q,z)=>{-1===q.indexOf(z.text)&&q.push(z.text);return q},[]).join(this.itemDelimiter)}}]);return u}(f);
b.__decorate([l.property()],g.prototype,"_isOpen",void 0);b.__decorate([l.property()],g.prototype,"_isInteractive",null);b.__decorate([l.property()],g.prototype,"_attributionTextOverflowed",void 0);b.__decorate([l.property()],g.prototype,"_prevSourceNodeHeight",void 0);b.__decorate([l.property({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],g.prototype,"attributionText",null);b.__decorate([l.property()],g.prototype,"iconClass",void 0);b.__decorate([l.property()],g.prototype,"itemDelimiter",
void 0);b.__decorate([l.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],g.prototype,"label",void 0);b.__decorate([l.property(),r.messageBundle("esri/widgets/Attribution/t9n/Attribution")],g.prototype,"messages",void 0);b.__decorate([d.aliasOf("viewModel.view")],g.prototype,"view",void 0);b.__decorate([l.property({type:e})],g.prototype,"viewModel",void 0);b.__decorate([k.accessibleHandler()],g.prototype,"_toggleState",null);return g=b.__decorate([n.subclass("esri.widgets.Attribution")],
g)})},"esri/widgets/Attribution/AttributionViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../core/asyncUtils ../../core/Collection ../../core/HandleOwner ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../geometry/support/contains ../../geometry/support/webMercatorUtils ../../geometry/SpatialReference".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p){function h(q,z){return q&&"copyright"in q&&(!z||"function"===typeof q.originOf&&"user"===q.originOf("copyright"))}function m(q,z){return q.length!==z.length||q.some((v,B)=>v.text!==z[B].text)}function u(q,z,v){v&&z&&(q.find(B=>B.layerView===z&&B.text===v)||q.push({text:v,layerView:z}))}const t=[];c=function(q){function z(B){var A=q.call(this,B)||this;A._clear=()=>{A._fetchedAttributionData.clear();A._pendingAttributions.clear();A.handles.remove("suspension");
A.notifyChange("state")};A._pendingAttributions=new Set;A._fetchedAttributionData=new Map;A.items=new g;A.view=null;A._allLayerViewsChange=E=>{A.handles.remove("suspension");const C=A.get("view.allLayerViews");C&&A.handles.add(C.map(D=>D.watch(["suspended","attributionVisible"],A._updateAttributionItems)),"suspension");E&&E.removed&&E.removed.forEach(D=>{A._pendingAttributions.delete(D);A._fetchedAttributionData.delete(D)});A._updateAttributionItems()};A._updateAttributionItems=()=>{const E=A.get("view.allLayerViews");
t.length=0;E?(E.forEach(C=>{if(!C.suspended&&C.get("layer.attributionVisible")){var D=C.layer;if(h(D,"user"))u(t,C,D.copyright);else if(D.hasAttributionData)if(A._fetchedAttributionData.has(C)){var F=A._fetchedAttributionData.get(C);F?u(t,C,A._getDynamicAttribution(F,A.view,D)):h(D)&&u(t,C,D.copyright)}else A._fetchAttributionData(C);else(F=D.get("portalItem.accessInformation"))?u(t,C,F):u(t,C,D.copyright)}}),m(A.items,t)&&(A.items.removeAll(),A.items.addMany(t)),t.length=0,A.notifyChange("state")):
A._clear()};A.handles.add([w.on(a._assertThisInitialized(A),"view.allLayerViews","change",A._allLayerViewsChange,A._allLayerViewsChange,A._clear),w.whenTrue(a._assertThisInitialized(A),"view.stationary",()=>A._updateAttributionItems())]);return A}a._inheritsLoose(z,q);var v=z.prototype;v.destroy=function(){this.view=null;this._fetchedAttributionData.clear();this._pendingAttributions.clear();this.items.removeAll()};v._fetchAttributionData=function(){var B=a._asyncToGenerator(function*(A){if(!this._pendingAttributions.has(A)){this._pendingAttributions.add(A);
var E=yield d.result(A.layer.fetchAttributionData());this._pendingAttributions.has(A)&&(E=E.ok?this._createContributionIndex(E.value,"bing-maps"===A.layer.type):null,this._pendingAttributions.delete(A),this._fetchedAttributionData.set(A,E));this._updateAttributionItems()}});return function(A){return B.apply(this,arguments)}}();v._createContributionIndex=function(B,A){B=B.contributors;const E={};if(!B)return E;for(let G=0;G<B.length;G++){const J=B[G];var C=J.coverageAreas;if(!C)return;for(const I of C){var D=
I.bbox,F=I.zoomMin-(A&&I.zoomMin?1:0);C=I.zoomMax-(A&&I.zoomMax?1:0);for(D={extent:y.geographicToWebMercator({xmin:D[1],ymin:D[0],xmax:D[3],ymax:D[2],spatialReference:p.WGS84}),attribution:J.attribution||"",score:null!=I.score?I.score:100,id:G};F<=C;F++)E[F]=E[F]||[],E[F].push(D)}}E.maxKey=Math.max.apply(null,Object.keys(E));return E};v._getDynamicAttribution=function(B,A,E){const {extent:C,scale:D}=A;E=E.tileInfo.scaleToZoom(D);E=Math.min(B.maxKey,Math.round(E));if(!C||null==E||-1>=E)return"";B=
B[E];const F=y.project(C.center.clone().normalize(),A.spatialReference),G={};return B?B.filter(J=>{const I=!G[J.id]&&F&&r.extentContainsPoint(J.extent,F);I&&(G[J.id]=!0);return I}).sort((J,I)=>I.score-J.score||J.objectId-I.objectId).map(J=>J.attribution).join(", "):""};a._createClass(z,[{key:"state",get:function(){return this.get("view.ready")?0<this._pendingAttributions.size?"loading":"ready":"disabled"}}]);return z}(x.HandleOwner);b.__decorate([l.property({readOnly:!0,type:g})],c.prototype,"items",
void 0);b.__decorate([l.property({readOnly:!0})],c.prototype,"state",null);b.__decorate([l.property()],c.prototype,"view",void 0);return c=b.__decorate([k.subclass("esri.widgets.Attribution.AttributionViewModel")],c)})},"esri/widgets/Compass":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/accessorSupport/decorators/aliasOf ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Widget ./Compass/CompassViewModel ./support/decorators/accessibleHandler ./support/decorators/messageBundle ../core/Logger ./support/jsxFactory ./support/widgetUtils".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p){d=function(h){function m(t,q){t=h.call(this,t,q)||this;t.goToOverride=null;t.iconClass="esri-icon-locate-circled";t.label=void 0;t.messages=null;t.view=null;t.viewModel=new f;return t}a._inheritsLoose(m,h);var u=m.prototype;u.reset=function(){return this.viewModel.reset()};u.render=function(){const {orientation:t,state:q}=this.viewModel;var z="disabled"===q,v="compass"===("rotation"===q?"rotation":"compass");const B=z?-1:0;z={["esri-disabled"]:z,["esri-interactive"]:!z};
v={["esri-icon-compass"]:v,["esri-icon-dial"]:!v};const {messages:A}=this;return y.tsx("div",{bind:this,class:this.classes("esri-compass esri-widget--button esri-widget",z),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:B,"aria-label":A.reset,title:A.reset},y.tsx("span",{"aria-hidden":"true",class:this.classes("esri-compass__icon",v),styles:this._toRotationTransform(t)}),y.tsx("span",{class:"esri-icon-font-fallback-text"},A.reset))};u._reset=function(){this.viewModel.reset()};u._toRotationTransform=
function(t){return{transform:`rotateZ(${t.z}deg)`}};return m}(n);b.__decorate([c.aliasOf("viewModel.goToOverride")],d.prototype,"goToOverride",void 0);b.__decorate([w.property()],d.prototype,"iconClass",void 0);b.__decorate([w.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],d.prototype,"label",void 0);b.__decorate([w.property(),k.messageBundle("esri/widgets/Compass/t9n/Compass")],d.prototype,"messages",void 0);b.__decorate([c.aliasOf("viewModel.view")],d.prototype,"view",void 0);
b.__decorate([w.property({type:f})],d.prototype,"viewModel",void 0);b.__decorate([e.accessibleHandler()],d.prototype,"_reset",null);return d=b.__decorate([l.subclass("esri.widgets.Compass")],d)})},"esri/widgets/Compass/CompassViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../support/GoTo".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e){c=function(k){function r(p){p=k.call(this,p)||this;p._handles=new d;p.orientation={x:0,y:0,z:0};p.view=null;p._updateForCamera=p._updateForCamera.bind(a._assertThisInitialized(p));p._updateForRotation=p._updateForRotation.bind(a._assertThisInitialized(p));p._updateRotationWatcher=p._updateRotationWatcher.bind(a._assertThisInitialized(p));return p}a._inheritsLoose(r,k);var y=r.prototype;y.initialize=function(){this._handles.add(g.init(this,"view",this._updateRotationWatcher))};
y.destroy=function(){this._handles.destroy();this.view=this._handles=null};y.reset=function(){if(this.get("view.ready")){var p={};"2d"===this.view.type?p.rotation=0:p.heading=0;this.callGoTo({target:p})}};y._updateForRotation=function(p){void 0!==p&&null!==p&&(this.orientation={z:p})};y._updateForCamera=function(p){p&&(this.orientation={x:0,y:0,z:-p.heading})};y._updateRotationWatcher=function(p){this._handles.removeAll();p&&("2d"===p.type?this._handles.add(g.init(this,"view.rotation",this._updateForRotation)):
this._handles.add(g.init(this,"view.camera",this._updateForCamera)))};a._createClass(r,[{key:"canShowNorth",get:function(){const p=this.get("view.spatialReference");return!(!p||!p.isWebMercator&&!p.isGeographic)}},{key:"state",get:function(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}}]);return r}(e.GoToMixin(c));b.__decorate([x.property({readOnly:!0})],c.prototype,"canShowNorth",null);b.__decorate([x.property()],c.prototype,"orientation",void 0);b.__decorate([x.property({readOnly:!0})],
c.prototype,"state",null);b.__decorate([x.property()],c.prototype,"view",void 0);return c=b.__decorate([f.subclass("esri.widgets.CompassViewModel")],c)})},"esri/widgets/NavigationToggle":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/accessorSupport/decorators/aliasOf ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Widget ./NavigationToggle/NavigationToggleViewModel ./support/decorators/accessibleHandler ./support/decorators/messageBundle ../core/Logger ./support/jsxFactory ./support/widgetUtils".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p){d=function(h){function m(t,q){t=h.call(this,t,q)||this;t.iconClass="esri-icon-pan2";t.label=void 0;t.messages=null;t.view=null;t.viewModel=new f;return t}a._inheritsLoose(m,h);var u=m.prototype;u.toggle=function(){return this.viewModel.toggle()};u.render=function(){const t="disabled"===this.get("viewModel.state");var q="pan"===this.get("viewModel.navigationMode");const z={["esri-navigation-toggle__button--active"]:q};q={["esri-navigation-toggle__button--active"]:!q};
const v=t?-1:0,B=this.messages.toggle;return y.tsx("div",{bind:this,class:this.classes("esri-navigation-toggle esri-widget",{["esri-disabled"]:t,["esri-navigation-toggle--horizontal"]:"horizontal"===this.layout}),onclick:this._toggle,onkeydown:this._toggle,tabIndex:v,"aria-label":B,title:B},y.tsx("div",{class:this.classes("esri-navigation-toggle__button esri-widget--button","esri-navigation-toggle__button--pan",z)},y.tsx("span",{class:"esri-icon-pan"})),y.tsx("div",{class:this.classes("esri-navigation-toggle__button esri-widget--button",
"esri-navigation-toggle__button--rotate",q)},y.tsx("span",{class:"esri-icon-rotate"})))};u._toggle=function(){this.toggle()};a._createClass(m,[{key:"layout",set:function(t){"horizontal"!==t&&(t="vertical");this._set("layout",t)}}]);return m}(n);b.__decorate([w.property()],d.prototype,"iconClass",void 0);b.__decorate([w.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],d.prototype,"label",void 0);b.__decorate([w.property({value:"vertical"})],d.prototype,"layout",null);b.__decorate([w.property(),
k.messageBundle("esri/widgets/NavigationToggle/t9n/NavigationToggle")],d.prototype,"messages",void 0);b.__decorate([c.aliasOf("viewModel.view")],d.prototype,"view",void 0);b.__decorate([w.property({type:f})],d.prototype,"viewModel",void 0);b.__decorate([e.accessibleHandler()],d.prototype,"_toggle",null);return d=b.__decorate([l.subclass("esri.widgets.NavigationToggle")],d)})},"esri/widgets/NavigationToggle/NavigationToggleViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,d,g,x,w,l,n,f){c=function(e){function k(y){y=e.call(this,y)||this;y._handles=new d;y.navigationMode="pan";y.view=null;return y}a._inheritsLoose(k,e);var r=k.prototype;r.initialize=function(){this._handles.add(g.when(this,"view.inputManager",this._setNavigationMode.bind(this)))};r.destroy=function(){this._handles.destroy();this.view=this._handles=null};r.toggle=function(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate",this._setNavigationMode())};
r._setNavigationMode=function(){this.get("view.inputManager").primaryDragAction="pan"===this.navigationMode?"pan":"rotate"};a._createClass(k,[{key:"state",get:function(){return this.get("view.ready")&&"3d"===this.view.type?"ready":"disabled"}}]);return k}(c);b.__decorate([x.property({readOnly:!0})],c.prototype,"state",null);b.__decorate([x.property()],c.prototype,"navigationMode",void 0);b.__decorate([x.property()],c.prototype,"view",void 0);return c=b.__decorate([f.subclass("esri.widgets.NavigationToggleViewModel")],
c)})},"esri/widgets/Zoom":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/accessorSupport/decorators/aliasOf ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Widget ./support/widgetUtils ./support/decorators/messageBundle ../core/Logger ./support/jsxFactory ./Zoom/IconButton ./Zoom/ZoomViewModel".split(" "),function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p){d=function(h){function m(t,
q){t=h.call(this,t,q)||this;t.iconClass="esri-icon-zoom-in-magnifying-glass";t.label=void 0;t.messages=null;t.view=null;t.viewModel=new p;return t}a._inheritsLoose(m,h);var u=m.prototype;u.initialize=function(){this._zoomInButton=new y({action:this.zoomIn.bind(this),iconClass:"esri-icon-plus"});this._zoomOutButton=new y({action:this.zoomOut.bind(this),iconClass:"esri-icon-minus"})};u.destroy=function(){this._zoomInButton.destroy();this._zoomOutButton.destroy();this._zoomOutButton=this._zoomInButton=
null};u.render=function(){const t=this.viewModel,q={["esri-zoom--horizontal"]:"horizontal"===this.layout};this._zoomInButton.enabled="ready"===t.state&&t.canZoomIn;this._zoomOutButton.enabled="ready"===t.state&&t.canZoomOut;this._zoomInButton.title=this.messages.zoomIn;this._zoomOutButton.title=this.messages.zoomOut;return r.tsx("div",{class:this.classes("esri-zoom esri-widget",q)},this._zoomInButton.render(),this._zoomOutButton.render())};u.zoomIn=function(){return this.viewModel.zoomIn()};u.zoomOut=
function(){return this.viewModel.zoomOut()};a._createClass(m,[{key:"layout",set:function(t){"horizontal"!==t&&(t="vertical");this._set("layout",t)}}]);return m}(n);b.__decorate([w.property()],d.prototype,"iconClass",void 0);b.__decorate([w.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],d.prototype,"label",void 0);b.__decorate([w.property({value:"vertical"})],d.prototype,"layout",null);b.__decorate([w.property(),e.messageBundle("esri/widgets/Zoom/t9n/Zoom")],d.prototype,"messages",
void 0);b.__decorate([c.aliasOf("viewModel.view")],d.prototype,"view",void 0);b.__decorate([w.property({type:p})],d.prototype,"viewModel",void 0);return d=b.__decorate([l.subclass("esri.widgets.Zoom")],d)})},"esri/widgets/Zoom/IconButton":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../Widget ../support/decorators/accessibleHandler ../../core/Logger ../support/jsxFactory ../support/widgetUtils".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k){d=function(r){function y(){var h=r.apply(this,arguments)||this;h.enabled=!0;h.iconClass="";h.title="";return h}a._inheritsLoose(y,r);var p=y.prototype;p.render=function(){const h=this.enabled?0:-1,m={[this.iconClass]:!!this.iconClass};return e.tsx("div",{bind:this,class:this.classes("esri-widget--button esri-widget",{["esri-disabled"]:!this.enabled,["esri-interactive"]:this.enabled}),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:h,
title:this.title},e.tsx("span",{"aria-hidden":"true",role:"presentation",class:this.classes("esri-icon",m)}),e.tsx("span",{class:"esri-icon-font-fallback-text"},this.title))};p._triggerAction=function(){this.action.call(this)};return y}(l);b.__decorate([c.property()],d.prototype,"action",void 0);b.__decorate([c.property()],d.prototype,"enabled",void 0);b.__decorate([c.property()],d.prototype,"iconClass",void 0);b.__decorate([c.property()],d.prototype,"title",void 0);b.__decorate([n.accessibleHandler()],
d.prototype,"_triggerAction",null);return d=b.__decorate([w.subclass("esri.widgets.IconButton")],d)})},"esri/widgets/Zoom/ZoomViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/promiseUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ./ZoomConditions2D ./ZoomConditions3D".split(" "),function(a,b,c,d,g,x,
w,l,n,f,e){c=function(k){function r(p){p=k.call(this,p)||this;p.canZoomIn=!1;p.canZoomOut=!1;return p}a._inheritsLoose(r,k);var y=r.prototype;y.destroy=function(){this.view=null};y.zoomIn=function(){if(this.canZoomIn){var p=this.view;"2d"===p.type?p.mapViewNavigation.zoomIn():d.ignoreAbortErrors(p.goTo({zoomFactor:2}))}};y.zoomOut=function(){if(this.canZoomOut){var p=this.view;"2d"===p.type?p.mapViewNavigation.zoomOut():d.ignoreAbortErrors(p.goTo({zoomFactor:.5}))}};a._createClass(r,[{key:"state",
get:function(){return this.get("view.ready")?"ready":"disabled"}},{key:"view",set:function(p){p?"2d"===p.type?this._zoomConditions=new f({view:p}):"3d"===p.type&&(this._zoomConditions=new e({view:p})):this._zoomConditions=null;this._set("view",p)}}]);return r}(c);b.__decorate([g.property()],c.prototype,"_zoomConditions",void 0);b.__decorate([g.property({aliasOf:"_zoomConditions.canZoomIn",readOnly:!0})],c.prototype,"canZoomIn",void 0);b.__decorate([g.property({aliasOf:"_zoomConditions.canZoomOut",
readOnly:!0})],c.prototype,"canZoomOut",void 0);b.__decorate([g.property({readOnly:!0})],c.prototype,"state",null);b.__decorate([g.property()],c.prototype,"view",null);return c=b.__decorate([n.subclass("esri.widgets.Zoom.ZoomViewModel")],c)})},"esri/widgets/Zoom/ZoomConditions2D":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,d,g,x,w,l){c=function(n){function f(){return n.apply(this,arguments)||this}a._inheritsLoose(f,n);a._createClass(f,[{key:"canZoomIn",get:function(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),k=this.get("view.constraints.effectiveMaxScale");return 0===k||e>k}},{key:"canZoomOut",get:function(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),k=this.get("view.constraints.effectiveMinScale");
return 0===k||e<k}}]);return f}(c);b.__decorate([d.property({readOnly:!0})],c.prototype,"canZoomIn",null);b.__decorate([d.property({readOnly:!0})],c.prototype,"canZoomOut",null);b.__decorate([d.property()],c.prototype,"view",void 0);return c=b.__decorate([l.subclass("esri.widgets.Zoom.ZoomConditions2D")],c)})},"esri/widgets/Zoom/ZoomConditions3D":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,d,g,x,w,l){c=function(n){function f(){return n.apply(this,arguments)||this}a._inheritsLoose(f,n);a._createClass(f,[{key:"canZoomIn",get:function(){return!!this.get("view.ready")}},{key:"canZoomOut",get:function(){return!!this.get("view.ready")}}]);return f}(c);b.__decorate([d.property({readOnly:!0})],c.prototype,"canZoomIn",null);b.__decorate([d.property({readOnly:!0})],c.prototype,"canZoomOut",null);b.__decorate([d.property()],c.prototype,"view",void 0);return c=b.__decorate([l.subclass("esri.widgets.Zoom.ZoomConditions3D")],
c)})},"jimu/DataManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","./WidgetManager"],function(a,b,c,d){var g=null;var x=a(null,{constructor:function(){c.subscribe("publishData",b.hitch(this,this.onDataPublished));c.subscribe("fetchData",b.hitch(this,this.onFetchData));c.subscribe("clearAllData",b.hitch(this,this.onClearAllData));c.subscribe("removeData",b.hitch(this,this.onRemoveData));c.subscribe("clearDataHistory",b.hitch(this,this.onClearDataHistory));this.widgetManager=
d.getInstance()},_dataStore:{},onDataPublished:function(w,l,n,f){"undefined"===typeof f&&(f=!1);this._dataStore[l]?(this._dataStore[l].current=n,f&&(this._dataStore[l].history?this._dataStore[l].history.push(n):this._dataStore[l].history=[n])):(this._dataStore[l]={current:n},f&&(this._dataStore[l].history=[n]))},onFetchData:function(w){var l;if(w)"framework"===w?this._dataStore[w]?c.publish("dataFetched","framework","framework",this._dataStore[w].current,this._dataStore[w].history):c.publish("noData",
"framework","framework"):(l=this.widgetManager.getWidgetById(w))?this._dataStore[w]?c.publish("dataFetched",l.name,w,this._dataStore[w].current,this._dataStore[w].history):c.publish("noData",l.name,w):c.publish("noData",void 0,w);else for(var n in this._dataStore)(l=this.widgetManager.getWidgetById(n))&&c.publish("dataFetched",l.name,n,this._dataStore[n].current,this._dataStore[n].history)},onClearAllData:function(){this._dataStore={};c.publish("allDataCleared")},onRemoveData:function(w){delete this._dataStore[w];
c.publish("dataRemoved",w)},onClearDataHistory:function(w){this._dataStore[w]&&(this._dataStore[w].history=[]);c.publish("dataHistoryCleared",w)}});x.getInstance=function(){null===g&&(g=new x);return g};return x})},"jimu/BaseWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dijit/_WidgetBase dijit/_TemplatedMixin jimu/utils ./PanelManager".split(" "),function(a,b,c,d,g,x,w,l,n){return a([x,w],{type:"widget",id:void 0,label:void 0,icon:void 0,
uri:void 0,position:{},config:void 0,openAtStart:!1,sceneView:null,appConfig:null,folderUrl:null,state:"closed",windowState:"normal",started:!1,name:"",baseClass:null,templateString:"\x3cdiv\x3e\x3c/div\x3e",moveTopOnActive:!0,constructor:function(){this.listenWidgetNames=[];this.listenWidgetIds=[];this.own(g.subscribe("publishData",b.hitch(this,this._onReceiveData)));this.own(g.subscribe("dataFetched",b.hitch(this,this._onReceiveData)));this.own(g.subscribe("noData",b.hitch(this,this._onNoData)))},
startup:function(){this.inherited(arguments);this.started=!0},onOpen:function(){},onClose:function(){},onNormalize:function(){},onMinimize:function(){},onMaximize:function(){},onActive:function(){},onDeActive:function(){},onSignIn:function(f){},onSignOut:function(){},onPositionChange:function(f){this.setPosition(f)},setPosition:function(f,e){this.position=f;var k=l.getPositionStyle(this.position);k.position="absolute";e||(e="map"===f.relativeTo?this.sceneView.map.id:window.jimuConfig.layoutId);d.place(this.domNode,
e);d.setStyle(this.domNode,k);this.started&&this.resize()},getPosition:function(){return this.position},getMarginBox:function(){return d.getMarginBox(this.domNode)},setState:function(f){this.state=f},setWindowState:function(f){this.windowState=f},resize:function(){},onConfigChanged:function(f){},onAppConfigChanged:function(f,e,k){},onAction:function(f,e){},getPanel:function(){if(!1===this.inPanel)return null;if("widgetOnScreen"===this.gid||"widgetPool"===this.gid)return n.getInstance().getPanelById(this.id+
"_panel");var f=n.getInstance().getPanelById(this.gid+"_panel");return f?f:n.getInstance().getPanelById(this.id+"_panel")},publishData:function(f,e){"undefined"===typeof e&&(e=!1);g.publish("publishData",this.name,this.id,f,e)},fetchData:function(f){f?g.publish("fetchData",f):0!==this.listenWidgetIds.length?c.forEach(this.listenWidgetIds,function(e){g.publish("fetchData",e)},this):g.publish("fetchData")},fetchDataByName:function(f){f=this.widgetManager.getWidgetsByName(f);c.forEach(f,function(e){this.fetchData(e.id)},
this)},openWidgetById:function(f){return this.widgetManager.triggerWidgetOpen(f)},_onReceiveData:function(f,e,k,r){if(e!==this.id&&!(0!==this.listenWidgetIds.length&&0>this.listenWidgetIds.indexOf(e)))this.onReceiveData(f,e,k,r)},onReceiveData:function(f,e,k,r){},_onNoData:function(f,e){if(!(0!==this.listenWidgetIds.length&&0>this.listenWidgetIds.indexOf(e)))this.onNoData(f,e)},onNoData:function(f,e){}})})},"jimu/PanelManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/fx dojo/Deferred dojo/promise/all dojo/on dojo/topic dojo/when require ./utils ./WidgetManager".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r){var y=null;var p=a(null,{constructor:function(){this.panels=[];this.widgetManager=r.getInstance();l(window,"resize",b.hitch(this,this.onWindowResize));this.activePanel=null;n.subscribe("/dnd/move/start",b.hitch(this,this._onMoveStart));n.subscribe("widgetActived",b.hitch(this,this._onWidgetActived))},showPanel:function(h){var m=new x,u=this.getPanelById(h.id+"_panel");u?("closed"===u.state&&this.openPanel(u),m.resolve(u)):w({Panel:this._loadPanelClass(h.panel.uri),
nls:this._loadThemeI18N(h.panel.uri)}).then(b.hitch(this,function(t){var q=h.id+"_panel",z=this.getPanelById(q),v={label:h.label,config:h,uri:h.panel.uri,position:h.panel.position,sceneView:this.sceneView,widgetManager:this.widgetManager,panelManager:this,id:q,gid:h.gid,nls:t.nls};b.mixin(v,h.panel.options);try{z=new t.Panel(v),console.log("panel ["+q+"] created.")}catch(B){console.log("create panel error: "+B+", panelId: "+q);m.reject(B);return}z.setPosition(h.panel.position);k.setVerticalCenter(z.domNode);
this.openPanel(z);this.panels.push(z);l(z.domNode,"click",b.hitch(this,this._onPanelClick,z));m.resolve(z)}));return m},setSceneView:function(h){this.sceneView=h;l(this.sceneView,"resize",b.hitch(this,this.onMapResize))},closeOtherPanelsInTheSameGroup:function(h){if("string"===typeof h&&(h=this.getPanelById(h),!h))return;for(var m=0;m<this.panels.length;m++)this.panels[m].gid===h.gid&&this.panels[m].id!==h.id&&this.closePanel(this.panels[m])},closeAllPanelsInGroup:function(h){for(var m=0;m<this.panels.length;m++)this.panels[m].gid===
h&&this.closePanel(this.panels[m])},openPanel:function(h){var m=new x;if("string"===typeof h&&(h=this.getPanelById(h),!h))return m.reject(),m;if(!h.started)try{h.started=!0,h.startup()}catch(u){console.error("fail to startup panel "+h.id+". "+u.stack)}if("opened"===h.state)return m.resolve(h),m;h.setState("opened");return this.playOpenPanelAnimation(h).then(b.hitch(this,function(){d.setStyle(h.domNode,"display","");h.onOpen();this._activePanel(h);return h}))},closePanel:function(h){var m=new x;return"string"===
typeof h&&(h=this.getPanelById(h),!h)||"closed"===h.state?(m.resolve(),m):this.playClosePanelAnimation(h).then(function(){this.activePanel&&this.activePanel.id===h.id&&(this.activePanel.onDeActive(),this.activePanel=null);h.setState("closed");h.onClose();h.domNode&&d.setStyle(h.domNode,"display","none")})},minimizePanel:function(h){if("string"===typeof h&&(h=this.getPanelById(h),!h))return;"closed"===h.state&&this.openPanel(h);h.setWindowState("minimized");try{h.onMinimize()}catch(m){console.log(console.error("fail to minimize panel "+
h.id+". "+m.stack))}},maximizePanel:function(h){if("string"===typeof h&&(h=this.getPanelById(h),!h))return;"closed"===h.state&&this.openPanel(h);h.setWindowState("maximized");try{h.onMaximize()}catch(m){console.log(console.error("fail to maximize panel "+h.id+". "+m.stack))}},normalizePanel:function(h){if("string"===typeof h&&(h=this.getPanelById(h),!h))return;"closed"===h.state&&this.openPanel(h);h.setWindowState("normal");try{h.onNormalize()}catch(m){console.log(console.error("fail to noralize panel "+
h.id+". "+m.stack))}},changeWindowStateTo:function(h,m){if("string"===typeof h&&(h=this.getPanelById(h),!h))return;"normal"===m?this.normalizePanel(h):"minimized"===m?this.minimizePanel(h):"maximized"===m?this.maximizePanel(h):console.log("error state: "+m)},getPanelById:function(h){for(var m=0;m<this.panels.length;m++)if(this.panels[m].id===h)return this.panels[m]},onWindowResize:function(){for(var h=0;h<this.panels.length;h++)"closed"!==this.panels[h].state&&"map"!==this.panels[h].position.relativeTo&&
this.panels[h].resize()},onMapResize:function(){for(var h=0;h<this.panels.length;h++)"closed"!==this.panels[h].state&&"map"===this.panels[h].position.relativeTo&&this.panels[h].resize()},destroyPanel:function(h){if("string"===typeof h&&(h=this.getPanelById(h),!h))return;if(h.domNode){"closed"!==h.state&&this.closePanel(h);this._removePanel(h);try{h.destroy()}catch(m){console.log(console.error("fail to destroy panel "+h.id+". "+m.stack))}}},destroyAllPanels:function(){var h=c.map(this.panels,function(m){return m.id});
c.forEach(h,function(m){this.destroyPanel(m)},this);this.panels=[]},playOpenPanelAnimation:function(h){if("string"===typeof h&&(h=this.getPanelById(h),!h)||!h.openAnimation||0===h.animationDuration)return f();var m=new x;"string"===typeof h.openAnimation?"fadeIn"===h.openAnimation?(d.setStyle(h.domNode,{opacity:0,display:""}),g.fadeIn({node:h.domNode,duration:h.animationDuration,onEnd:function(){m.resolve()}}).play()):m.resolve():m.resolve();return m},playClosePanelAnimation:function(h){if("string"===
typeof h&&(h=this.getPanelById(h),!h)||!h.closeAnimation||0===h.animationDuration)return f();var m=new x;"string"===typeof h.closeAnimation&&("fadeOut"===h.closeAnimation?g.fadeOut({node:h.domNode,duration:h.animationDuration,onEnd:function(){m.resolve()}}).play():m.resolve());return m},getPositionOnMobile:function(h){if("string"===typeof h&&(h=this.getPanelById(h),!h))return{};var m=d.getMarginBox(window.jimuConfig.layoutId),u=m.h/2;h.titleHeight||(h.titleHeight=35);return"maximized"===h.windowState?
{left:0,right:0,top:0,bottom:0,width:"auto",height:"auto",contentHeight:m.h-h.titleHeight,borderRadiusStyle:{borderTopLeftRadius:0,borderTopRightRadius:0,borderBottomLeftRadius:0,borderBottomRightRadius:0}}:"minimized"===h.windowState?m.h>m.w?{left:0,right:0,top:"auto",bottom:0,width:"auto",height:h.titleHeight,contentHeight:0,borderRadiusStyle:{borderTopLeftRadius:"4px",borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:0}}:{left:m.w-m.w/2,right:0,top:"auto",bottom:0,width:m.w/
2,height:h.titleHeight,contentHeight:m.h,borderRadiusStyle:window.isRTL?{borderTopLeftRadius:0,borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:"4px"}:{borderTopLeftRadius:"4px",borderTopRightRadius:0,borderBottomLeftRadius:"4px",borderBottomRightRadius:0}}:m.h>m.w?{left:0,right:0,top:u,bottom:0,width:"auto",height:"auto",contentHeight:m.h-u-h.titleHeight,borderRadiusStyle:{borderTopLeftRadius:"4px",borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:0}}:
{left:m.w-m.w/2,right:0,top:0,bottom:0,width:m.w/2,height:"auto",contentHeight:m.h-u-h.titleHeight,borderRadiusStyle:window.isRTL?{borderTopLeftRadius:0,borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:"4px"}:{borderTopLeftRadius:"4px",borderTopRightRadius:0,borderBottomLeftRadius:"4px",borderBottomRightRadius:0}}},_onPanelClick:function(h){this._activePanel(h)},_activePanel:function(h){if(this.activePanel){if(this.activePanel.id===h.id){this.activePanel.moveTopOnActive&&
d.setStyle(this.activePanel.domNode,"zIndex",101);return}"active"===this.activePanel.state&&(this.activePanel.setState("opened"),d.setStyle(this.activePanel.domNode,"zIndex","undefined"!==typeof this.activePanel.position.zIndex?this.activePanel.position.zIndex:"auto"),this.activePanel.onDeActive())}var m=this.widgetManager.activeWidget;m&&"active"===m.state&&m.getPanel()!==h&&(m.setState("opened"),!1===m.inPanel&&d.setStyle(m.domNode,"zIndex","undefined"!==typeof m.position.zIndex?m.position.zIndex:
"auto"),m.onDeActive(),this.widgetManager.activeWidget=null);this.activePanel=h;"active"!==this.activePanel.state&&(this.activePanel.setState("active"),this.activePanel.moveTopOnActive&&d.setStyle(this.activePanel.domNode,"zIndex",101),this.activePanel.onActive())},_removePanel:function(h){var m=this.panels.indexOf(h);-1<m&&this.panels.splice(m,1);this.activePanel&&this.activePanel.id===h.id&&(this.activePanel=null)},_onMoveStart:function(h){c.forEach(this.panels,function(m){m.domNode===h.node&&this._activePanel(m)},
this)},_onWidgetActived:function(h){this.activePanel&&"active"===this.activePanel.state&&h.getPanel()!==this.activePanel&&(this.activePanel.setState("opened"),d.setStyle(this.activePanel.domNode,"zIndex","undefined"!==typeof this.activePanel.position.zIndex?this.activePanel.position.zIndex:"auto"),this.activePanel.onDeActive(),this.activePanel=null)},_loadPanelClass:function(h){var m=new x;e([h],function(u){m.resolve(u)});return m},_loadThemeI18N:function(h){var m=new x;h.startWith("themes")?(h=h.split("/"),
e(["dojo/i18n!"+(h[0]+"/"+h[1]+"/nls/strings")],function(u){m.resolve(u)})):m.resolve({});return m}});p.getInstance=function(){null===y&&(y=new p,window._panelManager=y);return y};return p})},"jimu/BaseWidgetFrame":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dijit/_WidgetBase"],function(a,b,c,d){return a([d],{widget:null,baseClass:"jimu-widget-frame jimu-container",postCreate:function(){this.inherited(arguments);this.containerNode||(this.containerNode=this.domNode);
this.widget&&this.setWidget(this.widget)},startup:function(){this.inherited(arguments);this.widget&&this.widget.startup()},resize:function(){this.widget&&"closed"!==this.widget.state&&b.isFunction(this.widget.resize)&&this.widget.resize()},setLoading:function(g){this.loading=g;this.loading.placeAt(this.containerNode)},getWidget:function(){return this.widget},setWidget:function(g){this.widget=g;this.loading&&this.loading.destroy();c.place(g.domNode,this.containerNode);this.resize()},destroy:function(){if(this.widget&&
this.widget.domNode)try{this.widget.destroy()}catch(g){console.error("destroy widget error. widget: ["+this.widget.uri+"], "+g.stack)}this.loading&&this.loading.domNode&&this.loading.destroy()}})})},"jimu/BaseWidgetPanel":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dijit/_WidgetBase dijit/_Container ./dijit/LoadingIndicator ./BaseWidgetFrame ./utils".split(" "),function(a,b,c,d,g,x,w,l,n){return a([g,x],{baseClass:"jimu-panel jimu-container",started:!1,state:"closed",
windowState:"normal",moveTopOnActive:!0,openAnimation:null,closeAnimation:null,animationDuration:0,startup:function(){this.inherited(arguments);this.loadAllWidgetsInOrder();this.started=!0},loadAllWidgetsInOrder:function(){var f=this.getAllWidgetConfigs();f=Array.isArray(this.config.widgets)?this.config.widgets:[this.config];c.forEach(f,function(e){if(!1!==e.visible){var k=new w;var r=this.createFrame(e);this.addChild(r);r.setLoading(k);this.widgetManager.loadWidget(e).then(b.hitch(this,function(y){r.setWidget(y);
y.startup()}))}},this)},getAllWidgetConfigs:function(){var f=[];return f=Array.isArray(this.config.widgets)?this.config.widgets:[this.config]},getWidgetById:function(f){for(var e=this.getChildren(),k=0;k<e.length;k++)if(e[k].getWidget()&&e[k].getWidget().id===f)return e[k].getWidget()},createFrame:function(f){return new l},setPosition:function(f,e){this.position=f;var k=n.getPositionStyle(this.position);k.position="absolute";e||(e="map"===f.relativeTo?this.sceneView.map.id:window.jimuConfig.layoutId);
this.started?this.resize():this.openAnimation&&(k.display="none");d.place(this.domNode,e);d.setStyle(this.domNode,k)},getPosition:function(){return this.position},setState:function(f){this.state=f},setWindowState:function(f){this.windowState=f},resize:function(){this.getChildren().forEach(function(f){f.resize()})},onPositionChange:function(f){this.setPosition(f)},onOpen:function(){c.forEach(this.getChildren(),function(f){f.getWidget()&&this.widgetManager.openWidget(f.getWidget())},this)},onClose:function(){c.forEach(this.getChildren(),
function(f){f.getWidget()&&this.widgetManager.closeWidget(f.getWidget())},this)},onMaximize:function(){c.forEach(this.getChildren(),function(f){f.getWidget()&&this.widgetManager.maximizeWidget(f.getWidget())},this)},onMinimize:function(){c.forEach(this.getChildren(),function(f){f.getWidget()&&this.widgetManager.minimizeWidget(f.getWidget())},this)},onNormalize:function(){c.forEach(this.getChildren(),function(f){f.getWidget()&&this.widgetManager.normalizeWidget(f.getWidget())},this)},onActive:function(){},
onDeActive:function(){},updateConfig:function(f){this._updateConfig(f)},reloadWidget:function(f){this.isWidgetInPanel(f)&&(this._updateConfig(f),this.getChildren().forEach(function(e){e.getWidget()&&e.getWidget().id===f.id&&(e.getWidget().destroy(),e.setLoading(new w),this.widgetManager.loadWidget(f).then(b.hitch(this,function(k){e.setWidget(k);k.startup();"closed"===this.state&&this.widgetManager.closeWidget(k)})))},this))},isWidgetInPanel:function(f){return c.some(this.getAllWidgetConfigs(),function(e){if(f.id===
e.id)return!0})?!0:!1},_updateConfig:function(f){if(Array.isArray(this.config.widgets)){for(var e=-1,k=0;k<this.config.widgets.length;k++)this.config.widgets[k].id===f.id&&(e=k);0<e&&(this.config.widgets[e]=f)}else this.config=f},destroy:function(){this.getChildren().forEach(function(f){try{f.domNode&&f.destroy()}catch(e){console.error("destroy widget frame error."+e.stack)}});this.inherited(arguments)}})})},"dijit/_Container":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/dom-construct",
"dojo/_base/kernel"],function(a,b,c,d){return b("dijit._Container",null,{buildRendering:function(){this.inherited(arguments);this.containerNode||(this.containerNode=this.domNode)},addChild:function(g,x){var w=this.containerNode;if(0<x){for(w=w.firstChild;0<x;)1==w.nodeType&&x--,w=w.nextSibling;w?x="before":(w=this.containerNode,x="last")}c.place(g.domNode,w,x);this._started&&!g._started&&g.startup()},removeChild:function(g){"number"==typeof g&&(g=this.getChildren()[g]);g&&(g=g.domNode)&&g.parentNode&&
g.parentNode.removeChild(g)},hasChildren:function(){return 0<this.getChildren().length},_getSiblingOfChild:function(g,x){var w=this.getChildren();g=a.indexOf(w,g);return w[g+x]},getIndexOfChild:function(g){return a.indexOf(this.getChildren(),g)}})})},"jimu/dijit/LoadingIndicator":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dojo/dom-style","dojo/dom-construct"],function(a,b,c,d){return a(b,{baseClass:"jimu-loading-indicator",declaredClass:"jimu.dijit.LoadingIndicator",hidden:!1,postCreate:function(){this.inherited(arguments);
(this.hidden=!0===this.hidden)&&c.set(this.domNode,{display:"none"});c.set(this.domNode,{width:"100%",height:"100%"});d.place(' \x3cdiv class\x3d"loading-container"\x3e\x3cdiv data-dojo-attach-point\x3d"loadingNode" class\x3d"img-div"\x3e\x3c/div\x3e\x3c/div\x3e',this.domNode)},show:function(){this.domNode&&c.set(this.domNode,"display","block")},hide:function(){this.domNode&&c.set(this.domNode,"display","none")}})})},"jimu/BaseWidgetSetting":function(){define(["dojo/_base/declare","dojo/_base/lang",
"dojo/on","dijit/_WidgetBase","dijit/_TemplatedMixin"],function(a,b,c,d,g){return a([d,g],{templateString:"\x3cdiv\x3e\x3c/div\x3e",postCreate:function(){this.own(c(window,"resize",b.hitch(this,this._onWindowResize)))},getConfig:function(){},resize:function(){},_onWindowResize:function(){this.resize()}})})},"jimu/PoolControllerMixin":function(){define(["dojo/_base/declare","dojo/_base/array","jimu/PanelManager"],function(a,b,c){return a(null,{constructor:function(){this.panelManager=c.getInstance()},
postCreate:function(){this.controlledWidgets||(this.controlledWidgets="all");this.controlledGroups||(this.controlledGroups="all")},getOpenedIds:function(){},setOpenedIds:function(d){},getConfigById:function(d){for(var g=this.getAllConfigs(),x=0;x<g.length;x++)if(g[x].id===d)return g[x]},getAllConfigs:function(){var d=[];d=d.concat(this.getWidgetConfigs(),this.getGroupConfigs());d=b.filter(d,function(g){return g.visible});return d.sort(function(g,x){return g.index-x.index})},getAllConfigsIncludeInvisible:function(){var d=
[];d=d.concat(this.getWidgetConfigs(),this.getGroupConfigs());return d.sort(function(g,x){return g.index-x.index})},isControlled:function(d){return b.some(this.getAllConfigsIncludeInvisible(),function(g){return g.id===d})},widgetIsControlled:function(d){return b.some(this.getAllConfigsIncludeInvisible(),function(g){return g.id===d?!0:b.some(g.widgets,function(x){return x.id===d})})},getGroupConfigs:function(){var d=[];if(!this.appConfig.widgetPool)return d;this.appConfig.widgetPool.groups&&b.forEach(this.appConfig.widgetPool.groups,
function(g){this.controlledGroups&&(Array.isArray(this.controlledGroups)?-1<this.controlledGroups.indexOf(g.id)&&d.push(g):"all"===this.controlledGroups&&d.push(g))},this);return d},getWidgetConfigs:function(){var d=[];if(!this.appConfig.widgetPool)return d;this.appConfig.widgetPool.widgets&&b.forEach(this.appConfig.widgetPool.widgets,function(g){this.controlledWidgets&&(Array.isArray(this.controlledWidgets)?-1<this.controlledWidgets.indexOf(g.id)&&d.push(g):"all"===this.controlledWidgets&&d.push(g))},
this);return d}})})},"jimu/SpatialReference/utils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/promise/all dojo/request esri/geometry/SpatialReference ./unitUtils".split(" "),function(a,b,c,d,g,x,w,l){var n=null,f=null,e=!1;a=a(null,function(){});var k=require.toUrl("jimu"),r=x(k+"/SpatialReference/wkidDetails.json",{handleAs:"json"}),y=x(k+"/SpatialReference/transform.json",{handleAs:"json"});a.loadResource=function(){var p=new d;if(n&&f)return p.resolve(),
p;g([r,y]).then(function(h){n=h[0];f=h[1];e=!0;p.resolve()},function(h){console.error(h);e=!1;p.reject(h)});return p};a.getAllCSUnits=function(){if(e){var p=[];c.forEach(n.wkids,b.hitch(this,function(h){h=this.getCSUnit(h);-1===c.indexOf(p,h)&&p.push(h)}));return p}};a.convertUnit=function(p,h,m){if(e)return l.convertUnit(p,h,m)};a.getUnitRate=function(p,h){if(e)return l.getUnitRate(p,h)};a.isProjectUnit=function(p){if(e)return l.isProjectUnit(p)};a.isGeographicUnit=function(p){if(e)return l.isGeographicUnit(p)};
a.getGeographicUnits=function(){if(e)return l.getGeographicUnits()};a.getProjectUnits=function(){if(e)return l.getProjectUnits()};a.getCSUnit=function(p){if(e){p=this.getCSStr(p);var h=0,m=0;h=p.lastIndexOf("UNIT");m=p.indexOf(",",h);return p.slice(h+6,m-1)}};a.isSameSR=function(p,h){if(e)return p=this.indexOfWkid(p),h=this.indexOfWkid(h),n.labels[p]===n.labels[h]};a.isValidWkid=function(p){if(e)return-1<this.indexOfWkid(p)};a.getSRLabel=function(p){if(e&&this.isValidWkid(p))return p=this.indexOfWkid(p),
n.labels[p]};a.indexOfWkid=function(p){if(e)return c.indexOf(n.wkids,p)};a.isWebMercator=function(p){return w.prototype._isWebMercator?w.prototype._isWebMercator.apply({wkid:parseInt(p,10)},[]):(new w(parseInt(p,10))).isWebMercator};a.standardizeWkid=function(p){return this.isWebMercator(p)?3857:parseInt(p,10)};a.isValidTfWkid=function(p){if(e)return-1<this.indexOfTfWkid(p)};a.getTransformationLabel=function(p){if(e)return this.isValidTfWkid(p)?(p=this.indexOfTfWkid(p),f.labels[p]):""};a.indexOfTfWkid=
function(p){if(e)return c.indexOf(f.tfWkids,p)};a.isGeographicCS=function(p){if(e)return this.isValidWkid(p)?n.details[this.indexOfWkid(p)].startWith("GEOGCS"):!1};a.isProjectedCS=function(p){if(e)return this.isValidWkid(p)?n.details[this.indexOfWkid(p)].startWith("PROJCS"):!1};a.getGeoCSByProj=function(p){if(e&&this.isProjectedCS(p))return p=this.getSpheroidStr(p),p=c.indexOf(n.details,p),n.wkids[p]};a.getSpheroidStr=function(p){if(e){if(this.isGeographicCS(p))return n.details[this.indexOfWkid(p)];
if(this.isProjectedCS(p)){p=n.details[this.indexOfWkid(p)];var h=p.indexOf("GEOGCS"),m=p.indexOf("PROJECTION")-1;return p.slice(h,m)}return null}};a.getCSStr=function(p){if(e)return n.details[this.indexOfWkid(p)]};a.isSameSpheroid=function(p,h){if(e)return p=this.getSpheroidStr(p),h=this.getSpheroidStr(h),p&&h&&p===h?!0:!1};return a})},"dojo/request":function(){define(["./request/default!"],function(a){return a})},"dojo/request/default":function(){define(["exports","require","../has"],function(a,
b,c){var d=c("config-requestProvider");if(c("host-browser")||c("host-webworker"))var g="./xhr";d||(d=g);a.getPlatformDefaultId=function(){return g};a.load=function(x,w,l,n){b(["platform"==x?g:d],function(f){l(f)})}})},"jimu/SpatialReference/unitUtils":function(){define(["dojo/_base/declare","dojo/_base/array"],function(a,b){var c="INCHES FOOT FOOT_US YARDS MILES NAUTICAL_MILES MILLIMETERS CENTIMETERS METER KILOMETERS DECIMETERS LINK_CLARKE FOOT_GOLD_COAST FOOT_CLARKE CHAIN_SEARS_1992_TRUNCATED YARD_INDIAN CHAIN_BENOIT_1895_B YARD_SEARS CHAIN_SEARS FOOT_SEARS YARD_INDIAN_1937 50_KILOMETERS 150_KILOMETERS".split(" "),
d="DECIMAL_DEGREES DEGREE_MINUTE_SECONDS DEGREE GRAD MGRS USNG".split(" "),g={INCHES:.0254,FOOT:.3048,FOOT_US:.3048006096012192,YARDS:.9144,MILES:1609.344,NAUTICAL_MILES:1852,MILLIMETERS:.001,CENTIMETERS:.01,METER:1,KILOMETERS:1E3,DECIMETERS:.1,LINK_CLARKE:.2011661949,FOOT_GOLD_COAST:.3047997101815088,FOOT_CLARKE:.304797265,CHAIN_SEARS_1922_TRUNCATED:20.116756,YARD_INDIAN:.9143985307444408,CHAIN_BENOIT_1895_B:20.11678249437587,YARD_SEARS:.9143984146160287,CHAIN_SEARS:20.11676512155263,FOOT_SEARS:.3047994715386762,
YARD_INDIAN_1937:.91439523,"50_KILOMETERS":5E4,"150_KILOMETERS":15E4,DEGREE:.0174532925199433,DECIMAL_DEGREES:.0174532925199433,MGRS:.0174532925199433,USNG:.0174532925199433,DEGREE_MINUTE_SECONDS:.0174532925199433,GRAD:.01570796326794897};a=a(null,function(){});a.convertUnit=function(x,w,l){return g[x.toUpperCase()]/g[w.toUpperCase()]*l};a.getUnitRate=function(x,w){return g[x.toUpperCase()]/g[w.toUpperCase()]};a.isProjectUnit=function(x){return-1<b.indexOf(c,x.toUpperCase())};a.isGeographicUnit=function(x){return-1<
b.indexOf(d,x.toUpperCase())};a.getGeographicUnits=function(){return d};a.getProjectUnits=function(){return c};return a})},"jimu/OnScreenWidgetPanel":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/on dojo/dnd/move dijit/_TemplatedMixin jimu/BaseWidgetPanel jimu/utils dojox/layout/ResizeHandle dojo/touch".split(" "),function(a,b,c,d,g,x,w,l,n){return a([w,x],{baseClass:"jimu-panel jimu-on-screen-widget-panel",_positionInfoBox:null,_originalBox:null,widgetIcon:null,_resizeOnOpen:!0,
templateString:'\x3cdiv data-dojo-attach-point\x3d"boxNode"\x3e\x3cdiv class\x3d"jimu-panel-title jimu-main-background" data-dojo-attach-point\x3d"titleNode"\x3e\x3cdiv class\x3d"title-label jimu-vcenter-text jimu-float-leading jimu-leading-padding1"data-dojo-attach-point\x3d"titleLabelNode"\x3e${label}\x3c/div\x3e\x3cdiv class\x3d"close-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"closeNode"data-dojo-attach-event\x3d"onclick:_onCloseBtnClicked,press:_onCloseBtnClicked"\x3e\x3c/div\x3e\x3cdiv class\x3d"max-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"maxNode"data-dojo-attach-event\x3d"onclick:_onMaxBtnClicked"\x3e\x3c/div\x3e\x3cdiv class\x3d"foldable-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"foldableNode"data-dojo-attach-event\x3d"onclick:_onFoldableBtnClicked"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"jimu-panel-content" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\x3c/div\x3e',
postCreate:function(){this._originalBox={w:400,h:410}},startup:function(){this.inherited(arguments);this._normalizePositionObj(this.position);this._makeOriginalBox();this.makePositionInfoBox();this.makeMoveable(this._positionInfoBox.w,.25*this._positionInfoBox.w)},_onMaxBtnClicked:function(f){f.stopPropagation();this._getPositionInfo().isRunInMobile&&("maximized"===this.windowState?this.panelManager.normalizePanel(this):this.panelManager.maximizePanel(this),this._setMobilePosition())},_onFoldableBtnClicked:function(f){f.stopPropagation();
this._getPositionInfo().isRunInMobile&&("minimized"===this.windowState?(c.removeClass(this.foldableNode,"fold-up"),c.addClass(this.foldableNode,"fold-down"),this.panelManager.normalizePanel(this)):(c.removeClass(this.foldableNode,"fold-down"),c.addClass(this.foldableNode,"fold-up"),this.panelManager.minimizePanel(this)),this._setMobilePosition())},_onCloseBtnClicked:function(f){this.panelManager.closePanel(this);f.stopPropagation()},_normalizePositionObj:function(f){var e=this._getLayoutBox();f.left=
isFinite(f.left)?f.left:e.w-f.right;f.top=isFinite(f.top)?f.top:e.h-f.bottom;delete f.right;delete f.bottom;this.position=b.mixin(b.clone(this.position),f)},makePositionInfoBox:function(){this._positionInfoBox={w:this.position.width||400,h:this.position.height||410,l:this.position.left||0,t:this.position.top||0}},_makeOriginalBox:function(){this._originalBox={w:this.position.width||400,h:this.position.height||410,l:this.position.left||0,t:this.position.top||0}},makeResizable:function(){this.disableResizable();
this.resizeHandle=(new n({targetId:this,minWidth:this._originalBox.w,minHeight:this._originalBox.h,activeResize:!1})).placeAt(this.domNode);this.resizeHandle.startup()},disableResizable:function(){this.resizeHandle&&(this.resizeHandle.destroy(),this.resizeHandle=null)},makeMoveable:function(f,e){this.disableMoveable();var k=c.getMarginBox(jimuConfig.layoutId);k.l=k.l-f+e;k.w+=2*(f-e);this.moveable=new g.boxConstrainedMoveable(this.domNode,{box:k,handle:this.titleNode,within:!0});this.own(d(this.moveable,
"Moving",b.hitch(this,this.onMoving)));this.own(d(this.moveable,"MoveStop",b.hitch(this,this.onMoveStop)))},disableMoveable:function(){this.moveable&&(this.moveable.destroy(),this.moveable=null)},createHandleNode:function(){return this.titleNode},onOpen:function(){this._resizeOnOpen&&(this.resize(),this._resizeOnOpen=!1);this.inherited(arguments)},_switchToMobileUI:function(){c.removeClass(this.titleNode,"title-normal");c.addClass(this.titleNode,"title-full");c.setStyle(this.foldableNode,"display",
"block");c.setStyle(this.maxNode,"display","block");"normal"===this.windowState?(c.removeClass(this.foldableNode,"fold-up"),c.addClass(this.foldableNode,"fold-down")):(c.removeClass(this.foldableNode,"fold-down"),c.addClass(this.foldableNode,"fold-up"))},_switchToDesktopUI:function(){c.removeClass(this.titleNode,"title-full");c.addClass(this.titleNode,"title-normal");c.setStyle(this.foldableNode,"display","none");c.setStyle(this.maxNode,"display","none")},resize:function(f){var e=this._getPositionInfo(),
k={left:e.position.left,top:e.position.top,width:this._positionInfoBox.w,height:this._positionInfoBox.h};f&&(f.t=this.domNode.offsetTop,k.left=isFinite(f.l)?f.l:k.left,k.top=isFinite(f.t)?f.t:k.top,k.width=isFinite(f.w)?f.w:k.width,k.height=isFinite(f.h)?f.h:k.height,this._normalizePositionObj(b.clone(k)),this.makePositionInfoBox(),k.width=this._positionInfoBox.w,k.height=this._positionInfoBox.h);e.position=k;this._onResponsible(e);this.inherited(arguments)},_onResponsible:function(f){f.isRunInMobile?
(this._setMobilePosition(),this.disableMoveable(),this.disableResizable(),this._switchToMobileUI()):(this._setDesktopPosition(f.position),this.makeResizable(),this.makeMoveable(this._positionInfoBox.w,.25*this._positionInfoBox.w),this._switchToDesktopUI())},setPosition:function(f){this._normalizePositionObj(f);this.makePositionInfoBox();f=this._getPositionInfo();this._onResponsible(f)},destroy:function(){this.widgetIcon=null;this.inherited(arguments)},_getLayoutBox:function(){var f=jimuConfig.layoutId;
f="map"===this.position.relativeTo?jimuConfig.mapId:jimuConfig.layoutId;return c.getMarginBox(f)},_getPositionInfo:function(){var f={isRunInMobile:!1,position:{left:0,top:5}},e=this._getLayoutBox(),k=this._positionInfoBox.l;if(window.appInfo.isRunInMobile)return f.isRunInMobile=!0,f;f.position.left=window.isRTL?e.w-k:k;k=this._positionInfoBox.t;var r=e.h-k;k>=r?k>=this._positionInfoBox.h&&(f.position.top=this._positionInfoBox.t-this._positionInfoBox.h-40-3):r>=this._positionInfoBox.h&&(f.position.top=
this._positionInfoBox.t+40+3);!f.isRunInMobile&&f.position.left+this._positionInfoBox.w>e.w&&(f.position.left-=this._positionInfoBox.w);return f},_setMobilePosition:function(){c.place(this.domNode,jimuConfig.layoutId);var f=this.panelManager.getPositionOnMobile(this);this.position.zIndex&&(f.zIndex=this.position.zIndex);var e=l.getPositionStyle(f);b.mixin(e,f.borderRadiusStyle);c.setStyle(this.domNode,e)},_setDesktopPosition:function(f){c.place(this.domNode,jimuConfig.mapId);c.setStyle(this.domNode,
{left:f.left+"px",right:"auto",top:f.top+"px",width:(f.width||this.position.width||this._originalBox.w)+"px",height:(f.height||this.position.height||this._originalBox.h)+"px"})},onMoving:function(f){c.setStyle(f.node,"opacity",.9)},onMoveStop:function(f){c.setStyle(f.node,"opacity",1);f=c.getMarginBox(f.node);this._normalizePositionObj(b.clone({left:f.l,top:f.t,width:f.w,height:f.h}));this.makePositionInfoBox()}})})},"dojox/layout/ResizeHandle":function(){define("dojo/_base/kernel dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/event dojo/_base/fx dojo/_base/window dojo/fx dojo/dom dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/declare dojo/touch dijit/_base/manager dijit/_Widget dijit/_TemplatedMixin".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m){a.experimental("dojox.layout.ResizeHandle");var u=r("dojox.layout._ResizeHelper",h,{show:function(){k.set(this.domNode,"display","")},hide:function(){k.set(this.domNode,"display","none")},resize:function(t){e.setMarginBox(this.domNode,t)}});return r("dojox.layout.ResizeHandle",[h,m],{targetId:"",targetContainer:null,resizeAxis:"xy",activeResize:!1,activeResizeClass:"dojoxResizeHandleClone",animateSizing:!0,animateMethod:"chain",animateDuration:225,minHeight:100,
minWidth:100,constrainMax:!1,maxHeight:0,maxWidth:0,fixedAspect:!1,intermediateChanges:!1,startTopic:"/dojo/resize/start",endTopic:"/dojo/resize/stop",templateString:'\x3cdiv dojoAttachPoint\x3d"resizeHandle" class\x3d"dojoxResizeHandle"\x3e\x3cdiv\x3e\x3c/div\x3e\x3c/div\x3e',postCreate:function(){this.connect(this.resizeHandle,y.press,"_beginSizing");this.activeResize?this.animateSizing=!1:(this._resizeHelper=p.byId("dojoxGlobalResizeHelper"),this._resizeHelper||(this._resizeHelper=(new u({id:"dojoxGlobalResizeHelper"})).placeAt(w.body()),
f.add(this._resizeHelper.domNode,this.activeResizeClass)));this.minSize||(this.minSize={w:this.minWidth,h:this.minHeight});this.constrainMax&&(this.maxSize={w:this.maxWidth,h:this.maxHeight});this._resizeX=this._resizeY=!1;var t=b.partial(f.add,this.resizeHandle);switch(this.resizeAxis.toLowerCase()){case "xy":this._resizeX=this._resizeY=!0;t("dojoxResizeNW");break;case "x":this._resizeX=!0;t("dojoxResizeW");break;case "y":this._resizeY=!0,t("dojoxResizeN")}},_beginSizing:function(t){if(!this._isSizing&&
(c.publish(this.startTopic,[this]),this.targetDomNode=(this.targetWidget=p.byId(this.targetId))?this.targetWidget.domNode:n.byId(this.targetId),this.targetContainer&&(this.targetDomNode=this.targetContainer),this.targetDomNode)){if(!this.activeResize){var q=e.position(this.targetDomNode,!0);this._resizeHelper.resize({l:q.x,t:q.y,w:q.w,h:q.h});this._resizeHelper.show();this.isLeftToRight()||(this._resizeHelper.startPosition={l:q.x,t:q.y})}this._isSizing=!0;this.startPoint={x:t.clientX,y:t.clientY};
q=k.getComputedStyle(this.targetDomNode);var z="border-model"===e.boxModel?{w:0,h:0}:e.getPadBorderExtents(this.targetDomNode,q),v=e.getMarginExtents(this.targetDomNode,q);this.startSize={w:k.get(this.targetDomNode,"width",q),h:k.get(this.targetDomNode,"height",q),pbw:z.w,pbh:z.h,mw:v.w,mh:v.h};this.isLeftToRight()||"absolute"!=k.get(this.targetDomNode,"position")||(q=e.position(this.targetDomNode,!0),this.startPosition={l:q.x,t:q.y});this._pconnects=[c.connect(w.doc,y.move,this,"_updateSizing"),
c.connect(w.doc,y.release,this,"_endSizing")];g.stop(t)}},_updateSizing:function(t){if(this.activeResize)this._changeSizing(t);else{var q=this._getNewCoords(t,"border",this._resizeHelper.startPosition);if(!1===q)return;this._resizeHelper.resize(q)}t.preventDefault()},_getNewCoords:function(t,q,z){try{if(!t.clientX||!t.clientY)return!1}catch(A){return!1}this._activeResizeLastEvent=t;var v=(this.isLeftToRight()?1:-1)*(this.startPoint.x-t.clientX),B=this.startPoint.y-t.clientY;t=this.startSize.w-(this._resizeX?
v:0);B=this._checkConstraints(t,this.startSize.h-(this._resizeY?B:0));(z=z||this.startPosition)&&this._resizeX&&(B.l=z.l+v,B.w!=t&&(B.l+=t-B.w),B.t=z.t);switch(q){case "margin":B.w+=this.startSize.mw,B.h+=this.startSize.mh;case "border":B.w+=this.startSize.pbw,B.h+=this.startSize.pbh}return B},_checkConstraints:function(t,q){if(this.minSize){var z=this.minSize;t<z.w&&(t=z.w);q<z.h&&(q=z.h)}this.constrainMax&&this.maxSize&&(z=this.maxSize,t>z.w&&(t=z.w),q>z.h&&(q=z.h));if(this.fixedAspect){z=this.startSize.w;
var v=this.startSize.h,B=z*q-v*t;0>B?t=q*z/v:0<B&&(q=t*v/z)}return{w:t,h:q}},_changeSizing:function(t){var q=this.targetWidget&&b.isFunction(this.targetWidget.resize),z=this._getNewCoords(t,q&&"margin");if(!1!==z&&(q?this.targetWidget.resize(z):this.animateSizing?l[this.animateMethod]([x.animateProperty({node:this.targetDomNode,properties:{width:{start:this.startSize.w,end:z.w}},duration:this.animateDuration}),x.animateProperty({node:this.targetDomNode,properties:{height:{start:this.startSize.h,end:z.h}},
duration:this.animateDuration})]).play():k.set(this.targetDomNode,{width:z.w+"px",height:z.h+"px"}),this.intermediateChanges))this.onResize(t)},_endSizing:function(t){d.forEach(this._pconnects,c.disconnect);var q=b.partial(c.publish,this.endTopic,[this]);this.activeResize?q():(this._resizeHelper.hide(),this._changeSizing(t),setTimeout(q,this.animateDuration+15));this._isSizing=!1;this.onResize(t)},onResize:function(t){}})})},"dojo/fx":function(){define("./_base/lang ./Evented ./_base/kernel ./_base/array ./aspect ./_base/fx ./dom ./dom-style ./dom-geometry ./ready require".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e){c.isAsync||f(0,function(){e(["./fx/Toggler"])});c=c.fx={};f={_fire:function(y,p){this[y]&&this[y].apply(this,p||[]);return this}};var k=function(y){this._index=-1;this._animations=y||[];this._current=this._onAnimateCtx=this._onEndCtx=null;this.duration=0;d.forEach(this._animations,function(p){p&&("undefined"!=typeof p.duration&&(this.duration+=p.duration),p.delay&&(this.duration+=p.delay))},this)};k.prototype=new b;a.extend(k,{_onAnimate:function(){this._fire("onAnimate",
arguments)},_onEnd:function(){this._onAnimateCtx.remove();this._onEndCtx.remove();this._onAnimateCtx=this._onEndCtx=null;this._index+1==this._animations.length?this._fire("onEnd"):(this._current=this._animations[++this._index],this._onAnimateCtx=g.after(this._current,"onAnimate",a.hitch(this,"_onAnimate"),!0),this._onEndCtx=g.after(this._current,"onEnd",a.hitch(this,"_onEnd"),!0),this._current.play(0,!0))},play:function(y,p){this._current||(this._current=this._animations[this._index=0]);if(!p&&"playing"==
this._current.status())return this;var h=g.after(this._current,"beforeBegin",a.hitch(this,function(){this._fire("beforeBegin")}),!0),m=g.after(this._current,"onBegin",a.hitch(this,function(t){this._fire("onBegin",arguments)}),!0),u=g.after(this._current,"onPlay",a.hitch(this,function(t){this._fire("onPlay",arguments);h.remove();m.remove();u.remove()}));this._onAnimateCtx&&this._onAnimateCtx.remove();this._onAnimateCtx=g.after(this._current,"onAnimate",a.hitch(this,"_onAnimate"),!0);this._onEndCtx&&
this._onEndCtx.remove();this._onEndCtx=g.after(this._current,"onEnd",a.hitch(this,"_onEnd"),!0);this._current.play.apply(this._current,arguments);return this},pause:function(){if(this._current){var y=g.after(this._current,"onPause",a.hitch(this,function(p){this._fire("onPause",arguments);y.remove()}),!0);this._current.pause()}return this},gotoPercent:function(y,p){this.pause();var h=this.duration*y;this._current=null;d.some(this._animations,function(m,u){if(h<=m.duration)return this._current=m,this._index=
u,!0;h-=m.duration;return!1},this);this._current&&this._current.gotoPercent(h/this._current.duration);p&&this.play();return this},stop:function(y){if(this._current){if(y){for(;this._index+1<this._animations.length;++this._index)this._animations[this._index].stop(!0);this._current=this._animations[this._index]}var p=g.after(this._current,"onStop",a.hitch(this,function(h){this._fire("onStop",arguments);p.remove()}),!0);this._current.stop()}return this},status:function(){return this._current?this._current.status():
"stopped"},destroy:function(){this.stop();this._onAnimateCtx&&this._onAnimateCtx.remove();this._onEndCtx&&this._onEndCtx.remove()}});a.extend(k,f);c.chain=function(y){return new k(a.isArray(y)?y:Array.prototype.slice.call(y,0))};var r=function(y){this._animations=y||[];this._connects=[];this.duration=this._finished=0;d.forEach(y,function(h){var m=h.duration;h.delay&&(m+=h.delay);this.duration<m&&(this.duration=m);this._connects.push(g.after(h,"onEnd",a.hitch(this,"_onEnd"),!0))},this);this._pseudoAnimation=
new x.Animation({curve:[0,1],duration:this.duration});var p=this;d.forEach("beforeBegin onBegin onPlay onAnimate onPause onStop onEnd".split(" "),function(h){p._connects.push(g.after(p._pseudoAnimation,h,function(){p._fire(h,arguments)},!0))})};a.extend(r,{_doAction:function(y,p){d.forEach(this._animations,function(h){h[y].apply(h,p)});return this},_onEnd:function(){++this._finished>this._animations.length&&this._fire("onEnd")},_call:function(y,p){var h=this._pseudoAnimation;h[y].apply(h,p)},play:function(y,
p){this._finished=0;this._doAction("play",arguments);this._call("play",arguments);return this},pause:function(){this._doAction("pause",arguments);this._call("pause",arguments);return this},gotoPercent:function(y,p){var h=this.duration*y;d.forEach(this._animations,function(m){m.gotoPercent(m.duration<h?1:h/m.duration,p)});this._call("gotoPercent",arguments);return this},stop:function(y){this._doAction("stop",arguments);this._call("stop",arguments);return this},status:function(){return this._pseudoAnimation.status()},
destroy:function(){this.stop();d.forEach(this._connects,function(y){y.remove()})}});a.extend(r,f);c.combine=function(y){return new r(a.isArray(y)?y:Array.prototype.slice.call(y,0))};c.wipeIn=function(y){var p=y.node=w.byId(y.node),h=p.style,m;y=x.animateProperty(a.mixin({properties:{height:{start:function(){m=h.overflow;h.overflow="hidden";if("hidden"==h.visibility||"none"==h.display)return h.height="1px",h.display="",h.visibility="",1;var t=l.get(p,"height");return Math.max(t,1)},end:function(){return p.scrollHeight}}}},
y));var u=function(){h.height="auto";h.overflow=m};g.after(y,"onStop",u,!0);g.after(y,"onEnd",u,!0);return y};c.wipeOut=function(y){var p=(y.node=w.byId(y.node)).style,h;y=x.animateProperty(a.mixin({properties:{height:{end:1}}},y));g.after(y,"beforeBegin",function(){h=p.overflow;p.overflow="hidden";p.display=""},!0);var m=function(){p.overflow=h;p.height="auto";p.display="none"};g.after(y,"onStop",m,!0);g.after(y,"onEnd",m,!0);return y};c.slideTo=function(y){var p=null,h=null,m=function(u){return function(){var t=
l.getComputedStyle(u),q=t.position;p="absolute"==q?u.offsetTop:parseInt(t.top)||0;h="absolute"==q?u.offsetLeft:parseInt(t.left)||0;"absolute"!=q&&"relative"!=q&&(t=n.position(u,!0),p=t.y,h=t.x,u.style.position="absolute",u.style.top=p+"px",u.style.left=h+"px")}}(y.node=w.byId(y.node));m();y=x.animateProperty(a.mixin({properties:{top:y.top||0,left:y.left||0}},y));g.after(y,"beforeBegin",m,!0);return y};return c})},"dijit/_base/manager":function(){define(["dojo/_base/array","dojo/_base/config","dojo/_base/lang",
"../registry","../main"],function(a,b,c,d,g){var x={};a.forEach("byId getUniqueId findWidgets _destroyAll byNode getEnclosingWidget".split(" "),function(w){x[w]=d[w]});c.mixin(x,{defaultDuration:b.defaultDuration||200});c.mixin(g,x);return g})},"dijit/_Widget":function(){define("dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/has dojo/_base/kernel dojo/_base/lang dojo/query dojo/ready ./registry ./_WidgetBase ./_OnDijitClickMixin ./_FocusMixin dojo/uacss ./hccss".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r){function y(){}function p(h){return function(m,u,t,q){return m&&"string"==typeof u&&m[u]==y?m.on(u.substring(2).toLowerCase(),w.hitch(t,q)):h.apply(c,arguments)}}a.around(c,"connect",p);x.connect&&a.around(x,"connect",p);a=d("dijit._Widget",[e,k,r],{onClick:y,onDblClick:y,onKeyDown:y,onKeyPress:y,onKeyUp:y,onMouseDown:y,onMouseMove:y,onMouseOut:y,onMouseOver:y,onMouseLeave:y,onMouseEnter:y,onMouseUp:y,constructor:function(h){this._toConnect={};for(var m in h)this[m]===
y&&(this._toConnect[m.replace(/^on/,"").toLowerCase()]=h[m],delete h[m])},postCreate:function(){this.inherited(arguments);for(var h in this._toConnect)this.on(h,this._toConnect[h]);delete this._toConnect},on:function(h,m){return this[this._onMap(h)]===y?c.connect(this.domNode,h.toLowerCase(),this,m):this.inherited(arguments)},_setFocusedAttr:function(h){this._focused=h;this._set("focused",h)},setAttribute:function(h,m){x.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.",
"","2.0");this.set(h,m)},attr:function(h,m){return 2<=arguments.length||"object"===typeof h?this.set.apply(this,arguments):this.get(h)},getDescendants:function(){x.deprecated(this.declaredClass+"::getDescendants() is deprecated. Use getChildren() instead.","","2.0");return this.containerNode?l("[widgetId]",this.containerNode).map(f.byNode):[]},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return!0}});g("dijit-legacy-requires")&&n(0,function(){require(["dijit/_base"])});
return a})},"dijit/_OnDijitClickMixin":function(){define("dojo/on dojo/_base/array dojo/keys dojo/_base/declare dojo/has ./a11yclick".split(" "),function(a,b,c,d,g,x){a=d("dijit._OnDijitClickMixin",null,{connect:function(w,l,n){return this.inherited(arguments,[w,"ondijitclick"==l?x:l,n])}});a.a11yclick=x;return a})},"dijit/a11yclick":function(){define(["dojo/keys","dojo/mouse","dojo/on","dojo/touch"],function(a,b,c,d){function g(l){if((l.keyCode===a.ENTER||l.keyCode===a.SPACE)&&!/input|button|textarea/i.test(l.target.nodeName))for(l=
l.target;l;l=l.parentNode)if(l.dojoClick)return!0}var x;c(document,"keydown",function(l){g(l)?(x=l.target,l.preventDefault()):x=null});c(document,"keyup",function(l){g(l)&&l.target==x&&(x=null,c.emit(l.target,"click",{cancelable:!0,bubbles:!0,ctrlKey:l.ctrlKey,shiftKey:l.shiftKey,metaKey:l.metaKey,altKey:l.altKey,_origType:l.type}))});var w=function(l,n){l.dojoClick=!0;return c(l,"click",n)};w.click=w;w.press=function(l,n){var f=c(l,d.press,function(k){("mousedown"!=k.type||b.isLeft(k))&&n(k)}),e=
c(l,"keydown",function(k){k.keyCode!==a.ENTER&&k.keyCode!==a.SPACE||n(k)});return{remove:function(){f.remove();e.remove()}}};w.release=function(l,n){var f=c(l,d.release,function(k){("mouseup"!=k.type||b.isLeft(k))&&n(k)}),e=c(l,"keyup",function(k){k.keyCode!==a.ENTER&&k.keyCode!==a.SPACE||n(k)});return{remove:function(){f.remove();e.remove()}}};w.move=d.move;return w})},"dijit/_FocusMixin":function(){define(["./focus","./_WidgetBase","dojo/_base/declare","dojo/_base/lang"],function(a,b,c,d){d.extend(b,
{focused:!1,onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()}});return c("dijit._FocusMixin",null,{_focusManager:a})})},"dijit/focus":function(){define("dojo/aspect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/Evented dojo/_base/lang dojo/on dojo/domReady dojo/sniff dojo/Stateful dojo/_base/window dojo/window ./a11y ./registry ./main".split(" "),function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m){var u,t,q=new (b([k,
w],{curNode:null,activeStack:[],constructor:function(){var v=l.hitch(this,function(B){c.isDescendant(this.curNode,B)&&this.set("curNode",null);c.isDescendant(this.prevNode,B)&&this.set("prevNode",null)});a.before(x,"empty",v);a.before(x,"destroy",v)},registerIframe:function(v){return this.registerWin(v.contentWindow,v)},registerWin:function(v,B){var A=this,E=v.document&&v.document.body;if(E){var C=n(v.document,"pointerdown",function(G){G&&G.target&&null==G.target.parentNode||A._onTouchNode(B||G.target,
"mouse")}),D=n(E,"focusin",function(G){if(G.target.tagName){var J=G.target.tagName.toLowerCase();"#document"!=J&&"body"!=J&&(p.isFocusable(G.target)?A._onFocusNode(B||G.target):A._onTouchNode(B||G.target))}}),F=n(E,"focusout",function(G){A._onBlurNode(B||G.target)});return{remove:function(){C.remove();D.remove();F.remove();E=C=D=F=null}}}},_onBlurNode:function(v){v=(new Date).getTime();v<u+100||(this._clearFocusTimer&&clearTimeout(this._clearFocusTimer),this._clearFocusTimer=setTimeout(l.hitch(this,
function(){this.set("prevNode",this.curNode);this.set("curNode",null)}),0),this._clearActiveWidgetsTimer&&clearTimeout(this._clearActiveWidgetsTimer),v<t+100||(this._clearActiveWidgetsTimer=setTimeout(l.hitch(this,function(){delete this._clearActiveWidgetsTimer;this._setStack([])}),0)))},_onTouchNode:function(v,B){t=(new Date).getTime();this._clearActiveWidgetsTimer&&(clearTimeout(this._clearActiveWidgetsTimer),delete this._clearActiveWidgetsTimer);g.contains(v,"dijitPopup")&&(v=v.firstChild);var A=
[];try{for(;v;){var E=d.get(v,"dijitPopupParent");if(E)v=h.byId(E).domNode;else if(v.tagName&&"body"==v.tagName.toLowerCase()){if(v===r.body())break;v=y.get(v.ownerDocument).frameElement}else{var C=v.getAttribute&&v.getAttribute("widgetId"),D=C&&h.byId(C);!D||"mouse"==B&&D.get("disabled")||A.unshift(C);v=v.parentNode}}}catch(F){}this._setStack(A,B)},_onFocusNode:function(v){v&&9!=v.nodeType&&(u=(new Date).getTime(),this._clearFocusTimer&&(clearTimeout(this._clearFocusTimer),delete this._clearFocusTimer),
this._onTouchNode(v),v!=this.curNode&&(this.set("prevNode",this.curNode),this.set("curNode",v)))},_setStack:function(v,B){var A=this.activeStack,E=A.length-1,C=v.length-1;if(v[C]!=A[E]){this.set("activeStack",v);var D;for(D=E;0<=D&&A[D]!=v[D];D--)if(E=h.byId(A[D]))E._hasBeenBlurred=!0,E.set("focused",!1),E._focusManager==this&&E._onBlur(B),this.emit("widget-blur",E,B);for(D++;D<=C;D++)if(E=h.byId(v[D]))E.set("focused",!0),E._focusManager==this&&E._onFocus(B),this.emit("widget-focus",E,B)}},focus:function(v){if(v)try{v.focus()}catch(B){}}}));
f(function(){var v=q.registerWin(y.get(document));e("ie")&&n(window,"unload",function(){v&&(v.remove(),v=null)})});m.focus=function(v){q.focus(v)};for(var z in q)/^_/.test(z)||(m.focus[z]="function"==typeof q[z]?l.hitch(q,z):q[z]);q.watch(function(v,B,A){m.focus[v]=A});return q})},"dijit/a11y":function(){define("dojo/_base/array dojo/dom dojo/dom-attr dojo/dom-style dojo/_base/lang dojo/sniff ./main".split(" "),function(a,b,c,d,g,x,w){var l={_isElementShown:function(n){var f=d.get(n);return"hidden"!=
f.visibility&&"collapsed"!=f.visibility&&"none"!=f.display&&"hidden"!=c.get(n,"type")},hasDefaultTabStop:function(n){switch(n.nodeName.toLowerCase()){case "a":return c.has(n,"href");case "area":case "button":case "input":case "object":case "select":case "textarea":return!0;case "iframe":try{var f=n.contentDocument;if("designMode"in f&&"on"==f.designMode)return!0;var e=f.body}catch(k){try{e=n.contentWindow.document.body}catch(r){return!1}}return e&&("true"==e.contentEditable||e.firstChild&&"true"==
e.firstChild.contentEditable);default:return"true"==n.contentEditable}},effectiveTabIndex:function(n){if(!c.get(n,"disabled"))return c.has(n,"tabIndex")?+c.get(n,"tabIndex"):l.hasDefaultTabStop(n)?0:void 0},isTabNavigable:function(n){return 0<=l.effectiveTabIndex(n)},isFocusable:function(n){return-1<=l.effectiveTabIndex(n)},_getTabNavigable:function(n){function f(v){return v&&"input"==v.tagName.toLowerCase()&&v.type&&"radio"==v.type.toLowerCase()&&v.name&&v.name.toLowerCase()}function e(v){return u[f(v)]||
v}var k,r,y,p,h,m,u={},t=l._isElementShown,q=l.effectiveTabIndex,z=function(v){for(v=v.firstChild;v;v=v.nextSibling)if(!(1!=v.nodeType||9>=x("ie")&&"HTML"!==v.scopeName)&&t(v)){var B=q(v);if(0<=B){if(0==B)k||(k=v),r=v;else if(0<B){if(!y||B<p)p=B,y=v;if(!h||B>=m)m=B,h=v}B=f(v);c.get(v,"checked")&&B&&(u[B]=v)}"SELECT"!=v.nodeName.toUpperCase()&&z(v)}};t(n)&&z(n);return{first:e(k),last:e(r),lowest:e(y),highest:e(h)}},getFirstInTabbingOrder:function(n,f){n=l._getTabNavigable(b.byId(n,f));return n.lowest?
n.lowest:n.first},getLastInTabbingOrder:function(n,f){n=l._getTabNavigable(b.byId(n,f));return n.last?n.last:n.highest}};g.mixin(w,l);return l})},"dojo/uacss":function(){define(["./dom-geometry","./_base/lang","./domReady","./sniff","./_base/window"],function(a,b,c,d,g){var x=g.doc.documentElement;g=d("ie");var w=d("opera"),l=Math.floor,n=a.boxModel.replace(/-/,"");w={dj_quirks:0,dj_opera:w,dj_khtml:0,dj_webkit:d("webkit"),dj_safari:d("safari"),dj_chrome:d("chrome"),dj_edge:1,dj_gecko:1,dj_ios:d("ios"),
dj_android:0};g&&(w.dj_ie=!0,w["dj_ie"+l(g)]=!0,w.dj_iequirks=0);w["dj_ff"+l(1)]=!0;w["dj_"+n]=!0;var f="",e;for(e in w)w[e]&&(f+=e+" ");x.className=b.trim(x.className+" "+f);c(function(){if(!a.isBodyLtr()){var k="dj_rtl dijitRtl "+f.replace(/ /g,"-rtl ");x.className=b.trim(x.className+" "+k+"dj_rtl dijitRtl "+f.replace(/ /g,"-rtl "))}});return d})},"dijit/hccss":function(){define(["dojo/dom-class","dojo/hccss","dojo/domReady","dojo/_base/window"],function(a,b,c,d){c(function(){b("highcontrast")&&
a.add(d.body(),"dijit_a11y")});return b})},"dojo/hccss":function(){define("require ./_base/config ./dom-class ./dom-style ./has ./domReady ./_base/window".split(" "),function(a,b,c,d,g,x,w){g.add("highcontrast",function(){var l=w.doc.createElement("div");try{l.style.cssText='border: 1px solid; border-color:red green; position: absolute; height: 5px; top: -999px;background-image: url("'+(b.blankGif||a.toUrl("./resources/blank.gif"))+'");';w.body().appendChild(l);var n=d.getComputedStyle(l),f=n.backgroundImage;
return n.borderTopColor==n.borderRightColor||f&&("none"==f||"url(invalid-url:)"==f)}catch(e){return console.warn("hccss: exception detecting high-contrast mode, document is likely hidden: "+e.toString()),!1}finally{8>=g("ie")?l.outerHTML="":w.body().removeChild(l)}});x(function(){g("highcontrast")&&c.add(w.body(),"dj_a11y")});return g})},"dijit/layout/_LayoutWidget":function(){define("dojo/_base/lang ../_Widget ../_Container ../_Contained ../Viewport dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style".split(" "),
function(a,b,c,d,g,x,w,l,n){return x("dijit.layout._LayoutWidget",[b,c,d],{baseClass:"dijitLayoutContainer",isLayoutContainer:!0,_setTitleAttr:null,buildRendering:function(){this.inherited(arguments);w.add(this.domNode,"dijitContainer")},startup:function(){if(!this._started){this.inherited(arguments);var f=this.getParent&&this.getParent();f&&f.isLayoutContainer||(this.resize(),this.own(g.on("resize",a.hitch(this,"resize"))))}},resize:function(f,e){var k=this.domNode;f&&l.setMarginBox(k,f);e=e||{};
a.mixin(e,f||{});"h"in e&&"w"in e||(e=a.mixin(l.getMarginBox(k),e));f=n.getComputedStyle(k);var r=l.getMarginExtents(k,f),y=l.getBorderExtents(k,f);e=this._borderBox={w:e.w-(r.w+y.w),h:e.h-(r.h+y.h)};r=l.getPadExtents(k,f);this._contentBox={l:n.toPixelValue(k,f.paddingLeft),t:n.toPixelValue(k,f.paddingTop),w:e.w-r.w,h:e.h-r.h};this.layout()},layout:function(){},_setupChild:function(f){w.add(f.domNode,this.baseClass+"-child "+(f.baseClass?this.baseClass+"-"+f.baseClass:""))},addChild:function(f,e){this.inherited(arguments);
this._started&&this._setupChild(f)},removeChild:function(f){w.remove(f.domNode,this.baseClass+"-child"+(f.baseClass?" "+this.baseClass+"-"+f.baseClass:""));this.inherited(arguments)}})})},"dijit/_Contained":function(){define(["dojo/_base/declare","./registry"],function(a,b){return a("dijit._Contained",null,{_getSibling:function(c){var d=this.getParent();return d&&d._getSiblingOfChild&&d._getSiblingOfChild(this,"previous"==c?-1:1)||null},getPreviousSibling:function(){return this._getSibling("previous")},
getNextSibling:function(){return this._getSibling("next")},getIndexInParent:function(){var c=this.getParent();return c&&c.getIndexOfChild?c.getIndexOfChild(this):-1}})})},"dijit/Viewport":function(){define(["dojo/Evented","dojo/on","dojo/domReady","dojo/sniff","dojo/window"],function(a,b,c,d,g){var x=new a,w;c(function(){var l=g.getBox();x._rlh=b(window,"resize",function(){var f=g.getBox();if(l.h!=f.h||l.w!=f.w)l=f,x.emit("resize")});if(8==d("ie")){var n=screen.deviceXDPI;setInterval(function(){screen.deviceXDPI!=
n&&(n=screen.deviceXDPI,x.emit("resize"))},500)}d("ios")&&(b(document,"focusin",function(f){w=f.target}),b(document,"focusout",function(f){w=null}))});x.getEffectiveBox=function(l){l=g.getBox(l);var n=w&&w.tagName&&w.tagName.toLowerCase();d("ios")&&w&&!w.readOnly&&("textarea"==n||"input"==n&&/^(color|email|number|password|search|tel|text|url)$/.test(w.type))&&(l.h*=0==orientation||180==orientation?.66:.4,n=w.getBoundingClientRect(),l.h=Math.max(l.h,n.top+n.height));return l};return x})},"dijit/Menu":function(){define("require dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ./popup ./DropDownMenu dojo/ready".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h){e("dijit-legacy-requires")&&h(0,function(){a(["dijit/MenuItem","dijit/PopupMenuItem","dijit/CheckedMenuItem","dijit/MenuSeparator"])});return c("dijit.Menu",p,{constructor:function(){this._bindings=[]},targetNodeIds:[],selector:"",contextMenuForWindow:!1,leftClickToOpen:!1,refocus:!0,postCreate:function(){this.contextMenuForWindow?this.bindDomNode(this.ownerDocumentBody):b.forEach(this.targetNodeIds,this.bindDomNode,this);this.inherited(arguments)},_iframeContentWindow:function(m){return r.get(this._iframeContentDocument(m))||
this._iframeContentDocument(m).__parent__||m.name&&document.frames[m.name]||null},_iframeContentDocument:function(m){return m.contentDocument||m.contentWindow&&m.contentWindow.document||m.name&&document.frames[m.name]&&document.frames[m.name].document||null},bindDomNode:function(m){m=d.byId(m,this.ownerDocument);if("iframe"==m.tagName.toLowerCase()){var u=m;var t=this._iframeContentWindow(u);t=k.body(t.document)}else t=m==k.body(this.ownerDocument)?this.ownerDocument.documentElement:m;var q={node:m,
iframe:u};g.set(m,"_dijitMenu"+this.id,this._bindings.push(q));var z=n.hitch(this,function(v){var B=this.selector,A=B?function(C){return f.selector(B,C)}:function(C){return C},E=this;return[f(v,A(this.leftClickToOpen?"click":"contextmenu"),function(C){C.stopPropagation();C.preventDefault();(new Date).getTime()<E._lastKeyDown+500||E._scheduleOpen(this,u,{x:C.pageX,y:C.pageY},C.target)}),f(v,A("keydown"),function(C){if(93==C.keyCode||C.shiftKey&&C.keyCode==l.F10||E.leftClickToOpen&&C.keyCode==l.SPACE)C.stopPropagation(),
C.preventDefault(),E._scheduleOpen(this,u,null,C.target),E._lastKeyDown=(new Date).getTime()})]});q.connects=t?z(t):[];u&&(q.onloadHandler=n.hitch(this,function(){var v=this._iframeContentWindow(u);v=k.body(v.document);q.connects=z(v)}),u.addEventListener?u.addEventListener("load",q.onloadHandler,!1):u.attachEvent("onload",q.onloadHandler))},unBindDomNode:function(m){try{var u=d.byId(m,this.ownerDocument)}catch(v){return}m="_dijitMenu"+this.id;if(u&&g.has(u,m)){for(var t=g.get(u,m)-1,q=this._bindings[t],
z;z=q.connects.pop();)z.remove();(z=q.iframe)&&(z.removeEventListener?z.removeEventListener("load",q.onloadHandler,!1):z.detachEvent("onload",q.onloadHandler));g.remove(u,m);delete this._bindings[t]}},_scheduleOpen:function(m,u,t,q){this._openTimer||(this._openTimer=this.defer(function(){delete this._openTimer;this._openMyself({target:q,delegatedTarget:m,iframe:u,coords:t})},1))},_openMyself:function(m){function u(){C.refocus&&D&&D.focus();y.close(C)}var t=m.target,q=m.iframe,z=m.coords,v=!z;this.currentTarget=
m.delegatedTarget;if(z){if(q){m=x.position(q,!0);t=this._iframeContentWindow(q);t=x.docScroll(t.document);var B=w.getComputedStyle(q),A=w.toPixelValue,E=(e("ie"),A(q,B.paddingLeft))+(e("ie"),0);q=(e("ie"),A(q,B.paddingTop))+(e("ie"),0);z.x+=m.x+E-t.x;z.y+=m.y+q-t.y}}else z=x.position(t,!0),z.x+=10,z.y+=10;var C=this;q=this._focusManager.get("prevNode");m=this._focusManager.get("curNode");var D=!m||d.isDescendant(m,this.domNode)?q:m;y.open({popup:this,x:z.x,y:z.y,onExecute:u,onCancel:u,orient:this.isLeftToRight()?
"L":"R"});this.focus();v||this.defer(function(){this._cleanUp(!0)});this._onBlur=function(){this.inherited("_onBlur",arguments);y.close(this)}},destroy:function(){b.forEach(this._bindings,function(m){m&&this.unBindDomNode(m.node)},this);this.inherited(arguments)}})})},"dijit/popup":function(){define("dojo/_base/array dojo/aspect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/keys dojo/_base/lang dojo/on ./place ./BackgroundIframe ./Viewport ./main dojo/touch".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h){function m(){this._popupWrapper&&(x.destroy(this._popupWrapper),delete this._popupWrapper)}c=c(null,{_stack:[],_beginZIndex:1E3,_idGen:1,_repositionAll:function(){if(this._firstAroundNode){var u=this._firstAroundPosition,t=w.position(this._firstAroundNode,!0),q=t.x-u.x;u=t.y-u.y;if(q||u)for(this._firstAroundPosition=t,t=0;t<this._stack.length;t++){var z=this._stack[t].wrapper.style;z.top=parseFloat(z.top)+u+"px";"auto"==z.right?z.left=parseFloat(z.left)+q+
"px":z.right=parseFloat(z.right)-q+"px"}this._aroundMoveListener=setTimeout(e.hitch(this,"_repositionAll"),q||u?10:50)}},_createWrapper:function(u){var t=u._popupWrapper,q=u.domNode;t||(t=x.create("div",{"class":"dijitPopup",style:{display:"none"},role:"region","aria-label":u["aria-label"]||u.label||u.name||u.id},u.ownerDocumentBody),t.appendChild(q),q=q.style,q.display="",q.visibility="",q.position="",q.top="0px",u._popupWrapper=t,b.after(u,"destroy",m,!0),"ontouchend"in document&&k(t,"touchend",
function(z){/^(input|button|textarea)$/i.test(z.target.tagName)||z.preventDefault()}),t.dojoClick=!0);return t},moveOffScreen:function(u){var t=this._createWrapper(u);u=w.isBodyLtr(u.ownerDocument);var q={visibility:"hidden",top:"-9999px",display:""};q[u?"left":"right"]="-9999px";q[u?"right":"left"]="auto";l.set(t,q);return t},hide:function(u){var t=this._createWrapper(u);l.set(t,{display:"none",height:"auto",overflowY:"visible",border:""});u=u.domNode;"_originalStyle"in u&&(u.style.cssText=u._originalStyle)},
getTopPopup:function(){for(var u=this._stack,t=u.length-1;0<t&&u[t].parent===u[t-1].widget;t--);return u[t]},open:function(u){for(var t=this._stack,q=u.popup,z=q.domNode,v=u.orient||["below","below-alt","above","above-alt"],B=u.parent?u.parent.isLeftToRight():w.isBodyLtr(q.ownerDocument),A=u.around,E=u.around&&u.around.id?u.around.id+"_dropdown":"popup_"+this._idGen++;t.length&&(!u.parent||!d.isDescendant(u.parent.domNode,t[t.length-1].widget.domNode));)this.close(t[t.length-1].widget);var C=this.moveOffScreen(q);
q.startup&&!q._started&&q.startup();var D=w.position(z);if("maxHeight"in u&&-1!=u.maxHeight)var F=u.maxHeight||Infinity;else{F=p.getEffectiveBox(this.ownerDocument);var G=A?w.position(A,!1):{y:u.y-(u.padding||0),h:2*(u.padding||0)};F=Math.floor(Math.max(G.y,F.h-(G.y+G.h)))}D.h>F&&(D=l.getComputedStyle(z),l.set(C,{overflowY:"scroll",height:F+"px",border:D.borderLeftWidth+" "+D.borderLeftStyle+" "+D.borderLeftColor}),z._originalStyle=z.style.cssText,z.style.border="none");g.set(C,{id:E,style:{zIndex:this._beginZIndex+
t.length},"class":"dijitPopup "+(q.baseClass||q["class"]||"").split(" ")[0]+"Popup",dijitPopupParent:u.parent?u.parent.id:""});0==t.length&&A&&(this._firstAroundNode=A,this._firstAroundPosition=w.position(A,!0),this._aroundMoveListener=setTimeout(e.hitch(this,"_repositionAll"),50));n("config-bgIframe")&&!q.bgIframe&&(q.bgIframe=new y(C));E=q.orient?e.hitch(q,"orient"):null;v=A?r.around(C,A,v,B,E):r.at(C,u,"R"==v?["TR","BR","TL","BL"]:["TL","BL","TR","BR"],u.padding,E);C.style.visibility="visible";
z.style.visibility="visible";z=[];z.push(k(C,"keydown",e.hitch(this,function(J){if(J.keyCode==f.ESCAPE&&u.onCancel)J.stopPropagation(),J.preventDefault(),u.onCancel();else if(J.keyCode==f.TAB&&(J.stopPropagation(),J.preventDefault(),(J=this.getTopPopup())&&J.onCancel))J.onCancel()})));q.onCancel&&u.onCancel&&z.push(q.on("cancel",u.onCancel));z.push(q.on(q.onExecute?"execute":"change",e.hitch(this,function(){var J=this.getTopPopup();if(J&&J.onExecute)J.onExecute()})));t.push({widget:q,wrapper:C,parent:u.parent,
onExecute:u.onExecute,onCancel:u.onCancel,onClose:u.onClose,handlers:z});if(q.onOpen)q.onOpen(v);return v},close:function(u){for(var t=this._stack;u&&a.some(t,function(A){return A.widget==u})||!u&&t.length;){var q=t.pop(),z=q.widget,v=q.onClose;z.bgIframe&&(z.bgIframe.destroy(),delete z.bgIframe);if(z.onClose)z.onClose();for(var B;B=q.handlers.pop();)B.remove();z&&z.domNode&&this.hide(z);v&&v()}0==t.length&&this._aroundMoveListener&&(clearTimeout(this._aroundMoveListener),this._firstAroundNode=this._firstAroundPosition=
this._aroundMoveListener=null)}});return h.popup=new c})},"dijit/place":function(){define("dojo/_base/array dojo/dom-geometry dojo/dom-style dojo/_base/kernel dojo/_base/window ./Viewport ./main".split(" "),function(a,b,c,d,g,x,w){function l(f,e,k,r){var y=x.getEffectiveBox(f.ownerDocument);f.parentNode&&"body"==String(f.parentNode.tagName).toLowerCase()||g.body(f.ownerDocument).appendChild(f);var p=null;a.some(e,function(u){var t=u.corner,q=u.pos,z=0,v={w:{L:y.l+y.w-q.x,R:q.x-y.l,M:y.w}[t.charAt(1)],
h:{T:y.t+y.h-q.y,B:q.y-y.t,M:y.h}[t.charAt(0)]},B=f.style;B.left=B.right="auto";k&&(z=k(f,u.aroundCorner,t,v,r),z="undefined"==typeof z?0:z);var A=f.style,E=A.display,C=A.visibility;"none"==A.display&&(A.visibility="hidden",A.display="");B=b.position(f);A.display=E;A.visibility=C;E={L:q.x,R:q.x-B.w,M:Math.max(y.l,Math.min(y.l+y.w,q.x+(B.w>>1))-B.w)}[t.charAt(1)];C={T:q.y,B:q.y-B.h,M:Math.max(y.t,Math.min(y.t+y.h,q.y+(B.h>>1))-B.h)}[t.charAt(0)];q=Math.max(y.l,E);A=Math.max(y.t,C);E=Math.min(y.l+y.w,
E+B.w)-q;C=Math.min(y.t+y.h,C+B.h)-A;z+=B.w-E+(B.h-C);if(null==p||z<p.overflow)p={corner:t,aroundCorner:u.aroundCorner,x:q,y:A,w:E,h:C,overflow:z,spaceAvailable:v};return!z});p.overflow&&k&&k(f,p.aroundCorner,p.corner,p.spaceAvailable,r);e=p.y;var h=p.x,m=g.body(f.ownerDocument);/relative|absolute/.test(c.get(m,"position"))&&(e-=c.get(m,"marginTop"),h-=c.get(m,"marginLeft"));m=f.style;m.top=e+"px";m.left=h+"px";m.right="auto";return p}var n={TL:"BR",TR:"BL",BL:"TR",BR:"TL"};return w.place={at:function(f,
e,k,r,y){k=a.map(k,function(p){var h={corner:p,aroundCorner:n[p],pos:{x:e.x,y:e.y}};r&&(h.pos.x+="L"==p.charAt(1)?r.x:-r.x,h.pos.y+="T"==p.charAt(0)?r.y:-r.y);return h});return l(f,k,y)},around:function(f,e,k,r,y){function p(D,F){C.push({aroundCorner:D,corner:F,pos:{x:{L:v,R:v+A,M:v+(A>>1)}[D.charAt(1)],y:{T:B,B:B+E,M:B+(E>>1)}[D.charAt(0)]}})}if("string"==typeof e||"offsetWidth"in e||"ownerSVGElement"in e){var h=b.position(e,!0);if(/^(above|below)/.test(k[0])){var m=b.getBorderExtents(e),u=e.firstChild?
b.getBorderExtents(e.firstChild):{t:0,l:0,b:0,r:0},t=b.getBorderExtents(f),q=f.firstChild?b.getBorderExtents(f.firstChild):{t:0,l:0,b:0,r:0};h.y+=Math.min(m.t+u.t,t.t+q.t);h.h-=Math.min(m.t+u.t,t.t+q.t)+Math.min(m.b+u.b,t.b+q.b)}}else h=e;if(e.parentNode)for(m="absolute"==c.getComputedStyle(e).position,e=e.parentNode;e&&1==e.nodeType&&"BODY"!=e.nodeName;){u=b.position(e,!0);t=c.getComputedStyle(e);/relative|absolute/.test(t.position)&&(m=!1);if(!m&&/hidden|auto|scroll/.test(t.overflow)){q=Math.min(h.y+
h.h,u.y+u.h);var z=Math.min(h.x+h.w,u.x+u.w);h.x=Math.max(h.x,u.x);h.y=Math.max(h.y,u.y);h.h=q-h.y;h.w=z-h.x}"absolute"==t.position&&(m=!0);e=e.parentNode}var v=h.x,B=h.y,A="w"in h?h.w:h.w=h.width,E="h"in h?h.h:(d.deprecated("place.around: dijit/place.__Rectangle: { x:"+v+", y:"+B+", height:"+h.height+", width:"+A+" } has been deprecated.  Please use { x:"+v+", y:"+B+", h:"+h.height+", w:"+A+" }","","2.0"),h.h=h.height),C=[];a.forEach(k,function(D){var F=r;switch(D){case "above-centered":p("TM","BM");
break;case "below-centered":p("BM","TM");break;case "after-centered":F=!F;case "before-centered":p(F?"ML":"MR",F?"MR":"ML");break;case "after":F=!F;case "before":p(F?"TL":"TR",F?"TR":"TL");p(F?"BL":"BR",F?"BR":"BL");break;case "below-alt":F=!F;case "below":p(F?"BL":"BR",F?"TL":"TR");p(F?"BR":"BL",F?"TR":"TL");break;case "above-alt":F=!F;case "above":p(F?"TL":"TR",F?"BL":"BR");p(F?"TR":"TL",F?"BR":"BL");break;default:p(D.aroundCorner,D.corner)}});f=l(f,C,y,{w:A,h:E});f.aroundNodePos=h;return f}}})},
"dijit/BackgroundIframe":function(){define("require ./main dojo/_base/config dojo/dom-construct dojo/dom-style dojo/_base/lang dojo/on dojo/sniff".split(" "),function(a,b,c,d,g,x,w,l){l.add("config-bgIframe",(l("ie")||0)&&!/IEMobile\/10\.0/.test(navigator.userAgent));var n=new function(){var f=[];this.pop=function(){if(f.length){var e=f.pop();e.style.display=""}else 9>l("ie")?(e=c.dojoBlankHtmlUrl||a.toUrl("dojo/resources/blank.html")||'javascript:""',e=document.createElement("\x3ciframe src\x3d'"+
e+"' role\x3d'presentation' style\x3d'position: absolute; left: 0px; top: 0px;z-index: -1; filter:Alpha(Opacity\x3d\"0\");'\x3e")):(e=d.create("iframe"),e.src='javascript:""',e.className="dijitBackgroundIframe",e.setAttribute("role","presentation"),g.set(e,"opacity",.1)),e.tabIndex=-1;return e};this.push=function(e){e.style.display="none";f.push(e)}};b.BackgroundIframe=function(f){if(!f.id)throw Error("no id");if(l("config-bgIframe")){var e=this.iframe=n.pop();f.appendChild(e);7>l("ie")?(this.resize(f),
this._conn=w(f,"resize",x.hitch(this,"resize",f))):g.set(e,{width:"100%",height:"100%"})}};x.extend(b.BackgroundIframe,{resize:function(f){this.iframe&&g.set(this.iframe,{width:f.offsetWidth+"px",height:f.offsetHeight+"px"})},destroy:function(){this._conn&&(this._conn.remove(),this._conn=null);this.iframe&&(this.iframe.parentNode.removeChild(this.iframe),n.push(this.iframe),delete this.iframe)}});return b.BackgroundIframe})},"dijit/DropDownMenu":function(){define(["dojo/_base/declare","dojo/keys",
"dojo/text!./templates/Menu.html","./_MenuBase"],function(a,b,c,d){return a("dijit.DropDownMenu",d,{templateString:c,baseClass:"dijitMenu",_onUpArrow:function(){this.focusPrev()},_onDownArrow:function(){this.focusNext()},_onRightArrow:function(g){this._moveToPopup(g);g.stopPropagation();g.preventDefault()},_onLeftArrow:function(g){if(this.parentMenu)if(this.parentMenu._isMenuBar)this.parentMenu.focusPrev();else this.onCancel(!1);else g.stopPropagation(),g.preventDefault()}})})},"dijit/_MenuBase":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/lang dojo/mouse dojo/on dojo/window ./a11yclick ./registry ./_Widget ./_CssStateMixin ./_KeyNavContainer ./_TemplatedMixin".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p){return b("dijit._MenuBase",[k,p,y,r],{selected:null,_setSelectedAttr:function(h){this.selected!=h&&(this.selected&&(this.selected._setSelected(!1),this._onChildDeselect(this.selected)),h&&h._setSelected(!0),this._set("selected",h))},activated:!1,_setActivatedAttr:function(h){g.toggle(this.domNode,"dijitMenuActive",h);g.toggle(this.domNode,"dijitMenuPassive",!h);this._set("activated",h)},parentMenu:null,popupDelay:500,passivePopupDelay:Infinity,autoFocus:!1,
childSelector:function(h){var m=e.byNode(h);return h.parentNode==this.containerNode&&m&&m.focus},postCreate:function(){var h=this,m="string"==typeof this.childSelector?this.childSelector:x.hitch(this,"childSelector");this.own(l(this.containerNode,l.selector(m,w.enter),function(){h.onItemHover(e.byNode(this))}),l(this.containerNode,l.selector(m,w.leave),function(){h.onItemUnhover(e.byNode(this))}),l(this.containerNode,l.selector(m,f),function(u){h.onItemClick(e.byNode(this),u);u.stopPropagation()}),
l(this.containerNode,l.selector(m,"focusin"),function(){h._onItemFocus(e.byNode(this))}));this.inherited(arguments)},onKeyboardSearch:function(h,m,u,t){this.inherited(arguments);if(h&&(-1==t||h.popup&&1==t))this.onItemClick(h,m)},_keyboardSearchCompare:function(h,m){return h.shortcutKey?m==h.shortcutKey.toLowerCase()?-1:0:this.inherited(arguments)?1:0},onExecute:function(){},onCancel:function(){},_moveToPopup:function(h){if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled)this.onItemClick(this.focusedChild,
h);else(h=this._getTopMenu())&&h._isMenuBar&&h.focusNext()},_onPopupHover:function(){this.set("selected",this.currentPopupItem);this._stopPendingCloseTimer()},onItemHover:function(h){this.activated?(this.set("selected",h),!h.popup||h.disabled||this.hover_timer||(this.hover_timer=this.defer(function(){this._openItemPopup(h)},this.popupDelay))):Infinity>this.passivePopupDelay&&(this.passive_hover_timer&&this.passive_hover_timer.remove(),this.passive_hover_timer=this.defer(function(){this.onItemClick(h,
{type:"click"})},this.passivePopupDelay));this._hoveredChild=h;h._set("hovering",!0)},_onChildDeselect:function(h){this._stopPopupTimer();this.currentPopupItem==h&&(this._stopPendingCloseTimer(),this._pendingClose_timer=this.defer(function(){this.currentPopupItem=this._pendingClose_timer=null;h._closePopup()},this.popupDelay))},onItemUnhover:function(h){this._hoveredChild==h&&(this._hoveredChild=null);this.passive_hover_timer&&(this.passive_hover_timer.remove(),this.passive_hover_timer=null);h._set("hovering",
!1)},_stopPopupTimer:function(){this.hover_timer&&(this.hover_timer=this.hover_timer.remove())},_stopPendingCloseTimer:function(){this._pendingClose_timer&&(this._pendingClose_timer=this._pendingClose_timer.remove())},_getTopMenu:function(){for(var h=this;h.parentMenu;h=h.parentMenu);return h},onItemClick:function(h,m){this.passive_hover_timer&&this.passive_hover_timer.remove();this.focusChild(h);if(h.disabled)return!1;h.popup?(this.set("selected",h),this.set("activated",!0),m=/^key/.test(m._origType||
m.type)||0==m.clientX&&0==m.clientY,this._openItemPopup(h,m)):(this.onExecute(),h._onClick?h._onClick(m):h.onClick(m))},_openItemPopup:function(h,m){if(h!=this.currentPopupItem){this.currentPopupItem&&(this._stopPendingCloseTimer(),this.currentPopupItem._closePopup());this._stopPopupTimer();var u=h.popup;u.parentMenu=this;this.own(this._mouseoverHandle=l.once(u.domNode,"mouseover",x.hitch(this,"_onPopupHover")));var t=this;h._openPopup({parent:this,orient:this._orient||["after","before"],onCancel:function(){m&&
t.focusChild(h);t._cleanUp()},onExecute:x.hitch(this,"_cleanUp",!0),onClose:function(){t._mouseoverHandle&&(t._mouseoverHandle.remove(),delete t._mouseoverHandle)}},m);this.currentPopupItem=h}},onOpen:function(){this.isShowingNow=!0;this.set("activated",!0)},onClose:function(){this.set("activated",!1);this.set("selected",null);this.isShowingNow=!1;this.parentMenu=null},_closeChild:function(){this._stopPopupTimer();this.currentPopupItem&&(this.focused&&(d.set(this.selected.focusNode,"tabIndex",this.tabIndex),
this.selected.focusNode.focus()),this.currentPopupItem._closePopup(),this.currentPopupItem=null)},_onItemFocus:function(h){if(this._hoveredChild&&this._hoveredChild!=h)this.onItemUnhover(this._hoveredChild);this.set("selected",h)},_onBlur:function(){this._cleanUp(!0);this.inherited(arguments)},_cleanUp:function(h){this._closeChild();"undefined"==typeof this.isShowingNow&&this.set("activated",!1);h&&this.set("selected",null)}})})},"dijit/_CssStateMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-class dojo/has dojo/_base/lang dojo/on dojo/domReady dojo/touch dojo/_base/window ./a11yclick ./registry".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k){b=b("dijit._CssStateMixin",[],{hovering:!1,active:!1,_applyAttributes:function(){this.inherited(arguments);a.forEach("disabled readOnly checked selected focused state hovering active _opened".split(" "),function(y){this.watch(y,x.hitch(this,"_setStateClass"))},this);for(var r in this.cssStateNodes||{})this._trackMouseState(this[r],this.cssStateNodes[r]);this._trackMouseState(this.domNode,this.baseClass);this._setStateClass()},_cssMouseEvent:function(r){if(!this.disabled)switch(r.type){case "mouseover":case "MSPointerOver":case "pointerover":this._set("hovering",
!0);this._set("active",this._mouseDown);break;case "mouseout":case "MSPointerOut":case "pointerout":this._set("hovering",!1);this._set("active",!1);break;case "mousedown":case "touchstart":case "MSPointerDown":case "pointerdown":case "keydown":this._set("active",!0);break;case "mouseup":case "dojotouchend":case "MSPointerUp":case "pointerup":case "keyup":this._set("active",!1)}},_setStateClass:function(){function r(t){y=y.concat(a.map(y,function(q){return q+t}),"dijit"+t)}var y=this.baseClass.split(" ");
this.isLeftToRight()||r("Rtl");var p="mixed"==this.checked?"Mixed":this.checked?"Checked":"";this.checked&&r(p);this.state&&r(this.state);this.selected&&r("Selected");this._opened&&r("Opened");this.disabled?r("Disabled"):this.readOnly?r("ReadOnly"):this.active?r("Active"):this.hovering&&r("Hover");this.focused&&r("Focused");p=this.stateNode||this.domNode;var h={};a.forEach(p.className.split(" "),function(t){h[t]=!0});"_stateClasses"in this&&a.forEach(this._stateClasses,function(t){delete h[t]});a.forEach(y,
function(t){h[t]=!0});var m=[],u;for(u in h)m.push(u);p.className=m.join(" ");this._stateClasses=y},_subnodeCssMouseEvent:function(r,y,p){function h(m){d.toggle(r,y+"Active",m)}if(!this.disabled&&!this.readOnly)switch(p.type){case "mouseover":case "MSPointerOver":case "pointerover":d.toggle(r,y+"Hover",!0);break;case "mouseout":case "MSPointerOut":case "pointerout":d.toggle(r,y+"Hover",!1);h(!1);break;case "mousedown":case "touchstart":case "MSPointerDown":case "pointerdown":case "keydown":h(!0);
break;case "mouseup":case "MSPointerUp":case "pointerup":case "dojotouchend":case "keyup":h(!1);break;case "focus":case "focusin":d.toggle(r,y+"Focused",!0);break;case "blur":case "focusout":d.toggle(r,y+"Focused",!1)}},_trackMouseState:function(r,y){r._cssState=y}});l(function(){function r(h,m,u){if(!u||!c.isDescendant(u,m))for(;m&&m!=u;m=m.parentNode)if(m._cssState){var t=k.getEnclosingWidget(m);t&&(m==t.domNode?t._cssMouseEvent(h):t._subnodeCssMouseEvent(m,m._cssState,h))}}var y=f.body(),p;w(y,
n.over,function(h){r(h,h.target,h.relatedTarget)});w(y,n.out,function(h){r(h,h.target,h.relatedTarget)});w(y,e.press,function(h){p=h.target;r(h,p)});w(y,e.release,function(h){r(h,p);p=null});w(y,"focusin, focusout",function(h){var m=h.target;if(m._cssState&&!m.getAttribute("widgetId")){var u=k.getEnclosingWidget(m);u&&u._subnodeCssMouseEvent(m,m._cssState,h)}})});return b})},"dijit/_KeyNavContainer":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/_base/kernel dojo/keys dojo/_base/lang ./registry ./_Container ./_FocusMixin ./_KeyNavMixin".split(" "),
function(a,b,c,d,g,x,w,l,n,f){return b("dijit._KeyNavContainer",[n,f,l],{connectKeyNavHandlers:function(e,k){var r=this._keyNavCodes={},y=x.hitch(this,"focusPrev"),p=x.hitch(this,"focusNext");a.forEach(e,function(h){r[h]=y});a.forEach(k,function(h){r[h]=p});r[g.HOME]=x.hitch(this,"focusFirstChild");r[g.END]=x.hitch(this,"focusLastChild")},startupKeyNavChildren:function(){d.deprecated("startupKeyNavChildren() call no longer needed","","2.0")},startup:function(){this.inherited(arguments);a.forEach(this.getChildren(),
x.hitch(this,"_startupChild"))},addChild:function(e,k){this.inherited(arguments);this._startupChild(e)},_startupChild:function(e){e.set("tabIndex","-1")},_getFirst:function(){var e=this.getChildren();return e.length?e[0]:null},_getLast:function(){var e=this.getChildren();return e.length?e[e.length-1]:null},focusNext:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,1))},focusPrev:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,-1),!0)},childSelector:function(e){return(e=
w.byNode(e))&&e.getParent()==this}})})},"dijit/_KeyNavMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dijit/registry dijit/_FocusMixin".split(" "),function(a,b,c,d,g,x,w,l){return b("dijit._KeyNavMixin",l,{tabIndex:"0",childSelector:null,postCreate:function(){this.inherited(arguments);c.set(this.domNode,"tabIndex",this.tabIndex);if(!this._keyNavCodes){var n=this._keyNavCodes={};n[d.HOME]=g.hitch(this,"focusFirstChild");n[d.END]=g.hitch(this,
"focusLastChild");n[this.isLeftToRight()?d.LEFT_ARROW:d.RIGHT_ARROW]=g.hitch(this,"_onLeftArrow");n[this.isLeftToRight()?d.RIGHT_ARROW:d.LEFT_ARROW]=g.hitch(this,"_onRightArrow");n[d.UP_ARROW]=g.hitch(this,"_onUpArrow");n[d.DOWN_ARROW]=g.hitch(this,"_onDownArrow")}var f=this;n="string"==typeof this.childSelector?this.childSelector:g.hitch(this,"childSelector");this.own(x(this.domNode,"keypress",g.hitch(this,"_onContainerKeypress")),x(this.domNode,"keydown",g.hitch(this,"_onContainerKeydown")),x(this.domNode,
"focus",g.hitch(this,"_onContainerFocus")),x(this.containerNode,x.selector(n,"focusin"),function(e){f._onChildFocus(w.getEnclosingWidget(this),e)}))},_onLeftArrow:function(){},_onRightArrow:function(){},_onUpArrow:function(){},_onDownArrow:function(){},focus:function(){this.focusFirstChild()},_getFirstFocusableChild:function(){return this._getNextFocusableChild(null,1)},_getLastFocusableChild:function(){return this._getNextFocusableChild(null,-1)},focusFirstChild:function(){this.focusChild(this._getFirstFocusableChild())},
focusLastChild:function(){this.focusChild(this._getLastFocusableChild())},focusChild:function(n,f){n&&(this.focusedChild&&n!==this.focusedChild&&this._onChildBlur(this.focusedChild),n.set("tabIndex",this.tabIndex),n.focus(f?"end":"start"))},_onContainerFocus:function(n){n.target!==this.domNode||this.focusedChild||this.focus()},_onFocus:function(){c.set(this.domNode,"tabIndex","-1");this.inherited(arguments)},_onBlur:function(n){c.set(this.domNode,"tabIndex",this.tabIndex);this.focusedChild&&(this.focusedChild.set("tabIndex",
"-1"),this.lastFocusedChild=this.focusedChild,this._set("focusedChild",null));this.inherited(arguments)},_onChildFocus:function(n){n&&n!=this.focusedChild&&(this.focusedChild&&!this.focusedChild._destroyed&&this.focusedChild.set("tabIndex","-1"),n.set("tabIndex",this.tabIndex),this.lastFocused=n,this._set("focusedChild",n))},_searchString:"",multiCharSearchDuration:1E3,onKeyboardSearch:function(n,f,e,k){n&&this.focusChild(n)},_keyboardSearchCompare:function(n,f){var e=n.domNode;n=(n.label||(e.focusNode?
e.focusNode.label:"")||e.innerText||e.textContent||"").replace(/^\s+/,"").substr(0,f.length).toLowerCase();return f.length&&n==f?-1:0},_isFormElement:function(n){return"INPUT"===n.tagName||"TEXTAREA"===n.tagName||"SELECT"===n.tagName||"BUTTON"===n.tagName},_onContainerKeydown:function(n){if(!this._isFormElement(document.activeElement)){var f=this._keyNavCodes[n.keyCode];f?(f(n,this.focusedChild),n.stopPropagation(),n.preventDefault(),this._searchString=""):n.keyCode!=d.SPACE||!this._searchTimer||
n.ctrlKey||n.altKey||n.metaKey||(n.stopImmediatePropagation(),n.preventDefault(),this._keyboardSearch(n," "))}},_onContainerKeypress:function(n){this._isFormElement(document.activeElement)||n.charCode<=d.SPACE||n.ctrlKey||n.altKey||n.metaKey||(n.preventDefault(),n.stopPropagation(),this._keyboardSearch(n,String.fromCharCode(n.charCode).toLowerCase()))},_keyboardSearch:function(n,f){var e=null,k,r=0;g.hitch(this,function(){this._searchTimer&&this._searchTimer.remove();this._searchString+=f;var y=/^(.)\1*$/.test(this._searchString)?
1:this._searchString.length;k=this._searchString.substr(0,y);this._searchTimer=this.defer(function(){this._searchTimer=null;this._searchString=""},this.multiCharSearchDuration);var p=this.focusedChild||null;if(1==y||!p)if(p=this._getNextFocusableChild(p,1),!p)return;y=p;do{var h=this._keyboardSearchCompare(p,k);h&&0==r++&&(e=p);if(-1==h){r=-1;break}p=this._getNextFocusableChild(p,1)}while(p&&p!=y)})();this.onKeyboardSearch(e,n,k,r)},_onChildBlur:function(){},_getNextFocusableChild:function(n,f){var e=
n;do{if(n)n=this._getNext(n,f);else if(n=this[0<f?"_getFirst":"_getLast"](),!n)break;if(null!=n&&n!=e&&n.isFocusable())return n}while(n!=e);return null},_getFirst:function(){return null},_getLast:function(){return null},_getNext:function(n,f){if(n)for(n=n.domNode;n;)if((n=n[0>f?"previousSibling":"nextSibling"])&&"getAttribute"in n){var e=w.byNode(n);if(e)return e}return null}})})},"dgrid/main":function(){define([],1)},"dgrid/OnDemandGrid":function(){define(["dojo/_base/declare","./Grid","./OnDemandList"],
function(a,b,c){return a([b,c],{})})},"dgrid/Grid":function(){define("dojo/_base/declare dojo/_base/lang dojo/dom-construct dojo/dom-class dojo/on dojo/has ./List ./util/misc dojo/_base/sniff".split(" "),function(a,b,c,d,g,x,w,l){function n(f,e){e&&e.nodeType&&f.appendChild(e)}a=a(w,{columns:null,hasNeutralSort:!1,cellNavigation:!0,tabableHeader:!0,showHeader:!0,column:function(f){return"object"!==typeof f?this.columns[f]:this.cell(f).column},listType:"grid",cell:function(f,e){if(f.column&&f.element)return f;
f.target&&f.target.nodeType&&(f=f.target);if(f.nodeType){do{if(this._rowIdToObject[f.id])break;var k=f.columnId;if(k){e=k;var r=f;break}f=f.parentNode}while(f&&f!==this.domNode)}if(!r&&"undefined"!==typeof e){var y=this.row(f);if(k=y&&y.element){k=k.getElementsByTagName("td");for(var p=0;p<k.length;p++)if(k[p].columnId===e){r=k[p];break}}}if(null!=f)return{row:y||this.row(f),column:e&&this.column(e),element:r}},createRowCells:function(f,e,k,r,y){var p=c.create("table",{className:"dgrid-row-table",
role:"presentation"}),h=9>x("ie")?c.create("tbody",null,p):p,m,u,t;k=k||this.subRows;var q=0;for(m=k.length;q<m;q++){var z=k[q];var v=c.create("tr",null,h);z.className&&(v.className=z.className);var B=0;for(u=z.length;B<u;B++){var A=z[B];var E=A.id;var C=A.field?" field-"+l.escapeCssIdentifier(A.field,"-"):"";(t="function"===typeof A.className?A.className(r):A.className)&&(C+=" "+t);C=c.create(f,{className:"dgrid-cell"+(E?" dgrid-column-"+l.escapeCssIdentifier(E,"-"):"")+C,role:"th"===f?"columnheader":
"gridcell"});C.columnId=E;if(E=A.colSpan)C.colSpan=E;if(E=A.rowSpan)C.rowSpan=E;e(C,A,r,y);v.appendChild(C)}}return p},_createBodyRowCell:function(f,e,k,r){var y=k;e.get?y=e.get(k):"field"in e&&"_item"!==e.field&&(y=k[e.field]);e.renderCell?n(f,e.renderCell(k,y,f,r)):this._defaultRenderCell.call(e,k,y,f,r)},_createHeaderRowCell:function(f,e){var k=e.headerNode=f,r=e.field;r&&(f.field=r);e.renderHeaderCell?n(k,e.renderHeaderCell(k)):("label"in e||e.field)&&k.appendChild(document.createTextNode("label"in
e?e.label:e.field));!1!==e.sortable&&r&&"_item"!==r&&(f.sortable=!0,f.className+=" dgrid-sortable")},left:function(f,e){f.element||(f=this.cell(f));return this.cell(this._move(f,-(e||1),"dgrid-cell"))},right:function(f,e){f.element||(f=this.cell(f));return this.cell(this._move(f,e||1,"dgrid-cell"))},_defaultRenderCell:function(f,e,k){if(this.formatter){var r=this.formatter,y=this.grid.formatterScope;f="string"===typeof r&&y?y[r](e,f):this.formatter(e,f);null!=f&&f.hasOwnProperty("html")?k.innerHTML=
f.html:null!=f&&k.appendChild(document.createTextNode(f))}else null!=e&&k.appendChild(document.createTextNode(e))},renderRow:function(f,e){f=this.createRowCells("td",b.hitch(this,"_createBodyRowCell"),e&&e.subRows,f,e);e=c.create("div",{role:"row"});e.appendChild(f);return e},renderHeader:function(){var f=this,e=this.headerNode;e.setAttribute("role","row");c.empty(e);var k=this.createRowCells("th",b.hitch(this,"_createHeaderRowCell"),this.subRows&&this.subRows.headerRows);this._rowIdToObject[k.id=
this.id+"-header"]=this.columns;e.appendChild(k);this._sortListener&&this._sortListener.remove();this._sortListener=g(k,"click,keydown",function(r){if("click"===r.type||32===r.keyCode||!x("opera")&&13===r.keyCode){var y=r.target;do if(y.sortable){var p=y.field||y.columnId;var h=f.sort[0];p=f.hasNeutralSort&&h&&h.property===p&&h.descending?[]:[{property:p,descending:h&&h.property===p&&!h.descending}];h={bubbles:!0,cancelable:!0,grid:f,parentType:r.type,sort:p};g.emit(r.target,"dgrid-sort",h)&&(f._sortNode=
y,f.set("sort",p));break}while((y=y.parentNode)&&y!==e)}})},resize:function(){var f=this.headerNode.firstChild,e=this.contentNode,k;this.inherited(arguments);e.style.width="";e&&f&&(k=f.offsetWidth)>e.offsetWidth&&(e.style.width=k+"px")},destroy:function(){this._destroyColumns();this._sortListener&&this._sortListener.remove();this.inherited(arguments)},_setSort:function(){this.inherited(arguments);this.updateSortArrow(this.sort)},_findSortArrowParent:function(f){var e=this.columns,k;for(k in e){var r=
e[k];if(r.field===f)return r.headerNode}},updateSortArrow:function(f,e){this._lastSortedArrow&&(this._lastSortedArrow.parentNode&&d.remove(this._lastSortedArrow.parentNode,"dgrid-sort-up dgrid-sort-down"),c.destroy(this._lastSortedArrow),delete this._lastSortedArrow);e&&(this.sort=f);f[0]&&(e=f[0].property,f=f[0].descending,e=this._sortNode||this._findSortArrowParent(e),delete this._sortNode,e&&(e=e.contents||e,this._lastSortedArrow=c.create("div",{className:"dgrid-sort-arrow ui-icon",innerHTML:"\x26nbsp;",
role:"presentation"},e,"first"),d.add(e,"dgrid-sort-"+(f?"down":"up")),this.resize()))},styleColumn:function(f,e){return this.addCssRule("#"+l.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-"+l.escapeCssIdentifier(f,"-"),e)},_configColumns:function(f,e){var k=[],r=e instanceof Array;l.each(e,function(y,p){"string"===typeof y&&(e[p]=y={label:y});r||y.field||(y.field=p);p=y.id=y.id||(isNaN(p)?p:f+p);this._configColumn&&(this._configColumn(y,e,f),p=y.id);r&&(this.columns[p]=y);y.grid?y.grid!==
this&&console.warn("Sharing column definition objects with multiple grids is not supported.",y.grid,this):y.grid=this;k.push(y)},this);return r?e:k},_destroyColumns:function(){this.cleanup()},configStructure:function(){var f=this.subRows,e=this._columns=this.columns;this.columns=!e||e instanceof Array?{}:e;if(f)for(e=0;e<f.length;e++)f[e]=this._configColumns(e+"-",f[e]);else this.subRows=[this._configColumns("",e)]},_getColumns:function(){return this._columns||this.columns},_setColumns:function(f){this._destroyColumns();
this.subRows=null;this.columns=f;this._updateColumns()},_setSubRows:function(f){this._destroyColumns();this.subRows=f;this._updateColumns()},_updateColumns:function(){this.configStructure();this.renderHeader();this.refresh();this._lastCollection&&this.renderArray(this._lastCollection);this._started&&(this.sort.length?(this._lastSortedArrow=null,this.updateSortArrow(this.sort)):this.resize())}});a.appendIfNode=n;return a})},"dgrid/List":function(){define("dojo/_base/declare dojo/_base/lang dojo/dom-class dojo/dom-construct dojo/on dojo/query dojo/sniff ./util/misc".split(" "),
function(a,b,c,d,g,x,w,l){function n(t,q){return x("#"+l.escapeCssIdentifier(t),q)[0]}function f(t,q){t.className="dgrid-scrollbar-measure";document.body.appendChild(t);q=t["offset"+q]-t["client"+q];t.className="";t.parentNode&&document.body.removeChild(t);return q}function e(t){c.replace(this.domNode,t,this._class||"");this._class=t}function k(){return this._class}var r=[];r.push("has-mozilla");w("touch")&&r.push("has-touch");c.add(document.documentElement,r);w.add("pointer",function(t){return"PointerEvent"in
t?"pointer":"MSPointerEvent"in t?"MSPointer":!1});var y,p;w.add("dom-scrollbar-width",function(t,q,z){return f(z,"Width")});w.add("dom-scrollbar-height",function(t,q,z){return f(z,"Height")});w.add("dom-rtl-scrollbar-left",function(t,q,z){t=document.createElement("div");z.className="dgrid-scrollbar-measure";z.setAttribute("dir","rtl");z.appendChild(t);document.body.appendChild(z);q=!!w("ie")||/\bEdge\//.test(navigator.userAgent)||t.offsetLeft>=w("dom-scrollbar-width");z.className="";z.parentNode&&
document.body.removeChild(z);d.destroy(t);z.removeAttribute("dir");return q});var h=0,m=function(){this._started&&this.resize()},u=a(null,{tabableHeader:!1,showHeader:!1,showFooter:!1,maintainOddEven:!0,cleanAddedRules:!0,addUiClasses:!0,highlightDuration:250,resizeThrottleDelay:l.defaultDelay,resizeThrottleMethod:"throttleDelayed",postscript:function(t,q){var z=this;(this._Row=function(v,B,A){this.id=v;this.data=B;this.element=A}).prototype.remove=function(){z.removeRow(this.element)};q&&(this.srcNodeRef=
q=q.nodeType?q:n(q));this.create(t,q)},listType:"list",create:function(t,q){q=this.domNode=q||document.createElement("div");if(t){this.params=t;a.safeMixin(this,t);var z=t["class"]||t.className||q.className}this.sort=this.sort||[];this._listeners=[];this._rowIdToObject={};this.postMixInProperties&&this.postMixInProperties();this.id=q.id=q.id||this.id||u.autoIdPrefix+h++;this.buildRendering();z&&e.call(this,z);this.postCreate();delete this.srcNodeRef;this.domNode.offsetHeight&&this.startup()},buildRendering:function(){var t=
this.domNode,q=this.addUiClasses,z=this;var v=this.isRTL="rtl"===(document.body.dir||document.documentElement.dir||document.body.style.direction).toLowerCase();t.className="";t.setAttribute("role","grid");c.add(t,"dgrid dgrid-"+this.listType+(q?" ui-widget":""));var B=this.headerNode=d.create("div",{className:"dgrid-header dgrid-header-row"+(q?" ui-widget-header":"")+(this.showHeader?"":" dgrid-header-hidden")},t);var A=this.bodyNode=d.create("div",{className:"dgrid-scroller"},t);A.tabIndex=-1;this.headerScrollNode=
d.create("div",{className:"dgrid-header dgrid-header-scroll dgrid-scrollbar-width"+(q?" ui-widget-header":"")},t);this.footerNode=d.create("div",{className:"dgrid-footer"+(this.showFooter?"":" dgrid-footer-hidden")},t);v&&(t.className+=" dgrid-rtl"+(w("dom-rtl-scrollbar-left")?" dgrid-rtl-swap":""));g(A,"scroll",function(E){z.showHeader&&(B.scrollLeft=E.scrollLeft||A.scrollLeft);E.stopPropagation();g.emit(t,"scroll",{scrollTarget:A})});this.configStructure();this.renderHeader();this.contentNode=this.touchNode=
d.create("div",{className:"dgrid-content"+(q?" ui-widget-content":"")},this.bodyNode);"string"===typeof this.resizeThrottleMethod&&l[this.resizeThrottleMethod]?q=l[this.resizeThrottleMethod](m,this,this.resizeThrottleDelay):"function"===typeof this.resizeThrottleMethod?q=this.resizeThrottleMethod(b.hitch(this,m),this.resizeThrottleDelay):(console.warn("Invalid value specified for resizeThrottleMethod:  "+this.resizeThrottleMethod),q=l.throttleDelayed(m,this,this.resizeThrottleDelay));this._resizeHandle=
g(window,"resize",q);this._listeners.push(this._resizeHandle)},postCreate:function(){},startup:function(){this._started||(this.inherited(arguments),this._started=!0,this.resize(),this.set("sort",this.sort))},configStructure:function(){},resize:function(){var t=this.bodyNode,q=this.footerNode;q=this.showFooter?q.offsetHeight:0;this.headerScrollNode.style.height=t.style.marginTop=this.headerNode.offsetHeight+"px";t.style.marginBottom=q+"px";y||(y=w("dom-scrollbar-width"),p=w("dom-scrollbar-height"),
w("ie")&&(y++,p++),l.addCssRule(".dgrid-scrollbar-width","width: "+y+"px"),l.addCssRule(".dgrid-scrollbar-height","height: "+p+"px"),17!==y&&(l.addCssRule(".dgrid-header-row","right: "+y+"px"),l.addCssRule(".dgrid-rtl-swap .dgrid-header-row","left: "+y+"px")))},addCssRule:function(t,q){t=l.addCssRule(t,q);this.cleanAddedRules&&this._listeners.push(t);return t},on:function(t,q){return g(this.domNode,t,q)},cleanup:function(){for(var t in this._rowIdToObject)if(this._rowIdToObject[t]!==this.columns){var q=
n(t,this.domNode);q&&this.removeRow(q,!0)}},destroy:function(){if(this._listeners){for(var t=this._listeners.length;t--;)this._listeners[t].remove();this._listeners=null}this._started=!1;this.cleanup();d.destroy(this.domNode)},refresh:function(){this.cleanup();this._rowIdToObject={};this._autoRowId=0;this.contentNode.innerHTML="";this.scrollTo({x:0,y:0})},highlightRow:function(t,q){var z="dgrid-highlight"+(this.addUiClasses?" ui-state-highlight":"");t=t.element||t;c.add(t,z);setTimeout(function(){c.remove(t,
z)},q||this.highlightDuration)},adjustRowIndices:function(t){var q=t.rowIndex;if(-1<q){do-1<t.rowIndex&&this.setRowIndex(t,q++,t.rowIndex);while((t=t.nextSibling)&&t.rowIndex!==q)}},renderArray:function(t,q,z){z=z||{};var v=z.start||0,B=document.createDocumentFragment(),A=[],E=0,C=t.length;q||(this._lastCollection=t);for(;E<C;)A[E]=this.insertRow(t[E],B,null,v++,z),E++;(t=q?q.parentNode:this.contentNode)&&t.parentNode&&(t!==this.contentNode||C)&&(t.insertBefore(B,q||null),C&&this.adjustRowIndices(A[C-
1]));return A},renderHeader:function(){},setRowIndex:function(t,q,z){t.rowIndex=q;this.maintainOddEven&&(q=1===q%2?"dgrid-row-odd":"dgrid-row-even",void 0!==z?(z=1===z%2?"dgrid-row-odd":"dgrid-row-even",z!==q&&c.replace(t,z,q)):c.add(t,q))},_autoRowId:0,insertRow:function(t,q,z,v,B){var A=this.id+"-row-"+(this.collection&&this.collection.getIdentity?this.collection.getIdentity(t):this._autoRowId++),E=n(A,this.domNode),C=E&&E.previousSibling;E&&(E===z&&(z=(z.connected||z).nextSibling),this.removeRow(E,
!1,B));E=this.renderRow(t,B);E.className=(E.className||"")+" dgrid-row "+(this.addUiClasses?" ui-state-default":"");this._rowIdToObject[E.id=A]=t;q.insertBefore(E,z||null);this.setRowIndex(E,v);C&&C.rowIndex!==E.rowIndex-1&&this.adjustRowIndices(C);return E},renderRow:function(t){var q=document.createElement("div");q.appendChild(document.createTextNode(t));return q},removeRow:function(t,q){t=t.element||t;delete this._rowIdToObject[t.id];q||d.destroy(t)},row:function(t){var q;if(t instanceof this._Row)return t;
t.target&&t.target.nodeType&&(t=t.target);if(t.nodeType){do{var z=t.id;if(q=this._rowIdToObject[z])return new this._Row(z.substring(this.id.length+5),q,t);t=t.parentNode}while(t&&t!==this.domNode)}else return"object"===typeof t?q=this.collection.getIdentity(t):(q=t,t=this._rowIdToObject[this.id+"-row-"+q]),new this._Row(q,t,n(this.id+"-row-"+q,this.domNode))},cell:function(t){return{row:this.row(t)}},_move:function(t,q,z,v){var B;var A=B=t.element;q=q||1;do if(t=B[0>q?"previousSibling":"nextSibling"]){do if((B=
t)&&-1<(B.className+" ").indexOf(z+" ")){A=B;q+=0>q?1:-1;break}while(t=(!v||!B.hidden)&&B[0>q?"lastChild":"firstChild"])}else if(B=B.parentNode,!B||B===this.bodyNode||B===this.headerNode)break;while(q);return A},up:function(t,q,z){t.element||(t=this.row(t));return this.row(this._move(t,-(q||1),"dgrid-row",z))},down:function(t,q,z){t.element||(t=this.row(t));return this.row(this._move(t,q||1,"dgrid-row",z))},scrollTo:function(t){"undefined"!==typeof t.x&&(this.bodyNode.scrollLeft=t.x);"undefined"!==
typeof t.y&&(this.bodyNode.scrollTop=t.y)},getScrollPosition:function(){return{x:this.bodyNode.scrollLeft,y:this.bodyNode.scrollTop}},get:function(t){var q="_get"+t.charAt(0).toUpperCase()+t.slice(1);return"function"===typeof this[q]?this[q].apply(this,[].slice.call(arguments,1)):this[t]},set:function(t,q){if("object"===typeof t)for(var z in t)this.set(z,t[z]);else z="_set"+t.charAt(0).toUpperCase()+t.slice(1),"function"===typeof this[z]?this[z].apply(this,[].slice.call(arguments,1)):this[t]=q;return this},
_getClass:k,_setClass:e,_getClassName:k,_setClassName:e,_setSort:function(t,q){this.sort="string"!==typeof t?t:[{property:t,descending:q}];this._applySort()},_applySort:function(){this.refresh();if(this._lastCollection){var t=this.sort;if(t&&0<t.length){var q=t[0].property,z=!!t[0].descending;this._lastCollection.sort(function(v,B){v=v[q];B=B[q];void 0===v&&(v="");void 0===B&&(B="");return v===B?0:v>B!==z?1:-1})}this.renderArray(this._lastCollection)}},_setShowHeader:function(t){var q=this.headerNode;
this.showHeader=t;c.toggle(q,"dgrid-header-hidden",!t);this.renderHeader();this.resize();t&&(q.scrollLeft=this.getScrollPosition().x)},_setShowFooter:function(t){this.showFooter=t;c.toggle(this.footerNode,"dgrid-footer-hidden",!t);this.resize()}});u.autoIdPrefix="dgrid_";return u})},"dgrid/util/misc":function(){define(["dojo/has"],function(a){var b=[],c,d,g,x=/([^A-Za-z0-9_\u00A0-\uFFFF-])/g,w=setTimeout,l=clearTimeout;a.add("requestidlecallback",function(f){return"function"===typeof f.requestIdleCallback});
var n={defaultDelay:15,throttle:function(f,e,k){var r=!1;k=k||n.defaultDelay;return function(){r||(r=!0,f.apply(e,arguments),w(function(){r=!1},k))}},throttleDelayed:function(f,e,k){var r=!1;k=k||n.defaultDelay;return function(){if(!r){r=!0;var y=arguments;w(function(){r=!1;f.apply(e,y)},k)}}},debounce:function(f,e,k){var r;k=k||n.defaultDelay;return function(){r&&(l(r),r=null);var y=arguments;r=w(function(){r=null;f.apply(e,y)},k)}},each:function(f,e,k){var r;if(f)if("number"===typeof f.length){var y=
0;for(r=f.length;y<r;y++)e.call(k,f[y],y,f)}else for(y in f)e.call(k,f[y],y,f)},addCssRule:function(f,e){c||(c=document.createElement("style"),document.getElementsByTagName("head")[0].appendChild(c),c=c.sheet||c.styleSheet,d=c.deleteRule?"deleteRule":"removeRule",g=c.cssRules?"cssRules":"rules");var k=b.length;b[k]=(c.cssRules||c.rules).length;c.addRule?c.addRule(f,e):c.insertRule(f+"{"+e+"}",b[k]);return{get:function(r){return c[g][b[k]].style[r]},set:function(r,y){"undefined"!==typeof b[k]&&(c[g][b[k]].style[r]=
y)},remove:function(){var r=b[k],y;if(void 0!==r){c[d](r);b[k]=void 0;var p=k+1;for(y=b.length;p<y;p++)b[p]>r&&b[p]--}}}},escapeCssIdentifier:function(f,e){return"string"===typeof f?f.replace(x,e||"\\$1"):f}};return n})},"dgrid/OnDemandList":function(){define("./List ./_StoreMixin dojo/_base/declare dojo/_base/lang dojo/dom-construct dojo/on dojo/when dojo/query ./util/misc".split(" "),function(a,b,c,d,g,x,w,l,n){function f(r){return r&&(0<=r.className.indexOf("dgrid-row")||0<=r.className.indexOf("dgrid-loading"))}
function e(r){return r&&0<=r.className.indexOf("dgrid-preload")}var k=0;return c([a,b],{minRowsPerPage:25,maxRowsPerPage:250,maxEmptySpace:Infinity,bufferRows:10,farOffRemoval:2E3,queryRowsOverlap:0,pagingMethod:"debounce",pagingDelay:n.defaultDelay,keepScrollPosition:!1,rowHeight:0,_deleteQueue:[],postCreate:function(){this.inherited(arguments);var r=this;x(this.bodyNode,"scroll",n[this.pagingMethod](function(y){r._processScroll(y)},null,this.pagingDelay))},renderQuery:function(r,y){var p=this,h=
y&&y.container||this.contentNode,m,u=0,t=y&&y.start||0;"level"in r&&(u=m=r.level);var q={query:r,count:0,level:u,top:!1};var z={node:g.create("div",{className:"dgrid-preload",style:{height:"0"}},h),count:0,query:r,next:q,level:u,top:!0};var v=z.node;v.rowIndex=0;q.previous=z;var B=q.node=g.create("div",{className:"dgrid-preload",style:{height:"0"}},h);z.id=k++;v.setAttribute("data-preloadid",z.id);q.id=k++;B.setAttribute("data-preloadid",q.id);B.rowIndex=this.minRowsPerPage;p._insertPreload(z);var A=
g.create("div",{className:"dgrid-loading"},B,"before");g.create("div",{className:"dgrid-below"},A).innerHTML=this.loadingMessage;y=d.mixin({start:0,count:this.minRowsPerPage},y);null!=m&&(y.queryLevel=m);return this._trackError(function(){var E=r(y);return p.renderQueryResults(E,B,y).then(function(C){return E.totalLength.then(function(D){var F=C.length,G=B.parentNode;!p._rows||"queryLevel"in y||(p._rows.min=0,p._rows.max=F===D?Infinity:F-1);g.destroy(A);"queryLevel"in y||(p._total=D);0===D&&G&&(p.noDataNode&&
g.destroy(p.noDataNode),p._insertNoDataNode(G));z.count=t;q.count=D-F-t;B.rowIndex=t+F;D?p._updatePreloadRowHeights(z):(B.style.display="none",v.style.display="none");p._previousScrollPosition&&G&&G.offsetHeight&&(p.scrollTo(p._previousScrollPosition),delete p._previousScrollPosition);return w(p._processScroll()).then(function(){return C})})}).otherwise(function(C){g.destroy(A);throw C;})})},_insertPreload:function(r){var y=this.preload;if(y){for(;y.node.compareDocumentPosition(r.node)&Node.DOCUMENT_POSITION_PRECEDING;)if(y=
y.previous,null==y)return;for(;y.node.compareDocumentPosition(r.node)&Node.DOCUMENT_POSITION_FOLLOWING&&y.next;)y=y.next;y.previous.next=r;r.previous=y.previous;r=r.next;r.next=y;y.previous=r}else this.preload=r},refresh:function(r){var y=this,p=r&&r.keepScrollPosition,h;"undefined"===typeof p&&(p=this.keepScrollPosition);p&&(this._previousScrollPosition=this.getScrollPosition());this.inherited(arguments);if(this._renderedCollection)return this.renderQuery(function(m){m=y._renderedCollection.fetchRange({start:m.start,
end:m.start+m.count});m.then(function(u){h=u});return m}).then(function(){y._emitRefreshComplete();return h})},resize:function(){this.inherited(arguments);this._processScroll()},cleanup:function(){this.inherited(arguments);this.preload=null},renderQueryResults:function(r){var y=this.inherited(arguments),p=this._getRenderedCollection(this.preload);p&&p.releaseRange&&y.then(function(h){h[0]&&!h[0].parentNode.tagName&&r.totalLength.then(function(){p.releaseRange(h[0].rowIndex,h[h.length-1].rowIndex+
1)})});return y},_getFirstRowSibling:function(r){return r.lastChild},_calcRowHeight:function(r){var y=r.nextSibling;return y&&!/\bdgrid-preload\b/.test(y.className)?y.offsetTop-r.offsetTop:r.offsetHeight},_calcAverageRowHeight:function(r){for(var y=r.length,p=0,h=0;h<y;h++)p+=this._calcRowHeight(r[h]);return y&&p?p/y:0},_updatePreloadRowHeights:function(){var r=this.preload,y=0;if(r){for(;r.previous;)r=r.previous;for(;r;)r.rowHeight||(r.rowHeight=this._calcAverageRowHeight(r.node.parentNode.querySelectorAll(".dgrid-row")),
this._adjustPreloadHeight(r)),y=r?r.rowHeight:y,r=r.next;this.rowHeight=y}},lastScrollTop:0,_processScroll:function(r){function y(M,U){U=U?"next":"previous";for(var R;R=M[U];)M=R;return M}function p(M,U){function R(){a:{var ka=!U;for(var ia=M;ia=ia[U?"previous":"next"];)if(ka===ia.top){ka=ia;break a}ka=void 0}if(ka&&T!==ka&&!e(ka.top?ka.node.nextSibling:ka.node.previousSibling))return N(),M=ka,Q=M.node,S=U?M.node.offsetTop-v:z-(M.node.offsetTop+M.node.offsetHeight),ba=(ka=L(Q))&&ka.rowIndex,aa=void 0,
ka}function L(ka){var ia=e(ka);(ka=ka[W])&&!f(ka)&&(ka=ia&&e(ka)?null:(ia=R())?ia:L(ka));return ka}function N(){M.count+=V;U&&(Q.rowIndex-=V);t._adjustPreloadHeight(M);V=0;t._releaseRange(M,U,ba,aa)}var T=M;M=y(M,U);var S=U?M.node.offsetTop-v:z-(M.node.offsetTop+M.node.offsetHeight),H=t.farOffRemoval,Q=M.node,W=U?"previousSibling":"nextSibling",V=0,Y=0,aa;if(S>2*H){var X;var ba=(X=L(Q))&&X.rowIndex;for(aa=void 0;X&&T!==M;){var ha=t._calcRowHeight(X);Y+ha+H>S||!f(X)?X=R():(Y+=ha,V+=X.count||1,t._pruneRow(X,
U),"rowIndex"in X&&(aa=X.rowIndex),X=L(X))}N();t._deleteNodeQueue()}}function h(M,U){do M=U?M.next:M.previous;while(M&&!M.node.offsetWidth);return M}var m=this.preload,u;this._updatePreloadRowHeights();if(u=m&&m.rowHeight){var t=this,q=t.bodyNode,z=r&&r.scrollTop||this.getScrollPosition().y,v=q.offsetHeight+z;r=t.lastScrollTop;q=t.bufferRows*u;var B=q-u,A,E=!0;for(t.lastScrollTop=z;m&&!m.node.offsetWidth;)m=m.previous;for(;m&&m!==C;){var C=t.preload;t.preload=m;u=m.node;var D=u.offsetTop;if(v+1+B<
D)m=h(m,E=!1);else if(z-1-B>D+u.offsetHeight)m=h(m,E=!0);else{D=((u.top?z-q:v)-D)/m.rowHeight;var F=(v-z+2*q)/m.rowHeight;F+=Math.min(Math.abs(Math.max(Math.min((z-r)*m.rowHeight,t.maxRowsPerPage/2),t.maxRowsPerPage/-2)),10);u.top&&(D-=F);D=Math.max(D,0);10>D&&0<D&&F+D<t.maxRowsPerPage&&(F+=Math.max(0,D),D=0);F=Math.min(Math.max(F,t.minRowsPerPage),t.maxRowsPerPage,m.count);if(0===F)m=h(m,E);else{F=Math.ceil(F);D=Math.min(Math.floor(D),m.count-F);var G={};m.count-=F;var J=u,I=t.queryRowsOverlap,O=
!m.top&&m;if(O)m.previous&&(p(m),0<D&&e(u.previousSibling)?(D=Math.min(m.count,D),m.previous.count+=D,t._adjustPreloadHeight(m.previous,!0),u.rowIndex+=D,I=0):F+=D,m.count-=D),G.start=u.rowIndex-I,G.count=Math.min(F+I,t.maxRowsPerPage),u.rowIndex=G.start+G.count;else{if(m.next)if(J=u.nextSibling,p(m,!0),e(u.nextSibling))m.next.count+=m.count-D,m.next.node.rowIndex=D+F,t._adjustPreloadHeight(m.next),m.count=D,I=0,J=m.next.node;else var P=!0;G.start=m.count;G.count=Math.min(F+I,t.maxRowsPerPage);G.scrollingUp=
!0}P&&J&&J.offsetWidth&&(P=J.offsetTop);t._adjustPreloadHeight(m);"level"in m.query&&(G.queryLevel=m.query.level);if("queryLevel"in G||!(G.start>t._total||0>G.count)){var K=g.create("div",{className:"dgrid-loading",style:{height:F*m.rowHeight+"px"}},J,"before");g.create("div",{className:"dgrid-"+(O?"below":"above"),innerHTML:t.loadingMessage},K);K.count=F;t._trackError(function(){(function(M,U,R){var L=m.query(G);A=t.renderQueryResults(L,M,G).then(function(N){var T=t._rows;!T||"queryLevel"in G||!N.length||
(U?(T.max<=T.min&&(T.min=N[0].rowIndex),T.max=N[N.length-1].rowIndex):(T.max<=T.min&&(T.max=N[N.length-1].rowIndex),T.min=N[0].rowIndex));J=M.nextSibling;g.destroy(M);R&&J&&J.offsetWidth&&t.scrollTo({y:t.bodyNode.scrollTop+J.offsetTop-R});L.totalLength.then(function(S){"queryLevel"in G||(t._total=S,t._rows&&t._rows.max>=t._total-1&&(t._rows.max=Infinity));U&&(U.count=S-U.node.rowIndex,t._adjustPreloadHeight(U))});t._processScroll();return N},function(N){g.destroy(M);throw N;})})(K,O,P)});m=m.previous}}}}return A}},
_adjustPreloadHeight:function(r,y){r.node.style.height=this._calculatePreloadHeight(r,y)+"px"},_calculatePreloadHeight:function(r,y){return Math.min(r.count*r.rowHeight,y?Infinity:this.maxEmptySpace)},_pruneRow:function(r,y,p){this.removeRow(r,!0,p);this._queueNodeForDeletion(r)},_queueNodeForDeletion:function(r){this._deleteQueue.push(r)},_deleteNodeQueue:function(){for(var r=document.createElement("div"),y=this._deleteQueue,p=y.length;p--;)r.appendChild(y[p]);this._deleteQueue=[];setTimeout(function(){g.destroy(r)},
1)},_removePreloads:function(r){if(r&&r.length){var y=this,p=this._getHeadPreload();r.forEach(function(h){if(h=y._findPreload(h,p))h.previous&&(h.previous.next=h.next),h.next&&(h.next.previous=h.previous)})}},_getHeadPreload:function(){var r=this.preload;if(r)for(;r.previous;)r=r.previous;return r},_findPreload:function(r,y){for(y||(y=this._getHeadPreload());y;){if(y.node===r)return y;y=y.next}},_getRenderedCollection:function(){return this._renderedCollection},_releaseRange:function(r,y,p,h){if(r){var m=
r.level;r=this._getRenderedCollection(r);null!=h&&r.releaseRange&&"number"===typeof p&&"number"===typeof h&&(y?r.releaseRange(h,p+1):r.releaseRange(p,h+1),this._rows&&!m&&(this._rows[y?"max":"min"]=h,this._rows.max>=this._total-1&&(this._rows.max=Infinity)))}}})})},"dgrid/_StoreMixin":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/aspect dojo/dom-construct dojo/has dojo/on dojo/when".split(" "),function(a,b,c,d,g,x,w,l){function n(f){if("object"!==typeof f)f=Error(f);else if("cancel"===
f.dojoType)return;w.emit(this.domNode,"dgrid-error",{grid:this,error:f,cancelable:!0,bubbles:!0})&&console.error(f)}return a(null,{collection:null,_renderedCollection:null,_rows:null,_observerHandle:null,_structureHandle:null,shouldTrackCollection:!0,getBeforePut:!0,noDataMessage:"",loadingMessage:"",_total:0,constructor:function(){this.dirty={};this._updating={};this._columnsWithSet={};this._structureHandle=d.before(this,"configStructure",b.hitch(this,function(){this._columnsWithSet={}}))},destroy:function(){this.inherited(arguments);
this._structureHandle&&this._structureHandle.remove();this._renderedCollection&&this._cleanupCollection();this._refreshTimeout&&clearTimeout(this._refreshTimeout)},_configColumn:function(f){f.set&&(this._columnsWithSet[f.field]=f);this.inherited(arguments)},_setCollection:function(f){this._renderedCollection&&(this.cleanup(),this._cleanupCollection({shouldRevert:!f||f.storage!==this._renderedCollection.storage}));this.collection=f;if(this._started){if(f){var e=f;this.sort&&0<this.sort.length&&(e=
f.sort(this.sort));e.track&&this.shouldTrackCollection&&(e=e.track(),this._rows=[],this._observerHandle=this._observeCollection(e,this.contentNode,{rows:this._rows}));this._renderedCollection=e}this.refresh()}},_setStore:function(){this.collection||console.debug("set('store') call detected, but you probably meant set('collection')")},_getTotal:function(){return this._total},_cleanupCollection:function(f){f=f||{};this._observerHandle&&(this._observerHandle.remove(),this._observerHandle=this._rows=
null);!1!==f.shouldRevert&&(this.dirty={});this._renderedCollection=this.collection=null},_applySort:function(){this.collection?this.set("collection",this.collection):this.store&&console.debug("_StoreMixin found store property but not collection; this is often the sign of a mistake during migration from 0.3 to 0.4")},_emitRefreshComplete:function(){var f=this;this._refreshTimeout=setTimeout(function(){w.emit(f.domNode,"dgrid-refresh-complete",{bubbles:!0,cancelable:!1,grid:f});f._refreshTimeout=null},
0)},_insertNoDataNode:function(f){this._removeNoDataNode();f=f||this.contentNode;var e=this.noDataNode=g.create("div",{className:"dgrid-no-data",innerHTML:this.noDataMessage});f.insertBefore(e,this._getFirstRowSibling?this._getFirstRowSibling(f):null);return e},_removeNoDataNode:function(){return this.noDataNode?(g.destroy(this.noDataNode),delete this.noDataNode,!0):!1},row:function(){var f=this.inherited(arguments);f&&f.data&&"undefined"!==typeof f.id&&(f.id=this.collection.getIdentity(f.data));
return f},refresh:function(){var f=this.inherited(arguments);this.collection||this._insertNoDataNode();return f},refreshCell:function(f){if(!this.collection||!this._createBodyRowCell)throw Error("refreshCell requires a Grid with a collection.");this.inherited(arguments);return this.collection.get(f.row.id).then(b.hitch(this,"_refreshCellFromItem",f))},_refreshCellFromItem:function(f,e,k){var r=f.element;g.empty(r);var y=this.dirty&&this.dirty[f.row.id];y&&(e=b.delegate(e,y));this._createBodyRowCell(r,
f.column,e,k)},renderArray:function(){var f=this.inherited(arguments);this.collection||f.length&&this.noDataNode&&g.destroy(this.noDataNode);return f},insertRow:function(f,e,k,r,y){var p=this.collection,h=this.dirty;p=p&&p.getIdentity(f);var m;p in h&&!(p in this._updating)&&(m=h[p]);m&&(f=b.delegate(f,m));h=this.inherited(arguments);y&&y.rows&&(y.rows[r]=h);this.noDataNode&&(g.destroy(this.noDataNode),this.noDataNode=null);return h},updateDirty:function(f,e,k){var r=this.dirty,y=r[f];y||(y=r[f]=
{});y[e]=k},save:function(){function f(q,z){return function(v){var B=e._columnsWithSet,A=e._updating,E;if("function"===typeof v.set)v.set(z);else for(E in z)v[E]=z[E];for(E in B){var C=B[E].set(v);void 0!==C&&(v[E]=C)}A[q]=!0;return k.put(v).then(function(D){delete r[q];delete A[q];p[q]=D;return p})}}var e=this,k=this.collection,r=this.dirty,y=new c,p={},h=function(q){var z;return e.getBeforePut||!(z=e.row(q).data)?function(){return k.get(q)}:function(){return z}},m=y.then(function(){return p}),u;
for(u in r){var t=f(u,r[u]);m=m.then(h(u)).then(t)}y.resolve();return m},revert:function(){this.dirty={};this.refresh()},_trackError:function(f){"string"===typeof f&&(f=b.hitch(this,f));var e=this;try{var k=l(f())}catch(r){f=new c,f.reject(r),k=f.promise}k.otherwise(function(r){n.call(e,r)});return k},removeRow:function(f,e,k){var r={element:f};e||this.up(r).element!==f||this.down(r).element!==f||this._insertNoDataNode();(r=k&&k.rows||this._rows)&&delete r[f.rowIndex];return this.inherited(arguments)},
renderQueryResults:function(f,e,k){k=b.mixin({rows:this._rows},k);var r=this;return f.then(function(y){y=r.renderArray(y,e,k);delete r._lastCollection;return y})},_observeCollection:function(f,e,k){var r=this,y=k.rows,p,h=[f.on("delete, update",function(m){var u=m.previousIndex,t=m.index;void 0!==u&&y[u]&&("max"in y&&(void 0===t||t<y.min||t>y.max)&&y.max--,0>y.max&&(y.max=0),p=y[u],p.parentNode===e&&r.removeRow(p,!1,k),y.splice(u,1),("delete"===m.type||"update"===m.type&&(u<t||void 0===t))&&y[u]&&
y[u].rowIndex--);"delete"===m.type&&(p=null)}),f.on("add, update",function(m){var u=m.previousIndex,t=m.index;if(void 0!==t&&(!("max"in y)||t>=y.min&&t<=y.max)){"max"in y&&(void 0===u||u<y.min||u>y.max)&&y.max++;if(y.length){if(u=y[t],!u&&(u=y[t-1]))u=(u.connected||u).nextSibling}else u=r._getFirstRowSibling&&r._getFirstRowSibling(e);p&&u&&p.id===u.id&&(u=(u.connected||u).nextSibling);u&&!u.parentNode&&(u=document.getElementById(u.id));y.splice(t,0,void 0);p=r.insertRow(m.target,e,u,t,k);r.highlightRow(p)}p=
null}),f.on("add, delete, update",function(m){var u="undefined"!==typeof m.previousIndex?m.previousIndex:Infinity,t="undefined"!==typeof m.index?m.index:Infinity,q=Math.min(u,t);u!==t&&y[q]&&r.adjustRowIndices(y[q]);Infinity!==u&&r._processScroll&&(y[u]||y[u-1])&&r._processScroll();r._onNotification(y,m,f);f===r._renderedCollection&&"totalLength"in m&&(r._total=m.totalLength)})];return{remove:function(){for(;0<h.length;)h.pop().remove()}}},_onNotification:function(){}})})},"dgrid/Selection":function(){define("dojo/_base/declare dojo/aspect dojo/dom-class dojo/mouse dojo/on dojo/sniff dojo/has!touch?./util/touch dojo/query dojo/dom".split(" "),
function(a,b,c,d,g,x,w){function l(p,h){h=p.unselectable=h?"on":"";p=p.getElementsByTagName("*");for(var m=p.length;--m;)"INPUT"!==p[m].tagName&&"TEXTAREA"!==p[m].tagName&&(p[m].unselectable=h)}function n(p,h){var m=p.bodyNode,u=h?"text":"-moz-none";f&&"msUserSelect"!==f?m.style[f]=u:x("dom-selectstart")?h||p._selectstartHandle?h&&p._selectstartHandle&&(p._selectstartHandle.remove(),delete p._selectstartHandle):p._selectstartHandle=g(m,"selectstart",function(t){var q=t.target&&t.target.tagName;"INPUT"!==
q&&"TEXTAREA"!==q&&t.preventDefault()}):(l(m,!h),h||p._unselectableHandle)?h&&p._unselectableHandle&&(p._unselectableHandle.remove(),delete p._unselectableHandle):p._unselectableHandle=b.after(p,"renderRow",function(t){l(t,!0);return t})}x.add("dom-comparedocumentposition",function(p,h,m){return!!m.compareDocumentPosition});x.add("dom-selectstart","undefined"!==typeof document.onselectstart);var f=x("css-user-select"),e=x("pointer"),k=e&&"MS"===e.slice(0,2),r=e?e+(k?"Down":"down"):"mousedown",y=e?
e+(k?"Up":"up"):"mouseup";"WebkitUserSelect"===f&&"undefined"!==typeof document.documentElement.style.msUserSelect&&(f=!1);return a(null,{selectionDelegate:".dgrid-row",selectionEvents:r+","+y+",dgrid-cellfocusin",selectionTouchEvents:x("touch")?w.tap:null,deselectOnRefresh:!0,allowSelectAll:!1,selection:{},selectionMode:"extended",allowTextSelection:void 0,_selectionTargetType:"rows",create:function(){this.selection={};return this.inherited(arguments)},postCreate:function(){this.inherited(arguments);
this._initSelectionEvents();var p=this.selectionMode;this.selectionMode="";this._setSelectionMode(p)},destroy:function(){this.inherited(arguments);this._selectstartHandle&&this._selectstartHandle.remove();this._unselectableHandle&&this._unselectableHandle.remove();this._removeDeselectSignals&&this._removeDeselectSignals()},_setSelectionMode:function(p){p!==this.selectionMode&&(this.clearSelection(),this.selectionMode=p,this._selectionHandlerName="_"+p+"SelectionHandler",this._setAllowTextSelection(this.allowTextSelection))},
_setAllowTextSelection:function(p){"undefined"!==typeof p?n(this,p):n(this,"none"===this.selectionMode);this.allowTextSelection=p},_handleSelect:function(p,h){if(!d.isRight(p)&&this[this._selectionHandlerName]&&this.allowSelect(this.row(h))&&("dgrid-cellfocusin"!==p.type||"mousedown"!==p.parentType)&&(p.type!==y||h===this._waitForMouseUp)){this._waitForMouseUp=null;this._selectionTriggerEvent=p;if(!p.keyCode||!p.ctrlKey||32===p.keyCode)if(!p.shiftKey&&p.type===r&&this.isSelected(h))this._waitForMouseUp=
h;else this[this._selectionHandlerName](p,h);this._selectionTriggerEvent=null}},_singleSelectionHandler:function(p,h){p=p.keyCode?p.ctrlKey:p.metaKey;this._lastSelected===h?this.select(h,null,!p||!this.isSelected(h)):(this.clearSelection(),this.select(h),this._lastSelected=h)},_multipleSelectionHandler:function(p,h){var m=this._lastSelected,u=p.keyCode?p.ctrlKey:p.metaKey;if(!p.shiftKey){var t=u?null:!0;m=null}this.select(h,m,t);m||(this._lastSelected=h)},_extendedSelectionHandler:function(p,h){if(p.metaKey||
!this.isSelected(h)||1!==this.getSelectedCount())(2===p.button?this.isSelected(h):p.keyCode?p.ctrlKey:p.metaKey)||this.clearSelection(null,!0),this._multipleSelectionHandler(p,h)},_toggleSelectionHandler:function(p,h){this.select(h,null,null)},_initSelectionEvents:function(){var p=this,h=this.contentNode,m=this.selectionDelegate;this._selectionEventQueues={deselect:[],select:[]};x("touch")&&!x("pointer")&&this.selectionTouchEvents?(g(h,w.selector(m,this.selectionTouchEvents),function(u){p._handleSelect(u,
this);p._ignoreMouseSelect=this}),g(h,g.selector(m,this.selectionEvents),function(u){p._ignoreMouseSelect!==this?p._handleSelect(u,this):u.type===y&&(p._ignoreMouseSelect=null)})):g(h,g.selector(m,this.selectionEvents),function(u){p._handleSelect(u,this)});this.addKeyHandler&&this.addKeyHandler(32,function(u){p._handleSelect(u,u.target)});if(this.allowSelectAll)this.on("keydown",function(u){u.metaKey&&65===u.keyCode&&!/\bdgrid-input\b/.test(u.target.className)&&(u.preventDefault(),p[p.allSelected?
"clearSelection":"selectAll"]())});this._setCollection&&this._listeners.push(b.before(this,"_setCollection",function(u){p._updateDeselectionAspect(u)}));this._updateDeselectionAspect()},_updateDeselectionAspect:function(p){function h(t,q){if((t=m.row(t))&&m.selection[t.id])m[q](t)}var m=this;this._removeDeselectSignals&&this._removeDeselectSignals();var u=p&&p.track&&this._observeCollection?[b.before(this,"_observeCollection",function(t){u.push(t.on("delete",function(q){"undefined"===typeof q.index&&
h(q.id,"deselect")}))}),b.after(this,"_observeCollection",function(t){u.push(t.on("update",function(q){"undefined"!==typeof q.index&&h(t.getIdentity(q.target),"select")}))},!0)]:[b.before(this,"removeRow",function(t,q){q||(t=this.row(t))&&t.id in this.selection&&this.deselect(t)})];this._removeDeselectSignals=function(){for(var t=u.length;t--;)u[t].remove();u=[]}},allowSelect:function(){return!0},_fireSelectionEvent:function(p){var h=this._selectionEventQueues[p],m=this._selectionTriggerEvent;var u=
{bubbles:!0,grid:this};m&&(u.parentType=m.type);u[this._selectionTargetType]=h;this._selectionEventQueues[p]=[];g.emit(this.contentNode,"dgrid-"+p,u)},_fireSelectionEvents:function(){var p=this._selectionEventQueues,h;for(h in p)p[h].length&&this._fireSelectionEvent(h)},_select:function(p,h,m){"undefined"===typeof m&&(m=!0);p.element||(p=this.row(p));if(!1===m||this.allowSelect(p)){var u=this.selection;var t=!!u[p.id];null===m&&(m=!t);var q=p.element;m||this.allSelected?u[p.id]=m:delete this.selection[p.id];
q&&(m?c.add(q,"dgrid-selected"+(this.addUiClasses?" ui-state-active":"")):c.remove(q,"dgrid-selected ui-state-active"));m!==t&&q&&this._selectionEventQueues[(m?"":"de")+"select"].push(p);if(h)if(h.element||(h=this.row(h)),h){if(h=h.element)for(u=this._determineSelectionDirection(q,h),u||(h=document.getElementById(h.id),u=this._determineSelectionDirection(q,h));p.element!==h&&(p=this[u](p));)this._select(p,null,m)}else this._lastSelected=q,console.warn("The selection range has been reset because the beginning of the selection is no longer in the DOM. If you are using OnDemandList, you may wish to increase farOffRemoval to avoid this, but note that keeping more nodes in the DOM may impact performance.")}},
_determineSelectionDirection:x("dom-comparedocumentposition")?function(p,h){p=h.compareDocumentPosition(p);return p&1?!1:2===p?"down":"up"}:function(p,h){return 1>h.sourceIndex?!1:h.sourceIndex>p.sourceIndex?"down":"up"},select:function(p,h,m){this._select(p,h,m);this._fireSelectionEvents()},deselect:function(p,h){this.select(p,h,!1)},clearSelection:function(p,h){this.allSelected=!1;for(var m in this.selection)p!==m&&this._select(m,null,!1);h||(this._lastSelected=null);this._fireSelectionEvents()},
selectAll:function(){this.allSelected=!0;this.selection={};for(var p in this._rowIdToObject){var h=this.row(this._rowIdToObject[p]);this._select(h.id,null,!0)}this._fireSelectionEvents()},getSelectedCount:function(){var p=0,h;for(h in this.selection)h&&(p+=1);return p},isSelected:function(p){if("undefined"===typeof p||null===p)return!1;p.element||(p=this.row(p));return p.id in this.selection?!!this.selection[p.id]:this.allSelected&&(!p.data||this.allowSelect(p))},refresh:function(){this.deselectOnRefresh&&
this.clearSelection();this._lastSelected=null;return this.inherited(arguments)},renderArray:function(){var p=this.inherited(arguments),h=this.selection,m,u;for(m=0;m<p.length;m++){var t=this.row(p[m]);(u=t.id in h?h[t.id]:this.allSelected)&&this.select(t,null,u)}this._fireSelectionEvents();return p}})})},"dojo/store/Memory":function(){define(["../_base/declare","./util/QueryResults","./util/SimpleQueryEngine"],function(a,b,c){return a("dojo.store.Memory",null,{constructor:function(d){for(var g in d)this[g]=
d[g];this.setData(this.data||[])},data:null,idProperty:"id",index:null,queryEngine:c,get:function(d){return this.data[this.index[d]]},getIdentity:function(d){return d[this.idProperty]},put:function(d,g){var x=this.data,w=this.index,l=this.idProperty;l=d[l]=g&&"id"in g?g.id:l in d?d[l]:Math.random();if(l in w){if(g&&!1===g.overwrite)throw Error("Object already exists");x[w[l]]=d}else w[l]=x.push(d)-1;return l},add:function(d,g){(g=g||{}).overwrite=!1;return this.put(d,g)},remove:function(d){var g=
this.index,x=this.data;if(d in g)return x.splice(g[d],1),this.setData(x),!0},query:function(d,g){return b(this.queryEngine(d,g)(this.data))},setData:function(d){d.items?(this.idProperty=d.identifier||this.idProperty,d=this.data=d.items):this.data=d;this.index={};for(var g=0,x=d.length;g<x;g++)this.index[d[g][this.idProperty]]=g}})})},"dojo/store/util/QueryResults":function(){define(["../../_base/array","../../_base/lang","../../when"],function(a,b,c){var d=function(g){function x(l){g[l]=function(){var n=
arguments,f=c(g,function(e){Array.prototype.unshift.call(n,e);return d(a[l].apply(a,n))});if("forEach"!==l||w)return f}}if(!g)return g;var w=!!g.then;w&&(g=b.delegate(g));x("forEach");x("filter");x("map");null==g.total&&(g.total=c(g,function(l){return l.length}));return g};b.setObject("dojo.store.util.QueryResults",d);return d})},"dojo/store/util/SimpleQueryEngine":function(){define(["../../_base/array"],function(a){return function(b,c){function d(x){x=a.filter(x,b);var w=c&&c.sort;w&&x.sort("function"==
typeof w?w:function(n,f){for(var e,k=0;e=w[k];k++){var r=n[e.attribute],y=f[e.attribute];r=null!=r?r.valueOf():r;y=null!=y?y.valueOf():y;if(r!=y)return!!e.descending==(null==r||r>y)?-1:1}return 0});if(c&&(c.start||c.count)){var l=x.length;x=x.slice(c.start||0,(c.start||0)+(c.count||Infinity));x.total=l}return x}switch(typeof b){default:throw Error("Can not query with a "+typeof b);case "object":case "undefined":var g=b;b=function(x){for(var w in g){var l=g[w];if(l&&l.test){if(!l.test(x[w],x))return!1}else if(l!=
x[w])return!1}return!0};break;case "string":if(!this[b])throw Error("No filter function "+b+" was found in store");b=this[b];case "function":}d.matches=b;return d}})},"dojo/dnd/Source":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom-class ../dom-geometry ../mouse ../ready ../topic ./common ./Selector ./Manager".split(" "),function(a,b,c,d,g,x,w,l,n,f,e,k){c.isAsync||l(0,function(){require(["dojo/dnd/AutoSource","dojo/dnd/Target"])});var r=b("dojo.dnd.Source",
e,{isSource:!0,horizontal:!1,copyOnly:!1,selfCopy:!1,selfAccept:!0,skipForm:!1,withHandles:!1,autoSync:!1,delay:0,accept:["text"],generateText:!0,constructor:function(y,p){d.mixin(this,d.mixin({},p));y=this.accept;if(y.length)for(this.accept={},p=0;p<y.length;++p)this.accept[y[p]]=1;this.mouseDown=this.isDragging=!1;this.targetBox=this.targetAnchor=null;this.before=!0;this._lastY=this._lastX=0;this.sourceState="";this.isSource&&g.add(this.node,"dojoDndSource");this.targetState="";this.accept&&g.add(this.node,
"dojoDndTarget");this.horizontal&&g.add(this.node,"dojoDndHorizontal");this.topics=[n.subscribe("/dnd/source/over",d.hitch(this,"onDndSourceOver")),n.subscribe("/dnd/start",d.hitch(this,"onDndStart")),n.subscribe("/dnd/drop",d.hitch(this,"onDndDrop")),n.subscribe("/dnd/cancel",d.hitch(this,"onDndCancel"))]},checkAcceptance:function(y,p){if(this==y)return!this.copyOnly||this.selfAccept;for(var h=0;h<p.length;++h){for(var m=y.getItem(p[h].id).type,u=!1,t=0;t<m.length;++t)if(m[t]in this.accept){u=!0;
break}if(!u)return!1}return!0},copyState:function(y,p){if(y)return!0;2>arguments.length&&(p=this==k.manager().target);if(p){if(this.copyOnly)return this.selfCopy}else return this.copyOnly;return!1},destroy:function(){r.superclass.destroy.call(this);a.forEach(this.topics,function(y){y.remove()});this.targetAnchor=null},onMouseMove:function(y){if(!this.isDragging||"Disabled"!=this.targetState){r.superclass.onMouseMove.call(this,y);var p=k.manager();if(!this.isDragging&&this.mouseDown&&this.isSource&&
(Math.abs(y.pageX-this._lastX)>this.delay||Math.abs(y.pageY-this._lastY)>this.delay)){var h=this.getSelectedNodes();h.length&&p.startDrag(this,h,this.copyState(f.getCopyKeyState(y),!0))}this.isDragging&&(h=!1,this.current&&(this.targetBox&&this.targetAnchor==this.current||(this.targetBox=x.position(this.current,!0)),h=this.horizontal?y.pageX-this.targetBox.x<this.targetBox.w/2==x.isBodyLtr(this.current.ownerDocument):y.pageY-this.targetBox.y<this.targetBox.h/2),this.current!=this.targetAnchor||h!=
this.before)&&(this._markTargetAnchor(h),p.canDrop(!this.current||p.source!=this||!(this.current.id in this.selection)))}},onMouseDown:function(y){this.mouseDown||!this._legalMouseDown(y)||this.skipForm&&f.isFormElement(y)||(this.mouseDown=!0,this._lastX=y.pageX,this._lastY=y.pageY,r.superclass.onMouseDown.call(this,y))},onMouseUp:function(y){this.mouseDown&&(this.mouseDown=!1,r.superclass.onMouseUp.call(this,y))},onDndSourceOver:function(y){this!==y?(this.mouseDown=!1,this.targetAnchor&&this._unmarkTargetAnchor()):
this.isDragging&&(y=k.manager(),y.canDrop("Disabled"!=this.targetState&&(!this.current||y.source!=this||!(this.current.id in this.selection))))},onDndStart:function(y,p,h){this.autoSync&&this.sync();this.isSource&&this._changeState("Source",this==y?h?"Copied":"Moved":"");p=this.accept&&this.checkAcceptance(y,p);this._changeState("Target",p?"":"Disabled");this==y&&k.manager().overSource(this);this.isDragging=!0},onDndDrop:function(y,p,h,m){if(this==m)this.onDrop(y,p,h);this.onDndCancel()},onDndCancel:function(){this.targetAnchor&&
(this._unmarkTargetAnchor(),this.targetAnchor=null);this.before=!0;this.mouseDown=this.isDragging=!1;this._changeState("Source","");this._changeState("Target","")},onDrop:function(y,p,h){if(this!=y)this.onDropExternal(y,p,h);else this.onDropInternal(p,h)},onDropExternal:function(y,p,h){var m=this._normalizedCreator;this._normalizedCreator=this.creator?function(u,t){return m.call(this,y.getItem(u.id).data,t)}:h?function(u){var t=y.getItem(u.id);u=u.cloneNode(!0);u.id=f.getUniqueId();return{node:u,
data:t.data,type:t.type}}:function(u){var t=y.getItem(u.id);y.delItem(u.id);return{node:u,data:t.data,type:t.type}};this.selectNone();h||this.creator||y.selectNone();this.insertNodes(!0,p,this.before,this.current);!h&&this.creator&&y.deleteSelectedNodes();this._normalizedCreator=m},onDropInternal:function(y,p){var h=this._normalizedCreator;if(!(this.current&&this.current.id in this.selection)){if(p)this._normalizedCreator=this.creator?function(m,u){return h.call(this,this.getItem(m.id).data,u)}:function(m){var u=
this.getItem(m.id);m=m.cloneNode(!0);m.id=f.getUniqueId();return{node:m,data:u.data,type:u.type}};else{if(!this.current)return;this._normalizedCreator=function(m){var u=this.getItem(m.id);return{node:m,data:u.data,type:u.type}}}this._removeSelection();this.insertNodes(!0,y,this.before,this.current);this._normalizedCreator=h}},onDraggingOver:function(){},onDraggingOut:function(){},onOverEvent:function(){r.superclass.onOverEvent.call(this);k.manager().overSource(this);if(this.isDragging&&"Disabled"!=
this.targetState)this.onDraggingOver()},onOutEvent:function(){r.superclass.onOutEvent.call(this);k.manager().outSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOut()},_markTargetAnchor:function(y){if(this.current!=this.targetAnchor||this.before!=y)this.targetAnchor&&this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetAnchor=this.current,this.targetBox=null,this.before=y,this.targetAnchor&&this._addItemClass(this.targetAnchor,this.before?"Before":
"After")},_unmarkTargetAnchor:function(){this.targetAnchor&&(this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetBox=this.targetAnchor=null,this.before=!0)},_markDndStatus:function(y){this._changeState("Source",y?"Copied":"Moved")},_legalMouseDown:function(y){if("touchstart"!=y.type&&!w.isLeft(y))return!1;if(!this.withHandles)return!0;for(y=y.target;y&&y!==this.node;y=y.parentNode){if(g.contains(y,"dojoDndHandle"))return!0;if(g.contains(y,"dojoDndItem")||g.contains(y,
"dojoDndIgnore"))break}return!1}});return r})},"dojo/dnd/Selector":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom ../dom-construct ../mouse ../_base/NodeList ../on ../touch ./common ./Container".split(" "),function(a,b,c,d,g,x,w,l,n,f,e,k){var r=b("dojo.dnd.Selector",k,{constructor:function(y,p){p||(p={});this.singular=p.singular;this.autoSync=p.autoSync;this.selection={};this.anchor=null;this.simpleSelection=!1;this.events.push(n(this.node,f.press,d.hitch(this,
"onMouseDown")),n(this.node,f.release,d.hitch(this,"onMouseUp")))},singular:!1,getSelectedNodes:function(){var y=new l,p=e._empty,h;for(h in this.selection)h in p||y.push(g.byId(h));return y},selectNone:function(){return this._removeSelection()._removeAnchor()},selectAll:function(){this.forInItems(function(y,p){this._addItemClass(g.byId(p),"Selected");this.selection[p]=1},this);return this._removeAnchor()},deleteSelectedNodes:function(){var y=e._empty,p;for(p in this.selection)if(!(p in y)){var h=
g.byId(p);this.delItem(p);x.destroy(h)}this.anchor=null;this.selection={};return this},forInSelectedItems:function(y,p){p=p||c.global;var h=this.selection,m=e._empty,u;for(u in h)u in m||y.call(p,this.getItem(u),u,this)},sync:function(){r.superclass.sync.call(this);this.anchor&&!this.getItem(this.anchor.id)&&(this.anchor=null);var y=[],p=e._empty,h;for(h in this.selection)h in p||this.getItem(h)||y.push(h);a.forEach(y,function(m){delete this.selection[m]},this);return this},insertNodes:function(y,
p,h,m){var u=this._normalizedCreator;this._normalizedCreator=function(t,q){t=u.call(this,t,q);y?(this.anchor?this.anchor!=t.node&&(this._removeItemClass(t.node,"Anchor"),this._addItemClass(t.node,"Selected")):(this.anchor=t.node,this._removeItemClass(t.node,"Selected"),this._addItemClass(this.anchor,"Anchor")),this.selection[t.node.id]=1):(this._removeItemClass(t.node,"Selected"),this._removeItemClass(t.node,"Anchor"));return t};r.superclass.insertNodes.call(this,p,h,m);this._normalizedCreator=u;
return this},destroy:function(){r.superclass.destroy.call(this);this.selection=this.anchor=null},onMouseDown:function(y){this.autoSync&&this.sync();if(this.current)if(!this.singular&&!e.getCopyKeyState(y)&&!y.shiftKey&&this.current.id in this.selection)this.simpleSelection=!0,w.isLeft(y)&&(y.stopPropagation(),y.preventDefault());else{if(!this.singular&&y.shiftKey){e.getCopyKeyState(y)||this._removeSelection();var p=this.getAllNodes();if(p.length&&(this.anchor||(this.anchor=p[0],this._addItemClass(this.anchor,
"Anchor")),this.selection[this.anchor.id]=1,this.anchor!=this.current)){for(var h=0,m;h<p.length&&(m=p[h],m!=this.anchor&&m!=this.current);++h);for(++h;h<p.length;++h){m=p[h];if(m==this.anchor||m==this.current)break;this._addItemClass(m,"Selected");this.selection[m.id]=1}this._addItemClass(this.current,"Selected");this.selection[this.current.id]=1}}else this.singular?this.anchor==this.current?e.getCopyKeyState(y)&&this.selectNone():(this.selectNone(),this.anchor=this.current,this._addItemClass(this.anchor,
"Anchor"),this.selection[this.current.id]=1):e.getCopyKeyState(y)?this.anchor==this.current?(delete this.selection[this.anchor.id],this._removeAnchor()):this.current.id in this.selection?(this._removeItemClass(this.current,"Selected"),delete this.selection[this.current.id]):(this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this._addItemClass(this.anchor,"Selected")),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1):this.current.id in this.selection||
(this.selectNone(),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1);y.stopPropagation();y.preventDefault()}},onMouseUp:function(){this.simpleSelection&&(this.simpleSelection=!1,this.selectNone(),this.current&&(this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1))},onMouseMove:function(){this.simpleSelection=!1},onOverEvent:function(){this.onmousemoveEvent=n(this.node,f.move,d.hitch(this,"onMouseMove"))},
onOutEvent:function(){this.onmousemoveEvent&&(this.onmousemoveEvent.remove(),delete this.onmousemoveEvent)},_removeSelection:function(){var y=e._empty,p;for(p in this.selection)if(!(p in y)){var h=g.byId(p);h&&this._removeItemClass(h,"Selected")}this.selection={};return this},_removeAnchor:function(){this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this.anchor=null);return this}});return r})},"dojo/_base/NodeList":function(){define(["./kernel","../query","./array","./html","../NodeList-dom"],
function(a,b,c){b=b.NodeList;var d=b.prototype;d.connect=b._adaptAsForEach(function(){return a.connect.apply(this,arguments)});d.coords=b._adaptAsMap(a.coords);b.events="blur focus change click error keydown keypress keyup load mousedown mouseenter mouseleave mousemove mouseout mouseover mouseup submit".split(" ");c.forEach(b.events,function(g){var x="on"+g;d[x]=function(w,l){return this.connect(x,w,l)}});return a.NodeList=b})},"dojo/dnd/Container":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../_base/window ../dom ../dom-class ../dom-construct ../Evented ../has ../on ../query ../touch ./common".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y){b=b("dojo.dnd.Container",n,{skipForm:!1,allowNested:!1,constructor:function(p,h){this.node=x.byId(p);h||(h={});this.creator=h.creator||null;this.skipForm=h.skipForm;this.parent=h.dropParent&&x.byId(h.dropParent);this.map={};this.current=null;this.containerState="";w.add(this.node,"dojoDndContainer");h&&h._skipStartup||this.startup();this.events=[e(this.node,r.over,d.hitch(this,"onMouseOver")),e(this.node,r.out,d.hitch(this,"onMouseOut")),e(this.node,"dragstart",
d.hitch(this,"onSelectStart")),e(this.node,"selectstart",d.hitch(this,"onSelectStart"))]},creator:function(){},getItem:function(p){return this.map[p]},setItem:function(p,h){this.map[p]=h},delItem:function(p){delete this.map[p]},forInItems:function(p,h){h=h||c.global;var m=this.map,u=y._empty,t;for(t in m)t in u||p.call(h,m[t],t,this);return h},clearItems:function(){this.map={}},getAllNodes:function(){return k((this.allowNested?"":"\x3e ")+".dojoDndItem",this.parent)},sync:function(){var p={};this.getAllNodes().forEach(function(h){if(h.id){var m=
this.getItem(h.id);if(m){p[h.id]=m;return}}else h.id=y.getUniqueId();m=h.getAttribute("dndType");var u=h.getAttribute("dndData");p[h.id]={data:u||h.innerHTML,type:m?m.split(/\s*,\s*/):["text"]}},this);this.map=p;return this},insertNodes:function(p,h,m){this.parent.firstChild?h?m||(m=this.parent.firstChild):m&&(m=m.nextSibling):m=null;if(m)for(h=0;h<p.length;++h){var u=this._normalizedCreator(p[h]);this.setItem(u.node.id,{data:u.data,type:u.type});m.parentNode.insertBefore(u.node,m)}else for(h=0;h<
p.length;++h)u=this._normalizedCreator(p[h]),this.setItem(u.node.id,{data:u.data,type:u.type}),this.parent.appendChild(u.node);return this},destroy:function(){a.forEach(this.events,function(p){p.remove()});this.clearItems();this.node=this.parent=this.current=null},markupFactory:function(p,h,m){p._skipStartup=!0;return new m(h,p)},startup:function(){if(!this.parent&&(this.parent=this.node,"table"==this.parent.tagName.toLowerCase())){var p=this.parent.getElementsByTagName("tbody");p&&p.length&&(this.parent=
p[0])}this.defaultCreator=y._defaultCreator(this.parent);this.sync()},onMouseOver:function(p){for(var h=p.relatedTarget;h&&h!=this.node;)try{h=h.parentNode}catch(m){h=null}h||(this._changeState("Container","Over"),this.onOverEvent());h=this._getChildByEvent(p);this.current!=h&&(this.current&&this._removeItemClass(this.current,"Over"),h&&this._addItemClass(h,"Over"),this.current=h)},onMouseOut:function(p){for(p=p.relatedTarget;p;){if(p==this.node)return;try{p=p.parentNode}catch(h){p=null}}this.current&&
(this._removeItemClass(this.current,"Over"),this.current=null);this._changeState("Container","");this.onOutEvent()},onSelectStart:function(p){this.withHandles||this.skipForm&&y.isFormElement(p)||(p.stopPropagation(),p.preventDefault())},onOverEvent:function(){},onOutEvent:function(){},_changeState:function(p,h){var m="dojoDnd"+p;p=p.toLowerCase()+"State";w.replace(this.node,m+h,m+this[p]);this[p]=h},_addItemClass:function(p,h){w.add(p,"dojoDndItem"+h)},_removeItemClass:function(p,h){w.remove(p,"dojoDndItem"+
h)},_getChildByEvent:function(p){if(p=p.target)for(var h=p.parentNode;h;p=h,h=p.parentNode)if((h==this.parent||this.allowNested)&&w.contains(p,"dojoDndItem"))return p;return null},_normalizedCreator:function(p,h){p=(this.creator||this.defaultCreator).call(this,p,h);d.isArray(p.type)||(p.type=["text"]);p.node.id||(p.node.id=y.getUniqueId());w.add(p.node,"dojoDndItem");return p}});y._createNode=function(p){return p?function(h){return l.create(p,{innerHTML:h})}:y._createSpan};y._createTrTd=function(p){var h=
l.create("tr");l.create("td",{innerHTML:p},h);return h};y._createSpan=function(p){return l.create("span",{innerHTML:p})};y._defaultCreatorNodes={ul:"li",ol:"li",div:"div",p:"div"};y._defaultCreator=function(p){p=p.tagName.toLowerCase();var h="tbody"==p||"thead"==p?y._createTrTd:y._createNode(y._defaultCreatorNodes[p]);return function(m,u){var t=m&&d.isObject(m);if(t&&m.tagName&&m.nodeType&&m.getAttribute){var q=m.getAttribute("dndData")||m.innerHTML;t=(t=m.getAttribute("dndType"))?t.split(/\s*,\s*/):
["text"]}else q=t&&m.data?m.data:m,t=t&&m.type?m.type:["text"],m=("avatar"==u?y._createSpan:h)(String(q));m.id||(m.id=y.getUniqueId());return{node:m,data:q,type:t}}};return b})},"dojo/dnd/Manager":function(){define("../_base/array ../_base/declare ../_base/lang ../_base/window ../dom-class ../Evented ../has ../keys ../on ../topic ../touch ./common ./autoscroll ./Avatar".split(" "),function(a,b,c,d,g,x,w,l,n,f,e,k,r,y){var p=b("dojo.dnd.Manager",[x],{constructor:function(){this.source=this.avatar=
null;this.nodes=[];this.copy=!0;this.target=null;this.canDropFlag=!1;this.events=[]},OFFSET_X:w("touch")?4:16,OFFSET_Y:w("touch")?4:16,overSource:function(h){this.avatar&&(this.target=h&&"Disabled"!=h.targetState?h:null,this.canDropFlag=!!this.target,this.avatar.update());f.publish("/dnd/source/over",h)},outSource:function(h){this.avatar?this.target==h&&(this.target=null,this.canDropFlag=!1,this.avatar.update(),f.publish("/dnd/source/over",null)):f.publish("/dnd/source/over",null)},startDrag:function(h,
m,u){function t(q){q.preventDefault();q.stopPropagation()}r.autoScrollStart(d.doc);this.source=h;this.nodes=m;this.copy=!!u;this.avatar=this.makeAvatar();d.body().appendChild(this.avatar.node);f.publish("/dnd/start",h,m,this.copy);this.events=[n(d.doc,e.move,c.hitch(this,"onMouseMove")),n(d.doc,e.release,c.hitch(this,"onMouseUp")),n(d.doc,"keydown",c.hitch(this,"onKeyDown")),n(d.doc,"keyup",c.hitch(this,"onKeyUp")),n(d.doc,"dragstart",t),n(d.body(),"selectstart",t)];h="dojoDnd"+(u?"Copy":"Move");
g.add(d.body(),h)},canDrop:function(h){h=!(!this.target||!h);this.canDropFlag!=h&&(this.canDropFlag=h,this.avatar.update())},stopDrag:function(){g.remove(d.body(),["dojoDndCopy","dojoDndMove"]);a.forEach(this.events,function(h){h.remove()});this.events=[];this.avatar.destroy();this.source=this.target=this.avatar=null;this.nodes=[]},makeAvatar:function(){return new y(this)},updateAvatar:function(){this.avatar.update()},onMouseMove:function(h){var m=this.avatar;m&&(r.autoScrollNodes(h),m=m.node.style,
m.left=h.pageX+this.OFFSET_X+"px",m.top=h.pageY+this.OFFSET_Y+"px",m=!!this.source.copyState(k.getCopyKeyState(h)),this.copy!=m&&this._setCopyStatus(m));w("touch")&&h.preventDefault()},onMouseUp:function(h){if(this.avatar){if(this.target&&this.canDropFlag){var m=!!this.source.copyState(k.getCopyKeyState(h));f.publish("/dnd/drop/before",this.source,this.nodes,m,this.target,h);f.publish("/dnd/drop",this.source,this.nodes,m,this.target,h)}else f.publish("/dnd/cancel");this.stopDrag()}},onKeyDown:function(h){if(this.avatar)switch(h.keyCode){case l.CTRL:h=
!!this.source.copyState(!0);this.copy!=h&&this._setCopyStatus(h);break;case l.ESCAPE:f.publish("/dnd/cancel"),this.stopDrag()}},onKeyUp:function(h){this.avatar&&h.keyCode==l.CTRL&&(h=!!this.source.copyState(!1),this.copy!=h&&this._setCopyStatus(h))},_setCopyStatus:function(h){this.copy=h;this.source._markDndStatus(this.copy);this.updateAvatar();g.replace(d.body(),"dojoDnd"+(this.copy?"Copy":"Move"),"dojoDnd"+(this.copy?"Move":"Copy"))}});k._manager=null;p.manager=k.manager=function(){k._manager||
(k._manager=new p);return k._manager};return p})},"dojo/dnd/Avatar":function(){define("../_base/declare ../_base/window ../dom ../dom-attr ../dom-class ../dom-construct ../hccss ../query".split(" "),function(a,b,c,d,g,x,w,l){return a("dojo.dnd.Avatar",null,{constructor:function(n){this.manager=n;this.construct()},construct:function(){var n=x.create("table",{"class":"dojoDndAvatar",style:{position:"absolute",zIndex:"1999",margin:"0px"}}),f=this.manager.source,e=x.create("tbody",null,n),k=x.create("tr",
null,e),r=x.create("td",null,k),y=Math.min(5,this.manager.nodes.length),p=0;w("highcontrast")&&x.create("span",{id:"a11yIcon",innerHTML:this.manager.copy?"+":"\x3c"},r);x.create("span",{innerHTML:f.generateText?this._generateText():""},r);for(d.set(k,{"class":"dojoDndAvatarHeader",style:{opacity:.9}});p<y;++p){if(f.creator)var h=f._normalizedCreator(f.getItem(this.manager.nodes[p].id).data,"avatar").node;else h=this.manager.nodes[p].cloneNode(!0),"tr"==h.tagName.toLowerCase()&&(k=x.create("table"),
x.create("tbody",null,k).appendChild(h),h=k);h.id="";k=x.create("tr",null,e);r=x.create("td",null,k);r.appendChild(h);d.set(k,{"class":"dojoDndAvatarItem",style:{opacity:(9-p)/10}})}this.node=n},destroy:function(){x.destroy(this.node);this.node=!1},update:function(){g.toggle(this.node,"dojoDndAvatarCanDrop",this.manager.canDropFlag);if(w("highcontrast")){var n=c.byId("a11yIcon"),f="+";this.manager.canDropFlag&&!this.manager.copy?f="\x3c ":this.manager.canDropFlag||this.manager.copy?this.manager.canDropFlag||
(f="x"):f="o";n.innerHTML=f}l("tr.dojoDndAvatarHeader td span"+(w("highcontrast")?" span":""),this.node).forEach(function(e){e.innerHTML=this.manager.source.generateText?this._generateText():""},this)},_generateText:function(){return this.manager.nodes.length.toString()}})})},"dijit/CheckedMenuItem":function(){define(["dojo/_base/declare","dojo/dom-class","./MenuItem","dojo/text!./templates/CheckedMenuItem.html","./hccss"],function(a,b,c,d){return a("dijit.CheckedMenuItem",c,{baseClass:"dijitMenuItem dijitCheckedMenuItem",
templateString:d,checked:!1,_setCheckedAttr:function(g){this.domNode.setAttribute("aria-checked",g?"true":"false");this._set("checked",g)},iconClass:"",role:"menuitemcheckbox",checkedChar:"\x26#10003;",onChange:function(){},_onClick:function(g){this.disabled||(this.set("checked",!this.checked),this.onChange(this.checked));this.onClick(g)}})})},"dijit/MenuItem":function(){define("dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/kernel dojo/sniff dojo/_base/lang ./_Widget ./_TemplatedMixin ./_Contained ./_CssStateMixin dojo/text!./templates/MenuItem.html".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k){w=a("dijit.MenuItem"+(x("dojo-bidi")?"_NoBidi":""),[l,n,f,e],{templateString:k,baseClass:"dijitMenuItem",label:"",_setLabelAttr:function(r){this._set("label",r);var y="";var p=r.search(/{\S}/);if(0<=p){y=r.charAt(p+1);var h=r.substr(0,p);r=r.substr(p+3);p=h+y+r;r=h+'\x3cspan class\x3d"dijitMenuItemShortcutKey"\x3e'+y+"\x3c/span\x3e"+r}else p=r;this.domNode.setAttribute("aria-label",p+" "+this.accelKey);this.containerNode.innerHTML=r;this._set("shortcutKey",y)},iconClass:"dijitNoIcon",
_setIconClassAttr:{node:"iconNode",type:"class"},accelKey:"",disabled:!1,_fillContent:function(r){!r||"label"in this.params||this._set("label",r.innerHTML)},buildRendering:function(){this.inherited(arguments);c.set(this.containerNode,"id",this.id+"_text");this.accelKeyNode&&c.set(this.accelKeyNode,"id",this.id+"_accel");b.setSelectable(this.domNode,!1)},onClick:function(){},focus:function(){try{8==x("ie")&&this.containerNode.focus(),this.focusNode.focus()}catch(r){}},_setSelected:function(r){d.toggle(this.domNode,
"dijitMenuItemSelected",r)},setLabel:function(r){g.deprecated("dijit.MenuItem.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",r)},setDisabled:function(r){g.deprecated("dijit.Menu.setDisabled() is deprecated.  Use set('disabled', bool) instead.","","2.0");this.set("disabled",r)},_setDisabledAttr:function(r){this.focusNode.setAttribute("aria-disabled",r?"true":"false");this._set("disabled",r)},_setAccelKeyAttr:function(r){this.accelKeyNode&&(this.accelKeyNode.style.display=
r?"":"none",this.accelKeyNode.innerHTML=r,c.set(this.containerNode,"colSpan",r?"1":"2"));this._set("accelKey",r)}});x("dojo-bidi")&&(w=a("dijit.MenuItem",w,{_setLabelAttr:function(r){this.inherited(arguments);"auto"===this.textDir&&this.applyTextDir(this.textDirNode)}}));return w})},"dijit/form/Select":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/i18n dojo/keys dojo/_base/lang dojo/on dojo/sniff ./_FormSelectWidget ../_HasDropDown ../DropDownMenu ../MenuItem ../MenuSeparator ../Tooltip ../_KeyNavMixin ../registry dojo/text!./templates/Select.html dojo/i18n!./nls/validate".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t){function q(v){return function(B){this._isLoaded?this.inherited(v,arguments):this.loadDropDown(l.hitch(this,v,B))}}var z=b("dijit.form._SelectMenu",r,{autoFocus:!0,buildRendering:function(){this.inherited(arguments);this.domNode.setAttribute("role","listbox")},postCreate:function(){this.inherited(arguments);this.own(n(this.domNode,"selectstart",function(v){v.preventDefault();v.stopPropagation()}))},focus:function(){var v=!1,B=this.parentWidget.value;
l.isArray(B)&&(B=B[B.length-1]);B&&a.forEach(this.parentWidget._getChildren(),function(A){A.option&&B===A.option.value&&(v=!0,this.focusChild(A,!1))},this);v||this.inherited(arguments)}});g=b("dijit.form.Select"+(f("dojo-bidi")?"_NoBidi":""),[e,k,m],{baseClass:"dijitSelect dijitValidationTextBox",templateString:t,_buttonInputDisabled:f("ie")?"disabled":"",required:!1,state:"",message:"",tooltipPosition:[],emptyLabel:"\x26#160;",_isLoaded:!1,_childrenLoaded:!1,labelType:"html",_fillContent:function(){this.inherited(arguments);
if(this.options.length&&!this.value&&this.srcNodeRef){var v=this.srcNodeRef.selectedIndex||0;this._set("value",this.options[0<=v?v:0].value)}this.dropDown=new z({id:this.id+"_menu",parentWidget:this});d.add(this.dropDown.domNode,this.baseClass.replace(/\s+|$/g,"Menu "))},_getMenuItemForOption:function(v){if(v.value||v.label){var B=l.hitch(this,"_setValueAttr",v);v=new y({option:v,label:("text"===this.labelType?(v.label||"").toString().replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):v.label)||this.emptyLabel,
onClick:B,ownerDocument:this.ownerDocument,dir:this.dir,textDir:this.textDir,disabled:v.disabled||!1});v.focusNode.setAttribute("role","option");return v}return new p({ownerDocument:this.ownerDocument})},_addOptionItem:function(v){this.dropDown&&this.dropDown.addChild(this._getMenuItemForOption(v))},_getChildren:function(){return this.dropDown?this.dropDown.getChildren():[]},focus:function(){if(!this.disabled&&this.focusNode.focus)try{this.focusNode.focus()}catch(v){}},focusChild:function(v){v&&this.set("value",
v.option)},_getFirst:function(){var v=this._getChildren();return v.length?v[0]:null},_getLast:function(){var v=this._getChildren();return v.length?v[v.length-1]:null},childSelector:function(v){return(v=u.byNode(v))&&v.getParent()==this.dropDown},onKeyboardSearch:function(v,B,A,E){v&&this.focusChild(v)},_loadChildren:function(v){if(!0===v)if(this.dropDown&&(delete this.dropDown.focusedChild,this.focusedChild=null),this.options.length)this.inherited(arguments);else{a.forEach(this._getChildren(),function(A){A.destroyRecursive()});
var B=new y({ownerDocument:this.ownerDocument,label:this.emptyLabel});this.dropDown.addChild(B)}else this._updateSelection();this._isLoaded=!1;this._childrenLoaded=!0;this._loadingStore||this._setValueAttr(this.value,!1)},_refreshState:function(){this._started&&this.validate(this.focused)},startup:function(){this.inherited(arguments);this._refreshState()},_setValueAttr:function(v){this.inherited(arguments);c.set(this.valueNode,"value",this.get("value"));this._refreshState()},_setNameAttr:"valueNode",
_setDisabledAttr:function(v){this.inherited(arguments);this._refreshState()},_setRequiredAttr:function(v){this._set("required",v);this.focusNode.setAttribute("aria-required",v);this._refreshState()},_setOptionsAttr:function(v){this._isLoaded=!1;this._set("options",v)},_setDisplay:function(v){v=("text"===this.labelType?(v||"").replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):v)||this.emptyLabel;this.containerNode.innerHTML='\x3cspan role\x3d"option" aria-selected\x3d"true" class\x3d"dijitReset dijitInline '+
this.baseClass.replace(/\s+|$/g,"Label ")+'"\x3e'+v+"\x3c/span\x3e"},validate:function(v){v=this.disabled||this.isValid(v);this._set("state",v?"":this._hasBeenBlurred?"Error":"Incomplete");this.focusNode.setAttribute("aria-invalid",v?"false":"true");var B=v?"":this._missingMsg;B&&this.focused&&this._hasBeenBlurred?h.show(B,this.domNode,this.tooltipPosition,!this.isLeftToRight()):h.hide(this.domNode);this._set("message",B);return v},isValid:function(){return!this.required||0===this.value||!/^\s*$/.test(this.value||
"")},reset:function(){this.inherited(arguments);h.hide(this.domNode);this._refreshState()},postMixInProperties:function(){this.inherited(arguments);this._missingMsg=x.getLocalization("dijit.form","validate",this.lang).missingMessage},postCreate:function(){this.inherited(arguments);this.own(n(this.domNode,"selectstart",function(B){B.preventDefault();B.stopPropagation()}));this.domNode.setAttribute("aria-expanded","false");var v=this._keyNavCodes;delete v[w.LEFT_ARROW];delete v[w.RIGHT_ARROW]},_setStyleAttr:function(v){this.inherited(arguments);
d.toggle(this.domNode,this.baseClass.replace(/\s+|$/g,"FixedWidth "),!!this.domNode.style.width)},isLoaded:function(){return this._isLoaded},loadDropDown:function(v){this._loadChildren(!0);this._isLoaded=!0;v()},destroy:function(v){this.dropDown&&!this.dropDown._destroyed&&(this.dropDown.destroyRecursive(v),delete this.dropDown);h.hide(this.domNode);this.inherited(arguments)},_onFocus:function(){this.validate(!0)},_onBlur:function(){h.hide(this.domNode);this.inherited(arguments);this.validate(!1)}});
f("dojo-bidi")&&(g=b("dijit.form.Select",g,{_setDisplay:function(v){this.inherited(arguments);this.applyTextDir(this.containerNode)}}));g._Menu=z;g.prototype._onContainerKeydown=q("_onContainerKeydown");g.prototype._onContainerKeypress=q("_onContainerKeypress");return g})},"dijit/form/_FormSelectWidget":function(){define("dojo/_base/array dojo/_base/Deferred dojo/aspect dojo/data/util/sorter dojo/_base/declare dojo/dom dojo/dom-class dojo/_base/kernel dojo/_base/lang dojo/query dojo/when dojo/store/util/QueryResults ./_FormValueWidget".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r){return g("dijit.form._FormSelectWidget",r,{multiple:!1,options:null,store:null,_setStoreAttr:function(y){this._created&&this._deprecatedSetStore(y)},query:null,_setQueryAttr:function(y){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{query:y})},queryOptions:null,_setQueryOptionsAttr:function(y){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{queryOptions:y})},labelAttr:"",onFetch:null,sortByLabel:!0,loadChildrenOnOpen:!1,
onLoadDeferred:null,getOptions:function(y){var p=this.options||[];if(null==y)return p;if(n.isArrayLike(y))return a.map(y,"return this.getOptions(item);",this);n.isString(y)&&(y={value:y});n.isObject(y)&&(a.some(p,function(h,m){for(var u in y)if(!(u in h)||h[u]!=y[u])return!1;y=m;return!0})||(y=-1));return 0<=y&&y<p.length?p[y]:null},addOption:function(y){a.forEach(n.isArrayLike(y)?y:[y],function(p){p&&n.isObject(p)&&this.options.push(p)},this);this._loadChildren()},removeOption:function(y){y=this.getOptions(n.isArrayLike(y)?
y:[y]);a.forEach(y,function(p){p&&(this.options=a.filter(this.options,function(h){return h.value!==p.value||h.label!==p.label}),this._removeOptionItem(p))},this);this._loadChildren()},updateOption:function(y){a.forEach(n.isArrayLike(y)?y:[y],function(p){var h=this.getOptions({value:p.value}),m;if(h)for(m in p)h[m]=p[m]},this);this._loadChildren()},setStore:function(y,p,h){l.deprecated(this.declaredClass+"::setStore(store, selectedValue, fetchArgs) is deprecated. Use set('query', fetchArgs.query), set('queryOptions', fetchArgs.queryOptions), set('store', store), or set('value', selectedValue) instead.",
"","2.0");this._deprecatedSetStore(y,p,h)},_deprecatedSetStore:function(y,p,h){var m=this.store;h=h||{};if(m!==y){for(var u;u=this._notifyConnections.pop();)u.remove();y.get||(n.mixin(y,{_oldAPI:!0,get:function(t){var q=new b;this.fetchItemByIdentity({identity:t,onItem:function(z){q.resolve(z)},onError:function(z){q.reject(z)}});return q.promise},query:function(t,q){var z=new b(function(){v.abort&&v.abort()});z.total=new b;var v=this.fetch(n.mixin({query:t,onBegin:function(B){z.total.resolve(B)},
onComplete:function(B){z.resolve(B)},onError:function(B){z.reject(B)}},q));return new k(z)}}),y.getFeatures()["dojo.data.api.Notification"]&&(this._notifyConnections=[c.after(y,"onNew",n.hitch(this,"_onNewItem"),!0),c.after(y,"onDelete",n.hitch(this,"_onDeleteItem"),!0),c.after(y,"onSet",n.hitch(this,"_onSetItem"),!0)]));this._set("store",y)}this.options&&this.options.length&&this.removeOption(this.options);this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&
(this._observeHandle.remove(),this._observeHandle=null);h.query&&this._set("query",h.query);h.queryOptions&&this._set("queryOptions",h.queryOptions);y&&y.query&&(this._loadingStore=!0,this.onLoadDeferred=new b,this._queryRes=y.query(this.query,this.queryOptions),e(this._queryRes,n.hitch(this,function(t){if(this.sortByLabel&&!h.sort&&t.length)if(y.getValue)t.sort(d.createSortFunction([{attribute:y.getLabelAttributes(t[0])[0]}],y));else{var q=this.labelAttr;t.sort(function(z,v){return z[q]>v[q]?1:v[q]>
z[q]?-1:0})}h.onFetch&&(t=h.onFetch.call(this,t,h));a.forEach(t,function(z){this._addOptionForItem(z)},this);this._queryRes.observe&&(this._observeHandle=this._queryRes.observe(n.hitch(this,function(z,v,B){v==B?this._onSetItem(z):(-1!=v&&this._onDeleteItem(z),-1!=B&&this._onNewItem(z))}),!0));this._loadingStore=!1;this.set("value","_pendingValue"in this?this._pendingValue:p);delete this._pendingValue;this.loadChildrenOnOpen?this._pseudoLoadChildren(t):this._loadChildren();this.onLoadDeferred.resolve(!0);
this.onSetStore()}),n.hitch(this,function(t){console.error("dijit.form.Select: "+t.toString());this.onLoadDeferred.reject(t)})));return m},_setValueAttr:function(y,p){this._onChangeActive||(p=null);if(this._loadingStore)this._pendingValue=y;else if(null!=y){y=n.isArrayLike(y)?a.map(y,function(u){return n.isObject(u)?u:{value:u}}):n.isObject(y)?[y]:[{value:y}];y=a.filter(this.getOptions(y),function(u){return u&&u.value});var h=this.getOptions()||[];this.multiple||y[0]&&y[0].value||!h.length||(y[0]=
h[0]);a.forEach(h,function(u){u.selected=a.some(y,function(t){return t.value===u.value})});h=a.map(y,function(u){return u.value});if("undefined"!=typeof h&&"undefined"!=typeof h[0]){var m=a.map(y,function(u){return u.label});this._setDisplay(this.multiple?m:m[0]);this.inherited(arguments,[this.multiple?h:h[0],p]);this._updateSelection()}}},_getDisplayedValueAttr:function(){var y=a.map([].concat(this.get("selectedOptions")),function(p){return p&&"label"in p?p.label:p?p.value:null},this);return this.multiple?
y:y[0]},_setDisplayedValueAttr:function(y){this.set("value",this.getOptions("string"==typeof y?{label:y}:y))},_loadChildren:function(){this._loadingStore||(a.forEach(this._getChildren(),function(y){y.destroyRecursive()}),a.forEach(this.options,this._addOptionItem,this),this._updateSelection())},_updateSelection:function(){this.focusedChild=null;this._set("value",this._getValueFromOpts());var y=[].concat(this.value);if(y&&y[0]){var p=this;a.forEach(this._getChildren(),function(h){var m=a.some(y,function(u){return h.option&&
u===h.option.value});m&&!p.multiple&&(p.focusedChild=h);w.toggle(h.domNode,this.baseClass.replace(/\s+|$/g,"SelectedOption "),m);h.domNode.setAttribute("aria-selected",m?"true":"false")},this)}},_getValueFromOpts:function(){var y=this.getOptions()||[];if(!this.multiple&&y.length){var p=a.filter(y,function(h){return h.selected})[0];if(p&&p.value)return p.value;y[0].selected=!0;return y[0].value}return this.multiple?a.map(a.filter(y,function(h){return h.selected}),function(h){return h.value})||[]:""},
_onNewItem:function(y,p){p&&p.parent||this._addOptionForItem(y)},_onDeleteItem:function(y){this.removeOption({value:this.store.getIdentity(y)})},_onSetItem:function(y){this.updateOption(this._getOptionObjForItem(y))},_getOptionObjForItem:function(y){var p=this.store,h=this.labelAttr&&this.labelAttr in y?y[this.labelAttr]:p.getLabel(y);return{value:h?p.getIdentity(y):null,label:h,item:y}},_addOptionForItem:function(y){var p=this.store;p.isItemLoaded&&!p.isItemLoaded(y)?p.loadItem({item:y,onItem:function(h){this._addOptionForItem(h)},
scope:this}):(y=this._getOptionObjForItem(y),this.addOption(y))},constructor:function(y){this._oValue=(y||{}).value||null;this._notifyConnections=[]},buildRendering:function(){this.inherited(arguments);x.setSelectable(this.focusNode,!1)},_fillContent:function(){this.options||(this.options=this.srcNodeRef?f("\x3e *",this.srcNodeRef).map(function(y){return"separator"===y.getAttribute("type")?{value:"",label:"",selected:!1,disabled:!1}:{value:y.getAttribute("data-"+l._scopeName+"-value")||y.getAttribute("value"),
label:String(y.innerHTML),selected:y.getAttribute("selected")||!1,disabled:y.getAttribute("disabled")||!1}},this):[]);this.value?this.multiple&&"string"==typeof this.value&&this._set("value",this.value.split(",")):this._set("value",this._getValueFromOpts())},postCreate:function(){this.inherited(arguments);c.after(this,"onChange",n.hitch(this,"_updateSelection"));var y=this.store;y&&(y.getIdentity||y.getFeatures()["dojo.data.api.Identity"])&&(this.store=null,this._deprecatedSetStore(y,this._oValue,
{query:this.query,queryOptions:this.queryOptions}));this._storeInitialized=!0},startup:function(){this._loadChildren();this.inherited(arguments)},destroy:function(){for(var y;y=this._notifyConnections.pop();)y.remove();this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&(this._observeHandle.remove(),this._observeHandle=null);this.inherited(arguments)},_addOptionItem:function(){},_removeOptionItem:function(){},_setDisplay:function(){},_getChildren:function(){return[]},
_getSelectedOptionsAttr:function(){return this.getOptions({selected:!0})},_pseudoLoadChildren:function(){},onSetStore:function(){}})})},"dojo/data/util/sorter":function(){define(["../../_base/lang"],function(a){var b={};a.setObject("dojo.data.util.sorter",b);b.basicComparator=function(c,d){var g=-1;null===c&&(c=void 0);null===d&&(d=void 0);if(c==d)g=0;else if(c>d||null==c)g=1;return g};b.createSortFunction=function(c,d){function g(r,y,p,h){return function(m,u){m=h.getValue(m,r);u=h.getValue(u,r);
return y*p(m,u)}}for(var x=[],w,l=d.comparatorMap,n=b.basicComparator,f=0;f<c.length;f++){w=c[f];var e=w.attribute;if(e){w=w.descending?-1:1;var k=n;l&&("string"!==typeof e&&"toString"in e&&(e=e.toString()),k=l[e]||n);x.push(g(e,w,k,d))}}return function(r,y){for(var p=0;p<x.length;){var h=x[p++](r,y);if(0!==h)return h}return 0}};return b})},"dijit/form/_FormValueWidget":function(){define(["dojo/_base/declare","dojo/sniff","./_FormWidget","./_FormValueMixin"],function(a,b,c,d){return a("dijit.form._FormValueWidget",
[c,d],{_layoutHackIE7:function(){if(7==b("ie"))for(var g=this.domNode,x=g.parentNode,w=g.firstChild||g,l=w.style.filter,n=this;x&&0==x.clientHeight;)(function(){var f=n.connect(x,"onscroll",function(){n.disconnect(f);w.style.filter=(new Date).getMilliseconds();n.defer(function(){w.style.filter=l})})})(),x=x.parentNode}})})},"dijit/form/_FormWidget":function(){define("dojo/_base/declare dojo/sniff dojo/_base/kernel dojo/ready ../_Widget ../_CssStateMixin ../_TemplatedMixin ./_FormWidgetMixin".split(" "),
function(a,b,c,d,g,x,w,l){b("dijit-legacy-requires")&&d(0,function(){require(["dijit/form/_FormValueWidget"])});return a("dijit.form._FormWidget",[g,w,x,l],{setDisabled:function(n){c.deprecated("setDisabled("+n+") is deprecated. Use set('disabled',"+n+") instead.","","2.0");this.set("disabled",n)},setValue:function(n){c.deprecated("dijit.form._FormWidget:setValue("+n+") is deprecated.  Use set('value',"+n+") instead.","","2.0");this.set("value",n)},getValue:function(){c.deprecated(this.declaredClass+
"::getValue() is deprecated. Use get('value') instead.","","2.0");return this.get("value")},postMixInProperties:function(){this.nameAttrSetting=this.name?'name\x3d"'+this.name.replace(/"/g,"\x26quot;")+'"':"";this.inherited(arguments)}})})},"dijit/form/_FormWidgetMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/dom-style dojo/_base/lang dojo/mouse dojo/on dojo/sniff dojo/window ../a11y".split(" "),function(a,b,c,d,g,x,w,l,n,f){return b("dijit.form._FormWidgetMixin",
null,{name:"",alt:"",value:"",type:"text","aria-label":"focusNode",tabIndex:"0",_setTabIndexAttr:"focusNode",disabled:!1,intermediateChanges:!1,scrollOnFocus:!0,_setIdAttr:"focusNode",_setDisabledAttr:function(e){this._set("disabled",e);/^(button|input|select|textarea|optgroup|option|fieldset)$/i.test(this.focusNode.tagName)?c.set(this.focusNode,"disabled",e):this.focusNode.setAttribute("aria-disabled",e?"true":"false");this.valueNode&&c.set(this.valueNode,"disabled",e);e?(this._set("hovering",!1),
this._set("active",!1),e="tabIndex"in this.attributeMap?this.attributeMap.tabIndex:"_setTabIndexAttr"in this?this._setTabIndexAttr:"focusNode",a.forEach(g.isArray(e)?e:[e],function(k){k=this[k];l("webkit")||f.hasDefaultTabStop(k)?k.setAttribute("tabIndex","-1"):k.removeAttribute("tabIndex")},this)):""!=this.tabIndex&&this.set("tabIndex",this.tabIndex)},_onFocus:function(e){if("mouse"==e&&this.isFocusable())var k=this.own(w(this.focusNode,"focus",function(){r.remove();k.remove()}))[0],r=this.own(w(this.ownerDocumentBody,
"pointerup",g.hitch(this,function(y){r.remove();k.remove();this.focused&&("touchend"==y.type?this.defer("focus"):this.focus())})))[0];this.scrollOnFocus&&this.defer(function(){n.scrollIntoView(this.domNode)});this.inherited(arguments)},isFocusable:function(){return!this.disabled&&this.focusNode&&"none"!=d.get(this.domNode,"display")},focus:function(){if(!this.disabled&&this.focusNode.focus)try{this.focusNode.focus()}catch(e){}},compare:function(e,k){return"number"==typeof e&&"number"==typeof k?isNaN(e)&&
isNaN(k)?0:e-k:e>k?1:e<k?-1:0},onChange:function(){},_onChangeActive:!1,_handleOnChange:function(e,k){void 0!=this._lastValueReported||null!==k&&this._onChangeActive||(this._resetValue=this._lastValueReported=e);this._pendingOnChange=this._pendingOnChange||typeof e!=typeof this._lastValueReported||0!=this.compare(e,this._lastValueReported);(this.intermediateChanges||k||void 0===k)&&this._pendingOnChange&&(this._lastValueReported=e,this._pendingOnChange=!1,this._onChangeActive&&(this._onChangeHandle&&
this._onChangeHandle.remove(),this._onChangeHandle=this.defer(function(){this._onChangeHandle=null;this.onChange(e)})))},create:function(){this.inherited(arguments);this._onChangeActive=!0},destroy:function(){this._onChangeHandle&&(this._onChangeHandle.remove(),this.onChange(this._lastValueReported));this.inherited(arguments)}})})},"dijit/form/_FormValueMixin":function(){define("dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dojo/sniff ./_FormWidgetMixin".split(" "),function(a,
b,c,d,g,x,w){return a("dijit.form._FormValueMixin",w,{readOnly:!1,_setReadOnlyAttr:function(l){b.set(this.focusNode,"readOnly",l);this._set("readOnly",l)},postCreate:function(){this.inherited(arguments);void 0===this._resetValue&&(this._lastValueReported=this._resetValue=this.value)},_setValueAttr:function(l,n){this._handleOnChange(l,n)},_handleOnChange:function(l,n){this._set("value",l);this.inherited(arguments)},undo:function(){this._setValueAttr(this._lastValueReported,!1)},reset:function(){this._hasBeenBlurred=
!1;this._setValueAttr(this._resetValue,!0)}})})},"dijit/_HasDropDown":function(){define("dojo/_base/declare dojo/_base/Deferred dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/has dojo/keys dojo/_base/lang dojo/on dojo/touch ./registry ./focus ./popup ./_FocusMixin".split(" "),function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h){return a("dijit._HasDropDown",h,{_buttonNode:null,_arrowWrapperNode:null,_popupStateNode:null,_aroundNode:null,dropDown:null,autoWidth:!0,forceWidth:!1,maxHeight:-1,
dropDownPosition:["below","above"],_stopClickEvents:!0,_onDropDownMouseDown:function(m){this.disabled||this.readOnly||("MSPointerDown"!=m.type&&m.preventDefault(),this.own(e.once(this.ownerDocument,k.release,f.hitch(this,"_onDropDownMouseUp"))),this.toggleDropDown())},_onDropDownMouseUp:function(m){var u=this.dropDown,t=!1;if(m&&this._opened){var q=x.position(this._buttonNode,!0);if(!(m.pageX>=q.x&&m.pageX<=q.x+q.w&&m.pageY>=q.y&&m.pageY<=q.y+q.h)){for(q=m.target;q&&!t;)g.contains(q,"dijitPopup")?
t=!0:q=q.parentNode;if(t){q=m.target;if(u.onItemClick){for(var z;q&&!(z=r.byNode(q));)q=q.parentNode;if(z&&z.onClick&&z.getParent)z.getParent().onItemClick(z,m)}return}}}this._opened?u.focus&&(!1!==u.autoFocus||"mouseup"==m.type&&!this.hovering)&&(this._focusDropDownTimer=this.defer(function(){u.focus();delete this._focusDropDownTimer})):this.focus&&this.defer("focus")},_onDropDownClick:function(m){this._stopClickEvents&&(m.stopPropagation(),m.preventDefault())},buildRendering:function(){this.inherited(arguments);
this._buttonNode=this._buttonNode||this.focusNode||this.domNode;this._popupStateNode=this._popupStateNode||this.focusNode||this._buttonNode;var m={after:this.isLeftToRight()?"Right":"Left",before:this.isLeftToRight()?"Left":"Right",above:"Up",below:"Down",left:"Left",right:"Right"}[this.dropDownPosition[0]]||this.dropDownPosition[0]||"Down";g.add(this._arrowWrapperNode||this._buttonNode,"dijit"+m+"ArrowButton")},postCreate:function(){this.inherited(arguments);var m=this.focusNode||this.domNode;this.own(e(this._buttonNode,
k.press,f.hitch(this,"_onDropDownMouseDown")),e(this._buttonNode,"click",f.hitch(this,"_onDropDownClick")),e(m,"keydown",f.hitch(this,"_onKey")),e(m,"keyup",f.hitch(this,"_onKeyUp")))},destroy:function(){this._opened&&this.closeDropDown(!0);this.dropDown&&(this.dropDown._destroyed||this.dropDown.destroyRecursive(),delete this.dropDown);this.inherited(arguments)},_onKey:function(m){if(!this.disabled&&!this.readOnly){var u=this.dropDown,t=m.target;u&&this._opened&&u.handleKey&&!1===u.handleKey(m)?(m.stopPropagation(),
m.preventDefault()):u&&this._opened&&m.keyCode==n.ESCAPE?(this.closeDropDown(),m.stopPropagation(),m.preventDefault()):!this._opened&&(m.keyCode==n.DOWN_ARROW||(m.keyCode==n.ENTER||m.keyCode==n.SPACE&&(!this._searchTimer||m.ctrlKey||m.altKey||m.metaKey))&&("input"!==(t.tagName||"").toLowerCase()||t.type&&"text"!==t.type.toLowerCase()))&&(this._toggleOnKeyUp=!0,m.stopPropagation(),m.preventDefault())}},_onKeyUp:function(){if(this._toggleOnKeyUp){delete this._toggleOnKeyUp;this.toggleDropDown();var m=
this.dropDown;m&&m.focus&&this.defer(f.hitch(m,"focus"),1)}},_onBlur:function(){this.closeDropDown(!1);this.inherited(arguments)},isLoaded:function(){return!0},loadDropDown:function(m){m()},loadAndOpenDropDown:function(){var m=new b,u=f.hitch(this,function(){this.openDropDown();m.resolve(this.dropDown)});this.isLoaded()?u():this.loadDropDown(u);return m},toggleDropDown:function(){this.disabled||this.readOnly||(this._opened?this.closeDropDown(!0):this.loadAndOpenDropDown())},openDropDown:function(){var m=
this.dropDown,u=m.domNode,t=this._aroundNode||this.domNode,q=this,z=p.open({parent:this,popup:m,around:t,orient:this.dropDownPosition,maxHeight:this.maxHeight,onExecute:function(){q.closeDropDown(!0)},onCancel:function(){q.closeDropDown(!0)},onClose:function(){d.set(q._popupStateNode,"popupActive",!1);g.remove(q._popupStateNode,"dijitHasDropDownOpen");q._set("_opened",!1)}});if(this.forceWidth||this.autoWidth&&t.offsetWidth>m._popupWrapper.offsetWidth){t=t.offsetWidth-m._popupWrapper.offsetWidth;
var v={w:m.domNode.offsetWidth+t};this._origStyle=u.style.cssText;f.isFunction(m.resize)?m.resize(v):x.setMarginBox(u,v);"R"==z.corner[1]&&(m._popupWrapper.style.left=m._popupWrapper.style.left.replace("px","")-t+"px")}d.set(this._popupStateNode,"popupActive","true");g.add(this._popupStateNode,"dijitHasDropDownOpen");this._set("_opened",!0);this._popupStateNode.setAttribute("aria-expanded","true");this._popupStateNode.setAttribute("aria-owns",m.id);"presentation"===u.getAttribute("role")||u.getAttribute("aria-labelledby")||
u.setAttribute("aria-labelledby",this.id);return z},closeDropDown:function(m){this._focusDropDownTimer&&(this._focusDropDownTimer.remove(),delete this._focusDropDownTimer);this._opened&&(this._popupStateNode.setAttribute("aria-expanded","false"),m&&this.focus&&this.focus(),p.close(this.dropDown),this._opened=!1);this._origStyle&&(this.dropDown.domNode.style.cssText=this._origStyle,delete this._origStyle)}})})},"dijit/MenuSeparator":function(){define("dojo/_base/declare dojo/dom ./_WidgetBase ./_TemplatedMixin ./_Contained dojo/text!./templates/MenuSeparator.html".split(" "),
function(a,b,c,d,g,x){return a("dijit.MenuSeparator",[c,d,g],{templateString:x,buildRendering:function(){this.inherited(arguments);b.setSelectable(this.domNode,!1)},isFocusable:function(){return!1}})})},"dijit/Tooltip":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/fx dojo/dom dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/lang dojo/mouse dojo/on dojo/sniff ./_base/manager ./place ./_Widget ./_TemplatedMixin ./BackgroundIframe dojo/text!./templates/Tooltip.html ./main".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u){function t(){}var q=b("dijit._MasterTooltip",[y,p],{duration:k.defaultDuration,templateString:m,postCreate:function(){this.ownerDocumentBody.appendChild(this.domNode);this.bgIframe=new h(this.domNode);this.fadeIn=c.fadeIn({node:this.domNode,duration:this.duration,onEnd:l.hitch(this,"_onShow")});this.fadeOut=c.fadeOut({node:this.domNode,duration:this.duration,onEnd:l.hitch(this,"_onHide")})},show:function(v,B,A,E,C,D,F){if(!this.aroundNode||this.aroundNode!==
B||this.containerNode.innerHTML!=v)if("playing"==this.fadeOut.status())this._onDeck=arguments;else{this.containerNode.innerHTML=v;C&&this.set("textDir",C);this.containerNode.align=E?"right":"left";var G=r.around(this.domNode,B,A&&A.length?A:z.defaultPosition,!E,l.hitch(this,"orient")),J=G.aroundNodePos;"M"==G.corner.charAt(0)&&"M"==G.aroundCorner.charAt(0)?(this.connectorNode.style.top=J.y+(J.h-this.connectorNode.offsetHeight>>1)-G.y+"px",this.connectorNode.style.left=""):"M"==G.corner.charAt(1)&&
"M"==G.aroundCorner.charAt(1)?this.connectorNode.style.left=J.x+(J.w-this.connectorNode.offsetWidth>>1)-G.x+"px":(this.connectorNode.style.left="",this.connectorNode.style.top="");w.set(this.domNode,"opacity",0);this.fadeIn.play();this.isShowingNow=!0;this.aroundNode=B;this.onMouseEnter=D||t;this.onMouseLeave=F||t}},orient:function(v,B,A,E,C){this.connectorNode.style.top="";var D=E.h;E=E.w;v.className="dijitTooltip "+{"MR-ML":"dijitTooltipRight","ML-MR":"dijitTooltipLeft","TM-BM":"dijitTooltipAbove",
"BM-TM":"dijitTooltipBelow","BL-TL":"dijitTooltipBelow dijitTooltipABLeft","TL-BL":"dijitTooltipAbove dijitTooltipABLeft","BR-TR":"dijitTooltipBelow dijitTooltipABRight","TR-BR":"dijitTooltipAbove dijitTooltipABRight","BR-BL":"dijitTooltipRight","BL-BR":"dijitTooltipLeft"}[B+"-"+A];this.domNode.style.width="auto";var F=x.position(this.domNode);e("ie")&&(F.w+=2);x.setMarginBox(this.domNode,{w:Math.min(Math.max(E,1),F.w)});"B"==A.charAt(0)&&"B"==B.charAt(0)?(v=x.position(v),B=this.connectorNode.offsetHeight,
v.h>D?(this.connectorNode.style.top=D-(C.h+B>>1)+"px",this.connectorNode.style.bottom=""):(this.connectorNode.style.bottom=Math.min(Math.max(C.h/2-B/2,0),v.h-B)+"px",this.connectorNode.style.top="")):(this.connectorNode.style.top="",this.connectorNode.style.bottom="");return Math.max(0,F.w-E)},_onShow:function(){e("ie")&&(this.domNode.style.filter="")},hide:function(v){this._onDeck&&this._onDeck[1]==v?this._onDeck=null:this.aroundNode===v&&(this.fadeIn.stop(),this.isShowingNow=!1,this.aroundNode=
null,this.fadeOut.play());this.onMouseEnter=this.onMouseLeave=t},_onHide:function(){this.domNode.style.cssText="";this.containerNode.innerHTML="";this._onDeck&&(this.show.apply(this,this._onDeck),this._onDeck=null)}});e("dojo-bidi")&&q.extend({_setAutoTextDir:function(v){this.applyTextDir(v);a.forEach(v.children,function(B){this._setAutoTextDir(B)},this)},_setTextDirAttr:function(v){this._set("textDir",v);"auto"==v?this._setAutoTextDir(this.containerNode):this.containerNode.dir=this.textDir}});u.showTooltip=
function(v,B,A,E,C,D,F){A&&(A=a.map(A,function(G){return{after:"after-centered",before:"before-centered"}[G]||G}));z._masterTT||(u._masterTT=z._masterTT=new q);return z._masterTT.show(v,B,A,E,C,D,F)};u.hideTooltip=function(v){return z._masterTT&&z._masterTT.hide(v)};var z=b("dijit.Tooltip",y,{label:"",showDelay:400,hideDelay:400,connectId:[],position:[],selector:"",_setConnectIdAttr:function(v){a.forEach(this._connections||[],function(B){a.forEach(B,function(A){A.remove()})},this);this._connectIds=
a.filter(l.isArrayLike(v)?v:v?[v]:[],function(B){return d.byId(B,this.ownerDocument)},this);this._connections=a.map(this._connectIds,function(B){B=d.byId(B,this.ownerDocument);var A=this.selector,E=A?function(D){return f.selector(A,D)}:function(D){return D},C=this;return[f(B,E(n.enter),function(){C._onHover(this)}),f(B,E("focusin"),function(){C._onHover(this)}),f(B,E(n.leave),l.hitch(C,"_onUnHover")),f(B,E("focusout"),l.hitch(C,"set","state","DORMANT"))]},this);this._set("connectId",v)},addTarget:function(v){v=
v.id||v;-1==a.indexOf(this._connectIds,v)&&this.set("connectId",this._connectIds.concat(v))},removeTarget:function(v){v=a.indexOf(this._connectIds,v.id||v);0<=v&&(this._connectIds.splice(v,1),this.set("connectId",this._connectIds))},buildRendering:function(){this.inherited(arguments);g.add(this.domNode,"dijitTooltipData")},startup:function(){this.inherited(arguments);var v=this.connectId;a.forEach(l.isArrayLike(v)?v:[v],this.addTarget,this)},getContent:function(v){return this.label||this.domNode.innerHTML},
state:"DORMANT",_setStateAttr:function(v){if(!(this.state==v||"SHOW TIMER"==v&&"SHOWING"==this.state||"HIDE TIMER"==v&&"DORMANT"==this.state)){this._hideTimer&&(this._hideTimer.remove(),delete this._hideTimer);this._showTimer&&(this._showTimer.remove(),delete this._showTimer);switch(v){case "DORMANT":this._connectNode&&(z.hide(this._connectNode),delete this._connectNode,this.onHide());break;case "SHOW TIMER":"SHOWING"!=this.state&&(this._showTimer=this.defer(function(){this.set("state","SHOWING")},
this.showDelay));break;case "SHOWING":var B=this.getContent(this._connectNode);if(!B){this.set("state","DORMANT");return}z.show(B,this._connectNode,this.position,!this.isLeftToRight(),this.textDir,l.hitch(this,"set","state","SHOWING"),l.hitch(this,"set","state","HIDE TIMER"));this.onShow(this._connectNode,this.position);break;case "HIDE TIMER":this._hideTimer=this.defer(function(){this.set("state","DORMANT")},this.hideDelay)}this._set("state",v)}},_onHover:function(v){this._connectNode&&v!=this._connectNode&&
this.set("state","DORMANT");this._connectNode=v;this.set("state","SHOW TIMER")},_onUnHover:function(v){this.set("state","HIDE TIMER")},open:function(v){this.set("state","DORMANT");this._connectNode=v;this.set("state","SHOWING")},close:function(){this.set("state","DORMANT")},onShow:function(){},onHide:function(){},destroy:function(){this.set("state","DORMANT");a.forEach(this._connections||[],function(v){a.forEach(v,function(B){B.remove()})},this);this.inherited(arguments)}});z._MasterTooltip=q;z.show=
u.showTooltip;z.hide=u.hideTooltip;z.defaultPosition=["after-centered","before-centered"];return z})},"dijit/form/NumberSpinner":function(){define(["dojo/_base/declare","dojo/keys","./_Spinner","./NumberTextBox"],function(a,b,c,d){return a("dijit.form.NumberSpinner",[c,d.Mixin],{baseClass:"dijitTextBox dijitSpinner dijitNumberTextBox",adjust:function(g,x){var w=this.constraints,l=isNaN(g),n=!isNaN(w.max),f=!isNaN(w.min);l&&0!=x&&(g=0<x?f?w.min:n?w.max:0:n?this.constraints.max:f?w.min:0);x=g+x;if(l||
isNaN(x))return g;n&&x>w.max&&(x=w.max);f&&x<w.min&&(x=w.min);return x},_onKeyDown:function(g){if(!(this.disabled||this.readOnly||g.keyCode!=b.HOME&&g.keyCode!=b.END||g.ctrlKey||g.altKey||g.metaKey||"undefined"==typeof this.get("value"))){var x=this.constraints[g.keyCode==b.HOME?"min":"max"];"number"==typeof x&&this._setValueAttr(x,!1);g.stopPropagation();g.preventDefault()}}})})},"dijit/form/_Spinner":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/sniff dojo/mouse dojo/on ../typematic ./RangeBoundTextBox dojo/text!./templates/Spinner.html ./_TextBoxMixin".split(" "),
function(a,b,c,d,g,x,w,l,n,f){return a("dijit.form._Spinner",l,{defaultTimeout:500,minimumTimeout:10,timeoutChangeRate:.9,smallDelta:1,largeDelta:10,templateString:n,baseClass:"dijitTextBox dijitSpinner",cssStateNodes:{upArrowNode:"dijitUpArrowButton",downArrowNode:"dijitDownArrowButton"},adjust:function(e){return e},_arrowPressed:function(e,k,r){this.disabled||this.readOnly||(this._setValueAttr(this.adjust(this.get("value"),k*r),!1),f.selectInputText(this.textbox,this.textbox.value.length))},_arrowReleased:function(){this._wheelTimer=
null},_typematicCallback:function(e,k,r){var y=this.smallDelta;k==this.textbox&&(k=r.keyCode,y=k==b.PAGE_UP||k==b.PAGE_DOWN?this.largeDelta:this.smallDelta,k=k==b.UP_ARROW||k==b.PAGE_UP?this.upArrowNode:this.downArrowNode);-1==e?this._arrowReleased(k):this._arrowPressed(k,k==this.upArrowNode?1:-1,y)},_wheelTimer:null,_mouseWheeled:function(e){if(this.focused){e.stopPropagation();e.preventDefault();var k=e.wheelDelta/120;Math.floor(k)!=k&&(k=0<e.wheelDelta?1:-1);e=e.detail?-1*e.detail:k;if(0!==e){var r=
this[0<e?"upArrowNode":"downArrowNode"];this._arrowPressed(r,e,this.smallDelta);this._wheelTimer&&this._wheelTimer.remove();this._wheelTimer=this.defer(function(){this._arrowReleased(r)},50)}}},_setConstraintsAttr:function(e){this.inherited(arguments);this.focusNode&&(void 0!==this.constraints.min?this.focusNode.setAttribute("aria-valuemin",this.constraints.min):this.focusNode.removeAttribute("aria-valuemin"),void 0!==this.constraints.max?this.focusNode.setAttribute("aria-valuemax",this.constraints.max):
this.focusNode.removeAttribute("aria-valuemax"))},_setValueAttr:function(e,k){this.focusNode.setAttribute("aria-valuenow",e);this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this.own(x(this.domNode,g.wheel,c.hitch(this,"_mouseWheeled")),w.addListener(this.upArrowNode,this.textbox,{keyCode:b.UP_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),w.addListener(this.downArrowNode,this.textbox,
{keyCode:b.DOWN_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),w.addListener(this.upArrowNode,this.textbox,{keyCode:b.PAGE_UP,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),w.addListener(this.downArrowNode,this.textbox,{keyCode:b.PAGE_DOWN,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,
this.defaultTimeout,this.minimumTimeout))}})})},"dijit/typematic":function(){define("dojo/_base/array dojo/_base/connect dojo/_base/lang dojo/on dojo/sniff ./main".split(" "),function(a,b,c,d,g,x){var w=x.typematic={_fireEventAndReload:function(){this._timer=null;this._callback(++this._count,this._node,this._evt);this._currentTimeout=Math.max(0>this._currentTimeout?this._initialDelay:1<this._subsequentDelay?this._subsequentDelay:Math.round(this._currentTimeout*this._subsequentDelay),this._minDelay);
this._timer=setTimeout(c.hitch(this,"_fireEventAndReload"),this._currentTimeout)},trigger:function(l,n,f,e,k,r,y,p){if(k!=this._obj){this.stop();this._initialDelay=y||500;this._subsequentDelay=r||.9;this._minDelay=p||10;this._obj=k;this._node=f;this._count=this._currentTimeout=-1;this._callback=c.hitch(n,e);this._evt={faux:!0};for(var h in l)"layerX"!=h&&"layerY"!=h&&(n=l[h],"function"!=typeof n&&"undefined"!=typeof n&&(this._evt[h]=n));this._fireEventAndReload()}},stop:function(){this._timer&&(clearTimeout(this._timer),
this._timer=null);this._obj&&(this._callback(-1,this._node,this._evt),this._obj=null)},addKeyListener:function(l,n,f,e,k,r,y){var p="keyCode"in n?"keyCode":"charCode"in n?"charCode":"charOrCode",h=[d(l,"keyCode"in n?"keydown":"charCode"in n?"keypress":b._keypress,c.hitch(this,function(m){m[p]!=n[p]||void 0!==n.ctrlKey&&n.ctrlKey!=m.ctrlKey||void 0!==n.altKey&&n.altKey!=m.altKey||void 0!==n.metaKey&&n.metaKey!=(m.metaKey||!1)||void 0!==n.shiftKey&&n.shiftKey!=m.shiftKey?w._obj==n&&w.stop():(m.stopPropagation(),
m.preventDefault(),w.trigger(m,f,l,e,n,k,r,y))})),d(l,"keyup",c.hitch(this,function(){w._obj==n&&w.stop()}))];return{remove:function(){a.forEach(h,function(m){m.remove()})}}},addMouseListener:function(l,n,f,e,k,r){var y=[d(l,"mousedown",c.hitch(this,function(p){p.preventDefault();w.trigger(p,n,l,f,l,e,k,r)})),d(l,"mouseup",c.hitch(this,function(p){this._obj&&p.preventDefault();w.stop()})),d(l,"mouseout",c.hitch(this,function(p){this._obj&&p.preventDefault();w.stop()})),d(l,"dblclick",c.hitch(this,
function(p){p.preventDefault();9>g("ie")&&(w.trigger(p,n,l,f,l,e,k,r),setTimeout(c.hitch(this,w.stop),50))}))];return{remove:function(){a.forEach(y,function(p){p.remove()})}}},addListener:function(l,n,f,e,k,r,y,p){var h=[this.addKeyListener(n,f,e,k,r,y,p),this.addMouseListener(l,e,k,r,y,p)];return{remove:function(){a.forEach(h,function(m){m.remove()})}}}};return w})},"dijit/form/RangeBoundTextBox":function(){define(["dojo/_base/declare","dojo/i18n","./MappedTextBox","dojo/i18n!./nls/validate"],function(a,
b,c){return a("dijit.form.RangeBoundTextBox",c,{rangeMessage:"",rangeCheck:function(d,g){return("min"in g?0<=this.compare(d,g.min):!0)&&("max"in g?0>=this.compare(d,g.max):!0)},isInRange:function(){return this.rangeCheck(this.get("value"),this.constraints)},_isDefinitelyOutOfRange:function(){var d=this.get("value");if(null==d)return!1;var g=!1;"min"in this.constraints&&(g=this.constraints.min,g=0>this.compare(d,"number"==typeof g&&0<=g&&0!=d?0:g));!g&&"max"in this.constraints&&(g=this.constraints.max,
g=0<this.compare(d,"number"!=typeof g||0<g?g:0));return g},_isValidSubset:function(){return this.inherited(arguments)&&!this._isDefinitelyOutOfRange()},isValid:function(d){return this.inherited(arguments)&&(this._isEmpty(this.textbox.value)&&!this.required||this.isInRange(d))},getErrorMessage:function(d){var g=this.get("value");return null==g||""===g||"number"==typeof g&&isNaN(g)||this.isInRange(d)?this.inherited(arguments):this.rangeMessage},postMixInProperties:function(){this.inherited(arguments);
this.rangeMessage||(this.messages=b.getLocalization("dijit.form","validate",this.lang),this.rangeMessage=this.messages.rangeMessage)}})})},"dijit/form/MappedTextBox":function(){define(["dojo/_base/declare","dojo/sniff","dojo/dom-construct","./ValidationTextBox"],function(a,b,c,d){return a("dijit.form.MappedTextBox",d,{postMixInProperties:function(){this.inherited(arguments);this.nameAttrSetting=""},_setNameAttr:"valueNode",serialize:function(g){return g.toString?g.toString():""},toString:function(){var g=
this.filter(this.get("value"));return null!=g?"string"==typeof g?g:this.serialize(g,this.constraints):""},validate:function(){this.valueNode.value=this.toString();return this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);this.valueNode=c.place("\x3cinput type\x3d'hidden'"+(this.name?' name\x3d"'+this.name.replace(/"/g,"\x26quot;")+'"':"")+"/\x3e",this.textbox,"after")},reset:function(){this.valueNode.value="";this.inherited(arguments)}})})},"dijit/form/ValidationTextBox":function(){define("dojo/_base/declare dojo/_base/kernel dojo/_base/lang dojo/i18n ./TextBox ../Tooltip dojo/text!./templates/ValidationTextBox.html dojo/i18n!./nls/validate".split(" "),
function(a,b,c,d,g,x,w){var l=a("dijit.form.ValidationTextBox",g,{templateString:w,required:!1,promptMessage:"",invalidMessage:"$_unset_$",missingMessage:"$_unset_$",message:"",constraints:{},pattern:".*",regExp:"",regExpGen:function(){},state:"",tooltipPosition:[],_deprecateRegExp:function(n,f){f!=l.prototype[n]&&(b.deprecated("ValidationTextBox id\x3d"+this.id+", set('"+n+"', ...) is deprecated.  Use set('pattern', ...) instead.","","2.0"),this.set("pattern",f))},_setRegExpGenAttr:function(n){this._deprecateRegExp("regExpGen",
n);this._set("regExpGen",this._computeRegexp)},_setRegExpAttr:function(n){this._deprecateRegExp("regExp",n)},_setValueAttr:function(){this.inherited(arguments);this._refreshState()},validator:function(n,f){return(new RegExp("^(?:"+this._computeRegexp(f)+")"+(this.required?"":"?")+"$")).test(n)&&(!this.required||!this._isEmpty(n))&&(this._isEmpty(n)||void 0!==this.parse(n,f))},_isValidSubset:function(){return 0==this.textbox.value.search(this._partialre)},isValid:function(){return this.validator(this.textbox.value,
this.get("constraints"))},_isEmpty:function(n){return(this.trim?/^\s*$/:/^$/).test(n)},getErrorMessage:function(){var n="$_unset_$"==this.invalidMessage?this.messages.invalidMessage:this.invalidMessage?this.invalidMessage:this.promptMessage,f="$_unset_$"==this.missingMessage?this.messages.missingMessage:this.missingMessage?this.missingMessage:n;return this.required&&this._isEmpty(this.textbox.value)?f:n},getPromptMessage:function(){return this.promptMessage},_maskValidSubsetError:!0,validate:function(n){var f=
"",e=this.disabled||this.isValid(n);e&&(this._maskValidSubsetError=!0);var k=this._isEmpty(this.textbox.value),r=!e&&n&&this._isValidSubset();this._set("state",e?"":((!this._hasBeenBlurred||n)&&k||r)&&(this._maskValidSubsetError||r&&!this._hasBeenBlurred&&n)?"Incomplete":"Error");this.focusNode.setAttribute("aria-invalid","Error"==this.state?"true":"false");"Error"==this.state?(this._maskValidSubsetError=n&&r,f=this.getErrorMessage(n)):"Incomplete"==this.state?(f=this.getPromptMessage(n),this._maskValidSubsetError=
!this._hasBeenBlurred||n):k&&(f=this.getPromptMessage(n));this.set("message",f);return e},displayMessage:function(n){n&&this.focused?x.show(n,this.domNode,this.tooltipPosition,!this.isLeftToRight()):x.hide(this.domNode)},_refreshState:function(){this._created&&this.validate(this.focused);this.inherited(arguments)},constructor:function(n){this.constraints=c.clone(this.constraints);this.baseClass+=" dijitValidationTextBox"},startup:function(){this.inherited(arguments);this._refreshState()},_setConstraintsAttr:function(n){!n.locale&&
this.lang&&(n.locale=this.lang);this._set("constraints",n);this._refreshState()},_setPatternAttr:function(n){this._set("pattern",n);this._refreshState()},_computeRegexp:function(n){var f=this.pattern;"function"==typeof f&&(f=f.call(this,n));if(f!=this._lastRegExp){var e="";this._lastRegExp=f;".*"!=f&&f.replace(/\\.|\[\]|\[.*?[^\\]{1}\]|\{.*?\}|\(\?[=:!]|./g,function(k){switch(k.charAt(0)){case "{":case "+":case "?":case "*":case "^":case "$":case "|":case "(":e+=k;break;case ")":e+="|$)";break;default:e+=
"(?:"+k+"|$)"}});try{"".search(e)}catch(k){e=this.pattern,console.warn("RegExp error in "+this.declaredClass+": "+this.pattern)}this._partialre="^(?:"+e+")$"}return f},postMixInProperties:function(){this.inherited(arguments);this.messages=d.getLocalization("dijit.form","validate",this.lang);this._setConstraintsAttr(this.constraints)},_setDisabledAttr:function(n){this.inherited(arguments);this._refreshState()},_setRequiredAttr:function(n){this._set("required",n);this.focusNode.setAttribute("aria-required",
n);this._refreshState()},_setMessageAttr:function(n){this._set("message",n);this.displayMessage(n)},reset:function(){this._maskValidSubsetError=!0;this.inherited(arguments)},_onBlur:function(){this.displayMessage("");this.inherited(arguments)},destroy:function(){x.hide(this.domNode);this.inherited(arguments)}});return l})},"dijit/form/TextBox":function(){define("dojo/_base/declare dojo/dom-construct dojo/dom-style dojo/_base/kernel dojo/_base/lang dojo/on dojo/sniff ./_FormValueWidget ./_TextBoxMixin dojo/text!./templates/TextBox.html ../main".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e){l=a("dijit.form.TextBox"+(w("dojo-bidi")?"_NoBidi":""),[l,n],{templateString:f,_singleNodeTemplate:'\x3cinput class\x3d"dijit dijitReset dijitLeft dijitInputField" data-dojo-attach-point\x3d"textbox,focusNode" autocomplete\x3d"off" type\x3d"${type}" ${!nameAttrSetting} /\x3e',_buttonInputDisabled:w("ie")?"disabled":"",baseClass:"dijitTextBox",postMixInProperties:function(){var k=this.type.toLowerCase();if(this.templateString&&"input"==this.templateString.toLowerCase()||
("hidden"==k||"file"==k)&&this.templateString==this.constructor.prototype.templateString)this.templateString=this._singleNodeTemplate;this.inherited(arguments)},postCreate:function(){this.inherited(arguments);9>w("ie")&&this.defer(function(){try{var k=c.getComputedStyle(this.domNode);if(k){var r=k.fontFamily;if(r){var y=this.domNode.getElementsByTagName("INPUT");if(y)for(k=0;k<y.length;k++)y[k].style.fontFamily=r}}}catch(p){}})},_setPlaceHolderAttr:function(k){this._set("placeHolder",k);this._phspan||
(this._attachPoints.push("_phspan"),this._phspan=b.create("span",{className:"dijitPlaceHolder dijitInputField"},this.textbox,"after"),this.own(x(this._phspan,"mousedown",function(r){r.preventDefault()}),x(this._phspan,"touchend, pointerup, MSPointerUp",g.hitch(this,function(){this.focus()}))));this._phspan.innerHTML="";this._phspan.appendChild(this._phspan.ownerDocument.createTextNode(k));this._updatePlaceHolder()},_onInput:function(k){this.inherited(arguments);this._updatePlaceHolder()},_updatePlaceHolder:function(){this._phspan&&
(this._phspan.style.display=this.placeHolder&&!this.textbox.value?"":"none")},_setValueAttr:function(k,r,y){this.inherited(arguments);this._updatePlaceHolder()},getDisplayedValue:function(){d.deprecated(this.declaredClass+"::getDisplayedValue() is deprecated. Use get('displayedValue') instead.","","2.0");return this.get("displayedValue")},setDisplayedValue:function(k){d.deprecated(this.declaredClass+"::setDisplayedValue() is deprecated. Use set('displayedValue', ...) instead.","","2.0");this.set("displayedValue",
k)},_onBlur:function(k){this.disabled||(this.inherited(arguments),this._updatePlaceHolder(),this.selectOnClick&&(this.textbox.selectionStart=this.textbox.selectionEnd=void 0))},_onFocus:function(k){this.disabled||this.readOnly||(this.inherited(arguments),this._updatePlaceHolder())}});9>w("ie")&&(l.prototype._isTextSelected=function(){var k=this.ownerDocument.selection.createRange();return k.parentElement()==this.textbox&&0<k.text.length},e._setSelectionRange=n._setSelectionRange=function(k,r,y){k.createTextRange&&
(k=k.createTextRange(),k.collapse(!0),k.moveStart("character",-99999),k.moveStart("character",r),k.moveEnd("character",y-r),k.select())});w("dojo-bidi")&&(l=a("dijit.form.TextBox",l,{_setPlaceHolderAttr:function(k){this.inherited(arguments);this.applyTextDir(this._phspan)}}));return l})},"dijit/form/_TextBoxMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/sniff dojo/keys dojo/_base/lang dojo/on ../main".split(" "),function(a,b,c,d,g,x,w,l){var n=b("dijit.form._TextBoxMixin"+
(d("dojo-bidi")?"_NoBidi":""),null,{trim:!1,uppercase:!1,lowercase:!1,propercase:!1,maxLength:"",selectOnClick:!1,placeHolder:"",_getValueAttr:function(){return this.parse(this.get("displayedValue"),this.constraints)},_setValueAttr:function(f,e,k){if(void 0!==f){var r=this.filter(f);"string"!=typeof k&&(k=null===r||"number"==typeof r&&isNaN(r)?"":this.filter(this.format(r,this.constraints)),0!=this.compare(r,this.filter(this.parse(k,this.constraints)))&&(k=null))}null==k||"number"==typeof k&&isNaN(k)||
this.textbox.value==k||(this.textbox.value=k,this._set("displayedValue",this.get("displayedValue")));this.inherited(arguments,[r,e])},displayedValue:"",_getDisplayedValueAttr:function(){return this.filter(this.textbox.value)},_setDisplayedValueAttr:function(f){null==f?f="":"string"!=typeof f&&(f=String(f));this.textbox.value=f;this._setValueAttr(this.get("value"),void 0);this._set("displayedValue",this.get("displayedValue"))},format:function(f){return null==f?"":f.toString?f.toString():f},parse:function(f){return f},
_refreshState:function(){},onInput:function(){},_onInput:function(f){this._lastInputEventValue=this.textbox.value;this._processInput(this._lastInputProducingEvent||f);delete this._lastInputProducingEvent;this.intermediateChanges&&this._handleOnChange(this.get("value"),!1)},_processInput:function(){this._refreshState();this._set("displayedValue",this.get("displayedValue"))},postCreate:function(){this.textbox.setAttribute("value",this.textbox.value);this.inherited(arguments);this.own(w(this.textbox,
"keydown, keypress, paste, cut, compositionend",x.hitch(this,function(f){if("keydown"==f.type&&229!=f.keyCode){var e=f.keyCode;switch(e){case g.SHIFT:case g.ALT:case g.CTRL:case g.META:case g.CAPS_LOCK:case g.NUM_LOCK:case g.SCROLL_LOCK:return}if(!f.ctrlKey&&!f.metaKey&&!f.altKey){switch(e){case g.NUMPAD_0:case g.NUMPAD_1:case g.NUMPAD_2:case g.NUMPAD_3:case g.NUMPAD_4:case g.NUMPAD_5:case g.NUMPAD_6:case g.NUMPAD_7:case g.NUMPAD_8:case g.NUMPAD_9:case g.NUMPAD_MULTIPLY:case g.NUMPAD_PLUS:case g.NUMPAD_ENTER:case g.NUMPAD_MINUS:case g.NUMPAD_PERIOD:case g.NUMPAD_DIVIDE:return}if(65<=
e&&90>=e||48<=e&&57>=e||e==g.SPACE)return;e=!1;for(var k in g)if(g[k]===f.keyCode){e=!0;break}if(!e)return}}(e=32<=f.charCode?String.fromCharCode(f.charCode):f.charCode)||(e=65<=f.keyCode&&90>=f.keyCode||48<=f.keyCode&&57>=f.keyCode||f.keyCode==g.SPACE?String.fromCharCode(f.keyCode):f.keyCode);e||(e=229);if("keypress"==f.type){if("string"!=typeof e)return;if("a"<=e&&"z">=e||"A"<=e&&"Z">=e||"0"<=e&&"9">=e||" "===e)if(f.ctrlKey||f.metaKey||f.altKey)return}var r={faux:!0},y;for(y in f)/^(layer[XY]|returnValue|keyLocation)$/.test(y)||
(k=f[y],"function"!=typeof k&&"undefined"!=typeof k&&(r[y]=k));x.mixin(r,{charOrCode:e,_wasConsumed:!1,preventDefault:function(){r._wasConsumed=!0;f.preventDefault()},stopPropagation:function(){f.stopPropagation()}});this._lastInputProducingEvent=r;!1===this.onInput(r)&&(r.preventDefault(),r.stopPropagation());if(!r._wasConsumed&&9>=d("ie"))switch(f.keyCode){case g.TAB:case g.ESCAPE:case g.DOWN_ARROW:case g.UP_ARROW:case g.LEFT_ARROW:case g.RIGHT_ARROW:break;default:f.keyCode==g.ENTER&&"textarea"!=
this.textbox.tagName.toLowerCase()||this.defer(function(){this.textbox.value!==this._lastInputEventValue&&w.emit(this.textbox,"input",{bubbles:!0})})}})),w(this.textbox,"input",x.hitch(this,"_onInput")),w(this.domNode,"keypress",function(f){f.stopPropagation()}))},_blankValue:"",filter:function(f){if(null===f)return this._blankValue;if("string"!=typeof f)return f;this.trim&&(f=x.trim(f));this.uppercase&&(f=f.toUpperCase());this.lowercase&&(f=f.toLowerCase());this.propercase&&(f=f.replace(/[^\s]+/g,
function(e){return e.substring(0,1).toUpperCase()+e.substring(1)}));return f},_setBlurValue:function(){this._setValueAttr(this.get("value"),!0)},_onBlur:function(f){this.disabled||(this._setBlurValue(),this.inherited(arguments))},_isTextSelected:function(){return this.textbox.selectionStart!=this.textbox.selectionEnd},_onFocus:function(f){this.disabled||this.readOnly||(this.selectOnClick&&"mouse"==f&&(this._selectOnClickHandle=w.once(this.domNode,"mouseup, touchend",x.hitch(this,function(e){this._isTextSelected()||
n.selectInputText(this.textbox)})),this.own(this._selectOnClickHandle),this.defer(function(){this._selectOnClickHandle&&(this._selectOnClickHandle.remove(),this._selectOnClickHandle=null)},500)),this.inherited(arguments),this._refreshState())},reset:function(){this.textbox.value="";this.inherited(arguments)}});d("dojo-bidi")&&(n=b("dijit.form._TextBoxMixin",n,{_setValueAttr:function(){this.inherited(arguments);this.applyTextDir(this.focusNode)},_setDisplayedValueAttr:function(){this.inherited(arguments);
this.applyTextDir(this.focusNode)},_onInput:function(){this.applyTextDir(this.focusNode);this.inherited(arguments)}}));n._setSelectionRange=l._setSelectionRange=function(f,e,k){f.setSelectionRange&&f.setSelectionRange(e,k)};n.selectInputText=l.selectInputText=function(f,e,k){f=c.byId(f);isNaN(e)&&(e=0);isNaN(k)&&(k=f.value?f.value.length:0);try{f.focus(),n._setSelectionRange(f,e,k)}catch(r){}};return n})},"dijit/form/NumberTextBox":function(){define("dojo/_base/declare dojo/_base/lang dojo/i18n dojo/string dojo/number ./RangeBoundTextBox".split(" "),
function(a,b,c,d,g,x){var w=function(n){n=n||{};var f=c.getLocalization("dojo.cldr","number",c.normalizeLocale(n.locale)),e=n.pattern?n.pattern:f[(n.type||"decimal")+"Format"];n="number"==typeof n.places?n.places:"string"===typeof n.places&&0<n.places.length?n.places.replace(/.*,/,""):-1!=e.indexOf(".")?e.split(".")[1].replace(/[^#0]/g,"").length:0;return{sep:f.decimal,places:n}},l=a("dijit.form.NumberTextBoxMixin",null,{pattern:function(n){return"("+(this.focused&&this.editOptions?this._regExpGenerator(b.delegate(n,
this.editOptions))+"|":"")+this._regExpGenerator(n)+")"},value:NaN,editOptions:{pattern:"#.######"},_formatter:g.format,_regExpGenerator:g.regexp,_decimalInfo:w(),postMixInProperties:function(){this.inherited(arguments);this._set("type","text")},_setConstraintsAttr:function(n){var f="number"==typeof n.places?n.places:0;f&&f++;"number"!=typeof n.max&&(n.max=9*Math.pow(10,15-f));"number"!=typeof n.min&&(n.min=-9*Math.pow(10,15-f));this.inherited(arguments,[n]);this.focusNode&&this.focusNode.value&&
!isNaN(this.value)&&this.set("value",this.value);this._decimalInfo=w(n)},_onFocus:function(n){if(!this.disabled&&!this.readOnly){var f=this.get("value");"number"!=typeof f||isNaN(f)||(f=this.format(f,this.constraints),void 0!==f&&(this.textbox.value=f,"mouse"!==n&&this.textbox.select()));this.inherited(arguments)}},format:function(n,f){var e=String(n);if("number"!=typeof n)return e;if(isNaN(n))return"";if(!("rangeCheck"in this&&this.rangeCheck(n,f))&&!1!==f.exponent&&/\de[-+]?\d/i.test(e))return e;
this.editOptions&&this.focused&&(f=b.mixin({},f,this.editOptions));return this._formatter(n,f)},_parser:g.parse,parse:function(n,f){var e=b.mixin({},f,this.editOptions&&this.focused?this.editOptions:{});if(this.focused&&null!=e.places){var k=e.places;k="number"===typeof k?k:Number(k.split(",").pop());e.places="0,"+k}e=this._parser(n,e);this.editOptions&&this.focused&&isNaN(e)&&(e=this._parser(n,f));return e},_getDisplayedValueAttr:function(){var n=this.inherited(arguments);return isNaN(n)?this.textbox.value:
n},filter:function(n){if(null==n||"string"==typeof n&&""==n)return NaN;"number"!=typeof n||isNaN(n)||0==n||(n=g.round(n,this._decimalInfo.places));return this.inherited(arguments,[n])},serialize:function(n,f){return"number"!=typeof n||isNaN(n)?"":this.inherited(arguments)},_setBlurValue:function(){var n=b.hitch(b.delegate(this,{focused:!0}),"get")("value");this._setValueAttr(n,!0)},_setValueAttr:function(n,f,e){if(void 0!==n&&void 0===e)if(e=String(n),"number"==typeof n)if(isNaN(n))e="";else{if("rangeCheck"in
this&&this.rangeCheck(n,this.constraints)||!1===this.constraints.exponent||!/\de[-+]?\d/i.test(e))e=void 0}else n?n=void 0:(e="",n=NaN);this.inherited(arguments,[n,f,e])},_getValueAttr:function(){var n=this.inherited(arguments);if(isNaN(n)&&""!==this.textbox.value){if(!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)&&(new RegExp("^"+g._realNumberRegexp(b.delegate(this.constraints))+"$")).test(this.textbox.value))return n=Number(this.textbox.value),isNaN(n)?void 0:n}else return n},
isValid:function(n){if(!this.focused||this._isEmpty(this.textbox.value))return this.inherited(arguments);var f=this.get("value");return!isNaN(f)&&this.rangeCheck(f,this.constraints)?!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)?!0:this.inherited(arguments):!1},_isValidSubset:function(){var n="number"==typeof this.constraints.min,f="number"==typeof this.constraints.max,e=this.get("value");if(isNaN(e)||!n&&!f)return this.inherited(arguments);var k=e|0,r=0>e,y=-1!=this.textbox.value.indexOf(this._decimalInfo.sep),
p=(this.maxLength||20)-this.textbox.value.length,h=y?this.textbox.value.split(this._decimalInfo.sep)[1].replace(/[^0-9]/g,""):"";k=y?k+"."+h:k+"";p=d.rep("9",p);y=e;r?y=Number(k+p):e=Number(k+p);return!(n&&e<this.constraints.min||f&&y>this.constraints.max)}});a=a("dijit.form.NumberTextBox",[x,l],{baseClass:"dijitTextBox dijitNumberTextBox"});a.Mixin=l;return a})},"dijit/ColorPalette":function(){define("require dojo/text!./templates/ColorPalette.html ./_Widget ./_TemplatedMixin ./_PaletteMixin ./hccss dojo/i18n dojo/_base/Color dojo/_base/declare dojo/dom-construct dojo/string dojo/i18n!dojo/nls/colors dojo/colors".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e){var k=n("dijit.ColorPalette",[c,d,g],{palette:"7x10",_palettes:{"7x10":["white seashell cornsilk lemonchiffon lightyellow palegreen paleturquoise lightcyan lavender plum".split(" "),"lightgray pink bisque moccasin khaki lightgreen lightseagreen lightskyblue cornflowerblue violet".split(" "),"silver lightcoral sandybrown orange palegoldenrod chartreuse mediumturquoise skyblue mediumslateblue orchid".split(" "),"gray red orangered darkorange yellow limegreen darkseagreen royalblue slateblue mediumorchid".split(" "),
"dimgray crimson chocolate coral gold forestgreen seagreen blue blueviolet darkorchid".split(" "),"darkslategray firebrick saddlebrown sienna olive green darkcyan mediumblue darkslateblue darkmagenta".split(" "),"black darkred maroon brown darkolivegreen darkgreen midnightblue navy indigo purple".split(" ")],"3x4":[["white","lime","green","blue"],["silver","yellow","fuchsia","navy"],["gray","red","purple","black"]]},templateString:b,baseClass:"dijitColorPalette",_dyeFactory:function(r,y,p,h){return new this._dyeClass(r,
y,p,h)},buildRendering:function(){this.inherited(arguments);this._dyeClass=n(k._Color,{palette:this.palette});this._preparePalette(this._palettes[this.palette],w.getLocalization("dojo","colors",this.lang))}});k._Color=n("dijit._Color",l,{template:"\x3cspan class\x3d'dijitInline dijitPaletteImg'\x3e\x3cimg src\x3d'${blankGif}' alt\x3d'${alt}' title\x3d'${title}' class\x3d'dijitColorPaletteSwatch' style\x3d'background-color: ${color}'/\x3e\x3c/span\x3e",hcTemplate:"\x3cspan class\x3d'dijitInline dijitPaletteImg' style\x3d'position: relative; overflow: hidden; height: 12px; width: 14px;'\x3e\x3cimg src\x3d'${image}' alt\x3d'${alt}' title\x3d'${title}' style\x3d'position: absolute; left: ${left}px; top: ${top}px; ${size}'/\x3e\x3c/span\x3e",
_imagePaths:{"7x10":a.toUrl("./themes/a11y/colors7x10.png"),"3x4":a.toUrl("./themes/a11y/colors3x4.png")},constructor:function(r,y,p,h){this._title=h;this._row=y;this._col=p;this.setColor(l.named[r])},getValue:function(){return this.toHex()},fillCell:function(r,y){y=e.substitute(x("highcontrast")?this.hcTemplate:this.template,{color:this.toHex(),blankGif:y,alt:this._title,title:this._title,image:this._imagePaths[this.palette].toString(),left:-20*this._col-5,top:-20*this._row-5,size:"7x10"==this.palette?
"height: 145px; width: 206px":"height: 64px; width: 86px"});f.place(y,r)}});return k})},"dijit/_PaletteMixin":function(){define("dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/keys dojo/_base/lang dojo/on ./_CssStateMixin ./a11yclick ./focus ./typematic".split(" "),function(a,b,c,d,g,x,w,l,n,f,e){return a("dijit._PaletteMixin",l,{defaultTimeout:500,timeoutChangeRate:.9,value:"",_selectedCell:-1,tabIndex:"0",cellClass:"dijitPaletteCell",dyeClass:null,_dyeFactory:function(k){return new ("string"==
typeof this.dyeClass?x.getObject(this.dyeClass):this.dyeClass)(k)},_preparePalette:function(k,r){this._cells=[];var y=this._blankGif;this.own(w(this.gridNode,n,x.hitch(this,"_onCellClick")));for(var p=0;p<k.length;p++)for(var h=d.create("tr",{tabIndex:"-1",role:"row"},this.gridNode),m=0;m<k[p].length;m++){var u=k[p][m];if(u){var t=this._dyeFactory(u,p,m,r[u]);u=d.create("td",{"class":this.cellClass,tabIndex:"-1",title:r[u],role:"gridcell"},h);t.fillCell(u,y);u.idx=this._cells.length;this._cells.push({node:u,
dye:t})}}this._xDim=k[0].length;this._yDim=k.length;var q={UP_ARROW:-this._xDim,DOWN_ARROW:this._xDim,RIGHT_ARROW:this.isLeftToRight()?1:-1,LEFT_ARROW:this.isLeftToRight()?-1:1},z;for(z in q)this.own(e.addKeyListener(this.domNode,{keyCode:g[z],ctrlKey:!1,altKey:!1,shiftKey:!1},this,function(){var v=q[z];return function(B){this._navigateByKey(v,B)}}(),this.timeoutChangeRate,this.defaultTimeout))},postCreate:function(){this.inherited(arguments);this._setCurrent(this._cells[0].node)},focus:function(){f.focus(this._currentFocus)},
_onCellClick:function(k){for(var r=k.target;"TD"!=r.tagName;){if(!r.parentNode||r==this.gridNode)return;r=r.parentNode}var y=this._getDye(r).getValue();this._setCurrent(r);f.focus(r);this._setValueAttr(y,!0);k.stopPropagation();k.preventDefault()},_setCurrent:function(k){"_currentFocus"in this&&b.set(this._currentFocus,"tabIndex","-1");(this._currentFocus=k)&&b.set(k,"tabIndex",this.tabIndex)},_setValueAttr:function(k,r){0<=this._selectedCell&&c.remove(this._cells[this._selectedCell].node,this.cellClass+
"Selected");this._selectedCell=-1;if(k)for(var y=0;y<this._cells.length;y++)if(k==this._cells[y].dye.getValue()){this._selectedCell=y;c.add(this._cells[y].node,this.cellClass+"Selected");break}this._set("value",0<=this._selectedCell?k:null);if(r||void 0===r)this.onChange(k)},onChange:function(){},_navigateByKey:function(k,r){-1!=r&&(k=this._currentFocus.idx+k,k<this._cells.length&&-1<k&&(k=this._cells[k].node,this._setCurrent(k),this.defer(x.hitch(f,"focus",k))))},_getDye:function(k){return this._cells[k.idx].dye}})})},
"dojo/colors":function(){define(["./_base/kernel","./_base/lang","./_base/Color","./_base/array"],function(a,b,c,d){var g={};b.setObject("dojo.colors",g);var x=function(l,n,f){0>f&&++f;1<f&&--f;var e=6*f;return 1>e?l+(n-l)*e:1>2*f?n:2>3*f?l+(n-l)*(2/3-f)*6:l};a.colorFromRgb=c.fromRgb=function(l,n){var f=l.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(f){l=f[2].split(/\s*,\s*/);var e=l.length;f=f[1];if("rgb"==f&&3==e||"rgba"==f&&4==e)return f=l[0],"%"==f.charAt(f.length-1)?(f=d.map(l,
function(y){return 2.56*parseFloat(y)}),4==e&&(f[3]=l[3]),c.fromArray(f,n)):c.fromArray(l,n);if("hsl"==f&&3==e||"hsla"==f&&4==e){f=(parseFloat(l[0])%360+360)%360/360;var k=parseFloat(l[1])/100,r=parseFloat(l[2])/100;k=.5>=r?r*(k+1):r+k-r*k;r=2*r-k;f=[256*x(r,k,f+1/3),256*x(r,k,f),256*x(r,k,f-1/3),1];4==e&&(f[3]=l[3]);return c.fromArray(f,n)}}return null};var w=function(l,n,f){l=Number(l);return isNaN(l)?f:l<n?n:l>f?f:l};c.prototype.sanitize=function(){this.r=Math.round(w(this.r,0,255));this.g=Math.round(w(this.g,
0,255));this.b=Math.round(w(this.b,0,255));this.a=w(this.a,0,1);return this};g.makeGrey=c.makeGrey=function(l,n){return c.fromArray([l,l,l,n])};b.mixin(c.named,{aliceblue:[240,248,255],antiquewhite:[250,235,215],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],blanchedalmond:[255,235,205],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,
149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,
0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],
lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,
0,255],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],oldlace:[253,245,230],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,
232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,
250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],whitesmoke:[245,245,245],yellowgreen:[154,205,50]});return c})},"dijit/form/HorizontalSlider":function(){define("dojo/_base/array dojo/_base/declare dojo/dnd/move dojo/_base/fx dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/sniff dojo/dnd/Moveable dojo/dnd/Mover dojo/query dojo/mouse dojo/on ../_base/manager ../focus ../typematic ./Button ./_FormValueWidget ../_Container dojo/text!./templates/HorizontalSlider.html".split(" "),
function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z){var v=b("dijit.form._SliderMover",e,{onMouseMove:function(B){var A=this.widget,E=A._abspos;E||(E=A._abspos=g.position(A.sliderBarContainer,!0),A._setPixelValue_=l.hitch(A,"_setPixelValue"),A._isReversed_=A._isReversed());B=B[A._mousePixelCoord]-E[A._startingPixelCoord];A._setPixelValue_(A._isReversed_?E[A._pixelCount]-B:B,E[A._pixelCount],!1)},destroy:function(B){e.prototype.destroy.apply(this,arguments);var A=this.widget;A._abspos=null;A._setValueAttr(A.value,
!0)}});c=b("dijit.form.HorizontalSlider",[t,q],{templateString:z,value:0,showButtons:!0,minimum:0,maximum:100,discreteValues:Infinity,pageIncrement:2,clickSelect:!0,slideDuration:p.defaultDuration,_setIdAttr:"",_setNameAttr:"valueNode",baseClass:"dijitSlider",cssStateNodes:{incrementButton:"dijitSliderIncrementButton",decrementButton:"dijitSliderDecrementButton",focusNode:"dijitSliderThumb"},_mousePixelCoord:"pageX",_pixelCount:"w",_startingPixelCoord:"x",_handleOffsetCoord:"left",_progressPixelSize:"width",
_onKeyUp:function(B){this.disabled||this.readOnly||B.altKey||B.ctrlKey||B.metaKey||this._setValueAttr(this.value,!0)},_onKeyDown:function(B){if(!(this.disabled||this.readOnly||B.altKey||B.ctrlKey||B.metaKey)){switch(B.keyCode){case w.HOME:this._setValueAttr(this.minimum,!1);break;case w.END:this._setValueAttr(this.maximum,!1);break;case this._descending||this.isLeftToRight()?w.RIGHT_ARROW:w.LEFT_ARROW:case !1===this._descending?w.DOWN_ARROW:w.UP_ARROW:case !1===this._descending?w.PAGE_DOWN:w.PAGE_UP:this.increment(B);
break;case this._descending||this.isLeftToRight()?w.LEFT_ARROW:w.RIGHT_ARROW:case !1===this._descending?w.UP_ARROW:w.DOWN_ARROW:case !1===this._descending?w.PAGE_UP:w.PAGE_DOWN:this.decrement(B);break;default:return}B.stopPropagation();B.preventDefault()}},_onHandleClick:function(B){this.disabled||this.readOnly||(n("ie")||h.focus(this.sliderHandle),B.stopPropagation(),B.preventDefault())},_isReversed:function(){return!this.isLeftToRight()},_onBarClick:function(B){if(!this.disabled&&!this.readOnly&&
this.clickSelect){h.focus(this.sliderHandle);B.stopPropagation();B.preventDefault();var A=g.position(this.sliderBarContainer,!0),E=B[this._mousePixelCoord]-A[this._startingPixelCoord];this._setPixelValue(this._isReversed()?A[this._pixelCount]-E:E,A[this._pixelCount],!0);this._movable.onMouseDown(B)}},_setPixelValue:function(B,A,E){if(!this.disabled&&!this.readOnly){var C=this.discreteValues;if(1>=C||Infinity==C)C=A;C--;this._setValueAttr(Math.max(Math.min((this.maximum-this.minimum)*Math.round(B/
(A/C))/C+this.minimum,this.maximum),this.minimum),E)}},_setValueAttr:function(B,A){this._set("value",B);this.valueNode.value=B;this.focusNode.setAttribute("aria-valuenow",B);this.inherited(arguments);var E=this.maximum>this.minimum?(B-this.minimum)/(this.maximum-this.minimum):0,C=!1===this._descending?this.remainingBar:this.progressBar,D=!1===this._descending?this.progressBar:this.remainingBar;this._inProgressAnim&&"stopped"!=this._inProgressAnim.status&&this._inProgressAnim.stop(!0);if(A&&0<this.slideDuration&&
C.style[this._progressPixelSize]){var F=this,G={},J=parseFloat(C.style[this._progressPixelSize]),I=this.slideDuration*(E-J/100);0!=I&&(0>I&&(I=0-I),G[this._progressPixelSize]={start:J,end:100*E,units:"%"},this._inProgressAnim=d.animateProperty({node:C,duration:I,onAnimate:function(O){D.style[F._progressPixelSize]=100-parseFloat(O[F._progressPixelSize])+"%"},onEnd:function(){delete F._inProgressAnim},properties:G}),this._inProgressAnim.play())}else C.style[this._progressPixelSize]=100*E+"%",D.style[this._progressPixelSize]=
100*(1-E)+"%"},_bumpValue:function(B,A){if(!(this.disabled||this.readOnly||this.maximum<=this.minimum)){var E=x.getComputedStyle(this.sliderBarContainer),C=g.getContentBox(this.sliderBarContainer,E);E=this.discreteValues;if(1>=E||Infinity==E)E=C[this._pixelCount];E--;B=Math.round((this.value-this.minimum)*E/(this.maximum-this.minimum))+B;0>B&&(B=0);B>E&&(B=E);B=B*(this.maximum-this.minimum)/E+this.minimum;this._setValueAttr(B,A)}},_onClkBumper:function(B){this.disabled||this.readOnly||!this.clickSelect||
this._setValueAttr(B,!0)},_onClkIncBumper:function(){this._onClkBumper(!1===this._descending?this.minimum:this.maximum)},_onClkDecBumper:function(){this._onClkBumper(!1===this._descending?this.maximum:this.minimum)},decrement:function(B){this._bumpValue(B.keyCode==w.PAGE_DOWN?-this.pageIncrement:-1)},increment:function(B){this._bumpValue(B.keyCode==w.PAGE_UP?this.pageIncrement:1)},_mouseWheeled:function(B){this.focused&&(B.stopPropagation(),B.preventDefault(),this._bumpValue(0>B.wheelDelta?-1:1,!0))},
startup:function(){this._started||(a.forEach(this.getChildren(),function(B){this[B.container]!=this.containerNode&&this[B.container].appendChild(B.domNode)},this),this.inherited(arguments))},_typematicCallback:function(B,A,E){if(-1==B)this._setValueAttr(this.value,!0);else this[A==(this._descending?this.incrementButton:this.decrementButton)?"decrement":"increment"](E)},buildRendering:function(){this.inherited(arguments);this.showButtons&&(this.incrementButton.style.display="",this.decrementButton.style.display=
"");var B=k('label[for\x3d"'+this.id+'"]');B.length&&(B[0].id||(B[0].id=this.id+"_label"),this.focusNode.setAttribute("aria-labelledby",B[0].id));this.focusNode.setAttribute("aria-valuemin",this.minimum);this.focusNode.setAttribute("aria-valuemax",this.maximum)},postCreate:function(){this.inherited(arguments);this.showButtons&&this.own(m.addMouseListener(this.decrementButton,this,"_typematicCallback",25,500),m.addMouseListener(this.incrementButton,this,"_typematicCallback",25,500));this.own(y(this.domNode,
r.wheel,l.hitch(this,"_mouseWheeled")));var B=b(v,{widget:this});this._movable=new f(this.sliderHandle,{mover:B});this._layoutHackIE7()},destroy:function(){this._movable.destroy();this._inProgressAnim&&"stopped"!=this._inProgressAnim.status&&this._inProgressAnim.stop(!0);this.inherited(arguments)}});c._Mover=v;return c})},"dijit/form/Button":function(){define("require dojo/_base/declare dojo/dom-class dojo/has dojo/_base/kernel dojo/_base/lang dojo/ready ./_FormWidget ./_ButtonMixin dojo/text!./templates/Button.html ../a11yclick".split(" "),
function(a,b,c,d,g,x,w,l,n,f){d("dijit-legacy-requires")&&w(0,function(){a(["dijit/form/DropDownButton","dijit/form/ComboButton","dijit/form/ToggleButton"])});w=b("dijit.form.Button"+(d("dojo-bidi")?"_NoBidi":""),[l,n],{showLabel:!0,iconClass:"dijitNoIcon",_setIconClassAttr:{node:"iconNode",type:"class"},baseClass:"dijitButton",templateString:f,_setValueAttr:"valueNode",_setNameAttr:function(e){this.valueNode&&this.valueNode.setAttribute("name",e)},postCreate:function(){this.inherited(arguments);
this._setLabelFromContainer()},_setLabelFromContainer:function(){this.containerNode&&!this.label&&(this.label=x.trim(this.containerNode.innerHTML),this.onLabelSet())},_setShowLabelAttr:function(e){this.containerNode&&c.toggle(this.containerNode,"dijitDisplayNone",!e);this._set("showLabel",e)},setLabel:function(e){g.deprecated("dijit.form.Button.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",e)},onLabelSet:function(){this.inherited(arguments);this.showLabel||
"title"in this.params||(this.titleNode.title=x.trim(this.containerNode.innerText||this.containerNode.textContent||""))}});d("dojo-bidi")&&(w=b("dijit.form.Button",w,{onLabelSet:function(){this.inherited(arguments);this.titleNode.title&&this.applyTextDir(this.titleNode,this.titleNode.title)},_setTextDirAttr:function(e){this._created&&this.textDir!=e&&(this._set("textDir",e),this._setLabelAttr(this.label))}}));return w})},"dijit/form/_ButtonMixin":function(){define(["dojo/_base/declare","dojo/dom",
"dojo/has","../registry"],function(a,b,c,d){var g=a("dijit.form._ButtonMixin"+(c("dojo-bidi")?"_NoBidi":""),null,{label:"",type:"button",__onClick:function(x){x.stopPropagation();x.preventDefault();this.disabled||this.valueNode.click(x);return!1},_onClick:function(x){if(this.disabled)return x.stopPropagation(),x.preventDefault(),!1;!1===this.onClick(x)&&x.preventDefault();var w=x.defaultPrevented;if(!w&&"submit"==this.type&&!(this.valueNode||this.focusNode).form)for(var l=this.domNode;l.parentNode;l=
l.parentNode){var n=d.byNode(l);if(n&&"function"==typeof n._onSubmit){n._onSubmit(x);x.preventDefault();w=!0;break}}return!w},postCreate:function(){this.inherited(arguments);b.setSelectable(this.focusNode,!1)},onClick:function(){return!0},_setLabelAttr:function(x){this._set("label",x);(this.containerNode||this.focusNode).innerHTML=x;this.onLabelSet()},onLabelSet:function(){}});c("dojo-bidi")&&(g=a("dijit.form._ButtonMixin",g,{onLabelSet:function(){this.inherited(arguments);this.applyTextDir(this.containerNode||
this.focusNode)}}));return g})},"dijit/form/HorizontalRule":function(){define(["dojo/_base/declare","../_Widget","../_TemplatedMixin"],function(a,b,c){return a("dijit.form.HorizontalRule",[b,c],{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerH"\x3e\x3c/div\x3e',count:3,container:"containerNode",ruleStyle:"",_positionPrefix:'\x3cdiv class\x3d"dijitRuleMark dijitRuleMarkH" style\x3d"left:',_positionSuffix:"%;",_suffix:'"\x3e\x3c/div\x3e',_genHTML:function(d){return this._positionPrefix+
d+this._positionSuffix+this.ruleStyle+this._suffix},_isHorizontal:!0,buildRendering:function(){this.inherited(arguments);if(1==this.count)var d=this._genHTML(50,0);else{var g,x=100/(this.count-1);if(!this._isHorizontal||this.isLeftToRight()){d=this._genHTML(0,0);for(g=1;g<this.count-1;g++)d+=this._genHTML(x*g,g);d+=this._genHTML(100,this.count-1)}else{d=this._genHTML(100,0);for(g=1;g<this.count-1;g++)d+=this._genHTML(100-x*g,g);d+=this._genHTML(0,this.count-1)}}this.domNode.innerHTML=d}})})},"dojo/_base/query":function(){define(["../query",
"./NodeList"],function(a){return a})},"dijit/form/CheckBox":function(){define("require dojo/_base/declare dojo/dom-attr dojo/has dojo/query dojo/ready ./ToggleButton ./_CheckBoxMixin dojo/text!./templates/CheckBox.html dojo/NodeList-dom ../a11yclick".split(" "),function(a,b,c,d,g,x,w,l,n){d("dijit-legacy-requires")&&x(0,function(){a(["dijit/form/RadioButton"])});return b("dijit.form.CheckBox",[w,l],{templateString:n,baseClass:"dijitCheckBox",_setValueAttr:function(f,e){"string"==typeof f&&(this.inherited(arguments),
f=!0);this._created&&this.set("checked",f,e)},_getValueAttr:function(){return this.checked&&this._get("value")},_setIconClassAttr:null,_setNameAttr:"focusNode",postMixInProperties:function(){this.inherited(arguments);this.checkedAttrSetting=""},_fillContent:function(){},_onFocus:function(){this.id&&g("label[for\x3d'"+this.id+"']").addClass("dijitFocusedLabel");this.inherited(arguments)},_onBlur:function(){this.id&&g("label[for\x3d'"+this.id+"']").removeClass("dijitFocusedLabel");this.inherited(arguments)}})})},
"dijit/form/ToggleButton":function(){define(["dojo/_base/declare","dojo/_base/kernel","./Button","./_ToggleButtonMixin"],function(a,b,c,d){return a("dijit.form.ToggleButton",[c,d],{baseClass:"dijitToggleButton",setChecked:function(g){b.deprecated("setChecked("+g+") is deprecated. Use set('checked',"+g+") instead.","","2.0");this.set("checked",g)}})})},"dijit/form/_ToggleButtonMixin":function(){define(["dojo/_base/declare","dojo/dom-attr"],function(a,b){return a("dijit.form._ToggleButtonMixin",null,
{checked:!1,_aria_attr:"aria-pressed",_onClick:function(c){var d=this.checked;this._set("checked",!d);var g=this.inherited(arguments);this.set("checked",g?this.checked:d);return g},_setCheckedAttr:function(c,d){this._set("checked",c);var g=this.focusNode||this.domNode;this._created&&b.get(g,"checked")!=!!c&&b.set(g,"checked",!!c);g.setAttribute(this._aria_attr,String(c));this._handleOnChange(c,d)},postCreate:function(){this.inherited(arguments);var c=this.focusNode||this.domNode;this.checked&&c.setAttribute("checked",
"checked");void 0===this._resetValue&&(this._lastValueReported=this._resetValue=this.checked)},reset:function(){this._hasBeenBlurred=!1;this.set("checked",this.params.checked||!1)}})})},"dijit/form/_CheckBoxMixin":function(){define(["dojo/_base/declare","dojo/dom-attr"],function(a,b){return a("dijit.form._CheckBoxMixin",null,{type:"checkbox",value:"on",readOnly:!1,_aria_attr:"aria-checked",_setReadOnlyAttr:function(c){this._set("readOnly",c);b.set(this.focusNode,"readOnly",c)},_setLabelAttr:void 0,
_getSubmitValue:function(c){return null==c||""===c?"on":c},_setValueAttr:function(c){c=this._getSubmitValue(c);this._set("value",c);b.set(this.focusNode,"value",c)},reset:function(){this.inherited(arguments);this._set("value",this._getSubmitValue(this.params.value));b.set(this.focusNode,"value",this.value)},_onClick:function(c){return this.readOnly?(c.stopPropagation(),c.preventDefault(),!1):this.inherited(arguments)}})})},"dijit/form/ComboBox":function(){define(["dojo/_base/declare","./ValidationTextBox",
"./ComboBoxMixin"],function(a,b,c){return a("dijit.form.ComboBox",[b,c],{})})},"dijit/form/ComboBoxMixin":function(){define("dojo/_base/declare dojo/Deferred dojo/_base/kernel dojo/_base/lang dojo/store/util/QueryResults ./_AutoCompleterMixin ./_ComboBoxMenu ../_HasDropDown dojo/text!./templates/DropDownBox.html".split(" "),function(a,b,c,d,g,x,w,l,n){return a("dijit.form.ComboBoxMixin",[l,x],{dropDownClass:w,hasDownArrow:!0,templateString:n,baseClass:"dijitTextBox dijitComboBox",cssStateNodes:{_buttonNode:"dijitDownArrowButton"},
_setHasDownArrowAttr:function(f){this._set("hasDownArrow",f);this._buttonNode.style.display=f?"":"none"},_showResultList:function(){this.displayMessage("");this.inherited(arguments)},_setStoreAttr:function(f){f.get||d.mixin(f,{_oldAPI:!0,get:function(e){var k=new b;this.fetchItemByIdentity({identity:e,onItem:function(r){k.resolve(r)},onError:function(r){k.reject(r)}});return k.promise},query:function(e,k){var r=new b(function(){y.abort&&y.abort()});r.total=new b;var y=this.fetch(d.mixin({query:e,
onBegin:function(p){r.total.resolve(p)},onComplete:function(p){r.resolve(p)},onError:function(p){r.reject(p)}},k));return g(r)}});this._set("store",f)},postMixInProperties:function(){var f=this.params.store||this.store;f&&this._setStoreAttr(f);this.inherited(arguments);if(!this.params.store&&this.store&&!this.store._oldAPI){var e=this.declaredClass;d.mixin(this.store,{getValue:function(k,r){c.deprecated(e+".store.getValue(item, attr) is deprecated for builtin store.  Use item.attr directly","","2.0");
return k[r]},getLabel:function(k){c.deprecated(e+".store.getLabel(item) is deprecated for builtin store.  Use item.label directly","","2.0");return k.name},fetch:function(k){c.deprecated(e+".store.fetch() is deprecated for builtin store.","Use store.query()","2.0");require(["dojo/data/ObjectStore"],d.hitch(this,function(r){(new r({objectStore:this})).fetch(k)}))}})}},buildRendering:function(){this.inherited(arguments);this.focusNode.setAttribute("aria-autocomplete",this.autoComplete?"both":"list")}})})},
"dijit/form/_AutoCompleterMixin":function(){define("dojo/aspect dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/query dojo/regexp dojo/sniff ./DataList ./_TextBoxMixin ./_SearchMixin".split(" "),function(a,b,c,d,g,x,w,l,n,f,e){b=b("dijit.form._AutoCompleterMixin",e,{item:null,autoComplete:!0,highlightMatch:"first",labelAttr:"",labelType:"text",maxHeight:-1,_stopClickEvents:!1,_getCaretPos:function(k){var r=0;if("number"==typeof k.selectionStart)r=k.selectionStart;else if(l("ie")){var y=
k.ownerDocument.selection.createRange().duplicate();k=k.createTextRange();y.move("character",0);k.move("character",0);try{k.setEndPoint("EndToEnd",y),r=String(k.text).replace(/\r/g,"").length}catch(p){}}return r},_setCaretPos:function(k,r){r=parseInt(r);f.selectInputText(k,r,r)},_setDisabledAttr:function(k){this.inherited(arguments);this.domNode.setAttribute("aria-disabled",k?"true":"false")},_onKey:function(k){if(!(32<=k.charCode)){var r=k.charCode||k.keyCode;if(r!=d.ALT&&r!=d.CTRL&&r!=d.META&&r!=
d.SHIFT){var y=this.dropDown,p=null;this._abortQuery();this.inherited(arguments);if(!(k.altKey||k.ctrlKey||k.metaKey))switch(this._opened&&(p=y.getHighlightedOption()),r){case d.PAGE_DOWN:case d.DOWN_ARROW:case d.PAGE_UP:case d.UP_ARROW:this._opened&&this._announceOption(p);k.stopPropagation();k.preventDefault();break;case d.ENTER:if(p){if(p==y.nextButton){this._nextSearch(1);k.stopPropagation();k.preventDefault();break}else if(p==y.previousButton){this._nextSearch(-1);k.stopPropagation();k.preventDefault();
break}k.stopPropagation();k.preventDefault()}else this._setBlurValue(),this._setCaretPos(this.focusNode,this.focusNode.value.length);case d.TAB:r=this.get("displayedValue");if(y&&(r==y._messages.previousMessage||r==y._messages.nextMessage))break;p&&this._selectOption(p);case d.ESCAPE:this._opened&&(this._lastQuery=null,this.closeDropDown())}}}},_autoCompleteText:function(k){var r=this.focusNode;f.selectInputText(r,r.value.length);var y=this.ignoreCase?"toLowerCase":"substr";0==k[y](0).indexOf(this.focusNode.value[y](0))?
(y=this.autoComplete?this._getCaretPos(r):r.value.length,y+1>r.value.length&&(r.value=k,f.selectInputText(r,y))):(r.value=k,f.selectInputText(r))},_openResultList:function(k,r,y){var p=this.dropDown.getHighlightedOption();this.dropDown.clearResultList();k.length||0!=y.start?(this._nextSearch=this.dropDown.onPage=g.hitch(this,function(h){k.nextPage(-1!==h);this.focus()}),this.dropDown.createOptions(k,y,g.hitch(this,"_getMenuLabelFromItem")),this._showResultList(),"direction"in y?(y.direction?this.dropDown.highlightFirstOption():
y.direction||this.dropDown.highlightLastOption(),p&&this._announceOption(this.dropDown.getHighlightedOption())):!this.autoComplete||this._prev_key_backspace||/^[*]+$/.test(r[this.searchAttr].toString())||this._announceOption(this.dropDown.containerNode.firstChild.nextSibling)):this.closeDropDown()},_showResultList:function(){this.closeDropDown(!0);this.openDropDown();this.domNode.setAttribute("aria-expanded","true")},loadDropDown:function(){this._startSearchAll()},isLoaded:function(){return!1},closeDropDown:function(){this._abortQuery();
this._opened&&(this.inherited(arguments),this.domNode.setAttribute("aria-expanded","false"))},_setBlurValue:function(){var k=this.get("displayedValue"),r=this.dropDown;!r||k!=r._messages.previousMessage&&k!=r._messages.nextMessage?"undefined"==typeof this.item?(this.item=null,this.set("displayedValue",k)):(this.value!=this._lastValueReported&&this._handleOnChange(this.value,!0),this._refreshState()):this._setValueAttr(this._lastValueReported,!0);this.focusNode.removeAttribute("aria-activedescendant")},
_setItemAttr:function(k,r,y){var p="";k&&(y||(y=this.store._oldAPI?this.store.getValue(k,this.searchAttr):k[this.searchAttr]),p=this._getValueField()!=this.searchAttr?this.store.getIdentity(k):y);this.set("value",p,r,y,k)},_announceOption:function(k){if(k){if(k==this.dropDown.nextButton||k==this.dropDown.previousButton){var r=k.innerHTML;this.item=void 0;this.value=""}else{var y=this.dropDown.items[k.getAttribute("item")];r=(this.store._oldAPI?this.store.getValue(y,this.searchAttr):y[this.searchAttr]).toString();
this.set("item",y,!1,r)}this.focusNode.value=this.focusNode.value.substring(0,this._lastInput.length);this.focusNode.setAttribute("aria-activedescendant",c.get(k,"id"));this._autoCompleteText(r)}},_selectOption:function(k){this.closeDropDown();k&&this._announceOption(k);this._setCaretPos(this.focusNode,this.focusNode.value.length);this._handleOnChange(this.value,!0);this.focusNode.removeAttribute("aria-activedescendant")},_startSearchAll:function(){this._startSearch("")},_startSearchFromInput:function(){this.item=
void 0;this.inherited(arguments)},_startSearch:function(k){if(!this.dropDown){var r=this.id+"_popup";this.dropDown=new (g.isString(this.dropDownClass)?g.getObject(this.dropDownClass,!1):this.dropDownClass)({onChange:g.hitch(this,this._selectOption),id:r,dir:this.dir,textDir:this.textDir})}this._lastInput=k;this.inherited(arguments)},_getValueField:function(){return this.searchAttr},postMixInProperties:function(){this.inherited(arguments);if(!this.store&&this.srcNodeRef&&(this.store=new n({},this.srcNodeRef),
!("value"in this.params))){var k=this.item=this.store.fetchSelectedItem();if(k){var r=this._getValueField();this.value=this.store._oldAPI?this.store.getValue(k,r):k[r]}}},postCreate:function(){var k=x('label[for\x3d"'+this.id+'"]');k.length&&(k[0].id||(k[0].id=this.id+"_label"),this.domNode.setAttribute("aria-labelledby",k[0].id));this.inherited(arguments);a.after(this,"onSearch",g.hitch(this,"_openResultList"),!0)},_getMenuLabelFromItem:function(k){k=this.labelFunc(k,this.store);var r=this.labelType;
"none"!=this.highlightMatch&&"text"==this.labelType&&this._lastInput&&(k=this.doHighlight(k,this._lastInput),r="html");return{html:"html"==r,label:k}},doHighlight:function(k,r){var y=(this.ignoreCase?"i":"")+("all"==this.highlightMatch?"g":""),p=this.queryExpr.indexOf("${0}");r=w.escapeString(r);return this._escapeHtml(k.replace(new RegExp((0==p?"^":"")+"("+r+")"+(p==this.queryExpr.length-4?"$":""),y),"\uffff$1\uffff")).replace(/\uFFFF([^\uFFFF]+)\uFFFF/g,'\x3cspan class\x3d"dijitComboBoxHighlightMatch"\x3e$1\x3c/span\x3e')},
_escapeHtml:function(k){return k=String(k).replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;")},reset:function(){this.item=null;this.inherited(arguments)},labelFunc:function(k,r){return(r._oldAPI?r.getValue(k,this.labelAttr||this.searchAttr):k[this.labelAttr||this.searchAttr]).toString()},_setValueAttr:function(k,r,y,p){this._set("item",p||null);null==k&&(k="");this.inherited(arguments)}});l("dojo-bidi")&&b.extend({_setTextDirAttr:function(k){this.inherited(arguments);
this.dropDown&&this.dropDown._set("textDir",k)}});return b})},"dijit/form/DataList":function(){define("dojo/_base/declare dojo/dom dojo/_base/lang dojo/query dojo/store/Memory ../registry".split(" "),function(a,b,c,d,g,x){function w(l){return{id:l.value,value:l.value,name:c.trim(l.innerText||l.textContent||"")}}return a("dijit.form.DataList",g,{constructor:function(l,n){this.domNode=b.byId(n);c.mixin(this,l);this.id&&x.add(this);this.domNode.style.display="none";this.inherited(arguments,[{data:d("option",
this.domNode).map(w)}])},destroy:function(){x.remove(this.id)},fetchSelectedItem:function(){var l=d("\x3e option[selected]",this.domNode)[0]||d("\x3e option",this.domNode)[0];return l&&w(l)}})})},"dijit/form/_SearchMixin":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/query dojo/string dojo/when ../registry".split(" "),function(a,b,c,d,g,x,w){return a("dijit.form._SearchMixin",null,{pageSize:Infinity,store:null,fetchProperties:{},query:{},list:"",_setListAttr:function(l){this._set("list",
l)},searchDelay:200,searchAttr:"name",queryExpr:"${0}*",ignoreCase:!0,_patternToRegExp:function(l){return new RegExp("^"+l.replace(/(\\.)|(\*)|(\?)|\W/g,function(n,f,e,k){return e?".*":k?".":f?f:"\\"+n})+"$",this.ignoreCase?"mi":"m")},_abortQuery:function(){this.searchTimer&&(this.searchTimer=this.searchTimer.remove());this._queryDeferHandle&&(this._queryDeferHandle=this._queryDeferHandle.remove());this._fetchHandle&&(this._fetchHandle.abort&&(this._cancelingQuery=!0,this._fetchHandle.abort(),this._cancelingQuery=
!1),this._fetchHandle.cancel&&(this._cancelingQuery=!0,this._fetchHandle.cancel(),this._cancelingQuery=!1),this._fetchHandle=null)},_processInput:function(l){if(!this.disabled&&!this.readOnly){l=l.charOrCode;this._prev_key_backspace=!1;if(l===b.DELETE||l===b.BACKSPACE)this._maskValidSubsetError=this._prev_key_backspace=!0;if(this.store)this.searchTimer=this.defer("_startSearchFromInput",1);else this.onSearch()}},onSearch:function(){},_startSearchFromInput:function(){this._startSearch(this.focusNode.value)},
_startSearch:function(l){this._abortQuery();var n=this,f=c.clone(this.query),e={start:0,count:this.pageSize,queryOptions:{ignoreCase:this.ignoreCase,deep:!0}},k=g.substitute(this.queryExpr,[l.replace(/([\\\*\?])/g,"\\$1")]),r=function(){var p=n._fetchHandle=n.store.query(f,e);n.disabled||n.readOnly||y!==n._lastQuery||x(p,function(h){n._fetchHandle=null;n.disabled||n.readOnly||y!==n._lastQuery||x(p.total,function(m){h.total=m;var u=n.pageSize;if(isNaN(u)||u>h.total)u=h.total;h.nextPage=function(t){e.direction=
t=!1!==t;e.count=u;t?(e.start+=h.length,e.start>=h.total&&(e.count=0)):(e.start-=u,0>e.start&&(e.count=Math.max(u+e.start,0),e.start=0));0>=e.count?(h.length=0,n.onSearch(h,f,e)):r()};n.onSearch(h,f,e)})},function(h){n._fetchHandle=null;n._cancelingQuery||console.error(n.declaredClass+" "+h.toString())})};c.mixin(e,this.fetchProperties);if(this.store._oldAPI)var y=k;else y=this._patternToRegExp(k),y.toString=function(){return k};this._lastQuery=f[this.searchAttr]=y;this._queryDeferHandle=this.defer(r,
this.searchDelay)},constructor:function(){this.query={};this.fetchProperties={}},postMixInProperties:function(){if(!this.store){var l=this.list;l&&(this.store=w.byId(l))}this.inherited(arguments)}})})},"dijit/form/_ComboBoxMenu":function(){define("dojo/_base/declare dojo/dom-class dojo/dom-style dojo/keys ../_WidgetBase ../_TemplatedMixin ./_ComboBoxMenuMixin ./_ListMouseMixin".split(" "),function(a,b,c,d,g,x,w,l){return a("dijit.form._ComboBoxMenu",[g,x,l,w],{templateString:"\x3cdiv class\x3d'dijitReset dijitMenu' data-dojo-attach-point\x3d'containerNode' style\x3d'overflow: auto; overflow-x: hidden;' role\x3d'listbox'\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuPreviousButton' data-dojo-attach-point\x3d'previousButton' role\x3d'option'\x3e\x3c/div\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuNextButton' data-dojo-attach-point\x3d'nextButton' role\x3d'option'\x3e\x3c/div\x3e\x3c/div\x3e",
baseClass:"dijitComboBoxMenu",postCreate:function(){this.inherited(arguments);this.isLeftToRight()||(b.add(this.previousButton,"dijitMenuItemRtl"),b.add(this.nextButton,"dijitMenuItemRtl"));this.containerNode.setAttribute("role","listbox")},_createMenuItem:function(){var n=this.ownerDocument.createElement("div");n.className="dijitReset dijitMenuItem"+(this.isLeftToRight()?"":" dijitMenuItemRtl");n.setAttribute("role","option");return n},onHover:function(n){b.add(n,"dijitMenuItemHover")},onUnhover:function(n){b.remove(n,
"dijitMenuItemHover")},onSelect:function(n){b.add(n,"dijitMenuItemSelected")},onDeselect:function(n){b.remove(n,"dijitMenuItemSelected")},_page:function(n){var f=0,e=this.domNode.scrollTop,k=c.get(this.domNode,"height");for(this.getHighlightedOption()||this.selectNextNode();f<k;){var r=this.getHighlightedOption();if(n){if(!r.previousSibling||"none"==r.previousSibling.style.display)break;this.selectPreviousNode()}else{if(!r.nextSibling||"none"==r.nextSibling.style.display)break;this.selectNextNode()}r=
this.domNode.scrollTop;f+=(r-e)*(n?-1:1);e=r}},handleKey:function(n){switch(n.keyCode){case d.DOWN_ARROW:return this.selectNextNode(),!1;case d.PAGE_DOWN:return this._page(!1),!1;case d.UP_ARROW:return this.selectPreviousNode(),!1;case d.PAGE_UP:return this._page(!0),!1;default:return!0}}})})},"dijit/form/_ComboBoxMenuMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/has dojo/i18n dojo/i18n!./nls/ComboBox".split(" "),function(a,b,c,d,g){var x=b("dijit.form._ComboBoxMenuMixin"+
(d("dojo-bidi")?"_NoBidi":""),null,{_messages:null,postMixInProperties:function(){this.inherited(arguments);this._messages=g.getLocalization("dijit.form","ComboBox",this.lang)},buildRendering:function(){this.inherited(arguments);this.previousButton.innerHTML=this._messages.previousMessage;this.nextButton.innerHTML=this._messages.nextMessage},_setValueAttr:function(w){this._set("value",w);this.onChange(w)},onClick:function(w){if(w==this.previousButton)this._setSelectedAttr(null),this.onPage(-1);else if(w==
this.nextButton)this._setSelectedAttr(null),this.onPage(1);else this.onChange(w)},onChange:function(){},onPage:function(){},onClose:function(){this._setSelectedAttr(null)},_createOption:function(w,l){var n=this._createMenuItem();w=l(w);w.html?n.innerHTML=w.label:n.appendChild(n.ownerDocument.createTextNode(w.label));""==n.innerHTML&&(n.innerHTML="\x26#160;");return n},createOptions:function(w,l,n){this.items=w;this.previousButton.style.display=0==l.start?"none":"";c.set(this.previousButton,"id",this.id+
"_prev");a.forEach(w,function(e,k){e=this._createOption(e,n);e.setAttribute("item",k);c.set(e,"id",this.id+k);this.nextButton.parentNode.insertBefore(e,this.nextButton)},this);var f=!1;w.total&&!w.total.then&&-1!=w.total?l.start+l.count<w.total?f=!0:l.start+l.count>w.total&&l.count==w.length&&(f=!0):l.count==w.length&&(f=!0);this.nextButton.style.display=f?"":"none";c.set(this.nextButton,"id",this.id+"_next")},clearResultList:function(){for(var w=this.containerNode;2<w.childNodes.length;)w.removeChild(w.childNodes[w.childNodes.length-
2]);this._setSelectedAttr(null)},highlightFirstOption:function(){this.selectFirstNode()},highlightLastOption:function(){this.selectLastNode()},selectFirstNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.previousButton&&this.selectNextNode()},selectLastNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.nextButton&&this.selectPreviousNode()},getHighlightedOption:function(){return this.selected}});d("dojo-bidi")&&(x=b("dijit.form._ComboBoxMenuMixin",
x,{_createOption:function(){var w=this.inherited(arguments);this.applyTextDir(w);return w}}));return x})},"dijit/form/_ListMouseMixin":function(){define(["dojo/_base/declare","dojo/on","dojo/touch","./_ListBase"],function(a,b,c,d){return a("dijit.form._ListMouseMixin",d,{postCreate:function(){this.inherited(arguments);this.domNode.dojoClick=!0;this._listConnect("click","_onClick");this._listConnect("mousedown","_onMouseDown");this._listConnect("mouseup","_onMouseUp");this._listConnect("mouseover",
"_onMouseOver");this._listConnect("mouseout","_onMouseOut")},_onClick:function(g,x){this._setSelectedAttr(x,!1);this._deferredClick&&this._deferredClick.remove();this._deferredClick=this.defer(function(){this._deferredClick=null;this.onClick(x)})},_onMouseDown:function(g,x){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging=!0;this._setSelectedAttr(x,!1)},_onMouseUp:function(g,x){this._isDragging=!1;var w=this.selected,l=this._hoveredNode;w&&x==w?this.defer(function(){this._onClick(g,
w)}):l&&this.defer(function(){this._onClick(g,l)})},_onMouseOut:function(g,x){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging&&(this._cancelDrag=(new Date).getTime()+1E3)},_onMouseOver:function(g,x){this._cancelDrag&&((new Date).getTime()>this._cancelDrag&&(this._isDragging=!1),this._cancelDrag=null);this._hoveredNode=x;this.onHover(x);this._isDragging&&this._setSelectedAttr(x,!1)}})})},"dijit/form/_ListBase":function(){define(["dojo/_base/declare","dojo/on",
"dojo/window"],function(a,b,c){return a("dijit.form._ListBase",null,{selected:null,_listConnect:function(d,g){var x=this;return x.own(b(x.containerNode,b.selector(function(w,l,n){return w.parentNode==n},d),function(w){x[g](w,this)}))},selectFirstNode:function(){for(var d=this.containerNode.firstChild;d&&"none"==d.style.display;)d=d.nextSibling;this._setSelectedAttr(d,!0)},selectLastNode:function(){for(var d=this.containerNode.lastChild;d&&"none"==d.style.display;)d=d.previousSibling;this._setSelectedAttr(d,
!0)},selectNextNode:function(){var d=this.selected;if(d){for(d=d.nextSibling;d&&"none"==d.style.display;)d=d.nextSibling;d?this._setSelectedAttr(d,!0):this.selectFirstNode()}else this.selectFirstNode()},selectPreviousNode:function(){var d=this.selected;if(d){for(d=d.previousSibling;d&&"none"==d.style.display;)d=d.previousSibling;d?this._setSelectedAttr(d,!0):this.selectLastNode()}else this.selectLastNode()},_setSelectedAttr:function(d,g){if(this.selected!=d){var x=this.selected;if(x)this.onDeselect(x);
d&&(g&&c.scrollIntoView(d),this.onSelect(d));this._set("selected",d)}else if(d)this.onSelect(d)}})})},"url:jimu/dijit/templates/LoadingShelter.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"loading-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"imgDiv" class\x3d"img-div"\x3e\r\n      \x3c/div\x3e\r\n      \x3cp data-dojo-attach-point\x3d"textNode"\x3e\x3c/p\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',"url:dijit/templates/Menu.html":'\x3ctable class\x3d"dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable" role\x3d"menu" tabIndex\x3d"${tabIndex}"\r\n\t   cellspacing\x3d"0"\x3e\r\n\t\x3ctbody class\x3d"dijitReset" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/tbody\x3e\r\n\x3c/table\x3e\r\n',
"url:dijit/templates/MenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"menuitem" tabIndex\x3d"-1"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,textDirNode"\r\n\t\trole\x3d"presentation"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"arrowWrapper" style\x3d"visibility: hidden"\x3e\r\n\t\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuExpand"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan class\x3d"dijitMenuExpandA11y"\x3e+\x3c/span\x3e\r\n\t\t\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/CheckedMenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"${role}" tabIndex\x3d"-1" aria-checked\x3d"${checked}"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuItemIcon dijitCheckedMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\t\x3cspan class\x3d"dijitMenuItemIconChar dijitCheckedMenuItemIconChar"\x3e${!checkedChar}\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,labelNode,textDirNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\x26#160;\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/MenuSeparator.html":'\x3ctr class\x3d"dijitMenuSeparator" role\x3d"separator"\x3e\r\n\t\x3ctd class\x3d"dijitMenuSeparatorIconCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd colspan\x3d"3" class\x3d"dijitMenuSeparatorLabelCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop dijitMenuSeparatorLabel"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/Tooltip.html":'\x3cdiv class\x3d"dijitTooltip dijitTooltipLeft" id\x3d"dojoTooltip" data-dojo-attach-event\x3d"mouseenter:onMouseEnter,mouseleave:onMouseLeave"\r\n\t\x3e\x3cdiv class\x3d"dijitTooltipConnector" data-dojo-attach-point\x3d"connectorNode"\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitTooltipContainer dijitTooltipContents" data-dojo-attach-point\x3d"containerNode" role\x3d\'alert\'\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',"url:dijit/form/templates/Select.html":'\x3ctable class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tdata-dojo-attach-point\x3d"_buttonNode,tableNode,focusNode,_popupStateNode" cellspacing\x3d\'0\' cellpadding\x3d\'0\'\r\n\trole\x3d"listbox" aria-haspopup\x3d"true"\r\n\t\x3e\x3ctbody role\x3d"presentation"\x3e\x3ctr role\x3d"presentation"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitStretch dijitButtonContents" role\x3d"presentation"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitButtonText"  data-dojo-attach-point\x3d"containerNode,textDirNode" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitValidationContainer"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\t\x3e\x3cinput type\x3d"hidden" ${!nameAttrSetting} data-dojo-attach-point\x3d"valueNode" value\x3d"${value}" aria-hidden\x3d"true"\r\n\t\t/\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer"\r\n\t\t\tdata-dojo-attach-point\x3d"titleNode" role\x3d"presentation"\r\n\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t${_buttonInputDisabled}\r\n\t\t/\x3e\x3c/td\r\n\t\x3e\x3c/tr\x3e\x3c/tbody\r\n\x3e\x3c/table\x3e\r\n',
"url:dijit/form/templates/TextBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft" id\x3d"widget_${id}" role\x3d"presentation"\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputInner" data-dojo-attach-point\x3d\'textbox,focusNode\' autocomplete\x3d"off"\r\n\t\t\t${!nameAttrSetting} type\x3d\'${type}\'\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',"url:dijit/form/templates/ValidationTextBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}" role\x3d"presentation"\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputInner" data-dojo-attach-point\x3d\'textbox,focusNode\' autocomplete\x3d"off"\r\n\t\t\t${!nameAttrSetting} type\x3d\'${type}\'\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:dijit/form/templates/Spinner.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}" role\x3d"presentation"\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitButtonNode dijitSpinnerButtonContainer"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitSpinnerButtonInner" type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t/\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitUpArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"upArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9650; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\t\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitDownArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"downArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' data-dojo-attach-point\x3d"textbox,focusNode" type\x3d"${type}" data-dojo-attach-event\x3d"onkeydown:_onKeyDown"\r\n\t\t\trole\x3d"spinbutton" autocomplete\x3d"off" ${!nameAttrSetting}\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:dijit/templates/ColorPalette.html":'\x3cdiv class\x3d"dijitInline dijitColorPalette" role\x3d"grid"\x3e\r\n\t\x3ctable data-dojo-attach-point\x3d"paletteTableNode" class\x3d"dijitPaletteTable" cellSpacing\x3d"0" cellPadding\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\x3ctbody data-dojo-attach-point\x3d"gridNode"\x3e\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\x3c/div\x3e\r\n',"url:dijit/form/templates/Button.html":'\x3cspan class\x3d"dijit dijitReset dijitInline" role\x3d"presentation"\r\n\t\x3e\x3cspan class\x3d"dijitReset dijitInline dijitButtonNode"\r\n\t\tdata-dojo-attach-event\x3d"ondijitclick:__onClick" role\x3d"presentation"\r\n\t\t\x3e\x3cspan class\x3d"dijitReset dijitStretch dijitButtonContents"\r\n\t\t\tdata-dojo-attach-point\x3d"titleNode,focusNode"\r\n\t\t\trole\x3d"button" aria-labelledby\x3d"${id}_label"\r\n\t\t\t\x3e\x3cspan class\x3d"dijitReset dijitInline dijitIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\r\n\t\t\t\x3e\x3cspan class\x3d"dijitReset dijitToggleButtonIconChar"\x3e\x26#x25CF;\x3c/span\r\n\t\t\t\x3e\x3cspan class\x3d"dijitReset dijitInline dijitButtonText"\r\n\t\t\t\tid\x3d"${id}_label"\r\n\t\t\t\tdata-dojo-attach-point\x3d"containerNode"\r\n\t\t\t\x3e\x3c/span\r\n\t\t\x3e\x3c/span\r\n\t\x3e\x3c/span\r\n\t\x3e\x3cinput ${!nameAttrSetting} type\x3d"${type}" value\x3d"${value}" class\x3d"dijitOffScreen"\r\n\t\tdata-dojo-attach-event\x3d"onclick:_onClick"\r\n\t\ttabIndex\x3d"-1" aria-hidden\x3d"true" data-dojo-attach-point\x3d"valueNode"\r\n/\x3e\x3c/span\x3e\r\n',
"url:dijit/form/templates/HorizontalSlider.html":'\x3ctable class\x3d"dijit dijitReset dijitSlider dijitSliderH" cellspacing\x3d"0" cellpadding\x3d"0" border\x3d"0" rules\x3d"none" data-dojo-attach-event\x3d"onkeydown:_onKeyDown, onkeyup:_onKeyUp"\r\n\trole\x3d"presentation"\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\t\x3e\x3ctd data-dojo-attach-point\x3d"topDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationT dijitSliderDecorationH"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderDecrementIconH" style\x3d"display:none" data-dojo-attach-point\x3d"decrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e-\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderLeftBumper" data-dojo-attach-event\x3d"press:_onClkDecBumper"\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cinput data-dojo-attach-point\x3d"valueNode" type\x3d"hidden" ${!nameAttrSetting}\r\n\t\t\t/\x3e\x3cdiv class\x3d"dijitReset dijitSliderBarContainerH" role\x3d"presentation" data-dojo-attach-point\x3d"sliderBarContainer"\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"progressBar" class\x3d"dijitSliderBar dijitSliderBarH dijitSliderProgressBar dijitSliderProgressBarH" data-dojo-attach-event\x3d"press:_onBarClick"\r\n\t\t\t\t\t\x3e\x3cdiv class\x3d"dijitSliderMoveable dijitSliderMoveableH"\r\n\t\t\t\t\t\t\x3e\x3cdiv data-dojo-attach-point\x3d"sliderHandle,focusNode" class\x3d"dijitSliderImageHandle dijitSliderImageHandleH" data-dojo-attach-event\x3d"press:_onHandleClick" role\x3d"slider"\x3e\x3c/div\r\n\t\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"remainingBar" class\x3d"dijitSliderBar dijitSliderBarH dijitSliderRemainingBar dijitSliderRemainingBarH" data-dojo-attach-event\x3d"press:_onBarClick"\x3e\x3c/div\r\n\t\t\t\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderRightBumper" data-dojo-attach-event\x3d"press:_onClkIncBumper"\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderIncrementIconH" style\x3d"display:none" data-dojo-attach-point\x3d"incrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e+\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\t\x3e\x3ctd data-dojo-attach-point\x3d"containerNode,bottomDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationB dijitSliderDecorationH"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\x3e\x3c/table\x3e\r\n',
"url:dijit/form/templates/CheckBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline" role\x3d"presentation"\r\n\t\x3e\x3cinput\r\n\t \t${!nameAttrSetting} type\x3d"${type}" role\x3d"${type}" aria-checked\x3d"false" ${checkedAttrSetting}\r\n\t\tclass\x3d"dijitReset dijitCheckBoxInput"\r\n\t\tdata-dojo-attach-point\x3d"focusNode"\r\n\t \tdata-dojo-attach-event\x3d"ondijitclick:_onClick"\r\n/\x3e\x3c/div\x3e\r\n',"url:dijit/form/templates/DropDownBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}"\r\n\trole\x3d"combobox"\r\n\taria-haspopup\x3d"true"\r\n\tdata-dojo-attach-point\x3d"_popupStateNode"\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer\'\r\n\t\tdata-dojo-attach-point\x3d"_buttonNode" role\x3d"presentation"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"button presentation" aria-hidden\x3d"true"\r\n\t\t\t${_buttonInputDisabled}\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' ${!nameAttrSetting} type\x3d"${type}" autocomplete\x3d"off"\r\n\t\t\tdata-dojo-attach-point\x3d"textbox,focusNode" role\x3d"textbox"\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"*now":function(a){a(['dojo/i18n!*preload*jimu/nls/main*["ar","bg","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sk","sl","sr","sv","th","tr","zh-cn","uk","vi","zh-hk","zh-tw","ROOT"]'])}}});
define("./ConfigManager ./LayoutManager ./DataManager dojo/_base/html dojo/_base/lang dojo/_base/array dojo/on dojo/mouse dojo/topic dojo/cookie dojo/Deferred dojo/promise/all dojo/io-query dojo/domReady! esri/config esri/request esri/core/urlUtils esri/identity/IdentityManager jimu/portalUrlUtils ./utils require dojo/i18n dojo/i18n!./nls/main dojo/ready".split(" "),function(a,b,c,d,g,x,w,l,n,f,e,k,r,y,p,h,m,u,t,q,z,v,B,A){function E(){var F=window.location.search;if(""===F)return{};F=r.queryToObject(F.substr(1));
for(var G in F)F[G]=q.sanitizeHTML(F[G]);return F}x={};n=q.getEsriConfigRequestObject();n.timeout=18E4;"function"!==typeof f.getAll&&(f.getAll=function(F){var G=[];(F=f(F))&&G.push(F);return G});window.jimuNls=B;u.setProtocolErrorHandler(function(){return!0});u=q.getAncestorWindow();var C=!1;try{C=0===u.location.href.indexOf("https://")}catch(F){}var D=/\/SceneServer\/layers\/\d+\/?$/;n.interceptors=[{before:function(F){F&&"object"===typeof F.requestOptions&&!F.requestOptions.content&&D.test(F.url)&&
(F.content={f:"json"});F.requestOptions.query&&F.requestOptions.query.printFlag&&(F.timeout=3E5);C&&(F.url=F.url.replace(/^http(s?):\/\//gi,"https://"));-1===F.url.indexOf("/queryRelatedRecords?")||q.isHostedService(F.url)||(F.url=F.url.replace("FeatureServer","MapServer"))}}];w(window,"mousedown",function(F){if(l.isMiddle(F))return F.preventDefault(),F.stopPropagation(),F.returnValue=!1});String.prototype.startWith=function(F){return this.substr(0,F.length)===F?!0:!1};String.prototype.endWith=function(F){return this.substr(this.length-
F.length,F.length)===F?!0:!1};"undefined"===typeof jimuConfig&&(jimuConfig={});jimuConfig=g.mixin({loadingId:"main-loading",loadingImageId:"app-loading",loadingGifId:"loading-gif",layoutId:"jimu-layout-manager",mapId:"map",mainPageId:"main-page",timeout:5E3,breakPoints:[600,1280]},jimuConfig);window.wabVersion="2.24";window.productVersion="Online 10.1";x.initApp=function(){console.log("jimu.js init...");var F=E();c.getInstance();d.setStyle(jimuConfig.loadingId,"display","none");d.setStyle(jimuConfig.mainPageId,
"display","block");var G=b.getInstance({mapId:jimuConfig.mapId,urlParams:F},jimuConfig.layoutId);F=a.getInstance(F);G.startup();F.loadConfig();A(function(){setTimeout(function(){d.removeClass(document.body,"dj_a11y")},50)})};return x});